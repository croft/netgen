(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.logicblox=e()}})(function(){var t,i,r;return function e(t,i,r){function n(a,s){if(!i[a]){if(!t[a]){var l=typeof require=="function"&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){var i=t[a][1][e];return n(i?i:e)},c,c.exports,e,t,i,r)}return i[a].exports}var o=typeof require=="function"&&require;for(var a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,i,r){"use strict";(function(e,n){if(typeof t==="function"&&t.amd){t(n)}else if(typeof r==="object"){i.exports=n()}else{window[e]=n()}})("MQG",function(){var e=function(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e};var t=function(e){return e.toUpperCase().trim()};var i=function(e,t){t=t||"";if(!e){throw new SyntaxError("Assertion failed: "+t)}};var r=function(e,t,r){var n;if(typeof t==="function"){n=function(e){return e instanceof t}}else{i(Array.isArray(t));n=function(e){return t.some(function(t){return e instanceof t})}}i(Array.isArray(e)&&(e.length===0||n(e[0])),r)};var n=function(e){var t=[];if(Array.isArray(e)){t=e}else if(e!==undefined&&e!==null){t.push(e)}return t};var o=function(){var e=["STRING","INT","FLOAT","DECIMAL","BOOLEAN","NAMED"];var r=function(i){i=t(i);if(e.indexOf(i)===-1){throw new SyntaxError("Invalid type")}else{return i}};function n(e,t){if(typeof e==="object"&&e.kind){return n.call(this,e.kind,e.named)}i(typeof e==="string","kind should be string, but it is currently "+e);e=r(e);i(e==="NAMED"?typeof t==="string":t===undefined);this.kind=e;if(e==="NAMED"){this.named=t}}return n}();var a=function(){function e(e,t){i(typeof e==="string"&&["SINGLETON","SET"].indexOf(e)!==-1);i(t instanceof o);this.kind=e;this.type=t}return e}();var s=function(){function e(e,t){i(e instanceof H);i(t instanceof a||typeof t==="undefined");this.intersection=e;this.type=t}return e}();var l=function(){function e(e,t,r){i(!e||!r,"kind and str are mutually exclusive");if(e){this.kind=e.toUpperCase();this[e.toLowerCase()]=t}else if(r){this.str=r}}e.prototype.filterBy=function(e,t,i){return new b(this,e,t,i)};e.prototype.diceBy=function(e,t){if(!n(e).length){return this}return new w(this,e,t)};e.prototype.aggBy=function(e,t){var i=function(e){var t=[];var i;for(var r=0;r<e.length;r++){i=e[r];if(i.indexOf(".")>-1){t.push(new $("MAP",i.split(".")[0],i.split(".")[1]))}else{t.push(new $("ALL",i))}}return t};if(t){if(t instanceof H){}else if(typeof t==="string"){t=i([t])}else if(Array.isArray(t)&&typeof t[0]==="string"){t=i(t)}}return new I(this,e,t)};e.prototype.widenBy=function(e){return new T(this,e)};e.prototype.headerSortBy=function(e){return new O(this,e)};e.prototype.relabelBy=function(e){return new E(this,e)};e.prototype.demote=function(e){return new M(this,e)};e.prototype.drop=function(){return new x(this)};e.prototype.add=function(t){if(["number","string"].indexOf(typeof t)>-1){if(arguments.length===2){return this.add(new g(t,arguments[1]))}else{throw"corresponding measure service type(INT,FLOAT,DECIMAL) is required when the argument is primitive"}}if(!(t instanceof e)){throw new SyntaxError("Expression Expected")}else{return new p("+",[this,t])}};e.prototype.subtract=function(t){if(["number","string"].indexOf(typeof t)>-1){if(arguments.length===2){return this.subtract(new g(t,arguments[1]))}else{throw"corresponding measure service type(INT,FLOAT,DECIMAL) is required when the argument is primitive"}}if(!(t instanceof e)){throw new SyntaxError("Expression Expected")}else{return new p("-",[this,t])}};e.prototype.multiply=function(t){if(["number","string"].indexOf(typeof t)>-1){if(arguments.length===2){return this.multiply(new g(t,arguments[1]))}else{throw"corresponding measure service type(INT,FLOAT,DECIMAL) is required when the argument is primitive"}}if(!(t instanceof e)){throw new SyntaxError("Expression Expected")}else{return new p("*",[this,t])}};e.prototype.divide=function(t){if(["number","string"].indexOf(typeof t)>-1){if(arguments.length===2){return this.divide(new g(t,arguments[1]))}else{throw"corresponding measure service type(INT,FLOAT,DECIMAL) is required when the argument is primitive"}}if(!(t instanceof e)){throw new SyntaxError("Expression Expected")}return new p("/",[this,t])};e.prototype.widen=function(e){if(!(e instanceof H)){e=new H(e)}return new T(this,e)};e.prototype.overrideBy=function(e){return new D(this,e)};e.prototype.difference=function(e){return new _(this,e)};e.prototype.toInt=function(){return new f(this,new o("INT"))};e.prototype.toFloat=function(){return new f(this,new o("FLOAT"))};e.prototype.toDecimal=function(){return new f(this,new o("DECIMAL"))};e.prototype.toString=e.prototype.toBoolean=function(){return this};e.prototype.prev=function(){return new P(this)};e.prototype.abs=function(){return new p("ABS",[this])};e.prototype.negate=function(){return new p("NEGATE",[this])};e.prototype.cast=function(e){if(typeof e==="string"){e=e.toUpperCase()}return new f(this,new o(e))};return e}();var u=function(t){function i(e,i){t.call(this,"ATTRIBUTE",oe(e,i))}e(i,t);return i}(l);var c=function(t){function r(e,n){i(typeof e==="string");i(typeof n==="undefined"||n instanceof H);if(n instanceof H){var o=new r(e);return new y(o,new B("inter",n))}else{var a={name:e};t.call(this,"METRIC",a)}}e(r,t);return r}(l);var d=function(e){function t(e){i(typeof e==="string");if(e.indexOf(".")>-1){return new u(e)}else{return new c(e)}}return t}(c,u);var p=function(i){var n={NEGATE:"NEGATE","!":"NEGATE",SQRT:"SQRT",GAMMA:"GAMMA",LOG:"LOG",TO_UPPER:"TO_UPPER",TO_LOWER:"TO_LOWER",ADD:"ADD","+":"ADD",SUBTRACT:"SUBTRACT","-":"SUBTRACT",MULTIPLY:"MULTIPLY","*":"MULTIPLY",DIVIDE:"DIVIDE","/":"DIVIDE",NAMED:"NAMED",INT_TO_FLOAT:"INT_TO_FLOAT",INT_TO_DECIMAL:"INT_TO_DECIMAL",DECIMAL_TO_INT:"DECIMAL_TO_INT",DECIMAL_TO_FLOAT:"DECIMAL_TO_FLOAT",STRING_TO_FLOAT:"STRING_TO_FLOAT",STRING_TO_INT:"STRING_TO_INT",STRING_TO_DECIMAL:"STRING_TO_DECIMAL",FLOAT_TO_DECIMAL:"FLOAT_TO_DECIMAL",POW:"POW",AS_ENTITY:"AS_ENTITY",ABS:"ABS"};var o=function(e){e=n[t(e)];if(!e){throw new SyntaxError("Invalide operator")}else{return e}};function a(e,t,n){e=o(e);r(t,l,"OpExpr takes an array of Expr's.");var a={op:{kind:e},expr:t};if(e==="NAMED"){a.op.name=n}i.call(this,"OP",a)}e(a,i);return a}(l);var f=function(t){function r(e,r){var n;i(e instanceof l);i(r instanceof o);n={expr:e,type:r};t.call(this,"CAST",n)}e(r,t);return r}(l);var h=function(t){function r(e,r,n){var o;i(typeof e==="string"&&["GENERAL","TOP_SINGLETON"].indexOf(e)!==-1);i(r instanceof s);i(Array.isArray(n));o={kind:e,signature:r,column:n};t.call(this,"LITERAL",o)}e(r,t);return r}(l);var g=function(t){function r(e,t){i(typeof e==="boolean"||typeof e==="number"||typeof e==="string"||Array.isArray(e));i(t instanceof o||typeof t==="string");if(typeof t==="string"){t=new o(t)}return new h("GENERAL",new s(new H([]),new a("SINGLETON",t)),[new V(t.kind,n(e))])}e(r,t);return r}(l);var m=function(t){function i(e){t.call(this,"VARIABLE",{name:e})}e(i,t);return i}(l);var v=function(t){function o(e,o,a){e=n(e);o=n(o);r(e,B);r(o,z);i(a instanceof l);t.call(this,"ABSTRACTION",{inter_arg:e,expr_arg:o,body:a})}e(o,t);return o}(l);var y=function(t){function o(e,o,a){i(e instanceof l);o=n(o);a=n(a);r(o,B);r(a,z);t.call(this,"APPLICATION",{abstraction:e,inter_arg:o,expr_arg:a})}e(o,t);return o}(l);var b=function(t){function i(e,i,r,o){var a;if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}if(!(i instanceof ae.Comparison)&&(!i.length||!(i[0]instanceof ae.Comparison))){if(typeof r!=="string"){throw"Third argument must be value type if the second argument is a primitive value(not comparison)"}var s;var u=[];for(s in i){u.push(new ae.Comparison(s,new ae.ConstantExpr(n(i[s]),r)))}i=u}else{o=r}o=o||false;a={expr:e,comparison:n(i),is_disjunction:o};t.call(this,"FILTER",a)}e(i,t);return i}(l);var w=function(t){function i(e,i,r){var o;r=r||false;if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}i=n(i);if(!i.length){throw"empty dicers specified for: "+JSON.stringify(e)}o={expr:e,dicer:i,is_disjunction:r};t.call(this,"DICE",o)}e(i,t);return i}(l);var C=function(t){function i(e,i){var r;if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}i=n(i);if(!i.length){throw new SyntaxError("empty labelMaps specified for relabeling expr: "+JSON.stringify(e))}r={expr:e,map:i};t.call(this,"SPLIT",r)}e(i,t);return i}(l);var E=function(t){function i(e,i){var r;if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}i=n(i);if(!i.length){throw new SyntaxError("empty labelMaps specified for relabeling expr: "+JSON.stringify(e))}r={expr:e,map:i};t.call(this,"RELABEL",r)}e(i,t);return i}(l);var S=function(){function e(e,t){this.source=e;this.target=t}return e}();var T=function(t){function i(e,i){var r;if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}if(!(i instanceof H)){throw new SyntaxError("Intersection Expected")}r={expr:e,inter:i};t.call(this,"WIDEN",r)}e(i,t);return i}(l);var x=function(t){function i(e){var i;if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}i={expr:e};t.call(this,"DROP",i)}e(i,t);return i}(l);var _=function(t){function i(e,i){var r;if(!(e instanceof l)){throw new SyntaxError("First Argument: Expression Expected")}if(!(i instanceof l)){throw new SyntaxError("Second Argument: Expression Expected")}r={left:e,right:i};t.call(this,"DIFFERENCE",r)}e(i,t);return i}(l);var M=function(t){function i(e,i){var r;if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}r={expr:e,dimension:i.trim()};t.call(this,"DEMOTE",r)}e(i,t);return i}(l);var A=function(){function e(e,t){if(!(e instanceof l)){throw new SyntaxError("First Argument: Expression Expected")}if(!(t instanceof l)){throw new SyntaxError("Second Argument: Expression Expected")}this.test=e;this.result=t}return e}();var I=function(i){var n=["COLLECT","AMBIG","TOTAL","MIN","MAX","COUNT","MODE","COUNT_DISTINCT","HISTOGRAM","AVERAGE"];var o=function(e){if(n.indexOf(e)===-1){return false}else{return true}};function a(e,n,s){var u,c;if(s instanceof H){c=s}else{r(s,$,"Third argument of AggExpr should be Grouping[] or Intersection, but is: "+JSON.stringify(s));u=s}var d;var p;if(typeof n==="string"){n=t(n);if(!o(n)){throw new SyntaxError("Invalid method for aggregation: "+n)}p={primitive:n}}else if(typeof n==="object"){p=n}if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}else{d={method:p,expr:e};if(u){d.grouping=u}else if(c){d.inter=c}if(p.primitive==="MODE"){i.call(this,"AGGREGATION",d);return new a(this,"MAX",u)}else{i.call(this,"AGGREGATION",d)}}}e(a,i);return a}(l);var O=function(t){function i(e,i){if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}if(!(i instanceof k)){throw new SyntaxError("Qualified Level Expected")}return t.call(this,"AGGREGATION",{method:{header_sort_level:i},expr:e})}e(i,t);return i}(l);var D=function(t){function i(){var e=Array.prototype.slice.call(arguments,0);e.forEach(function(e){if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}});return t.call(this,"OVERRIDE",{expr:e})}e(i,t);return i}(l);var N=function(i){var r=["UNION","INTERSECTION"];var n=function(e){if(r.indexOf(e)===-1){return false}else{return true}};function o(e,r){var o;e=t(e);if(!n(e)){throw new SyntaxError("Invalid kind. Possible values are: INTERSECTION, UNION")}o={kind:e,expr:r};i.call(this,"COMPOSITE",o)}e(o,i);return o}(l);var R=function(t){function r(e,r,n){if(r instanceof s){i(typeof n==="undefined","third argument 'type' shouldn't be present if BaseSignature is supplied");t.call(this,"PARAM",{name:e,signature:r})}else{i(n instanceof o||typeof n==="string"||typeof n==="undefined",["Parameter 'type' should be Type, string or undefined, but is: ",n]);n=n instanceof o?n:typeof n==="string"?new o(n):undefined;var l=n?new a("SINGLETON",n):undefined;t.call(this,"PARAM",{name:e,signature:new s(r,l)})}}e(r,t);return r}(l);var P=function(t){function i(e){var i;if(!(e instanceof l)){throw new SyntaxError("Expression Expected")}i={expr:e};t.call(this,"PREV",i)}e(i,t);return i}(l);var L=function(){var e={EQUALS:"EQUALS",NOT_EQUALS:"NOT_EQUALS",LESS_THAN:"LESS_THAN",LESS_OR_EQUALS:"LESS_OR_EQUALS",GREATER_THAN:"GREATER_THAN",GREATER_OR_EQUALS:"GREATER_OR_EQUALS",match:"MATCH",MATCH:"MATCH","~":"MATCH","=":"EQUALS","!=":"NOT_EQUALS","<>":"NOT_EQUALS","<":"LESS_THAN","<=":"LESS_OR_EQUALS",">":"GREATER_THAN",">=":"GREATER_OR_EQUALS"};var i=function(i){var r=t(i);if(e[r]){return e[r]}else{throw new SyntaxError("Invalid Operator")}};function r(e,t){var r=i(e);if(!(t instanceof l)){throw new SyntaxError("Expression Expected")}else{this.op=r;this.expr=t}}return r}();var k=function(){function e(e,t,i,r){this.dimension=e;this.level=t;if(i){this.hierarchy=i}if(r){this.label=r}}return e}();var $=function(){var e=function(e){var t=["NO_GROUPING","ALL","MAP","MULTI_MAP"];if(t.indexOf(e)===-1){return false}else{return true}};function i(i,r,n,o,a){var s=t(i);if(e(s)){this.kind=s;this.dimension=r;if(n){this.level=n}if(a){this.hierarchy=a}if(o){this.multi_dim_map=o}}else{throw new SyntaxError("Invalid kind for the grouping")}}return i}();var F={STRING:"string_column",INT:"int_column",FLOAT:"float_column",DECIMAL:"decimal_column",BOOLEAN:"bool_column"};var V=function(){function e(e,t){var r=typeof t;i(e instanceof o||typeof e==="string");e=e instanceof o?e.kind.toUpperCase():e;i(F.hasOwnProperty(e),["Unknown type",e]);i(Array.isArray(t)||r==="string"||r==="number"||r==="boolean","Invalid constants "+JSON.stringify(t));this[F[e]]={value:n(t)}}return e}();var q=function(){function e(e,t){if(!(e instanceof R)){throw new SyntaxError("First Argument: Param Expression Expected")}if(!(t instanceof l)){throw new SyntaxError("Second Argument: Expr Expected")}this.param=e.param;this.expr=t}return e}();var H=function(){function e(e){if(typeof e==="string"){this.variable=e}else if(e instanceof l){this.expr=e}else{var t=n(e);if(typeof t[0]==="string"&&t[0].indexOf(".")>0){t=t.map(function(e){return new k(e.split(".")[0],e.split(".")[1])})}this.qualified_level=t}}return e}();var U=function(){function e(e,t){i(typeof e==="string");i(t instanceof H);this.metric=e;this.inter=t}return e}();var B=function(){function e(e,t){i(typeof e==="string");this.name=e;if(t){i(t instanceof H);this.inter=t}}return e}();var z=function(){function e(e,t){i(typeof e==="string");this.name=e;if(t){i(t instanceof l);this.expr=t}}return e}();var j=function(t){function r(e,t,r,n,o){i(Array.prototype.slice.call(arguments,0).every(function(e){return typeof e==="string"}),"Expected strings");n=n||"Child";o=o||"Parent";return new C(new x(new u({dimension:e,level:t},"id")),[{source:e,target:o},{source:e,target:n}]).demote(e).aggBy("COLLECT",new H([{dimension:e,level:t,label:n},{dimension:e,level:r,label:o}])).drop()}e(r,t);return r}(l);var G=function(){function e(e,t,r){i(t instanceof l);this.metric=e;this.expr=t;this.convertible=r}return e}();var W=function(){function e(e,t){if(arguments.length>2){throw new SyntaxError("argument and relation parameters should be hoisted to Request")}if(!(e instanceof Y)){throw new SyntaxError("First Argument: UpdateExpr Expression Expected")}if(!(t instanceof l)){throw new SyntaxError("Second Argument: Expr Expected")}this.input=t;this.expr=e}return e}();var Q=function(){function e(e,t){this.spread_kind=e;this.distribution=t}return e}();var K=function(t){function r(e,r,n){i(e instanceof l&&(!n||typeof n==="string"||typeof n==="object"));var o={query:{expr:e}};if(n){o.query.type=typeof n==="object"&&n||{kind:n}}return t.call(this,o,r)}e(r,t);return r}(Q);var Y=function(){function e(e,t,n,o){i(typeof e==="string"&&["SPREAD","REMOVE"].indexOf(e)!==-1);i(typeof t==="string"||t instanceof ne);if(!(n instanceof Q)&&o){n=o}r(n,[Q,K]);this.kind=e;if(t instanceof ne){this.target=t}else{this.target=new ne(t)}this.transform=n}return e}();var X=function(){function e(e,t,r,n,o){i(typeof e==="string");i(t instanceof Array);i(r instanceof Array);i(typeof n==="undefined"||typeof n==="boolean");i(arguments.length<=5,"QueryRequest deprecated parameters: argument, relation, row_limit");this.report_name=e;this.key=t;this.measure=r;this.return_row_numbers=n;if(typeof o!=="undefined"){this.limited_rewrites=o}}return e}();var J=function(){function e(e){e=n(e);this.measure_expr=e}return e}();var Z=function(){function e(e,t,r,o,a,s){i(typeof e==="undefined"||e instanceof X||e instanceof Array);i(typeof t==="undefined"||t instanceof W||t instanceof Array);i(typeof r==="undefined"||r instanceof Array);i(typeof o==="undefined"||typeof o==="boolean");i(typeof a==="undefined"||a instanceof G||a instanceof Array);if(e){this.query_request=n(e)}if(t){this.update_request=n(t)}if(o){this.model_request={}}this.relation=r;if(a){this.metric_lock=n(a)}if(s){this.install_request=s}}return e}();var ee=function(){function e(e,t){r(e,U);r(t,U);this.edited=e;this.visible=t}return e}();var te=function(){function e(e){i(e instanceof ee);this.editability_request=e}return e}();var ie=function(){function e(){this.model_request={}}return e}();var re=function(e){if(e.indexOf(".")>0){return true}return false};var ne=function(e){if(typeof e==="string"){if(re(e)){this.attribute=oe(e)}else{this.metric=e}}else if(e instanceof k){this.level=e}else{throw"argument not supported"}};var oe=function(e,t){var i=function(e){var t=e.split(".");return{attr:t[2],dim:t[0],level:t[1]}};if(typeof e==="string"){var r=i(e);e=new ae.QualifiedLevel(r.dim,r.level);t=r.attr}return{qualified_level:e,attribute:t}};var ae={};ae.Type=o;ae.ValueType=a;ae.BaseSignature=s;ae.Expr=l;ae.AttributeExpr=u;ae.MetricExpr=c;ae.FilterExpr=b;ae.DiceExpr=w;ae.AggExpr=I;ae.HeaderSortExpr=O;ae.OverrideExpr=D;ae.WidenExpr=T;ae.VarExpr=m;ae.AbsExpr=v;ae.AppExpr=y;ae.InterArgument=B;ae.ExprArgument=z;ae.OpExpr=p;ae.DropExpr=x;ae.DifferenceExpr=_;ae.DemoteExpr=M;ae.CompositeExpr=N;ae.ParamExpr=R;ae.ConstantExpr=g;ae.LiteralExpr=h;ae.CastExpr=f;ae.Comparison=L;ae.QualifiedLevel=k;ae.Grouping=$;ae.Intersection=H;ae.MetricInter=U;ae.Branch=A;ae.RelationBinding=q;ae.Column=V;ae.Branch=A;ae.UpdateExpr=Y;ae.SplitExpr=C;ae.RelabelExpr=E;ae.LabelMap=S;ae.Request=Z;ae.UpdateTransform=Q;ae.UpdateQueryTransform=K;ae.UpdateRequest=W;ae.QueryRequest=X;ae.InstallRequest=J;ae.EditabilityRequest=ee;ae.EditabilityRequestRequest=te;ae.ModelRequestRequest=ie;ae.Ancestor=j;ae.Lock=G;ae.Measure=d;ae.Target=ne;return ae})},{}],2:[function(e,t,i){var r=e("util/");var n=Array.prototype.slice;var o=Object.prototype.hasOwnProperty;var a=t.exports=d;a.AssertionError=function e(t){this.name="AssertionError";this.actual=t.actual;this.expected=t.expected;this.operator=t.operator;if(t.message){this.message=t.message;this.generatedMessage=false}else{this.message=u(this);this.generatedMessage=true}var i=t.stackStartFunction||c;if(Error.captureStackTrace){Error.captureStackTrace(this,i)}else{var r=new Error;if(r.stack){var n=r.stack;var o=i.name;var a=n.indexOf("\n"+o);if(a>=0){var s=n.indexOf("\n",a+1);n=n.substring(s+1)}this.stack=n}}};r.inherits(a.AssertionError,Error);function s(e,t){if(r.isUndefined(t)){return""+t}if(r.isNumber(t)&&!isFinite(t)){return t.toString()}if(r.isFunction(t)||r.isRegExp(t)){return t.toString()}return t}function l(e,t){if(r.isString(e)){return e.length<t?e:e.slice(0,t)}else{return e}}function u(e){return l(JSON.stringify(e.actual,s),128)+" "+e.operator+" "+l(JSON.stringify(e.expected,s),128)}function c(e,t,i,r,n){throw new a.AssertionError({message:i,actual:e,expected:t,operator:r,stackStartFunction:n})}a.fail=c;function d(e,t){if(!e)c(e,true,t,"==",a.ok)}a.ok=d;a.equal=function e(t,i,r){if(t!=i)c(t,i,r,"==",a.equal)};a.notEqual=function e(t,i,r){if(t==i){c(t,i,r,"!=",a.notEqual)}};a.deepEqual=function e(t,i,r){if(!p(t,i)){c(t,i,r,"deepEqual",a.deepEqual)}};function p(e,t){if(e===t){return true}else if(r.isBuffer(e)&&r.isBuffer(t)){if(e.length!=t.length)return false;for(var i=0;i<e.length;i++){if(e[i]!==t[i])return false}return true}else if(r.isDate(e)&&r.isDate(t)){return e.getTime()===t.getTime()}else if(r.isRegExp(e)&&r.isRegExp(t)){return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase}else if(!r.isObject(e)&&!r.isObject(t)){return e==t}else{return h(e,t)}}function f(e){return Object.prototype.toString.call(e)=="[object Arguments]"}function h(e,t){if(r.isNullOrUndefined(e)||r.isNullOrUndefined(t))return false;if(e.prototype!==t.prototype)return false;if(r.isPrimitive(e)||r.isPrimitive(t)){return e===t}var i=f(e),o=f(t);if(i&&!o||!i&&o)return false;if(i){e=n.call(e);t=n.call(t);return p(e,t)}var a=v(e),s=v(t),l,u;if(a.length!=s.length)return false;a.sort();s.sort();for(u=a.length-1;u>=0;u--){if(a[u]!=s[u])return false}for(u=a.length-1;u>=0;u--){l=a[u];if(!p(e[l],t[l]))return false}return true}a.notDeepEqual=function e(t,i,r){if(p(t,i)){c(t,i,r,"notDeepEqual",a.notDeepEqual)}};a.strictEqual=function e(t,i,r){if(t!==i){c(t,i,r,"===",a.strictEqual)}};a.notStrictEqual=function e(t,i,r){if(t===i){c(t,i,r,"!==",a.notStrictEqual)}};function g(e,t){if(!e||!t){return false}if(Object.prototype.toString.call(t)=="[object RegExp]"){return t.test(e)}else if(e instanceof t){return true}else if(t.call({},e)===true){return true}return false}function m(e,t,i,n){var o;if(r.isString(i)){n=i;i=null}try{t()}catch(e){o=e}n=(i&&i.name?" ("+i.name+").":".")+(n?" "+n:".");if(e&&!o){c(o,i,"Missing expected exception"+n)}if(!e&&g(o,i)){c(o,i,"Got unwanted exception"+n)}if(e&&o&&i&&!g(o,i)||!e&&o){throw o}}a.throws=function(e,t,i){m.apply(this,[true].concat(n.call(arguments)))};a.doesNotThrow=function(e,t){m.apply(this,[false].concat(n.call(arguments)))};a.ifError=function(e){if(e){throw e}};var v=Object.keys||function(e){var t=[];for(var i in e){if(o.call(e,i))t.push(i)}return t}},{"util/":215}],3:[function(e,t,i){"use strict";i.byteLength=c;i.toByteArray=d;i.fromByteArray=h;var r=[];var n=[];var o=typeof Uint8Array!=="undefined"?Uint8Array:Array;var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var s=0,l=a.length;s<l;++s){r[s]=a[s];n[a.charCodeAt(s)]=s}n["-".charCodeAt(0)]=62;n["_".charCodeAt(0)]=63;function u(e){var t=e.length;if(t%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return e[t-2]==="="?2:e[t-1]==="="?1:0}function c(e){return e.length*3/4-u(e)}function d(e){var t,i,r,a,s,l;var c=e.length;s=u(e);l=new o(c*3/4-s);r=s>0?c-4:c;var d=0;for(t=0,i=0;t<r;t+=4,i+=3){a=n[e.charCodeAt(t)]<<18|n[e.charCodeAt(t+1)]<<12|n[e.charCodeAt(t+2)]<<6|n[e.charCodeAt(t+3)];l[d++]=a>>16&255;l[d++]=a>>8&255;l[d++]=a&255}if(s===2){a=n[e.charCodeAt(t)]<<2|n[e.charCodeAt(t+1)]>>4;l[d++]=a&255}else if(s===1){a=n[e.charCodeAt(t)]<<10|n[e.charCodeAt(t+1)]<<4|n[e.charCodeAt(t+2)]>>2;l[d++]=a>>8&255;l[d++]=a&255}return l}function p(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[e&63]}function f(e,t,i){var r;var n=[];for(var o=t;o<i;o+=3){r=(e[o]<<16)+(e[o+1]<<8)+e[o+2];n.push(p(r))}return n.join("")}function h(e){var t;var i=e.length;var n=i%3;var o="";var a=[];var s=16383;for(var l=0,u=i-n;l<u;l+=s){a.push(f(e,l,l+s>u?u:l+s))}if(n===1){t=e[i-1];o+=r[t>>2];o+=r[t<<4&63];o+="=="}else if(n===2){t=(e[i-2]<<8)+e[i-1];o+=r[t>>10];o+=r[t>>4&63];o+=r[t<<2&63];o+="="}a.push(o);return a.join("")}},{}],4:[function(e,t,i){},{}],5:[function(e,t,i){(function(t){"use strict";var r=e("base64-js");var n=e("ieee754");var o=e("isarray");i.Buffer=u;i.SlowBuffer=b;i.INSPECT_MAX_BYTES=50;u.TYPED_ARRAY_SUPPORT=t.TYPED_ARRAY_SUPPORT!==undefined?t.TYPED_ARRAY_SUPPORT:a();i.kMaxLength=s();function a(){try{var e=new Uint8Array(1);e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return e.foo()===42&&typeof e.subarray==="function"&&e.subarray(1,1).byteLength===0}catch(e){return false}}function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function l(e,t){if(s()<t){throw new RangeError("Invalid typed array length")}if(u.TYPED_ARRAY_SUPPORT){e=new Uint8Array(t);e.__proto__=u.prototype}else{if(e===null){e=new u(t)}e.length=t}return e}function u(e,t,i){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u)){return new u(e,t,i)}if(typeof e==="number"){if(typeof t==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return f(this,e)}return c(this,e,t,i)}u.poolSize=8192;u._augment=function(e){e.__proto__=u.prototype;return e};function c(e,t,i,r){if(typeof t==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&t instanceof ArrayBuffer){return m(e,t,i,r)}if(typeof t==="string"){return h(e,t,i)}return v(e,t)}u.from=function(e,t,i){return c(null,e,t,i)};if(u.TYPED_ARRAY_SUPPORT){u.prototype.__proto__=Uint8Array.prototype;u.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&u[Symbol.species]===u){Object.defineProperty(u,Symbol.species,{value:null,configurable:true})}}function d(e){if(typeof e!=="number"){throw new TypeError('"size" argument must be a number')}else if(e<0){throw new RangeError('"size" argument must not be negative')}}function p(e,t,i,r){d(t);if(t<=0){return l(e,t)}if(i!==undefined){return typeof r==="string"?l(e,t).fill(i,r):l(e,t).fill(i)}return l(e,t)}u.alloc=function(e,t,i){return p(null,e,t,i)};function f(e,t){d(t);e=l(e,t<0?0:y(t)|0);if(!u.TYPED_ARRAY_SUPPORT){for(var i=0;i<t;++i){e[i]=0}}return e}u.allocUnsafe=function(e){return f(null,e)};u.allocUnsafeSlow=function(e){return f(null,e)};function h(e,t,i){if(typeof i!=="string"||i===""){i="utf8"}if(!u.isEncoding(i)){throw new TypeError('"encoding" must be a valid string encoding')}var r=w(t,i)|0;e=l(e,r);var n=e.write(t,i);if(n!==r){e=e.slice(0,n)}return e}function g(e,t){var i=t.length<0?0:y(t.length)|0;e=l(e,i);for(var r=0;r<i;r+=1){e[r]=t[r]&255}return e}function m(e,t,i,r){t.byteLength;if(i<0||t.byteLength<i){throw new RangeError("'offset' is out of bounds")}if(t.byteLength<i+(r||0)){throw new RangeError("'length' is out of bounds")}if(i===undefined&&r===undefined){t=new Uint8Array(t)}else if(r===undefined){t=new Uint8Array(t,i)}else{t=new Uint8Array(t,i,r)}if(u.TYPED_ARRAY_SUPPORT){e=t;e.__proto__=u.prototype}else{e=g(e,t)}return e}function v(e,t){if(u.isBuffer(t)){var i=y(t.length)|0;e=l(e,i);if(e.length===0){return e}t.copy(e,0,0,i);return e}if(t){if(typeof ArrayBuffer!=="undefined"&&t.buffer instanceof ArrayBuffer||"length"in t){if(typeof t.length!=="number"||te(t.length)){return l(e,0)}return g(e,t)}if(t.type==="Buffer"&&o(t.data)){return g(e,t.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function y(e){if(e>=s()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+s().toString(16)+" bytes")}return e|0}function b(e){if(+e!=e){e=0}return u.alloc(+e)}u.isBuffer=function e(t){return!!(t!=null&&t._isBuffer)};u.compare=function e(t,i){if(!u.isBuffer(t)||!u.isBuffer(i)){throw new TypeError("Arguments must be Buffers")}if(t===i)return 0;var r=t.length;var n=i.length;for(var o=0,a=Math.min(r,n);o<a;++o){if(t[o]!==i[o]){r=t[o];n=i[o];break}}if(r<n)return-1;if(n<r)return 1;return 0};u.isEncoding=function e(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};u.concat=function e(t,i){if(!o(t)){throw new TypeError('"list" argument must be an Array of Buffers')}if(t.length===0){return u.alloc(0)}var r;if(i===undefined){i=0;for(r=0;r<t.length;++r){i+=t[r].length}}var n=u.allocUnsafe(i);var a=0;for(r=0;r<t.length;++r){var s=t[r];if(!u.isBuffer(s)){throw new TypeError('"list" argument must be an Array of Buffers')}s.copy(n,a);a+=s.length}return n};function w(e,t){if(u.isBuffer(e)){return e.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)){return e.byteLength}if(typeof e!=="string"){e=""+e}var i=e.length;if(i===0)return 0;var r=false;for(;;){switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case undefined:return Y(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return i*2;case"hex":return i>>>1;case"base64":return Z(e).length;default:if(r)return Y(e).length;t=(""+t).toLowerCase();r=true}}}u.byteLength=w;function C(e,t,i){var r=false;if(t===undefined||t<0){t=0}if(t>this.length){return""}if(i===undefined||i>this.length){i=this.length}if(i<=0){return""}i>>>=0;t>>>=0;if(i<=t){return""}if(!e)e="utf8";while(true){switch(e){case"hex":return $(this,t,i);case"utf8":case"utf-8":return N(this,t,i);case"ascii":return L(this,t,i);case"latin1":case"binary":return k(this,t,i);case"base64":return D(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();r=true}}}u.prototype._isBuffer=true;function E(e,t,i){var r=e[t];e[t]=e[i];e[i]=r}u.prototype.swap16=function e(){var t=this.length;if(t%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<t;i+=2){E(this,i,i+1)}return this};u.prototype.swap32=function e(){var t=this.length;if(t%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<t;i+=4){E(this,i,i+3);E(this,i+1,i+2)}return this};u.prototype.swap64=function e(){var t=this.length;if(t%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<t;i+=8){E(this,i,i+7);E(this,i+1,i+6);E(this,i+2,i+5);E(this,i+3,i+4)}return this};u.prototype.toString=function e(){var t=this.length|0;if(t===0)return"";if(arguments.length===0)return N(this,0,t);return C.apply(this,arguments)};u.prototype.equals=function e(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(this===t)return true;return u.compare(this,t)===0};u.prototype.inspect=function e(){var t="";var r=i.INSPECT_MAX_BYTES;if(this.length>0){t=this.toString("hex",0,r).match(/.{2}/g).join(" ");if(this.length>r)t+=" ... "}return"<Buffer "+t+">"};u.prototype.compare=function e(t,i,r,n,o){if(!u.isBuffer(t)){throw new TypeError("Argument must be a Buffer")}if(i===undefined){i=0}if(r===undefined){r=t?t.length:0}if(n===undefined){n=0}if(o===undefined){o=this.length}if(i<0||r>t.length||n<0||o>this.length){throw new RangeError("out of range index")}if(n>=o&&i>=r){return 0}if(n>=o){return-1}if(i>=r){return 1}i>>>=0;r>>>=0;n>>>=0;o>>>=0;if(this===t)return 0;var a=o-n;var s=r-i;var l=Math.min(a,s);var c=this.slice(n,o);var d=t.slice(i,r);for(var p=0;p<l;++p){if(c[p]!==d[p]){a=c[p];s=d[p];break}}if(a<s)return-1;if(s<a)return 1;return 0};function S(e,t,i,r,n){if(e.length===0)return-1;if(typeof i==="string"){r=i;i=0}else if(i>2147483647){i=2147483647}else if(i<-2147483648){i=-2147483648}i=+i;if(isNaN(i)){i=n?0:e.length-1}if(i<0)i=e.length+i;if(i>=e.length){if(n)return-1;else i=e.length-1}else if(i<0){if(n)i=0;else return-1}if(typeof t==="string"){t=u.from(t,r)}if(u.isBuffer(t)){if(t.length===0){return-1}return T(e,t,i,r,n)}else if(typeof t==="number"){t=t&255;if(u.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(n){return Uint8Array.prototype.indexOf.call(e,t,i)}else{return Uint8Array.prototype.lastIndexOf.call(e,t,i)}}return T(e,[t],i,r,n)}throw new TypeError("val must be string, number or Buffer")}function T(e,t,i,r,n){var o=1;var a=e.length;var s=t.length;if(r!==undefined){r=String(r).toLowerCase();if(r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le"){if(e.length<2||t.length<2){return-1}o=2;a/=2;s/=2;i/=2}}function l(e,t){if(o===1){return e[t]}else{return e.readUInt16BE(t*o)}}var u;if(n){var c=-1;for(u=i;u<a;u++){if(l(e,u)===l(t,c===-1?0:u-c)){
if(c===-1)c=u;if(u-c+1===s)return c*o}else{if(c!==-1)u-=u-c;c=-1}}}else{if(i+s>a)i=a-s;for(u=i;u>=0;u--){var d=true;for(var p=0;p<s;p++){if(l(e,u+p)!==l(t,p)){d=false;break}}if(d)return u}}return-1}u.prototype.includes=function e(t,i,r){return this.indexOf(t,i,r)!==-1};u.prototype.indexOf=function e(t,i,r){return S(this,t,i,r,true)};u.prototype.lastIndexOf=function e(t,i,r){return S(this,t,i,r,false)};function x(e,t,i,r){i=Number(i)||0;var n=e.length-i;if(!r){r=n}else{r=Number(r);if(r>n){r=n}}var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");if(r>o/2){r=o/2}for(var a=0;a<r;++a){var s=parseInt(t.substr(a*2,2),16);if(isNaN(s))return a;e[i+a]=s}return a}function _(e,t,i,r){return ee(Y(t,e.length-i),e,i,r)}function M(e,t,i,r){return ee(X(t),e,i,r)}function A(e,t,i,r){return M(e,t,i,r)}function I(e,t,i,r){return ee(Z(t),e,i,r)}function O(e,t,i,r){return ee(J(t,e.length-i),e,i,r)}u.prototype.write=function e(t,i,r,n){if(i===undefined){n="utf8";r=this.length;i=0}else if(r===undefined&&typeof i==="string"){n=i;r=this.length;i=0}else if(isFinite(i)){i=i|0;if(isFinite(r)){r=r|0;if(n===undefined)n="utf8"}else{n=r;r=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var o=this.length-i;if(r===undefined||r>o)r=o;if(t.length>0&&(r<0||i<0)||i>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!n)n="utf8";var a=false;for(;;){switch(n){case"hex":return x(this,t,i,r);case"utf8":case"utf-8":return _(this,t,i,r);case"ascii":return M(this,t,i,r);case"latin1":case"binary":return A(this,t,i,r);case"base64":return I(this,t,i,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,i,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase();a=true}}};u.prototype.toJSON=function e(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function D(e,t,i){if(t===0&&i===e.length){return r.fromByteArray(e)}else{return r.fromByteArray(e.slice(t,i))}}function N(e,t,i){i=Math.min(e.length,i);var r=[];var n=t;while(n<i){var o=e[n];var a=null;var s=o>239?4:o>223?3:o>191?2:1;if(n+s<=i){var l,u,c,d;switch(s){case 1:if(o<128){a=o}break;case 2:l=e[n+1];if((l&192)===128){d=(o&31)<<6|l&63;if(d>127){a=d}}break;case 3:l=e[n+1];u=e[n+2];if((l&192)===128&&(u&192)===128){d=(o&15)<<12|(l&63)<<6|u&63;if(d>2047&&(d<55296||d>57343)){a=d}}break;case 4:l=e[n+1];u=e[n+2];c=e[n+3];if((l&192)===128&&(u&192)===128&&(c&192)===128){d=(o&15)<<18|(l&63)<<12|(u&63)<<6|c&63;if(d>65535&&d<1114112){a=d}}}}if(a===null){a=65533;s=1}else if(a>65535){a-=65536;r.push(a>>>10&1023|55296);a=56320|a&1023}r.push(a);n+=s}return P(r)}var R=4096;function P(e){var t=e.length;if(t<=R){return String.fromCharCode.apply(String,e)}var i="";var r=0;while(r<t){i+=String.fromCharCode.apply(String,e.slice(r,r+=R))}return i}function L(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n){r+=String.fromCharCode(e[n]&127)}return r}function k(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n){r+=String.fromCharCode(e[n])}return r}function $(e,t,i){var r=e.length;if(!t||t<0)t=0;if(!i||i<0||i>r)i=r;var n="";for(var o=t;o<i;++o){n+=K(e[o])}return n}function F(e,t,i){var r=e.slice(t,i);var n="";for(var o=0;o<r.length;o+=2){n+=String.fromCharCode(r[o]+r[o+1]*256)}return n}u.prototype.slice=function e(t,i){var r=this.length;t=~~t;i=i===undefined?r:~~i;if(t<0){t+=r;if(t<0)t=0}else if(t>r){t=r}if(i<0){i+=r;if(i<0)i=0}else if(i>r){i=r}if(i<t)i=t;var n;if(u.TYPED_ARRAY_SUPPORT){n=this.subarray(t,i);n.__proto__=u.prototype}else{var o=i-t;n=new u(o,undefined);for(var a=0;a<o;++a){n[a]=this[a+t]}}return n};function V(e,t,i){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUIntLE=function e(t,i,r){t=t|0;i=i|0;if(!r)V(t,i,this.length);var n=this[t];var o=1;var a=0;while(++a<i&&(o*=256)){n+=this[t+a]*o}return n};u.prototype.readUIntBE=function e(t,i,r){t=t|0;i=i|0;if(!r){V(t,i,this.length)}var n=this[t+--i];var o=1;while(i>0&&(o*=256)){n+=this[t+--i]*o}return n};u.prototype.readUInt8=function e(t,i){if(!i)V(t,1,this.length);return this[t]};u.prototype.readUInt16LE=function e(t,i){if(!i)V(t,2,this.length);return this[t]|this[t+1]<<8};u.prototype.readUInt16BE=function e(t,i){if(!i)V(t,2,this.length);return this[t]<<8|this[t+1]};u.prototype.readUInt32LE=function e(t,i){if(!i)V(t,4,this.length);return(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};u.prototype.readUInt32BE=function e(t,i){if(!i)V(t,4,this.length);return this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};u.prototype.readIntLE=function e(t,i,r){t=t|0;i=i|0;if(!r)V(t,i,this.length);var n=this[t];var o=1;var a=0;while(++a<i&&(o*=256)){n+=this[t+a]*o}o*=128;if(n>=o)n-=Math.pow(2,8*i);return n};u.prototype.readIntBE=function e(t,i,r){t=t|0;i=i|0;if(!r)V(t,i,this.length);var n=i;var o=1;var a=this[t+--n];while(n>0&&(o*=256)){a+=this[t+--n]*o}o*=128;if(a>=o)a-=Math.pow(2,8*i);return a};u.prototype.readInt8=function e(t,i){if(!i)V(t,1,this.length);if(!(this[t]&128))return this[t];return(255-this[t]+1)*-1};u.prototype.readInt16LE=function e(t,i){if(!i)V(t,2,this.length);var r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r};u.prototype.readInt16BE=function e(t,i){if(!i)V(t,2,this.length);var r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r};u.prototype.readInt32LE=function e(t,i){if(!i)V(t,4,this.length);return this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};u.prototype.readInt32BE=function e(t,i){if(!i)V(t,4,this.length);return this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};u.prototype.readFloatLE=function e(t,i){if(!i)V(t,4,this.length);return n.read(this,t,true,23,4)};u.prototype.readFloatBE=function e(t,i){if(!i)V(t,4,this.length);return n.read(this,t,false,23,4)};u.prototype.readDoubleLE=function e(t,i){if(!i)V(t,8,this.length);return n.read(this,t,true,52,8)};u.prototype.readDoubleBE=function e(t,i){if(!i)V(t,8,this.length);return n.read(this,t,false,52,8)};function q(e,t,i,r,n,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<o)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}u.prototype.writeUIntLE=function e(t,i,r,n){t=+t;i=i|0;r=r|0;if(!n){var o=Math.pow(2,8*r)-1;q(this,t,i,r,o,0)}var a=1;var s=0;this[i]=t&255;while(++s<r&&(a*=256)){this[i+s]=t/a&255}return i+r};u.prototype.writeUIntBE=function e(t,i,r,n){t=+t;i=i|0;r=r|0;if(!n){var o=Math.pow(2,8*r)-1;q(this,t,i,r,o,0)}var a=r-1;var s=1;this[i+a]=t&255;while(--a>=0&&(s*=256)){this[i+a]=t/s&255}return i+r};u.prototype.writeUInt8=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,1,255,0);if(!u.TYPED_ARRAY_SUPPORT)t=Math.floor(t);this[i]=t&255;return i+1};function H(e,t,i,r){if(t<0)t=65535+t+1;for(var n=0,o=Math.min(e.length-i,2);n<o;++n){e[i+n]=(t&255<<8*(r?n:1-n))>>>(r?n:1-n)*8}}u.prototype.writeUInt16LE=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,2,65535,0);if(u.TYPED_ARRAY_SUPPORT){this[i]=t&255;this[i+1]=t>>>8}else{H(this,t,i,true)}return i+2};u.prototype.writeUInt16BE=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,2,65535,0);if(u.TYPED_ARRAY_SUPPORT){this[i]=t>>>8;this[i+1]=t&255}else{H(this,t,i,false)}return i+2};function U(e,t,i,r){if(t<0)t=4294967295+t+1;for(var n=0,o=Math.min(e.length-i,4);n<o;++n){e[i+n]=t>>>(r?n:3-n)*8&255}}u.prototype.writeUInt32LE=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,4,4294967295,0);if(u.TYPED_ARRAY_SUPPORT){this[i+3]=t>>>24;this[i+2]=t>>>16;this[i+1]=t>>>8;this[i]=t&255}else{U(this,t,i,true)}return i+4};u.prototype.writeUInt32BE=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,4,4294967295,0);if(u.TYPED_ARRAY_SUPPORT){this[i]=t>>>24;this[i+1]=t>>>16;this[i+2]=t>>>8;this[i+3]=t&255}else{U(this,t,i,false)}return i+4};u.prototype.writeIntLE=function e(t,i,r,n){t=+t;i=i|0;if(!n){var o=Math.pow(2,8*r-1);q(this,t,i,r,o-1,-o)}var a=0;var s=1;var l=0;this[i]=t&255;while(++a<r&&(s*=256)){if(t<0&&l===0&&this[i+a-1]!==0){l=1}this[i+a]=(t/s>>0)-l&255}return i+r};u.prototype.writeIntBE=function e(t,i,r,n){t=+t;i=i|0;if(!n){var o=Math.pow(2,8*r-1);q(this,t,i,r,o-1,-o)}var a=r-1;var s=1;var l=0;this[i+a]=t&255;while(--a>=0&&(s*=256)){if(t<0&&l===0&&this[i+a+1]!==0){l=1}this[i+a]=(t/s>>0)-l&255}return i+r};u.prototype.writeInt8=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,1,127,-128);if(!u.TYPED_ARRAY_SUPPORT)t=Math.floor(t);if(t<0)t=255+t+1;this[i]=t&255;return i+1};u.prototype.writeInt16LE=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,2,32767,-32768);if(u.TYPED_ARRAY_SUPPORT){this[i]=t&255;this[i+1]=t>>>8}else{H(this,t,i,true)}return i+2};u.prototype.writeInt16BE=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,2,32767,-32768);if(u.TYPED_ARRAY_SUPPORT){this[i]=t>>>8;this[i+1]=t&255}else{H(this,t,i,false)}return i+2};u.prototype.writeInt32LE=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,4,2147483647,-2147483648);if(u.TYPED_ARRAY_SUPPORT){this[i]=t&255;this[i+1]=t>>>8;this[i+2]=t>>>16;this[i+3]=t>>>24}else{U(this,t,i,true)}return i+4};u.prototype.writeInt32BE=function e(t,i,r){t=+t;i=i|0;if(!r)q(this,t,i,4,2147483647,-2147483648);if(t<0)t=4294967295+t+1;if(u.TYPED_ARRAY_SUPPORT){this[i]=t>>>24;this[i+1]=t>>>16;this[i+2]=t>>>8;this[i+3]=t&255}else{U(this,t,i,false)}return i+4};function B(e,t,i,r,n,o){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function z(e,t,i,r,o){if(!o){B(e,t,i,4,3.4028234663852886e38,-3.4028234663852886e38)}n.write(e,t,i,r,23,4);return i+4}u.prototype.writeFloatLE=function e(t,i,r){return z(this,t,i,true,r)};u.prototype.writeFloatBE=function e(t,i,r){return z(this,t,i,false,r)};function j(e,t,i,r,o){if(!o){B(e,t,i,8,1.7976931348623157e308,-1.7976931348623157e308)}n.write(e,t,i,r,52,8);return i+8}u.prototype.writeDoubleLE=function e(t,i,r){return j(this,t,i,true,r)};u.prototype.writeDoubleBE=function e(t,i,r){return j(this,t,i,false,r)};u.prototype.copy=function e(t,i,r,n){if(!r)r=0;if(!n&&n!==0)n=this.length;if(i>=t.length)i=t.length;if(!i)i=0;if(n>0&&n<r)n=r;if(n===r)return 0;if(t.length===0||this.length===0)return 0;if(i<0){throw new RangeError("targetStart out of bounds")}if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");if(n>this.length)n=this.length;if(t.length-i<n-r){n=t.length-i+r}var o=n-r;var a;if(this===t&&r<i&&i<n){for(a=o-1;a>=0;--a){t[a+i]=this[a+r]}}else if(o<1e3||!u.TYPED_ARRAY_SUPPORT){for(a=0;a<o;++a){t[a+i]=this[a+r]}}else{Uint8Array.prototype.set.call(t,this.subarray(r,r+o),i)}return o};u.prototype.fill=function e(t,i,r,n){if(typeof t==="string"){if(typeof i==="string"){n=i;i=0;r=this.length}else if(typeof r==="string"){n=r;r=this.length}if(t.length===1){var o=t.charCodeAt(0);if(o<256){t=o}}if(n!==undefined&&typeof n!=="string"){throw new TypeError("encoding must be a string")}if(typeof n==="string"&&!u.isEncoding(n)){throw new TypeError("Unknown encoding: "+n)}}else if(typeof t==="number"){t=t&255}if(i<0||this.length<i||this.length<r){throw new RangeError("Out of range index")}if(r<=i){return this}i=i>>>0;r=r===undefined?this.length:r>>>0;if(!t)t=0;var a;if(typeof t==="number"){for(a=i;a<r;++a){this[a]=t}}else{var s=u.isBuffer(t)?t:Y(new u(t,n).toString());var l=s.length;for(a=0;a<r-i;++a){this[a+i]=s[a%l]}}return this};var G=/[^+\/0-9A-Za-z-_]/g;function W(e){e=Q(e).replace(G,"");if(e.length<2)return"";while(e.length%4!==0){e=e+"="}return e}function Q(e){if(e.trim)return e.trim();return e.replace(/^\s+|\s+$/g,"")}function K(e){if(e<16)return"0"+e.toString(16);return e.toString(16)}function Y(e,t){t=t||Infinity;var i;var r=e.length;var n=null;var o=[];for(var a=0;a<r;++a){i=e.charCodeAt(a);if(i>55295&&i<57344){if(!n){if(i>56319){if((t-=3)>-1)o.push(239,191,189);continue}else if(a+1===r){if((t-=3)>-1)o.push(239,191,189);continue}n=i;continue}if(i<56320){if((t-=3)>-1)o.push(239,191,189);n=i;continue}i=(n-55296<<10|i-56320)+65536}else if(n){if((t-=3)>-1)o.push(239,191,189)}n=null;if(i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,i&63|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,i&63|128)}else if(i<1114112){if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else{throw new Error("Invalid code point")}}return o}function X(e){var t=[];for(var i=0;i<e.length;++i){t.push(e.charCodeAt(i)&255)}return t}function J(e,t){var i,r,n;var o=[];for(var a=0;a<e.length;++a){if((t-=2)<0)break;i=e.charCodeAt(a);r=i>>8;n=i%256;o.push(n);o.push(r)}return o}function Z(e){return r.toByteArray(W(e))}function ee(e,t,i,r){for(var n=0;n<r;++n){if(n+i>=t.length||n>=e.length)break;t[n+i]=e[n]}return n}function te(e){return e!==e}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":3,ieee754:40,isarray:44}],6:[function(e,i,r){(function(){"use strict";var e={}.hasOwnProperty;function r(){var t=[];for(var i=0;i<arguments.length;i++){var n=arguments[i];if(!n)continue;var o=typeof n;if(o==="string"||o==="number"){t.push(n)}else if(Array.isArray(n)){t.push(r.apply(null,n))}else if(o==="object"){for(var a in n){if(e.call(n,a)&&n[a]){t.push(a)}}}}return t.join(" ")}if(typeof i!=="undefined"&&i.exports){i.exports=r}else if(typeof t==="function"&&typeof t.amd==="object"&&t.amd){t("classnames",[],function(){return r})}else{window.classNames=r}})()},{}],7:[function(e,t,i){if(typeof t!=="undefined"){t.exports=r}function r(e){if(e)return n(e)}function n(e){for(var t in r.prototype){e[t]=r.prototype[t]}return e}r.prototype.on=r.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t);return this};r.prototype.once=function(e,t){function i(){this.off(e,i);t.apply(this,arguments)}i.fn=t;this.on(e,i);return this};r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length){delete this._callbacks["$"+e];return this}var r;for(var n=0;n<i.length;n++){r=i[n];if(r===t||r.fn===t){i.splice(n,1);break}}return this};r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),i=this._callbacks["$"+e];if(i){i=i.slice(0);for(var r=0,n=i.length;r<n;++r){i[r].apply(this,t)}}return this};r.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks["$"+e]||[]};r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],8:[function(e,t,i){"use strict";t.exports={Checkbox:e("./src/checkbox"),TextInput:e("./src/text_input"),TextArea:e("./src/textarea"),Dropdown:e("./src/dropdown"),BooleanDropdown:e("./src/boolean_dropdown"),Link:e("./src/link"),Mouseover:e("./src/mouseover"),Image:e("./src/image")}},{"./src/boolean_dropdown":9,"./src/checkbox":10,"./src/dropdown":11,"./src/image":13,"./src/link":14,"./src/mouseover":15,"./src/text_input":16,"./src/textarea":17}],9:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("./dropdown");var a=r.createClass({displayName:"BooleanDropdown",propTypes:{id:n.string,selectedValue:n.any,readOnly:n.bool,onChange:n.func},render:function(){return r.createElement(o,{id:this.props.id,selectedValue:this.props.selectedValue,options:[{value:true,label:"True"},{value:false,label:"False"},{value:undefined,label:"Â "}],readOnly:this.props.readOnly,onChange:this.props.onChange})}});t.exports=a},{"./dropdown":11,react:"react"}],10:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("lodash");var a=e("classnames");var s=r.createClass({displayName:"Checkbox",propTypes:{id:n.string,label:n.string,checked:n.bool,readOnly:n.bool,disabled:n.bool,onChange:n.func},getInitialState:function(){return{id:this.props.id||"cb_"+Math.random().toString(36).substr(2,10),checked:!!this.props.checked}},componentWillReceiveProps:function(e){this.setState({id:e.id||this.state.id,checked:e.checked})},handleChange:function(){this.setState({checked:!this.state.checked});if(this.props.onChange){this.props.onChange(!this.state.checked)}},handleLabelKeyDown:function(e){if(e.keyCode===32){this.handleChange()}},isChecked:function(){return this.state.checked},render:function(){return r.DOM.span({className:a({"lb-checkbox":true,disabled:this.props.disabled})},r.DOM.input({id:this.state.id,type:"checkbox",checked:!!this.state.checked,onChange:!this.props.disabled&&!this.props.readOnly?this.handleChange:o.noop}),r.DOM.label({htmlFor:this.state.id,tabIndex:0,onKeyDown:this.handleLabelKeyDown},r.DOM.span({className:"lb-checkbox-icon"},this.state.checked?r.DOM.i({className:"fa fa-check lb-check-icon"}):null),r.DOM.span({className:"lb-checkbox-label"},this.props.label)))}});t.exports=s},{classnames:6,lodash:70,react:"react"}],11:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("lodash");var a=e("react-virtualized-select").default;var s=e("react-select-fast-filter-options").default;var l=r.createClass({displayName:"Dropdown",propTypes:{id:n.string,selectedValue:n.any,options:n.array.isRequired,readOnly:n.bool,disabled:n.bool,placeholder:n.string,noResultsText:n.string,onChange:n.func},getInitialState:function(){return{filterOptions:s({options:this.props.options}),id:this.props.id||"dd_"+Math.random().toString(36).substr(2,10),selectedValue:this.props.selectedValue}},getDefaultProps:function(){return{placeholder:"",noResultsText:"No matching items"}},componentWillReceiveProps:function(e){this.setState({filterOptions:s({options:this.props.options}),id:e.id||this.state.id,selectedValue:e.selectedValue})},handleChange:function(e){this.setState({selectedValue:e.value});if(this.props.onChange){this.props.onChange(e.value)}},getSelectedValue:function(){return this.state.selectedValue},render:function(){var e={clearable:false,name:this.state.id,value:this.state.selectedValue,options:this.props.options,placeholder:this.props.placeholder,disabled:this.props.disabled,onChange:!this.props.disabled&&!this.props.readOnly?this.handleChange:o.noop,filterOptions:this.state.filterOptions};return r.createElement(a,e)}});t.exports=l},{lodash:70,react:"react","react-select-fast-filter-options":158,"react-virtualized-select":181}],12:[function(e,t,i){"use strict";var r=e("classnames");var n=e("lodash");var o=e("react");var a=o.PropTypes;t.exports=function(e,t){t=t||{};var i=o.createClass({displayName:"EditableText"+(e.displayName||e),propTypes:{value:a.oneOfType([a.string,a.number]),formattedValue:a.oneOfType([a.string,a.number]),allowInvalid:a.bool,className:a.string,focused:a.bool,helpText:a.string,update:a.func,updateOn:a.oneOf(["change","blur"]),validate:a.func,validateOn:a.oneOf(["change","blur"])},getDefaultProps:function(){return{value:"",focused:false,updateOn:"change",validateOn:"change",allowInvalid:true}},getInitialState:function(){return{value:this.props.value,focused:this.props.focused}},componentDidMount:function(){this.props.focused&&this.refs.innerCmp.focus()},componentWillReceiveProps:function(e){if(!this.state.focused&&this.state.value!==e.value){this.setState(n.extend({value:e.value,error:undefined},this.validate(e.value)))}},validate:function(e){return this.props.validate&&this.props.validate(e)||{}},validateOn:function(e,t){return this.props.validateOn===t?this.validate(e):{}},validateOnChange:function(e){return this.validateOn(e,"change")},validateOnBlur:function(){return this.validateOn(this.refs.innerCmp.value,"blur")},callUpdateOnChange:function(e){this.update(e,"change","change")},callUpdateOnBlur:function(){this.update(this.refs.innerCmp.value,"blur","blur")},update:function(e,t){if(this.props.update&&this.props.updateOn===t){var i=this.validate(e);if(e!=this.props.value&&(!i.error||this.props.allowInvalid)){this.props.update(e)}}},onChange:function(e){if(this.props.disabled||this.props.readOnly){return}var t=e.target.value,i=n.extend({value:t,error:undefined},this.validateOnChange(t));this.setState(i);this.callUpdateOnChange(t)},onFocus:function(){this.setState({focused:true});this.setSelection()},setSelection:function(){var e=this.state.value.length;this.refs.innerCmp.setSelectionRange(e,e)},onBlur:function(){if(this.props.disabled||this.props.readOnly){return}var e=n.extend({focused:false},this.validateOnBlur());this.setState(e);this.callUpdateOnBlur()},isFocused:function(){return!this.props.readOnly&&!this.props.disabled&&this.state.focused},getDisplayedValue:function(){return this.isFocused()||!this.props.formattedValue||this.state.error?this.state.value:this.props.formattedValue},render:function(){var a=r({"lb-text-control":true,invalid:this.state.error},t.className,this.props.className),s=n.omit(this.props,n.keys(i.propTypes));s=n.extend(s,t,{ref:"innerCmp",className:a,value:this.getDisplayedValue(),onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange});return o.DOM.div({className:"lb-text-control-wrapper"},o.createElement(e,s),o.DOM.span({className:r({invalid:this.state.error},"lb-field-help-text")},this.state.error&&this.state.error.message||this.props.helpText||" "))}});return i}},{classnames:6,lodash:70,react:"react"}],13:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("./text_input");var a=e("./link");var s=r.createClass({displayName:"Image",propTypes:{value:r.PropTypes.any,readOnly:n.bool,disabled:n.bool,allowInvalid:n.bool,previewEnabled:n.bool,onChange:n.func},getInitialState:function(){return{value:this.props.value}},componentWillReceiveProps:function(e){if(e.value!==this.props.value){this.setState({value:e.value,imageSuccess:undefined,imageError:undefined})}},handleChange:function(e){this.setState({value:e,imageSuccess:undefined,imageError:undefined});if(this.props.onChange){this.props.onChange(e)}},handleImageLoad:function(){this.setState({imageSuccess:true})},handleImageError:function(){this.setState({imageError:true})},render:function(){var e=null;if(this.state.value&&!a.validateUrl(this.state.value).error){if(this.state.imageSuccess){e=r.DOM.img({src:this.state.value,className:"lb-image-img"})}else if(this.state.imageError){e=r.DOM.span(null,"The requested image doesn't exist.")}else{e=[r.DOM.img({key:"image",src:this.state.value,className:"lb-image-img hidden",onLoad:this.handleImageLoad,onError:this.handleImageError}),r.DOM.span({className:"lb-image-loading",key:"loading"},r.DOM.i({className:"fa fa-spinner fa-spin"}),"loading...")]}}return r.DOM.div({className:"lb-image"},r.createElement(o,{placeholder:"URL",value:this.state.value,updateOn:"blur",update:this.handleChange,validate:a.validateUrl,readOnly:this.props.readOnly,disabled:this.props.disabled,allowInvalid:this.props.allowInvalid}),this.props.previewEnabled&&e&&r.DOM.div({className:"lb-image-img-wrapper"},e))}});t.exports=s},{"./link":14,"./text_input":16,react:"react"}],14:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("lodash");var a=e("is-url-superb");var s=e("./text_input");var l=r.createClass({displayName:"Link",propTypes:{value:r.PropTypes.any,previewEnabled:r.PropTypes.bool,readOnly:n.bool,disabled:n.bool,allowInvalid:n.bool,onChange:n.func},getInitialState:function(e){e=e||this.props;return{value:l.parseValue(e.value)}},getDefaultProps:function(){return{value:{url:"",caption:""}}},componentWillReceiveProps:function(e){this.setState(this.getInitialState(e))},handleChange:function(e,t){var i={},r;i[e]=t;r=o.extend({},this.state.value,i);this.setState({value:r});if(this.props.onChange){this.props.onChange(r)}},render:function(){var e;if(this.props.previewEnabled){if(this.props.children){e=this.props.children}else{e=r.DOM.a({className:"lb-link-anchor",target:"_blank",title:this.state.caption,href:this.state.value.url},r.DOM.span({className:"lb-link-caption"},this.state.value.caption),r.DOM.i({className:"fa fa-external-link"}))}}return r.DOM.div({className:"lb-link"},r.DOM.div({className:"lb-link-row"},r.createElement(s,{ref:"urlInput",placeholder:"URL",value:this.state.value.url,updateOn:"blur",update:o.partial(this.handleChange,"url"),validate:l.validateUrl,readOnly:this.props.readOnly,disabled:this.props.disabled,allowInvalid:this.props.allowInvalid})),r.DOM.div({className:"lb-link-row"},r.createElement(s,{ref:"captionInput",placeholder:"Caption",value:this.state.value.caption,updateOn:"blur",update:o.partial(this.handleChange,"caption"),readOnly:this.props.readOnly,disabled:this.props.disabled,allowInvalid:this.props.allowInvalid})),r.DOM.div({className:"lb-link-row"},e))},statics:{parseValue:function(e){return o.isString(e)?{url:e,caption:""}:e},validateUrl:function(e){var t={};if(!o.isString(e)){return false}if(a(e)||a(window.location.origin+e)||!e){t.value=e}else{t.error={message:"invalid URL"}}return t}}});t.exports=l},{"./text_input":16,"is-url-superb":43,lodash:70,react:"react"}],15:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("react-tooltip");var a=e("./link");var s=r.createClass({displayName:"Mouseover",propTypes:{value:r.PropTypes.any,readOnly:n.bool,disabled:n.bool,allowInvalid:n.bool,previewEnabled:n.bool,onChange:n.func},getInitialState:function(e){e=e||this.props;return{tooltipId:"mo_"+Math.random().toString(36).substr(2,10),value:a.parseValue(e.value),imageSuccess:undefined,imageError:undefined}},getDefaultProps:function(){return{value:{url:"",caption:""}}},componentWillReceiveProps:function(e){this.setState(this.getInitialState(e))},handleChange:function(e){this.setState({value:e,imageSuccess:undefined,imageError:undefined});if(this.props.onChange){this.props.onChange(e)}},handleImageLoad:function(){this.setState({imageSuccess:true})},handleImageError:function(){this.setState({imageError:true})},showTooltip:function(){this.setState({hover:true})},hideTooltip:function(){this.setState({hover:false})},componentDidUpdate:function(){var e=this;o.hide(this.refs.anchor);o.rebuild(this.refs.anchor);if(this.state.hover){setTimeout(function(){o.show(e.refs.anchor)})}},render:function(){var e=a.validateUrl(this.state.value.url),t,i;if(!e.error){if(this.state.imageSuccess){t=r.DOM.img({className:"lb-mouseover-img",alt:this.state.value.caption,src:this.state.value.url})}else if(this.state.imageError){t=r.DOM.span({className:"lb-mouseover-dont-exist"},"The requested image doesn't exist.")}else{t=[r.DOM.img({className:"lb-mouseover-img hidden",key:"image",alt:this.state.value.caption,src:this.state.value.url,onLoad:this.handleImageLoad,onError:this.handleImageError}),r.DOM.span({className:"lb-mouseover-loading",key:"loading"},r.DOM.i({className:"fa fa-spinner fa-spin"}),"loading...")]}i=r.DOM.span(null,r.DOM.a({ref:"anchor",className:"lb-link-anchor",title:this.state.caption,target:"_blank",href:this.state.value.url,"data-tip":"","data-for":this.state.tooltipId,onMouseEnter:this.showTooltip,onMouseLeave:this.hideTooltip,onFocus:this.showTooltip,onBlur:this.hideTooltip},r.DOM.span({className:"lb-link-caption"},this.state.value.caption),r.DOM.i({className:"fa fa-picture-o"})),r.createElement(o,{id:this.state.tooltipId,type:"light",border:true,effect:"solid",class:"lb-mouseover-tooltip",event:"none"},r.DOM.div({className:"lb-mouseover-img-wrapper"},t)))}return r.createElement(a,{value:this.state.value,readOnly:this.props.readOnly,disabled:this.props.disabled,onChange:this.handleChange,previewEnabled:this.props.previewEnabled,allowInvalid:this.props.allowInvalid},i)}});t.exports=s},{"./link":14,react:"react","react-tooltip":174}],16:[function(e,t,i){"use strict";var r=e("react");var n=e("./editable_text");t.exports=n("input",{type:"text",className:"lb-text-input"})},{"./editable_text":12,react:"react"}],17:[function(e,t,i){"use strict";var r=e("react");var n=e("./editable_text");t.exports=n("textarea",{className:"lb-textarea"})},{"./editable_text":12,react:"react"}],18:[function(e,t,i){"use strict";t.exports=!!(typeof window!=="undefined"&&window.document&&window.document.createElement)},{}],19:[function(e,t,i){"use strict";var r=e("./inDOM");var n;t.exports=function(e){if(!n||e){if(r){var t=document.createElement("div");t.style.position="absolute";t.style.top="-9999px";t.style.width="50px";t.style.height="50px";t.style.overflow="scroll";document.body.appendChild(t);n=t.offsetWidth-t.clientWidth;document.body.removeChild(t)}}return n}},{"./inDOM":18}],20:[function(e,i,r){(function(e,n){(function(e,n){if(typeof t==="function"&&t.amd){t(n)}else if(typeof r==="object"){i.exports=n()}else{e.returnExports=n()}})(this,function(){"use strict";var t=Function.call.bind(Function.apply);var i=Function.call.bind(Function.call);var r=Array.isArray;var o=Object.keys;var a=function e(i){return function e(){return!t(i,this,arguments)}};var s=function(e){try{e();return false}catch(e){return true}};var l=function e(t){try{return t()}catch(e){return false}};var u=a(s);var c=function(){return!s(function(){Object.defineProperty({},"x",{get:function(){}})})};var d=!!Object.defineProperty&&c();var p=function e(){}.name==="foo";var f=Function.call.bind(Array.prototype.forEach);var h=Function.call.bind(Array.prototype.reduce);var g=Function.call.bind(Array.prototype.filter);var m=Function.call.bind(Array.prototype.some);var v=function(e,t,i,r){if(!r&&t in e){return}if(d){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:i})}else{e[t]=i}};var y=function(e,t,i){f(o(t),function(r){var n=t[r];v(e,r,n,!!i)})};var b=Function.call.bind(Object.prototype.toString);var w=typeof/abc/==="function"?function e(t){return typeof t==="function"&&b(t)==="[object Function]"}:function e(t){return typeof t==="function"};var C={getter:function(e,t,i){if(!d){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:i})},proxy:function(e,t,i){if(!d){throw new TypeError("getters require true ES5 support")}var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,{configurable:r.configurable,enumerable:r.enumerable,get:function i(){return e[t]},set:function i(r){e[t]=r}})},redefine:function(e,t,i){if(d){var r=Object.getOwnPropertyDescriptor(e,t);r.value=i;Object.defineProperty(e,t,r)}else{e[t]=i}},defineByDescriptor:function(e,t,i){if(d){Object.defineProperty(e,t,i)}else if("value"in i){e[t]=i.value}},preserveToString:function(e,t){if(t&&w(t.toString)){v(e,"toString",t.toString.bind(t),true)}}};var E=Object.create||function(e,t){var i=function e(){};i.prototype=e;var r=new i;if(typeof t!=="undefined"){o(t).forEach(function(e){C.defineByDescriptor(r,e,t[e])})}return r};var S=function(e,t){if(!Object.setPrototypeOf){return false}return l(function(){var i=function t(i){var r=new e(i);Object.setPrototypeOf(r,t.prototype);return r};Object.setPrototypeOf(i,e);i.prototype=E(e.prototype,{constructor:{value:i}});return t(i)})};var T=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof n!=="undefined"){return n}throw new Error("unable to locate global object")};var x=T();var _=x.isFinite;var M=Function.call.bind(String.prototype.indexOf);var A=Function.apply.bind(Array.prototype.indexOf);var I=Function.call.bind(Array.prototype.concat);var O=Function.call.bind(String.prototype.slice);var D=Function.call.bind(Array.prototype.push);var N=Function.apply.bind(Array.prototype.push);var R=Function.call.bind(Array.prototype.shift);var P=Math.max;var L=Math.min;var k=Math.floor;var $=Math.abs;var F=Math.exp;var V=Math.log;var q=Math.sqrt;var H=Function.call.bind(Object.prototype.hasOwnProperty);var U;var B=function(){};var z=x.Symbol||{};var j=z.species||"@@species";var G=Number.isNaN||function e(t){return t!==t};var W=Number.isFinite||function e(t){return typeof t==="number"&&_(t)};var Q=w(Math.sign)?Math.sign:function e(t){var i=Number(t);if(i===0){return i}if(G(i)){return i}return i<0?-1:1};var K=function e(t){return b(t)==="[object Arguments]"};var Y=function e(t){return t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&b(t)!=="[object Array]"&&b(t.callee)==="[object Function]";
};var X=K(arguments)?K:Y;var J={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return b(e)==="[object String]"},regex:function(e){return b(e)==="[object RegExp]"},symbol:function(e){return typeof x.Symbol==="function"&&typeof e==="symbol"}};var Z=function e(t,i,r){var n=t[i];v(t,i,r,true);C.preserveToString(t[i],n)};var ee=typeof z==="function"&&typeof z["for"]==="function"&&J.symbol(z());var te=J.symbol(z.iterator)?z.iterator:"_es6-shim iterator_";if(x.Set&&typeof(new x.Set)["@@iterator"]==="function"){te="@@iterator"}if(!x.Reflect){v(x,"Reflect",{},true)}var ie=x.Reflect;var re=String;var ne={Call:function e(i,r){var n=arguments.length>2?arguments[2]:[];if(!ne.IsCallable(i)){throw new TypeError(i+" is not a function")}return t(i,r,n)},RequireObjectCoercible:function(e,t){if(e==null){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"},ToObject:function(e,t){return Object(ne.RequireObjectCoercible(e,t))},IsCallable:w,IsConstructor:function(e){return ne.IsCallable(e)},ToInt32:function(e){return ne.ToNumber(e)>>0},ToUint32:function(e){return ne.ToNumber(e)>>>0},ToNumber:function(e){if(b(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=ne.ToNumber(e);if(G(t)){return 0}if(t===0||!W(t)){return t}return(t>0?1:-1)*k($(t))},ToLength:function(e){var t=ne.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return G(e)&&G(t)},SameValueZero:function(e,t){return e===t||G(e)&&G(t)},IsIterable:function(e){return ne.TypeIsObject(e)&&(typeof e[te]!=="undefined"||X(e))},GetIterator:function(e){if(X(e)){return new U(e,"value")}var t=ne.GetMethod(e,te);if(!ne.IsCallable(t)){throw new TypeError("value is not an iterable")}var i=ne.Call(t,e);if(!ne.TypeIsObject(i)){throw new TypeError("bad iterator")}return i},GetMethod:function(e,t){var i=ne.ToObject(e)[t];if(i===void 0||i===null){return void 0}if(!ne.IsCallable(i)){throw new TypeError("Method not callable: "+t)}return i},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var i=ne.GetMethod(e,"return");if(i===void 0){return}var r,n;try{r=ne.Call(i,e)}catch(e){n=e}if(t){return}if(n){throw n}if(!ne.TypeIsObject(r)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ne.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=ne.IteratorNext(e);var i=ne.IteratorComplete(t);return i?false:t},Construct:function(e,t,i,r){var n=typeof i==="undefined"?e:i;if(!r&&ie.construct){return ie.construct(e,t,n)}var o=n.prototype;if(!ne.TypeIsObject(o)){o=Object.prototype}var a=E(o);var s=ne.Call(e,a,t);return ne.TypeIsObject(s)?s:a},SpeciesConstructor:function(e,t){var i=e.constructor;if(i===void 0){return t}if(!ne.TypeIsObject(i)){throw new TypeError("Bad constructor")}var r=i[j];if(r===void 0||r===null){return t}if(!ne.IsConstructor(r)){throw new TypeError("Bad @@species")}return r},CreateHTML:function(e,t,i,r){var n=ne.ToString(e);var o="<"+t;if(i!==""){var a=ne.ToString(r);var s=a.replace(/"/g,"&quot;");o+=" "+i+'="'+s+'"'}var l=o+">";var u=l+n;return u+"</"+t+">"},IsRegExp:function e(t){if(!ne.TypeIsObject(t)){return false}var i=t[z.match];if(typeof i!=="undefined"){return!!i}return J.regex(t)},ToString:function e(t){return re(t)}};if(d&&ee){var oe=function e(t){if(J.symbol(z[t])){return z[t]}var i=z["for"]("Symbol."+t);Object.defineProperty(z,t,{configurable:false,enumerable:false,writable:false,value:i});return i};if(!J.symbol(z.search)){var ae=oe("search");var se=String.prototype.search;v(RegExp.prototype,ae,function e(t){return ne.Call(se,t,[this])});var le=function e(t){var i=ne.RequireObjectCoercible(this);if(t!==null&&typeof t!=="undefined"){var r=ne.GetMethod(t,ae);if(typeof r!=="undefined"){return ne.Call(r,t,[i])}}return ne.Call(se,i,[ne.ToString(t)])};Z(String.prototype,"search",le)}if(!J.symbol(z.replace)){var ue=oe("replace");var ce=String.prototype.replace;v(RegExp.prototype,ue,function e(t,i){return ne.Call(ce,t,[this,i])});var de=function e(t,i){var r=ne.RequireObjectCoercible(this);if(t!==null&&typeof t!=="undefined"){var n=ne.GetMethod(t,ue);if(typeof n!=="undefined"){return ne.Call(n,t,[r,i])}}return ne.Call(ce,r,[ne.ToString(t),i])};Z(String.prototype,"replace",de)}if(!J.symbol(z.split)){var pe=oe("split");var fe=String.prototype.split;v(RegExp.prototype,pe,function e(t,i){return ne.Call(fe,t,[this,i])});var he=function e(t,i){var r=ne.RequireObjectCoercible(this);if(t!==null&&typeof t!=="undefined"){var n=ne.GetMethod(t,pe);if(typeof n!=="undefined"){return ne.Call(n,t,[r,i])}}return ne.Call(fe,r,[ne.ToString(t),i])};Z(String.prototype,"split",he)}var ge=J.symbol(z.match);var me=ge&&function(){var e={};e[z.match]=function(){return 42};return"a".match(e)!==42}();if(!ge||me){var ve=oe("match");var ye=String.prototype.match;v(RegExp.prototype,ve,function e(t){return ne.Call(ye,t,[this])});var be=function e(t){var i=ne.RequireObjectCoercible(this);if(t!==null&&typeof t!=="undefined"){var r=ne.GetMethod(t,ve);if(typeof r!=="undefined"){return ne.Call(r,t,[i])}}return ne.Call(ye,i,[ne.ToString(t)])};Z(String.prototype,"match",be)}}var we=function e(t,i,r){C.preserveToString(i,t);if(Object.setPrototypeOf){Object.setPrototypeOf(t,i)}if(d){f(Object.getOwnPropertyNames(t),function(e){if(e in B||r[e]){return}C.proxy(t,e,i)})}else{f(Object.keys(t),function(e){if(e in B||r[e]){return}i[e]=t[e]})}i.prototype=t.prototype;C.redefine(t.prototype,"constructor",i)};var Ce=function(){return this};var Ee=function(e){if(d&&!H(e,j)){C.getter(e,j,Ce)}};var Se=function(e,t){var i=t||function e(){return this};v(e,te,i);if(!e[te]&&J.symbol(te)){e[te]=i}};var Te=function e(t,i,r){if(d){Object.defineProperty(t,i,{configurable:true,enumerable:true,writable:true,value:r})}else{t[i]=r}};var xe=function e(t,i,r){Te(t,i,r);if(!ne.SameValue(t[i],r)){throw new TypeError("property is nonconfigurable")}};var _e=function(e,t,i,r){if(!ne.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var n=t.prototype;if(!ne.TypeIsObject(n)){n=i}var o=E(n);for(var a in r){if(H(r,a)){var s=r[a];v(o,a,s,true)}}return o};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Me=String.fromCodePoint;Z(String,"fromCodePoint",function e(t){return ne.Call(Me,this,arguments)})}var Ae={fromCodePoint:function e(t){var i=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!ne.SameValue(r,ne.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){D(i,String.fromCharCode(r))}else{r-=65536;D(i,String.fromCharCode((r>>10)+55296));D(i,String.fromCharCode(r%1024+56320))}}return i.join("")},raw:function e(t){var i=ne.ToObject(t,"bad callSite");var r=ne.ToObject(i.raw,"bad raw value");var n=r.length;var o=ne.ToLength(n);if(o<=0){return""}var a=[];var s=0;var l,u,c,d;while(s<o){l=ne.ToString(s);c=ne.ToString(r[l]);D(a,c);if(s+1>=o){break}u=s+1<arguments.length?arguments[s+1]:"";d=ne.ToString(u);D(a,d);s+=1}return a.join("")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){Z(String,"raw",Ae.raw)}y(String,Ae);var Ie=function e(t,i){if(i<1){return""}if(i%2){return e(t,i-1)+t}var r=e(t,i/2);return r+r};var Oe=Infinity;var De={repeat:function e(t){var i=ne.ToString(ne.RequireObjectCoercible(this));var r=ne.ToInteger(t);if(r<0||r>=Oe){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return Ie(i,r)},startsWith:function e(t){var i=ne.ToString(ne.RequireObjectCoercible(this));if(ne.IsRegExp(t)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=ne.ToString(t);var n;if(arguments.length>1){n=arguments[1]}var o=P(ne.ToInteger(n),0);return O(i,o,o+r.length)===r},endsWith:function e(t){var i=ne.ToString(ne.RequireObjectCoercible(this));if(ne.IsRegExp(t)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=ne.ToString(t);var n=i.length;var o;if(arguments.length>1){o=arguments[1]}var a=typeof o==="undefined"?n:ne.ToInteger(o);var s=L(P(a,0),n);return O(i,s-r.length,s)===r},includes:function e(t){if(ne.IsRegExp(t)){throw new TypeError('"includes" does not accept a RegExp')}var i=ne.ToString(t);var r;if(arguments.length>1){r=arguments[1]}return M(this,i,r)!==-1},codePointAt:function e(t){var i=ne.ToString(ne.RequireObjectCoercible(this));var r=ne.ToInteger(t);var n=i.length;if(r>=0&&r<n){var o=i.charCodeAt(r);var a=r+1===n;if(o<55296||o>56319||a){return o}var s=i.charCodeAt(r+1);if(s<56320||s>57343){return o}return(o-55296)*1024+(s-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){Z(String.prototype,"includes",De.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var Ne=s(function(){"/a/".startsWith(/a/)});var Re=l(function(){return"abc".startsWith("a",Infinity)===false});if(!Ne||!Re){Z(String.prototype,"startsWith",De.startsWith);Z(String.prototype,"endsWith",De.endsWith)}}if(ee){var Pe=l(function(){var e=/a/;e[z.match]=false;return"/a/".startsWith(e)});if(!Pe){Z(String.prototype,"startsWith",De.startsWith)}var Le=l(function(){var e=/a/;e[z.match]=false;return"/a/".endsWith(e)});if(!Le){Z(String.prototype,"endsWith",De.endsWith)}var ke=l(function(){var e=/a/;e[z.match]=false;return"/a/".includes(e)});if(!ke){Z(String.prototype,"includes",De.includes)}}y(String.prototype,De);var $e=["\t\n\v\f\r Â áá ââââ","ââââââââ¯âã\u2028","\u2029\ufeff"].join("");var Fe=new RegExp("(^["+$e+"]+)|(["+$e+"]+$)","g");var Ve=function e(){return ne.ToString(ne.RequireObjectCoercible(this)).replace(Fe,"")};var qe=["Â","â","ï¿¾"].join("");var He=new RegExp("["+qe+"]","g");var Ue=/^[\-+]0x[0-9a-f]+$/i;var Be=qe.trim().length!==qe.length;v(String.prototype,"trim",Ve,Be);var ze=function(e){return{value:e,done:arguments.length===0}};var je=function(e){ne.RequireObjectCoercible(e);this._s=ne.ToString(e);this._i=0};je.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return ze()}var i=e.charCodeAt(t);var r,n;if(i<55296||i>56319||t+1===e.length){n=1}else{r=e.charCodeAt(t+1);n=r<56320||r>57343?1:2}this._i=t+n;return ze(e.substr(t,n))};Se(je.prototype);Se(String.prototype,function(){return new je(this)});var Ge={from:function e(t){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,a;if(typeof n==="undefined"){o=false}else{if(!ne.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){a=arguments[2]}o=true}var s=typeof(X(t)||ne.GetMethod(t,te))!=="undefined";var l,u,c;if(s){u=ne.IsConstructor(r)?Object(new r):[];var d=ne.GetIterator(t);var p,f;c=0;while(true){p=ne.IteratorStep(d);if(p===false){break}f=p.value;try{if(o){f=typeof a==="undefined"?n(f,c):i(n,a,f,c)}u[c]=f}catch(e){ne.IteratorClose(d,true);throw e}c+=1}l=c}else{var h=ne.ToObject(t);l=ne.ToLength(h.length);u=ne.IsConstructor(r)?Object(new r(l)):new Array(l);var g;for(c=0;c<l;++c){g=h[c];if(o){g=typeof a==="undefined"?n(g,c):i(n,a,g,c)}xe(u,c,g)}}u.length=l;return u},of:function e(){var t=arguments.length;var i=this;var n=r(i)||!ne.IsCallable(i)?new Array(t):ne.Construct(i,[t]);for(var o=0;o<t;++o){xe(n,o,arguments[o])}n.length=t;return n}};y(Array,Ge);Ee(Array);U=function(e,t){this.i=0;this.array=e;this.kind=t};y(U.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof U)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var i=ne.ToLength(t.length);for(;e<i;e++){var r=this.kind;var n;if(r==="key"){n=e}else if(r==="value"){n=t[e]}else if(r==="entry"){n=[e,t[e]]}this.i=e+1;return ze(n)}}this.array=void 0;return ze()}});Se(U.prototype);var We=Array.of===Ge.of||function(){var e=function e(t){this.length=t};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!We){Z(Array,"of",Ge.of)}var Qe={copyWithin:function e(t,i){var r=ne.ToObject(this);var n=ne.ToLength(r.length);var o=ne.ToInteger(t);var a=ne.ToInteger(i);var s=o<0?P(n+o,0):L(o,n);var l=a<0?P(n+a,0):L(a,n);var u;if(arguments.length>2){u=arguments[2]}var c=typeof u==="undefined"?n:ne.ToInteger(u);var d=c<0?P(n+c,0):L(c,n);var p=L(d-l,n-s);var f=1;if(l<s&&s<l+p){f=-1;l+=p-1;s+=p-1}while(p>0){if(l in r){r[s]=r[l]}else{delete r[s]}l+=f;s+=f;p-=1}return r},fill:function e(t){var i;if(arguments.length>1){i=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=ne.ToObject(this);var o=ne.ToLength(n.length);i=ne.ToInteger(typeof i==="undefined"?0:i);r=ne.ToInteger(typeof r==="undefined"?o:r);var a=i<0?P(o+i,0):L(i,o);var s=r<0?o+r:r;for(var l=a;l<o&&l<s;++l){n[l]=t}return n},find:function e(t){var r=ne.ToObject(this);var n=ne.ToLength(r.length);if(!ne.IsCallable(t)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var a=0,s;a<n;a++){s=r[a];if(o){if(i(t,o,s,a,r)){return s}}else if(t(s,a,r)){return s}}},findIndex:function e(t){var r=ne.ToObject(this);var n=ne.ToLength(r.length);if(!ne.IsCallable(t)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var a=0;a<n;a++){if(o){if(i(t,o,r[a],a,r)){return a}}else if(t(r[a],a,r)){return a}}return-1},keys:function e(){return new U(this,"key")},values:function e(){return new U(this,"value")},entries:function e(){return new U(this,"entry")}};if(Array.prototype.keys&&!ne.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!ne.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[te]){y(Array.prototype,{values:Array.prototype[te]});if(J.symbol(z.unscopables)){Array.prototype[z.unscopables].values=true}}if(p&&Array.prototype.values&&Array.prototype.values.name!=="values"){var Ke=Array.prototype.values;Z(Array.prototype,"values",function e(){return ne.Call(Ke,this,arguments)});v(Array.prototype,te,Array.prototype.values,true)}y(Array.prototype,Qe);if(1/[true].indexOf(true,-0)<0){v(Array.prototype,"indexOf",function e(t){var i=A(this,arguments);if(i===0&&1/i<0){return 0}return i},true)}Se(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Se(Object.getPrototypeOf([].values()))}var Ye=function(){return l(function(){return Array.from({length:-1}).length===0})}();var Xe=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!Ye||!Xe){Z(Array,"from",Ge.from)}var Je=function(){return l(function(){return Array.from([0],void 0)})}();if(!Je){var Ze=Array.from;Z(Array,"from",function e(t){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return ne.Call(Ze,this,arguments)}else{return i(Ze,this,t)}})}var et=-(Math.pow(2,32)-1);var tt=function(e,t){var r={length:et};r[t?(r.length>>>0)-1:0]=true;return l(function(){i(e,r,function(){throw new RangeError("should not reach here")},[]);return true})};if(!tt(Array.prototype.forEach)){var it=Array.prototype.forEach;Z(Array.prototype,"forEach",function e(t){return ne.Call(it,this.length>=0?this:[],arguments)},true)}if(!tt(Array.prototype.map)){var rt=Array.prototype.map;Z(Array.prototype,"map",function e(t){return ne.Call(rt,this.length>=0?this:[],arguments)},true)}if(!tt(Array.prototype.filter)){var nt=Array.prototype.filter;Z(Array.prototype,"filter",function e(t){return ne.Call(nt,this.length>=0?this:[],arguments)},true)}if(!tt(Array.prototype.some)){var ot=Array.prototype.some;Z(Array.prototype,"some",function e(t){return ne.Call(ot,this.length>=0?this:[],arguments)},true)}if(!tt(Array.prototype.every)){var at=Array.prototype.every;Z(Array.prototype,"every",function e(t){return ne.Call(at,this.length>=0?this:[],arguments)},true)}if(!tt(Array.prototype.reduce)){var st=Array.prototype.reduce;Z(Array.prototype,"reduce",function e(t){return ne.Call(st,this.length>=0?this:[],arguments)},true)}if(!tt(Array.prototype.reduceRight,true)){var lt=Array.prototype.reduceRight;Z(Array.prototype,"reduceRight",function e(t){return ne.Call(lt,this.length>=0?this:[],arguments)},true)}var ut=Number("0o10")!==8;var ct=Number("0b10")!==2;var dt=m(qe,function(e){return Number(e+0+e)===0});if(ut||ct||dt){var pt=Number;var ft=/^0b[01]+$/i;var ht=/^0o[0-7]+$/i;var gt=ft.test.bind(ft);var mt=ht.test.bind(ht);var vt=function(e){var t;if(typeof e.valueOf==="function"){t=e.valueOf();if(J.primitive(t)){return t}}if(typeof e.toString==="function"){t=e.toString();if(J.primitive(t)){return t}}throw new TypeError("No default value")};var yt=He.test.bind(He);var bt=Ue.test.bind(Ue);var wt=function(){var e=function t(i){var r;if(arguments.length>0){r=J.primitive(i)?i:vt(i,"number")}else{r=0}if(typeof r==="string"){r=ne.Call(Ve,r);if(gt(r)){r=parseInt(O(r,2),2)}else if(mt(r)){r=parseInt(O(r,2),8)}else if(yt(r)||bt(r)){r=NaN}}var n=this;var o=l(function(){pt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new pt(r)}return pt(r)};return e}();we(pt,wt,{});y(wt,{NaN:pt.NaN,MAX_VALUE:pt.MAX_VALUE,MIN_VALUE:pt.MIN_VALUE,NEGATIVE_INFINITY:pt.NEGATIVE_INFINITY,POSITIVE_INFINITY:pt.POSITIVE_INFINITY});Number=wt;C.redefine(x,"Number",wt)}var Ct=Math.pow(2,53)-1;y(Number,{MAX_SAFE_INTEGER:Ct,MIN_SAFE_INTEGER:-Ct,EPSILON:2.220446049250313e-16,parseInt:x.parseInt,parseFloat:x.parseFloat,isFinite:W,isInteger:function e(t){return W(t)&&ne.ToInteger(t)===t},isSafeInteger:function e(t){return Number.isInteger(t)&&$(t)<=Number.MAX_SAFE_INTEGER},isNaN:G});v(Number,"parseInt",x.parseInt,Number.parseInt!==x.parseInt);if(![,1].find(function(e,t){return t===0})){Z(Array.prototype,"find",Qe.find)}if([,1].findIndex(function(e,t){return t===0})!==0){Z(Array.prototype,"findIndex",Qe.findIndex)}var Et=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var St=function e(t,i){if(d&&Et(t,i)){Object.defineProperty(t,i,{enumerable:false})}};var Tt=function e(){var t=Number(this);var i=arguments.length;var r=i-t;var n=new Array(r<0?0:r);for(var o=t;o<i;++o){n[o-t]=arguments[o]}return n};var xt=function e(t){return function e(i,r){i[r]=t[r];return i}};var _t=function(e,t){var i=o(Object(t));var r;if(ne.IsCallable(Object.getOwnPropertySymbols)){r=g(Object.getOwnPropertySymbols(Object(t)),Et(t))}return h(I(i,r||[]),xt(t),e)};var Mt={assign:function(e,t){var i=ne.ToObject(e,"Cannot convert undefined or null to object");return h(ne.Call(Tt,1,arguments),_t,i)},is:function e(t,i){return ne.SameValue(t,i)}};var At=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(At){Z(Object,"assign",Mt.assign)}y(Object,Mt);if(d){var It={setPrototypeOf:function(e,t){var r;var n=function(e,t){if(!ne.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||ne.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var o=function(e,t){n(e,t);i(r,e,t);return e};try{r=e.getOwnPropertyDescriptor(e.prototype,t).set;i(r,{},null)}catch(i){if(e.prototype!=={}[t]){return}r=function(e){this[t]=e};o.polyfill=o(o({},null),e.prototype)instanceof e}return o}(Object,"__proto__")};y(Object,It)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var i=Object.setPrototypeOf;Object.getPrototypeOf=function(i){var r=t(i);return r===e?null:r};Object.setPrototypeOf=function(t,r){var n=r===null?e:r;return i(t,n)};Object.setPrototypeOf.polyfill=false})()}var Ot=!s(function(){Object.keys("foo")});if(!Ot){var Dt=Object.keys;Z(Object,"keys",function e(t){return Dt(ne.ToObject(t))});o=Object.keys}var Nt=s(function(){Object.keys(/a/g)});if(Nt){var Rt=Object.keys;Z(Object,"keys",function e(t){if(J.regex(t)){var i=[];for(var r in t){if(H(t,r)){D(i,r)}}return i}return Rt(t)});o=Object.keys}if(Object.getOwnPropertyNames){var Pt=!s(function(){Object.getOwnPropertyNames("foo")});if(!Pt){var Lt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var kt=Object.getOwnPropertyNames;Z(Object,"getOwnPropertyNames",function e(t){var i=ne.ToObject(t);if(b(i)==="[object Window]"){try{return kt(i)}catch(e){return I([],Lt)}}return kt(i)})}}if(Object.getOwnPropertyDescriptor){var $t=!s(function(){Object.getOwnPropertyDescriptor("foo","bar")});if(!$t){var Ft=Object.getOwnPropertyDescriptor;Z(Object,"getOwnPropertyDescriptor",function e(t,i){return Ft(ne.ToObject(t),i)})}}if(Object.seal){var Vt=!s(function(){Object.seal("foo")});if(!Vt){var qt=Object.seal;Z(Object,"seal",function e(t){if(!ne.TypeIsObject(t)){return t}return qt(t)})}}if(Object.isSealed){var Ht=!s(function(){Object.isSealed("foo")});if(!Ht){var Ut=Object.isSealed;Z(Object,"isSealed",function e(t){if(!ne.TypeIsObject(t)){return true}return Ut(t)})}}if(Object.freeze){var Bt=!s(function(){Object.freeze("foo")});if(!Bt){var zt=Object.freeze;Z(Object,"freeze",function e(t){if(!ne.TypeIsObject(t)){return t}return zt(t)})}}if(Object.isFrozen){var jt=!s(function(){Object.isFrozen("foo")});if(!jt){var Gt=Object.isFrozen;Z(Object,"isFrozen",function e(t){if(!ne.TypeIsObject(t)){return true}return Gt(t)})}}if(Object.preventExtensions){var Wt=!s(function(){Object.preventExtensions("foo")});if(!Wt){var Qt=Object.preventExtensions;Z(Object,"preventExtensions",function e(t){if(!ne.TypeIsObject(t)){return t}return Qt(t)})}}if(Object.isExtensible){var Kt=!s(function(){Object.isExtensible("foo")});if(!Kt){var Yt=Object.isExtensible;Z(Object,"isExtensible",function e(t){if(!ne.TypeIsObject(t)){return false}return Yt(t)})}}if(Object.getPrototypeOf){var Xt=!s(function(){Object.getPrototypeOf("foo")});if(!Xt){var Jt=Object.getPrototypeOf;Z(Object,"getPrototypeOf",function e(t){return Jt(ne.ToObject(t))})}}var Zt=d&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&ne.IsCallable(e.get)}();if(d&&!Zt){var ei=function e(){if(!ne.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var t="";if(this.global){t+="g"}if(this.ignoreCase){t+="i"}if(this.multiline){t+="m"}if(this.unicode){t+="u"}if(this.sticky){t+="y"}return t};C.getter(RegExp.prototype,"flags",ei)}var ti=d&&l(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var ii=ee&&d&&function(){var e=/./;e[z.match]=false;return RegExp(e)===e}();var ri=l(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var ni=ri&&l(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!ri||!ni){var oi=RegExp.prototype.toString;v(RegExp.prototype,"toString",function e(){var t=ne.RequireObjectCoercible(this);if(J.regex(t)){return i(oi,t)}var r=re(t.source);var n=re(t.flags);return"/"+r+"/"+n},true);C.preserveToString(RegExp.prototype.toString,oi)}if(d&&(!ti||ii)){var ai=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var si=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var li=function(){return this.source};var ui=ne.IsCallable(si.get)?si.get:li;var ci=RegExp;var di=function(){return function e(t,i){var r=ne.IsRegExp(t);var n=this instanceof e;if(!n&&r&&typeof i==="undefined"&&t.constructor===e){return t}var o=t;var a=i;if(J.regex(t)){o=ne.Call(ui,t);a=typeof i==="undefined"?ne.Call(ai,t):i;return new e(o,a)}else if(r){o=t.source;a=typeof i==="undefined"?t.flags:i}return new ci(t,i)}}();we(ci,di,{$input:true});RegExp=di;C.redefine(x,"RegExp",di)}if(d){var pi={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};f(o(pi),function(e){if(e in RegExp&&!(pi[e]in RegExp)){C.getter(RegExp,pi[e],function t(){return RegExp[e]})}})}Ee(RegExp);var fi=1/Number.EPSILON;var hi=function e(t){return t+fi-fi};var gi=Math.pow(2,-23);var mi=Math.pow(2,127)*(2-gi);var vi=Math.pow(2,-126);var yi=Math.E;var bi=Math.LOG2E;var wi=Math.LOG10E;var Ci=Number.prototype.clz;delete Number.prototype.clz;var Ei={acosh:function e(t){var i=Number(t);if(G(i)||t<1){return NaN}if(i===1){return 0}if(i===Infinity){return i}return V(i/yi+q(i+1)*q(i-1)/yi)+1},asinh:function e(t){var i=Number(t);if(i===0||!_(i)){return i}return i<0?-e(-i):V(i+q(i*i+1))},atanh:function e(t){var i=Number(t);if(G(i)||i<-1||i>1){return NaN}if(i===-1){return-Infinity}if(i===1){return Infinity}if(i===0){return i}return.5*V((1+i)/(1-i))},cbrt:function e(t){var i=Number(t);if(i===0){return i}var r=i<0;var n;if(r){i=-i}if(i===Infinity){n=Infinity}else{n=F(V(i)/3);n=(i/(n*n)+2*n)/3}return r?-n:n},clz32:function e(t){var i=Number(t);var r=ne.ToUint32(i);if(r===0){return 32}return Ci?ne.Call(Ci,r):31-k(V(r+.5)*bi)},cosh:function e(t){var i=Number(t);if(i===0){return 1}if(G(i)){return NaN}if(!_(i)){return Infinity}if(i<0){i=-i}if(i>21){return F(i)/2}return(F(i)+F(-i))/2},expm1:function e(t){var i=Number(t);if(i===-Infinity){return-1}if(!_(i)||i===0){return i}if($(i)>.5){return F(i)-1}var r=i;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=i/o}return n},hypot:function e(t,i){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var a=$(Number(arguments[o]));if(n<a){r*=n/a*(n/a);r+=1;n=a}else{r+=a>0?a/n*(a/n):a}}return n===Infinity?Infinity:n*q(r)},log2:function e(t){return V(t)*bi},log10:function e(t){return V(t)*wi},log1p:function e(t){var i=Number(t);if(i<-1||G(i)){return NaN}if(i===0||i===Infinity){return i}if(i===-1){return-Infinity}return 1+i-1===0?i:i*(V(1+i)/(1+i-1))},sign:Q,sinh:function e(t){var i=Number(t);if(!_(i)||i===0){return i}if($(i)<1){return(Math.expm1(i)-Math.expm1(-i))/2}return(F(i-1)-F(-i-1))*yi/2},tanh:function e(t){var i=Number(t);if(G(i)||i===0){return i}if(i>=20){return 1}if(i<=-20){return-1}return(Math.expm1(i)-Math.expm1(-i))/(F(i)+F(-i))},trunc:function e(t){var i=Number(t);return i<0?-k(-i):k(i)},imul:function e(t,i){var r=ne.ToUint32(t);var n=ne.ToUint32(i);var o=r>>>16&65535;var a=r&65535;var s=n>>>16&65535;var l=n&65535;return a*l+(o*l+a*s<<16>>>0)|0},fround:function e(t){var i=Number(t);if(i===0||i===Infinity||i===-Infinity||G(i)){return i}var r=Q(i);var n=$(i);if(n<vi){return r*hi(n/vi/gi)*vi*gi}var o=(1+gi/Number.EPSILON)*n;var a=o-(o-n);if(a>mi||G(a)){return r*Infinity}return r*a}};y(Math,Ei);v(Math,"log1p",Ei.log1p,Math.log1p(-1e-17)!==-1e-17);v(Math,"asinh",Ei.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));v(Math,"tanh",Ei.tanh,Math.tanh(-2e-17)!==-2e-17);v(Math,"acosh",Ei.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);v(Math,"cbrt",Ei.cbrt,Math.abs(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON>8);v(Math,"sinh",Ei.sinh,Math.sinh(-2e-17)!==-2e-17);var Si=Math.expm1(10);v(Math,"expm1",Ei.expm1,Si>22025.465794806718||Si<22025.465794806718);var Ti=Math.round;var xi=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var _i=fi+1;var Mi=2*fi-1;var Ai=[_i,Mi].every(function(e){return Math.round(e)===e});v(Math,"round",function e(t){var i=k(t);var r=i===-1?-0:i+1;return t-i<.5?i:r},!xi||!Ai);C.preserveToString(Math.round,Ti);var Ii=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Ei.imul;C.preserveToString(Math.imul,Ii)}if(Math.imul.length!==2){Z(Math,"imul",function e(t,i){return ne.Call(Ii,Math,arguments)})}var Oi=function(){var t=x.setTimeout;if(typeof t!=="function"&&typeof t!=="object"){return}ne.IsPromise=function(e){if(!ne.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!ne.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var i=function(e,i){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=i};t.resolve=void 0;t.reject=void 0;t.promise=new e(i);if(!(ne.IsCallable(t.resolve)&&ne.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&ne.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var i=function(i){D(e,i);window.postMessage(t,"*")};var r=function(i){if(i.source===window&&i.data===t){i.stopPropagation();if(e.length===0){return}var r=R(e);r()}};window.addEventListener("message",r,true);return i}}var o=function(){var e=x.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var a=ne.IsCallable(x.setImmediate)?x.setImmediate:typeof e==="object"&&e.nextTick?e.nextTick:o()||(ne.IsCallable(n)?n():function(e){t(e,0)});var s=function(e){return e};var l=function(e){throw e};var u=0;var c=1;var d=2;var p=0;var f=1;var h=2;var g={};var m=function(e,t,i){a(function(){v(e,t,i)})};var v=function(e,t,i){var r,n;if(t===g){return e(i)}try{r=e(i);n=t.resolve}catch(e){r=e;n=t.reject}n(r)};var b=function(e,t){var i=e._promise;var r=i.reactionLength;if(r>0){m(i.fulfillReactionHandler0,i.reactionCapability0,t);i.fulfillReactionHandler0=void 0;i.rejectReactions0=void 0;i.reactionCapability0=void 0;if(r>1){for(var n=1,o=0;n<r;n++,o+=3){m(i[o+p],i[o+h],t);e[o+p]=void 0;e[o+f]=void 0;e[o+h]=void 0}}}i.result=t;i.state=c;i.reactionLength=0};var w=function(e,t){var i=e._promise;var r=i.reactionLength;if(r>0){m(i.rejectReactionHandler0,i.reactionCapability0,t);i.fulfillReactionHandler0=void 0;i.rejectReactions0=void 0;i.reactionCapability0=void 0;if(r>1){for(var n=1,o=0;n<r;n++,o+=3){m(i[o+f],i[o+h],t);e[o+p]=void 0;e[o+f]=void 0;e[o+h]=void 0}}}i.result=t;i.state=d;i.reactionLength=0};var C=function(e){var t=false;var i=function(i){var r;if(t){return}t=true;if(i===e){return w(e,new TypeError("Self resolution"))}if(!ne.TypeIsObject(i)){return b(e,i)}try{r=i.then}catch(t){return w(e,t)}if(!ne.IsCallable(r)){return b(e,i)}a(function(){S(e,i,r)})};var r=function(i){if(t){return}t=true;return w(e,i)};return{resolve:i,reject:r}};var E=function(e,t,r,n){if(e===_){i(e,t,r,n,g)}else{i(e,t,r,n)}};var S=function(e,t,i){var r=C(e);var n=r.resolve;var o=r.reject;try{E(i,t,n,o)}catch(e){o(e)}};var T,_;var M=function(){var e=function t(i){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!ne.IsCallable(i)){throw new TypeError("not a valid resolver")}var r=_e(this,e,T,{_promise:{result:void 0,state:u,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=C(r);var o=n.reject;try{i(n.resolve,o)}catch(e){o(e)}return r};return e}();T=M.prototype;var A=function(e,t,i,r){var n=false;return function(o){if(n){return}n=true;t[e]=o;if(--r.count===0){var a=i.resolve;a(t)}}};var I=function(e,t,i){var r=e.iterator;var n=[];var o={count:1};var a,s;var l=0;while(true){try{a=ne.IteratorStep(r);if(a===false){e.done=true;break}s=a.value}catch(t){e.done=true;throw t}n[l]=void 0;var u=t.resolve(s);var c=A(l,n,i,o);o.count+=1;E(u.then,u,c,i.reject);l+=1}if(--o.count===0){var d=i.resolve;d(n)}return i.promise};var O=function(e,t,i){var r=e.iterator;var n,o,a;while(true){try{n=ne.IteratorStep(r);if(n===false){e.done=true;break}o=n.value}catch(t){e.done=true;throw t}a=t.resolve(o);E(a.then,a,i.resolve,i.reject)}return i.promise};y(M,{all:function e(t){var i=this;if(!ne.TypeIsObject(i)){throw new TypeError("Promise is not object")}var n=new r(i);var o,a;try{o=ne.GetIterator(t);a={iterator:o,done:false};return I(a,i,n)}catch(e){var s=e;if(a&&!a.done){try{ne.IteratorClose(o,true)}catch(e){s=e}}var l=n.reject;l(s);return n.promise}},race:function e(t){var i=this;if(!ne.TypeIsObject(i)){throw new TypeError("Promise is not object")}var n=new r(i);var o,a;try{o=ne.GetIterator(t);a={iterator:o,done:false};return O(a,i,n)}catch(e){var s=e;if(a&&!a.done){try{ne.IteratorClose(o,true)}catch(e){s=e}}var l=n.reject;l(s);return n.promise}},reject:function e(t){var i=this;if(!ne.TypeIsObject(i)){throw new TypeError("Bad promise constructor");
}var n=new r(i);var o=n.reject;o(t);return n.promise},resolve:function e(t){var i=this;if(!ne.TypeIsObject(i)){throw new TypeError("Bad promise constructor")}if(ne.IsPromise(t)){var n=t.constructor;if(n===i){return t}}var o=new r(i);var a=o.resolve;a(t);return o.promise}});y(T,{catch:function(e){return this.then(null,e)},then:function e(t,i){var n=this;if(!ne.IsPromise(n)){throw new TypeError("not a promise")}var o=ne.SpeciesConstructor(n,M);var a;var v=arguments.length>2&&arguments[2]===g;if(v&&o===M){a=g}else{a=new r(o)}var y=ne.IsCallable(t)?t:s;var b=ne.IsCallable(i)?i:l;var w=n._promise;var C;if(w.state===u){if(w.reactionLength===0){w.fulfillReactionHandler0=y;w.rejectReactionHandler0=b;w.reactionCapability0=a}else{var E=3*(w.reactionLength-1);w[E+p]=y;w[E+f]=b;w[E+h]=a}w.reactionLength+=1}else if(w.state===c){C=w.result;m(y,a,C)}else if(w.state===d){C=w.result;m(b,a,C)}else{throw new TypeError("unexpected Promise state")}return a.promise}});g=new r(M);_=T.then;return M}();if(x.Promise){delete x.Promise.accept;delete x.Promise.defer;delete x.Promise.prototype.chain}if(typeof Oi==="function"){y(x,{Promise:Oi});var Di=S(x.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var Ni=!s(function(){x.Promise.reject(42).then(null,5).then(null,B)});var Ri=s(function(){x.Promise.call(3,B)});var Pi=function(e){var t=e.resolve(5);t.constructor={};var i=e.resolve(t);try{i.then(null,B).then(null,B)}catch(e){return true}return t===i}(x.Promise);var Li=d&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var ki=function e(t){var i=new Promise(t);t(3,function(){});this.then=i.then;this.constructor=e};ki.prototype=Promise.prototype;ki.all=Promise.all;var $i=l(function(){return!!ki.all([1,2])});if(!Di||!Ni||!Ri||Pi||!Li||$i){Promise=Oi;Z(x,"Promise",Oi)}if(Promise.all.length!==1){var Fi=Promise.all;Z(Promise,"all",function e(t){return ne.Call(Fi,this,arguments)})}if(Promise.race.length!==1){var Vi=Promise.race;Z(Promise,"race",function e(t){return ne.Call(Vi,this,arguments)})}if(Promise.resolve.length!==1){var qi=Promise.resolve;Z(Promise,"resolve",function e(t){return ne.Call(qi,this,arguments)})}if(Promise.reject.length!==1){var Hi=Promise.reject;Z(Promise,"reject",function e(t){return ne.Call(Hi,this,arguments)})}St(Promise,"all");St(Promise,"race");St(Promise,"resolve");St(Promise,"reject");Ee(Promise)}var Ui=function(e){var t=o(h(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Bi=Ui(["z","a","bb"]);var zi=Ui(["z",1,"a","3",2]);if(d){var ji=function e(t){if(!Bi){return null}if(typeof t==="undefined"||t===null){return"^"+ne.ToString(t)}else if(typeof t==="string"){return"$"+t}else if(typeof t==="number"){if(!zi){return"n"+t}return t}else if(typeof t==="boolean"){return"b"+t}return null};var Gi=function e(){return Object.create?Object.create(null):{}};var Wi=function e(t,n,o){if(r(o)||J.string(o)){f(o,function(e){if(!ne.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof t){i(t.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var a,s;if(o!==null&&typeof o!=="undefined"){s=n.set;if(!ne.IsCallable(s)){throw new TypeError("bad map")}a=ne.GetIterator(o)}if(typeof a!=="undefined"){while(true){var l=ne.IteratorStep(a);if(l===false){break}var u=l.value;try{if(!ne.TypeIsObject(u)){throw new TypeError("Iterator value "+u+" is not an entry object")}i(s,n,u[0],u[1])}catch(e){ne.IteratorClose(a,true);throw e}}}}};var Qi=function e(t,n,o){if(r(o)||J.string(o)){f(o,function(e){n.add(e)})}else if(o instanceof t){i(t.prototype.forEach,o,function(e){n.add(e)})}else{var a,s;if(o!==null&&typeof o!=="undefined"){s=n.add;if(!ne.IsCallable(s)){throw new TypeError("bad set")}a=ne.GetIterator(o)}if(typeof a!=="undefined"){while(true){var l=ne.IteratorStep(a);if(l===false){break}var u=l.value;try{i(s,n,u)}catch(e){ne.IteratorClose(a,true);throw e}}}}};var Ki={Map:function(){var e={};var t=function e(t,i){this.key=t;this.value=i;this.next=null;this.prev=null};t.prototype.isRemoved=function t(){return this.key===e};var r=function e(t){return!!t._es6map};var n=function e(t,i){if(!ne.TypeIsObject(t)||!r(t)){throw new TypeError("Method Map.prototype."+i+" called on incompatible receiver "+ne.ToString(t))}};var o=function e(t,i){n(t,"[[MapIterator]]");this.head=t._head;this.i=this.head;this.kind=i};o.prototype={next:function e(){var t=this.i;var i=this.kind;var r=this.head;if(typeof this.i==="undefined"){return ze()}while(t.isRemoved()&&t!==r){t=t.prev}var n;while(t.next!==r){t=t.next;if(!t.isRemoved()){if(i==="key"){n=t.key}else if(i==="value"){n=t.value}else{n=[t.key,t.value]}this.i=t;return ze(n)}}this.i=void 0;return ze()}};Se(o.prototype);var a;var s=function e(){if(!(this instanceof e)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var i=_e(this,e,a,{_es6map:true,_head:null,_storage:Gi(),_size:0});var r=new t(null,null);r.next=r.prev=r;i._head=r;if(arguments.length>0){Wi(e,i,arguments[0])}return i};a=s.prototype;C.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});y(a,{get:function e(t){n(this,"get");var i=ji(t);if(i!==null){var r=this._storage[i];if(r){return r.value}else{return}}var o=this._head;var a=o;while((a=a.next)!==o){if(ne.SameValueZero(a.key,t)){return a.value}}},has:function e(t){n(this,"has");var i=ji(t);if(i!==null){return typeof this._storage[i]!=="undefined"}var r=this._head;var o=r;while((o=o.next)!==r){if(ne.SameValueZero(o.key,t)){return true}}return false},set:function e(i,r){n(this,"set");var o=this._head;var a=o;var s;var l=ji(i);if(l!==null){if(typeof this._storage[l]!=="undefined"){this._storage[l].value=r;return this}else{s=this._storage[l]=new t(i,r);a=o.prev}}while((a=a.next)!==o){if(ne.SameValueZero(a.key,i)){a.value=r;return this}}s=s||new t(i,r);if(ne.SameValue(-0,i)){s.key=+0}s.next=this._head;s.prev=this._head.prev;s.prev.next=s;s.next.prev=s;this._size+=1;return this},delete:function(t){n(this,"delete");var i=this._head;var r=i;var o=ji(t);if(o!==null){if(typeof this._storage[o]==="undefined"){return false}r=this._storage[o].prev;delete this._storage[o]}while((r=r.next)!==i){if(ne.SameValueZero(r.key,t)){r.key=r.value=e;r.prev.next=r.next;r.next.prev=r.prev;this._size-=1;return true}}return false},clear:function t(){n(this,"clear");this._size=0;this._storage=Gi();var i=this._head;var r=i;var o=r.next;while((r=o)!==i){r.key=r.value=e;o=r.next;r.next=r.prev=i}i.next=i.prev=i},keys:function e(){n(this,"keys");return new o(this,"key")},values:function e(){n(this,"values");return new o(this,"value")},entries:function e(){n(this,"entries");return new o(this,"key+value")},forEach:function e(t){n(this,"forEach");var r=arguments.length>1?arguments[1]:null;var o=this.entries();for(var a=o.next();!a.done;a=o.next()){if(r){i(t,r,a.value[1],a.value[0],this)}else{t(a.value[1],a.value[0],this)}}}});Se(a,a.entries);return s}(),Set:function(){var e=function e(t){return t._es6set&&typeof t._storage!=="undefined"};var t=function t(i,r){if(!ne.TypeIsObject(i)||!e(i)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+ne.ToString(i))}};var r;var n=function e(){if(!(this instanceof e)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var t=_e(this,e,r,{_es6set:true,"[[SetData]]":null,_storage:Gi()});if(!t._es6set){throw new TypeError("bad set")}if(arguments.length>0){Qi(e,t,arguments[0])}return t};r=n.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var i=t.charAt(0);if(i==="$"){return O(t,1)}else if(i==="n"){return+O(t,1)}else if(i==="b"){return t==="btrue"}}return+t};var s=function e(t){if(!t["[[SetData]]"]){var i=t["[[SetData]]"]=new Ki.Map;f(o(t._storage),function(e){var t=a(e);i.set(t,t)});t["[[SetData]]"]=i}t._storage=null};C.getter(n.prototype,"size",function(){t(this,"size");if(this._storage){return o(this._storage).length}s(this);return this["[[SetData]]"].size});y(n.prototype,{has:function e(i){t(this,"has");var r;if(this._storage&&(r=ji(i))!==null){return!!this._storage[r]}s(this);return this["[[SetData]]"].has(i)},add:function e(i){t(this,"add");var r;if(this._storage&&(r=ji(i))!==null){this._storage[r]=true;return this}s(this);this["[[SetData]]"].set(i,i);return this},delete:function(e){t(this,"delete");var i;if(this._storage&&(i=ji(e))!==null){var r=H(this._storage,i);return delete this._storage[i]&&r}s(this);return this["[[SetData]]"]["delete"](e)},clear:function e(){t(this,"clear");if(this._storage){this._storage=Gi()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function e(){t(this,"values");s(this);return this["[[SetData]]"].values()},entries:function e(){t(this,"entries");s(this);return this["[[SetData]]"].entries()},forEach:function e(r){t(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;s(o);this["[[SetData]]"].forEach(function(e,t){if(n){i(r,n,t,t,o)}else{r(t,t,o)}})}});v(n.prototype,"keys",n.prototype.values,true);Se(n.prototype,n.prototype.values);return n}()};if(x.Map||x.Set){var Yi=l(function(){return new Map([[1,2]]).get(1)===2});if(!Yi){var Xi=x.Map;x.Map=function e(){if(!(this instanceof e)){throw new TypeError('Constructor Map requires "new"')}var t=new Xi;if(arguments.length>0){Wi(e,t,arguments[0])}delete t.constructor;Object.setPrototypeOf(t,x.Map.prototype);return t};x.Map.prototype=E(Xi.prototype);v(x.Map.prototype,"constructor",x.Map,true);C.preserveToString(x.Map,Xi)}var Ji=new Map;var Zi=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var er=Ji.set(1,2)===Ji;if(!Zi||!er){var tr=Map.prototype.set;Z(Map.prototype,"set",function e(t,r){i(tr,this,t===0?0:t,r);return this})}if(!Zi){var ir=Map.prototype.get;var rr=Map.prototype.has;y(Map.prototype,{get:function e(t){return i(ir,this,t===0?0:t)},has:function e(t){return i(rr,this,t===0?0:t)}},true);C.preserveToString(Map.prototype.get,ir);C.preserveToString(Map.prototype.has,rr)}var nr=new Set;var or=function(e){e["delete"](0);e.add(-0);return!e.has(0)}(nr);var ar=nr.add(1)===nr;if(!or||!ar){var sr=Set.prototype.add;Set.prototype.add=function e(t){i(sr,this,t===0?0:t);return this};C.preserveToString(Set.prototype.add,sr)}if(!or){var lr=Set.prototype.has;Set.prototype.has=function e(t){return i(lr,this,t===0?0:t)};C.preserveToString(Set.prototype.has,lr);var ur=Set.prototype["delete"];Set.prototype["delete"]=function e(t){return i(ur,this,t===0?0:t)};C.preserveToString(Set.prototype["delete"],ur)}var cr=S(x.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var dr=Object.setPrototypeOf&&!cr;var pr=function(){try{return!(x.Map()instanceof x.Map)}catch(e){return e instanceof TypeError}}();if(x.Map.length!==0||dr||!pr){var fr=x.Map;x.Map=function e(){if(!(this instanceof e)){throw new TypeError('Constructor Map requires "new"')}var t=new fr;if(arguments.length>0){Wi(e,t,arguments[0])}delete t.constructor;Object.setPrototypeOf(t,e.prototype);return t};x.Map.prototype=fr.prototype;v(x.Map.prototype,"constructor",x.Map,true);C.preserveToString(x.Map,fr)}var hr=S(x.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var gr=Object.setPrototypeOf&&!hr;var mr=function(){try{return!(x.Set()instanceof x.Set)}catch(e){return e instanceof TypeError}}();if(x.Set.length!==0||gr||!mr){var vr=x.Set;x.Set=function e(){if(!(this instanceof e)){throw new TypeError('Constructor Set requires "new"')}var t=new vr;if(arguments.length>0){Qi(e,t,arguments[0])}delete t.constructor;Object.setPrototypeOf(t,e.prototype);return t};x.Set.prototype=vr.prototype;v(x.Set.prototype,"constructor",x.Set,true);C.preserveToString(x.Set,vr)}var yr=new x.Map;var br=!l(function(){return yr.keys().next().done});if(typeof x.Map.prototype.clear!=="function"||(new x.Set).size!==0||yr.size!==0||typeof x.Map.prototype.keys!=="function"||typeof x.Set.prototype.keys!=="function"||typeof x.Map.prototype.forEach!=="function"||typeof x.Set.prototype.forEach!=="function"||u(x.Map)||u(x.Set)||typeof yr.keys().next!=="function"||br||!cr){y(x,{Map:Ki.Map,Set:Ki.Set},true)}if(x.Set.prototype.keys!==x.Set.prototype.values){v(x.Set.prototype,"keys",x.Set.prototype.values,true)}Se(Object.getPrototypeOf((new x.Map).keys()));Se(Object.getPrototypeOf((new x.Set).keys()));if(p&&x.Set.prototype.has.name!=="has"){var wr=x.Set.prototype.has;Z(x.Set.prototype,"has",function e(t){return i(wr,this,t)})}}y(x,Ki);Ee(x.Map);Ee(x.Set)}var Cr=function e(t){if(!ne.TypeIsObject(t)){throw new TypeError("target must be an object")}};var Er={apply:function e(){return ne.Call(ne.Call,null,arguments)},construct:function e(t,i){if(!ne.IsConstructor(t)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:t;if(!ne.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return ne.Construct(t,i,r,"internal")},deleteProperty:function e(t,i){Cr(t);if(d){var r=Object.getOwnPropertyDescriptor(t,i);if(r&&!r.configurable){return false}}return delete t[i]},has:function e(t,i){Cr(t);return i in t}};if(Object.getOwnPropertyNames){Object.assign(Er,{ownKeys:function e(t){Cr(t);var i=Object.getOwnPropertyNames(t);if(ne.IsCallable(Object.getOwnPropertySymbols)){N(i,Object.getOwnPropertySymbols(t))}return i}})}var Sr=function e(t){return!s(t)};if(Object.preventExtensions){Object.assign(Er,{isExtensible:function e(t){Cr(t);return Object.isExtensible(t)},preventExtensions:function e(t){Cr(t);return Sr(function(){Object.preventExtensions(t)})}})}if(d){var Tr=function e(t,i,r){var n=Object.getOwnPropertyDescriptor(t,i);if(!n){var o=Object.getPrototypeOf(t);if(o===null){return void 0}return Tr(o,i,r)}if("value"in n){return n.value}if(n.get){return ne.Call(n.get,r)}return void 0};var xr=function e(t,r,n,o){var a=Object.getOwnPropertyDescriptor(t,r);if(!a){var s=Object.getPrototypeOf(t);if(s!==null){return xr(s,r,n,o)}a={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in a){if(!a.writable){return false}if(!ne.TypeIsObject(o)){return false}var l=Object.getOwnPropertyDescriptor(o,r);if(l){return ie.defineProperty(o,r,{value:n})}else{return ie.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(a.set){i(a.set,o,n);return true}return false};Object.assign(Er,{defineProperty:function e(t,i,r){Cr(t);return Sr(function(){Object.defineProperty(t,i,r)})},getOwnPropertyDescriptor:function e(t,i){Cr(t);return Object.getOwnPropertyDescriptor(t,i)},get:function e(t,i){Cr(t);var r=arguments.length>2?arguments[2]:t;return Tr(t,i,r)},set:function e(t,i,r){Cr(t);var n=arguments.length>3?arguments[3]:t;return xr(t,i,r,n)}})}if(Object.getPrototypeOf){var _r=Object.getPrototypeOf;Er.getPrototypeOf=function e(t){Cr(t);return _r(t)}}if(Object.setPrototypeOf&&Er.getPrototypeOf){var Mr=function(e,t){var i=t;while(i){if(e===i){return true}i=Er.getPrototypeOf(i)}return false};Object.assign(Er,{setPrototypeOf:function e(t,i){Cr(t);if(i!==null&&!ne.TypeIsObject(i)){throw new TypeError("proto must be an object or null")}if(i===ie.getPrototypeOf(t)){return true}if(ie.isExtensible&&!ie.isExtensible(t)){return false}if(Mr(t,i)){return false}Object.setPrototypeOf(t,i);return true}})}var Ar=function(e,t){if(!ne.IsCallable(x.Reflect[e])){v(x.Reflect,e,t)}else{var i=l(function(){x.Reflect[e](1);x.Reflect[e](NaN);x.Reflect[e](true);return true});if(i){Z(x.Reflect,e,t)}}};Object.keys(Er).forEach(function(e){Ar(e,Er[e])});var Ir=x.Reflect.getPrototypeOf;if(p&&Ir&&Ir.name!=="getPrototypeOf"){Z(x.Reflect,"getPrototypeOf",function e(t){return i(Ir,x.Reflect,t)})}if(x.Reflect.setPrototypeOf){if(l(function(){x.Reflect.setPrototypeOf(1,{});return true})){Z(x.Reflect,"setPrototypeOf",Er.setPrototypeOf)}}if(x.Reflect.defineProperty){if(!l(function(){var e=!x.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!x.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){Z(x.Reflect,"defineProperty",Er.defineProperty)}}if(x.Reflect.construct){if(!l(function(){var e=function e(){};return x.Reflect.construct(function(){},[],e)instanceof e})){Z(x.Reflect,"construct",Er.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var Or=Date.prototype.toString;var Dr=function e(){var t=+this;if(t!==t){return"Invalid Date"}return ne.Call(Or,this)};Z(Date.prototype,"toString",Dr)}var Nr={anchor:function e(t){return ne.CreateHTML(this,"a","name",t)},big:function e(){return ne.CreateHTML(this,"big","","")},blink:function e(){return ne.CreateHTML(this,"blink","","")},bold:function e(){return ne.CreateHTML(this,"b","","")},fixed:function e(){return ne.CreateHTML(this,"tt","","")},fontcolor:function e(t){return ne.CreateHTML(this,"font","color",t)},fontsize:function e(t){return ne.CreateHTML(this,"font","size",t)},italics:function e(){return ne.CreateHTML(this,"i","","")},link:function e(t){return ne.CreateHTML(this,"a","href",t)},small:function e(){return ne.CreateHTML(this,"small","","")},strike:function e(){return ne.CreateHTML(this,"strike","","")},sub:function e(){return ne.CreateHTML(this,"sub","","")},sup:function e(){return ne.CreateHTML(this,"sup","","")}};f(Object.keys(Nr),function(e){var t=String.prototype[e];var r=false;if(ne.IsCallable(t)){var n=i(t,"",' " ');var o=I([],n.match(/"/g)).length;r=n!==n.toLowerCase()||o>2}else{r=true}if(r){Z(String.prototype,e,Nr[e])}});var Rr=function(){if(!ee){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e(z())!=="undefined"){return true}if(e([z()])!=="[null]"){return true}var t={a:z()};t[z()]=true;if(e(t)!=="{}"){return true}return false}();var Pr=l(function(){if(!ee){return true}return JSON.stringify(Object(z()))==="{}"&&JSON.stringify([Object(z())])==="[{}]"});if(Rr||!Pr){var Lr=JSON.stringify;Z(JSON,"stringify",function e(t){if(typeof t==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[t];if(!r(n)){var a=ne.IsCallable(n)?n:null;var s=function(e,t){var r=a?i(a,this,e,t):t;if(typeof r!=="symbol"){if(J.symbol(r)){return xt({})(r)}else{return r}}};o.push(s)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return Lr.apply(this,o)})}return x})}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:155}],21:[function(e,t,i){"use strict";var r=e("../util");var n=function(e){this.x=null;this.y=null;this.width=null;this.height=null;if(e){this.setPos(e.x,e.y);this.setDimensions(e.width,e.height)}};n.prototype.setPos=function(e,t){this.x=e;this.y=t};n.prototype.setDimensions=function(e,t){this.width=e;this.height=t};n.prototype.toXML=function(e,t){var i=r.createElement(e,"xdr:absoluteAnchor");var n=r.createElement(e,"xdr:pos");n.setAttribute("x",this.x);n.setAttribute("y",this.y);i.appendChild(n);var o=r.createElement(e,"xdr:ext");o.setAttribute("cx",this.width);o.setAttribute("cy",this.height);i.appendChild(o);i.appendChild(t);i.appendChild(r.createElement(e,"xdr:clientData"));return i};t.exports=n},{"../util":37}],22:[function(e,t,i){"use strict";var r=function(){};t.exports=r},{}],23:[function(e,t,i){"use strict";var r=e("underscore");var n=e("./AbsoluteAnchor");var o=e("./OneCellAnchor");var a=e("./TwoCellAnchor");var s=function(){this.id=r.uniqueId("Drawing")};s.prototype.createAnchor=function(e,t){t=t||{};t.drawing=this;switch(e){case"absoluteAnchor":this.anchor=new n(t);break;case"oneCellAnchor":this.anchor=new o(t);break;case"twoCellAnchor":this.anchor=new a(t);break}return this.anchor};t.exports=s},{"./AbsoluteAnchor":21,"./OneCellAnchor":24,"./TwoCellAnchor":26,underscore:212}],24:[function(e,t,i){"use strict";var r=e("../util");var n=function(e){this.x=null;this.y=null;this.xOff=null;this.yOff=null;this.width=null;this.height=null;if(e){this.setPos(e.x,e.y,e.xOff,e.yOff);this.setDimensions(e.width,e.height)}};n.prototype.setPos=function(e,t,i,r){this.x=e;this.y=t;if(i!==undefined){this.xOff=i}if(r!==undefined){this.yOff=r}};n.prototype.setDimensions=function(e,t){this.width=e;this.height=t};n.prototype.toXML=function(e,t){var i=r.createElement(e,"xdr:oneCellAnchor");var n=r.createElement(e,"xdr:from");var o=r.createElement(e,"xdr:col");o.appendChild(e.createTextNode(this.x));var a=r.createElement(e,"xdr:colOff");a.appendChild(e.createTextNode(this.xOff||0));var s=r.createElement(e,"xdr:row");s.appendChild(e.createTextNode(this.y));var l=r.createElement(e,"xdr:rowOff");l.appendChild(e.createTextNode(this.yOff||0));n.appendChild(o);n.appendChild(a);n.appendChild(s);n.appendChild(l);i.appendChild(n);var u=r.createElement(e,"xdr:ext");u.setAttribute("cx",this.width);u.setAttribute("cy",this.height);i.appendChild(u);i.appendChild(t);i.appendChild(r.createElement(e,"xdr:clientData"));return i};t.exports=n},{"../util":37}],25:[function(e,t,i){"use strict";var r=e("underscore");var n=e("../util");var o=e("./Drawing");var a=function(){this.media=null;this.id=r.uniqueId("Picture");this.pictureId=n.uniqueId("Picture");this.fill={};this.mediaData=null};a.prototype=new o;a.prototype.setMedia=function(e){this.mediaData=e};a.prototype.setDescription=function(e){this.description=e};a.prototype.setFillType=function(e){this.fill.type=e};a.prototype.setFillConfig=function(e){r.extend(this.fill,e)};a.prototype.getMediaType=function(){return"image"};a.prototype.getMediaData=function(){return this.mediaData};a.prototype.setRelationshipId=function(e){this.mediaData.rId=e};a.prototype.toXML=function(e){var t=n.createElement(e,"xdr:pic");var i=n.createElement(e,"xdr:nvPicPr");var r=n.createElement(e,"xdr:cNvPr",[["id",this.pictureId],["name",this.mediaData.fileName],["descr",this.description||""]]);i.appendChild(r);var o=n.createElement(e,"xdr:cNvPicPr");o.appendChild(n.createElement(e,"a:picLocks",[["noChangeAspect","1"],["noChangeArrowheads","1"]]));i.appendChild(o);t.appendChild(i);var a=n.createElement(e,"xdr:blipFill");a.appendChild(n.createElement(e,"a:blip",[["xmlns:r",n.schemas.relationships],["r:embed",this.mediaData.rId]]));a.appendChild(n.createElement(e,"a:srcRect"));var s=n.createElement(e,"a:stretch");s.appendChild(n.createElement(e,"a:fillRect"));a.appendChild(s);t.appendChild(a);var l=n.createElement(e,"xdr:spPr",[["bwMode","auto"]]);var u=n.createElement(e,"a:xfrm");l.appendChild(u);var c=n.createElement(e,"a:prstGeom",[["prst","rect"]]);l.appendChild(c);t.appendChild(l);return this.anchor.toXML(e,t)};t.exports=a},{"../util":37,"./Drawing":23,underscore:212}],26:[function(e,t,i){"use strict";var r=e("../util");var n=function(e){this.from={xOff:0,yOff:0};this.to={xOff:0,yOff:0};if(e){this.setFrom(e.from.x,e.from.y,e.to.xOff,e.to.yOff);this.setTo(e.to.x,e.to.y,e.to.xOff,e.to.yOff)}};n.prototype.setFrom=function(e,t,i,r){this.from.x=e;this.from.y=t;if(i!==undefined){this.from.xOff=i}if(r!==undefined){this.from.yOff=i}};n.prototype.setTo=function(e,t,i,r){this.to.x=e;this.to.y=t;if(i!==undefined){this.to.xOff=i}if(r!==undefined){this.to.yOff=i}};n.prototype.toXML=function(e,t){var i=r.createElement(e,"xdr:twoCellAnchor");var n=r.createElement(e,"xdr:from");var o=r.createElement(e,"xdr:col");o.appendChild(e.createTextNode(this.from.x));var a=r.createElement(e,"xdr:colOff");a.appendChild(e.createTextNode(this.from.xOff));var s=r.createElement(e,"xdr:row");s.appendChild(e.createTextNode(this.from.y));var l=r.createElement(e,"xdr:rowOff");l.appendChild(e.createTextNode(this.from.yOff));n.appendChild(o);n.appendChild(a);n.appendChild(s);n.appendChild(l);var u=r.createElement(e,"xdr:to");var c=r.createElement(e,"xdr:col");c.appendChild(e.createTextNode(this.to.x));var d=r.createElement(e,"xdr:colOff");d.appendChild(e.createTextNode(this.from.xOff));var p=r.createElement(e,"xdr:row");p.appendChild(e.createTextNode(this.to.y));var f=r.createElement(e,"xdr:rowOff");f.appendChild(e.createTextNode(this.from.yOff));u.appendChild(c);u.appendChild(d);u.appendChild(p);u.appendChild(f);i.appendChild(n);i.appendChild(u);i.appendChild(t);i.appendChild(r.createElement(e,"xdr:clientData"));return i};t.exports=n},{"../util":37}],27:[function(e,t,i){"use strict";var r=e("underscore");var n=e("./RelationshipManager");var o=e("./util");var a=function(){this.drawings=[];this.relations=new n;this.id=r.uniqueId("Drawings")};a.prototype.addDrawing=function(e){this.drawings.push(e)};a.prototype.getCount=function(){return this.drawings.length};a.prototype.toXML=function(){var e=o.createXmlDoc(o.schemas.spreadsheetDrawing,"xdr:wsDr");var t=e.documentElement;t.setAttribute("xmlns:a",o.schemas.drawing);t.setAttribute("xmlns:xdr",o.schemas.spreadsheetDrawing);for(var i=0,r=this.drawings.length;i<r;i++){var n=this.relations.getRelationshipId(this.drawings[i].getMediaData());if(!n){n=this.relations.addRelation(this.drawings[i].getMediaData(),this.drawings[i].getMediaType())}this.drawings[i].setRelationshipId(n);t.appendChild(this.drawings[i].toXML(e))}return e};t.exports=a},{"./RelationshipManager":30,"./util":37,underscore:212}],28:[function(e,t,i){(function(e){"use strict";if(!e.Paths){e.Paths={}}t.exports=e.Paths}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],29:[function(e,t,i){"use strict";var r=function(e){return Math.round(e*914400/96)};t.exports={pixelsToEMUs:r}},{}],30:[function(e,t,i){"use strict";var r=e("underscore");var n=e("./util");var o=e("./Paths");var a=function(){this.relations={};this.lastId=1};r.uniqueId("rId");a.prototype.importData=function(e){this.relations=e.relations;this.lastId=e.lastId};a.prototype.exportData=function(){return{relations:this.relations,lastId:this.lastId}};a.prototype.addRelation=function(e,t){this.relations[e.id]={id:r.uniqueId("rId"),schema:n.schemas[t]};return this.relations[e.id].id};a.prototype.getRelationshipId=function(e){return this.relations[e.id]?this.relations[e.id].id:null};a.prototype.toXML=function(){var e=n.createXmlDoc(n.schemas.relationshipPackage,"Relationships");var t=e.documentElement;r.each(this.relations,function(i,r){var a=n.createElement(e,"Relationship",[["Id",i.id],["Type",i.schema],["Target",o[r]]]);t.appendChild(a)});return e};t.exports=a},{"./Paths":28,"./util":37,underscore:212}],31:[function(e,t,i){"use strict";var r=e("underscore");var n=e("./util");var o=function(){this.strings={};this.stringArray=[];this.id=r.uniqueId("SharedStrings")};o.prototype.addString=function(e){this.strings[e]=this.stringArray.length;this.stringArray[this.stringArray.length]=e;return this.strings[e]};o.prototype.exportData=function(){return this.strings};o.prototype.toXML=function(){var e=n.createXmlDoc(n.schemas.spreadsheetml,"sst");var t=e.documentElement;this.stringArray.reverse();var i=this.stringArray.length;t.setAttribute("count",i);t.setAttribute("uniqueCount",i);var r=e.createElement("si");var o=e.createElement("t");o.appendChild(e.createTextNode("--placeholder--"));r.appendChild(o);var a=this.stringArray;while(i--){var s=r.cloneNode(true);s.firstChild.firstChild.nodeValue=a[i];t.appendChild(s)}return e};t.exports=o},{"./util":37,underscore:212}],32:[function(e,t,i){"use strict";var r=e("underscore");var n=e("./util");var o=function(){this.id=r.uniqueId("StyleSheet");this.cellStyles=[{name:"Normal",xfId:"0",builtinId:"0"}];this.defaultTableStyle=false;this.differentialStyles=[{}];this.masterCellFormats=[{numFmtId:0,fontId:0,fillId:0,borderId:0,xfid:0}];this.masterCellStyles=[{numFmtId:0,fontId:0,fillId:0,borderId:0}];this.fonts=[{}];this.numberFormatters=[];this.fills=[{},{type:"pattern",patternType:"gray125",fgColor:"FF333333",bgColor:"FF333333"}];this.borders=[{top:{},left:{},right:{},bottom:{},diagonal:{}}];this.tableStyles=[]};o.prototype.createSimpleFormatter=function(e){var t=this.masterCellFormats.length;var i={id:t};switch(e){case"date":i.numFmtId=14;break}this.masterCellFormats.push(i);return i};o.prototype.createFill=function(e){var t=this.fills.length;var i=e;i.id=t;this.fills.push(i);return i};o.prototype.createNumberFormatter=function(e){var t=this.numberFormatters.length+100;var i={id:t,formatCode:e};this.numberFormatters.push(i);return i};o.prototype.createFormat=function(e){var t=this.masterCellFormats.length;var i={id:t};if(e.font&&r.isObject(e.font)){i.fontId=this.createFontStyle(e.font).id}else if(e.font){if(r.isNaN(parseInt(e.font,10))){throw"Passing a non-numeric font id is not supported"}i.fontId=e.font}if(e.format&&r.isString(e.format)){i.numFmtId=this.createNumberFormatter(e.format).id}else if(e.format){if(r.isNaN(parseInt(e.format,10))){throw"Invalid number formatter id"}i.numFmtId=e.format}if(e.border&&r.isObject(e.border)){i.borderId=this.createBorderFormatter(e.border).id}else if(e.border){if(r.isNaN(parseInt(e.border,10))){throw"Passing a non-numeric border id is not supported"}i.borderId=e.border}if(e.fill&&r.isObject(e.fill)){i.fillId=this.createFill(e.fill).id}else if(e.fill){if(r.isNaN(parseInt(e.fill,10))){throw"Passing a non-numeric fill id is not supported"}i.fillId=e.fill}if(e.alignment&&r.isObject(e.alignment)){i.alignment=r.pick(e.alignment,"horizontal","justifyLastLine","readingOrder","relativeIndent","shrinkToFit","textRotation","vertical","wrapText")}this.masterCellFormats.push(i);return i};o.prototype.createDifferentialStyle=function(e){var t=this.differentialStyles.length;var i={id:t};if(e.font&&r.isObject(e.font)){i.font=e.font}if(e.border&&r.isObject(e.border)){i.border=r.defaults(e.border,{top:{},left:{},right:{},bottom:{},diagonal:{}})}if(e.fill&&r.isObject(e.fill)){i.fill=e.fill}if(e.alignment&&r.isObject(e.alignment)){i.alignment=e.alignment}if(e.format&&r.isString(e.format)){i.numFmt=e.format}this.differentialStyles[t]=i;return i};o.prototype.createTableStyle=function(e){this.tableStyles.push(e)};o.prototype.createBorderFormatter=function(e){r.defaults(e,{top:{},left:{},right:{},bottom:{},diagonal:{},id:this.borders.length});this.borders.push(e);return e};o.prototype.createFontStyle=function(e){var t=this.fonts.length;var i={id:t};if(e.bold){i.bold=true}if(e.italic){i.italic=true}if(e.superscript){i.vertAlign="superscript"}if(e.subscript){i.vertAlign="subscript"}if(e.underline){if(r.indexOf(["double","singleAccounting","doubleAccounting"],e.underline)!==-1){i.underline=e.underline}else{i.underline=true}}if(e.strike){i.strike=true}if(e.outline){i.outline=true}if(e.shadow){i.shadow=true}if(e.size){i.size=e.size}if(e.color){i.color=e.color}if(e.fontName){i.fontName=e.fontName}this.fonts.push(i);return i};o.prototype.exportBorders=function(e){var t=e.createElement("borders");t.setAttribute("count",this.borders.length);for(var i=0,r=this.borders.length;i<r;i++){t.appendChild(this.exportBorder(e,this.borders[i]))}return t};o.prototype.exportBorder=function(e,t){var i=e.createElement("border");var r=this;var n=function(i){var n=e.createElement(i);if(t[i].style){n.setAttribute("style",t[i].style)}if(t[i].color){n.appendChild(r.exportColor(e,t[i].color))}return n};i.appendChild(n("left"));i.appendChild(n("right"));i.appendChild(n("top"));i.appendChild(n("bottom"));i.appendChild(n("diagonal"));return i};o.prototype.exportColor=function(e,t){var i=e.createElement("color");if(r.isString(t)){i.setAttribute("rgb",t);return i}if(!r.isUndefined(t.tint)){i.setAttribute("tint",t.tint)}if(!r.isUndefined(t.auto)){i.setAttribute("auto",!!t.auto)}if(!r.isUndefined(t.theme)){i.setAttribute("theme",t.theme)}return i};o.prototype.exportMasterCellFormats=function(e){var t=n.createElement(e,"cellXfs",[["count",this.masterCellFormats.length]]);for(var i=0,r=this.masterCellFormats.length;i<r;i++){var o=this.masterCellFormats[i];t.appendChild(this.exportCellFormatElement(e,o))}return t};o.prototype.exportMasterCellStyles=function(e){var t=n.createElement(e,"cellStyleXfs",[["count",this.masterCellStyles.length]]);for(var i=0,r=this.masterCellStyles.length;i<r;i++){
var o=this.masterCellStyles[i];t.appendChild(this.exportCellFormatElement(e,o))}return t};o.prototype.exportCellFormatElement=function(e,t){var i=e.createElement("xf");var n=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","borderId","fillId","fontId","numFmtId","pivotButton","quotePrefix","xfId"];var o=r.filter(r.keys(t),function(e){if(r.indexOf(n,e)!==-1){return true}});if(t.alignment){var a=t.alignment;i.appendChild(this.exportAlignment(e,a))}var s=o.length;while(s--){i.setAttribute(o[s],t[o[s]])}if(t.fillId){i.setAttribute("applyFill","1")}return i};o.prototype.exportAlignment=function(e,t){var i=e.createElement("alignment");var n=r.keys(t);for(var o=0,a=n.length;o<a;o++){i.setAttribute(n[o],t[n[o]])}return i};o.prototype.exportFonts=function(e){var t=e.createElement("fonts");t.setAttribute("count",this.fonts.length);for(var i=0,r=this.fonts.length;i<r;i++){var n=this.fonts[i];t.appendChild(this.exportFont(e,n))}return t};o.prototype.exportFont=function(e,t){var i=e.createElement("font");if(t.size){var r=e.createElement("sz");r.setAttribute("val",t.size);i.appendChild(r)}if(t.fontName){var n=e.createElement("name");n.setAttribute("val",t.fontName);i.appendChild(n)}if(t.bold){i.appendChild(e.createElement("b"))}if(t.italic){i.appendChild(e.createElement("i"))}if(t.vertAlign){var o=e.createElement("vertAlign");o.setAttribute("val",t.vertAlign);i.appendChild(o)}if(t.underline){var a=e.createElement("u");if(t.underline!==true){a.setAttribute("val",t.underline)}i.appendChild(a)}if(t.strike){i.appendChild(e.createElement("strike"))}if(t.shadow){i.appendChild(e.createElement("shadow"))}if(t.outline){i.appendChild(e.createElement("outline"))}if(t.color){i.appendChild(this.exportColor(e,t.color))}return i};o.prototype.exportFills=function(e){var t=e.createElement("fills");t.setAttribute("count",this.fills.length);for(var i=0,r=this.fills.length;i<r;i++){var n=this.fills[i];t.appendChild(this.exportFill(e,n))}return t};o.prototype.exportFill=function(e,t){var i;var r=e.createElement("fill");if(t.type==="pattern"){i=this.exportPatternFill(e,t);r.appendChild(i)}else if(t.type==="gradient"){i=this.exportGradientFill(e,t);r.appendChild(i)}return r};o.prototype.exportGradientFill=function(e,t){var i=e.createElement("gradientFill");if(t.degree){i.setAttribute("degree",t.degree)}else if(t.left){i.setAttribute("left",t.left);i.setAttribute("right",t.right);i.setAttribute("top",t.top);i.setAttribute("bottom",t.bottom)}var r=e.createElement("stop");r.setAttribute("position",t.start.pureAt||0);var n=e.createElement("color");if(typeof t.start==="string"||t.start.color){n.setAttribute("rgb",t.start.color||t.start)}else if(typeof t.start.theme){n.setAttribute("theme",t.start.theme)}var o=e.createElement("stop");var a=e.createElement("color");o.setAttribute("position",t.end.pureAt||1);if(typeof t.start==="string"||t.end.color){a.setAttribute("rgb",t.end.color||t.end)}else if(typeof t.end.theme){a.setAttribute("theme",t.end.theme)}r.appendChild(n);o.appendChild(a);i.appendChild(r);i.appendChild(o);return i};o.prototype.exportPatternFill=function(e,t){var i=n.createElement(e,"patternFill",[["patternType",t.patternType]]);if(!t.bgColor){t.bgColor="FFFFFFFF"}if(!t.fgColor){t.fgColor="FFFFFFFF"}var o=e.createElement("bgColor");if(r.isString(t.bgColor)){o.setAttribute("rgb",t.bgColor)}else{if(t.bgColor.theme){o.setAttribute("theme",t.bgColor.theme)}else{o.setAttribute("rgb",t.bgColor.rbg)}}var a=e.createElement("fgColor");if(r.isString(t.fgColor)){a.setAttribute("rgb",t.fgColor)}else{if(t.fgColor.theme){a.setAttribute("theme",t.fgColor.theme)}else{a.setAttribute("rgb",t.fgColor.rbg)}}i.appendChild(a);i.appendChild(o);return i};o.prototype.exportNumberFormatters=function(e){var t=e.createElement("numFmts");t.setAttribute("count",this.numberFormatters.length);for(var i=0,r=this.numberFormatters.length;i<r;i++){var n=this.numberFormatters[i];t.appendChild(this.exportNumberFormatter(e,n))}return t};o.prototype.exportNumberFormatter=function(e,t){var i=e.createElement("numFmt");i.setAttribute("numFmtId",t.id);i.setAttribute("formatCode",t.formatCode);return i};o.prototype.exportCellStyles=function(e){var t=e.createElement("cellStyles");t.setAttribute("count",this.cellStyles.length);for(var i=0,o=this.cellStyles.length;i<o;i++){var a=this.cellStyles[i];delete a.id;var s=n.createElement(e,"cellStyle");t.appendChild(s);var l=r.keys(a);var u=l.length;while(u--){s.setAttribute(l[u],a[l[u]])}}return t};o.prototype.exportDifferentialStyles=function(e){var t=e.createElement("dxfs");t.setAttribute("count",this.differentialStyles.length);for(var i=0,r=this.differentialStyles.length;i<r;i++){var n=this.differentialStyles[i];t.appendChild(this.exportDFX(e,n))}return t};o.prototype.exportDFX=function(e,t){var i=e.createElement("dxf");if(t.font){i.appendChild(this.exportFont(e,t.font))}if(t.fill){i.appendChild(this.exportFill(e,t.fill))}if(t.border){i.appendChild(this.exportBorder(e,t.border))}if(t.numFmt){i.appendChild(this.exportNumberFormatter(e,t.numFmt))}if(t.alignment){i.appendChild(this.exportAlignment(e,t.alignment))}return i};o.prototype.exportTableStyles=function(e){var t=e.createElement("tableStyles");t.setAttribute("count",this.tableStyles.length);if(this.defaultTableStyle){t.setAttribute("defaultTableStyle",this.defaultTableStyle)}for(var i=0,r=this.tableStyles.length;i<r;i++){t.appendChild(this.exportTableStyle(e,this.tableStyles[i]))}return t};o.prototype.exportTableStyle=function(e,t){var i=e.createElement("tableStyle");i.setAttribute("name",t.name);i.setAttribute("pivot",0);var n=0;r.each(t,function(t,r){if(r==="name"){return}n++;var o=e.createElement("tableStyleElement");o.setAttribute("type",r);o.setAttribute("dxfId",t);i.appendChild(o)});i.setAttribute("count",n);return i};o.prototype.toXML=function(){var e=n.createXmlDoc(n.schemas.spreadsheetml,"styleSheet");var t=e.documentElement;t.appendChild(this.exportNumberFormatters(e));t.appendChild(this.exportFonts(e));t.appendChild(this.exportFills(e));t.appendChild(this.exportBorders(e));t.appendChild(this.exportMasterCellStyles(e));t.appendChild(this.exportMasterCellFormats(e));t.appendChild(this.exportCellStyles(e));t.appendChild(this.exportDifferentialStyles(e));if(this.tableStyles.length){t.appendChild(this.exportTableStyles(e))}return e};t.exports=o},{"./util":37,underscore:212}],33:[function(e,t,i){"use strict";var r=e("underscore");var n=e("./util");var o=function(e){r.defaults(this,{name:"",displayName:"",dataCellStyle:null,dataDfxId:null,headerRowBorderDxfId:null,headerRowCellStyle:null,headerRowCount:1,headerRowDxfId:null,insertRow:false,insertRowShift:false,ref:null,tableBorderDxfId:null,totalsRowBorderDxfId:null,totalsRowCellStyle:null,totalsRowCount:0,totalsRowDxfId:null,tableColumns:[],autoFilter:null,sortState:null,styleInfo:{}});this.initialize(e)};o.prototype.initialize=function(e){this.displayName=r.uniqueId("Table");this.name=this.displayName;this.id=this.name;this.tableId=this.id.replace("Table","");r.extend(this,e)};o.prototype.setReferenceRange=function(e,t){this.ref=[e,t]};o.prototype.setTableColumns=function(e){r.each(e,function(e){this.addTableColumn(e)},this)};o.prototype.addTableColumn=function(e){if(r.isString(e)){e={name:e}}if(!e.name){throw"Invalid argument for addTableColumn - minimum requirement is a name property"}this.tableColumns.push(e)};o.prototype.setSortState=function(e){this.sortState=e};o.prototype.toXML=function(){var e=n.createXmlDoc(n.schemas.spreadsheetml,"table");var t=e.documentElement;t.setAttribute("id",this.tableId);t.setAttribute("name",this.name);t.setAttribute("displayName",this.displayName);var i=this.ref[0];var r=this.ref[1];t.setAttribute("ref",n.positionToLetterRef(i[0],i[1])+":"+n.positionToLetterRef(r[0],r[1]));t.setAttribute("totalsRowCount",this.totalsRowCount);t.setAttribute("headerRowCount",this.headerRowCount);if(this.headerRowDxfId){t.setAttribute("headerRowDxfId",this.headerRowDxfId)}if(this.headerRowBorderDxfId){t.setAttribute("headerRowBorderDxfId",this.headerRowBorderDxfId)}if(!this.ref){throw"Needs at least a reference range"}if(!this.autoFilter){this.addAutoFilter(this.ref[0],this.ref[1])}t.appendChild(this.exportAutoFilter(e));t.appendChild(this.exportTableColumns(e));t.appendChild(this.exportTableStyleInfo(e));return e};o.prototype.exportTableColumns=function(e){var t=e.createElement("tableColumns");t.setAttribute("count",this.tableColumns.length);var i=this.tableColumns;for(var r=0,n=i.length;r<n;r++){var o=i[r];var a=e.createElement("tableColumn");a.setAttribute("id",r+1);a.setAttribute("name",o.name);t.appendChild(a);if(o.totalsRowFunction){a.setAttribute("totalsRowFunction",o.totalsRowFunction)}if(o.totalsRowLabel){a.setAttribute("totalsRowLabel",o.totalsRowLabel)}}return t};o.prototype.exportAutoFilter=function(e){var t=e.createElement("autoFilter");var i=this.autoFilter[0];var r=this.autoFilter[1];t.setAttribute("ref",n.positionToLetterRef(i[0],i[1])+":"+n.positionToLetterRef(r[0],r[1]-this.totalsRowCount));return t};o.prototype.exportTableStyleInfo=function(e){var t=this.styleInfo;var i=e.createElement("tableStyleInfo");i.setAttribute("name",t.themeStyle);i.setAttribute("showFirstColumn",t.showFirstColumn?"1":"0");i.setAttribute("showLastColumn",t.showLastColumn?"1":"0");i.setAttribute("showColumnStripes",t.showColumnStripes?"1":"0");i.setAttribute("showRowStripes",t.showRowStripes?"1":"0");return i};o.prototype.addAutoFilter=function(e,t){this.autoFilter=[e,t]};t.exports=o},{"./util":37,underscore:212}],34:[function(e,t,i){"use strict";var r=e("underscore");var n=e("./StyleSheet");var o=e("./Worksheet");var a=e("./SharedStrings");var s=e("./RelationshipManager");var l=e("./Paths");var u=e("./XMLDOM");var c=e("xmldom").XMLSerializer;var d=e("./util");var p=function(e){this.worksheets=[];this.tables=[];this.drawings=[];this.media={};this.initialize(e)};p.prototype.initialize=function(){this.id=r.uniqueId("Workbook");this.styleSheet=new n;this.sharedStrings=new a;this.relations=new s;this.relations.addRelation(this.styleSheet,"stylesheet");this.relations.addRelation(this.sharedStrings,"sharedStrings")};p.prototype.createWorksheet=function(e){e=e||{};r.defaults(e,{name:"Sheet ".concat(this.worksheets.length+1)});return new o(e)};p.prototype.getStyleSheet=function(){return this.styleSheet};p.prototype.addTable=function(e){this.tables.push(e)};p.prototype.addDrawings=function(e){this.drawings.push(e)};p.prototype.addMedia=function(e,t,i,r){var n=t.split(".");var o=n[n.length-1];if(!r){switch(o.toLowerCase()){case"jpeg":case"jpg":r="image/jpeg";break;case"png":r="image/png";break;case"gif":r="image/gif";break;default:r=null;break}}if(!this.media[t]){this.media[t]={id:t,data:i,fileName:t,contentType:r,extension:o}}return this.media[t]};p.prototype.addWorksheet=function(e){this.relations.addRelation(e,"worksheet");e.setSharedStringCollection(this.sharedStrings);this.worksheets.push(e)};p.prototype.createContentTypes=function(){var e=d.createXmlDoc(d.schemas.contentTypes,"Types");var t=e.documentElement;var i,r;t.appendChild(d.createElement(e,"Default",[["Extension","rels"],["ContentType","application/vnd.openxmlformats-package.relationships+xml"]]));t.appendChild(d.createElement(e,"Default",[["Extension","xml"],["ContentType","application/xml"]]));var n={};for(var o in this.media){if(this.media.hasOwnProperty(o)){n[this.media[o].extension]=this.media[o].contentType}}for(var a in n){if(n.hasOwnProperty(a)){t.appendChild(d.createElement(e,"Default",[["Extension",a],["ContentType",n[a]]]))}}t.appendChild(d.createElement(e,"Override",[["PartName","/xl/workbook.xml"],["ContentType","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"]]));t.appendChild(d.createElement(e,"Override",[["PartName","/xl/sharedStrings.xml"],["ContentType","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml"]]));t.appendChild(d.createElement(e,"Override",[["PartName","/xl/styles.xml"],["ContentType","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml"]]));for(i=0,r=this.worksheets.length;i<r;i++){t.appendChild(d.createElement(e,"Override",[["PartName","/xl/worksheets/sheet"+(i+1)+".xml"],["ContentType","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"]]))}for(i=0,r=this.tables.length;i<r;i++){t.appendChild(d.createElement(e,"Override",[["PartName","/xl/tables/table"+(i+1)+".xml"],["ContentType","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml"]]))}for(i=0,r=this.drawings.length;i<r;i++){t.appendChild(d.createElement(e,"Override",[["PartName","/xl/drawings/drawing"+(i+1)+".xml"],["ContentType","application/vnd.openxmlformats-officedocument.drawing+xml"]]))}return e};p.prototype.toXML=function(){var e=d.createXmlDoc(d.schemas.spreadsheetml,"workbook");var t=e.documentElement;t.setAttribute("xmlns:r",d.schemas.relationships);var i=31;var r=d.createElement(e,"sheets");for(var n=0,o=this.worksheets.length;n<o;n++){var a=e.createElement("sheet");if(console!=null&&this.worksheets[n].name.length>i){console.log("Microsoft Excel requires work sheet names to be less than "+(i+1)+' characters long, work sheet name "'+this.worksheets[n].name+'" is '+this.worksheets[n].name.length+" characters long")}a.setAttribute("name",this.worksheets[n].name);a.setAttribute("sheetId",n+1);a.setAttribute("r:id",this.relations.getRelationshipId(this.worksheets[n]));r.appendChild(a)}t.appendChild(r);return e};p.prototype.createWorkbookRelationship=function(){var e=d.createXmlDoc(d.schemas.relationshipPackage,"Relationships");var t=e.documentElement;t.appendChild(d.createElement(e,"Relationship",[["Id","rId1"],["Type",d.schemas.officeDocument],["Target","xl/workbook.xml"]]));return e};p.prototype._generateCorePaths=function(e){var t,i;l[this.styleSheet.id]="styles.xml";l[this.sharedStrings.id]="sharedStrings.xml";l[this.id]="/xl/workbook.xml";for(t=0,i=this.tables.length;t<i;t++){e["/xl/tables/table"+(t+1)+".xml"]=this.tables[t].toXML();l[this.tables[t].id]="/xl/tables/table"+(t+1)+".xml"}for(var r in this.media){if(this.media.hasOwnProperty(r)){var n=this.media[r];e["/xl/media/"+r]=n.data;l[r]="/xl/media/"+r}}for(t=0,i=this.drawings.length;t<i;t++){e["/xl/drawings/drawing"+(t+1)+".xml"]=this.drawings[t].toXML();l[this.drawings[t].id]="/xl/drawings/drawing"+(t+1)+".xml";e["/xl/drawings/_rels/drawing"+(t+1)+".xml.rels"]=this.drawings[t].relations.toXML()}};p.prototype._prepareFilesForPackaging=function(e){r.extend(e,{"/[Content_Types].xml":this.createContentTypes(),"/_rels/.rels":this.createWorkbookRelationship(),"/xl/styles.xml":this.styleSheet.toXML(),"/xl/workbook.xml":this.toXML(),"/xl/sharedStrings.xml":this.sharedStrings.toXML(),"/xl/_rels/workbook.xml.rels":this.relations.toXML()});r.each(e,function(t,i){if(i.indexOf(".xml")!==-1||i.indexOf(".rels")!==-1){if(t instanceof u){e[i]=t.toString()}else{e[i]=t.xml||(new c).serializeToString(t)}var r=e[i].replace(/xmlns=""/g,"");r=r.replace(/NS[\d]+:/g,"");r=r.replace(/xmlns:NS[\d]+=""/g,"");e[i]='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'+"\n"+r}})};p.prototype.generateFilesAsync=function(){};p.prototype._createWorker=function(){};p.prototype.generateFiles=function(){var e={};this._generateCorePaths(e);for(var t=0,i=this.worksheets.length;t<i;t++){e["/xl/worksheets/sheet"+(t+1)+".xml"]=this.worksheets[t].toXML();l[this.worksheets[t].id]="worksheets/sheet"+(t+1)+".xml";e["/xl/worksheets/_rels/sheet"+(t+1)+".xml.rels"]=this.worksheets[t].relations.toXML()}this._prepareFilesForPackaging(e);return e};t.exports=p},{"./Paths":28,"./RelationshipManager":30,"./SharedStrings":31,"./StyleSheet":32,"./Worksheet":35,"./XMLDOM":36,"./util":37,underscore:212,xmldom:216}],35:[function(e,t,i){"use strict";var r=e("underscore");var n=e("./util");var o=e("./RelationshipManager");var a=function(e){this.relations=null;this.columnFormats=[];this.data=[];this.mergedCells=[];this.columns=[];this._headers=[];this._footers=[];this._tables=[];this._drawings=[];this._rowInstructions={};this.initialize(e)};a.prototype.initialize=function(e){e=e||{};this.name=e.name;this.id=r.uniqueId("Worksheet");this._timezoneOffset=(new Date).getTimezoneOffset()*60*1e3;if(e.columns){this.setColumns(e.columns)}this.relations=new o};a.prototype.exportData=function(){return{relations:this.relations.exportData(),columnFormats:this.columnFormats,data:this.data,columns:this.columns,mergedCells:this.mergedCells,_headers:this._headers,_footers:this._footers,_tables:this._tables,_rowInstructions:this._rowInstructions,name:this.name,id:this.id}};a.prototype.importData=function(e){this.relations.importData(e.relations);delete e.relations;r.extend(this,e)};a.prototype.setSharedStringCollection=function(e){this.sharedStrings=e};a.prototype.addTable=function(e){this._tables.push(e);this.relations.addRelation(e,"table")};a.prototype.addDrawings=function(e){this._drawings.push(e);this.relations.addRelation(e,"drawingRelationship")};a.prototype.setRowInstructions=function(e){this._rowInstructions=e};a.prototype.setHeader=function(e){if(!r.isArray(e)){throw"Invalid argument type - setHeader expects an array of three instructions"}this._headers=e};a.prototype.setFooter=function(e){if(!r.isArray(e)){throw"Invalid argument type - setFooter expects an array of three instructions"}this._footers=e};a.prototype.compilePageDetailPackage=function(e){e=e||"";return["&L",this.compilePageDetailPiece(e[0]||""),"&C",this.compilePageDetailPiece(e[1]||""),"&R",this.compilePageDetailPiece(e[2]||"")].join("")};a.prototype.compilePageDetailPiece=function(e){if(r.isString(e)){return'&"-,Regular"'.concat(e)}if(r.isObject(e)&&!r.isArray(e)){var t="";if(e.font||e.bold){var i=e.bold?"Bold":"Regular";t+='&"'+(e.font||"-");t+=","+i+'"'}else{t+='&"-,Regular"'}if(e.underline){t+="&U"}if(e.fontSize){t+="&"+e.fontSize}t+=e.text;return t}if(r.isArray(e)){var n=this;return r.reduce(e,function(e,t){return e.concat(n.compilePageDetailPiece(t))},"")}};a.prototype.exportHeader=function(e){var t=e.createElement("oddHeader");t.appendChild(e.createTextNode(this.compilePageDetailPackage(this._headers)));return t};a.prototype.exportFooter=function(e){var t=e.createElement("oddFooter");t.appendChild(e.createTextNode(this.compilePageDetailPackage(this._footers)));return t};a.prototype._buildCache=function(e){var t=e.createElement("c");var i=e.createElement("v");i.appendChild(e.createTextNode("--temp--"));t.appendChild(i);var r=e.createElement("c");var n=e.createElement("f");n.appendChild(e.createTextNode("--temp--"));r.appendChild(n);var o=e.createElement("c");o.setAttribute("t","s");var a=e.createElement("v");a.appendChild(e.createTextNode("--temp--"));o.appendChild(a);return{number:t,date:t,string:o,formula:r}};a.prototype.collectSharedStrings=function(){var e=this.data;var t=0;var i={};for(var n=0,o=e.length;n<o;n++){var a=e[n];var s=a.length;t=s>t?s:t;for(var l=0;l<s;l++){var u=a[l];var c=u&&u.metadata||{};if(u&&typeof u==="object"){u=u.value}if(!c.type){if(typeof u==="number"){c.type="number"}}if(c.type==="text"||!c.type){if(typeof i[u]==="undefined"){i[u]=true}}}}return r.keys(i)};a.prototype.toXML=function(){var e=this.data;var t=this.columns||[];var i=n.createXmlDoc(n.schemas.spreadsheetml,"worksheet");var r=i.documentElement;var o,a,s;r.setAttribute("xmlns:r",n.schemas.relationships);r.setAttribute("xmlns:mc",n.schemas.markupCompat);var l=0;var u=n.createElement(i,"sheetData");var c=this._buildCache(i);for(s=0,a=e.length;s<a;s++){var d=e[s];var p=d.length;l=p>l?p:l;var f=i.createElement("row");for(var h=0;h<p;h++){t[h]=t[h]||{};var g=d[h];var m,v=g&&g.metadata||{};if(g&&typeof g==="object"){g=g.value}if(!v.type){if(typeof g==="number"){v.type="number"}}switch(v.type){case"number":m=c.number.cloneNode(true);m.firstChild.firstChild.nodeValue=g;break;case"date":m=c.date.cloneNode(true);m.firstChild.firstChild.nodeValue=25569+(g-this._timezoneOffset)/(60*60*24*1e3);break;case"formula":m=c.formula.cloneNode(true);m.firstChild.firstChild.nodeValue=g;break;case"text":default:var y;if(typeof this.sharedStrings.strings[g]!=="undefined"){y=this.sharedStrings.strings[g]}else{y=this.sharedStrings.addString(g)}m=c.string.cloneNode(true);m.firstChild.firstChild.nodeValue=y;break}if(v.style){m.setAttribute("s",v.style)}m.setAttribute("r",n.positionToLetterRef(h+1,s+1));f.appendChild(m)}f.setAttribute("r",s+1);if(this._rowInstructions){var b=this._rowInstructions;for(var o=0;o<e.length;o++){if(b.height!==undefined){f.setAttribute("customHeight","1");f.setAttribute("ht",b.height)}if(b.style!==undefined){f.setAttribute("customFormat","1");f.setAttribute("s",b.style)}}}u.appendChild(f)}if(l!==0){r.appendChild(n.createElement(i,"dimension",[["ref",n.positionToLetterRef(1,1)+":"+n.positionToLetterRef(l,e.length)]]))}else{r.appendChild(n.createElement(i,"dimension",[["ref",n.positionToLetterRef(1,1)]]))}if(this.columns.length){r.appendChild(this.exportColumns(i))}r.appendChild(u);if(this.mergedCells.length>0){var w=i.createElement("mergeCells");for(o=0,a=this.mergedCells.length;o<a;o++){var C=i.createElement("mergeCell");C.setAttribute("ref",this.mergedCells[o][0]+":"+this.mergedCells[o][1]);w.appendChild(C)}r.appendChild(w)}this.exportPageSettings(i,r);if(this._headers.length>0||this._footers.length>0){var E=i.createElement("headerFooter");if(this._headers.length>0){E.appendChild(this.exportHeader(i))}if(this._footers.length>0){E.appendChild(this.exportFooter(i))}r.appendChild(E)}if(this._tables.length>0){var S=i.createElement("tableParts");S.setAttribute("count",this._tables.length);for(o=0,a=this._tables.length;o<a;o++){var T=i.createElement("tablePart");T.setAttribute("r:id",this.relations.getRelationshipId(this._tables[o]));S.appendChild(T)}r.appendChild(S)}for(o=0,a=this._drawings.length;o<a;o++){var x=i.createElement("drawing");x.setAttribute("r:id",this.relations.getRelationshipId(this._drawings[o]));r.appendChild(x)}return i};a.prototype.exportColumns=function(e){var t=n.createElement(e,"cols");for(var i=0,r=this.columns.length;i<r;i++){var o=this.columns[i];var a=n.createElement(e,"col",[["min",o.min||i+1],["max",o.max||i+1]]);if(o.hidden){a.setAttribute("hidden",1)}if(o.bestFit){a.setAttribute("bestFit",1)}if(o.customWidth||o.width){a.setAttribute("customWidth",1)}if(o.width){a.setAttribute("width",o.width)}else{a.setAttribute("width",9.140625)}t.appendChild(a)}return t};a.prototype.exportPageSettings=function(e,t){if(this._orientation){t.appendChild(n.createElement(e,"pageSetup",[["orientation",this._orientation]]))}};a.prototype.setPageOrientation=function(e){this._orientation=e};a.prototype.setColumns=function(e){this.columns=e};a.prototype.setData=function(e){this.data=e};a.prototype.mergeCells=function(e,t){this.mergedCells.push([e,t])};a.prototype.setColumnFormats=function(e){this.columnFormats=e};t.exports=a},{"./RelationshipManager":30,"./util":37,underscore:212}],36:[function(e,t,i){"use strict";var r=e("underscore");var n=function(e,t){this.documentElement=this.createElement(t);this.documentElement.setAttribute("xmlns",e)};n.prototype.createElement=function(e){return new n.XMLNode({nodeName:e})};n.prototype.createTextNode=function(e){return new n.TextNode(e)};n.prototype.toString=function(){return this.documentElement.toString()};n.Node=function(){};n.Node.Create=function(e){switch(e.type){case"XML":return new n.XMLNode(e);case"TEXT":return new n.TextNode(e.nodeValue)}};n.TextNode=function(e){this.nodeValue=e};n.TextNode.prototype.toJSON=function(){return{nodeValue:this.nodeValue,type:"TEXT"}};n.TextNode.prototype.toString=function(){return r.escape(this.nodeValue)};n.XMLNode=function(e){this.nodeName=e.nodeName;this.children=[];this.nodeValue=e.nodeValue||"";this.attributes={};if(e.children){for(var t=0;t<e.children.length;t++){this.appendChild(n.Node.Create(e.children[t]))}}if(e.attributes){for(var i in e.attributes){if(e.attributes.hasOwnProperty(i)){this.setAttribute(i,e.attributes[i])}}}};n.XMLNode.prototype.toString=function(){var e="<"+this.nodeName;var t=[];for(var i in this.attributes){if(this.attributes.hasOwnProperty(i)){t.push(i+'="'+r.escape(this.attributes[i])+'"')}}if(t.length>0){e+=" "+t.join(" ")}var n="";for(var o=0,a=this.children.length;o<a;o++){n+=this.children[o].toString()}if(n){e+=">"+n+"</"+this.nodeName+">"}else{e+="/>"}return e};n.XMLNode.prototype.toJSON=function(){var e=[];for(var t=0,i=this.children.length;t<i;t++){e.push(this.children[t].toJSON())}return{nodeName:this.nodeName,children:e,nodeValue:this.nodeValue,attributes:this.attributes,type:"XML"}};n.XMLNode.prototype.setAttribute=function(e,t){if(t===null){delete this.attributes[e];delete this[e];return}this.attributes[e]=t;this[e]=t};n.XMLNode.prototype.setAttributeNS=function(e,t,i){this.setAttribute(t,i)};n.XMLNode.prototype.appendChild=function(e){this.children.push(e);this.firstChild=this.children[0]};n.XMLNode.prototype.cloneNode=function(){return new n.XMLNode(this.toJSON())};t.exports=n},{underscore:212}],37:[function(e,t,i){(function(i){"use strict";var r=e("./XMLDOM");var n=e("fs");t.exports={_idSpaces:{},uniqueId:function(e){if(!this._idSpaces[e]){this._idSpaces[e]=1}return this._idSpaces[e]++},createXmlDoc:function(e,t){return new r(e||null,t,null)},createElement:function(e,t,i){var r=e.createElement(t);var n=!r.setAttributeNS;i=i||[];var o=i.length;while(o--){if(!n&&i[o][0].indexOf("xmlns")!==-1){r.setAttributeNS("http://www.w3.org/2000/xmlns/",i[o][0],i[o][1])}else{r.setAttribute(i[o][0],i[o][1])}}return r},LETTER_REFS:{},positionToLetterRef:function(e,t){var i=1,r,n=e,o="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZ";if(this.LETTER_REFS[e]){return this.LETTER_REFS[e].concat(t)}while(n>0){n-=Math.pow(26,i-1);r=n%Math.pow(26,i);n-=r;r=r/Math.pow(26,i-1);o=a.charAt(r)+o;i+=1}this.LETTER_REFS[e]=o;return o.concat(t)},base64Encode:function(e){var t=n.readFileSync(e);return new i(t).toString("base64")},base64Decode:function(e,t){var r=new i(e,"base64");n.writeFileSync(t,r)},schemas:{worksheet:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet",sharedStrings:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",stylesheet:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",relationships:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",relationshipPackage:"http://schemas.openxmlformats.org/package/2006/relationships",contentTypes:"http://schemas.openxmlformats.org/package/2006/content-types",spreadsheetml:"http://schemas.openxmlformats.org/spreadsheetml/2006/main",markupCompat:"http://schemas.openxmlformats.org/markup-compatibility/2006",x14ac:"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac",officeDocument:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",package:"http://schemas.openxmlformats.org/package/2006/relationships",table:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/table",spreadsheetDrawing:"http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing",drawing:"http://schemas.openxmlformats.org/drawingml/2006/main",drawingRelationship:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",image:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",chart:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart"}}}).call(this,e("buffer").Buffer)},{"./XMLDOM":36,buffer:5,fs:4}],38:[function(e,t,i){"use strict";var r=e("underscore");var n=e("jszip");var o=e("./Excel/Drawings");var a=e("./Excel/Paths");var s=e("./Excel/Positioning");var l=e("./Excel/RelationshipManager");var u=e("./Excel/SharedStrings");var c=e("./Excel/StyleSheet");var d=e("./Excel/Table");var p=e("./Excel/util");var f=e("./Excel/Workbook");var h=e("./Excel/Worksheet");var g=e("./Excel/XMLDOM");var m=e("./Excel/Drawing/AbsoluteAnchor");var v=e("./Excel/Drawing/Chart");var y=e("./Excel/Drawing/Drawing");var b=e("./Excel/Drawing/OneCellAnchor");var w=e("./Excel/Drawing/Picture");var C=e("./Excel/Drawing/TwoCellAnchor");t.exports={Drawings:o,Paths:a,Positioning:s,RelationshipManager:l,SharedStrings:u,StyleSheet:c,Table:d,util:p,Worksheet:h,XMLDOM:g,AbsoluteAnchor:m,Chart:v,Drawing:y,OneCellAnchor:b,Picture:w,TwoCellAnchor:C,createWorkbook:function(){return new f},createFileAsync:function(e,t){},createFile:function(e,t){var i=new n;var o=e.generateFiles();r.each(o,function(e,t){t=t.substr(1);if(t.indexOf(".xml")!==-1||t.indexOf(".rel")!==-1){i.file(t,e,{base64:false})}else{i.file(t,e,{base64:true,binary:true})}});return i.generate(r.defaults(t||{},{type:"base64"}))}}},{"./Excel/Drawing/AbsoluteAnchor":21,"./Excel/Drawing/Chart":22,"./Excel/Drawing/Drawing":23,"./Excel/Drawing/OneCellAnchor":24,"./Excel/Drawing/Picture":25,"./Excel/Drawing/TwoCellAnchor":26,"./Excel/Drawings":27,"./Excel/Paths":28,"./Excel/Positioning":29,"./Excel/RelationshipManager":30,"./Excel/SharedStrings":31,"./Excel/StyleSheet":32,"./Excel/Table":33,"./Excel/Workbook":34,"./Excel/Worksheet":35,"./Excel/XMLDOM":36,"./Excel/util":37,jszip:54,underscore:212}],39:[function(e,t,i){"use strict";var r=Object.prototype.hasOwnProperty;function n(e,t){if(e===t){return e!==0||t!==0||1/e===1/t}else{return e!==e&&t!==t}}function o(e,t){if(n(e,t)){return true}if(typeof e!=="object"||e===null||typeof t!=="object"||t===null){return false}var i=Object.keys(e);var o=Object.keys(t);if(i.length!==o.length){return false}for(var a=0;a<i.length;a++){if(!r.call(t,i[a])||!n(e[i[a]],t[i[a]])){return false}}return true}t.exports=o},{}],40:[function(e,t,i){i.read=function(e,t,i,r,n){var o,a;var s=n*8-r-1;var l=(1<<s)-1;var u=l>>1;var c=-7;var d=i?n-1:0;var p=i?-1:1;var f=e[t+d];d+=p;o=f&(1<<-c)-1;f>>=-c;c+=s;for(;c>0;o=o*256+e[t+d],d+=p,c-=8){}a=o&(1<<-c)-1;o>>=-c;c+=r;for(;c>0;a=a*256+e[t+d],d+=p,c-=8){}if(o===0){o=1-u}else if(o===l){return a?NaN:(f?-1:1)*Infinity}else{a=a+Math.pow(2,r);o=o-u}return(f?-1:1)*a*Math.pow(2,o-r)};i.write=function(e,t,i,r,n,o){var a,s,l;var u=o*8-n-1;var c=(1<<u)-1;var d=c>>1;var p=n===23?Math.pow(2,-24)-Math.pow(2,-77):0;var f=r?0:o-1;var h=r?1:-1;var g=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){s=isNaN(t)?1:0;a=c}else{a=Math.floor(Math.log(t)/Math.LN2);if(t*(l=Math.pow(2,-a))<1){a--;l*=2}if(a+d>=1){t+=p/l}else{t+=p*Math.pow(2,1-d)}if(t*l>=2){a++;l/=2}if(a+d>=c){s=0;a=c}else if(a+d>=1){s=(t*l-1)*Math.pow(2,n);a=a+d}else{s=t*Math.pow(2,d-1)*Math.pow(2,n);a=0}}for(;n>=8;e[i+f]=s&255,f+=h,s/=256,n-=8){}a=a<<n|s;u+=n;for(;u>0;e[i+f]=a&255,f+=h,a/=256,u-=8){}e[i+f-h]|=g*128}},{}],41:[function(e,t,i){if(typeof Object.create==="function"){t.exports=function e(t,i){t.super_=i;t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}})}}else{t.exports=function e(t,i){t.super_=i;var r=function(){};r.prototype=i.prototype;t.prototype=new r;t.prototype.constructor=t}}},{}],42:[function(e,t,i){"use strict";var r="(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}";var n="(?:(?:[0-9a-fA-F:]){1,4}(?:(?::(?:[0-9a-fA-F]){1,4}|:)){2,7})+";var o=t.exports=function(e){e=e||{};return e.exact?new RegExp("(?:^"+r+"$)|(?:^"+n+"$)"):new RegExp("(?:"+r+")|(?:"+n+")","g")};o.v4=function(e){e=e||{};return e.exact?new RegExp("^"+r+"$"):new RegExp(r,"g")};o.v6=function(e){e=e||{};return e.exact?new RegExp("^"+n+"$"):new RegExp(n,"g")}},{}],43:[function(e,t,i){"use strict";var r=e("url-regex")({exact:true});t.exports=function(e){if(typeof e!=="string"){throw new TypeError("Expected a string")}return r.test(e.trim())}},{"url-regex":213}],44:[function(e,t,i){var r={}.toString;t.exports=Array.isArray||function(e){return r.call(e)=="[object Array]"}},{}],45:[function(e,t,i){"use strict";var r;(function(e){var t=function(){function e(){}e.prototype.expandToken=function(e){var t=[];for(var i=0,r=e.length;i<r;++i){for(var n=i;n<r;++n){t.push(e.substring(i,n+1))}}return t};return e}();e.AllSubstringsIndexStrategy=t})(r||(r={}));"use strict";var r;(function(e){var t=function(){
function e(){}e.prototype.expandToken=function(e){return e?[e]:[]};return e}();e.ExactWordIndexStrategy=t})(r||(r={}));"use strict";var r;(function(e){})(r||(r={}));"use strict";var r;(function(e){var t=function(){function e(){}e.prototype.expandToken=function(e){var t=[];for(var i=0,r=e.length;i<r;++i){t.push(e.substring(0,i+1))}return t};return e}();e.PrefixIndexStrategy=t})(r||(r={}));"use strict";var r;(function(e){var t=function(){function e(){}e.prototype.sanitize=function(e){return e?e.trim():""};return e}();e.CaseSensitiveSanitizer=t})(r||(r={}));"use strict";var r;(function(e){var t=function(){function e(){}e.prototype.sanitize=function(e){return e?e.toLocaleLowerCase().trim():""};return e}();e.LowerCaseSanitizer=t})(r||(r={}));"use strict";var r;(function(e){})(r||(r={}));"use strict";var r;(function(e){})(r||(r={}));"use strict";var r;(function(e){var t=function(){function e(e){this.uidFieldName_=e;this.tokenToIdfCache_={};this.tokenMap_={}}e.prototype.indexDocument=function(e,t,i){this.tokenToIdfCache_={};if(typeof this.tokenMap_[e]!=="object"){this.tokenMap_[e]={$numDocumentOccurrences:0,$totalNumOccurrences:1,$uidMap:{}}}else{this.tokenMap_[e].$totalNumOccurrences++}if(!this.tokenMap_[e].$uidMap[t]){this.tokenMap_[e].$numDocumentOccurrences++;this.tokenMap_[e].$uidMap[t]={$document:i,$numTokenOccurrences:1}}else{this.tokenMap_[e].$uidMap[t].$numTokenOccurrences++}};e.prototype.search=function(e,t){var i={};for(var r=0,n=e.length;r<n;r++){var o=e[r];var a=this.tokenMap_[o];if(!a){return[]}if(r===0){for(var s in a.$uidMap){i[s]=a.$uidMap[s].$document}}else{for(var s in i){if(!a.$uidMap[s]){delete i[s]}}}}var l=[];for(var s in i){l.push(i[s])}return l.sort(function(i,r){return this.calculateTfIdf_(e,r,t)-this.calculateTfIdf_(e,i,t)}.bind(this))};e.prototype.calculateIdf_=function(e,t){if(!this.tokenToIdfCache_[e]){var i=this.tokenMap_[e]&&this.tokenMap_[e].$numDocumentOccurrences||0;this.tokenToIdfCache_[e]=1+Math.log(t.length/(1+i))}return this.tokenToIdfCache_[e]};e.prototype.calculateTfIdf_=function(e,t,i){var r=0;for(var n=0,o=e.length;n<o;++n){var a=e[n];var s=this.calculateIdf_(a,i);if(s===Infinity){s=0}var l=t&&t[this.uidFieldName_];var u=this.tokenMap_[a]&&this.tokenMap_[a].$uidMap[l]&&this.tokenMap_[a].$uidMap[l].$numTokenOccurrences||0;r+=u*s}return r};return e}();e.TfIdfSearchIndex=t})(r||(r={}));"use strict";var r;(function(e){var t=function(){function e(){this.tokenToUidToDocumentMap_={}}e.prototype.indexDocument=function(e,t,i){if(!this.tokenToUidToDocumentMap_[e]){this.tokenToUidToDocumentMap_[e]={}}this.tokenToUidToDocumentMap_[e][t]=i};e.prototype.search=function(e,t){var i={};for(var r=0,n=e.length;r<n;r++){var o=e[r];var a=this.tokenToUidToDocumentMap_[o]||{};if(r===0){for(var s in a){i[s]=a[s]}}else{for(var s in i){if(!a[s]){delete i[s]}}}}var l=[];for(var s in i){l.push(i[s])}return l};return e}();e.UnorderedSearchIndex=t})(r||(r={}));"use strict";var r;(function(e){var t=function(){function t(t){this.uidFieldName_=t;this.indexStrategy_=new e.PrefixIndexStrategy;this.searchIndex_=new e.TfIdfSearchIndex(t);this.sanitizer_=new e.LowerCaseSanitizer;this.tokenizer_=new e.SimpleTokenizer;this.documents_=[];this.searchableFields=[]}Object.defineProperty(t.prototype,"indexStrategy",{get:function(){return this.indexStrategy_},set:function(e){if(this.initialized_){throw Error("IIndexStrategy cannot be set after initialization")}this.indexStrategy_=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"sanitizer",{get:function(){return this.sanitizer_},set:function(e){if(this.initialized_){throw Error("ISanitizer cannot be set after initialization")}this.sanitizer_=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"searchIndex",{get:function(){return this.searchIndex_},set:function(e){if(this.initialized_){throw Error("ISearchIndex cannot be set after initialization")}this.searchIndex_=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"tokenizer",{get:function(){return this.tokenizer_},set:function(e){if(this.initialized_){throw Error("ITokenizer cannot be set after initialization")}this.tokenizer_=e},enumerable:true,configurable:true});t.prototype.addDocument=function(e){this.addDocuments([e])};t.prototype.addDocuments=function(e){this.documents_=this.documents_.concat(e);this.indexDocuments_(e,this.searchableFields)};t.prototype.addIndex=function(e){this.searchableFields.push(e);this.indexDocuments_(this.documents_,[e])};t.prototype.search=function(e){var t=this.tokenizer_.tokenize(this.sanitizer_.sanitize(e));return this.searchIndex_.search(t,this.documents_)};t.prototype.indexDocuments_=function(e,i){this.initialized_=true;for(var r=0,n=e.length;r<n;r++){var o=e[r];var a=o[this.uidFieldName_];for(var s=0,l=i.length;s<l;s++){var u;var c=i[s];if(c instanceof Array){u=t.getNestedFieldValue(o,c)}else{u=o[c]}if(u!=null&&typeof u!=="string"&&u.toString){u=u.toString()}if(typeof u==="string"){var d=this.tokenizer_.tokenize(this.sanitizer_.sanitize(u));for(var p=0,f=d.length;p<f;p++){var h=d[p];var g=this.indexStrategy_.expandToken(h);for(var m=0,v=g.length;m<v;m++){var y=g[m];this.searchIndex_.indexDocument(y,a,o)}}}}}};t.getNestedFieldValue=function(e,t){t=t||[];e=e||{};var i=e;for(var r=0;r<t.length;r++){i=i[t[r]];if(i==null){return null}}return i};return t}();e.Search=t})(r||(r={}));"use strict";var r;(function(e){e.StopWordsMap={a:"a",able:"able",about:"about",across:"across",after:"after",all:"all",almost:"almost",also:"also",am:"am",among:"among",an:"an",and:"and",any:"any",are:"are",as:"as",at:"at",be:"be",because:"because",been:"been",but:"but",by:"by",can:"can",cannot:"cannot",could:"could",dear:"dear",did:"did",do:"do",does:"does",either:"either",else:"else",ever:"ever",every:"every",for:"for",from:"from",get:"get",got:"got",had:"had",has:"has",have:"have",he:"he",her:"her",hers:"hers",him:"him",his:"his",how:"how",however:"however",i:"i",if:"if",in:"in",into:"into",is:"is",it:"it",its:"its",just:"just",least:"least",let:"let",like:"like",likely:"likely",may:"may",me:"me",might:"might",most:"most",must:"must",my:"my",neither:"neither",no:"no",nor:"nor",not:"not",of:"of",off:"off",often:"often",on:"on",only:"only",or:"or",other:"other",our:"our",own:"own",rather:"rather",said:"said",say:"say",says:"says",she:"she",should:"should",since:"since",so:"so",some:"some",than:"than",that:"that",the:"the",their:"their",them:"them",then:"then",there:"there",these:"these",they:"they",this:"this",tis:"tis",to:"to",too:"too",twas:"twas",us:"us",wants:"wants",was:"was",we:"we",were:"were",what:"what",when:"when",where:"where",which:"which",while:"while",who:"who",whom:"whom",why:"why",will:"will",with:"with",would:"would",yet:"yet",you:"you",your:"your"}})(r||(r={}));"use strict";var r;(function(e){var t=function(){function t(t,i,r){this.indexStrategy_=t||new e.PrefixIndexStrategy;this.sanitizer_=i||new e.LowerCaseSanitizer;this.wrapperTagName_=r||"mark"}t.prototype.highlight=function(e,t){var i=this.wrapText_("").length;var r={};for(var n=0,o=t.length;n<o;n++){var a=this.sanitizer_.sanitize(t[n]);var s=this.indexStrategy_.expandToken(a);for(var l=0,u=s.length;l<u;l++){var c=s[l];if(!r[c]){r[c]=[a]}else{r[c].push(a)}}}var d="";var p="";var f=0;for(var n=0,h=e.length;n<h;n++){var g=e.charAt(n);if(g===" "){d="";p="";f=n+1}else{d+=g;p+=this.sanitizer_.sanitize(g)}if(r[p]&&r[p].indexOf(p)>=0){d=this.wrapText_(d);e=e.substring(0,f)+d+e.substring(n+1);n+=i;h+=i}}return e};t.prototype.wrapText_=function(e){return"<"+this.wrapperTagName_+">"+e+"</"+this.wrapperTagName_+">"};return t}();e.TokenHighlighter=t})(r||(r={}));"use strict";var r;(function(e){var t=function(){function e(){}e.prototype.tokenize=function(e){return e.split(/[^a-zA-Z0-9\-']+/).filter(function(e){return!!e})};return e}();e.SimpleTokenizer=t})(r||(r={}));"use strict";var r;(function(e){var t=function(){function e(e,t){this.stemmingFunction_=e;this.tokenizer_=t}e.prototype.tokenize=function(e){return this.tokenizer_.tokenize(e).map(function(e){return this.stemmingFunction_(e)},this)};return e}();e.StemmingTokenizer=t})(r||(r={}));"use strict";var r;(function(e){var t=function(){function t(e){this.tokenizer_=e}t.prototype.tokenize=function(t){return this.tokenizer_.tokenize(t).filter(function(t){return t&&e.StopWordsMap[t]!==t})};return t}();e.StopWordsTokenizer=t})(r||(r={}));"use strict";var r;(function(e){})(r||(r={}));(function(e){if(typeof t!=="undefined"&&t.exports&&e){t.exports=e}})(r||(r={}))},{}],46:[function(e,t,i){"use strict";var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e,t){var i="";var n,o,a,s,l,u,c;var d=0;while(d<e.length){n=e.charCodeAt(d++);o=e.charCodeAt(d++);a=e.charCodeAt(d++);s=n>>2;l=(n&3)<<4|o>>4;u=(o&15)<<2|a>>6;c=a&63;if(isNaN(o)){u=c=64}else if(isNaN(a)){c=64}i=i+r.charAt(s)+r.charAt(l)+r.charAt(u)+r.charAt(c)}return i};i.decode=function(e,t){var i="";var n,o,a;var s,l,u,c;var d=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(d<e.length){s=r.indexOf(e.charAt(d++));l=r.indexOf(e.charAt(d++));u=r.indexOf(e.charAt(d++));c=r.indexOf(e.charAt(d++));n=s<<2|l>>4;o=(l&15)<<4|u>>2;a=(u&3)<<6|c;i=i+String.fromCharCode(n);if(u!=64){i=i+String.fromCharCode(o)}if(c!=64){i=i+String.fromCharCode(a)}}return i}},{}],47:[function(e,t,i){"use strict";function r(){this.compressedSize=0;this.uncompressedSize=0;this.crc32=0;this.compressionMethod=null;this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}};t.exports=r},{}],48:[function(e,t,i){"use strict";i.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null};i.DEFLATE=e("./flate")},{"./flate":53}],49:[function(e,t,i){"use strict";var r=e("./utils");var n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function e(t,i){if(typeof t==="undefined"||!t.length){return 0}var o=r.getTypeOf(t)!=="string";if(typeof i=="undefined"){i=0}var a=0;var s=0;var l=0;i=i^-1;for(var u=0,c=t.length;u<c;u++){l=o?t[u]:t.charCodeAt(u);s=(i^l)&255;a=n[s];i=i>>>8^a}return i^-1}},{"./utils":66}],50:[function(e,t,i){"use strict";var r=e("./utils");function n(e){this.data=null;this.length=0;this.index=0}n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0){throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")}},setIndex:function(e){this.checkIndex(e);this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t=0,i;this.checkOffset(e);for(i=this.index+e-1;i>=this.index;i--){t=(t<<8)+this.byteAt(i)}this.index+=e;return t},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(e&31)<<1)}};t.exports=n},{"./utils":66}],51:[function(e,t,i){"use strict";i.base64=false;i.binary=false;i.dir=false;i.createFolders=false;i.date=null;i.compression=null;i.comment=null},{}],52:[function(e,t,i){"use strict";var r=e("./utils");i.string2binary=function(e){return r.string2binary(e)};i.string2Uint8Array=function(e){return r.transformTo("uint8array",e)};i.uint8Array2String=function(e){return r.transformTo("string",e)};i.string2Blob=function(e){var t=r.transformTo("arraybuffer",e);return r.arrayBuffer2Blob(t)};i.arrayBuffer2Blob=function(e){return r.arrayBuffer2Blob(e)};i.transformTo=function(e,t){return r.transformTo(e,t)};i.getTypeOf=function(e){return r.getTypeOf(e)};i.checkSupport=function(e){return r.checkSupport(e)};i.MAX_VALUE_16BITS=r.MAX_VALUE_16BITS;i.MAX_VALUE_32BITS=r.MAX_VALUE_32BITS;i.pretty=function(e){return r.pretty(e)};i.findCompression=function(e){return r.findCompression(e)};i.isRegExp=function(e){return r.isRegExp(e)}},{"./utils":66}],53:[function(e,t,i){"use strict";var r=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Uint32Array!=="undefined";var n=e("pako");i.uncompressInputType=r?"uint8array":"array";i.compressInputType=r?"uint8array":"array";i.magic="\b\0";i.compress=function(e){return n.deflateRaw(e)};i.uncompress=function(e){return n.inflateRaw(e)}},{pako:72}],54:[function(e,t,i){"use strict";var r=e("./base64");function n(e,t){if(!(this instanceof n))return new n(e,t);this.files={};this.comment=null;this.root="";if(e){this.load(e,t)}this.clone=function(){var e=new n;for(var t in this){if(typeof this[t]!=="function"){e[t]=this[t]}}return e}}n.prototype=e("./object");n.prototype.load=e("./load");n.support=e("./support");n.defaults=e("./defaults");n.utils=e("./deprecatedPublicUtils");n.base64={encode:function(e){return r.encode(e)},decode:function(e){return r.decode(e)}};n.compressions=e("./compressions");t.exports=n},{"./base64":46,"./compressions":48,"./defaults":51,"./deprecatedPublicUtils":52,"./load":55,"./object":58,"./support":62}],55:[function(e,t,i){"use strict";var r=e("./base64");var n=e("./zipEntries");t.exports=function(e,t){var i,o,a,s;t=t||{};if(t.base64){e=r.decode(e)}o=new n(e,t);i=o.files;for(a=0;a<i.length;a++){s=i[a];this.file(s.fileName,s.decompressed,{binary:true,optimizedBinaryString:true,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,createFolders:t.createFolders})}if(o.zipComment.length){this.comment=o.zipComment}return this}},{"./base64":46,"./zipEntries":67}],56:[function(e,t,i){(function(e){"use strict";t.exports=function(t,i){return new e(t,i)};t.exports.test=function(t){return e.isBuffer(t)}}).call(this,e("buffer").Buffer)},{buffer:5}],57:[function(e,t,i){"use strict";var r=e("./uint8ArrayReader");function n(e){this.data=e;this.length=this.data.length;this.index=0}n.prototype=new r;n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);this.index+=e;return t};t.exports=n},{"./uint8ArrayReader":63}],58:[function(e,t,i){"use strict";var r=e("./support");var n=e("./utils");var o=e("./crc32");var a=e("./signature");var s=e("./defaults");var l=e("./base64");var u=e("./compressions");var c=e("./compressedObject");var d=e("./nodeBuffer");var p=e("./utf8");var f=e("./stringWriter");var h=e("./uint8ArrayWriter");var g=function(e){if(e._data instanceof c){e._data=e._data.getContent();e.options.binary=true;e.options.base64=false;if(n.getTypeOf(e._data)==="uint8array"){var t=e._data;e._data=new Uint8Array(t.length);if(t.length!==0){e._data.set(t,0)}}}return e._data};var m=function(e){var t=g(e),i=n.getTypeOf(t);if(i==="string"){if(!e.options.binary){if(r.nodebuffer){return d(t,"utf-8")}}return e.asBinary()}return t};var v=function(e){var t=g(this);if(t===null||typeof t==="undefined"){return""}if(this.options.base64){t=l.decode(t)}if(e&&this.options.binary){t=M.utf8decode(t)}else{t=n.transformTo("string",t)}if(!e&&!this.options.binary){t=n.transformTo("string",M.utf8encode(t))}return t};var y=function(e,t,i){this.name=e;this.dir=i.dir;this.date=i.date;this.comment=i.comment;this._data=t;this.options=i;this._initialMetadata={dir:i.dir,date:i.date}};y.prototype={asText:function(){return v.call(this,true)},asBinary:function(){return v.call(this,false)},asNodeBuffer:function(){var e=m(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=m(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var b=function(e,t){var i="",r;for(r=0;r<t;r++){i+=String.fromCharCode(e&255);e=e>>>8}return i};var w=function(){var e={},t,i;for(t=0;t<arguments.length;t++){for(i in arguments[t]){if(arguments[t].hasOwnProperty(i)&&typeof e[i]==="undefined"){e[i]=arguments[t][i]}}}return e};var C=function(e){e=e||{};if(e.base64===true&&(e.binary===null||e.binary===undefined)){e.binary=true}e=w(e,s);e.date=e.date||new Date;if(e.compression!==null)e.compression=e.compression.toUpperCase();return e};var E=function(e,t,i){var r=n.getTypeOf(t),o;i=C(i);if(i.createFolders&&(o=S(e))){T.call(this,o,true)}if(i.dir||t===null||typeof t==="undefined"){i.base64=false;i.binary=false;t=null}else if(r==="string"){if(i.binary&&!i.base64){if(i.optimizedBinaryString!==true){t=n.string2binary(t)}}}else{i.base64=false;i.binary=true;if(!r&&!(t instanceof c)){throw new Error("The data of '"+e+"' is in an unsupported format !")}if(r==="arraybuffer"){t=n.transformTo("uint8array",t)}}var a=new y(e,t,i);this.files[e]=a;return a};var S=function(e){if(e.slice(-1)=="/"){e=e.substring(0,e.length-1)}var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""};var T=function(e,t){if(e.slice(-1)!="/"){e+="/"}t=typeof t!=="undefined"?t:false;if(!this.files[e]){E.call(this,e,null,{dir:true,createFolders:t})}return this.files[e]};var x=function(e,t){var i=new c,r;if(e._data instanceof c){i.uncompressedSize=e._data.uncompressedSize;i.crc32=e._data.crc32;if(i.uncompressedSize===0||e.dir){t=u["STORE"];i.compressedContent="";i.crc32=0}else if(e._data.compressionMethod===t.magic){i.compressedContent=e._data.getCompressedContent()}else{r=e._data.getContent();i.compressedContent=t.compress(n.transformTo(t.compressInputType,r))}}else{r=m(e);if(!r||r.length===0||e.dir){t=u["STORE"];r=""}i.uncompressedSize=r.length;i.crc32=o(r);i.compressedContent=t.compress(n.transformTo(t.compressInputType,r))}i.compressedSize=i.compressedContent.length;i.compressionMethod=t.magic;return i};var _=function(e,t,i,r){var s=i.compressedContent,l=n.transformTo("string",p.utf8encode(t.name)),u=t.comment||"",c=n.transformTo("string",p.utf8encode(u)),d=l.length!==t.name.length,f=c.length!==u.length,h=t.options,g,m,v="",y="",w="",C,E;if(t._initialMetadata.dir!==t.dir){C=t.dir}else{C=h.dir}if(t._initialMetadata.date!==t.date){E=t.date}else{E=h.date}g=E.getHours();g=g<<6;g=g|E.getMinutes();g=g<<5;g=g|E.getSeconds()/2;m=E.getFullYear()-1980;m=m<<4;m=m|E.getMonth()+1;m=m<<5;m=m|E.getDate();if(d){y=b(1,1)+b(o(l),4)+l;v+="up"+b(y.length,2)+y}if(f){w=b(1,1)+b(this.crc32(c),4)+c;v+="uc"+b(w.length,2)+w}var S="";S+="\n\0";S+=d||f?"\0\b":"\0\0";S+=i.compressionMethod;S+=b(g,2);S+=b(m,2);S+=b(i.crc32,4);S+=b(i.compressedSize,4);S+=b(i.uncompressedSize,4);S+=b(l.length,2);S+=b(v.length,2);var T=a.LOCAL_FILE_HEADER+S+l+v;var x=a.CENTRAL_FILE_HEADER+"\0"+S+b(c.length,2)+"\0\0"+"\0\0"+(C===true?"\0\0\0":"\0\0\0\0")+b(r,4)+l+v+c;return{fileRecord:T,dirRecord:x,compressedObject:i}};var M={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t=[],i,r,n,o;for(i in this.files){if(!this.files.hasOwnProperty(i)){continue}n=this.files[i];o=new y(n.name,n._data,w(n.options));r=i.slice(this.root.length,i.length);if(i.slice(0,this.root.length)===this.root&&e(r,o)){t.push(o)}}return t},file:function(e,t,i){if(arguments.length===1){if(n.isRegExp(e)){var r=e;return this.filter(function(e,t){return!t.dir&&r.test(e)})}else{return this.filter(function(t,i){return!i.dir&&t===e})[0]||null}}else{e=this.root+e;E.call(this,e,t,i)}return this},folder:function(e){if(!e){return this}if(n.isRegExp(e)){return this.filter(function(t,i){return i.dir&&e.test(t)})}var t=this.root+e;var i=T.call(this,t);var r=this.clone();r.root=i.name;return r},remove:function(e){e=this.root+e;var t=this.files[e];if(!t){if(e.slice(-1)!="/"){e+="/"}t=this.files[e]}if(t&&!t.dir){delete this.files[e]}else{var i=this.filter(function(t,i){return i.name.slice(0,e.length)===e});for(var r=0;r<i.length;r++){delete this.files[i[r].name]}}return this},generate:function(e){e=w(e||{},{base64:true,compression:"STORE",type:"base64",comment:null});n.checkSupport(e.type);var t=[],i=0,r=0,o,s,c=n.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var d in this.files){if(!this.files.hasOwnProperty(d)){continue}var p=this.files[d];var g=p.options.compression||e.compression.toUpperCase();var m=u[g];if(!m){throw new Error(g+" is not a valid compression method !")}var v=x.call(this,p,m);var y=_.call(this,d,p,v,i);i+=y.fileRecord.length+v.compressedSize;r+=y.dirRecord.length;t.push(y)}var C="";C=a.CENTRAL_DIRECTORY_END+"\0\0"+"\0\0"+b(t.length,2)+b(t.length,2)+b(r,4)+b(i,4)+b(c.length,2)+c;var E=e.type.toLowerCase();if(E==="uint8array"||E==="arraybuffer"||E==="blob"||E==="nodebuffer"){o=new h(i+r+C.length)}else{o=new f(i+r+C.length)}for(s=0;s<t.length;s++){o.append(t[s].fileRecord);o.append(t[s].compressedObject.compressedContent)}for(s=0;s<t.length;s++){o.append(t[s].dirRecord)}o.append(C);var S=o.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),S);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",S));case"base64":return e.base64?l.encode(S):S;default:return S}},crc32:function(e,t){return o(e,t)},utf8encode:function(e){return n.transformTo("string",p.utf8encode(e))},utf8decode:function(e){return p.utf8decode(e)}};t.exports=M},{"./base64":46,"./compressedObject":47,"./compressions":48,"./crc32":49,"./defaults":51,"./nodeBuffer":56,"./signature":59,"./stringWriter":61,"./support":62,"./uint8ArrayWriter":64,"./utf8":65,"./utils":66}],59:[function(e,t,i){"use strict";i.LOCAL_FILE_HEADER="PK";i.CENTRAL_FILE_HEADER="PK";i.CENTRAL_DIRECTORY_END="PK";i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK";i.ZIP64_CENTRAL_DIRECTORY_END="PK";i.DATA_DESCRIPTOR="PK\b"},{}],60:[function(e,t,i){"use strict";var r=e("./dataReader");var n=e("./utils");function o(e,t){this.data=e;if(!t){this.data=n.string2binary(this.data)}this.length=this.data.length;this.index=0}o.prototype=new r;o.prototype.byteAt=function(e){return this.data.charCodeAt(e)};o.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)};o.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);this.index+=e;return t};t.exports=o},{"./dataReader":50,"./utils":66}],61:[function(e,t,i){"use strict";var r=e("./utils");var n=function(){this.data=[]};n.prototype={append:function(e){e=r.transformTo("string",e);this.data.push(e)},finalize:function(){return this.data.join("")}};t.exports=n},{"./utils":66}],62:[function(e,t,i){(function(e){"use strict";i.base64=true;i.array=true;i.string=true;i.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";i.nodebuffer=typeof e!=="undefined";i.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer==="undefined"){i.blob=false}else{var t=new ArrayBuffer(0);try{i.blob=new Blob([t],{type:"application/zip"}).size===0}catch(e){try{var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var n=new r;n.append(t);i.blob=n.getBlob("application/zip").size===0}catch(e){i.blob=false}}}}).call(this,e("buffer").Buffer)},{buffer:5}],63:[function(e,t,i){"use strict";var r=e("./dataReader");function n(e){if(e){this.data=e;this.length=this.data.length;this.index=0}}n.prototype=new r;n.prototype.byteAt=function(e){return this.data[e]};n.prototype.lastIndexOfSignature=function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),n=e.charCodeAt(3);for(var o=this.length-4;o>=0;--o){if(this.data[o]===t&&this.data[o+1]===i&&this.data[o+2]===r&&this.data[o+3]===n){return o}}return-1};n.prototype.readData=function(e){this.checkOffset(e);if(e===0){return new Uint8Array(0)}var t=this.data.subarray(this.index,this.index+e);this.index+=e;return t};t.exports=n},{"./dataReader":50}],64:[function(e,t,i){"use strict";var r=e("./utils");var n=function(e){this.data=new Uint8Array(e);this.index=0};n.prototype={append:function(e){if(e.length!==0){e=r.transformTo("uint8array",e);this.data.set(e,this.index);this.index+=e.length}},finalize:function(){return this.data}};t.exports=n},{"./utils":66}],65:[function(e,t,i){"use strict";var r=e("./utils");var n=e("./support");var o=e("./nodeBuffer");var a=new Array(256);for(var s=0;s<256;s++){a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1}a[254]=a[254]=1;var l=function(e){var t,i,r,o,a,s=e.length,l=0;for(o=0;o<s;o++){i=e.charCodeAt(o);if((i&64512)===55296&&o+1<s){r=e.charCodeAt(o+1);if((r&64512)===56320){i=65536+(i-55296<<10)+(r-56320);o++}}l+=i<128?1:i<2048?2:i<65536?3:4}if(n.uint8array){t=new Uint8Array(l)}else{t=new Array(l)}for(a=0,o=0;a<l;o++){i=e.charCodeAt(o);if((i&64512)===55296&&o+1<s){r=e.charCodeAt(o+1);if((r&64512)===56320){i=65536+(i-55296<<10)+(r-56320);o++}}if(i<128){t[a++]=i}else if(i<2048){t[a++]=192|i>>>6;t[a++]=128|i&63}else if(i<65536){t[a++]=224|i>>>12;t[a++]=128|i>>>6&63;t[a++]=128|i&63}else{t[a++]=240|i>>>18;t[a++]=128|i>>>12&63;t[a++]=128|i>>>6&63;t[a++]=128|i&63}}return t};var u=function(e,t){var i;t=t||e.length;if(t>e.length){t=e.length}i=t-1;while(i>=0&&(e[i]&192)===128){i--}if(i<0){return t}if(i===0){return t}return i+a[e[i]]>t?i:t};var c=function(e){var t,i,n,o,s;var l=e.length;var u=new Array(l*2);for(n=0,i=0;i<l;){o=e[i++];if(o<128){u[n++]=o;continue}s=a[o];if(s>4){u[n++]=65533;i+=s-1;continue}o&=s===2?31:s===3?15:7;while(s>1&&i<l){o=o<<6|e[i++]&63;s--}if(s>1){u[n++]=65533;continue}if(o<65536){u[n++]=o}else{o-=65536;u[n++]=55296|o>>10&1023;u[n++]=56320|o&1023}}if(u.length!==n){if(u.subarray){u=u.subarray(0,n)}else{u.length=n}}return r.applyFromCharCode(u)};i.utf8encode=function e(t){if(n.nodebuffer){return o(t,"utf-8")}return l(t)};i.utf8decode=function e(t){if(n.nodebuffer){return r.transformTo("nodebuffer",t).toString("utf-8")}t=r.transformTo(n.uint8array?"uint8array":"array",t);var i=[],o=0,a=t.length,s=65536;while(o<a){var l=u(t,Math.min(o+s,a));if(n.uint8array){i.push(c(t.subarray(o,l)))}else{i.push(c(t.slice(o,l)))}o=l}return i.join("")}},{"./nodeBuffer":56,"./support":62,"./utils":66}],66:[function(e,t,i){"use strict";var r=e("./support");var n=e("./compressions");var o=e("./nodeBuffer");i.string2binary=function(e){var t="";for(var i=0;i<e.length;i++){t+=String.fromCharCode(e.charCodeAt(i)&255)}return t};i.arrayBuffer2Blob=function(e){i.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(i){try{var t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var r=new t;r.append(e);return r.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}};function a(e){return e}function s(e,t){for(var i=0;i<e.length;++i){t[i]=e.charCodeAt(i)&255}return t}function l(e){var t=65536;var r=[],n=e.length,a=i.getTypeOf(e),s=0,l=true;try{switch(a){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,o(0));break}}catch(e){l=false}if(!l){var u="";for(var c=0;c<e.length;c++){u+=String.fromCharCode(e[c])}return u}while(s<n&&t>1){try{if(a==="array"||a==="nodebuffer"){r.push(String.fromCharCode.apply(null,e.slice(s,Math.min(s+t,n))))}else{r.push(String.fromCharCode.apply(null,e.subarray(s,Math.min(s+t,n))))}s+=t}catch(e){t=Math.floor(t/2)}}return r.join("")}i.applyFromCharCode=l;function u(e,t){for(var i=0;i<e.length;i++){t[i]=e[i]}return t}var c={};c["string"]={string:a,array:function(e){return s(e,new Array(e.length))},arraybuffer:function(e){return c["string"]["uint8array"](e).buffer},uint8array:function(e){return s(e,new Uint8Array(e.length))},nodebuffer:function(e){return s(e,o(e.length))}};c["array"]={string:l,array:a,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o(e)}};c["arraybuffer"]={string:function(e){return l(new Uint8Array(e))},array:function(e){return u(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:a,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o(new Uint8Array(e))}};c["uint8array"]={string:l,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:a,nodebuffer:function(e){return o(e)}};c["nodebuffer"]={string:l,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return c["nodebuffer"]["uint8array"](e).buffer},uint8array:function(e){return u(e,new Uint8Array(e.length))},nodebuffer:a};i.transformTo=function(e,t){if(!t){t=""}if(!e){return t}i.checkSupport(e);var r=i.getTypeOf(t);var n=c[r][e](t);return n};i.getTypeOf=function(e){if(typeof e==="string"){return"string"}if(Object.prototype.toString.call(e)==="[object Array]"){return"array"}if(r.nodebuffer&&o.test(e)){return"nodebuffer"}if(r.uint8array&&e instanceof Uint8Array){return"uint8array"}if(r.arraybuffer&&e instanceof ArrayBuffer){return"arraybuffer"}};i.checkSupport=function(e){var t=r[e.toLowerCase()];if(!t){throw new Error(e+" is not supported by this browser")}};i.MAX_VALUE_16BITS=65535;i.MAX_VALUE_32BITS=-1;i.pretty=function(e){var t="",i,r;for(r=0;r<(e||"").length;r++){i=e.charCodeAt(r);t+="\\x"+(i<16?"0":"")+i.toString(16).toUpperCase()}return t};i.findCompression=function(e){for(var t in n){if(!n.hasOwnProperty(t)){continue}if(n[t].magic===e){return n[t]}}return null};i.isRegExp=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"}},{"./compressions":48,"./nodeBuffer":56,"./support":62}],67:[function(e,t,i){"use strict";var r=e("./stringReader");var n=e("./nodeBufferReader");var o=e("./uint8ArrayReader");var a=e("./utils");var s=e("./signature");var l=e("./zipEntry");var u=e("./support");var c=e("./object");function d(e,t){this.files=[];this.loadOptions=t;if(e){this.load(e);
}}d.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e){throw new Error("Corrupted zip or bug : unexpected signature "+"("+a.pretty(t)+", expected "+a.pretty(e)+")")}},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);this.zipComment=this.reader.readString(this.zipCommentLength);this.zipComment=c.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.versionMadeBy=this.reader.readString(2);this.versionNeeded=this.reader.readInt(2);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};var e=this.zip64EndOfCentralSize-44,t=0,i,r,n;while(t<e){i=this.reader.readInt(2);r=this.reader.readInt(4);n=this.reader.readString(r);this.zip64ExtensibleData[i]={id:i,length:r,value:n}}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1){throw new Error("Multi-volumes zip are not supported")}},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++){t=this.files[e];this.reader.setIndex(t.localHeaderOffset);this.checkSignature(s.LOCAL_FILE_HEADER);t.readLocalPart(this.reader);t.handleUTF8()}},readCentralDir:function(){var e;this.reader.setIndex(this.centralDirOffset);while(this.reader.readString(4)===s.CENTRAL_FILE_HEADER){e=new l({zip64:this.zip64},this.loadOptions);e.readCentralPart(this.reader);this.files.push(e)}},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e===-1){throw new Error("Corrupted zip : can't find end of central directory")}this.reader.setIndex(e);this.checkSignature(s.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){this.zip64=true;e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(e===-1){throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator")}this.reader.setIndex(e);this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=a.getTypeOf(e);if(t==="string"&&!u.uint8array){this.reader=new r(e,this.loadOptions.optimizedBinaryString)}else if(t==="nodebuffer"){this.reader=new n(e)}else{this.reader=new o(a.transformTo("uint8array",e))}},load:function(e){this.prepareReader(e);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};t.exports=d},{"./nodeBufferReader":57,"./object":58,"./signature":59,"./stringReader":60,"./support":62,"./uint8ArrayReader":63,"./utils":66,"./zipEntry":68}],68:[function(e,t,i){"use strict";var r=e("./stringReader");var n=e("./utils");var o=e("./compressedObject");var a=e("./object");function s(e,t){this.options=e;this.loadOptions=t}s.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},prepareCompressedContent:function(e,t,i){return function(){var r=e.index;e.setIndex(t);var n=e.readData(i);e.setIndex(r);return n}},prepareContent:function(e,t,i,r,o){return function(){var e=n.transformTo(r.uncompressInputType,this.getCompressedContent());var t=r.uncompress(e);if(t.length!==o){throw new Error("Bug : uncompressed data size mismatch")}return t}},readLocalPart:function(e){var t,i;e.skip(22);this.fileNameLength=e.readInt(2);i=e.readInt(2);this.fileName=e.readString(this.fileNameLength);e.skip(i);if(this.compressedSize==-1||this.uncompressedSize==-1){throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory "+"(compressedSize == -1 || uncompressedSize == -1)")}t=n.findCompression(this.compressionMethod);if(t===null){throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")")}this.decompressed=new o;this.decompressed.compressedSize=this.compressedSize;this.decompressed.uncompressedSize=this.uncompressedSize;this.decompressed.crc32=this.crc32;this.decompressed.compressionMethod=this.compressionMethod;this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t);this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize);if(this.loadOptions.checkCRC32){this.decompressed=n.transformTo("string",this.decompressed.getContent());if(a.crc32(this.decompressed)!==this.crc32){throw new Error("Corrupted zip : CRC32 mismatch")}}},readCentralPart:function(e){this.versionMadeBy=e.readString(2);this.versionNeeded=e.readInt(2);this.bitFlag=e.readInt(2);this.compressionMethod=e.readString(2);this.date=e.readDate();this.crc32=e.readInt(4);this.compressedSize=e.readInt(4);this.uncompressedSize=e.readInt(4);this.fileNameLength=e.readInt(2);this.extraFieldsLength=e.readInt(2);this.fileCommentLength=e.readInt(2);this.diskNumberStart=e.readInt(2);this.internalFileAttributes=e.readInt(2);this.externalFileAttributes=e.readInt(4);this.localHeaderOffset=e.readInt(4);if(this.isEncrypted()){throw new Error("Encrypted zip are not supported")}this.fileName=e.readString(this.fileNameLength);this.readExtraFields(e);this.parseZIP64ExtraField(e);this.fileComment=e.readString(this.fileCommentLength);this.dir=this.externalFileAttributes&16?true:false},parseZIP64ExtraField:function(e){if(!this.extraFields[1]){return}var t=new r(this.extraFields[1].value);if(this.uncompressedSize===n.MAX_VALUE_32BITS){this.uncompressedSize=t.readInt(8)}if(this.compressedSize===n.MAX_VALUE_32BITS){this.compressedSize=t.readInt(8)}if(this.localHeaderOffset===n.MAX_VALUE_32BITS){this.localHeaderOffset=t.readInt(8)}if(this.diskNumberStart===n.MAX_VALUE_32BITS){this.diskNumberStart=t.readInt(4)}},readExtraFields:function(e){var t=e.index,i,r,n;this.extraFields=this.extraFields||{};while(e.index<t+this.extraFieldsLength){i=e.readInt(2);r=e.readInt(2);n=e.readString(r);this.extraFields[i]={id:i,length:r,value:n}}},handleUTF8:function(){if(this.useUTF8()){this.fileName=a.utf8decode(this.fileName);this.fileComment=a.utf8decode(this.fileComment)}else{var e=this.findExtraFieldUnicodePath();if(e!==null){this.fileName=e}var t=this.findExtraFieldUnicodeComment();if(t!==null){this.fileComment=t}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new r(e.value);if(t.readInt(1)!==1){return null}if(a.crc32(this.fileName)!==t.readInt(4)){return null}return a.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new r(e.value);if(t.readInt(1)!==1){return null}if(a.crc32(this.fileComment)!==t.readInt(4)){return null}return a.utf8decode(t.readString(e.length-5))}return null}};t.exports=s},{"./compressedObject":47,"./object":58,"./stringReader":60,"./utils":66}],69:[function(e,t,i){t.exports=function e(t,i,a){var s=document.head||document.getElementsByTagName("head")[0];var l=document.createElement("script");if(typeof i==="function"){a=i;i={}}i=i||{};a=a||function(){};l.type=i.type||"text/javascript";l.charset=i.charset||"utf8";l.async="async"in i?!!i.async:true;l.src=t;if(i.attrs){r(l,i.attrs)}if(i.text){l.text=""+i.text}var u="onload"in l?n:o;u(l,a);if(!l.onload){n(l,a)}s.appendChild(l)};function r(e,t){for(var i in t){e.setAttribute(i,t[i])}}function n(e,t){e.onload=function(){this.onerror=this.onload=null;t(null,e)};e.onerror=function(){this.onerror=this.onload=null;t(new Error("Failed to load "+this.src),e)}}function o(e,t){e.onreadystatechange=function(){if(this.readyState!="complete"&&this.readyState!="loaded")return;this.onreadystatechange=null;t(null,e)}}},{}],70:[function(e,i,r){(function(e){(function(){var n;var o="4.17.2";var a=200;var s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function";var u="__lodash_hash_undefined__";var c=500;var d="__lodash_placeholder__";var p=1,f=2,h=4;var g=1,m=2;var v=1,y=2,b=4,w=8,C=16,E=32,S=64,T=128,x=256,_=512;var M=30,A="...";var I=800,O=16;var D=1,N=2,R=3;var P=1/0,L=9007199254740991,k=1.7976931348623157e308,$=0/0;var F=4294967295,V=F-1,q=F>>>1;var H=[["ary",T],["bind",v],["bindKey",y],["curry",w],["curryRight",C],["flip",_],["partial",E],["partialRight",S],["rearg",x]];var U="[object Arguments]",B="[object Array]",z="[object AsyncFunction]",j="[object Boolean]",G="[object Date]",W="[object DOMException]",Q="[object Error]",K="[object Function]",Y="[object GeneratorFunction]",X="[object Map]",J="[object Number]",Z="[object Null]",ee="[object Object]",te="[object Promise]",ie="[object Proxy]",re="[object RegExp]",ne="[object Set]",oe="[object String]",ae="[object Symbol]",se="[object Undefined]",le="[object WeakMap]",ue="[object WeakSet]";var ce="[object ArrayBuffer]",de="[object DataView]",pe="[object Float32Array]",fe="[object Float64Array]",he="[object Int8Array]",ge="[object Int16Array]",me="[object Int32Array]",ve="[object Uint8Array]",ye="[object Uint8ClampedArray]",be="[object Uint16Array]",we="[object Uint32Array]";var Ce=/\b__p \+= '';/g,Ee=/\b(__p \+=) '' \+/g,Se=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var Te=/&(?:amp|lt|gt|quot|#39);/g,xe=/[&<>"']/g,_e=RegExp(Te.source),Me=RegExp(xe.source);var Ae=/<%-([\s\S]+?)%>/g,Ie=/<%([\s\S]+?)%>/g,Oe=/<%=([\s\S]+?)%>/g;var De=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ne=/^\w*$/,Re=/^\./,Pe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var Le=/[\\^$.*+?()[\]{}|]/g,ke=RegExp(Le.source);var $e=/^\s+|\s+$/g,Fe=/^\s+/,Ve=/\s+$/;var qe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,He=/\{\n\/\* \[wrapped with (.+)\] \*/,Ue=/,? & /;var Be=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var ze=/\\(\\)?/g;var je=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var Ge=/\w*$/;var We=/^[-+]0x[0-9a-f]+$/i;var Qe=/^0b[01]+$/i;var Ke=/^\[object .+?Constructor\]$/;var Ye=/^0o[0-7]+$/i;var Xe=/^(?:0|[1-9]\d*)$/;var Je=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g;var Ze=/($^)/;var et=/['\n\r\u2028\u2029\\]/g;var tt="\\ud800-\\udfff",it="\\u0300-\\u036f",rt="\\ufe20-\\ufe2f",nt="\\u20d0-\\u20ff",ot=it+rt+nt,at="\\u2700-\\u27bf",st="a-z\\xdf-\\xf6\\xf8-\\xff",lt="\\xac\\xb1\\xd7\\xf7",ut="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ct="\\u2000-\\u206f",dt=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pt="A-Z\\xc0-\\xd6\\xd8-\\xde",ft="\\ufe0e\\ufe0f",ht=lt+ut+ct+dt;var gt="['â]",mt="["+tt+"]",vt="["+ht+"]",yt="["+ot+"]",bt="\\d+",wt="["+at+"]",Ct="["+st+"]",Et="[^"+tt+ht+bt+at+st+pt+"]",St="\\ud83c[\\udffb-\\udfff]",Tt="(?:"+yt+"|"+St+")",xt="[^"+tt+"]",_t="(?:\\ud83c[\\udde6-\\uddff]){2}",Mt="[\\ud800-\\udbff][\\udc00-\\udfff]",At="["+pt+"]",It="\\u200d";var Ot="(?:"+Ct+"|"+Et+")",Dt="(?:"+At+"|"+Et+")",Nt="(?:"+gt+"(?:d|ll|m|re|s|t|ve))?",Rt="(?:"+gt+"(?:D|LL|M|RE|S|T|VE))?",Pt=Tt+"?",Lt="["+ft+"]?",kt="(?:"+It+"(?:"+[xt,_t,Mt].join("|")+")"+Lt+Pt+")*",$t="\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)",Ft="\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)",Vt=Lt+Pt+kt,qt="(?:"+[wt,_t,Mt].join("|")+")"+Vt,Ht="(?:"+[xt+yt+"?",yt,_t,Mt,mt].join("|")+")";var Ut=RegExp(gt,"g");var Bt=RegExp(yt,"g");var zt=RegExp(St+"(?="+St+")|"+Ht+Vt,"g");var jt=RegExp([At+"?"+Ct+"+"+Nt+"(?="+[vt,At,"$"].join("|")+")",Dt+"+"+Rt+"(?="+[vt,At+Ot,"$"].join("|")+")",At+"?"+Ot+"+"+Nt,At+"+"+Rt,Ft,$t,bt,qt].join("|"),"g");var Gt=RegExp("["+It+tt+ot+ft+"]");var Wt=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var Qt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"];var Kt=-1;var Yt={};Yt[pe]=Yt[fe]=Yt[he]=Yt[ge]=Yt[me]=Yt[ve]=Yt[ye]=Yt[be]=Yt[we]=true;Yt[U]=Yt[B]=Yt[ce]=Yt[j]=Yt[de]=Yt[G]=Yt[Q]=Yt[K]=Yt[X]=Yt[J]=Yt[ee]=Yt[re]=Yt[ne]=Yt[oe]=Yt[le]=false;var Xt={};Xt[U]=Xt[B]=Xt[ce]=Xt[de]=Xt[j]=Xt[G]=Xt[pe]=Xt[fe]=Xt[he]=Xt[ge]=Xt[me]=Xt[X]=Xt[J]=Xt[ee]=Xt[re]=Xt[ne]=Xt[oe]=Xt[ae]=Xt[ve]=Xt[ye]=Xt[be]=Xt[we]=true;Xt[Q]=Xt[K]=Xt[le]=false;var Jt={"Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã":"C","Ã§":"c","Ã":"D","Ã°":"d","Ã":"E","Ã":"E","Ã":"E","Ã":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã":"I","Ã":"I","Ã":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã":"N","Ã±":"n","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã":"U","Ã":"U","Ã":"U","Ã":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã":"Ae","Ã¦":"ae","Ã":"Th","Ã¾":"th","Ã":"ss","Ä":"A","Ä":"A","Ä":"A","Ä":"a","Ä":"a","Ä":"a","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"D","Ä":"D","Ä":"d","Ä":"d","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"G","Ä":"G","Ä ":"G","Ä¢":"G","Ä":"g","Ä":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å":"l","Å":"l","Å":"N","Å":"N","Å":"N","Å":"N","Å":"n","Å":"n","Å":"n","Å":"n","Å":"O","Å":"O","Å":"O","Å":"o","Å":"o","Å":"o","Å":"R","Å":"R","Å":"R","Å":"r","Å":"r","Å":"r","Å":"S","Å":"S","Å":"S","Å ":"S","Å":"s","Å":"s","Å":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å":"Oe","Å":"oe","Å":"'n","Å¿":"s"};var Zt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var ei={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};var ti={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var ii=parseFloat,ri=parseInt;var ni=typeof e=="object"&&e&&e.Object===Object&&e;var oi=typeof self=="object"&&self&&self.Object===Object&&self;var ai=ni||oi||Function("return this")();var si=typeof r=="object"&&r&&!r.nodeType&&r;var li=si&&typeof i=="object"&&i&&!i.nodeType&&i;var ui=li&&li.exports===si;var ci=ui&&ni.process;var di=function(){try{return ci&&ci.binding&&ci.binding("util")}catch(e){}}();var pi=di&&di.isArrayBuffer,fi=di&&di.isDate,hi=di&&di.isMap,gi=di&&di.isRegExp,mi=di&&di.isSet,vi=di&&di.isTypedArray;function yi(e,t){e.set(t[0],t[1]);return e}function bi(e,t){e.add(t);return e}function wi(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function Ci(e,t,i,r){var n=-1,o=e==null?0:e.length;while(++n<o){var a=e[n];t(r,a,i(a),e)}return r}function Ei(e,t){var i=-1,r=e==null?0:e.length;while(++i<r){if(t(e[i],i,e)===false){break}}return e}function Si(e,t){var i=e==null?0:e.length;while(i--){if(t(e[i],i,e)===false){break}}return e}function Ti(e,t){var i=-1,r=e==null?0:e.length;while(++i<r){if(!t(e[i],i,e)){return false}}return true}function xi(e,t){var i=-1,r=e==null?0:e.length,n=0,o=[];while(++i<r){var a=e[i];if(t(a,i,e)){o[n++]=a}}return o}function _i(e,t){var i=e==null?0:e.length;return!!i&&Fi(e,t,0)>-1}function Mi(e,t,i){var r=-1,n=e==null?0:e.length;while(++r<n){if(i(t,e[r])){return true}}return false}function Ai(e,t){var i=-1,r=e==null?0:e.length,n=Array(r);while(++i<r){n[i]=t(e[i],i,e)}return n}function Ii(e,t){var i=-1,r=t.length,n=e.length;while(++i<r){e[n+i]=t[i]}return e}function Oi(e,t,i,r){var n=-1,o=e==null?0:e.length;if(r&&o){i=e[++n]}while(++n<o){i=t(i,e[n],n,e)}return i}function Di(e,t,i,r){var n=e==null?0:e.length;if(r&&n){i=e[--n]}while(n--){i=t(i,e[n],n,e)}return i}function Ni(e,t){var i=-1,r=e==null?0:e.length;while(++i<r){if(t(e[i],i,e)){return true}}return false}var Ri=Ui("length");function Pi(e){return e.split("")}function Li(e){return e.match(Be)||[]}function ki(e,t,i){var r;i(e,function(e,i,n){if(t(e,i,n)){r=i;return false}});return r}function $i(e,t,i,r){var n=e.length,o=i+(r?1:-1);while(r?o--:++o<n){if(t(e[o],o,e)){return o}}return-1}function Fi(e,t,i){return t===t?fr(e,t,i):$i(e,qi,i)}function Vi(e,t,i,r){var n=i-1,o=e.length;while(++n<o){if(r(e[n],t)){return n}}return-1}function qi(e){return e!==e}function Hi(e,t){var i=e==null?0:e.length;return i?Gi(e,t)/i:$}function Ui(e){return function(t){return t==null?n:t[e]}}function Bi(e){return function(t){return e==null?n:e[t]}}function zi(e,t,i,r,n){n(e,function(e,n,o){i=r?(r=false,e):t(i,e,n,o)});return i}function ji(e,t){var i=e.length;e.sort(t);while(i--){e[i]=e[i].value}return e}function Gi(e,t){var i,r=-1,o=e.length;while(++r<o){var a=t(e[r]);if(a!==n){i=i===n?a:i+a}}return i}function Wi(e,t){var i=-1,r=Array(e);while(++i<e){r[i]=t(i)}return r}function Qi(e,t){return Ai(t,function(t){return[t,e[t]]})}function Ki(e){return function(t){return e(t)}}function Yi(e,t){return Ai(t,function(t){return e[t]})}function Xi(e,t){return e.has(t)}function Ji(e,t){var i=-1,r=e.length;while(++i<r&&Fi(t,e[i],0)>-1){}return i}function Zi(e,t){var i=e.length;while(i--&&Fi(t,e[i],0)>-1){}return i}function er(e,t){var i=e.length,r=0;while(i--){if(e[i]===t){++r}}return r}var tr=Bi(Jt);var ir=Bi(Zt);function rr(e){return"\\"+ti[e]}function nr(e,t){return e==null?n:e[t]}function or(e){return Gt.test(e)}function ar(e){return Wt.test(e)}function sr(e){var t,i=[];while(!(t=e.next()).done){i.push(t.value)}return i}function lr(e){var t=-1,i=Array(e.size);e.forEach(function(e,r){i[++t]=[r,e]});return i}function ur(e,t){return function(i){return e(t(i))}}function cr(e,t){var i=-1,r=e.length,n=0,o=[];while(++i<r){var a=e[i];if(a===t||a===d){e[i]=d;o[n++]=i}}return o}function dr(e){var t=-1,i=Array(e.size);e.forEach(function(e){i[++t]=e});return i}function pr(e){var t=-1,i=Array(e.size);e.forEach(function(e){i[++t]=[e,e]});return i}function fr(e,t,i){var r=i-1,n=e.length;while(++r<n){if(e[r]===t){return r}}return-1}function hr(e,t,i){var r=i+1;while(r--){if(e[r]===t){return r}}return r}function gr(e){return or(e)?yr(e):Ri(e)}function mr(e){return or(e)?br(e):Pi(e)}var vr=Bi(ei);function yr(e){var t=zt.lastIndex=0;while(zt.test(e)){++t}return t}function br(e){return e.match(zt)||[]}function wr(e){return e.match(jt)||[]}var Cr=function e(t){t=t==null?ai:Er.defaults(ai.Object(),t,Er.pick(ai,Qt));var i=t.Array,r=t.Date,Be=t.Error,tt=t.Function,it=t.Math,rt=t.Object,nt=t.RegExp,ot=t.String,at=t.TypeError;var st=i.prototype,lt=tt.prototype,ut=rt.prototype;var ct=t["__core-js_shared__"];var dt=lt.toString;var pt=ut.hasOwnProperty;var ft=0;var ht=function(){var e=/[^.]+$/.exec(ct&&ct.keys&&ct.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var gt=ut.toString;var mt=dt.call(rt);var vt=ai._;var yt=nt("^"+dt.call(pt).replace(Le,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var bt=ui?t.Buffer:n,wt=t.Symbol,Ct=t.Uint8Array,Et=bt?bt.allocUnsafe:n,St=ur(rt.getPrototypeOf,rt),Tt=rt.create,xt=ut.propertyIsEnumerable,_t=st.splice,Mt=wt?wt.isConcatSpreadable:n,At=wt?wt.iterator:n,It=wt?wt.toStringTag:n;var Ot=function(){try{var e=Qa(rt,"defineProperty");e({},"",{});return e}catch(e){}}();var Dt=t.clearTimeout!==ai.clearTimeout&&t.clearTimeout,Nt=r&&r.now!==ai.Date.now&&r.now,Rt=t.setTimeout!==ai.setTimeout&&t.setTimeout;var Pt=it.ceil,Lt=it.floor,kt=rt.getOwnPropertySymbols,$t=bt?bt.isBuffer:n,Ft=t.isFinite,Vt=st.join,qt=ur(rt.keys,rt),Ht=it.max,zt=it.min,jt=r.now,Gt=t.parseInt,Wt=it.random,Jt=st.reverse;var Zt=Qa(t,"DataView"),ei=Qa(t,"Map"),ti=Qa(t,"Promise"),ni=Qa(t,"Set"),oi=Qa(t,"WeakMap"),si=Qa(rt,"create");var li=oi&&new oi;var ci={};var di=Rs(Zt),Ri=Rs(ei),Pi=Rs(ti),Bi=Rs(ni),fr=Rs(oi);var yr=wt?wt.prototype:n,br=yr?yr.valueOf:n,Cr=yr?yr.toString:n;function Sr(e){if(_c(e)&&!uc(e)&&!(e instanceof Mr)){if(e instanceof _r){return e}if(pt.call(e,"__wrapped__")){return Ls(e)}}return new _r(e)}var Tr=function(){function e(){}return function(t){if(!xc(t)){return{}}if(Tt){return Tt(t)}e.prototype=t;var i=new e;e.prototype=n;return i}}();function xr(){}function _r(e,t){this.__wrapped__=e;this.__actions__=[];this.__chain__=!!t;this.__index__=0;this.__values__=n}Sr.templateSettings={escape:Ae,evaluate:Ie,interpolate:Oe,variable:"",imports:{_:Sr}};Sr.prototype=xr.prototype;Sr.prototype.constructor=Sr;_r.prototype=Tr(xr.prototype);_r.prototype.constructor=_r;function Mr(e){this.__wrapped__=e;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=F;this.__views__=[]}function Ar(){var e=new Mr(this.__wrapped__);e.__actions__=la(this.__actions__);e.__dir__=this.__dir__;e.__filtered__=this.__filtered__;e.__iteratees__=la(this.__iteratees__);e.__takeCount__=this.__takeCount__;e.__views__=la(this.__views__);return e}function Ir(){if(this.__filtered__){var e=new Mr(this);e.__dir__=-1;e.__filtered__=true}else{e=this.clone();e.__dir__*=-1}return e}function Or(){var e=this.__wrapped__.value(),t=this.__dir__,i=uc(e),r=t<0,n=i?e.length:0,o=Za(0,n,this.__views__),s=o.start,l=o.end,u=l-s,c=r?l:s-1,d=this.__iteratees__,p=d.length,f=0,h=zt(u,this.__takeCount__);if(!i||n<a||n==u&&h==u){return Ho(e,this.__actions__)}var g=[];e:while(u--&&f<h){c+=t;var m=-1,v=e[c];while(++m<p){var y=d[m],b=y.iteratee,w=y.type,C=b(v);if(w==N){v=C}else if(!C){if(w==D){continue e}else{break e}}}g[f++]=v}return g}Mr.prototype=Tr(xr.prototype);Mr.prototype.constructor=Mr;function Dr(e){var t=-1,i=e==null?0:e.length;this.clear();while(++t<i){var r=e[t];this.set(r[0],r[1])}}function Nr(){this.__data__=si?si(null):{};this.size=0}function Rr(e){var t=this.has(e)&&delete this.__data__[e];this.size-=t?1:0;return t}function Pr(e){var t=this.__data__;if(si){var i=t[e];return i===u?n:i}return pt.call(t,e)?t[e]:n}function Lr(e){var t=this.__data__;return si?t[e]!==n:pt.call(t,e)}function kr(e,t){var i=this.__data__;this.size+=this.has(e)?0:1;i[e]=si&&t===n?u:t;return this}Dr.prototype.clear=Nr;Dr.prototype["delete"]=Rr;Dr.prototype.get=Pr;Dr.prototype.has=Lr;Dr.prototype.set=kr;function $r(e){var t=-1,i=e==null?0:e.length;this.clear();while(++t<i){var r=e[t];this.set(r[0],r[1])}}function Fr(){this.__data__=[];this.size=0}function Vr(e){var t=this.__data__,i=pn(t,e);if(i<0){return false}var r=t.length-1;if(i==r){t.pop()}else{_t.call(t,i,1)}--this.size;return true}function qr(e){var t=this.__data__,i=pn(t,e);return i<0?n:t[i][1]}function Hr(e){return pn(this.__data__,e)>-1}function Ur(e,t){var i=this.__data__,r=pn(i,e);if(r<0){++this.size;i.push([e,t])}else{i[r][1]=t}return this}$r.prototype.clear=Fr;$r.prototype["delete"]=Vr;$r.prototype.get=qr;$r.prototype.has=Hr;$r.prototype.set=Ur;function Br(e){var t=-1,i=e==null?0:e.length;this.clear();while(++t<i){var r=e[t];this.set(r[0],r[1])}}function zr(){this.size=0;this.__data__={hash:new Dr,map:new(ei||$r),string:new Dr}}function jr(e){var t=Ga(this,e)["delete"](e);this.size-=t?1:0;return t}function Gr(e){return Ga(this,e).get(e)}function Wr(e){return Ga(this,e).has(e)}function Qr(e,t){var i=Ga(this,e),r=i.size;i.set(e,t);this.size+=i.size==r?0:1;return this}Br.prototype.clear=zr;Br.prototype["delete"]=jr;Br.prototype.get=Gr;Br.prototype.has=Wr;Br.prototype.set=Qr;function Kr(e){var t=-1,i=e==null?0:e.length;this.__data__=new Br;while(++t<i){this.add(e[t])}}function Yr(e){this.__data__.set(e,u);return this}function Xr(e){return this.__data__.has(e)}Kr.prototype.add=Kr.prototype.push=Yr;Kr.prototype.has=Xr;function Jr(e){var t=this.__data__=new $r(e);this.size=t.size}function Zr(){this.__data__=new $r;this.size=0}function en(e){var t=this.__data__,i=t["delete"](e);this.size=t.size;return i}function tn(e){return this.__data__.get(e)}function rn(e){return this.__data__.has(e)}function nn(e,t){var i=this.__data__;if(i instanceof $r){var r=i.__data__;if(!ei||r.length<a-1){r.push([e,t]);this.size=++i.size;return this}i=this.__data__=new Br(r)}i.set(e,t);this.size=i.size;return this}Jr.prototype.clear=Zr;Jr.prototype["delete"]=en;Jr.prototype.get=tn;Jr.prototype.has=rn;Jr.prototype.set=nn;function on(e,t){var i=uc(e),r=!i&&lc(e),n=!i&&!r&&hc(e),o=!i&&!r&&!n&&Hc(e),a=i||r||n||o,s=a?Wi(e.length,ot):[],l=s.length;for(var u in e){if((t||pt.call(e,u))&&!(a&&(u=="length"||n&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||ss(u,l)))){s.push(u)}}return s}function an(e){var t=e.length;return t?e[wo(0,t-1)]:n}function sn(e,t){return Os(la(e),yn(t,0,e.length))}function ln(e){return Os(la(e))}function un(e,t,i,r){if(e===n||oc(e,ut[i])&&!pt.call(r,i)){return t}return e}function cn(e,t,i){if(i!==n&&!oc(e[t],i)||i===n&&!(t in e)){mn(e,t,i)}}function dn(e,t,i){var r=e[t];if(!(pt.call(e,t)&&oc(r,i))||i===n&&!(t in e)){mn(e,t,i)}}function pn(e,t){var i=e.length;while(i--){if(oc(e[i][0],t)){return i}}return-1}function fn(e,t,i,r){Tn(e,function(e,n,o){t(r,e,i(e),o)});return r}function hn(e,t){return e&&ua(t,Sd(t),e)}function gn(e,t){return e&&ua(t,Td(t),e)}function mn(e,t,i){if(t=="__proto__"&&Ot){Ot(e,t,{configurable:true,enumerable:true,value:i,writable:true})}else{e[t]=i}}function vn(e,t){var r=-1,o=t.length,a=i(o),s=e==null;while(++r<o){a[r]=s?n:vd(e,t[r])}return a}function yn(e,t,i){if(e===e){if(i!==n){e=e<=i?e:i}if(t!==n){e=e>=t?e:t}}return e}function bn(e,t,i,r,o,a){var s,l=t&p,u=t&f,c=t&h;if(i){s=o?i(e,r,o,a):i(e)}if(s!==n){return s}if(!xc(e)){return e}var d=uc(e);if(d){s=is(e);if(!l){return la(e,s)}}else{var g=Ja(e),m=g==K||g==Y;if(hc(e)){return Yo(e,l)}if(g==ee||g==U||m&&!o){s=u||m?{}:rs(e);if(!l){return u?da(e,gn(s,e)):ca(e,hn(s,e))}}else{if(!Xt[g]){return o?e:{}}s=ns(e,g,bn,l)}}a||(a=new Jr);var v=a.get(e);if(v){return v}a.set(e,s);var y=c?u?Ha:qa:u?Td:Sd;var b=d?n:y(e);Ei(b||e,function(r,n){if(b){n=r;r=e[n]}dn(s,n,bn(r,t,i,n,e,a))});return s}function wn(e){var t=Sd(e);return function(i){return Cn(i,e,t)}}function Cn(e,t,i){var r=i.length;if(e==null){return!r}e=rt(e);while(r--){var o=i[r],a=t[o],s=e[o];if(s===n&&!(o in e)||!a(s)){return false}}return true}function En(e,t,i){if(typeof e!="function"){throw new at(l)}return _s(function(){e.apply(n,i)},t)}function Sn(e,t,i,r){var n=-1,o=_i,s=true,l=e.length,u=[],c=t.length;if(!l){return u}if(i){t=Ai(t,Ki(i))}if(r){o=Mi;s=false}else if(t.length>=a){o=Xi;s=false;t=new Kr(t)}e:while(++n<l){var d=e[n],p=i==null?d:i(d);d=r||d!==0?d:0;if(s&&p===p){var f=c;while(f--){if(t[f]===p){continue e}}u.push(d)}else if(!o(t,p,r)){u.push(d)}}return u}var Tn=ha(Rn);var xn=ha(Pn,true);function _n(e,t){var i=true;Tn(e,function(e,r,n){i=!!t(e,r,n);return i});return i}function Mn(e,t,i){var r=-1,o=e.length;while(++r<o){var a=e[r],s=t(a);if(s!=null&&(l===n?s===s&&!qc(s):i(s,l))){var l=s,u=a}}return u}function An(e,t,i,r){var o=e.length;i=Kc(i);if(i<0){i=-i>o?0:o+i}r=r===n||r>o?o:Kc(r);if(r<0){r+=o}r=i>r?0:Yc(r);while(i<r){e[i++]=t}return e}function In(e,t){var i=[];Tn(e,function(e,r,n){if(t(e,r,n)){i.push(e)}});return i}function On(e,t,i,r,n){var o=-1,a=e.length;i||(i=as);n||(n=[]);while(++o<a){var s=e[o];if(t>0&&i(s)){if(t>1){On(s,t-1,i,r,n)}else{Ii(n,s)}}else if(!r){n[n.length]=s}}return n}var Dn=ga();var Nn=ga(true);function Rn(e,t){return e&&Dn(e,t,Sd)}function Pn(e,t){return e&&Nn(e,t,Sd)}function Ln(e,t){return xi(t,function(t){return Ec(e[t])})}function kn(e,t){t=Go(t,e);var i=0,r=t.length;while(e!=null&&i<r){e=e[Ns(t[i++])]}return i&&i==r?e:n}function $n(e,t,i){var r=t(e);return uc(e)?r:Ii(r,i(e))}function Fn(e){if(e==null){return e===n?se:Z}e=rt(e);return It&&It in e?Ka(e):Cs(e)}function Vn(e,t){return e>t}function qn(e,t){return e!=null&&pt.call(e,t)}function Hn(e,t){return e!=null&&t in rt(e)}function Un(e,t,i){return e>=zt(t,i)&&e<Ht(t,i)}function Bn(e,t,r){var o=r?Mi:_i,a=e[0].length,s=e.length,l=s,u=i(s),c=Infinity,d=[];while(l--){var p=e[l];if(l&&t){p=Ai(p,Ki(t))}c=zt(p.length,c);u[l]=!r&&(t||a>=120&&p.length>=120)?new Kr(l&&p):n}p=e[0];var f=-1,h=u[0];e:while(++f<a&&d.length<c){var g=p[f],m=t?t(g):g;g=r||g!==0?g:0;if(!(h?Xi(h,m):o(d,m,r))){l=s;while(--l){var v=u[l];if(!(v?Xi(v,m):o(e[l],m,r))){continue e}}if(h){h.push(m)}d.push(g)}}return d}function zn(e,t,i,r){Rn(e,function(e,n,o){t(r,i(e),n,o)});return r}function jn(e,t,i){t=Go(t,e);e=Ss(e,t);var r=e==null?e:e[Ns(al(t))];return r==null?n:wi(r,e,i)}function Gn(e){return _c(e)&&Fn(e)==U}function Wn(e){return _c(e)&&Fn(e)==ce}function Qn(e){return _c(e)&&Fn(e)==G}function Kn(e,t,i,r,n){if(e===t){return true}if(e==null||t==null||!xc(e)&&!_c(t)){return e!==e&&t!==t}return Yn(e,t,i,r,Kn,n)}function Yn(e,t,i,r,n,o){var a=uc(e),s=uc(t),l=B,u=B;if(!a){l=Ja(e);l=l==U?ee:l}if(!s){u=Ja(t);u=u==U?ee:u}var c=l==ee,d=u==ee,p=l==u;if(p&&hc(e)){if(!hc(t)){return false}a=true;c=false}if(p&&!c){o||(o=new Jr);return a||Hc(e)?ka(e,t,i,r,n,o):$a(e,t,l,i,r,n,o)}if(!(i&g)){var f=c&&pt.call(e,"__wrapped__"),h=d&&pt.call(t,"__wrapped__");if(f||h){var m=f?e.value():e,v=h?t.value():t;o||(o=new Jr);return n(m,v,i,r,o)}}if(!p){return false}o||(o=new Jr);return Fa(e,t,i,r,n,o)}function Xn(e){return _c(e)&&Ja(e)==X}function Jn(e,t,i,r){var o=i.length,a=o,s=!r;if(e==null){return!a}e=rt(e);while(o--){var l=i[o];if(s&&l[2]?l[1]!==e[l[0]]:!(l[0]in e)){return false}}while(++o<a){l=i[o];var u=l[0],c=e[u],d=l[1];if(s&&l[2]){if(c===n&&!(u in e)){return false}}else{var p=new Jr;if(r){var f=r(c,d,u,e,t,p)}if(!(f===n?Kn(d,c,g|m,r,p):f)){return false}}}return true}function Zn(e){if(!xc(e)||ps(e)){return false}var t=Ec(e)?yt:Ke;return t.test(Rs(e))}function eo(e){return _c(e)&&Fn(e)==re}function to(e){return _c(e)&&Ja(e)==ne}function io(e){return _c(e)&&Tc(e.length)&&!!Yt[Fn(e)]}function ro(e){if(typeof e=="function"){return e}if(e==null){return Dp}if(typeof e=="object"){return uc(e)?uo(e[0],e[1]):lo(e)}return zp(e)}function no(e){if(!hs(e)){return qt(e)}var t=[];for(var i in rt(e)){if(pt.call(e,i)&&i!="constructor"){t.push(i)}}return t}function oo(e){if(!xc(e)){return ws(e)}var t=hs(e),i=[];for(var r in e){if(!(r=="constructor"&&(t||!pt.call(e,r)))){i.push(r)}}return i}function ao(e,t){return e<t}function so(e,t){var r=-1,n=dc(e)?i(e.length):[];Tn(e,function(e,i,o){n[++r]=t(e,i,o)});return n}function lo(e){var t=Wa(e);if(t.length==1&&t[0][2]){return ms(t[0][0],t[0][1])}return function(i){return i===e||Jn(i,e,t)}}function uo(e,t){if(us(e)&&gs(t)){return ms(Ns(e),t)}return function(i){var r=vd(i,e);return r===n&&r===t?bd(i,e):Kn(t,r,g|m)}}function co(e,t,i,r,o){if(e===t){return}Dn(t,function(a,s){if(xc(a)){o||(o=new Jr);po(e,t,s,i,co,r,o)}else{var l=r?r(e[s],a,s+"",e,t,o):n;if(l===n){l=a}cn(e,s,l)}},Td)}function po(e,t,i,r,o,a,s){var l=e[i],u=t[i],c=s.get(u);if(c){cn(e,i,c);return}var d=a?a(l,u,i+"",e,t,s):n;var p=d===n;if(p){var f=uc(u),h=!f&&hc(u),g=!f&&!h&&Hc(u);d=u;if(f||h||g){if(uc(l)){d=l}else if(pc(l)){d=la(l)}else if(h){p=false;d=Yo(u,true)}else if(g){p=false;d=ra(u,true)}else{d=[]}}else if(Lc(u)||lc(u)){d=l;if(lc(l)){d=Jc(l)}else if(!xc(l)||r&&Ec(l)){d=rs(u)}}else{p=false}}if(p){s.set(u,d);o(d,u,r,a,s);s["delete"](u)}cn(e,i,d)}function fo(e,t){var i=e.length;if(!i){return}t+=t<0?i:0;return ss(t,i)?e[t]:n}function ho(e,t,i){var r=-1;t=Ai(t.length?t:[Dp],Ki(ja()));var n=so(e,function(e,i,n){
var o=Ai(t,function(t){return t(e)});return{criteria:o,index:++r,value:e}});return ji(n,function(e,t){return oa(e,t,i)})}function go(e,t){e=rt(e);return mo(e,t,function(t,i){return bd(e,i)})}function mo(e,t,i){var r=-1,n=t.length,o={};while(++r<n){var a=t[r],s=kn(e,a);if(i(s,a)){_o(o,Go(a,e),s)}}return o}function vo(e){return function(t){return kn(t,e)}}function yo(e,t,i,r){var n=r?Vi:Fi,o=-1,a=t.length,s=e;if(e===t){t=la(t)}if(i){s=Ai(e,Ki(i))}while(++o<a){var l=0,u=t[o],c=i?i(u):u;while((l=n(s,c,l,r))>-1){if(s!==e){_t.call(s,l,1)}_t.call(e,l,1)}}return e}function bo(e,t){var i=e?t.length:0,r=i-1;while(i--){var n=t[i];if(i==r||n!==o){var o=n;if(ss(n)){_t.call(e,n,1)}else{Fo(e,n)}}}return e}function wo(e,t){return e+Lt(Wt()*(t-e+1))}function Co(e,t,r,n){var o=-1,a=Ht(Pt((t-e)/(r||1)),0),s=i(a);while(a--){s[n?a:++o]=e;e+=r}return s}function Eo(e,t){var i="";if(!e||t<1||t>L){return i}do{if(t%2){i+=e}t=Lt(t/2);if(t){e+=e}}while(t);return i}function So(e,t){return Ms(Es(e,t,Dp),e+"")}function To(e){return an(Ud(e))}function xo(e,t){var i=Ud(e);return Os(i,yn(t,0,i.length))}function _o(e,t,i,r){if(!xc(e)){return e}t=Go(t,e);var o=-1,a=t.length,s=a-1,l=e;while(l!=null&&++o<a){var u=Ns(t[o]),c=i;if(o!=s){var d=l[u];c=r?r(d,u,l):n;if(c===n){c=xc(d)?d:ss(t[o+1])?[]:{}}}dn(l,u,c);l=l[u]}return e}var Mo=!li?Dp:function(e,t){li.set(e,t);return e};var Ao=!Ot?Dp:function(e,t){return Ot(e,"toString",{configurable:true,enumerable:false,value:Mp(t),writable:true})};function Io(e){return Os(Ud(e))}function Oo(e,t,r){var n=-1,o=e.length;if(t<0){t=-t>o?0:o+t}r=r>o?o:r;if(r<0){r+=o}o=t>r?0:r-t>>>0;t>>>=0;var a=i(o);while(++n<o){a[n]=e[n+t]}return a}function Do(e,t){var i;Tn(e,function(e,r,n){i=t(e,r,n);return!i});return!!i}function No(e,t,i){var r=0,n=e==null?r:e.length;if(typeof t=="number"&&t===t&&n<=q){while(r<n){var o=r+n>>>1,a=e[o];if(a!==null&&!qc(a)&&(i?a<=t:a<t)){r=o+1}else{n=o}}return n}return Ro(e,t,Dp,i)}function Ro(e,t,i,r){t=i(t);var o=0,a=e==null?0:e.length,s=t!==t,l=t===null,u=qc(t),c=t===n;while(o<a){var d=Lt((o+a)/2),p=i(e[d]),f=p!==n,h=p===null,g=p===p,m=qc(p);if(s){var v=r||g}else if(c){v=g&&(r||f)}else if(l){v=g&&f&&(r||!h)}else if(u){v=g&&f&&!h&&(r||!m)}else if(h||m){v=false}else{v=r?p<=t:p<t}if(v){o=d+1}else{a=d}}return zt(a,V)}function Po(e,t){var i=-1,r=e.length,n=0,o=[];while(++i<r){var a=e[i],s=t?t(a):a;if(!i||!oc(s,l)){var l=s;o[n++]=a===0?0:a}}return o}function Lo(e){if(typeof e=="number"){return e}if(qc(e)){return $}return+e}function ko(e){if(typeof e=="string"){return e}if(uc(e)){return Ai(e,ko)+""}if(qc(e)){return Cr?Cr.call(e):""}var t=e+"";return t=="0"&&1/e==-P?"-0":t}function $o(e,t,i){var r=-1,n=_i,o=e.length,s=true,l=[],u=l;if(i){s=false;n=Mi}else if(o>=a){var c=t?null:Ra(e);if(c){return dr(c)}s=false;n=Xi;u=new Kr}else{u=t?[]:l}e:while(++r<o){var d=e[r],p=t?t(d):d;d=i||d!==0?d:0;if(s&&p===p){var f=u.length;while(f--){if(u[f]===p){continue e}}if(t){u.push(p)}l.push(d)}else if(!n(u,p,i)){if(u!==l){u.push(p)}l.push(d)}}return l}function Fo(e,t){t=Go(t,e);e=Ss(e,t);return e==null||delete e[Ns(al(t))]}function Vo(e,t,i,r){return _o(e,t,i(kn(e,t)),r)}function qo(e,t,i,r){var n=e.length,o=r?n:-1;while((r?o--:++o<n)&&t(e[o],o,e)){}return i?Oo(e,r?0:o,r?o+1:n):Oo(e,r?o+1:0,r?n:o)}function Ho(e,t){var i=e;if(i instanceof Mr){i=i.value()}return Oi(t,function(e,t){return t.func.apply(t.thisArg,Ii([e],t.args))},i)}function Uo(e,t,r){var n=e.length;if(n<2){return n?$o(e[0]):[]}var o=-1,a=i(n);while(++o<n){var s=e[o],l=-1;while(++l<n){if(l!=o){a[o]=Sn(a[o]||s,e[l],t,r)}}}return $o(On(a,1),t,r)}function Bo(e,t,i){var r=-1,o=e.length,a=t.length,s={};while(++r<o){var l=r<a?t[r]:n;i(s,e[r],l)}return s}function zo(e){return pc(e)?e:[]}function jo(e){return typeof e=="function"?e:Dp}function Go(e,t){if(uc(e)){return e}return us(e,t)?[e]:Ds(ed(e))}var Wo=So;function Qo(e,t,i){var r=e.length;i=i===n?r:i;return!t&&i>=r?e:Oo(e,t,i)}var Ko=Dt||function(e){return ai.clearTimeout(e)};function Yo(e,t){if(t){return e.slice()}var i=e.length,r=Et?Et(i):new e.constructor(i);e.copy(r);return r}function Xo(e){var t=new e.constructor(e.byteLength);new Ct(t).set(new Ct(e));return t}function Jo(e,t){var i=t?Xo(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}function Zo(e,t,i){var r=t?i(lr(e),p):lr(e);return Oi(r,yi,new e.constructor)}function ea(e){var t=new e.constructor(e.source,Ge.exec(e));t.lastIndex=e.lastIndex;return t}function ta(e,t,i){var r=t?i(dr(e),p):dr(e);return Oi(r,bi,new e.constructor)}function ia(e){return br?rt(br.call(e)):{}}function ra(e,t){var i=t?Xo(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function na(e,t){if(e!==t){var i=e!==n,r=e===null,o=e===e,a=qc(e);var s=t!==n,l=t===null,u=t===t,c=qc(t);if(!l&&!c&&!a&&e>t||a&&s&&u&&!l&&!c||r&&s&&u||!i&&u||!o){return 1}if(!r&&!a&&!c&&e<t||c&&i&&o&&!r&&!a||l&&i&&o||!s&&o||!u){return-1}}return 0}function oa(e,t,i){var r=-1,n=e.criteria,o=t.criteria,a=n.length,s=i.length;while(++r<a){var l=na(n[r],o[r]);if(l){if(r>=s){return l}var u=i[r];return l*(u=="desc"?-1:1)}}return e.index-t.index}function aa(e,t,r,n){var o=-1,a=e.length,s=r.length,l=-1,u=t.length,c=Ht(a-s,0),d=i(u+c),p=!n;while(++l<u){d[l]=t[l]}while(++o<s){if(p||o<a){d[r[o]]=e[o]}}while(c--){d[l++]=e[o++]}return d}function sa(e,t,r,n){var o=-1,a=e.length,s=-1,l=r.length,u=-1,c=t.length,d=Ht(a-l,0),p=i(d+c),f=!n;while(++o<d){p[o]=e[o]}var h=o;while(++u<c){p[h+u]=t[u]}while(++s<l){if(f||o<a){p[h+r[s]]=e[o++]}}return p}function la(e,t){var r=-1,n=e.length;t||(t=i(n));while(++r<n){t[r]=e[r]}return t}function ua(e,t,i,r){var o=!i;i||(i={});var a=-1,s=t.length;while(++a<s){var l=t[a];var u=r?r(i[l],e[l],l,i,e):n;if(u===n){u=e[l]}if(o){mn(i,l,u)}else{dn(i,l,u)}}return i}function ca(e,t){return ua(e,Ya(e),t)}function da(e,t){return ua(e,Xa(e),t)}function pa(e,t){return function(i,r){var n=uc(i)?Ci:fn,o=t?t():{};return n(i,e,ja(r,2),o)}}function fa(e){return So(function(t,i){var r=-1,o=i.length,a=o>1?i[o-1]:n,s=o>2?i[2]:n;a=e.length>3&&typeof a=="function"?(o--,a):n;if(s&&ls(i[0],i[1],s)){a=o<3?n:a;o=1}t=rt(t);while(++r<o){var l=i[r];if(l){e(t,l,r,a)}}return t})}function ha(e,t){return function(i,r){if(i==null){return i}if(!dc(i)){return e(i,r)}var n=i.length,o=t?n:-1,a=rt(i);while(t?o--:++o<n){if(r(a[o],o,a)===false){break}}return i}}function ga(e){return function(t,i,r){var n=-1,o=rt(t),a=r(t),s=a.length;while(s--){var l=a[e?s:++n];if(i(o[l],l,o)===false){break}}return t}}function ma(e,t,i){var r=t&v,n=ba(e);function o(){var t=this&&this!==ai&&this instanceof o?n:e;return t.apply(r?i:this,arguments)}return o}function va(e){return function(t){t=ed(t);var i=or(t)?mr(t):n;var r=i?i[0]:t.charAt(0);var o=i?Qo(i,1).join(""):t.slice(1);return r[e]()+o}}function ya(e){return function(t){return Oi(Ep(Kd(t).replace(Ut,"")),e,"")}}function ba(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=Tr(e.prototype),r=e.apply(i,t);return xc(r)?r:i}}function wa(e,t,r){var o=ba(e);function a(){var s=arguments.length,l=i(s),u=s,c=za(a);while(u--){l[u]=arguments[u]}var d=s<3&&l[0]!==c&&l[s-1]!==c?[]:cr(l,c);s-=d.length;if(s<r){return Da(e,t,Sa,a.placeholder,n,l,d,n,n,r-s)}var p=this&&this!==ai&&this instanceof a?o:e;return wi(p,this,l)}return a}function Ca(e){return function(t,i,r){var o=rt(t);if(!dc(t)){var a=ja(i,3);t=Sd(t);i=function(e){return a(o[e],e,o)}}var s=e(t,i,r);return s>-1?o[a?t[s]:s]:n}}function Ea(e){return Va(function(t){var i=t.length,r=i,o=_r.prototype.thru;if(e){t.reverse()}while(r--){var s=t[r];if(typeof s!="function"){throw new at(l)}if(o&&!u&&Ba(s)=="wrapper"){var u=new _r([],true)}}r=u?r:i;while(++r<i){s=t[r];var c=Ba(s),d=c=="wrapper"?Ua(s):n;if(d&&ds(d[0])&&d[1]==(T|w|E|x)&&!d[4].length&&d[9]==1){u=u[Ba(d[0])].apply(u,d[3])}else{u=s.length==1&&ds(s)?u[c]():u.thru(s)}}return function(){var e=arguments,r=e[0];if(u&&e.length==1&&uc(r)&&r.length>=a){return u.plant(r).value()}var n=0,o=i?t[n].apply(this,e):r;while(++n<i){o=t[n].call(this,o)}return o}})}function Sa(e,t,r,o,a,s,l,u,c,d){var p=t&T,f=t&v,h=t&y,g=t&(w|C),m=t&_,b=h?n:ba(e);function E(){var n=arguments.length,v=i(n),y=n;while(y--){v[y]=arguments[y]}if(g){var w=za(E),C=er(v,w)}if(o){v=aa(v,o,a,g)}if(s){v=sa(v,s,l,g)}n-=C;if(g&&n<d){var S=cr(v,w);return Da(e,t,Sa,E.placeholder,r,v,S,u,c,d-n)}var T=f?r:this,x=h?T[e]:e;n=v.length;if(u){v=Ts(v,u)}else if(m&&n>1){v.reverse()}if(p&&c<n){v.length=c}if(this&&this!==ai&&this instanceof E){x=b||ba(x)}return x.apply(T,v)}return E}function Ta(e,t){return function(i,r){return zn(i,e,t(r),{})}}function xa(e,t){return function(i,r){var o;if(i===n&&r===n){return t}if(i!==n){o=i}if(r!==n){if(o===n){return r}if(typeof i=="string"||typeof r=="string"){i=ko(i);r=ko(r)}else{i=Lo(i);r=Lo(r)}o=e(i,r)}return o}}function _a(e){return Va(function(t){t=Ai(t,Ki(ja()));return So(function(i){var r=this;return e(t,function(e){return wi(e,r,i)})})})}function Ma(e,t){t=t===n?" ":ko(t);var i=t.length;if(i<2){return i?Eo(t,e):t}var r=Eo(t,Pt(e/gr(t)));return or(t)?Qo(mr(r),0,e).join(""):r.slice(0,e)}function Aa(e,t,r,n){var o=t&v,a=ba(e);function s(){var t=-1,l=arguments.length,u=-1,c=n.length,d=i(c+l),p=this&&this!==ai&&this instanceof s?a:e;while(++u<c){d[u]=n[u]}while(l--){d[u++]=arguments[++t]}return wi(p,o?r:this,d)}return s}function Ia(e){return function(t,i,r){if(r&&typeof r!="number"&&ls(t,i,r)){i=r=n}t=Qc(t);if(i===n){i=t;t=0}else{i=Qc(i)}r=r===n?t<i?1:-1:Qc(r);return Co(t,i,r,e)}}function Oa(e){return function(t,i){if(!(typeof t=="string"&&typeof i=="string")){t=Xc(t);i=Xc(i)}return e(t,i)}}function Da(e,t,i,r,o,a,s,l,u,c){var d=t&w,p=d?s:n,f=d?n:s,h=d?a:n,g=d?n:a;t|=d?E:S;t&=~(d?S:E);if(!(t&b)){t&=~(v|y)}var m=[e,t,o,h,p,g,f,l,u,c];var C=i.apply(n,m);if(ds(e)){xs(C,m)}C.placeholder=r;return As(C,e,t)}function Na(e){var t=it[e];return function(e,i){e=Xc(e);i=zt(Kc(i),292);if(i){var r=(ed(e)+"e").split("e"),n=t(r[0]+"e"+(+r[1]+i));r=(ed(n)+"e").split("e");return+(r[0]+"e"+(+r[1]-i))}return t(e)}}var Ra=!(ni&&1/dr(new ni([,-0]))[1]==P)?Vp:function(e){return new ni(e)};function Pa(e){return function(t){var i=Ja(t);if(i==X){return lr(t)}if(i==ne){return pr(t)}return Qi(t,e(t))}}function La(e,t,i,r,o,a,s,u){var c=t&y;if(!c&&typeof e!="function"){throw new at(l)}var d=r?r.length:0;if(!d){t&=~(E|S);r=o=n}s=s===n?s:Ht(Kc(s),0);u=u===n?u:Kc(u);d-=o?o.length:0;if(t&S){var p=r,f=o;r=o=n}var h=c?n:Ua(e);var g=[e,t,i,r,o,p,f,a,s,u];if(h){ys(g,h)}e=g[0];t=g[1];i=g[2];r=g[3];o=g[4];u=g[9]=g[9]==null?c?0:e.length:Ht(g[9]-d,0);if(!u&&t&(w|C)){t&=~(w|C)}if(!t||t==v){var m=ma(e,t,i)}else if(t==w||t==C){m=wa(e,t,u)}else if((t==E||t==(v|E))&&!o.length){m=Aa(e,t,i,r)}else{m=Sa.apply(n,g)}var b=h?Mo:xs;return As(b(m,g),e,t)}function ka(e,t,i,r,o,a){var s=i&g,l=e.length,u=t.length;if(l!=u&&!(s&&u>l)){return false}var c=a.get(e);if(c&&a.get(t)){return c==t}var d=-1,p=true,f=i&m?new Kr:n;a.set(e,t);a.set(t,e);while(++d<l){var h=e[d],v=t[d];if(r){var y=s?r(v,h,d,t,e,a):r(h,v,d,e,t,a)}if(y!==n){if(y){continue}p=false;break}if(f){if(!Ni(t,function(e,t){if(!Xi(f,t)&&(h===e||o(h,e,i,r,a))){return f.push(t)}})){p=false;break}}else if(!(h===v||o(h,v,i,r,a))){p=false;break}}a["delete"](e);a["delete"](t);return p}function $a(e,t,i,r,n,o,a){switch(i){case de:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset){return false}e=e.buffer;t=t.buffer;case ce:if(e.byteLength!=t.byteLength||!o(new Ct(e),new Ct(t))){return false}return true;case j:case G:case J:return oc(+e,+t);case Q:return e.name==t.name&&e.message==t.message;case re:case oe:return e==t+"";case X:var s=lr;case ne:var l=r&g;s||(s=dr);if(e.size!=t.size&&!l){return false}var u=a.get(e);if(u){return u==t}r|=m;a.set(e,t);var c=ka(s(e),s(t),r,n,o,a);a["delete"](e);return c;case ae:if(br){return br.call(e)==br.call(t)}}return false}function Fa(e,t,i,r,o,a){var s=i&g,l=Sd(e),u=l.length,c=Sd(t),d=c.length;if(u!=d&&!s){return false}var p=u;while(p--){var f=l[p];if(!(s?f in t:pt.call(t,f))){return false}}var h=a.get(e);if(h&&a.get(t)){return h==t}var m=true;a.set(e,t);a.set(t,e);var v=s;while(++p<u){f=l[p];var y=e[f],b=t[f];if(r){var w=s?r(b,y,f,t,e,a):r(y,b,f,e,t,a)}if(!(w===n?y===b||o(y,b,i,r,a):w)){m=false;break}v||(v=f=="constructor")}if(m&&!v){var C=e.constructor,E=t.constructor;if(C!=E&&("constructor"in e&&"constructor"in t)&&!(typeof C=="function"&&C instanceof C&&typeof E=="function"&&E instanceof E)){m=false}}a["delete"](e);a["delete"](t);return m}function Va(e){return Ms(Es(e,n,Ks),e+"")}function qa(e){return $n(e,Sd,Ya)}function Ha(e){return $n(e,Td,Xa)}var Ua=!li?Vp:function(e){return li.get(e)};function Ba(e){var t=e.name+"",i=ci[t],r=pt.call(ci,t)?i.length:0;while(r--){var n=i[r],o=n.func;if(o==null||o==e){return n.name}}return t}function za(e){var t=pt.call(Sr,"placeholder")?Sr:e;return t.placeholder}function ja(){var e=Sr.iteratee||Np;e=e===Np?ro:e;return arguments.length?e(arguments[0],arguments[1]):e}function Ga(e,t){var i=e.__data__;return cs(t)?i[typeof t=="string"?"string":"hash"]:i.map}function Wa(e){var t=Sd(e),i=t.length;while(i--){var r=t[i],n=e[r];t[i]=[r,n,gs(n)]}return t}function Qa(e,t){var i=nr(e,t);return Zn(i)?i:n}function Ka(e){var t=pt.call(e,It),i=e[It];try{e[It]=n;var r=true}catch(e){}var o=gt.call(e);if(r){if(t){e[It]=i}else{delete e[It]}}return o}var Ya=kt?ur(kt,rt):Qp;var Xa=!kt?Qp:function(e){var t=[];while(e){Ii(t,Ya(e));e=St(e)}return t};var Ja=Fn;if(Zt&&Ja(new Zt(new ArrayBuffer(1)))!=de||ei&&Ja(new ei)!=X||ti&&Ja(ti.resolve())!=te||ni&&Ja(new ni)!=ne||oi&&Ja(new oi)!=le){Ja=function(e){var t=Fn(e),i=t==ee?e.constructor:n,r=i?Rs(i):"";if(r){switch(r){case di:return de;case Ri:return X;case Pi:return te;case Bi:return ne;case fr:return le}}return t}}function Za(e,t,i){var r=-1,n=i.length;while(++r<n){var o=i[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=zt(t,e+a);break;case"takeRight":e=Ht(e,t-a);break}}return{start:e,end:t}}function es(e){var t=e.match(He);return t?t[1].split(Ue):[]}function ts(e,t,i){t=Go(t,e);var r=-1,n=t.length,o=false;while(++r<n){var a=Ns(t[r]);if(!(o=e!=null&&i(e,a))){break}e=e[a]}if(o||++r!=n){return o}n=e==null?0:e.length;return!!n&&Tc(n)&&ss(a,n)&&(uc(e)||lc(e))}function is(e){var t=e.length,i=e.constructor(t);if(t&&typeof e[0]=="string"&&pt.call(e,"index")){i.index=e.index;i.input=e.input}return i}function rs(e){return typeof e.constructor=="function"&&!hs(e)?Tr(St(e)):{}}function ns(e,t,i,r){var n=e.constructor;switch(t){case ce:return Xo(e);case j:case G:return new n(+e);case de:return Jo(e,r);case pe:case fe:case he:case ge:case me:case ve:case ye:case be:case we:return ra(e,r);case X:return Zo(e,r,i);case J:case oe:return new n(e);case re:return ea(e);case ne:return ta(e,r,i);case ae:return ia(e)}}function os(e,t){var i=t.length;if(!i){return e}var r=i-1;t[r]=(i>1?"& ":"")+t[r];t=t.join(i>2?", ":" ");return e.replace(qe,"{\n/* [wrapped with "+t+"] */\n")}function as(e){return uc(e)||lc(e)||!!(Mt&&e&&e[Mt])}function ss(e,t){t=t==null?L:t;return!!t&&(typeof e=="number"||Xe.test(e))&&(e>-1&&e%1==0&&e<t)}function ls(e,t,i){if(!xc(i)){return false}var r=typeof t;if(r=="number"?dc(i)&&ss(t,i.length):r=="string"&&t in i){return oc(i[t],e)}return false}function us(e,t){if(uc(e)){return false}var i=typeof e;if(i=="number"||i=="symbol"||i=="boolean"||e==null||qc(e)){return true}return Ne.test(e)||!De.test(e)||t!=null&&e in rt(t)}function cs(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ds(e){var t=Ba(e),i=Sr[t];if(typeof i!="function"||!(t in Mr.prototype)){return false}if(e===i){return true}var r=Ua(i);return!!r&&e===r[0]}function ps(e){return!!ht&&ht in e}var fs=ct?Ec:Kp;function hs(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||ut;return e===i}function gs(e){return e===e&&!xc(e)}function ms(e,t){return function(i){if(i==null){return false}return i[e]===t&&(t!==n||e in rt(i))}}function vs(e){var t=Hu(e,function(e){if(i.size===c){i.clear()}return e});var i=t.cache;return t}function ys(e,t){var i=e[1],r=t[1],n=i|r,o=n<(v|y|T);var a=r==T&&i==w||r==T&&i==x&&e[7].length<=t[8]||r==(T|x)&&t[7].length<=t[8]&&i==w;if(!(o||a)){return e}if(r&v){e[2]=t[2];n|=i&v?0:b}var s=t[3];if(s){var l=e[3];e[3]=l?aa(l,s,t[4]):s;e[4]=l?cr(e[3],d):t[4]}s=t[5];if(s){l=e[5];e[5]=l?sa(l,s,t[6]):s;e[6]=l?cr(e[5],d):t[6]}s=t[7];if(s){e[7]=s}if(r&T){e[8]=e[8]==null?t[8]:zt(e[8],t[8])}if(e[9]==null){e[9]=t[9]}e[0]=t[0];e[1]=n;return e}function bs(e,t,i,r,o,a){if(xc(e)&&xc(t)){a.set(t,e);co(e,t,n,bs,a);a["delete"](t)}return e}function ws(e){var t=[];if(e!=null){for(var i in rt(e)){t.push(i)}}return t}function Cs(e){return gt.call(e)}function Es(e,t,r){t=Ht(t===n?e.length-1:t,0);return function(){var n=arguments,o=-1,a=Ht(n.length-t,0),s=i(a);while(++o<a){s[o]=n[t+o]}o=-1;var l=i(t+1);while(++o<t){l[o]=n[o]}l[t]=r(s);return wi(e,this,l)}}function Ss(e,t){return t.length<2?e:kn(e,Oo(t,0,-1))}function Ts(e,t){var i=e.length,r=zt(t.length,i),o=la(e);while(r--){var a=t[r];e[r]=ss(a,i)?o[a]:n}return e}var xs=Is(Mo);var _s=Rt||function(e,t){return ai.setTimeout(e,t)};var Ms=Is(Ao);function As(e,t,i){var r=t+"";return Ms(e,os(r,Ps(es(r),i)))}function Is(e){var t=0,i=0;return function(){var r=jt(),o=O-(r-i);i=r;if(o>0){if(++t>=I){return arguments[0]}}else{t=0}return e.apply(n,arguments)}}function Os(e,t){var i=-1,r=e.length,o=r-1;t=t===n?r:t;while(++i<t){var a=wo(i,o),s=e[a];e[a]=e[i];e[i]=s}e.length=t;return e}var Ds=vs(function(e){var t=[];if(Re.test(e)){t.push("")}e.replace(Pe,function(e,i,r,n){t.push(r?n.replace(ze,"$1"):i||e)});return t});function Ns(e){if(typeof e=="string"||qc(e)){return e}var t=e+"";return t=="0"&&1/e==-P?"-0":t}function Rs(e){if(e!=null){try{return dt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ps(e,t){Ei(H,function(i){var r="_."+i[0];if(t&i[1]&&!_i(e,r)){e.push(r)}});return e.sort()}function Ls(e){if(e instanceof Mr){return e.clone()}var t=new _r(e.__wrapped__,e.__chain__);t.__actions__=la(e.__actions__);t.__index__=e.__index__;t.__values__=e.__values__;return t}function ks(e,t,r){if(r?ls(e,t,r):t===n){t=1}else{t=Ht(Kc(t),0)}var o=e==null?0:e.length;if(!o||t<1){return[]}var a=0,s=0,l=i(Pt(o/t));while(a<o){l[s++]=Oo(e,a,a+=t)}return l}function $s(e){var t=-1,i=e==null?0:e.length,r=0,n=[];while(++t<i){var o=e[t];if(o){n[r++]=o}}return n}function Fs(){var e=arguments.length;if(!e){return[]}var t=i(e-1),r=arguments[0],n=e;while(n--){t[n-1]=arguments[n]}return Ii(uc(r)?la(r):[r],On(t,1))}var Vs=So(function(e,t){return pc(e)?Sn(e,On(t,1,pc,true)):[]});var qs=So(function(e,t){var i=al(t);if(pc(i)){i=n}return pc(e)?Sn(e,On(t,1,pc,true),ja(i,2)):[]});var Hs=So(function(e,t){var i=al(t);if(pc(i)){i=n}return pc(e)?Sn(e,On(t,1,pc,true),n,i):[]});function Us(e,t,i){var r=e==null?0:e.length;if(!r){return[]}t=i||t===n?1:Kc(t);return Oo(e,t<0?0:t,r)}function Bs(e,t,i){var r=e==null?0:e.length;if(!r){return[]}t=i||t===n?1:Kc(t);t=r-t;return Oo(e,0,t<0?0:t)}function zs(e,t){return e&&e.length?qo(e,ja(t,3),true,true):[]}function js(e,t){return e&&e.length?qo(e,ja(t,3),true):[]}function Gs(e,t,i,r){var n=e==null?0:e.length;if(!n){return[]}if(i&&typeof i!="number"&&ls(e,t,i)){i=0;r=n}return An(e,t,i,r)}function Ws(e,t,i){var r=e==null?0:e.length;if(!r){return-1}var n=i==null?0:Kc(i);if(n<0){n=Ht(r+n,0)}return $i(e,ja(t,3),n)}function Qs(e,t,i){var r=e==null?0:e.length;if(!r){return-1}var o=r-1;if(i!==n){o=Kc(i);o=i<0?Ht(r+o,0):zt(o,r-1)}return $i(e,ja(t,3),o,true)}function Ks(e){var t=e==null?0:e.length;return t?On(e,1):[]}function Ys(e){var t=e==null?0:e.length;return t?On(e,P):[]}function Xs(e,t){var i=e==null?0:e.length;if(!i){return[]}t=t===n?1:Kc(t);return On(e,t)}function Js(e){var t=-1,i=e==null?0:e.length,r={};while(++t<i){var n=e[t];r[n[0]]=n[1]}return r}function Zs(e){return e&&e.length?e[0]:n}function el(e,t,i){var r=e==null?0:e.length;if(!r){return-1}var n=i==null?0:Kc(i);if(n<0){n=Ht(r+n,0)}return Fi(e,t,n)}function tl(e){var t=e==null?0:e.length;return t?Oo(e,0,-1):[]}var il=So(function(e){var t=Ai(e,zo);return t.length&&t[0]===e[0]?Bn(t):[]});var rl=So(function(e){var t=al(e),i=Ai(e,zo);if(t===al(i)){t=n}else{i.pop()}return i.length&&i[0]===e[0]?Bn(i,ja(t,2)):[]});var nl=So(function(e){var t=al(e),i=Ai(e,zo);t=typeof t=="function"?t:n;if(t){i.pop()}return i.length&&i[0]===e[0]?Bn(i,n,t):[]});function ol(e,t){return e==null?"":Vt.call(e,t)}function al(e){var t=e==null?0:e.length;return t?e[t-1]:n}function sl(e,t,i){var r=e==null?0:e.length;if(!r){return-1}var o=r;if(i!==n){o=Kc(i);o=o<0?Ht(r+o,0):zt(o,r-1)}return t===t?hr(e,t,o):$i(e,qi,o,true)}function ll(e,t){return e&&e.length?fo(e,Kc(t)):n}var ul=So(cl);function cl(e,t){return e&&e.length&&t&&t.length?yo(e,t):e}function dl(e,t,i){return e&&e.length&&t&&t.length?yo(e,t,ja(i,2)):e}function pl(e,t,i){return e&&e.length&&t&&t.length?yo(e,t,n,i):e}var fl=Va(function(e,t){var i=e==null?0:e.length,r=vn(e,t);bo(e,Ai(t,function(e){return ss(e,i)?+e:e}).sort(na));return r});function hl(e,t){var i=[];if(!(e&&e.length)){return i}var r=-1,n=[],o=e.length;t=ja(t,3);while(++r<o){var a=e[r];if(t(a,r,e)){i.push(a);n.push(r)}}bo(e,n);return i}function gl(e){return e==null?e:Jt.call(e)}function ml(e,t,i){var r=e==null?0:e.length;if(!r){return[]}if(i&&typeof i!="number"&&ls(e,t,i)){t=0;i=r}else{t=t==null?0:Kc(t);i=i===n?r:Kc(i)}return Oo(e,t,i)}function vl(e,t){return No(e,t)}function yl(e,t,i){return Ro(e,t,ja(i,2))}function bl(e,t){var i=e==null?0:e.length;if(i){var r=No(e,t);if(r<i&&oc(e[r],t)){return r}}return-1}function wl(e,t){return No(e,t,true)}function Cl(e,t,i){return Ro(e,t,ja(i,2),true)}function El(e,t){var i=e==null?0:e.length;if(i){var r=No(e,t,true)-1;if(oc(e[r],t)){return r}}return-1}function Sl(e){return e&&e.length?Po(e):[]}function Tl(e,t){return e&&e.length?Po(e,ja(t,2)):[]}function xl(e){var t=e==null?0:e.length;return t?Oo(e,1,t):[]}function _l(e,t,i){if(!(e&&e.length)){return[]}t=i||t===n?1:Kc(t);return Oo(e,0,t<0?0:t)}function Ml(e,t,i){var r=e==null?0:e.length;if(!r){return[]}t=i||t===n?1:Kc(t);t=r-t;return Oo(e,t<0?0:t,r)}function Al(e,t){return e&&e.length?qo(e,ja(t,3),false,true):[]}function Il(e,t){return e&&e.length?qo(e,ja(t,3)):[]}var Ol=So(function(e){return $o(On(e,1,pc,true))});var Dl=So(function(e){var t=al(e);if(pc(t)){t=n}return $o(On(e,1,pc,true),ja(t,2))});var Nl=So(function(e){var t=al(e);t=typeof t=="function"?t:n;return $o(On(e,1,pc,true),n,t)});function Rl(e){return e&&e.length?$o(e):[]}function Pl(e,t){return e&&e.length?$o(e,ja(t,2)):[]}function Ll(e,t){t=typeof t=="function"?t:n;return e&&e.length?$o(e,n,t):[]}function kl(e){if(!(e&&e.length)){return[]}var t=0;e=xi(e,function(e){if(pc(e)){t=Ht(e.length,t);return true}});return Wi(t,function(t){return Ai(e,Ui(t))})}function $l(e,t){if(!(e&&e.length)){return[]}var i=kl(e);if(t==null){return i}return Ai(i,function(e){return wi(t,n,e)})}var Fl=So(function(e,t){return pc(e)?Sn(e,t):[]});var Vl=So(function(e){return Uo(xi(e,pc))});var ql=So(function(e){var t=al(e);if(pc(t)){t=n}return Uo(xi(e,pc),ja(t,2))});var Hl=So(function(e){var t=al(e);t=typeof t=="function"?t:n;return Uo(xi(e,pc),n,t)});var Ul=So(kl);function Bl(e,t){return Bo(e||[],t||[],dn)}function zl(e,t){return Bo(e||[],t||[],_o)}var jl=So(function(e){var t=e.length,i=t>1?e[t-1]:n;i=typeof i=="function"?(e.pop(),i):n;return $l(e,i)});function Gl(e){var t=Sr(e);t.__chain__=true;return t}function Wl(e,t){t(e);return e}function Ql(e,t){return t(e)}var Kl=Va(function(e){var t=e.length,i=t?e[0]:0,r=this.__wrapped__,o=function(t){return vn(t,e)};if(t>1||this.__actions__.length||!(r instanceof Mr)||!ss(i)){return this.thru(o)}r=r.slice(i,+i+(t?1:0));r.__actions__.push({func:Ql,args:[o],thisArg:n});return new _r(r,this.__chain__).thru(function(e){if(t&&!e.length){e.push(n)}return e})});function Yl(){return Gl(this)}function Xl(){return new _r(this.value(),this.__chain__)}function Jl(){if(this.__values__===n){this.__values__=Wc(this.value())}var e=this.__index__>=this.__values__.length,t=e?n:this.__values__[this.__index__++];return{done:e,value:t}}function Zl(){return this}function eu(e){var t,i=this;while(i instanceof xr){var r=Ls(i);r.__index__=0;r.__values__=n;if(t){o.__wrapped__=r}else{t=r}var o=r;i=i.__wrapped__}o.__wrapped__=e;return t}function tu(){var e=this.__wrapped__;if(e instanceof Mr){var t=e;if(this.__actions__.length){t=new Mr(this)}t=t.reverse();t.__actions__.push({func:Ql,args:[gl],thisArg:n});return new _r(t,this.__chain__)}return this.thru(gl)}function iu(){return Ho(this.__wrapped__,this.__actions__)}var ru=pa(function(e,t,i){if(pt.call(e,i)){++e[i]}else{mn(e,i,1)}});function nu(e,t,i){var r=uc(e)?Ti:_n;if(i&&ls(e,t,i)){t=n}return r(e,ja(t,3))}function ou(e,t){var i=uc(e)?xi:In;return i(e,ja(t,3))}var au=Ca(Ws);var su=Ca(Qs);function lu(e,t){return On(vu(e,t),1)}function uu(e,t){return On(vu(e,t),P)}function cu(e,t,i){i=i===n?1:Kc(i);return On(vu(e,t),i)}function du(e,t){var i=uc(e)?Ei:Tn;return i(e,ja(t,3))}function pu(e,t){var i=uc(e)?Si:xn;return i(e,ja(t,3))}var fu=pa(function(e,t,i){if(pt.call(e,i)){e[i].push(t)}else{mn(e,i,[t])}});function hu(e,t,i,r){e=dc(e)?e:Ud(e);i=i&&!r?Kc(i):0;var n=e.length;if(i<0){i=Ht(n+i,0)}return Vc(e)?i<=n&&e.indexOf(t,i)>-1:!!n&&Fi(e,t,i)>-1}var gu=So(function(e,t,r){var n=-1,o=typeof t=="function",a=dc(e)?i(e.length):[];Tn(e,function(e){a[++n]=o?wi(t,e,r):jn(e,t,r)});return a});var mu=pa(function(e,t,i){mn(e,i,t)});function vu(e,t){var i=uc(e)?Ai:so;return i(e,ja(t,3))}function yu(e,t,i,r){if(e==null){return[]}if(!uc(t)){t=t==null?[]:[t]}i=r?n:i;if(!uc(i)){i=i==null?[]:[i]}return ho(e,t,i)}var bu=pa(function(e,t,i){e[i?0:1].push(t)},function(){return[[],[]]});function wu(e,t,i){var r=uc(e)?Oi:zi,n=arguments.length<3;return r(e,ja(t,4),i,n,Tn)}function Cu(e,t,i){var r=uc(e)?Di:zi,n=arguments.length<3;return r(e,ja(t,4),i,n,xn)}function Eu(e,t){var i=uc(e)?xi:In;return i(e,Uu(ja(t,3)))}function Su(e){var t=uc(e)?an:To;return t(e)}function Tu(e,t,i){if(i?ls(e,t,i):t===n){t=1}else{t=Kc(t)}var r=uc(e)?sn:xo;return r(e,t)}function xu(e){var t=uc(e)?ln:Io;return t(e)}function _u(e){if(e==null){return 0}if(dc(e)){return Vc(e)?gr(e):e.length}var t=Ja(e);if(t==X||t==ne){return e.size}return no(e).length}function Mu(e,t,i){var r=uc(e)?Ni:Do;if(i&&ls(e,t,i)){t=n}return r(e,ja(t,3))}var Au=So(function(e,t){if(e==null){return[]}var i=t.length;if(i>1&&ls(e,t[0],t[1])){t=[]}else if(i>2&&ls(t[0],t[1],t[2])){t=[t[0]]}return ho(e,On(t,1),[])});var Iu=Nt||function(){return ai.Date.now()};function Ou(e,t){if(typeof t!="function"){throw new at(l)}e=Kc(e);return function(){if(--e<1){return t.apply(this,arguments)}}}function Du(e,t,i){t=i?n:t;t=e&&t==null?e.length:t;return La(e,T,n,n,n,n,t)}function Nu(e,t){var i;if(typeof t!="function"){throw new at(l)}e=Kc(e);return function(){if(--e>0){i=t.apply(this,arguments)}if(e<=1){t=n}return i}}var Ru=So(function(e,t,i){var r=v;if(i.length){var n=cr(i,za(Ru));r|=E}return La(e,r,t,i,n)});var Pu=So(function(e,t,i){var r=v|y;if(i.length){var n=cr(i,za(Pu));r|=E}return La(t,r,e,i,n)});function Lu(e,t,i){t=i?n:t;var r=La(e,w,n,n,n,n,n,t);r.placeholder=Lu.placeholder;return r}function ku(e,t,i){t=i?n:t;var r=La(e,C,n,n,n,n,n,t);r.placeholder=ku.placeholder;return r}function $u(e,t,i){var r,o,a,s,u,c,d=0,p=false,f=false,h=true;if(typeof e!="function"){throw new at(l)}t=Xc(t)||0;if(xc(i)){p=!!i.leading;f="maxWait"in i;a=f?Ht(Xc(i.maxWait)||0,t):a;h="trailing"in i?!!i.trailing:h}function g(t){var i=r,a=o;r=o=n;d=t;s=e.apply(a,i);return s}function m(e){d=e;u=_s(b,t);return p?g(e):s}function v(e){var i=e-c,r=e-d,n=t-i;return f?zt(n,a-r):n}function y(e){var i=e-c,r=e-d;return c===n||i>=t||i<0||f&&r>=a}function b(){var e=Iu();if(y(e)){return w(e)}u=_s(b,v(e))}function w(e){u=n;if(h&&r){return g(e)}r=o=n;return s}function C(){if(u!==n){Ko(u)}d=0;r=c=o=u=n}function E(){return u===n?s:w(Iu())}function S(){var e=Iu(),i=y(e);r=arguments;o=this;c=e;if(i){if(u===n){return m(c)}if(f){u=_s(b,t);return g(c)}}if(u===n){u=_s(b,t)}return s}S.cancel=C;S.flush=E;return S}var Fu=So(function(e,t){return En(e,1,t)});var Vu=So(function(e,t,i){return En(e,Xc(t)||0,i)});function qu(e){return La(e,_)}function Hu(e,t){if(typeof e!="function"||t!=null&&typeof t!="function"){throw new at(l)}var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],o=i.cache;if(o.has(n)){return o.get(n)}var a=e.apply(this,r);i.cache=o.set(n,a)||o;return a};i.cache=new(Hu.Cache||Br);return i}Hu.Cache=Br;function Uu(e){if(typeof e!="function"){throw new at(l)}return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Bu(e){return Nu(2,e)}var zu=Wo(function(e,t){t=t.length==1&&uc(t[0])?Ai(t[0],Ki(ja())):Ai(On(t,1),Ki(ja()));var i=t.length;return So(function(r){var n=-1,o=zt(r.length,i);while(++n<o){r[n]=t[n].call(this,r[n])}return wi(e,this,r)})});var ju=So(function(e,t){var i=cr(t,za(ju));return La(e,E,n,t,i)});var Gu=So(function(e,t){var i=cr(t,za(Gu));return La(e,S,n,t,i)});var Wu=Va(function(e,t){return La(e,x,n,n,n,t)});function Qu(e,t){if(typeof e!="function"){throw new at(l)}t=t===n?t:Kc(t);return So(e,t)}function Ku(e,t){if(typeof e!="function"){throw new at(l)}t=t===n?0:Ht(Kc(t),0);return So(function(i){var r=i[t],n=Qo(i,0,t);if(r){Ii(n,r)}return wi(e,this,n)})}function Yu(e,t,i){var r=true,n=true;if(typeof e!="function"){throw new at(l)}if(xc(i)){r="leading"in i?!!i.leading:r;n="trailing"in i?!!i.trailing:n}return $u(e,t,{leading:r,maxWait:t,trailing:n})}function Xu(e){return Du(e,1)}function Ju(e,t){return ju(jo(t),e)}function Zu(){if(!arguments.length){return[]}var e=arguments[0];return uc(e)?e:[e]}function ec(e){return bn(e,h)}function tc(e,t){t=typeof t=="function"?t:n;return bn(e,h,t)}function ic(e){return bn(e,p|h)}function rc(e,t){t=typeof t=="function"?t:n;return bn(e,p|h,t)}function nc(e,t){return t==null||Cn(e,t,Sd(t))}function oc(e,t){return e===t||e!==e&&t!==t}var ac=Oa(Vn);var sc=Oa(function(e,t){return e>=t});var lc=Gn(function(){return arguments}())?Gn:function(e){return _c(e)&&pt.call(e,"callee")&&!xt.call(e,"callee")};var uc=i.isArray;var cc=pi?Ki(pi):Wn;function dc(e){return e!=null&&Tc(e.length)&&!Ec(e)}function pc(e){return _c(e)&&dc(e)}function fc(e){return e===true||e===false||_c(e)&&Fn(e)==j}var hc=$t||Kp;var gc=fi?Ki(fi):Qn;function mc(e){return _c(e)&&e.nodeType===1&&!Lc(e)}function vc(e){if(e==null){return true}if(dc(e)&&(uc(e)||typeof e=="string"||typeof e.splice=="function"||hc(e)||Hc(e)||lc(e))){return!e.length}var t=Ja(e);if(t==X||t==ne){return!e.size}if(hs(e)){return!no(e).length}for(var i in e){if(pt.call(e,i)){return false}}return true}function yc(e,t){return Kn(e,t)}function bc(e,t,i){i=typeof i=="function"?i:n;var r=i?i(e,t):n;return r===n?Kn(e,t,n,i):!!r}function wc(e){if(!_c(e)){return false}var t=Fn(e);return t==Q||t==W||typeof e.message=="string"&&typeof e.name=="string"&&!Lc(e)}function Cc(e){return typeof e=="number"&&Ft(e)}function Ec(e){if(!xc(e)){return false}var t=Fn(e);return t==K||t==Y||t==z||t==ie}function Sc(e){return typeof e=="number"&&e==Kc(e)}function Tc(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=L}function xc(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function _c(e){return e!=null&&typeof e=="object"}var Mc=hi?Ki(hi):Xn;function Ac(e,t){return e===t||Jn(e,t,Wa(t))}function Ic(e,t,i){i=typeof i=="function"?i:n;return Jn(e,t,Wa(t),i)}function Oc(e){return Pc(e)&&e!=+e}function Dc(e){if(fs(e)){throw new Be(s)}return Zn(e)}function Nc(e){return e===null}function Rc(e){return e==null}function Pc(e){return typeof e=="number"||_c(e)&&Fn(e)==J}function Lc(e){if(!_c(e)||Fn(e)!=ee){return false}var t=St(e);if(t===null){return true}var i=pt.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&dt.call(i)==mt;
}var kc=gi?Ki(gi):eo;function $c(e){return Sc(e)&&e>=-L&&e<=L}var Fc=mi?Ki(mi):to;function Vc(e){return typeof e=="string"||!uc(e)&&_c(e)&&Fn(e)==oe}function qc(e){return typeof e=="symbol"||_c(e)&&Fn(e)==ae}var Hc=vi?Ki(vi):io;function Uc(e){return e===n}function Bc(e){return _c(e)&&Ja(e)==le}function zc(e){return _c(e)&&Fn(e)==ue}var jc=Oa(ao);var Gc=Oa(function(e,t){return e<=t});function Wc(e){if(!e){return[]}if(dc(e)){return Vc(e)?mr(e):la(e)}if(At&&e[At]){return sr(e[At]())}var t=Ja(e),i=t==X?lr:t==ne?dr:Ud;return i(e)}function Qc(e){if(!e){return e===0?e:0}e=Xc(e);if(e===P||e===-P){var t=e<0?-1:1;return t*k}return e===e?e:0}function Kc(e){var t=Qc(e),i=t%1;return t===t?i?t-i:t:0}function Yc(e){return e?yn(Kc(e),0,F):0}function Xc(e){if(typeof e=="number"){return e}if(qc(e)){return $}if(xc(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=xc(t)?t+"":t}if(typeof e!="string"){return e===0?e:+e}e=e.replace($e,"");var i=Qe.test(e);return i||Ye.test(e)?ri(e.slice(2),i?2:8):We.test(e)?$:+e}function Jc(e){return ua(e,Td(e))}function Zc(e){return yn(Kc(e),-L,L)}function ed(e){return e==null?"":ko(e)}var td=fa(function(e,t){if(hs(t)||dc(t)){ua(t,Sd(t),e);return}for(var i in t){if(pt.call(t,i)){dn(e,i,t[i])}}});var id=fa(function(e,t){ua(t,Td(t),e)});var rd=fa(function(e,t,i,r){ua(t,Td(t),e,r)});var nd=fa(function(e,t,i,r){ua(t,Sd(t),e,r)});var od=Va(vn);function ad(e,t){var i=Tr(e);return t==null?i:hn(i,t)}var sd=So(function(e){e.push(n,un);return wi(rd,n,e)});var ld=So(function(e){e.push(n,bs);return wi(Ad,n,e)});function ud(e,t){return ki(e,ja(t,3),Rn)}function cd(e,t){return ki(e,ja(t,3),Pn)}function dd(e,t){return e==null?e:Dn(e,ja(t,3),Td)}function pd(e,t){return e==null?e:Nn(e,ja(t,3),Td)}function fd(e,t){return e&&Rn(e,ja(t,3))}function hd(e,t){return e&&Pn(e,ja(t,3))}function gd(e){return e==null?[]:Ln(e,Sd(e))}function md(e){return e==null?[]:Ln(e,Td(e))}function vd(e,t,i){var r=e==null?n:kn(e,t);return r===n?i:r}function yd(e,t){return e!=null&&ts(e,t,qn)}function bd(e,t){return e!=null&&ts(e,t,Hn)}var wd=Ta(function(e,t,i){e[t]=i},Mp(Dp));var Cd=Ta(function(e,t,i){if(pt.call(e,t)){e[t].push(i)}else{e[t]=[i]}},ja);var Ed=So(jn);function Sd(e){return dc(e)?on(e):no(e)}function Td(e){return dc(e)?on(e,true):oo(e)}function xd(e,t){var i={};t=ja(t,3);Rn(e,function(e,r,n){mn(i,t(e,r,n),e)});return i}function _d(e,t){var i={};t=ja(t,3);Rn(e,function(e,r,n){mn(i,r,t(e,r,n))});return i}var Md=fa(function(e,t,i){co(e,t,i)});var Ad=fa(function(e,t,i,r){co(e,t,i,r)});var Id=Va(function(e,t){var i={};if(e==null){return i}var r=false;t=Ai(t,function(t){t=Go(t,e);r||(r=t.length>1);return t});ua(e,Ha(e),i);if(r){i=bn(i,p|f|h)}var n=t.length;while(n--){Fo(i,t[n])}return i});function Od(e,t){return Nd(e,Uu(ja(t)))}var Dd=Va(function(e,t){return e==null?{}:go(e,t)});function Nd(e,t){if(e==null){return{}}var i=Ai(Ha(e),function(e){return[e]});t=ja(t);return mo(e,i,function(e,i){return t(e,i[0])})}function Rd(e,t,i){t=Go(t,e);var r=-1,o=t.length;if(!o){o=1;e=n}while(++r<o){var a=e==null?n:e[Ns(t[r])];if(a===n){r=o;a=i}e=Ec(a)?a.call(e):a}return e}function Pd(e,t,i){return e==null?e:_o(e,t,i)}function Ld(e,t,i,r){r=typeof r=="function"?r:n;return e==null?e:_o(e,t,i,r)}var kd=Pa(Sd);var $d=Pa(Td);function Fd(e,t,i){var r=uc(e),n=r||hc(e)||Hc(e);t=ja(t,4);if(i==null){var o=e&&e.constructor;if(n){i=r?new o:[]}else if(xc(e)){i=Ec(o)?Tr(St(e)):{}}else{i={}}}(n?Ei:Rn)(e,function(e,r,n){return t(i,e,r,n)});return i}function Vd(e,t){return e==null?true:Fo(e,t)}function qd(e,t,i){return e==null?e:Vo(e,t,jo(i))}function Hd(e,t,i,r){r=typeof r=="function"?r:n;return e==null?e:Vo(e,t,jo(i),r)}function Ud(e){return e==null?[]:Yi(e,Sd(e))}function Bd(e){return e==null?[]:Yi(e,Td(e))}function zd(e,t,i){if(i===n){i=t;t=n}if(i!==n){i=Xc(i);i=i===i?i:0}if(t!==n){t=Xc(t);t=t===t?t:0}return yn(Xc(e),t,i)}function jd(e,t,i){t=Qc(t);if(i===n){i=t;t=0}else{i=Qc(i)}e=Xc(e);return Un(e,t,i)}function Gd(e,t,i){if(i&&typeof i!="boolean"&&ls(e,t,i)){t=i=n}if(i===n){if(typeof t=="boolean"){i=t;t=n}else if(typeof e=="boolean"){i=e;e=n}}if(e===n&&t===n){e=0;t=1}else{e=Qc(e);if(t===n){t=e;e=0}else{t=Qc(t)}}if(e>t){var r=e;e=t;t=r}if(i||e%1||t%1){var o=Wt();return zt(e+o*(t-e+ii("1e-"+((o+"").length-1))),t)}return wo(e,t)}var Wd=ya(function(e,t,i){t=t.toLowerCase();return e+(i?Qd(t):t)});function Qd(e){return Cp(ed(e).toLowerCase())}function Kd(e){e=ed(e);return e&&e.replace(Je,tr).replace(Bt,"")}function Yd(e,t,i){e=ed(e);t=ko(t);var r=e.length;i=i===n?r:yn(Kc(i),0,r);var o=i;i-=t.length;return i>=0&&e.slice(i,o)==t}function Xd(e){e=ed(e);return e&&Me.test(e)?e.replace(xe,ir):e}function Jd(e){e=ed(e);return e&&ke.test(e)?e.replace(Le,"\\$&"):e}var Zd=ya(function(e,t,i){return e+(i?"-":"")+t.toLowerCase()});var ep=ya(function(e,t,i){return e+(i?" ":"")+t.toLowerCase()});var tp=va("toLowerCase");function ip(e,t,i){e=ed(e);t=Kc(t);var r=t?gr(e):0;if(!t||r>=t){return e}var n=(t-r)/2;return Ma(Lt(n),i)+e+Ma(Pt(n),i)}function rp(e,t,i){e=ed(e);t=Kc(t);var r=t?gr(e):0;return t&&r<t?e+Ma(t-r,i):e}function np(e,t,i){e=ed(e);t=Kc(t);var r=t?gr(e):0;return t&&r<t?Ma(t-r,i)+e:e}function op(e,t,i){if(i||t==null){t=0}else if(t){t=+t}return Gt(ed(e).replace(Fe,""),t||0)}function ap(e,t,i){if(i?ls(e,t,i):t===n){t=1}else{t=Kc(t)}return Eo(ed(e),t)}function sp(){var e=arguments,t=ed(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var lp=ya(function(e,t,i){return e+(i?"_":"")+t.toLowerCase()});function up(e,t,i){if(i&&typeof i!="number"&&ls(e,t,i)){t=i=n}i=i===n?F:i>>>0;if(!i){return[]}e=ed(e);if(e&&(typeof t=="string"||t!=null&&!kc(t))){t=ko(t);if(!t&&or(e)){return Qo(mr(e),0,i)}}return e.split(t,i)}var cp=ya(function(e,t,i){return e+(i?" ":"")+Cp(t)});function dp(e,t,i){e=ed(e);i=yn(Kc(i),0,e.length);t=ko(t);return e.slice(i,i+t.length)==t}function pp(e,t,i){var r=Sr.templateSettings;if(i&&ls(e,t,i)){t=n}e=ed(e);t=rd({},t,r,un);var o=rd({},t.imports,r.imports,un),a=Sd(o),s=Yi(o,a);var l,u,c=0,d=t.interpolate||Ze,p="__p += '";var f=nt((t.escape||Ze).source+"|"+d.source+"|"+(d===Oe?je:Ze).source+"|"+(t.evaluate||Ze).source+"|$","g");var h="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++Kt+"]")+"\n";e.replace(f,function(t,i,r,n,o,a){r||(r=n);p+=e.slice(c,a).replace(et,rr);if(i){l=true;p+="' +\n__e("+i+") +\n'"}if(o){u=true;p+="';\n"+o+";\n__p += '"}if(r){p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"}c=a+t.length;return t});p+="';\n";var g=t.variable;if(!g){p="with (obj) {\n"+p+"\n}\n"}p=(u?p.replace(Ce,""):p).replace(Ee,"$1").replace(Se,"$1;");p="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(l?", __e = _.escape":"")+(u?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var m=Sp(function(){return tt(a,h+"return "+p).apply(n,s)});m.source=p;if(wc(m)){throw m}return m}function fp(e){return ed(e).toLowerCase()}function hp(e){return ed(e).toUpperCase()}function gp(e,t,i){e=ed(e);if(e&&(i||t===n)){return e.replace($e,"")}if(!e||!(t=ko(t))){return e}var r=mr(e),o=mr(t),a=Ji(r,o),s=Zi(r,o)+1;return Qo(r,a,s).join("")}function mp(e,t,i){e=ed(e);if(e&&(i||t===n)){return e.replace(Ve,"")}if(!e||!(t=ko(t))){return e}var r=mr(e),o=Zi(r,mr(t))+1;return Qo(r,0,o).join("")}function vp(e,t,i){e=ed(e);if(e&&(i||t===n)){return e.replace(Fe,"")}if(!e||!(t=ko(t))){return e}var r=mr(e),o=Ji(r,mr(t));return Qo(r,o).join("")}function yp(e,t){var i=M,r=A;if(xc(t)){var o="separator"in t?t.separator:o;i="length"in t?Kc(t.length):i;r="omission"in t?ko(t.omission):r}e=ed(e);var a=e.length;if(or(e)){var s=mr(e);a=s.length}if(i>=a){return e}var l=i-gr(r);if(l<1){return r}var u=s?Qo(s,0,l).join(""):e.slice(0,l);if(o===n){return u+r}if(s){l+=u.length-l}if(kc(o)){if(e.slice(l).search(o)){var c,d=u;if(!o.global){o=nt(o.source,ed(Ge.exec(o))+"g")}o.lastIndex=0;while(c=o.exec(d)){var p=c.index}u=u.slice(0,p===n?l:p)}}else if(e.indexOf(ko(o),l)!=l){var f=u.lastIndexOf(o);if(f>-1){u=u.slice(0,f)}}return u+r}function bp(e){e=ed(e);return e&&_e.test(e)?e.replace(Te,vr):e}var wp=ya(function(e,t,i){return e+(i?" ":"")+t.toUpperCase()});var Cp=va("toUpperCase");function Ep(e,t,i){e=ed(e);t=i?n:t;if(t===n){return ar(e)?wr(e):Li(e)}return e.match(t)||[]}var Sp=So(function(e,t){try{return wi(e,n,t)}catch(e){return wc(e)?e:new Be(e)}});var Tp=Va(function(e,t){Ei(t,function(t){t=Ns(t);mn(e,t,Ru(e[t],e))});return e});function xp(e){var t=e==null?0:e.length,i=ja();e=!t?[]:Ai(e,function(e){if(typeof e[1]!="function"){throw new at(l)}return[i(e[0]),e[1]]});return So(function(i){var r=-1;while(++r<t){var n=e[r];if(wi(n[0],this,i)){return wi(n[1],this,i)}}})}function _p(e){return wn(bn(e,p))}function Mp(e){return function(){return e}}function Ap(e,t){return e==null||e!==e?t:e}var Ip=Ea();var Op=Ea(true);function Dp(e){return e}function Np(e){return ro(typeof e=="function"?e:bn(e,p))}function Rp(e){return lo(bn(e,p))}function Pp(e,t){return uo(e,bn(t,p))}var Lp=So(function(e,t){return function(i){return jn(i,e,t)}});var kp=So(function(e,t){return function(i){return jn(e,i,t)}});function $p(e,t,i){var r=Sd(t),n=Ln(t,r);if(i==null&&!(xc(t)&&(n.length||!r.length))){i=t;t=e;e=this;n=Ln(t,Sd(t))}var o=!(xc(i)&&"chain"in i)||!!i.chain,a=Ec(e);Ei(n,function(i){var r=t[i];e[i]=r;if(a){e.prototype[i]=function(){var t=this.__chain__;if(o||t){var i=e(this.__wrapped__),n=i.__actions__=la(this.__actions__);n.push({func:r,args:arguments,thisArg:e});i.__chain__=t;return i}return r.apply(e,Ii([this.value()],arguments))}}});return e}function Fp(){if(ai._===this){ai._=vt}return this}function Vp(){}function qp(e){e=Kc(e);return So(function(t){return fo(t,e)})}var Hp=_a(Ai);var Up=_a(Ti);var Bp=_a(Ni);function zp(e){return us(e)?Ui(Ns(e)):vo(e)}function jp(e){return function(t){return e==null?n:kn(e,t)}}var Gp=Ia();var Wp=Ia(true);function Qp(){return[]}function Kp(){return false}function Yp(){return{}}function Xp(){return""}function Jp(){return true}function Zp(e,t){e=Kc(e);if(e<1||e>L){return[]}var i=F,r=zt(e,F);t=ja(t);e-=F;var n=Wi(r,t);while(++i<e){t(i)}return n}function ef(e){if(uc(e)){return Ai(e,Ns)}return qc(e)?[e]:la(Ds(ed(e)))}function tf(e){var t=++ft;return ed(e)+t}var rf=xa(function(e,t){return e+t},0);var nf=Na("ceil");var of=xa(function(e,t){return e/t},1);var af=Na("floor");function sf(e){return e&&e.length?Mn(e,Dp,Vn):n}function lf(e,t){return e&&e.length?Mn(e,ja(t,2),Vn):n}function uf(e){return Hi(e,Dp)}function cf(e,t){return Hi(e,ja(t,2))}function df(e){return e&&e.length?Mn(e,Dp,ao):n}function pf(e,t){return e&&e.length?Mn(e,ja(t,2),ao):n}var ff=xa(function(e,t){return e*t},1);var hf=Na("round");var gf=xa(function(e,t){return e-t},0);function mf(e){return e&&e.length?Gi(e,Dp):0}function vf(e,t){return e&&e.length?Gi(e,ja(t,2)):0}Sr.after=Ou;Sr.ary=Du;Sr.assign=td;Sr.assignIn=id;Sr.assignInWith=rd;Sr.assignWith=nd;Sr.at=od;Sr.before=Nu;Sr.bind=Ru;Sr.bindAll=Tp;Sr.bindKey=Pu;Sr.castArray=Zu;Sr.chain=Gl;Sr.chunk=ks;Sr.compact=$s;Sr.concat=Fs;Sr.cond=xp;Sr.conforms=_p;Sr.constant=Mp;Sr.countBy=ru;Sr.create=ad;Sr.curry=Lu;Sr.curryRight=ku;Sr.debounce=$u;Sr.defaults=sd;Sr.defaultsDeep=ld;Sr.defer=Fu;Sr.delay=Vu;Sr.difference=Vs;Sr.differenceBy=qs;Sr.differenceWith=Hs;Sr.drop=Us;Sr.dropRight=Bs;Sr.dropRightWhile=zs;Sr.dropWhile=js;Sr.fill=Gs;Sr.filter=ou;Sr.flatMap=lu;Sr.flatMapDeep=uu;Sr.flatMapDepth=cu;Sr.flatten=Ks;Sr.flattenDeep=Ys;Sr.flattenDepth=Xs;Sr.flip=qu;Sr.flow=Ip;Sr.flowRight=Op;Sr.fromPairs=Js;Sr.functions=gd;Sr.functionsIn=md;Sr.groupBy=fu;Sr.initial=tl;Sr.intersection=il;Sr.intersectionBy=rl;Sr.intersectionWith=nl;Sr.invert=wd;Sr.invertBy=Cd;Sr.invokeMap=gu;Sr.iteratee=Np;Sr.keyBy=mu;Sr.keys=Sd;Sr.keysIn=Td;Sr.map=vu;Sr.mapKeys=xd;Sr.mapValues=_d;Sr.matches=Rp;Sr.matchesProperty=Pp;Sr.memoize=Hu;Sr.merge=Md;Sr.mergeWith=Ad;Sr.method=Lp;Sr.methodOf=kp;Sr.mixin=$p;Sr.negate=Uu;Sr.nthArg=qp;Sr.omit=Id;Sr.omitBy=Od;Sr.once=Bu;Sr.orderBy=yu;Sr.over=Hp;Sr.overArgs=zu;Sr.overEvery=Up;Sr.overSome=Bp;Sr.partial=ju;Sr.partialRight=Gu;Sr.partition=bu;Sr.pick=Dd;Sr.pickBy=Nd;Sr.property=zp;Sr.propertyOf=jp;Sr.pull=ul;Sr.pullAll=cl;Sr.pullAllBy=dl;Sr.pullAllWith=pl;Sr.pullAt=fl;Sr.range=Gp;Sr.rangeRight=Wp;Sr.rearg=Wu;Sr.reject=Eu;Sr.remove=hl;Sr.rest=Qu;Sr.reverse=gl;Sr.sampleSize=Tu;Sr.set=Pd;Sr.setWith=Ld;Sr.shuffle=xu;Sr.slice=ml;Sr.sortBy=Au;Sr.sortedUniq=Sl;Sr.sortedUniqBy=Tl;Sr.split=up;Sr.spread=Ku;Sr.tail=xl;Sr.take=_l;Sr.takeRight=Ml;Sr.takeRightWhile=Al;Sr.takeWhile=Il;Sr.tap=Wl;Sr.throttle=Yu;Sr.thru=Ql;Sr.toArray=Wc;Sr.toPairs=kd;Sr.toPairsIn=$d;Sr.toPath=ef;Sr.toPlainObject=Jc;Sr.transform=Fd;Sr.unary=Xu;Sr.union=Ol;Sr.unionBy=Dl;Sr.unionWith=Nl;Sr.uniq=Rl;Sr.uniqBy=Pl;Sr.uniqWith=Ll;Sr.unset=Vd;Sr.unzip=kl;Sr.unzipWith=$l;Sr.update=qd;Sr.updateWith=Hd;Sr.values=Ud;Sr.valuesIn=Bd;Sr.without=Fl;Sr.words=Ep;Sr.wrap=Ju;Sr.xor=Vl;Sr.xorBy=ql;Sr.xorWith=Hl;Sr.zip=Ul;Sr.zipObject=Bl;Sr.zipObjectDeep=zl;Sr.zipWith=jl;Sr.entries=kd;Sr.entriesIn=$d;Sr.extend=id;Sr.extendWith=rd;$p(Sr,Sr);Sr.add=rf;Sr.attempt=Sp;Sr.camelCase=Wd;Sr.capitalize=Qd;Sr.ceil=nf;Sr.clamp=zd;Sr.clone=ec;Sr.cloneDeep=ic;Sr.cloneDeepWith=rc;Sr.cloneWith=tc;Sr.conformsTo=nc;Sr.deburr=Kd;Sr.defaultTo=Ap;Sr.divide=of;Sr.endsWith=Yd;Sr.eq=oc;Sr.escape=Xd;Sr.escapeRegExp=Jd;Sr.every=nu;Sr.find=au;Sr.findIndex=Ws;Sr.findKey=ud;Sr.findLast=su;Sr.findLastIndex=Qs;Sr.findLastKey=cd;Sr.floor=af;Sr.forEach=du;Sr.forEachRight=pu;Sr.forIn=dd;Sr.forInRight=pd;Sr.forOwn=fd;Sr.forOwnRight=hd;Sr.get=vd;Sr.gt=ac;Sr.gte=sc;Sr.has=yd;Sr.hasIn=bd;Sr.head=Zs;Sr.identity=Dp;Sr.includes=hu;Sr.indexOf=el;Sr.inRange=jd;Sr.invoke=Ed;Sr.isArguments=lc;Sr.isArray=uc;Sr.isArrayBuffer=cc;Sr.isArrayLike=dc;Sr.isArrayLikeObject=pc;Sr.isBoolean=fc;Sr.isBuffer=hc;Sr.isDate=gc;Sr.isElement=mc;Sr.isEmpty=vc;Sr.isEqual=yc;Sr.isEqualWith=bc;Sr.isError=wc;Sr.isFinite=Cc;Sr.isFunction=Ec;Sr.isInteger=Sc;Sr.isLength=Tc;Sr.isMap=Mc;Sr.isMatch=Ac;Sr.isMatchWith=Ic;Sr.isNaN=Oc;Sr.isNative=Dc;Sr.isNil=Rc;Sr.isNull=Nc;Sr.isNumber=Pc;Sr.isObject=xc;Sr.isObjectLike=_c;Sr.isPlainObject=Lc;Sr.isRegExp=kc;Sr.isSafeInteger=$c;Sr.isSet=Fc;Sr.isString=Vc;Sr.isSymbol=qc;Sr.isTypedArray=Hc;Sr.isUndefined=Uc;Sr.isWeakMap=Bc;Sr.isWeakSet=zc;Sr.join=ol;Sr.kebabCase=Zd;Sr.last=al;Sr.lastIndexOf=sl;Sr.lowerCase=ep;Sr.lowerFirst=tp;Sr.lt=jc;Sr.lte=Gc;Sr.max=sf;Sr.maxBy=lf;Sr.mean=uf;Sr.meanBy=cf;Sr.min=df;Sr.minBy=pf;Sr.stubArray=Qp;Sr.stubFalse=Kp;Sr.stubObject=Yp;Sr.stubString=Xp;Sr.stubTrue=Jp;Sr.multiply=ff;Sr.nth=ll;Sr.noConflict=Fp;Sr.noop=Vp;Sr.now=Iu;Sr.pad=ip;Sr.padEnd=rp;Sr.padStart=np;Sr.parseInt=op;Sr.random=Gd;Sr.reduce=wu;Sr.reduceRight=Cu;Sr.repeat=ap;Sr.replace=sp;Sr.result=Rd;Sr.round=hf;Sr.runInContext=e;Sr.sample=Su;Sr.size=_u;Sr.snakeCase=lp;Sr.some=Mu;Sr.sortedIndex=vl;Sr.sortedIndexBy=yl;Sr.sortedIndexOf=bl;Sr.sortedLastIndex=wl;Sr.sortedLastIndexBy=Cl;Sr.sortedLastIndexOf=El;Sr.startCase=cp;Sr.startsWith=dp;Sr.subtract=gf;Sr.sum=mf;Sr.sumBy=vf;Sr.template=pp;Sr.times=Zp;Sr.toFinite=Qc;Sr.toInteger=Kc;Sr.toLength=Yc;Sr.toLower=fp;Sr.toNumber=Xc;Sr.toSafeInteger=Zc;Sr.toString=ed;Sr.toUpper=hp;Sr.trim=gp;Sr.trimEnd=mp;Sr.trimStart=vp;Sr.truncate=yp;Sr.unescape=bp;Sr.uniqueId=tf;Sr.upperCase=wp;Sr.upperFirst=Cp;Sr.each=du;Sr.eachRight=pu;Sr.first=Zs;$p(Sr,function(){var e={};Rn(Sr,function(t,i){if(!pt.call(Sr.prototype,i)){e[i]=t}});return e}(),{chain:false});Sr.VERSION=o;Ei(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){Sr[e].placeholder=Sr});Ei(["drop","take"],function(e,t){Mr.prototype[e]=function(i){var r=this.__filtered__;if(r&&!t){return new Mr(this)}i=i===n?1:Ht(Kc(i),0);var o=this.clone();if(r){o.__takeCount__=zt(i,o.__takeCount__)}else{o.__views__.push({size:zt(i,F),type:e+(o.__dir__<0?"Right":"")})}return o};Mr.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}});Ei(["filter","map","takeWhile"],function(e,t){var i=t+1,r=i==D||i==R;Mr.prototype[e]=function(e){var t=this.clone();t.__iteratees__.push({iteratee:ja(e,3),type:i});t.__filtered__=t.__filtered__||r;return t}});Ei(["head","last"],function(e,t){var i="take"+(t?"Right":"");Mr.prototype[e]=function(){return this[i](1).value()[0]}});Ei(["initial","tail"],function(e,t){var i="drop"+(t?"":"Right");Mr.prototype[e]=function(){return this.__filtered__?new Mr(this):this[i](1)}});Mr.prototype.compact=function(){return this.filter(Dp)};Mr.prototype.find=function(e){return this.filter(e).head()};Mr.prototype.findLast=function(e){return this.reverse().find(e)};Mr.prototype.invokeMap=So(function(e,t){if(typeof e=="function"){return new Mr(this)}return this.map(function(i){return jn(i,e,t)})});Mr.prototype.reject=function(e){return this.filter(Uu(ja(e)))};Mr.prototype.slice=function(e,t){e=Kc(e);var i=this;if(i.__filtered__&&(e>0||t<0)){return new Mr(i)}if(e<0){i=i.takeRight(-e)}else if(e){i=i.drop(e)}if(t!==n){t=Kc(t);i=t<0?i.dropRight(-t):i.take(t-e)}return i};Mr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()};Mr.prototype.toArray=function(){return this.take(F)};Rn(Mr.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),o=Sr[r?"take"+(t=="last"?"Right":""):t],a=r||/^find/.test(t);if(!o){return}Sr.prototype[t]=function(){var t=this.__wrapped__,s=r?[1]:arguments,l=t instanceof Mr,u=s[0],c=l||uc(t);var d=function(e){var t=o.apply(Sr,Ii([e],s));return r&&p?t[0]:t};if(c&&i&&typeof u=="function"&&u.length!=1){l=c=false}var p=this.__chain__,f=!!this.__actions__.length,h=a&&!p,g=l&&!f;if(!a&&c){t=g?t:new Mr(this);var m=e.apply(t,s);m.__actions__.push({func:Ql,args:[d],thisArg:n});return new _r(m,p)}if(h&&g){return e.apply(this,s)}m=this.thru(d);return h?r?m.value()[0]:m.value():m}});Ei(["pop","push","shift","sort","splice","unshift"],function(e){var t=st[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);Sr.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var n=this.value();return t.apply(uc(n)?n:[],e)}return this[i](function(i){return t.apply(uc(i)?i:[],e)})}});Rn(Mr.prototype,function(e,t){var i=Sr[t];if(i){var r=i.name+"",n=ci[r]||(ci[r]=[]);n.push({name:t,func:i})}});ci[Sa(n,y).name]=[{name:"wrapper",func:n}];Mr.prototype.clone=Ar;Mr.prototype.reverse=Ir;Mr.prototype.value=Or;Sr.prototype.at=Kl;Sr.prototype.chain=Yl;Sr.prototype.commit=Xl;Sr.prototype.next=Jl;Sr.prototype.plant=eu;Sr.prototype.reverse=tu;Sr.prototype.toJSON=Sr.prototype.valueOf=Sr.prototype.value=iu;Sr.prototype.first=Sr.prototype.head;if(At){Sr.prototype[At]=Zl}return Sr};var Er=Cr();if(typeof t=="function"&&typeof t.amd=="object"&&t.amd){ai._=Er;t(function(){return Er})}else if(li){(li.exports=Er)._=Er;si._=Er}else{ai._=Er}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],71:[function(e,i,r){(function(){var e,r="1.5.3",n={},o="en",a=null,s="0,0",l=typeof i!=="undefined"&&i.exports;function u(e){this._value=e}function c(e,t,i,r){var n=Math.pow(10,t),o,a;a=(i(e*n)/n).toFixed(t);if(r){o=new RegExp("0{1,"+r+"}$");a=a.replace(o,"")}return a}function d(e,t,i){var r;if(t.indexOf("$")>-1){r=f(e,t,i)}else if(t.indexOf("%")>-1){r=h(e,t,i)}else if(t.indexOf(":")>-1){r=g(e,t)}else{r=v(e._value,t,i)}return r}function p(e,t){var i=t,r,s,l,u,c=["KB","MB","GB","TB","PB","EB","ZB","YB"],d=false,p;if(t.indexOf(":")>-1){e._value=m(t)}else{if(t===a){e._value=0}else{if(n[o].delimiters.decimal!=="."){t=t.replace(/\./g,"").replace(n[o].delimiters.decimal,".")}r=new RegExp("[^a-zA-Z]"+n[o].abbreviations.thousand+"(?:\\)|(\\"+n[o].currency.symbol+")?(?:\\))?)?$");s=new RegExp("[^a-zA-Z]"+n[o].abbreviations.million+"(?:\\)|(\\"+n[o].currency.symbol+")?(?:\\))?)?$");l=new RegExp("[^a-zA-Z]"+n[o].abbreviations.billion+"(?:\\)|(\\"+n[o].currency.symbol+")?(?:\\))?)?$");u=new RegExp("[^a-zA-Z]"+n[o].abbreviations.trillion+"(?:\\)|(\\"+n[o].currency.symbol+")?(?:\\))?)?$");for(p=0;p<=c.length;p++){d=t.indexOf(c[p])>-1?Math.pow(1024,p+1):false;if(d){break}}e._value=(d?d:1)*(i.match(r)?Math.pow(10,3):1)*(i.match(s)?Math.pow(10,6):1)*(i.match(l)?Math.pow(10,9):1)*(i.match(u)?Math.pow(10,12):1)*(t.indexOf("%")>-1?.01:1)*((t.split("-").length+Math.min(t.split("(").length-1,t.split(")").length-1))%2?1:-1)*Number(t.replace(/[^0-9\.]+/g,""));e._value=d?Math.ceil(e._value):e._value}}return e._value}function f(e,t,i){var r=t.indexOf("$"),a=t.indexOf("("),s=t.indexOf("-"),l="",u,c;if(t.indexOf(" $")>-1){l=" ";t=t.replace(" $","")}else if(t.indexOf("$ ")>-1){l=" ";t=t.replace("$ ","")}else{t=t.replace("$","")}c=v(e._value,t,i);if(r<=1){if(c.indexOf("(")>-1||c.indexOf("-")>-1){c=c.split("");u=1;if(r<a||r<s){u=0}c.splice(u,0,n[o].currency.symbol+l);c=c.join("")}else{c=n[o].currency.symbol+l+c}}else{if(c.indexOf(")")>-1){c=c.split("");c.splice(-1,0,l+n[o].currency.symbol);c=c.join("")}else{c=c+l+n[o].currency.symbol}}return c}function h(e,t,i){var r="",n,o=e._value*100;if(t.indexOf(" %")>-1){r=" ";t=t.replace(" %","")}else{t=t.replace("%","")}n=v(o,t,i);if(n.indexOf(")")>-1){n=n.split("");n.splice(-1,0,r+"%");n=n.join("")}else{n=n+r+"%"}return n}function g(e){var t=Math.floor(e._value/60/60),i=Math.floor((e._value-t*60*60)/60),r=Math.round(e._value-t*60*60-i*60);return t+":"+(i<10?"0"+i:i)+":"+(r<10?"0"+r:r)}function m(e){var t=e.split(":"),i=0;if(t.length===3){i=i+Number(t[0])*60*60;i=i+Number(t[1])*60;i=i+Number(t[2])}else if(t.length===2){i=i+Number(t[0])*60;i=i+Number(t[1])}return Number(i)}function v(e,t,i){var r=false,s=false,l=false,u="",d=false,p=false,f=false,h=false,g=false,m="",v="",y=Math.abs(e),b=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],w,C,E,S,T,x,_="",M=false;if(e===0&&a!==null){return a}else{if(t.indexOf("(")>-1){r=true;t=t.slice(1,-1)}else if(t.indexOf("+")>-1){s=true;t=t.replace(/\+/g,"")}if(t.indexOf("a")>-1){d=t.indexOf("aK")>=0;p=t.indexOf("aM")>=0;f=t.indexOf("aB")>=0;h=t.indexOf("aT")>=0;g=d||p||f||h;if(t.indexOf(" a")>-1){u=" ";t=t.replace(" a","")}else{t=t.replace("a","")}if(y>=Math.pow(10,12)&&!g||h){u=u+n[o].abbreviations.trillion;e=e/Math.pow(10,12)}else if(y<Math.pow(10,12)&&y>=Math.pow(10,9)&&!g||f){u=u+n[o].abbreviations.billion;e=e/Math.pow(10,9)}else if(y<Math.pow(10,9)&&y>=Math.pow(10,6)&&!g||p){u=u+n[o].abbreviations.million;e=e/Math.pow(10,6)}else if(y<Math.pow(10,6)&&y>=Math.pow(10,3)&&!g||d){u=u+n[o].abbreviations.thousand;e=e/Math.pow(10,3)}}if(t.indexOf("b")>-1){if(t.indexOf(" b")>-1){m=" ";t=t.replace(" b","")}else{t=t.replace("b","")}for(E=0;E<=b.length;E++){w=Math.pow(1024,E);C=Math.pow(1024,E+1);if(e>=w&&e<C){m=m+b[E];if(w>0){e=e/w}break}}}if(t.indexOf("o")>-1){if(t.indexOf(" o")>-1){v=" ";t=t.replace(" o","")}else{t=t.replace("o","")}v=v+n[o].ordinal(e)}if(t.indexOf("[.]")>-1){l=true;t=t.replace("[.]",".")}S=e.toString().split(".")[0];T=t.split(".")[1];x=t.indexOf(",");if(T){if(T.indexOf("[")>-1){T=T.replace("]","");T=T.split("[");_=c(e,T[0].length+T[1].length,i,T[1].length)}else{_=c(e,T.length,i)}S=_.split(".")[0];if(_.split(".")[1].length){_=n[o].delimiters.decimal+_.split(".")[1]}else{_=""}if(l&&Number(_.slice(1))===0){_=""}}else{S=c(e,null,i)}if(S.indexOf("-")>-1){S=S.slice(1);M=true}if(x>-1){S=S.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+n[o].delimiters.thousands)}if(t.indexOf(".")===0){S=""}return(r&&M?"(":"")+(!r&&M?"-":"")+(!M&&s?"+":"")+S+_+(v?v:"")+(u?u:"")+(m?m:"")+(r&&M?")":"")}}e=function(t){if(e.isNumeral(t)){t=t.value()}else if(t===0||typeof t==="undefined"){t=0}else if(!Number(t)){t=e.fn.unformat(t)}return new u(Number(t))};e.version=r;e.isNumeral=function(e){return e instanceof u};e.language=function(t,i){if(!t){return o}if(t&&!i){if(!n[t]){throw new Error("Unknown language : "+t)}o=t}if(i||!n[t]){y(t,i)}return e};e.languageData=function(e){if(!e){return n[o]}if(!n[e]){throw new Error("Unknown language : "+e)}return n[e]};e.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"},currency:{symbol:"$"}});e.zeroFormat=function(e){a=typeof e==="string"?e:null};e.defaultFormat=function(e){s=typeof e==="string"?e:"0.0"};function y(e,t){n[e]=t}if("function"!==typeof Array.prototype.reduce){Array.prototype.reduce=function(e,t){"use strict";if(null===this||"undefined"===typeof this){throw new TypeError("Array.prototype.reduce called on null or undefined")}if("function"!==typeof e){throw new TypeError(e+" is not a function")}var i,r,n=this.length>>>0,o=false;if(1<arguments.length){r=t;o=true}for(i=0;n>i;++i){if(this.hasOwnProperty(i)){if(o){r=e(r,this[i],i,this)}else{r=this[i];o=true}}}if(!o){throw new TypeError("Reduce of empty array with no initial value")}return r}}function b(e){var t=e.toString().split(".");if(t.length<2){return 1}return Math.pow(10,t[1].length)}function w(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){var i=b(e),r=b(t);return i>r?i:r},-Infinity)}e.fn=u.prototype={clone:function(){return e(this)},format:function(e,t){return d(this,e?e:s,t!==undefined?t:Math.round)},unformat:function(e){if(Object.prototype.toString.call(e)==="[object Number]"){return e}return p(this,e?e:s)},value:function(){return this._value},valueOf:function(){return this._value},set:function(e){this._value=Number(e);return this},add:function(e){var t=w.call(null,this._value,e);function i(e,i,r,n){return e+t*i}this._value=[this._value,e].reduce(i,0)/t;return this},subtract:function(e){var t=w.call(null,this._value,e);function i(e,i,r,n){return e-t*i}this._value=[e].reduce(i,this._value*t)/t;return this},multiply:function(e){function t(e,t,i,r){var n=w(e,t);return e*n*(t*n)/(n*n)}this._value=[this._value,e].reduce(t,1);return this},divide:function(e){function t(e,t,i,r){var n=w(e,t);return e*n/(t*n)}this._value=[this._value,e].reduce(t);return this},difference:function(t){return Math.abs(e(this._value).subtract(t).value())}};if(l){i.exports=e}if(typeof ender==="undefined"){this["numeral"]=e}if(typeof t==="function"&&t.amd){t([],function(){return e})}}).call(this)},{}],72:[function(e,t,i){"use strict";var r=e("./lib/utils/common").assign;var n=e("./lib/deflate");var o=e("./lib/inflate");var a=e("./lib/zlib/constants");var s={};r(s,n,o,a);t.exports=s},{"./lib/deflate":73,"./lib/inflate":74,"./lib/utils/common":75,"./lib/zlib/constants":78}],73:[function(e,t,i){"use strict";var r=e("./zlib/deflate");var n=e("./utils/common");var o=e("./utils/strings");var a=e("./zlib/messages");var s=e("./zlib/zstream");var l=Object.prototype.toString;var u=0;var c=4;var d=0;var p=1;var f=2;var h=-1;var g=0;var m=8;function v(e){if(!(this instanceof v))return new v(e);this.options=n.assign({level:h,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},e||{});var t=this.options;if(t.raw&&t.windowBits>0){t.windowBits=-t.windowBits}else if(t.gzip&&t.windowBits>0&&t.windowBits<16){t.windowBits+=16}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new s;this.strm.avail_out=0;var i=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==d){throw new Error(a[i])}if(t.header){r.deflateSetHeader(this.strm,t.header)}if(t.dictionary){var u;if(typeof t.dictionary==="string"){u=o.string2buf(t.dictionary)}else if(l.call(t.dictionary)==="[object ArrayBuffer]"){u=new Uint8Array(t.dictionary)}else{u=t.dictionary}i=r.deflateSetDictionary(this.strm,u);if(i!==d){throw new Error(a[i])}this._dict_set=true}}v.prototype.push=function(e,t){var i=this.strm;var a=this.options.chunkSize;var s,h;if(this.ended){return false}h=t===~~t?t:t===true?c:u;if(typeof e==="string"){i.input=o.string2buf(e)}else if(l.call(e)==="[object ArrayBuffer]"){i.input=new Uint8Array(e)}else{i.input=e}i.next_in=0;i.avail_in=i.input.length;do{if(i.avail_out===0){i.output=new n.Buf8(a);i.next_out=0;i.avail_out=a}s=r.deflate(i,h);if(s!==p&&s!==d){this.onEnd(s);this.ended=true;return false}if(i.avail_out===0||i.avail_in===0&&(h===c||h===f)){if(this.options.to==="string"){this.onData(o.buf2binstring(n.shrinkBuf(i.output,i.next_out)))}else{this.onData(n.shrinkBuf(i.output,i.next_out))}}}while((i.avail_in>0||i.avail_out===0)&&s!==p);if(h===c){s=r.deflateEnd(this.strm);this.onEnd(s);this.ended=true;return s===d}if(h===f){this.onEnd(d);i.avail_out=0;return true}return true};v.prototype.onData=function(e){this.chunks.push(e)};v.prototype.onEnd=function(e){if(e===d){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=n.flattenChunks(this.chunks)}}this.chunks=[];this.err=e;this.msg=this.strm.msg};function y(e,t){var i=new v(t);i.push(e,true);if(i.err){throw i.msg}return i.result}function b(e,t){t=t||{};t.raw=true;return y(e,t)}function w(e,t){t=t||{};t.gzip=true;return y(e,t)}i.Deflate=v;i.deflate=y;i.deflateRaw=b;i.gzip=w},{"./utils/common":75,"./utils/strings":76,"./zlib/deflate":80,"./zlib/messages":85,"./zlib/zstream":87}],74:[function(e,t,i){"use strict";var r=e("./zlib/inflate");var n=e("./utils/common");var o=e("./utils/strings");var a=e("./zlib/constants");var s=e("./zlib/messages");var l=e("./zlib/zstream");var u=e("./zlib/gzheader");var c=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;if(t.raw&&t.windowBits>=0&&t.windowBits<16){t.windowBits=-t.windowBits;if(t.windowBits===0){t.windowBits=-15}}if(t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)){t.windowBits+=32}if(t.windowBits>15&&t.windowBits<48){if((t.windowBits&15)===0){t.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new l;this.strm.avail_out=0;var i=r.inflateInit2(this.strm,t.windowBits);if(i!==a.Z_OK){throw new Error(s[i])}this.header=new u;r.inflateGetHeader(this.strm,this.header)}d.prototype.push=function(e,t){var i=this.strm;var s=this.options.chunkSize;var l=this.options.dictionary;var u,d;var p,f,h;var g;var m=false;if(this.ended){return false}d=t===~~t?t:t===true?a.Z_FINISH:a.Z_NO_FLUSH;if(typeof e==="string"){i.input=o.binstring2buf(e)}else if(c.call(e)==="[object ArrayBuffer]"){i.input=new Uint8Array(e)}else{i.input=e}i.next_in=0;i.avail_in=i.input.length;do{if(i.avail_out===0){i.output=new n.Buf8(s);i.next_out=0;i.avail_out=s}u=r.inflate(i,a.Z_NO_FLUSH);if(u===a.Z_NEED_DICT&&l){if(typeof l==="string"){g=o.string2buf(l)}else if(c.call(l)==="[object ArrayBuffer]"){g=new Uint8Array(l)}else{g=l}u=r.inflateSetDictionary(this.strm,g)}if(u===a.Z_BUF_ERROR&&m===true){u=a.Z_OK;m=false}if(u!==a.Z_STREAM_END&&u!==a.Z_OK){this.onEnd(u);this.ended=true;return false}if(i.next_out){if(i.avail_out===0||u===a.Z_STREAM_END||i.avail_in===0&&(d===a.Z_FINISH||d===a.Z_SYNC_FLUSH)){if(this.options.to==="string"){p=o.utf8border(i.output,i.next_out);f=i.next_out-p;h=o.buf2string(i.output,p);i.next_out=f;i.avail_out=s-f;if(f){n.arraySet(i.output,i.output,p,f,0)}this.onData(h)}else{this.onData(n.shrinkBuf(i.output,i.next_out))}}}if(i.avail_in===0&&i.avail_out===0){m=true}}while((i.avail_in>0||i.avail_out===0)&&u!==a.Z_STREAM_END);if(u===a.Z_STREAM_END){d=a.Z_FINISH}if(d===a.Z_FINISH){u=r.inflateEnd(this.strm);this.onEnd(u);this.ended=true;return u===a.Z_OK}if(d===a.Z_SYNC_FLUSH){this.onEnd(a.Z_OK);i.avail_out=0;return true}return true};d.prototype.onData=function(e){this.chunks.push(e)};d.prototype.onEnd=function(e){if(e===a.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=n.flattenChunks(this.chunks)}}this.chunks=[];this.err=e;this.msg=this.strm.msg};function p(e,t){var i=new d(t);i.push(e,true);if(i.err){throw i.msg}return i.result}function f(e,t){t=t||{};t.raw=true;return p(e,t)}i.Inflate=d;i.inflate=p;i.inflateRaw=f;i.ungzip=p},{"./utils/common":75,"./utils/strings":76,"./zlib/constants":78,"./zlib/gzheader":81,"./zlib/inflate":83,"./zlib/messages":85,"./zlib/zstream":87}],75:[function(e,t,i){"use strict";var r=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";i.assign=function(e){var t=Array.prototype.slice.call(arguments,1);while(t.length){var i=t.shift();if(!i){continue;
}if(typeof i!=="object"){throw new TypeError(i+"must be non-object")}for(var r in i){if(i.hasOwnProperty(r)){e[r]=i[r]}}}return e};i.shrinkBuf=function(e,t){if(e.length===t){return e}if(e.subarray){return e.subarray(0,t)}e.length=t;return e};var n={arraySet:function(e,t,i,r,n){if(t.subarray&&e.subarray){e.set(t.subarray(i,i+r),n);return}for(var o=0;o<r;o++){e[n+o]=t[i+o]}},flattenChunks:function(e){var t,i,r,n,o,a;r=0;for(t=0,i=e.length;t<i;t++){r+=e[t].length}a=new Uint8Array(r);n=0;for(t=0,i=e.length;t<i;t++){o=e[t];a.set(o,n);n+=o.length}return a}};var o={arraySet:function(e,t,i,r,n){for(var o=0;o<r;o++){e[n+o]=t[i+o]}},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){if(e){i.Buf8=Uint8Array;i.Buf16=Uint16Array;i.Buf32=Int32Array;i.assign(i,n)}else{i.Buf8=Array;i.Buf16=Array;i.Buf32=Array;i.assign(i,o)}};i.setTyped(r)},{}],76:[function(e,t,i){"use strict";var r=e("./common");var n=true;var o=true;try{String.fromCharCode.apply(null,[0])}catch(e){n=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=false}var a=new r.Buf8(256);for(var s=0;s<256;s++){a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1}a[254]=a[254]=1;i.string2buf=function(e){var t,i,n,o,a,s=e.length,l=0;for(o=0;o<s;o++){i=e.charCodeAt(o);if((i&64512)===55296&&o+1<s){n=e.charCodeAt(o+1);if((n&64512)===56320){i=65536+(i-55296<<10)+(n-56320);o++}}l+=i<128?1:i<2048?2:i<65536?3:4}t=new r.Buf8(l);for(a=0,o=0;a<l;o++){i=e.charCodeAt(o);if((i&64512)===55296&&o+1<s){n=e.charCodeAt(o+1);if((n&64512)===56320){i=65536+(i-55296<<10)+(n-56320);o++}}if(i<128){t[a++]=i}else if(i<2048){t[a++]=192|i>>>6;t[a++]=128|i&63}else if(i<65536){t[a++]=224|i>>>12;t[a++]=128|i>>>6&63;t[a++]=128|i&63}else{t[a++]=240|i>>>18;t[a++]=128|i>>>12&63;t[a++]=128|i>>>6&63;t[a++]=128|i&63}}return t};function l(e,t){if(t<65537){if(e.subarray&&o||!e.subarray&&n){return String.fromCharCode.apply(null,r.shrinkBuf(e,t))}}var i="";for(var a=0;a<t;a++){i+=String.fromCharCode(e[a])}return i}i.buf2binstring=function(e){return l(e,e.length)};i.binstring2buf=function(e){var t=new r.Buf8(e.length);for(var i=0,n=t.length;i<n;i++){t[i]=e.charCodeAt(i)}return t};i.buf2string=function(e,t){var i,r,n,o;var s=t||e.length;var u=new Array(s*2);for(r=0,i=0;i<s;){n=e[i++];if(n<128){u[r++]=n;continue}o=a[n];if(o>4){u[r++]=65533;i+=o-1;continue}n&=o===2?31:o===3?15:7;while(o>1&&i<s){n=n<<6|e[i++]&63;o--}if(o>1){u[r++]=65533;continue}if(n<65536){u[r++]=n}else{n-=65536;u[r++]=55296|n>>10&1023;u[r++]=56320|n&1023}}return l(u,r)};i.utf8border=function(e,t){var i;t=t||e.length;if(t>e.length){t=e.length}i=t-1;while(i>=0&&(e[i]&192)===128){i--}if(i<0){return t}if(i===0){return t}return i+a[e[i]]>t?i:t}},{"./common":75}],77:[function(e,t,i){"use strict";function r(e,t,i,r){var n=e&65535|0,o=e>>>16&65535|0,a=0;while(i!==0){a=i>2e3?2e3:i;i-=a;do{n=n+t[r++]|0;o=o+n|0}while(--a);n%=65521;o%=65521}return n|o<<16|0}t.exports=r},{}],78:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],79:[function(e,t,i){"use strict";function r(){var e,t=[];for(var i=0;i<256;i++){e=i;for(var r=0;r<8;r++){e=e&1?3988292384^e>>>1:e>>>1}t[i]=e}return t}var n=r();function o(e,t,i,r){var o=n,a=r+i;e^=-1;for(var s=r;s<a;s++){e=e>>>8^o[(e^t[s])&255]}return e^-1}t.exports=o},{}],80:[function(e,t,i){"use strict";var r=e("../utils/common");var n=e("./trees");var o=e("./adler32");var a=e("./crc32");var s=e("./messages");var l=0;var u=1;var c=3;var d=4;var p=5;var f=0;var h=1;var g=-2;var m=-3;var v=-5;var y=-1;var b=1;var w=2;var C=3;var E=4;var S=0;var T=2;var x=8;var _=9;var M=15;var A=8;var I=29;var O=256;var D=O+1+I;var N=30;var R=19;var P=2*D+1;var L=15;var k=3;var $=258;var F=$+k+1;var V=32;var q=42;var H=69;var U=73;var B=91;var z=103;var j=113;var G=666;var W=1;var Q=2;var K=3;var Y=4;var X=3;function J(e,t){e.msg=s[t];return t}function Z(e){return(e<<1)-(e>4?9:0)}function ee(e){var t=e.length;while(--t>=0){e[t]=0}}function te(e){var t=e.state;var i=t.pending;if(i>e.avail_out){i=e.avail_out}if(i===0){return}r.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out);e.next_out+=i;t.pending_out+=i;e.total_out+=i;e.avail_out-=i;t.pending-=i;if(t.pending===0){t.pending_out=0}}function ie(e,t){n._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t);e.block_start=e.strstart;te(e.strm)}function re(e,t){e.pending_buf[e.pending++]=t}function ne(e,t){e.pending_buf[e.pending++]=t>>>8&255;e.pending_buf[e.pending++]=t&255}function oe(e,t,i,n){var s=e.avail_in;if(s>n){s=n}if(s===0){return 0}e.avail_in-=s;r.arraySet(t,e.input,e.next_in,s,i);if(e.state.wrap===1){e.adler=o(e.adler,t,s,i)}else if(e.state.wrap===2){e.adler=a(e.adler,t,s,i)}e.next_in+=s;e.total_in+=s;return s}function ae(e,t){var i=e.max_chain_length;var r=e.strstart;var n;var o;var a=e.prev_length;var s=e.nice_match;var l=e.strstart>e.w_size-F?e.strstart-(e.w_size-F):0;var u=e.window;var c=e.w_mask;var d=e.prev;var p=e.strstart+$;var f=u[r+a-1];var h=u[r+a];if(e.prev_length>=e.good_match){i>>=2}if(s>e.lookahead){s=e.lookahead}do{n=t;if(u[n+a]!==h||u[n+a-1]!==f||u[n]!==u[r]||u[++n]!==u[r+1]){continue}r+=2;n++;do{}while(u[++r]===u[++n]&&u[++r]===u[++n]&&u[++r]===u[++n]&&u[++r]===u[++n]&&u[++r]===u[++n]&&u[++r]===u[++n]&&u[++r]===u[++n]&&u[++r]===u[++n]&&r<p);o=$-(p-r);r=p-$;if(o>a){e.match_start=t;a=o;if(o>=s){break}f=u[r+a-1];h=u[r+a]}}while((t=d[t&c])>l&&--i!==0);if(a<=e.lookahead){return a}return e.lookahead}function se(e){var t=e.w_size;var i,n,o,a,s;do{a=e.window_size-e.lookahead-e.strstart;if(e.strstart>=t+(t-F)){r.arraySet(e.window,e.window,t,t,0);e.match_start-=t;e.strstart-=t;e.block_start-=t;n=e.hash_size;i=n;do{o=e.head[--i];e.head[i]=o>=t?o-t:0}while(--n);n=t;i=n;do{o=e.prev[--i];e.prev[i]=o>=t?o-t:0}while(--n);a+=t}if(e.strm.avail_in===0){break}n=oe(e.strm,e.window,e.strstart+e.lookahead,a);e.lookahead+=n;if(e.lookahead+e.insert>=k){s=e.strstart-e.insert;e.ins_h=e.window[s];e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;while(e.insert){e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+k-1])&e.hash_mask;e.prev[s&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=s;s++;e.insert--;if(e.lookahead+e.insert<k){break}}}}while(e.lookahead<F&&e.strm.avail_in!==0)}function le(e,t){var i=65535;if(i>e.pending_buf_size-5){i=e.pending_buf_size-5}for(;;){if(e.lookahead<=1){se(e);if(e.lookahead===0&&t===l){return W}if(e.lookahead===0){break}}e.strstart+=e.lookahead;e.lookahead=0;var r=e.block_start+i;if(e.strstart===0||e.strstart>=r){e.lookahead=e.strstart-r;e.strstart=r;ie(e,false);if(e.strm.avail_out===0){return W}}if(e.strstart-e.block_start>=e.w_size-F){ie(e,false);if(e.strm.avail_out===0){return W}}}e.insert=0;if(t===d){ie(e,true);if(e.strm.avail_out===0){return K}return Y}if(e.strstart>e.block_start){ie(e,false);if(e.strm.avail_out===0){return W}}return W}function ue(e,t){var i;var r;for(;;){if(e.lookahead<F){se(e);if(e.lookahead<F&&t===l){return W}if(e.lookahead===0){break}}i=0;if(e.lookahead>=k){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask;i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}if(i!==0&&e.strstart-i<=e.w_size-F){e.match_length=ae(e,i)}if(e.match_length>=k){r=n._tr_tally(e,e.strstart-e.match_start,e.match_length-k);e.lookahead-=e.match_length;if(e.match_length<=e.max_lazy_match&&e.lookahead>=k){e.match_length--;do{e.strstart++;e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask;i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}while(--e.match_length!==0);e.strstart++}else{e.strstart+=e.match_length;e.match_length=0;e.ins_h=e.window[e.strstart];e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask}}else{r=n._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(r){ie(e,false);if(e.strm.avail_out===0){return W}}}e.insert=e.strstart<k-1?e.strstart:k-1;if(t===d){ie(e,true);if(e.strm.avail_out===0){return K}return Y}if(e.last_lit){ie(e,false);if(e.strm.avail_out===0){return W}}return Q}function ce(e,t){var i;var r;var o;for(;;){if(e.lookahead<F){se(e);if(e.lookahead<F&&t===l){return W}if(e.lookahead===0){break}}i=0;if(e.lookahead>=k){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask;i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}e.prev_length=e.match_length;e.prev_match=e.match_start;e.match_length=k-1;if(i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-F){e.match_length=ae(e,i);if(e.match_length<=5&&(e.strategy===b||e.match_length===k&&e.strstart-e.match_start>4096)){e.match_length=k-1}}if(e.prev_length>=k&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-k;r=n._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-k);e.lookahead-=e.prev_length-1;e.prev_length-=2;do{if(++e.strstart<=o){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask;i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}}while(--e.prev_length!==0);e.match_available=0;e.match_length=k-1;e.strstart++;if(r){ie(e,false);if(e.strm.avail_out===0){return W}}}else if(e.match_available){r=n._tr_tally(e,0,e.window[e.strstart-1]);if(r){ie(e,false)}e.strstart++;e.lookahead--;if(e.strm.avail_out===0){return W}}else{e.match_available=1;e.strstart++;e.lookahead--}}if(e.match_available){r=n._tr_tally(e,0,e.window[e.strstart-1]);e.match_available=0}e.insert=e.strstart<k-1?e.strstart:k-1;if(t===d){ie(e,true);if(e.strm.avail_out===0){return K}return Y}if(e.last_lit){ie(e,false);if(e.strm.avail_out===0){return W}}return Q}function de(e,t){var i;var r;var o,a;var s=e.window;for(;;){if(e.lookahead<=$){se(e);if(e.lookahead<=$&&t===l){return W}if(e.lookahead===0){break}}e.match_length=0;if(e.lookahead>=k&&e.strstart>0){o=e.strstart-1;r=s[o];if(r===s[++o]&&r===s[++o]&&r===s[++o]){a=e.strstart+$;do{}while(r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&o<a);e.match_length=$-(a-o);if(e.match_length>e.lookahead){e.match_length=e.lookahead}}}if(e.match_length>=k){i=n._tr_tally(e,1,e.match_length-k);e.lookahead-=e.match_length;e.strstart+=e.match_length;e.match_length=0}else{i=n._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(i){ie(e,false);if(e.strm.avail_out===0){return W}}}e.insert=0;if(t===d){ie(e,true);if(e.strm.avail_out===0){return K}return Y}if(e.last_lit){ie(e,false);if(e.strm.avail_out===0){return W}}return Q}function pe(e,t){var i;for(;;){if(e.lookahead===0){se(e);if(e.lookahead===0){if(t===l){return W}break}}e.match_length=0;i=n._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++;if(i){ie(e,false);if(e.strm.avail_out===0){return W}}}e.insert=0;if(t===d){ie(e,true);if(e.strm.avail_out===0){return K}return Y}if(e.last_lit){ie(e,false);if(e.strm.avail_out===0){return W}}return Q}function fe(e,t,i,r,n){this.good_length=e;this.max_lazy=t;this.nice_length=i;this.max_chain=r;this.func=n}var he;he=[new fe(0,0,0,0,le),new fe(4,4,8,4,ue),new fe(4,5,16,8,ue),new fe(4,6,32,32,ue),new fe(4,4,16,16,ce),new fe(8,16,32,32,ce),new fe(8,16,128,128,ce),new fe(8,32,128,256,ce),new fe(32,128,258,1024,ce),new fe(32,258,258,4096,ce)];function ge(e){e.window_size=2*e.w_size;ee(e.head);e.max_lazy_match=he[e.level].max_lazy;e.good_match=he[e.level].good_length;e.nice_match=he[e.level].nice_length;e.max_chain_length=he[e.level].max_chain;e.strstart=0;e.block_start=0;e.lookahead=0;e.insert=0;e.match_length=e.prev_length=k-1;e.match_available=0;e.ins_h=0}function me(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=x;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new r.Buf16(P*2);this.dyn_dtree=new r.Buf16((2*N+1)*2);this.bl_tree=new r.Buf16((2*R+1)*2);ee(this.dyn_ltree);ee(this.dyn_dtree);ee(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new r.Buf16(L+1);this.heap=new r.Buf16(2*D+1);ee(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new r.Buf16(2*D+1);ee(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function ve(e){var t;if(!e||!e.state){return J(e,g)}e.total_in=e.total_out=0;e.data_type=T;t=e.state;t.pending=0;t.pending_out=0;if(t.wrap<0){t.wrap=-t.wrap}t.status=t.wrap?q:j;e.adler=t.wrap===2?0:1;t.last_flush=l;n._tr_init(t);return f}function ye(e){var t=ve(e);if(t===f){ge(e.state)}return t}function be(e,t){if(!e||!e.state){return g}if(e.state.wrap!==2){return g}e.state.gzhead=t;return f}function we(e,t,i,n,o,a){if(!e){return g}var s=1;if(t===y){t=6}if(n<0){s=0;n=-n}else if(n>15){s=2;n-=16}if(o<1||o>_||i!==x||n<8||n>15||t<0||t>9||a<0||a>E){return J(e,g)}if(n===8){n=9}var l=new me;e.state=l;l.strm=e;l.wrap=s;l.gzhead=null;l.w_bits=n;l.w_size=1<<l.w_bits;l.w_mask=l.w_size-1;l.hash_bits=o+7;l.hash_size=1<<l.hash_bits;l.hash_mask=l.hash_size-1;l.hash_shift=~~((l.hash_bits+k-1)/k);l.window=new r.Buf8(l.w_size*2);l.head=new r.Buf16(l.hash_size);l.prev=new r.Buf16(l.w_size);l.lit_bufsize=1<<o+6;l.pending_buf_size=l.lit_bufsize*4;l.pending_buf=new r.Buf8(l.pending_buf_size);l.d_buf=1*l.lit_bufsize;l.l_buf=(1+2)*l.lit_bufsize;l.level=t;l.strategy=a;l.method=i;return ye(e)}function Ce(e,t){return we(e,t,x,M,A,S)}function Ee(e,t){var i,r;var o,s;if(!e||!e.state||t>p||t<0){return e?J(e,g):g}r=e.state;if(!e.output||!e.input&&e.avail_in!==0||r.status===G&&t!==d){return J(e,e.avail_out===0?v:g)}r.strm=e;i=r.last_flush;r.last_flush=t;if(r.status===q){if(r.wrap===2){e.adler=0;re(r,31);re(r,139);re(r,8);if(!r.gzhead){re(r,0);re(r,0);re(r,0);re(r,0);re(r,0);re(r,r.level===9?2:r.strategy>=w||r.level<2?4:0);re(r,X);r.status=j}else{re(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(!r.gzhead.extra?0:4)+(!r.gzhead.name?0:8)+(!r.gzhead.comment?0:16));re(r,r.gzhead.time&255);re(r,r.gzhead.time>>8&255);re(r,r.gzhead.time>>16&255);re(r,r.gzhead.time>>24&255);re(r,r.level===9?2:r.strategy>=w||r.level<2?4:0);re(r,r.gzhead.os&255);if(r.gzhead.extra&&r.gzhead.extra.length){re(r,r.gzhead.extra.length&255);re(r,r.gzhead.extra.length>>8&255)}if(r.gzhead.hcrc){e.adler=a(e.adler,r.pending_buf,r.pending,0)}r.gzindex=0;r.status=H}}else{var m=x+(r.w_bits-8<<4)<<8;var y=-1;if(r.strategy>=w||r.level<2){y=0}else if(r.level<6){y=1}else if(r.level===6){y=2}else{y=3}m|=y<<6;if(r.strstart!==0){m|=V}m+=31-m%31;r.status=j;ne(r,m);if(r.strstart!==0){ne(r,e.adler>>>16);ne(r,e.adler&65535)}e.adler=1}}if(r.status===H){if(r.gzhead.extra){o=r.pending;while(r.gzindex<(r.gzhead.extra.length&65535)){if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o){e.adler=a(e.adler,r.pending_buf,r.pending-o,o)}te(e);o=r.pending;if(r.pending===r.pending_buf_size){break}}re(r,r.gzhead.extra[r.gzindex]&255);r.gzindex++}if(r.gzhead.hcrc&&r.pending>o){e.adler=a(e.adler,r.pending_buf,r.pending-o,o)}if(r.gzindex===r.gzhead.extra.length){r.gzindex=0;r.status=U}}else{r.status=U}}if(r.status===U){if(r.gzhead.name){o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o){e.adler=a(e.adler,r.pending_buf,r.pending-o,o)}te(e);o=r.pending;if(r.pending===r.pending_buf_size){s=1;break}}if(r.gzindex<r.gzhead.name.length){s=r.gzhead.name.charCodeAt(r.gzindex++)&255}else{s=0}re(r,s)}while(s!==0);if(r.gzhead.hcrc&&r.pending>o){e.adler=a(e.adler,r.pending_buf,r.pending-o,o)}if(s===0){r.gzindex=0;r.status=B}}else{r.status=B}}if(r.status===B){if(r.gzhead.comment){o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o){e.adler=a(e.adler,r.pending_buf,r.pending-o,o)}te(e);o=r.pending;if(r.pending===r.pending_buf_size){s=1;break}}if(r.gzindex<r.gzhead.comment.length){s=r.gzhead.comment.charCodeAt(r.gzindex++)&255}else{s=0}re(r,s)}while(s!==0);if(r.gzhead.hcrc&&r.pending>o){e.adler=a(e.adler,r.pending_buf,r.pending-o,o)}if(s===0){r.status=z}}else{r.status=z}}if(r.status===z){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size){te(e)}if(r.pending+2<=r.pending_buf_size){re(r,e.adler&255);re(r,e.adler>>8&255);e.adler=0;r.status=j}}else{r.status=j}}if(r.pending!==0){te(e);if(e.avail_out===0){r.last_flush=-1;return f}}else if(e.avail_in===0&&Z(t)<=Z(i)&&t!==d){return J(e,v)}if(r.status===G&&e.avail_in!==0){return J(e,v)}if(e.avail_in!==0||r.lookahead!==0||t!==l&&r.status!==G){var b=r.strategy===w?pe(r,t):r.strategy===C?de(r,t):he[r.level].func(r,t);if(b===K||b===Y){r.status=G}if(b===W||b===K){if(e.avail_out===0){r.last_flush=-1}return f}if(b===Q){if(t===u){n._tr_align(r)}else if(t!==p){n._tr_stored_block(r,0,0,false);if(t===c){ee(r.head);if(r.lookahead===0){r.strstart=0;r.block_start=0;r.insert=0}}}te(e);if(e.avail_out===0){r.last_flush=-1;return f}}}if(t!==d){return f}if(r.wrap<=0){return h}if(r.wrap===2){re(r,e.adler&255);re(r,e.adler>>8&255);re(r,e.adler>>16&255);re(r,e.adler>>24&255);re(r,e.total_in&255);re(r,e.total_in>>8&255);re(r,e.total_in>>16&255);re(r,e.total_in>>24&255)}else{ne(r,e.adler>>>16);ne(r,e.adler&65535)}te(e);if(r.wrap>0){r.wrap=-r.wrap}return r.pending!==0?f:h}function Se(e){var t;if(!e||!e.state){return g}t=e.state.status;if(t!==q&&t!==H&&t!==U&&t!==B&&t!==z&&t!==j&&t!==G){return J(e,g)}e.state=null;return t===j?J(e,m):f}function Te(e,t){var i=t.length;var n;var a,s;var l;var u;var c;var d;var p;if(!e||!e.state){return g}n=e.state;l=n.wrap;if(l===2||l===1&&n.status!==q||n.lookahead){return g}if(l===1){e.adler=o(e.adler,t,i,0)}n.wrap=0;if(i>=n.w_size){if(l===0){ee(n.head);n.strstart=0;n.block_start=0;n.insert=0}p=new r.Buf8(n.w_size);r.arraySet(p,t,i-n.w_size,n.w_size,0);t=p;i=n.w_size}u=e.avail_in;c=e.next_in;d=e.input;e.avail_in=i;e.next_in=0;e.input=t;se(n);while(n.lookahead>=k){a=n.strstart;s=n.lookahead-(k-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[a+k-1])&n.hash_mask;n.prev[a&n.w_mask]=n.head[n.ins_h];n.head[n.ins_h]=a;a++}while(--s);n.strstart=a;n.lookahead=k-1;se(n)}n.strstart+=n.lookahead;n.block_start=n.strstart;n.insert=n.lookahead;n.lookahead=0;n.match_length=n.prev_length=k-1;n.match_available=0;e.next_in=c;e.input=d;e.avail_in=u;n.wrap=l;return f}i.deflateInit=Ce;i.deflateInit2=we;i.deflateReset=ye;i.deflateResetKeep=ve;i.deflateSetHeader=be;i.deflate=Ee;i.deflateEnd=Se;i.deflateSetDictionary=Te;i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":75,"./adler32":77,"./crc32":79,"./messages":85,"./trees":86}],81:[function(e,t,i){"use strict";function r(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}t.exports=r},{}],82:[function(e,t,i){"use strict";var r=30;var n=12;t.exports=function e(t,i){var o;var a;var s;var l;var u;var c;var d;var p;var f;var h;var g;var m;var v;var y;var b;var w;var C;var E;var S;var T;var x;var _;var M;var A,I;o=t.state;a=t.next_in;A=t.input;s=a+(t.avail_in-5);l=t.next_out;I=t.output;u=l-(i-t.avail_out);c=l+(t.avail_out-257);d=o.dmax;p=o.wsize;f=o.whave;h=o.wnext;g=o.window;m=o.hold;v=o.bits;y=o.lencode;b=o.distcode;w=(1<<o.lenbits)-1;C=(1<<o.distbits)-1;e:do{if(v<15){m+=A[a++]<<v;v+=8;m+=A[a++]<<v;v+=8}E=y[m&w];t:for(;;){S=E>>>24;m>>>=S;v-=S;S=E>>>16&255;if(S===0){I[l++]=E&65535}else if(S&16){T=E&65535;S&=15;if(S){if(v<S){m+=A[a++]<<v;v+=8}T+=m&(1<<S)-1;m>>>=S;v-=S}if(v<15){m+=A[a++]<<v;v+=8;m+=A[a++]<<v;v+=8}E=b[m&C];i:for(;;){S=E>>>24;m>>>=S;v-=S;S=E>>>16&255;if(S&16){x=E&65535;S&=15;if(v<S){m+=A[a++]<<v;v+=8;if(v<S){m+=A[a++]<<v;v+=8}}x+=m&(1<<S)-1;if(x>d){t.msg="invalid distance too far back";o.mode=r;break e}m>>>=S;v-=S;S=l-u;if(x>S){S=x-S;if(S>f){if(o.sane){t.msg="invalid distance too far back";o.mode=r;break e}}_=0;M=g;if(h===0){_+=p-S;if(S<T){T-=S;do{I[l++]=g[_++]}while(--S);_=l-x;M=I}}else if(h<S){_+=p+h-S;S-=h;if(S<T){T-=S;do{I[l++]=g[_++]}while(--S);_=0;if(h<T){S=h;T-=S;do{I[l++]=g[_++]}while(--S);_=l-x;M=I}}}else{_+=h-S;if(S<T){T-=S;do{I[l++]=g[_++]}while(--S);_=l-x;M=I}}while(T>2){I[l++]=M[_++];I[l++]=M[_++];I[l++]=M[_++];T-=3}if(T){I[l++]=M[_++];if(T>1){I[l++]=M[_++]}}}else{_=l-x;do{I[l++]=I[_++];I[l++]=I[_++];I[l++]=I[_++];T-=3}while(T>2);if(T){I[l++]=I[_++];if(T>1){I[l++]=I[_++]}}}}else if((S&64)===0){E=b[(E&65535)+(m&(1<<S)-1)];continue i}else{t.msg="invalid distance code";o.mode=r;break e}break}}else if((S&64)===0){E=y[(E&65535)+(m&(1<<S)-1)];continue t}else if(S&32){o.mode=n;break e}else{t.msg="invalid literal/length code";o.mode=r;break e}break}}while(a<s&&l<c);T=v>>3;a-=T;v-=T<<3;m&=(1<<v)-1;t.next_in=a;t.next_out=l;t.avail_in=a<s?5+(s-a):5-(a-s);t.avail_out=l<c?257+(c-l):257-(l-c);o.hold=m;o.bits=v;return}},{}],83:[function(e,t,i){"use strict";var r=e("../utils/common");var n=e("./adler32");var o=e("./crc32");var a=e("./inffast");var s=e("./inftrees");var l=0;var u=1;var c=2;var d=4;var p=5;var f=6;var h=0;var g=1;var m=2;var v=-2;var y=-3;var b=-4;var w=-5;var C=8;var E=1;var S=2;var T=3;var x=4;var _=5;var M=6;var A=7;var I=8;var O=9;var D=10;var N=11;var R=12;var P=13;var L=14;var k=15;var $=16;var F=17;var V=18;var q=19;var H=20;var U=21;var B=22;var z=23;var j=24;var G=25;var W=26;var Q=27;var K=28;var Y=29;var X=30;var J=31;var Z=32;var ee=852;var te=592;var ie=15;var re=ie;function ne(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function oe(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new r.Buf16(320);this.work=new r.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function ae(e){var t;if(!e||!e.state){return v}t=e.state;e.total_in=e.total_out=t.total=0;e.msg="";if(t.wrap){e.adler=t.wrap&1}t.mode=E;t.last=0;t.havedict=0;t.dmax=32768;t.head=null;t.hold=0;t.bits=0;t.lencode=t.lendyn=new r.Buf32(ee);t.distcode=t.distdyn=new r.Buf32(te);t.sane=1;t.back=-1;return h}function se(e){var t;if(!e||!e.state){return v}t=e.state;t.wsize=0;t.whave=0;t.wnext=0;return ae(e)}function le(e,t){var i;var r;if(!e||!e.state){return v}r=e.state;if(t<0){i=0;t=-t}else{i=(t>>4)+1;if(t<48){t&=15}}if(t&&(t<8||t>15)){return v}if(r.window!==null&&r.wbits!==t){r.window=null}r.wrap=i;r.wbits=t;return se(e)}function ue(e,t){var i;var r;if(!e){return v}r=new oe;e.state=r;r.window=null;i=le(e,t);if(i!==h){e.state=null}return i}function ce(e){return ue(e,re)}var de=true;var pe,fe;function he(e){if(de){var t;pe=new r.Buf32(512);fe=new r.Buf32(32);t=0;while(t<144){e.lens[t++]=8}while(t<256){e.lens[t++]=9}while(t<280){e.lens[t++]=7}while(t<288){e.lens[t++]=8}s(u,e.lens,0,288,pe,0,e.work,{bits:9});t=0;while(t<32){e.lens[t++]=5}s(c,e.lens,0,32,fe,0,e.work,{bits:5});de=false}e.lencode=pe;e.lenbits=9;e.distcode=fe;e.distbits=5}function ge(e,t,i,n){var o;var a=e.state;if(a.window===null){a.wsize=1<<a.wbits;a.wnext=0;a.whave=0;a.window=new r.Buf8(a.wsize)}if(n>=a.wsize){r.arraySet(a.window,t,i-a.wsize,a.wsize,0);a.wnext=0;a.whave=a.wsize}else{o=a.wsize-a.wnext;if(o>n){o=n}r.arraySet(a.window,t,i-n,o,a.wnext);n-=o;if(n){r.arraySet(a.window,t,i-n,n,0);a.wnext=n;a.whave=a.wsize}else{a.wnext+=o;if(a.wnext===a.wsize){a.wnext=0}if(a.whave<a.wsize){a.whave+=o}}}return 0}function me(e,t){var i;var ee,te;var ie;var re;var oe,ae;var se;var le;var ue,ce;var de;var pe;var fe;var me=0;var ve,ye,be;var we,Ce,Ee;var Se;var Te;var xe=new r.Buf8(4);var _e;var Me;var Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0){return v}i=e.state;if(i.mode===R){i.mode=P}re=e.next_out;te=e.output;ae=e.avail_out;ie=e.next_in;ee=e.input;oe=e.avail_in;se=i.hold;le=i.bits;ue=oe;ce=ae;Te=h;e:for(;;){switch(i.mode){case E:if(i.wrap===0){i.mode=P;break}while(le<16){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}if(i.wrap&2&&se===35615){i.check=0;xe[0]=se&255;xe[1]=se>>>8&255;i.check=o(i.check,xe,2,0);se=0;le=0;i.mode=S;break}i.flags=0;if(i.head){i.head.done=false}if(!(i.wrap&1)||(((se&255)<<8)+(se>>8))%31){e.msg="incorrect header check";i.mode=X;break}if((se&15)!==C){e.msg="unknown compression method";i.mode=X;break}se>>>=4;le-=4;Se=(se&15)+8;if(i.wbits===0){i.wbits=Se}else if(Se>i.wbits){e.msg="invalid window size";i.mode=X;break}i.dmax=1<<Se;e.adler=i.check=1;i.mode=se&512?D:R;se=0;le=0;break;case S:while(le<16){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}i.flags=se;if((i.flags&255)!==C){e.msg="unknown compression method";i.mode=X;break}if(i.flags&57344){e.msg="unknown header flags set";i.mode=X;break}if(i.head){i.head.text=se>>8&1}if(i.flags&512){xe[0]=se&255;xe[1]=se>>>8&255;i.check=o(i.check,xe,2,0)}se=0;le=0;i.mode=T;case T:while(le<32){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}if(i.head){i.head.time=se}if(i.flags&512){xe[0]=se&255;xe[1]=se>>>8&255;xe[2]=se>>>16&255;xe[3]=se>>>24&255;i.check=o(i.check,xe,4,0)}se=0;le=0;i.mode=x;case x:while(le<16){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}if(i.head){i.head.xflags=se&255;i.head.os=se>>8}if(i.flags&512){xe[0]=se&255;xe[1]=se>>>8&255;i.check=o(i.check,xe,2,0)}se=0;le=0;i.mode=_;case _:if(i.flags&1024){while(le<16){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}i.length=se;if(i.head){i.head.extra_len=se}if(i.flags&512){xe[0]=se&255;xe[1]=se>>>8&255;i.check=o(i.check,xe,2,0)}se=0;le=0}else if(i.head){i.head.extra=null}i.mode=M;case M:if(i.flags&1024){de=i.length;if(de>oe){de=oe}if(de){if(i.head){Se=i.head.extra_len-i.length;if(!i.head.extra){i.head.extra=new Array(i.head.extra_len)}r.arraySet(i.head.extra,ee,ie,de,Se)}if(i.flags&512){i.check=o(i.check,ee,de,ie)}oe-=de;ie+=de;i.length-=de}if(i.length){break e}}i.length=0;i.mode=A;case A:if(i.flags&2048){if(oe===0){break e}de=0;do{Se=ee[ie+de++];if(i.head&&Se&&i.length<65536){i.head.name+=String.fromCharCode(Se)}}while(Se&&de<oe);if(i.flags&512){i.check=o(i.check,ee,de,ie)}oe-=de;ie+=de;if(Se){break e}}else if(i.head){i.head.name=null}i.length=0;i.mode=I;case I:if(i.flags&4096){if(oe===0){break e}de=0;do{Se=ee[ie+de++];if(i.head&&Se&&i.length<65536){i.head.comment+=String.fromCharCode(Se)}}while(Se&&de<oe);if(i.flags&512){i.check=o(i.check,ee,de,ie)}oe-=de;ie+=de;if(Se){break e}}else if(i.head){i.head.comment=null}i.mode=O;case O:if(i.flags&512){while(le<16){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}if(se!==(i.check&65535)){e.msg="header crc mismatch";i.mode=X;break}se=0;le=0}if(i.head){i.head.hcrc=i.flags>>9&1;i.head.done=true}e.adler=i.check=0;i.mode=R;break;case D:while(le<32){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}e.adler=i.check=ne(se);se=0;le=0;i.mode=N;case N:if(i.havedict===0){e.next_out=re;e.avail_out=ae;e.next_in=ie;e.avail_in=oe;i.hold=se;i.bits=le;return m}e.adler=i.check=1;i.mode=R;case R:if(t===p||t===f){break e}case P:if(i.last){se>>>=le&7;le-=le&7;i.mode=Q;break}while(le<3){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}i.last=se&1;se>>>=1;le-=1;switch(se&3){case 0:i.mode=L;break;case 1:he(i);i.mode=H;if(t===f){se>>>=2;le-=2;break e}break;case 2:i.mode=F;break;case 3:e.msg="invalid block type";i.mode=X}se>>>=2;le-=2;break;case L:se>>>=le&7;le-=le&7;while(le<32){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}if((se&65535)!==(se>>>16^65535)){e.msg="invalid stored block lengths";i.mode=X;break}i.length=se&65535;se=0;le=0;i.mode=k;if(t===f){break e}case k:i.mode=$;case $:de=i.length;if(de){if(de>oe){de=oe}if(de>ae){de=ae}if(de===0){break e}r.arraySet(te,ee,ie,de,re);oe-=de;ie+=de;ae-=de;re+=de;i.length-=de;break}i.mode=R;break;case F:while(le<14){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}i.nlen=(se&31)+257;se>>>=5;le-=5;i.ndist=(se&31)+1;se>>>=5;le-=5;i.ncode=(se&15)+4;se>>>=4;le-=4;if(i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols";i.mode=X;break}i.have=0;i.mode=V;case V:while(i.have<i.ncode){while(le<3){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}i.lens[Ae[i.have++]]=se&7;se>>>=3;le-=3}while(i.have<19){i.lens[Ae[i.have++]]=0}i.lencode=i.lendyn;i.lenbits=7;_e={bits:i.lenbits};Te=s(l,i.lens,0,19,i.lencode,0,i.work,_e);i.lenbits=_e.bits;if(Te){e.msg="invalid code lengths set";i.mode=X;break}i.have=0;i.mode=q;case q:while(i.have<i.nlen+i.ndist){for(;;){me=i.lencode[se&(1<<i.lenbits)-1];ve=me>>>24;ye=me>>>16&255;be=me&65535;if(ve<=le){break}if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}if(be<16){se>>>=ve;le-=ve;i.lens[i.have++]=be}else{if(be===16){Me=ve+2;while(le<Me){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}se>>>=ve;le-=ve;if(i.have===0){e.msg="invalid bit length repeat";i.mode=X;break}Se=i.lens[i.have-1];de=3+(se&3);se>>>=2;le-=2}else if(be===17){Me=ve+3;while(le<Me){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}se>>>=ve;le-=ve;Se=0;de=3+(se&7);se>>>=3;le-=3}else{Me=ve+7;while(le<Me){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}se>>>=ve;le-=ve;Se=0;de=11+(se&127);se>>>=7;le-=7}if(i.have+de>i.nlen+i.ndist){e.msg="invalid bit length repeat";i.mode=X;break}while(de--){i.lens[i.have++]=Se}}}if(i.mode===X){break}if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block";i.mode=X;break}i.lenbits=9;_e={bits:i.lenbits};Te=s(u,i.lens,0,i.nlen,i.lencode,0,i.work,_e);i.lenbits=_e.bits;if(Te){e.msg="invalid literal/lengths set";i.mode=X;break}i.distbits=6;i.distcode=i.distdyn;_e={bits:i.distbits};Te=s(c,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,_e);i.distbits=_e.bits;if(Te){e.msg="invalid distances set";i.mode=X;break}i.mode=H;if(t===f){break e}case H:i.mode=U;case U:if(oe>=6&&ae>=258){e.next_out=re;e.avail_out=ae;e.next_in=ie;e.avail_in=oe;i.hold=se;i.bits=le;a(e,ce);re=e.next_out;te=e.output;ae=e.avail_out;ie=e.next_in;ee=e.input;oe=e.avail_in;se=i.hold;le=i.bits;if(i.mode===R){i.back=-1}break}i.back=0;for(;;){me=i.lencode[se&(1<<i.lenbits)-1];ve=me>>>24;ye=me>>>16&255;be=me&65535;if(ve<=le){break}if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}if(ye&&(ye&240)===0){we=ve;Ce=ye;Ee=be;for(;;){me=i.lencode[Ee+((se&(1<<we+Ce)-1)>>we)];ve=me>>>24;ye=me>>>16&255;be=me&65535;if(we+ve<=le){break}if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}se>>>=we;le-=we;i.back+=we}se>>>=ve;le-=ve;i.back+=ve;i.length=be;if(ye===0){i.mode=W;break}if(ye&32){i.back=-1;i.mode=R;break}if(ye&64){e.msg="invalid literal/length code";i.mode=X;break}i.extra=ye&15;i.mode=B;case B:if(i.extra){Me=i.extra;while(le<Me){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}i.length+=se&(1<<i.extra)-1;se>>>=i.extra;le-=i.extra;i.back+=i.extra}i.was=i.length;i.mode=z;case z:for(;;){me=i.distcode[se&(1<<i.distbits)-1];ve=me>>>24;ye=me>>>16&255;be=me&65535;if(ve<=le){break}if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}if((ye&240)===0){we=ve;Ce=ye;Ee=be;for(;;){me=i.distcode[Ee+((se&(1<<we+Ce)-1)>>we)];ve=me>>>24;ye=me>>>16&255;be=me&65535;if(we+ve<=le){break}if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}se>>>=we;le-=we;i.back+=we}se>>>=ve;le-=ve;i.back+=ve;if(ye&64){e.msg="invalid distance code";i.mode=X;break}i.offset=be;i.extra=ye&15;i.mode=j;case j:if(i.extra){Me=i.extra;while(le<Me){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}i.offset+=se&(1<<i.extra)-1;se>>>=i.extra;le-=i.extra;i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back";i.mode=X;break}i.mode=G;case G:if(ae===0){break e}de=ce-ae;if(i.offset>de){de=i.offset-de;if(de>i.whave){if(i.sane){e.msg="invalid distance too far back";i.mode=X;break}}if(de>i.wnext){de-=i.wnext;pe=i.wsize-de;
}else{pe=i.wnext-de}if(de>i.length){de=i.length}fe=i.window}else{fe=te;pe=re-i.offset;de=i.length}if(de>ae){de=ae}ae-=de;i.length-=de;do{te[re++]=fe[pe++]}while(--de);if(i.length===0){i.mode=U}break;case W:if(ae===0){break e}te[re++]=i.length;ae--;i.mode=U;break;case Q:if(i.wrap){while(le<32){if(oe===0){break e}oe--;se|=ee[ie++]<<le;le+=8}ce-=ae;e.total_out+=ce;i.total+=ce;if(ce){e.adler=i.check=i.flags?o(i.check,te,ce,re-ce):n(i.check,te,ce,re-ce)}ce=ae;if((i.flags?se:ne(se))!==i.check){e.msg="incorrect data check";i.mode=X;break}se=0;le=0}i.mode=K;case K:if(i.wrap&&i.flags){while(le<32){if(oe===0){break e}oe--;se+=ee[ie++]<<le;le+=8}if(se!==(i.total&4294967295)){e.msg="incorrect length check";i.mode=X;break}se=0;le=0}i.mode=Y;case Y:Te=g;break e;case X:Te=y;break e;case J:return b;case Z:default:return v}}e.next_out=re;e.avail_out=ae;e.next_in=ie;e.avail_in=oe;i.hold=se;i.bits=le;if(i.wsize||ce!==e.avail_out&&i.mode<X&&(i.mode<Q||t!==d)){if(ge(e,e.output,e.next_out,ce-e.avail_out)){i.mode=J;return b}}ue-=e.avail_in;ce-=e.avail_out;e.total_in+=ue;e.total_out+=ce;i.total+=ce;if(i.wrap&&ce){e.adler=i.check=i.flags?o(i.check,te,ce,e.next_out-ce):n(i.check,te,ce,e.next_out-ce)}e.data_type=i.bits+(i.last?64:0)+(i.mode===R?128:0)+(i.mode===H||i.mode===k?256:0);if((ue===0&&ce===0||t===d)&&Te===h){Te=w}return Te}function ve(e){if(!e||!e.state){return v}var t=e.state;if(t.window){t.window=null}e.state=null;return h}function ye(e,t){var i;if(!e||!e.state){return v}i=e.state;if((i.wrap&2)===0){return v}i.head=t;t.done=false;return h}function be(e,t){var i=t.length;var r;var o;var a;if(!e||!e.state){return v}r=e.state;if(r.wrap!==0&&r.mode!==N){return v}if(r.mode===N){o=1;o=n(o,t,i,0);if(o!==r.check){return y}}a=ge(e,t,i,i);if(a){r.mode=J;return b}r.havedict=1;return h}i.inflateReset=se;i.inflateReset2=le;i.inflateResetKeep=ae;i.inflateInit=ce;i.inflateInit2=ue;i.inflate=me;i.inflateEnd=ve;i.inflateGetHeader=ye;i.inflateSetDictionary=be;i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":75,"./adler32":77,"./crc32":79,"./inffast":82,"./inftrees":84}],84:[function(e,t,i){"use strict";var r=e("../utils/common");var n=15;var o=852;var a=592;var s=0;var l=1;var u=2;var c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var p=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function e(t,i,h,g,m,v,y,b){var w=b.bits;var C=0;var E=0;var S=0,T=0;var x=0;var _=0;var M=0;var A=0;var I=0;var O=0;var D;var N;var R;var P;var L;var k=null;var $=0;var F;var V=new r.Buf16(n+1);var q=new r.Buf16(n+1);var H=null;var U=0;var B,z,j;for(C=0;C<=n;C++){V[C]=0}for(E=0;E<g;E++){V[i[h+E]]++}x=w;for(T=n;T>=1;T--){if(V[T]!==0){break}}if(x>T){x=T}if(T===0){m[v++]=1<<24|64<<16|0;m[v++]=1<<24|64<<16|0;b.bits=1;return 0}for(S=1;S<T;S++){if(V[S]!==0){break}}if(x<S){x=S}A=1;for(C=1;C<=n;C++){A<<=1;A-=V[C];if(A<0){return-1}}if(A>0&&(t===s||T!==1)){return-1}q[1]=0;for(C=1;C<n;C++){q[C+1]=q[C]+V[C]}for(E=0;E<g;E++){if(i[h+E]!==0){y[q[i[h+E]]++]=E}}if(t===s){k=H=y;F=19}else if(t===l){k=c;$-=257;H=d;U-=257;F=256}else{k=p;H=f;F=-1}O=0;E=0;C=S;L=v;_=x;M=0;R=-1;I=1<<x;P=I-1;if(t===l&&I>o||t===u&&I>a){return 1}var G=0;for(;;){G++;B=C-M;if(y[E]<F){z=0;j=y[E]}else if(y[E]>F){z=H[U+y[E]];j=k[$+y[E]]}else{z=32+64;j=0}D=1<<C-M;N=1<<_;S=N;do{N-=D;m[L+(O>>M)+N]=B<<24|z<<16|j|0}while(N!==0);D=1<<C-1;while(O&D){D>>=1}if(D!==0){O&=D-1;O+=D}else{O=0}E++;if(--V[C]===0){if(C===T){break}C=i[h+y[E]]}if(C>x&&(O&P)!==R){if(M===0){M=x}L+=S;_=C-M;A=1<<_;while(_+M<T){A-=V[_+M];if(A<=0){break}_++;A<<=1}I+=1<<_;if(t===l&&I>o||t===u&&I>a){return 1}R=O&P;m[R]=x<<24|_<<16|L-v|0}}if(O!==0){m[L+O]=C-M<<24|64<<16|0}b.bits=x;return 0}},{"../utils/common":75}],85:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],86:[function(e,t,i){"use strict";var r=e("../utils/common");var n=4;var o=0;var a=1;var s=2;function l(e){var t=e.length;while(--t>=0){e[t]=0}}var u=0;var c=1;var d=2;var p=3;var f=258;var h=29;var g=256;var m=g+1+h;var v=30;var y=19;var b=2*m+1;var w=15;var C=16;var E=7;var S=256;var T=16;var x=17;var _=18;var M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var D=512;var N=new Array((m+2)*2);l(N);var R=new Array(v*2);l(R);var P=new Array(D);l(P);var L=new Array(f-p+1);l(L);var k=new Array(h);l(k);var $=new Array(v);l($);function F(e,t,i,r,n){this.static_tree=e;this.extra_bits=t;this.extra_base=i;this.elems=r;this.max_length=n;this.has_stree=e&&e.length}var V;var q;var H;function U(e,t){this.dyn_tree=e;this.max_code=0;this.stat_desc=t}function B(e){return e<256?P[e]:P[256+(e>>>7)]}function z(e,t){e.pending_buf[e.pending++]=t&255;e.pending_buf[e.pending++]=t>>>8&255}function j(e,t,i){if(e.bi_valid>C-i){e.bi_buf|=t<<e.bi_valid&65535;z(e,e.bi_buf);e.bi_buf=t>>C-e.bi_valid;e.bi_valid+=i-C}else{e.bi_buf|=t<<e.bi_valid&65535;e.bi_valid+=i}}function G(e,t,i){j(e,i[t*2],i[t*2+1])}function W(e,t){var i=0;do{i|=e&1;e>>>=1;i<<=1}while(--t>0);return i>>>1}function Q(e){if(e.bi_valid===16){z(e,e.bi_buf);e.bi_buf=0;e.bi_valid=0}else if(e.bi_valid>=8){e.pending_buf[e.pending++]=e.bi_buf&255;e.bi_buf>>=8;e.bi_valid-=8}}function K(e,t){var i=t.dyn_tree;var r=t.max_code;var n=t.stat_desc.static_tree;var o=t.stat_desc.has_stree;var a=t.stat_desc.extra_bits;var s=t.stat_desc.extra_base;var l=t.stat_desc.max_length;var u;var c,d;var p;var f;var h;var g=0;for(p=0;p<=w;p++){e.bl_count[p]=0}i[e.heap[e.heap_max]*2+1]=0;for(u=e.heap_max+1;u<b;u++){c=e.heap[u];p=i[i[c*2+1]*2+1]+1;if(p>l){p=l;g++}i[c*2+1]=p;if(c>r){continue}e.bl_count[p]++;f=0;if(c>=s){f=a[c-s]}h=i[c*2];e.opt_len+=h*(p+f);if(o){e.static_len+=h*(n[c*2+1]+f)}}if(g===0){return}do{p=l-1;while(e.bl_count[p]===0){p--}e.bl_count[p]--;e.bl_count[p+1]+=2;e.bl_count[l]--;g-=2}while(g>0);for(p=l;p!==0;p--){c=e.bl_count[p];while(c!==0){d=e.heap[--u];if(d>r){continue}if(i[d*2+1]!==p){e.opt_len+=(p-i[d*2+1])*i[d*2];i[d*2+1]=p}c--}}}function Y(e,t,i){var r=new Array(w+1);var n=0;var o;var a;for(o=1;o<=w;o++){r[o]=n=n+i[o-1]<<1}for(a=0;a<=t;a++){var s=e[a*2+1];if(s===0){continue}e[a*2]=W(r[s]++,s)}}function X(){var e;var t;var i;var r;var n;var o=new Array(w+1);i=0;for(r=0;r<h-1;r++){k[r]=i;for(e=0;e<1<<M[r];e++){L[i++]=r}}L[i-1]=r;n=0;for(r=0;r<16;r++){$[r]=n;for(e=0;e<1<<A[r];e++){P[n++]=r}}n>>=7;for(;r<v;r++){$[r]=n<<7;for(e=0;e<1<<A[r]-7;e++){P[256+n++]=r}}for(t=0;t<=w;t++){o[t]=0}e=0;while(e<=143){N[e*2+1]=8;e++;o[8]++}while(e<=255){N[e*2+1]=9;e++;o[9]++}while(e<=279){N[e*2+1]=7;e++;o[7]++}while(e<=287){N[e*2+1]=8;e++;o[8]++}Y(N,m+1,o);for(e=0;e<v;e++){R[e*2+1]=5;R[e*2]=W(e,5)}V=new F(N,M,g+1,m,w);q=new F(R,A,0,v,w);H=new F(new Array(0),I,0,y,E)}function J(e){var t;for(t=0;t<m;t++){e.dyn_ltree[t*2]=0}for(t=0;t<v;t++){e.dyn_dtree[t*2]=0}for(t=0;t<y;t++){e.bl_tree[t*2]=0}e.dyn_ltree[S*2]=1;e.opt_len=e.static_len=0;e.last_lit=e.matches=0}function Z(e){if(e.bi_valid>8){z(e,e.bi_buf)}else if(e.bi_valid>0){e.pending_buf[e.pending++]=e.bi_buf}e.bi_buf=0;e.bi_valid=0}function ee(e,t,i,n){Z(e);if(n){z(e,i);z(e,~i)}r.arraySet(e.pending_buf,e.window,t,i,e.pending);e.pending+=i}function te(e,t,i,r){var n=t*2;var o=i*2;return e[n]<e[o]||e[n]===e[o]&&r[t]<=r[i]}function ie(e,t,i){var r=e.heap[i];var n=i<<1;while(n<=e.heap_len){if(n<e.heap_len&&te(t,e.heap[n+1],e.heap[n],e.depth)){n++}if(te(t,r,e.heap[n],e.depth)){break}e.heap[i]=e.heap[n];i=n;n<<=1}e.heap[i]=r}function re(e,t,i){var r;var n;var o=0;var a;var s;if(e.last_lit!==0){do{r=e.pending_buf[e.d_buf+o*2]<<8|e.pending_buf[e.d_buf+o*2+1];n=e.pending_buf[e.l_buf+o];o++;if(r===0){G(e,n,t)}else{a=L[n];G(e,a+g+1,t);s=M[a];if(s!==0){n-=k[a];j(e,n,s)}r--;a=B(r);G(e,a,i);s=A[a];if(s!==0){r-=$[a];j(e,r,s)}}}while(o<e.last_lit)}G(e,S,t)}function ne(e,t){var i=t.dyn_tree;var r=t.stat_desc.static_tree;var n=t.stat_desc.has_stree;var o=t.stat_desc.elems;var a,s;var l=-1;var u;e.heap_len=0;e.heap_max=b;for(a=0;a<o;a++){if(i[a*2]!==0){e.heap[++e.heap_len]=l=a;e.depth[a]=0}else{i[a*2+1]=0}}while(e.heap_len<2){u=e.heap[++e.heap_len]=l<2?++l:0;i[u*2]=1;e.depth[u]=0;e.opt_len--;if(n){e.static_len-=r[u*2+1]}}t.max_code=l;for(a=e.heap_len>>1;a>=1;a--){ie(e,i,a)}u=o;do{a=e.heap[1];e.heap[1]=e.heap[e.heap_len--];ie(e,i,1);s=e.heap[1];e.heap[--e.heap_max]=a;e.heap[--e.heap_max]=s;i[u*2]=i[a*2]+i[s*2];e.depth[u]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1;i[a*2+1]=i[s*2+1]=u;e.heap[1]=u++;ie(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1];K(e,t);Y(i,l,e.bl_count)}function oe(e,t,i){var r;var n=-1;var o;var a=t[0*2+1];var s=0;var l=7;var u=4;if(a===0){l=138;u=3}t[(i+1)*2+1]=65535;for(r=0;r<=i;r++){o=a;a=t[(r+1)*2+1];if(++s<l&&o===a){continue}else if(s<u){e.bl_tree[o*2]+=s}else if(o!==0){if(o!==n){e.bl_tree[o*2]++}e.bl_tree[T*2]++}else if(s<=10){e.bl_tree[x*2]++}else{e.bl_tree[_*2]++}s=0;n=o;if(a===0){l=138;u=3}else if(o===a){l=6;u=3}else{l=7;u=4}}}function ae(e,t,i){var r;var n=-1;var o;var a=t[0*2+1];var s=0;var l=7;var u=4;if(a===0){l=138;u=3}for(r=0;r<=i;r++){o=a;a=t[(r+1)*2+1];if(++s<l&&o===a){continue}else if(s<u){do{G(e,o,e.bl_tree)}while(--s!==0)}else if(o!==0){if(o!==n){G(e,o,e.bl_tree);s--}G(e,T,e.bl_tree);j(e,s-3,2)}else if(s<=10){G(e,x,e.bl_tree);j(e,s-3,3)}else{G(e,_,e.bl_tree);j(e,s-11,7)}s=0;n=o;if(a===0){l=138;u=3}else if(o===a){l=6;u=3}else{l=7;u=4}}}function se(e){var t;oe(e,e.dyn_ltree,e.l_desc.max_code);oe(e,e.dyn_dtree,e.d_desc.max_code);ne(e,e.bl_desc);for(t=y-1;t>=3;t--){if(e.bl_tree[O[t]*2+1]!==0){break}}e.opt_len+=3*(t+1)+5+5+4;return t}function le(e,t,i,r){var n;j(e,t-257,5);j(e,i-1,5);j(e,r-4,4);for(n=0;n<r;n++){j(e,e.bl_tree[O[n]*2+1],3)}ae(e,e.dyn_ltree,t-1);ae(e,e.dyn_dtree,i-1)}function ue(e){var t=4093624447;var i;for(i=0;i<=31;i++,t>>>=1){if(t&1&&e.dyn_ltree[i*2]!==0){return o}}if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0){return a}for(i=32;i<g;i++){if(e.dyn_ltree[i*2]!==0){return a}}return o}var ce=false;function de(e){if(!ce){X();ce=true}e.l_desc=new U(e.dyn_ltree,V);e.d_desc=new U(e.dyn_dtree,q);e.bl_desc=new U(e.bl_tree,H);e.bi_buf=0;e.bi_valid=0;J(e)}function pe(e,t,i,r){j(e,(u<<1)+(r?1:0),3);ee(e,t,i,true)}function fe(e){j(e,c<<1,3);G(e,S,N);Q(e)}function he(e,t,i,r){var o,a;var l=0;if(e.level>0){if(e.strm.data_type===s){e.strm.data_type=ue(e)}ne(e,e.l_desc);ne(e,e.d_desc);l=se(e);o=e.opt_len+3+7>>>3;a=e.static_len+3+7>>>3;if(a<=o){o=a}}else{o=a=i+5}if(i+4<=o&&t!==-1){pe(e,t,i,r)}else if(e.strategy===n||a===o){j(e,(c<<1)+(r?1:0),3);re(e,N,R)}else{j(e,(d<<1)+(r?1:0),3);le(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1);re(e,e.dyn_ltree,e.dyn_dtree)}J(e);if(r){Z(e)}}function ge(e,t,i){e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255;e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255;e.pending_buf[e.l_buf+e.last_lit]=i&255;e.last_lit++;if(t===0){e.dyn_ltree[i*2]++}else{e.matches++;t--;e.dyn_ltree[(L[i]+g+1)*2]++;e.dyn_dtree[B(t)*2]++}return e.last_lit===e.lit_bufsize-1}i._tr_init=de;i._tr_stored_block=pe;i._tr_flush_block=he;i._tr_tally=ge;i._tr_align=fe},{"../utils/common":75}],87:[function(e,t,i){"use strict";function r(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}t.exports=r},{}],88:[function(e,t,i){"use strict";t.exports={Pivot:e("./src/pivot"),DataProvider:e("./src/dataprovider"),Constants:e("./src/constants")}},{"./src/constants":102,"./src/dataprovider":103,"./src/pivot":136}],89:[function(e,t,i){"use strict";var r=e("./lib/oop");var n=e("./lib/event_emitter").EventEmitter;var o=i.Anchor=function(e,t,i){this.document=e;if(typeof i=="undefined")this.setPosition(t.row,t.column);else this.setPosition(t,i);this.$onChange=this.onChange.bind(this);e.on("change",this.$onChange)};(function(){r.implement(this,n);this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)};this.getDocument=function(){return this.document};this.onChange=function(e){var t=e.data;var i=t.range;if(i.start.row==i.end.row&&i.start.row!=this.row)return;if(i.start.row>this.row)return;if(i.start.row==this.row&&i.start.column>this.column)return;var r=this.row;var n=this.column;var o=i.start;var a=i.end;if(t.action==="insertText"){if(o.row===r&&o.column<=n){if(o.row===a.row){n+=a.column-o.column}else{n-=o.column;r+=a.row-o.row}}else if(o.row!==a.row&&o.row<r){r+=a.row-o.row}}else if(t.action==="insertLines"){if(o.row<=r){r+=a.row-o.row}}else if(t.action==="removeText"){if(o.row===r&&o.column<n){if(a.column>=n)n=o.column;else n=Math.max(0,n-(a.column-o.column))}else if(o.row!==a.row&&o.row<r){if(a.row===r)n=Math.max(0,n-a.column)+o.column;r-=a.row-o.row}else if(a.row===r){r-=a.row-o.row;n=Math.max(0,n-a.column)+o.column}}else if(t.action=="removeLines"){if(o.row<=r){if(a.row<=r)r-=a.row-o.row;else{r=o.row;n=0}}}this.setPosition(r,n,true)};this.setPosition=function(e,t,i){var r;if(i){r={row:e,column:t}}else{r=this.$clipPositionToDocument(e,t)}if(this.row==r.row&&this.column==r.column)return;var n={row:this.row,column:this.column};this.row=r.row;this.column=r.column;this._emit("change",{old:n,value:r})};this.detach=function(){this.document.removeEventListener("change",this.$onChange)};this.$clipPositionToDocument=function(e,t){var i={};if(e>=this.document.getLength()){i.row=Math.max(0,this.document.getLength()-1);i.column=Math.min(t,this.document.getLine(i.row).length)}else if(e<0){i.row=0;i.column=0}else{i.row=e;i.column=Math.min(this.document.getLine(i.row).length,Math.max(0,t))}if(t<0)i.column=0;return i}}).call(o.prototype)},{"./lib/event_emitter":120,"./lib/oop":124}],90:[function(e,t,i){"use strict";var r=e("./lib/event_emitter").EventEmitter;var n=e("./lib/oop");var o=e("escape-html");var a=e("lodash");var s=e("./cell_type_util");var l=e("./lib/dropdown");var u=e("assert");var c=e("./cell_renderer");var d=e("./cell_editor");var p=e("./utils");var f=function(){};n.inherits(f,c);f.prototype.shouldTriggerTooltip=function(e){var t=e.classList.contains("pivot_cell")?e:e.parentElement,i=t.getElementsByClassName("pt-dropdown-display")[0],r=i&&i.scrollWidth-i.clientWidth;return r>1};f.prototype.renderContent=function(e){var t=e.data.value.value,i=t&&p.getSingleValue(t.formattedValue),r;if(!a.isUndefined(i))r=i?"True":"False";var n=!e.showSpinner&&(a.isNumber(r)||a.isString(r))&&o(r)||"";return l.renderStaticView(n)};f.prototype.renderCell=function(e,t){var i=a.property("data.filtered.value")(e),r="'width: "+e.width+"px;padding:0px;height: "+e.height+"px; "+p.JSONObjectToStyleAttribute(e.cellStyle)+"'";return"<span style="+r+" class='noselect pivot_cell data_cell "+(e.data.filtered&&!p.getSingleValue(i&&i.rawValue)?"filtered_cell ":"")+(e.isEdited?"edit ":e.isTotal?"total ":"")+(e.isSaving?"saving ":"")+(e.isSaved?"saved ":"")+(e.isUpdated?"updated ":"")+(e.isReadOnly?"readonly ":e.isProtected?"protected ":"editable ")+(e.isLocked?"locked ":"")+s.alignToStyle(e.hAlign,false)+" "+s.alignToStyle(e.vAlign,true)+" "+(e.showSpinner?"spinner ":"")+"' "+"data-row ='"+e.row+"' "+"data-col ='"+e.col+"' "+"data-type ='"+e.type+"' "+">"+t(e)+"</span>"};f.prototype.shouldTriggerAlwaysEditing=function(e){var t=e.classList;return t.contains("pt-dropdown-toggle-arrow")||t.contains("pt-dropdown-toggle-arrow-cover")};var h=function(e){var t=this;this.alwaysEditing=true;this.container=e;this.dropdown=new l({onClose:this.cancelEdit.bind(this),onChange:function(e,i){if(i){t.confirmEdit(i)}else{t.confirmEdit()}}},this.container);this.element=this.dropdown.asHTMLElement();this.containerElement=document.createElement("div");this.containerElement.className="editable-container";this.containerElement.appendChild(this.element);this.container.appendChild(this.containerElement);this.hide()};n.inherits(h,d);n.implement(h.prototype,r);h.prototype.setDataProvider=function(e){this.provider=e};h.prototype.initialize=function(e,t,i){var r;if(a.isObject(e)){r=a.property("data.value.value.formattedValue")(e);if(!a.isUndefined(r)){e=p.getSingleValue(r)}}this.dropdown.open(i==="space");if(i&&i!=="space"){this.dropdown.search(i)}};h.prototype.focus=function(){this.dropdown.focus();document.addEventListener("mouseup",this.blur.bind(this))};h.prototype.blur=function(){document.removeEventListener("mouseup",this.blur.bind(this));this.element.blur()};h.prototype.hide=function(){this.containerElement.style.display="none";this.$editing=false};h.prototype.show=function(){this.containerElement.style.display="block"};h.prototype.renderOver=function(e){var t=e.getBoundingClientRect(),i=this.containerElement.parentNode.getBoundingClientRect(),r=window.getComputedStyle(this.containerElement),n=s.parseResolvedValue(r.marginTop),o=s.parseResolvedValue(r.marginLeft),l=e.getAttribute("data-row"),u=e.getAttribute("data-col"),c=this.provider.getCellData({Y:l,X:u}),d,f,h,g="",m="",v=[{id:"true",label:"True"},{id:"false",label:"False"},{id:"blank",label:"Â "}];if(c){d=c.data.value.edit;f=c.data.value.value;h=p.getSingleValue(f);if(!a.isUndefined(h)){g=h?"true":"false";m=h?"True":"False"}}this.element.style.width="100%";this.element.style.height="100%";this.dropdown.update({id:g,label:m},v);this.containerElement.style.padding="0";this.containerElement.style.top=t.top-i.top-n-1+"px";this.containerElement.style.left=t.left-i.left-o-1+"px";this.containerElement.style.width=t.width+"px";this.containerElement.style.height=t.height+"px";this.containerElement.style.position="absolute";this.containerElement.style.display="block";this.$editing=true;this.$cellCoords={Y:l,X:u}};h.prototype.getValue=function(){var e=this.dropdown.getValue();if(e==="blank")return undefined;return e==="true"?true:false};h.prototype.convertData=function(e){return e};h.prototype.confirmEdit=function(e){var t=this.getValue();if(this.$editing){if(!a.isUndefined(t)){this._emit("confirm-edit",{value:t,keyEvent:e})}else{this.cancelEdit();this.provider.deleteCells([this.$cellCoords])}this.$editing=false}};h.prototype.cancelEdit=function(){if(this.$editing){this._emit("cancel-edit",{value:this.getValue()});this.$editing=false}};i.mkBooleanDropdownRenderer=function(){return new f};i.mkBooleanDropdownEditor=function(e){return new h(e.container)};i.$BooleanDropdownRenderer=f;i.$BooleanDropdownEditor=h},{"./cell_editor":91,"./cell_renderer":92,"./cell_type_util":96,"./lib/dropdown":118,"./lib/event_emitter":120,"./lib/oop":124,"./utils":143,assert:2,"escape-html":"escape-html",lodash:70}],91:[function(e,t,i){"use strict";function r(){}r.prototype.hide=function(){};r.prototype.show=function(){};r.prototype.renderOver=function(e){};r.prototype.initialize=function(e,t,i){};r.prototype.convertData=function(e){};r.prototype.focus=function(){};r.prototype.blur=function(){};r.prototype.validateData=function(e){};r.prototype.setDataProvider=function(e){this.provider=e};r.prototype.destroy=function(){};r.prototype.on=function(e,t){};r.prototype.off=function(e,t){};r.prototype.removeAllListeners=function(e){};t.exports=r},{}],92:[function(e,t,i){"use strict";var r=e("lodash");var n=e("./cell_type_util");var o=e("./utils");var a=e("escape-html");var s=e("./lib/dom");function l(){}l.prototype.renderContent=function(e){var t=o.getSingleValue(e.formattedData);return!e.showSpinner&&!r.isUndefined(t)?a(t):" "};l.prototype.renderClipboardContent=function(e){var t=o.getSingleValue(e.formattedData);return!e.showSpinner&&!r.isUndefined(t)?a(t):" "};l.prototype.renderCell=function(e,t){var i="'width: "+e.width+"px;height: "+e.height+"px; "+(e.showSpinner?"":o.JSONObjectToStyleAttribute(e.cellStyle))+"'";return"<span style="+i+" class='noselect pivot_cell data_cell "+(e.invalid?"invalid_cell ":"")+(e.isFiltered?"filtered_cell ":"")+(e.isEdited?"edit ":e.isRollup?"total ":"")+(e.isSaving?"saving ":"")+(e.isSaved?"saved ":"")+(e.isUpdated&&r.isEmpty(e.cellStyle)?"updated ":"")+(e.isReadOnly?"readonly ":e.isProtected?"protected ":"editable ")+(e.isLocked?"locked ":"")+n.alignToStyle(e.hAlign,false)+" "+n.alignToStyle(e.vAlign,true)+" "+(e.showSpinner?"spinner ":"")+(r.isArray(e.additionalClasses)?e.additionalClasses.join(" "):"")+"' "+"data-row ='"+e.row+"' "+"data-col ='"+e.col+"' "+"data-type ='"+e.type+"' "+(e.isProtected&&!e.isReadOnly?"title='This cell is protected.'":"")+">"+t(e)+"</span>"};l.prototype.shouldTriggerAlwaysEditing=function(e){return false};l.prototype.shouldTriggerTooltip=function(e){return s.hasCssClass(e,"invalid_cell")};t.exports=l},{"./cell_type_util":96,"./lib/dom":117,"./utils":143,"escape-html":"escape-html",lodash:70}],93:[function(e,t,i){"use strict";function r(){}r.prototype.hide=function(){};r.prototype.show=function(){};r.prototype.render=function(e,t,i){};r.prototype.initialize=function(e,t){};r.prototype.setDataPovider=function(e){};t.exports=r},{}],94:[function(e,t,i){"use strict";var r=e("./cell_type_registry").CellTypeRegistry;var n=e("assert");var o=function(e){this.$container=e;this.$editableControls={};this.$renderers={};this.$controlFunctions={};this.$cellFunctions={};this.$tooltips={};this.$provider=null};o.prototype.$checkAvailableType=function(e){if(!r.isAvailableType(e)){throw new Error("Unknown cell type: "+e)}};o.prototype.getEditor=function(e){var t;if(!this.$editableControls[e]){this.$checkAvailableType(e);t=r.makeEditorForType(e,{container:this.$container});if(this.$provider){t.setDataProvider(this.$provider)}this.$editableControls[e]=t}return this.$editableControls[e]};o.prototype.hasEditor=function(e){if(!this.$editableControls[e]){this.$checkAvailableType(e);return r.hasEditorForType(e)}return true};o.prototype.destroyEditors=function(){for(editor in this.$editableControls){editor.destroy()}};o.prototype.getRenderer=function(e){this.$checkAvailableType(e);if(!this.$renderers[e]){this.$renderers[e]=r.makeRendererForType(e)}return this.$renderers[e]};o.prototype.getTooltip=function(e){var t;if(!this.$tooltips[e]){this.$checkAvailableType(e);t=r.makeTooltipForType(e,{container:this.$container});if(this.$provider){t.setDataProvider(this.$provider)}this.$tooltips[e]=t}return this.$tooltips[e]};o.prototype.getContentRenderFn=function(e){var t=this.getRenderer(e).renderContent;n(t instanceof Function,"Unable to find renderContent function for type: "+e);return t};o.prototype.getClipboardContentRenderFn=function(e){var t=this.getRenderer(e).renderClipboardContent;n(t instanceof Function,"Unable to find renderClipboardContent function for type: "+e);return t};o.prototype.getCellRenderFn=function(e){var t=this.getRenderer(e).renderCell||this.getCellRenderFn("text");n(t instanceof Function,"Unable to find renderCell function for type: "+e);return t};o.prototype.setDataProvider=function(e){var t=this.$editableControls;Object.keys(t).forEach(function(i){var r=t[i];if(r){r.setDataProvider(e)}});this.$provider=e};i.CellTypeManager=o},{"./cell_type_registry":95,assert:2}],95:[function(e,t,i){"use strict";var r=e("lodash");var n={text:{rendererFactory:e("./text_cell_control").mkTextCellRenderer,editorFactory:e("./text_cell_control").mkTextCellEditor,tooltipFactory:e("./clipped_cell_tooltip").mkClippedCellTooltip},"wrapped-text":{rendererFactory:e("./wrapped_text_cell_control").mkWrappedTextCellRenderer,editorFactory:e("./wrapped_text_cell_control").mkWrappedTextCellEditor,tooltipFactory:e("./clipped_cell_tooltip").mkClippedCellTooltip},checkbox:{rendererFactory:e("./checkbox_cell_control").mkCheckboxRenderer,editorFactory:e("./checkbox_cell_control").mkCheckboxEditor,tooltipFactory:e("./clipped_cell_tooltip").mkClippedCellTooltip},dropdown:{rendererFactory:e("./dropdown_cell_control").mkDropdownRenderer,editorFactory:e("./dropdown_cell_control").mkDropdownEditor,tooltipFactory:e("./clipped_cell_tooltip").mkClippedCellTooltip},booleandropdown:{rendererFactory:e("./boolean_dropdown_cell_control").mkBooleanDropdownRenderer,editorFactory:e("./boolean_dropdown_cell_control").mkBooleanDropdownEditor,tooltipFactory:e("./clipped_cell_tooltip").mkClippedCellTooltip},link:{rendererFactory:e("./link_cell_control").mkLinkCellRenderer,editorFactory:e("./link_cell_control").mkLinkCellEditor,tooltipFactory:e("./clipped_cell_tooltip").mkClippedCellTooltip},mouseover:{rendererFactory:e("./mouseover_cell_control").mkMouseoverCellRenderer,editorFactory:e("./mouseover_cell_control").mkMouseoverCellEditor,tooltipFactory:e("./mouseover_cell_control").mkMouseoverTooltip},image:{rendererFactory:e("./image_cell_control").mkImageCellRenderer,editorFactory:e("./image_cell_control").mkImageCellEditor,tooltipFactory:e("./clipped_cell_tooltip").mkClippedCellTooltip},percentage:{rendererFactory:e("./percentage_cell_control").mkPercentageCellRenderer,editorFactory:e("./percentage_cell_control").mkPercentageCellEditor,tooltipFactory:e("./clipped_cell_tooltip").mkClippedCellTooltip}};var o=Object.keys(n).reduce(function(e,t){e[r.toUpper(t)]=t;return e},{});var a=function(){var e=this;this.$cellTypes={};this.$builtinTypes=r.clone(n);Object.keys(this.$builtinTypes).forEach(function(t){var i=e.$builtinTypes[t];e.register(t,i.rendererFactory,i.editorFactory,i.tooltipFactory)})};a.prototype.isAvailableType=function(e){return Object.keys(this.$cellTypes).indexOf(e)>-1};a.prototype.$assertAvailableType=function(e){if(!this.isAvailableType(e))throw new Error("Cell Type '"+e+"' is not registered!")};a.prototype.makeRendererForType=function(e){this.$assertAvailableType(e);return this.$cellTypes[e].rendererFactory()};a.prototype.hasEditorForType=function(e){this.$assertAvailableType(e);var t=this.$cellTypes[e];return!r.isUndefined(t&&t.editorFactory)};a.prototype.makeEditorForType=function(e,t){this.$assertAvailableType(e);return this.$cellTypes[e].editorFactory(t)};a.prototype.makeTooltipForType=function(e,t){this.$assertAvailableType(e);return this.$cellTypes[e].tooltipFactory(t)};a.prototype.register=function(e,t,i,r){if(this.isAvailableType(e)){throw new Error("Cell Type '"+e+"' is already registered!")}this.$cellTypes[e]={rendererFactory:t,editorFactory:i,tooltipFactory:r}};a.prototype.unregister=function(e){this.$assertAvailableType(e);delete this.$cellTypes[e]};i.CellTypeRegistry=new a;i.DisplayTypes=o},{"./boolean_dropdown_cell_control":90,"./checkbox_cell_control":97,"./clipped_cell_tooltip":98,"./dropdown_cell_control":104,"./image_cell_control":105,"./link_cell_control":127,"./mouseover_cell_control":134,"./percentage_cell_control":135,"./text_cell_control":142,"./wrapped_text_cell_control":145,lodash:70}],96:[function(e,t,i){"use strict";var r=e("lodash");var n=function(e,t){var i=t?"valign-":"align-";if(e.indexOf(i)===0)return e;else return i+e};var o=function(e){var t=e.length;if(!isNaN(parseFloat(e))){return parseFloat(e)}if(r.isString(e)&&e.match(/px/gi).length>0){return parseFloat(e.replace(/px/gi,""))}};i.alignToStyle=n;i.parseResolvedValue=o},{lodash:70}],97:[function(e,t,i){"use strict";var r=e("./lib/event_emitter").EventEmitter;var n=e("./lib/oop");var o=e("assert");var a=e("lodash");var s=e("./cell_type_util");var l=e("./cell_renderer");var u=e("./cell_editor");var c=e("./lib/event");var d=e("./utils");var p=function(){};n.inherits(p,l);p.prototype.renderContent=function(e){var t=e.isReadOnly||e.isProtected;var i=d.getSingleValue(e.formattedData);if(a.isUndefined(i)){i=false}return!e.showSpinner?"<input class='display-checkbox' type='checkbox'"+(i?" checked":"")+(t?" disabled":"")+"/>":" "};p.prototype.shouldTriggerAlwaysEditing=function(e){return e.classList.contains("display-checkbox")};var f=function(e){var t=this;this.alwaysEditing=true;this.container=e;this.element=document.createElement("input");this.element.className="pivot_editable_cell checkbox_cell";this.element.type="checkbox";this.containerElement=document.createElement("div");this.containerElement.className="editable-container";this.containerElement.appendChild(this.element);this.container.appendChild(this.containerElement);this.hide();this.element.addEventListener("blur",function(){t.cancelEdit()});this.element.addEventListener("change",function(){t.confirmEdit({keyCode:13})});c.addCommandKeyListener(this.element,function(e){if(e.keyCode===13||e.keyCode===9){t.confirmEdit(e)}else if(e.keyCode===27){t.cancelEdit()}})};n.inherits(f,u);n.implement(f.prototype,r);f.prototype.initialize=function(e,t,i){var r,n;if(a.isObject(e)){n=e.data.value;r=n&&n.value&&d.getSingleValue(n.value.formattedValue)}if(a.isUndefined(r)){r=false}var s=t.childNodes[0];o(a.isBoolean(r),"Checkbox can only be initialized with a boolean value, but was passed "+r+" of type: "+typeof r);this.element.checked=r;if(i==="space"||!i){if(s.classList.contains("display-checkbox")){this.element.click()}}else{this.cancelEdit()}};f.prototype.focus=function(){this.element.focus()};f.prototype.blur=function(){this.element.blur()};f.prototype.hide=function(){this.containerElement.style.display="none";this.$editing=false};f.prototype.show=function(){this.containerElement.style.display="block"};f.prototype.renderOver=function(e){var t=e.getBoundingClientRect(),i=this.containerElement.parentNode.getBoundingClientRect(),r=window.getComputedStyle(this.containerElement),n=s.parseResolvedValue(r.marginTop),o=s.parseResolvedValue(r.marginLeft),a=this;this.containerElement.style.top=t.top-i.top-n-1+"px";this.containerElement.style.left=t.left-i.left-o-7+"px";this.containerElement.style.width=t.width+"px";this.containerElement.style.height=t.height+"px";this.containerElement.style.textAlign="center";this.containerElement.style.verticalAlign="center";this.containerElement.style.position="absolute";this.containerElement.style.display="block";this.containerElement.className+=Array.prototype.filter.call(e.classList,function(e){return e.indexOf("align")>-1&&Array.prototype.indexOf.call(a.containerElement.classList,e)<0}).join(" ");this.$editing=true};f.prototype.getValue=function(){return this.element.checked};f.prototype.convertData=function(e){if(e==="true")return true;else if(e==="false")return false;else return""};f.prototype.confirmEdit=function(e){if(this.$editing){this._emit("confirm-edit",{value:this.getValue(),keyEvent:e});this.$editing=false}};f.prototype.cancelEdit=function(){if(this.$editing){this._emit("cancel-edit",{value:this.getValue()});this.$editing=false}};i.mkCheckboxRenderer=function(){return new p};i.mkCheckboxEditor=function(e){return new f(e.container)};i.$CheckboxRenderer=p;i.$CheckboxEditor=f},{"./cell_editor":91,"./cell_renderer":92,"./cell_type_util":96,"./lib/event":119,"./lib/event_emitter":120,"./lib/oop":124,"./utils":143,assert:2,lodash:70}],98:[function(e,t,i){"use strict";var r=e("./lib/event_emitter").EventEmitter;var n=e("lodash");var o=e("./lib/oop");var a=e("./cell_type_util");var s=e("./cell_renderer");var l=e("./cell_tooltip");function u(e){this.container=e;this.element=document.createElement("div");this.element.className="cell-tooltip clipped-cell";this.containerElement=this.container.getElementsByClassName("tooltip-container-clipped")[0];if(!this.containerElement){this.containerElement=document.createElement("div");this.containerElement.className="tooltip-container";this.container.appendChild(this.containerElement)}this.containerElement.appendChild(this.element)}o.inherits(u,l);u.prototype.initialize=function(){};u.prototype.setDataProvider=function(e){this.provider=e};u.prototype.render=function(e,t,i){var r=e||t,n=this.$buildTooltipContent(r,i);if(n.textContent.trim().length){this.$updatePosition(r);this.$clear();this.element.appendChild(n)}else{this.$hideTooltip()}};u.prototype.$clear=function(){while(this.containerElement.firstChild){this.containerElement.removeChild(this.containerElement.firstChild);
}while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}this.containerElement.appendChild(this.element)};u.prototype.show=function(){this.containerElement.classList.add("show");this.container.addEventListener("mousewheel",this.$hideTooltip.bind(this),false);this.container.addEventListener("DOMMouseScroll",this.$hideTooltip.bind(this),false)};u.prototype.hide=function(){this.$hideTooltip()};u.prototype.$hideTooltip=function(){this.containerElement.classList.remove("show");while(this.element.firstChild){this.element.removeChild(this.element.firstChild)}};u.prototype.$updatePosition=function(e){var t=e.getBoundingClientRect(),i=this.container.getBoundingClientRect(),r=getComputedStyle(this.containerElement),n=a.parseResolvedValue(r.marginTop),o=a.parseResolvedValue(r.marginLeft),s=t.top-t.height-i.top-5-n,l=t.left+t.width/2-i.left-o-15;this.containerElement.style.top=s+"px";this.containerElement.style.left=l+"px"};u.prototype.$buildTooltipContent=function(e,t){var i=document.createElement("div"),r=document.createElement("span"),o;if(t&&this.provider&&n.isFunction(this.provider.getCellData)){o=this.provider.getCellData({X:t.col,Y:t.row});if(o.invalid){this.$addInvalidTooltipContent(r,e,o)}else{this.$addValidTooltipContent(r,e,o)}}i.className="tooltip-content";i.appendChild(r);return i};u.prototype.$addInvalidTooltipContent=function(e,t,i){if(i&&i.validityMessages&&i.validityMessages.length){i.validityMessages.forEach(function(t){var i=document.createElement("p");i.textContent=t;e.appendChild(i)})}};u.prototype.$addValidTooltipContent=function(e,t,i){var r,n,r=i&&i.value;if(r){return r.formattedValue||r.rawValue}switch(t.dataset.type){case"dropdown":n=t.getElementsByClassName("pt-dropdown-display")[0];break;default:n=t}e.textContent=n&&n.textContent};i.mkClippedCellTooltip=function(e){return new u(e.container)}},{"./cell_renderer":92,"./cell_tooltip":93,"./cell_type_util":96,"./lib/event_emitter":120,"./lib/oop":124,lodash:70}],99:[function(e,t,i){"use strict";var r=e("../lib/oop");var n=e("../keyboard/hash_handler").HashHandler;var o=e("../lib/event_emitter").EventEmitter;var a=function(e,t){this.platform=e;this.commands=this.byName={};this.commmandKeyBinding={};this.addCommands(t);this.setDefaultHandler("exec",function(e){return e.command.exec(e.editor,e.args||{})})};r.inherits(a,n);(function(){r.implement(this,o);this.exec=function(e,t,i){if(typeof e==="string")e=this.commands[e];if(!e)return false;if(t&&t.$readOnly&&!e.readOnly)return false;var r={editor:t,command:e,args:i};var n=this._emit("exec",r);this._signal("afterExec",r);return n===false?false:true};this.toggleRecording=function(e){if(this.$inReplay)return;e&&e._emit("changeStatus");if(this.recording){this.macro.pop();this.removeEventListener("exec",this.$addCommandToMacro);if(!this.macro.length)this.macro=this.oldMacro;return this.recording=false}if(!this.$addCommandToMacro){this.$addCommandToMacro=function(e){this.macro.push([e.command,e.args])}.bind(this)}this.oldMacro=this.macro;this.macro=[];this.on("exec",this.$addCommandToMacro);return this.recording=true};this.replay=function(e){if(this.$inReplay||!this.macro)return;if(this.recording)return this.toggleRecording(e);try{this.$inReplay=true;this.macro.forEach(function(t){if(typeof t=="string")this.exec(t,e);else this.exec(t[0],e,t[1])},this)}finally{this.$inReplay=false}};this.trimMacro=function(e){return e.map(function(e){if(typeof e[0]!="string")e[0]=e[0].name;if(!e[1])e=e[0];return e})}}).call(a.prototype);i.CommandManager=a},{"../keyboard/hash_handler":106,"../lib/event_emitter":120,"../lib/oop":124}],100:[function(e,t,i){"use strict";var r=e("../lib/lang");var n=e("../config");var o=e("../utils");function a(e,t){return{win:e,mac:t}}i.commands=[{name:"selectall",bindKey:a("Ctrl-A","Command-A"),exec:function(e){e.selectAll()},readOnly:true},{name:"selecttostart",bindKey:a("Ctrl-Shift-Home","Command-Shift-Up"),exec:function(e){e.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:true},{name:"gotostart",bindKey:a("Ctrl-Home","Command-Home|Command-Up"),exec:function(e){e.navigateFileStart()},multiSelectAction:"forEach",readOnly:true},{name:"selectup",bindKey:a("Shift-Up","Shift-Up"),exec:function(e){e.getSelection().selectUp()},multiSelectAction:"forEach",readOnly:true},{name:"golineup",bindKey:a("Up","Up|Ctrl-P"),exec:function(e,t){e.navigateUp(t.times)},multiSelectAction:"forEach",readOnly:true},{name:"selecttoend",bindKey:a("Ctrl-Shift-End","Command-Shift-Down"),exec:function(e){e.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:true},{name:"gotoend",bindKey:a("Ctrl-End","Command-End|Command-Down"),exec:function(e){e.navigateFileEnd()},multiSelectAction:"forEach",readOnly:true},{name:"selectdown",bindKey:a("Shift-Down","Shift-Down"),exec:function(e){e.getSelection().selectDown()},multiSelectAction:"forEach",readOnly:true},{name:"golinedown",bindKey:a("Down","Down|Ctrl-N"),exec:function(e,t){e.navigateDown(t.times)},multiSelectAction:"forEach",readOnly:true},{name:"selecttolinestart",bindKey:a("Alt-Shift-Left","Command-Shift-Left"),exec:function(e){e.getSelection().selectRowStart()},multiSelectAction:"forEach",readOnly:true},{name:"gotolinestart",bindKey:a("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(e){e.navigateRowStart()},multiSelectAction:"forEach",readOnly:true},{name:"selectleft",bindKey:a("Shift-Left","Shift-Left"),exec:function(e){e.getSelection().selectLeft()},multiSelectAction:"forEach",readOnly:true},{name:"gotoleft",bindKey:a("Left","Left|Ctrl-B"),exec:function(e,t){e.navigateLeft(t.times)},multiSelectAction:"forEach",readOnly:true},{name:"selecttolineend",bindKey:a("Alt-Shift-Right","Command-Shift-Right"),exec:function(e){e.getSelection().selectRowEnd()},multiSelectAction:"forEach",readOnly:true},{name:"gotolineend",bindKey:a("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(e){e.navigateRowEnd()},multiSelectAction:"forEach",readOnly:true},{name:"selectright",bindKey:a("Shift-Right","Shift-Right"),exec:function(e){e.getSelection().selectRight()},multiSelectAction:"forEach",readOnly:true},{name:"gotoright",bindKey:a("Right","Right|Ctrl-F"),exec:function(e,t){e.navigateRight(t.times)},multiSelectAction:"forEach",readOnly:true},{name:"gotonextcell",bindKey:a("Tab","Tab"),exec:function(e,t){e.navigateNext(t.times)},multiSelectAction:"forEach",readOnly:true},{name:"gotoprevcell",bindKey:a("Shift-Tab","Shift-Tab"),exec:function(e,t){e.navigatePrev(t.times)},multiSelectAction:"forEach",readOnly:true},{name:"selectpagedown",bindKey:"Shift-PageDown",exec:function(e){e.selectPageDown()},readOnly:true},{name:"pagedown",bindKey:a(null,"Option-PageDown"),exec:function(e){e.scrollPageDown()},readOnly:true},{name:"gotopagedown",bindKey:a("PageDown","PageDown|Ctrl-V"),exec:function(e){e.gotoPageDown()},readOnly:true},{name:"selectpageup",bindKey:"Shift-PageUp",exec:function(e){e.selectPageUp()},readOnly:true},{name:"pageup",bindKey:a(null,"Option-PageUp"),exec:function(e){e.scrollPageUp()},readOnly:true},{name:"gotopageup",bindKey:"PageUp",exec:function(e){e.gotoPageUp()},readOnly:true},{name:"scrollup",bindKey:a("Ctrl-Up",null),exec:function(e){e.renderer.scrollBy(0,-2*e.renderer.layerConfig.lineHeight)},readOnly:true},{name:"scrolldown",bindKey:a("Ctrl-Down",null),exec:function(e){e.renderer.scrollBy(0,2*e.renderer.layerConfig.lineHeight)},readOnly:true},{name:"selectlinestart",bindKey:"Shift-Home",exec:function(e){e.getSelection().selectRowStart()},multiSelectAction:"forEach",readOnly:true},{name:"selectlineend",bindKey:"Shift-End",exec:function(e){e.getSelection().selectRowEnd()},multiSelectAction:"forEach",readOnly:true},{name:"togglerecording",bindKey:a("Ctrl-Alt-E","Command-Option-E"),exec:function(e){e.commands.toggleRecording(e)},readOnly:true},{name:"replaymacro",bindKey:a("Ctrl-Shift-E","Command-Shift-E"),exec:function(e){e.commands.replay(e)},readOnly:true},{name:"commitedits",bindKey:"f9",exec:function(e){var t=e.renderer.provider;if(t.getCommitMode()==="multi"){t.commit()}},readOnly:true},{name:"reviewedits",bindKey:"Ctrl-f9",exec:function(e){e.renderer._emit("reviewedits")},readOnly:true},{name:"Enter",bindKey:a("Enter","Enter"),exec:function(e){e.onEnterKey()},readOnly:true},{name:"Shift-Enter",bindKey:"Shift-Enter",exec:function(e,t){e.navigateUp()},readOnly:true},{name:"Direct type Edit",bindKey:"Space|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|1|2|3|4|5|6|7|8|9|0|"+"Shift-A|Shift-B|Shift-C|Shift-D|Shift-E|Shift-F|Shift-G|Shift-H|Shift-I|Shift-J|Shift-K|"+"Shift-L|Shift-M|Shift-N|Shift-O|Shift-P|Shift-Q|Shift-R|Shift-S|Shift-T|Shift-U|Shift-V|Shift-W|"+"Shift-X|Shift-Y|Shift-Z|1|2|3|4|5|6|7|8|9|0|+|-|*|/|.|,|$|â¬|â¡|Â£|â¹|Â¥|â©|â¦|â±|â²|à¸¿|â´|â«|%",exec:function(e,t){e.onCellTyping(t)},readOnly:true},{name:"Clear ",bindKey:"Backspace|Del",exec:function(e,t){e.onClearValue(t)},readOnly:true},{name:"lockcells",bindKey:"Ctrl-L",exec:function(e,t){var i=e.renderer.provider,r=e.selection.getRange(),n=o.convertToMultiAxisRange(r);i.setLock(n)},readOnly:true},{name:"unlockcells",bindKey:"Ctrl-Shift-L",exec:function(e,t){var i=e.renderer.provider,r=e.selection.getRange(),n=o.convertToMultiAxisRange(r);i.unsetLock(n)},readOnly:true},{name:"Escape ",bindKey:"esc",exec:function(e){e.onEscape()},readOnly:true}]},{"../config":101,"../lib/lang":122,"../utils":143}],101:[function(e,t,i){"no use strict";var r=e("./lib/lang");var n=e("./lib/oop");var o=e("./lib/net");var a=e("./lib/event_emitter").EventEmitter;var s=function(){return this}();var l={packaged:false,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{}};i.get=function(e){if(!l.hasOwnProperty(e))throw new Error("Unknown config key: "+e);return l[e]};i.set=function(e,t){if(!l.hasOwnProperty(e))throw new Error("Unknown config key: "+e);l[e]=t};i.all=function(){return r.copyObject(l)};n.implement(i,a);i.moduleUrl=function(e,t){if(l.$moduleUrls[e])return l.$moduleUrls[e];var i=e.split("/");t=t||i[i.length-2]||"";var r=i[i.length-1].replace(t,"").replace(/(^[\-_])|([\-_]$)/,"");if(!r&&i.length>1)r=i[i.length-2];var n=l[t+"Path"];if(n==null)n=l.basePath;if(n&&n.slice(-1)!="/")n+="/";return n+t+"-"+r+this.get("suffix")};i.setModuleUrl=function(e,t){return l.$moduleUrls[e]=t};i.$loading={};function u(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}var c={setOptions:function(e){Object.keys(e).forEach(function(t){this.setOption(t,e[t])},this)},getOptions:function(e){var t={};Object.keys(e).forEach(function(e){t[e]=this.getOption(e)},this);return t},setOption:function(e,t){if(this["$"+e]===t)return;var i=this.$options[e];if(!i)return undefined;if(i.forwardTo)return this[i.forwardTo]&&this[i.forwardTo].setOption(e,t);if(!i.handlesSet)this["$"+e]=t;if(i&&i.set)i.set.call(this,t)},getOption:function(e){var t=this.$options[e];if(!t)return undefined;if(t.forwardTo)return this[t.forwardTo]&&this[t.forwardTo].getOption(e);return t&&t.get?t.get.call(this):this["$"+e]}};var d={};i.defineOptions=function(e,t,i){if(!e.$options)d[t]=e.$options={};Object.keys(i).forEach(function(t){var r=i[t];if(typeof r=="string")r={forwardTo:r};r.name||(r.name=t);e.$options[r.name]=r;if("initialValue"in r)e["$"+r.name]=r.initialValue});n.implement(e,c);return this};i.resetOptions=function(e){Object.keys(e.$options).forEach(function(t){var i=e.$options[t];if("value"in i)e.setOption(t,i.value)})};i.setDefaultValue=function(e,t,r){var n=d[e]||(d[e]={});if(n[t]){if(n.forwardTo)i.setDefaultValue(n.forwardTo,t,r);else n[t].value=r}};i.setDefaultValues=function(e,t){Object.keys(t).forEach(function(r){i.setDefaultValue(e,r,t[r])})}},{"./lib/event_emitter":120,"./lib/lang":122,"./lib/net":123,"./lib/oop":124}],102:[function(e,t,i){var r={SINGLE:"single",DEFERRED:"multi"};var n={UP:"Up",RIGHT:"Right",DOWN:"Down",LEFT:"Left"};var o={PLACEHOLDER:""};i.CommitMode=r;i.Direction=n;i.TextInput=o},{}],103:[function(e,t,i){"use strict";var r=e("./lib/event_emitter").EventEmitter;var n=e("./lib/oop");var o=e("lodash");var a=e("./constants").CommitMode;function s(){n.implement(this,r);this.headingData={isReady:false,X:[[]],Y:[[]]};this.cellData=[[]];this.$defaultSize={width:90,height:24};this.$sizing={X:[],Y:[]};this.$commitMode=a.SINGLE}s.prototype.getHeadingRange=function(e,t){var i=this.headingData[t].slice(e.start,e.start+e.length);return i};s.prototype.setHeadingData=function(e){this.headingData=e;this.headingData.isReady=true;this._emit("updateModel")};s.prototype.hasHeadingData=function(){return this.headingData.isReady};s.prototype.getHeadingInfo=function(e){var t=this.headingData[e].map(function(e,t){return{name:"column-"+t,members:{},cellSize:{}}});return{depth:this.headingData[e].length,length:this.headingData[e].length>0?this.headingData[e][0].length:0,columns:t}};s.prototype.headerCanSort=function(e,t,i){return true};s.prototype.headerSortOrder=function(e,t){return this.headingData[e][t].sortOrder};s.prototype.setSizing=function(e,t){this.$sizing[e]=t;this._emit("headerSizeChanged")};s.prototype.getSizingInfo=function(e){var t=[],i=[],r,n=-1,o=-1,a=this.getHeadingData(),s=a.getHeadingAxisInfo(e),l=a.getColumnSets(e),u=0,c,d,p,f=l.length,h=this.$sizing[e],g=e==="X"?"width":"height",m=this.getDefaultSize(),v,y,b,w;for(;u<f;u++){c=l[u];d=c.offset;p=c.offset+c.length-1;w=c.columns[c.columns.length-1];v=c.columns[c.columns.length-1].field;b=v?h[v.id]||m:m;y=b[g]||m[g];if(!r||d>o){n=d;o=p;r={range:[n,o],repeatDistance:w.repeatDistance,rowCount:w.length,size:y};i.push(r)}}return{defaultRanges:i,customSizeNodes:t}};s.prototype.getColumnSizesForColumnSet=function(e,t,i){var r=e.columns,n=this.getDefaultSize()[t],o=this.$sizing[i],a,s=[],l=0,u=r.length,c;for(;l<u;l++){c=r[l];a=c.field?o[c.field.id]||n:n;s.push(a&&a[t]||n)}return s};s.prototype.getColumnHeaderSizes=function(){return this.$getSizes("X")};s.prototype.getRowHeaderSizes=function(){return this.$getSizes("Y")};s.prototype.$getSizes=function(e){var t=[],i=this.$sizing[e],r=this.getDefaultSize();if(this.headingData&&i){t=this.headingData[e].map(function(e,t){if(i[t]!==undefined){return{width:i[t].width,height:i[t].height}}else{return{width:r.width,height:r.height}}return r})}return t};s.prototype.setDefaultSize=function(e){this.$defaultSize=e};s.prototype.validateValue=function(e,t){return true};s.prototype.getDefaultSize=function(){return this.$defaultSize};function l(e,t,i){var r=[];for(var n=0;n<=t;n++){r[n]=e[n][i]}return r}function u(e,t,i){var r=-1;for(var n=t;n<e.length;n++){if(i(e[n],n)){return n}}return r}function c(e,t,i){var r=-1;for(var n=t;n>=0;n--){if(i(e[n],n)){return n}}return r}s.prototype.getPreviousNeighbor=function(e,t,i){var r=this.headingData[e],n=i===0,o=r[i].headers[t],a,s;if(!n){a=c(r,i,function(e){return e.headers[t].id!==o.id});s={x:t,y:a}}return s};s.prototype.isSibling=function(e,t,i){var r=this.headingData[e],n,a;if(t.x!==i.x){return false}if(t.x===0){return true}else{n=l(r,t.x-1,t.y);a=l(r,i.x-1,i.y);return o.isEqual(n,a)}};s.prototype.getHeadingData=function(){return new d(this.headingData)};s.prototype.findHeadingIdCoords=function(e,t,i,r){var n=this.headingData[e],o=this.getHeadingInfo(e),a=o.columns,s=a.findIndex(function(e){return e.name===t}),l=n[s],u={};i.forEach(function(e){u[e]=[];l.forEach(function(t,i){if(t.aggregate&&r===t.name||!t.aggregate&&!r){u[e].push(i)}})});return u};s.prototype.getNextNeighbor=function(e,t,i){var r=this.headingData[e],n=i===this.getHeadingInfo(e).length-1,o=r[i].headers[t],a,s;if(!n){a=u(r,i,function(e){return e.headers[t].id!==o.id});if(a>0)s={x:t,y:a}}return s};s.prototype.getCellData=function(e){return this.getDataRange({X:{start:e.X,length:1},Y:{start:e.Y,length:1}})[0][0]};s.prototype.getDataRange=function(e){var t=this.cellData.slice(e.Y.start,e.Y.start+e.Y.length),i;i=t.map(function(t){return t.slice(e.X.start,e.X.start+e.X.length)});i.axes=["Y","X"];return o.zip.apply(o,i)};s.prototype.isRangeInCache=function(e){var t=this,i=this.getDataRange(e),r=false,n=true;i.forEach(function(e){e.forEach(function(e){if(o.isUndefined(e.value.lastChanged)){n=false}})});return n};s.prototype.getCopyData=function(e){var t=this,i=this.getDataRange(e),r=false,n;n=i.map(function(e){return e.map(function(e){if(o.isUndefined(e[0].data.value.value.lastChanged)){r=true}return e})});if(!r){return n}setTimeout(function(){t._emit("copyReady")})};s.prototype.setCellData=function(e){this.cellData=e;this._emit("updateModel")};s.prototype.editCell=function(e,t){var i;if(e.Y<this.cellData.length&&e.X<this.cellData[0].length){i=this.cellData[e.Y][e.X];if(!i){i={}}i.edit={rawValue:t,formattedValue:t,lastChanged:new Date}}this._emit("updateModel")};s.prototype.editCells=function(e){var t;for(var i=0;i<e.length;i++){t=e[i];this.editCell(t.coord,t.value)}};s.prototype.deleteCell=function(e){this.editCell(e,undefined)};s.prototype.deleteCells=function(e){for(var t=0;t<e.length;t++){this.deleteCell(e[t])}};s.prototype.pasteCells=function(e,t){var i;for(var r=0;r<e.length;r++){i=e[r];this.editCell(i.coord,i.value)}};s.prototype.$forEachCell=function(e){var t,i;for(var r=0;r<this.cellData.length;r++){for(var n=0;n<this.cellData[r].length;n++){t=this.cellData[r][n];i=e(t);if(i)return i}}};s.prototype.commit=function(){this.$forEachCell(function(e){if(e.edit){e.value=e.edit;delete e.edit}});this._emit("updateModel")};s.prototype.containsQueuedEdits=function(){return false};s.prototype.clearEdits=function(){this.$forEachCell(function(e){if(e.edit){delete e.edit}});this._emit("updateModel")};s.prototype.hasEdits=function(){var e;return this.$forEachCell(function(e){if(e.edit){return true}})};s.prototype.getCommitMode=function(){return this.$commitMode};s.prototype.setCommitMode=function(e){this.$commitMode=e};s.prototype.getCellStyle=function(e,t){return{}};s.prototype.getCopiedCellsRange=function(){return this.$copiedCellRange};s.prototype.setCopiedCellsRange=function(e){this.$copiedCellRange=e};s.makeColSet=function(e,t,i){i=o.isUndefined(i)?0:i;t=o.isUndefined(t)?1:t;return{columns:e.map(function(e){return{field:{id:e.fieldId},length:e.length}}),offset:i,length:t}};s.makeMember=function(e){return{id:e[0],label:e[1],config:e[2]||{}}};s.makeHeading=function(e){return s.makeMember(e)};s.makeRow=function(e,t,i){return{members:e.map(s.makeMember),headers:e.map(s.makeHeading),fields:t.columns.map(function(e){return e.field}),colSet:t,sortOrder:i}};function d(e){this.$data=e}d.prototype.getHeadingAxisInfo=function(e){return new p(this.$data[e])};d.prototype.getColumnSets=function(e){return this.getHeadingAxisInfo(e).getColumnSets()};d.prototype.hasLoadingHeadings=function(){return false};d.prototype.hasOnlyInvalidHeadings=function(){return false};d.prototype.isLoadingSlice=function(){return false};function p(e){this.$axisData=e;if(!this.$axisData||this.$axisData.length===0||o.isEqual(this.$axisData[0],[])){this.$axisData=[f()]}}function f(){return{members:[h()],headers:[h()],field:g(),colSet:m()}}function h(){return{id:"__LOADING__",label:"Loading",config:{}}}function g(){return{id:"placeholder"}}function m(){return{columns:[{field:g(),length:1}],offset:0,length:1}}p.prototype.getColumnSets=function(){return o.uniq(o.map(this.$axisData,"colSet"))};p.prototype.getLength=function(){return this.$axisData.length};t.exports=s},{"./constants":102,"./lib/event_emitter":120,"./lib/oop":124,lodash:70}],104:[function(e,t,i){"use strict";var r=e("./lib/event_emitter").EventEmitter;var n=e("./lib/oop");var o=e("escape-html");var a=e("lodash");var s=e("./cell_type_util");var l=e("./lib/dropdown");var u=e("assert");var c=e("./cell_renderer");var d=e("./cell_editor");var p=e("./utils");var f=function(){};n.inherits(f,c);f.prototype.shouldTriggerTooltip=function(e){var t=e.classList.contains("pivot_cell")?e:e.parentElement,i=t.getElementsByClassName("pt-dropdown-display")[0],r=i&&i.scrollWidth-i.clientWidth;return r>1};f.prototype.renderContent=function(e){var t=e.formattedData,i=p.getSingleValue(t),r=e.data.selectedDataLabel.value,n=p.getSingleValue(r&&r.rawValue),s,u=function(t){var i=e.data.optionLabels&&e.data.optionLabels.value&&e.data.optionLabels.value.formattedValue,r;if(i){i.forEach(function(e){if(e[0]===t){r=e[1]}})}return r};s=u(i)?u(i):n;var c=!e.showSpinner&&(a.isNumber(s)||a.isString(s))&&o(s)||"";return l.renderStaticView(c)};f.prototype.renderCell=function(e,t){var i=a.property("data.filtered.value")(e),r="'width: "+e.width+"px;padding:0px;height: "+e.height+"px; "+p.JSONObjectToStyleAttribute(e.cellStyle)+"'";return"<span style="+r+" class='noselect pivot_cell data_cell "+(e.data.filtered&&!p.getSingleValue(i&&i.rawValue)?"filtered_cell ":"")+(e.isEdited?"edit ":e.isTotal?"total ":"")+(e.isSaving?"saving ":"")+(e.isSaved?"saved ":"")+(e.isUpdated?"updated ":"")+(e.isReadOnly?"readonly ":e.isProtected?"protected ":"editable ")+(e.isLocked?"locked ":"")+s.alignToStyle(e.hAlign,false)+" "+s.alignToStyle(e.vAlign,true)+" "+(e.showSpinner?"spinner ":"")+"' "+"data-row ='"+e.row+"' "+"data-col ='"+e.col+"' "+"data-type ='"+e.type+"' "+">"+t(e)+"</span>"};f.prototype.shouldTriggerAlwaysEditing=function(e){var t=e.classList;return t.contains("pt-dropdown-toggle-arrow")||t.contains("pt-dropdown-toggle-arrow-cover")};f.prototype.renderClipboardContent=function(e){var t=e.data.selectedDataLabel.value,i=p.getSingleValue(t&&t.rawValue);return!e.showSpinner&&!a.isUndefined(i)?o(i):" "};var h=function(e){var t=this;this.alwaysEditing=true;this.container=e;this.dropdown=new l({onClose:this.cancelEdit.bind(this),onChange:function(e,i){if(i){t.confirmEdit(i)}else{t.confirmEdit()}}},this.container);this.element=this.dropdown.asHTMLElement();this.containerElement=document.createElement("div");this.containerElement.className="editable-container";this.containerElement.appendChild(this.element);this.container.appendChild(this.containerElement);this.hide()};n.inherits(h,d);n.implement(h.prototype,r);h.prototype.setDataProvider=function(e){this.provider=e};h.prototype.initialize=function(e,t,i){var r;if(a.isObject(e)){r=a.property("data.value.value.formattedValue")(e);if(!a.isUndefined(r)){e=p.getSingleValue(r)}}this.dropdown.open(i==="space");if(i&&i!=="space"){this.dropdown.search(i)}};h.prototype.focus=function(){this.dropdown.focus();document.addEventListener("mouseup",this.blur.bind(this))};h.prototype.blur=function(){document.removeEventListener("mouseup",this.blur.bind(this));this.element.blur()};h.prototype.hide=function(){this.containerElement.style.display="none";this.$editing=false};h.prototype.show=function(){this.containerElement.style.display="block"};h.prototype.$unionResultTables=function(e,t){var i,r,n=[],o,a=new Set,s=[];if(!e[0].length){return s}o=e[0][0].length-1;for(i=1;i<e.length;++i){r=new Map;e[i].forEach(function(e){r.set(e[0],e[1])});n.push(r)}e[0].forEach(function(r){var l=r[o],r={};if(!a.has(l)){a.add(l);r[t[0]]=l;for(i=1;i<e.length;++i){r[t[i]]=n[i-1].get(l)}s.push(r)}});return s};h.prototype.renderOver=function(e){var t=e.getBoundingClientRect(),i=this.containerElement.parentNode.getBoundingClientRect(),r=window.getComputedStyle(this.containerElement),n=s.parseResolvedValue(r.marginTop),o=s.parseResolvedValue(r.marginLeft),l=e.getAttribute("data-row"),c=e.getAttribute("data-col"),d=this.provider.getCellData({Y:l,X:c}),f,h,g="",m="",v,y,b,w,C=[];if(d){d=d.data;f=d.value.edit;h=d.value.value;v=d.selectedDataLabel.value;g=p.getSingleValue(f&&f.rawValue)||p.getSingleValue(h&&h.rawValue)||"";m=p.getSingleValue(v&&v.rawValue);y=d.optionIds.value&&d.optionIds.value.rawValue;if(y){b=d.optionLabels.value&&d.optionLabels.value.rawValue;w=d.optionSort.value&&d.optionSort.value.rawValue;u(b.length===w.length,"Some option labels do not have order!");C=a.sortBy(this.$unionResultTables([y,b,w],["id","label","order"]),"order")}}this.element.style.width="100%";this.element.style.height="100%";this.dropdown.update({id:g,label:m},C);this.containerElement.style.padding="0";this.containerElement.style.top=t.top-i.top-n-1+"px";this.containerElement.style.left=t.left-i.left-o-1+"px";this.containerElement.style.width=t.width+"px";this.containerElement.style.height=t.height+"px";this.containerElement.style.position="absolute";this.containerElement.style.display="block";this.$editing=true};h.prototype.getValue=function(){return this.dropdown.getValue()};h.prototype.convertData=function(e){return e};h.prototype.confirmEdit=function(e){if(this.$editing){this._emit("confirm-edit",{value:this.getValue(),keyEvent:e});this.$editing=false}};h.prototype.cancelEdit=function(){if(this.$editing){this._emit("cancel-edit",{value:this.getValue()});this.$editing=false}};i.mkDropdownRenderer=function(){return new f};i.mkDropdownEditor=function(e){return new h(e.container)};i.$DropdownRenderer=f;i.$DropdownEditor=h},{"./cell_editor":91,"./cell_renderer":92,"./cell_type_util":96,"./lib/dropdown":118,"./lib/event_emitter":120,"./lib/oop":124,"./utils":143,assert:2,"escape-html":"escape-html",lodash:70}],105:[function(e,t,i){"use strict";var r=e("./lib/event_emitter").EventEmitter;var n=e("lodash");var o=e("./lib/oop");var a=e("./cell_type_util");var s=e("./cell_renderer");var l=e("./cell_editor");var u=e("assert");var c=e("./lib/event");var d=e("./lib/dom");var p=e("./utils");var f=function(){};o.inherits(f,s);f.prototype.shouldTriggerTooltip=function(e){var t=e&&e.scrollWidth-e.clientWidth;return t>1||d.hasCssClass(e,"invalid_cell")};f.prototype.renderContent=function(e){var t=" ",i="",r="<span class='fa fa-exclamation-triangle' alt='Incorrect data' title='Incorrect data'></span>",o;if(!e.showSpinner&&!n.isUndefined(e.data.value.value)){i=p.getSingleValue(e.data.value.value.formattedValue);if(p.isUrl(i)){t="<img class='image-cell' src="+i+">"}else if(!n.isUndefined(i)){t=r}}return t};o.inherits(h,l);o.implement(h.prototype,r);function h(e){var t=this;this.initialCellValue=null;this.container=e;this.element=document.createElement("input");this.element.className="pivot_editable_cell text_cell";this.element.type="text";this.containerElement=document.createElement("div");this.containerElement.appendChild(this.element);this.container.appendChild(this.containerElement);this.directCellTyping=false;this.hide();this.element.addEventListener("blur",function(e){if(t.initialCellValue!==t.element.value){if(t.validateValue(t.$cellCoords,t.$getValue(),true)){t.$confirmEdit(e.keyCode)}else{t.focus()}}else{t.$cancelEdit()}t.initialCellValue=null});c.addCommandKeyListener(this.element,function(e){if(e.keyCode===13||e.keyCode===9||n.includes([37,38,39,40],e.keyCode)&&t.directCellTyping){if(t.validateValue(t.$cellCoords,t.$getValue(),true)){t.$confirmEdit(e);e.preventDefault()}}else if(e.keyCode===27){t.$cancelEdit()}});var i=n.debounce(function(){t.validateValue(t.$cellCoords,t.$getValue())},50);this.element.addEventListener("input",i)}h.prototype.initialize=function(e,t,i){var r,o;if(n.isObject(e)){r=e.data.value;o=r&&r.edit&&r.edit.rawValue||p.getSingleValue(r.value.formattedValue);if(n.isUndefined(o))o=""}if(i){this.directCellTyping=true;this.element.value=i==="space"?"":i}else{this.directCellTyping=false;this.element.value=o}this.$cellCoords=p.getCoordFromTarget(t);this.validateValue(this.$cellCoords,i||o);this.initialCellValue=o};h.prototype.focus=function(){var e=this.element.value.length;this.element.focus();this.element.setSelectionRange(e,e)};h.prototype.blur=function(){this.element.blur()};h.prototype.hide=function(){this.containerElement.style.display="none";this.$editing=false;this.markCellValid()};h.prototype.show=function(){this.containerElement.style.display="block"};h.prototype.renderOver=function(e){var t=e.getBoundingClientRect(),i=this.containerElement.parentNode.getBoundingClientRect(),r=window.getComputedStyle(this.containerElement),n=a.parseResolvedValue(r.marginTop),o=a.parseResolvedValue(r.marginLeft);this.element.style.width="100%";this.element.style.height="100%";this.containerElement.style.top=t.top-i.top-n-1+"px";this.containerElement.style.left=t.left-i.left-o-1+"px";this.containerElement.style.width=t.width+"px";this.containerElement.style.height=t.height+"px";this.containerElement.style.position="absolute";this.containerElement.style.display="block";this.containerElement.className="editable-container";this.$editing=true};h.prototype.convertData=function(e){return n.isUndefined(e)?"":e};h.prototype.validateValue=function(e,t,i){var r=p.isUrl(t)||t==="";if(!r){this.markCellInvalid("Image URL must be valid.",i)}else{this.markCellValid()}return r};h.prototype.$getValue=function(){return this.element.value};h.prototype.$confirmEdit=function(e){var t=this.$getValue(),i=false;if(t==="")i=true;if(this.$editing){if(i){this.$cancelEdit();this.provider.deleteCells([this.$cellCoords])}else{this._emit("confirm-edit",{value:t,keyEvent:e})}this.$editing=false}};h.prototype.$cancelEdit=function(){if(this.$editing){this._emit("cancel-edit",{value:this.$getValue()});this.$editing=false;this.invalid=false}};h.prototype.markCellValid=function(){var e="validation-popup",t=this.popupElem;if(t){t.parentElement.removeChild(t);this.popupElem=null}var i=this.element.parentElement;if(i.className.match("invalid-input")){i.className=i.className.replace("invalid-input","")}};h.prototype.markCellInvalid=function(e,t){var i,r=150,n="right",o,a="validation-popup",s,l,u;if(!this.element.parentElement.className.match("invalid-input")){this.element.parentElement.className+=" invalid-input"}if(!t)return;i=this.popupElem;if(!i){u=document.createElement("div");u.className="info-text";u.innerHTML=e;l=document.createElement("div");l.className="info message";l.appendChild(u);i=document.createElement("div");i.id=a;i.className="notification alert alert-warning material";o=this.element.parentElement.clientWidth-this.element.parentElement.offsetLeft;if(o<r){n+="left"}i.className+=" "+n;i.appendChild(l);this.popupElem=i;this.element.parentElement.appendChild(i)}else{u=i.querySelector(".info-text");u.innerHTML=e}};i.mkImageCellRenderer=function(){return new f};i.mkImageCellEditor=function(e){return new h(e.container)};i.$ImageCellRenderer=f;i.$ImageCellEditor=h},{"./cell_editor":91,"./cell_renderer":92,"./cell_type_util":96,"./lib/dom":117,"./lib/event":119,"./lib/event_emitter":120,"./lib/oop":124,"./utils":143,assert:2,lodash:70}],106:[function(e,t,i){"use strict";var r=e("../lib/keys");var n=e("../lib/useragent");function o(e,t){this.platform=t||(n.isMac?"mac":"win");this.commands={};this.commmandKeyBinding={};this.addCommands(e)}(function(){this.addCommand=function(e){if(this.commands[e.name])this.removeCommand(e);this.commands[e.name]=e;if(e.bindKey)this._buildKeyHash(e)};this.removeCommand=function(e){var t=typeof e==="string"?e:e.name;e=this.commands[t];delete this.commands[t];var i=this.commmandKeyBinding;for(var r in i){for(var n in i[r]){if(i[r][n]==e)delete i[r][n]}}};this.bindKey=function(e,t){if(!e)return;if(typeof t=="function"){this.addCommand({exec:t,bindKey:e,name:t.name||e});return}var i=this.commmandKeyBinding;e.split("|").forEach(function(e){var r=this.parseKeys(e,t);var n=r.hashId;(i[n]||(i[n]={}))[r.key]=t},this)};this.addCommands=function(e){e&&Object.keys(e).forEach(function(t){var i=e[t];if(!i)return;if(typeof i==="string")return this.bindKey(i,t);if(typeof i==="function")i={exec:i};if(!i.name)i.name=t;this.addCommand(i)},this)};this.removeCommands=function(e){Object.keys(e).forEach(function(t){this.removeCommand(e[t])},this)};this.bindKeys=function(e){Object.keys(e).forEach(function(t){this.bindKey(t,e[t])},this)};this._buildKeyHash=function(e){var t=e.bindKey;if(!t)return;var i=typeof t=="string"?t:t[this.platform];this.bindKey(i,e)};this.parseKeys=function(e){if(e.indexOf(" ")!=-1)e=e.split(/\s+/).pop();var t=e.length===1?[e.toLowerCase()]:e.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(e){return e});var i=t.pop();var n=r[i];if(r.FUNCTION_KEYS[n])i=r.FUNCTION_KEYS[n].toLowerCase();else if(!t.length)return{key:i,hashId:-1};else if(t.length==1&&t[0]=="shift")return{key:i.toUpperCase(),hashId:-1};var o=0;for(var a=t.length;a--;){var s=r.KEY_MODS[t[a]];if(s==null){if(typeof console!="undefined")console.error("invalid modifier "+t[a]+" in "+e);
return false}o|=s}return{key:i,hashId:o}};this.findKeyCommand=function e(t,i){var r=this.commmandKeyBinding;return r[t]&&r[t][i]};this.handleKeyboard=function(e,t,i,r){return{command:this.findKeyCommand(t,i),args:{keyString:i}}}}).call(o.prototype);i.HashHandler=o},{"../lib/keys":121,"../lib/useragent":125}],107:[function(e,t,i){"use strict";var r=e("../lib/keys");var n=e("../lib/event");var o=function(e){this.$editor=e;this.$data={};this.$handlers=[];this.setDefaultHandler(e.commands)};(function(){this.setDefaultHandler=function(e){this.removeKeyboardHandler(this.$defaultHandler);this.$defaultHandler=e;this.addKeyboardHandler(e,0);this.$data={editor:this.$editor}};this.setKeyboardHandler=function(e){var t=this.$handlers;if(t[t.length-1]==e)return;while(t[t.length-1]&&t[t.length-1]!=this.$defaultHandler)this.removeKeyboardHandler(t[t.length-1]);this.addKeyboardHandler(e,1)};this.addKeyboardHandler=function(e,t){if(!e)return;var i=this.$handlers.indexOf(e);if(i!=-1)this.$handlers.splice(i,1);if(t==undefined)this.$handlers.push(e);else this.$handlers.splice(t,0,e);if(i==-1&&e.attach)e.attach(this.$editor)};this.removeKeyboardHandler=function(e){var t=this.$handlers.indexOf(e);if(t==-1)return false;this.$handlers.splice(t,1);e.detach&&e.detach(this.$editor);return true};this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]};this.$callKeyboardHandlers=function(e,t,i,r){var o;var a=false;var s=this.$editor.commands;for(var l=this.$handlers.length;l--;){o=this.$handlers[l].handleKeyboard(this.$data,e,t,i,r);if(!o||!o.command)continue;if(o.command=="null"){a=o.passEvent!=true}else{a=s.exec(o.command,this.$editor,o.args,r)}if(a&&r&&e!=-1)n.stopEvent(r);if(a)break}return a};this.onCommandKey=function(e,t,i){var n=r.keyCodeToString(i);this.$callKeyboardHandlers(t,n,i,e)};this.onTextInput=function(e){var t=this.$callKeyboardHandlers(-1,e);if(!t)this.$editor.commands.exec("insertstring",this.$editor,e)}}).call(o.prototype);i.KeyBinding=o},{"../lib/event":119,"../lib/keys":121}],108:[function(e,t,i){"use strict";var r=e("../lib/event");var n=e("../lib/useragent");var o=e("../lib/dom");var a=e("../lib/lang");var s=e("../constants").TextInput;var l=function(e,t){var i,l=false,u=false,c=false,d=false,p=true,f=false,h=null,g=-1,m=a.delayedCall(function(){f&&w(p)}),v=a.delayedCall(N,50);y();b();n.isWebKit||t.addEventListener("changeSelection",function(){if(t.selection.isEmpty()!=p){p=!p;m.schedule()}});C();if(f){t.onFocus()}function y(){i=o.createElement("textarea");if(n.isTouchPad){i.setAttribute("x-palm-disable-auto-cap",true)}i.className="ace_text-input";i.wrap="off";i.autocorrect="off";i.autocapitalize="off";i.spellcheck=false;i.style.bottom="2000em";e.insertBefore(i,e.firstChild);f=document.activeElement===i}function b(){r.addCommandKeyListener(i,t.onCommandKey.bind(t));r.addListener(i,"blur",function(){t.onBlur();f=false});r.addListener(i,"focus",function(){f=true;t.onFocus();w()});r.addListener(i,"select",S);r.addListener(i,"input",x);r.addListener(i,"cut",_);r.addListener(i,"copy",M);r.addListener(i,"paste",I);r.addListener(i,"compositionstart",D);r.addListener(i,n.isGecko?"text":"keyup",function(){v.schedule()});r.addListener(i,"compositionend",R)}function w(e){var t,r;if(!d){if(h){t=0;r=e?0:i.value.length-1}else{t=e?2:1;r=2}i.setSelectionRange(t,r)}}function C(){if(!d){i.value=s.PLACEHOLDER}}function E(e){return e.selectionStart===0&&e.selectionEnd===e.value.length}function S(){if(l){l=false}else if(u){u=false}else if(E(i)){t.selectAll();w()}else if(h){w(t.selection.isEmpty())}}function T(e){if(h){e=h(e);h=null}if(c){w();if(e){t.onPaste(e)}c=false}else if(e===s.PLACEHOLDER[0]){if(Date.now()-g>100){t.execCommand("del",{source:"ace"})}}else{if(e.substring(0,2)===s.PLACEHOLDER){e=e.substr(2)}else if(e[0]===s.PLACEHOLDER[0]){e=e.substr(1)}else{while(e[e.length-1]===s.PLACEHOLDER[0]){e=e.slice(0,-1)}}if(e){t.onTextInput(e)}}}function x(){if(!d){T(i.value);C()}}function _(e){A(e,true)}function M(e){A(e,false)}function A(e,n){var o=t.getCopyText(n);if(!o){r.preventDefault(e);return}n?l=true:u=true;i.value=o;i.select();setTimeout(function(){n?l=false:u=false;C();w()},0)}function I(e){var o=e.clipboardData||window.clipboardData,a;if(o){a=o.getData("Text");if(a)t.onPaste(a);if(n.isIE)setTimeout(w,0);r.preventDefault(e)}else{i.value="";c=true}}function O(){t.onEscape()}function D(){d=true;t.onCompositionStart();setTimeout(N,0)}function N(){if(d){t.onCompositionUpdate(i.value)}}function R(){d=false;t.onCompositionEnd();g=Date.now()}function P(){if(!t.renderer.editing){i.focus()}}function L(){i.blur()}function k(){return f}function $(e){h=e}function F(){return h}function V(){return i}function q(e){i.readOnly=e}return{focus:P,blur:L,isFocused:k,setInputHandler:$,getInputHandler:F,getElement:V,setReadOnly:q}};i.TextInput=l},{"../constants":102,"../lib/dom":117,"../lib/event":119,"../lib/lang":122,"../lib/useragent":125}],109:[function(e,t,i){"use strict";var r=e("../lib/oop");var n=e("../lib/dom");var o=e("../lib/event_emitter").EventEmitter;var a=e("../utils");var s=e("assert");var l=e("lodash");var s=e("assert");var u=function(e,t,i,r){this.element=n.createElement("div");this.element.className="pivot_layer pivot_cell_layer";t.appendChild(this.element);this.formatCellCb=null;this.$pivotId=e;this.$domCells=[];this.$getCellRenderFn=i;this.$getContentRenderFn=r;this.$lastUpdated=null};(function(){this.defaultAlignment=["align-left","valign-top"];r.implement(this,o);this.setDataProvider=function(e){this.provider=e};this.setDefaultAlignment=function(e,t){e=e?"align-"+e:this.defaultAlignment[0];t=t?"valign-"+t:this.defaultAlignment[1];this.defaultAlignment=[e,t]};this.update=function(e){var t,i,r=[],o=e.view,s=e.hRange,u=e.vRange,c=e.lastRow+1-e.firstRow,d=e.lastCol+1-e.firstCol,p,f,h,g,m=this.defaultAlignment[0],v=this.defaultAlignment[1],y=l.some(l.flatten(l.map(o,function(e){return l.map(e,function(e){return e instanceof Object&&e.hasOwnProperty("pendingSave")})}))),b,w={queryOutstanding:false,saveOutstanding:false},C=o&&!!o.length,E,S;this.config=e;for(i=0;i<c&&C;i++){g=u[i];f=g.size;if(f===0)continue;r.push("<div>");for(t=0;t<d;t++){b=o[t][i][0];E=a.parseCellData(b,y,this.$lastUpdated);S=a.checkCellDataOutstandingValue(b);h=s[t];p=h.size;if(p===0)continue;if(!w.queryOutstanding&&S.queryOutstanding){w.queryOutstanding=true}if(!w.saveOutstanding&&S.saveOutstanding){w.saveOutstanding=true}E.row=i+e.firstRow;E.col=t+e.firstCol;E.height=f;E.width=p;E.hAlign=b.halign||h.align||g.align||m;E.vAlign=h.valign||g.valign||v;E.cellStyle=E.data.value&&!l.isUndefined(E.data.value.value)?this.provider.getCellStyle(E.data,b.formattingConfig,E.displayType):null;r.push(this.$getCellRenderFn(E.displayType)(E,this.$getContentRenderFn(E.displayType)))}r.push("</div>")}this.element=n.setInnerHtml(this.element,r.join(""));if(this.$lastUpdated||!w.queryOutstanding){this.$lastUpdated=new Date}return w};this.scroll=this.update;this.destroy=function(){}}).call(u.prototype);i.Cells=u},{"../lib/dom":117,"../lib/event_emitter":120,"../lib/oop":124,"../utils":143,assert:2,lodash:70}],110:[function(e,t,i){"use strict";var r=e("assert");var n=e("../lib/dom");var o=e("lodash");var a=function(e,t){var i=this;this.element=n.createElement("div");this.element.className="pivot_layer pivot_selection-layer";this.element.style.display="block";e.appendChild(this.element);this.renderer=t};(function(){this.setDataProvider=function(e){this.provider=e};this.renderCopiedSelection=function(e,t,i){if(!t)return;var r=e.vRange;var n=e.hRange;var o=t.start;var a=t.end;var s=Math.min(o.row,a.row)-e.firstRow;var l=Math.min(e.lastRow,Math.max(o.row,a.row))-e.firstRow+1;var u=Math.min(o.column,a.column)-e.firstCol;var c=Math.min(e.lastCol,Math.max(o.column,a.column))-e.firstCol+1;if(l-s<1&&c-u<1||l-s<1||c-u<1)return;var d,p,f,h,g;d=0,h=1;for(g=0;g<s;g++)d+=r[g].size;for(g=Math.max(0,s);g<l;g++)h+=r[g].size;p=0,f=1;for(g=0;g<u;g++)p+=n[g].size;for(g=Math.max(0,u);g<c;g++)f+=n[g].size;i.push("<div class='pivot_copied_range' style='left:"+p+"px;top:"+d+"px;width:"+f+"px;height:"+h+"px;'></div>")};this.update=function(e){var t=[this.provider.getCopiedCellsRange()];var i=[];for(var r=0,o=t.length;r<o;r++){this.renderCopiedSelection(e,t[r],i)}this.element=n.setInnerHtml(this.element,i.join(""))};this.destroy=function(){clearInterval(this.intervalId);clearTimeout(this.timeoutId)}}).call(a.prototype);i.CopiedSelection=a},{"../lib/dom":117,assert:2,lodash:70}],111:[function(e,t,i){"use strict";var r=e("assert");var n=e("escape-html");var o=e("lodash");function a(e,t,i,r,n,o){this.$provider=e;this.$start=i;this.$axis=t;this.$vertical=t==="Y";this.$oppAxis=t==="Y"?"X":"Y";this.$side=t==="Y"?"height":"width";this.$oppSide=t==="Y"?"width":"height";this.$columnSets=this.$provider.getHeadingData().getColumnSets(t);this.$defaultParallelCellSize=e.getDefaultSize()[this.$side];this.$findColSetInfos();this.$range=r;this.$selection=n;this.$selectionRange=o;this.$maxColSetTransverseSize=this.getMaxTransverseSize();this.$baseClasses=["grid-header","heading_cell","pivot_cell","noselect"];this.$columnClasses=["noselect","heading_column"].join(" ");if(this.$vertical){this.$baseClasses.push("vertical_heading")}else{this.$baseClasses.push("horizontal_heading")}this.$state={html:"",currParallelOffset:0}}t.exports=a;a.prototype.getHtml=function(){var e=[this.$vertical?"width: "+this.getMaxTransverseSize()+"px":"height: "+this.getMaxTransverseSize()+"px",this.$vertical?"height: "+this.getCurrentParallelSize()+"px":"width: "+this.getCurrentParallelSize()+"px"].join(";");return"<div style='"+e+"' class='header_wrapper'>"+this.$state.html+"</div>"};a.prototype.getCurrentParallelSize=function(){return this.$state.currParallelOffset};a.prototype.getTransverseSize=function(){return this.$maxColSetTransverseSize};a.prototype.$initializeColumns=function(e){this.$state.currentCells=new Array(e.columns.length);this.$state.columnHtml=e.columns.map(function(){return""});this.$state.currColParallelSize=e.columns.map(function(){return 0});var t=this.calcColSetTransverseSize(e),i=this.$maxColSetTransverseSize/t;this.$state.columnTransverseSizes=this.$provider.getColumnSizesForColumnSet(e,this.$oppSide,this.$axis).map(function(e){return e*i})};a.prototype.$getColumnParallelSize=function(e){return this.$state.currColParallelSize[e]};a.prototype.$closeColumnsStartingAt=function(e){var t=e,i=this.getCurrColumnSet(),r,n,o,a,s;if(!i){return}for(;t<i.columns.length;t++){r=this.$calcTransverseSize(t);n=this.$getColumnParallelSize(t);a=this.$state.currParallelOffset-n;s=this.$calcTransverseOffset(i,t);o=[this.$vertical?"top: "+a+"px":"left: "+a+"px",this.$vertical?"left: "+s+"px":"top: "+s+"px",this.$vertical?"width: "+r+"px":"height: "+r+"px",this.$vertical?"height: "+n+"px":"width: "+n+"px"].join(";");this.$state.html+="<div style='"+o+"' class='"+this.$columnClasses+"'>"+this.$state.columnHtml[t]+"</div>";this.$state.currColParallelSize[t]=0;this.$state.columnHtml[t]=""}};a.prototype.$calcTransverseOffset=function(e,t){var i=0,r=0;for(;r<t;r++){i+=this.$calcTransverseSize(r)}return i};a.prototype.$getCurrentCell=function(e){return this.$state.currentCells[e]};a.prototype.$rowWithinCurrentColSet=function(e){return this.$state.currColSetInfo&&this.$state.currColSetInfo.end>=e};a.prototype.getCurrColumnSet=function(){return this.$state.currColSet};a.prototype.$closeCellsStartingAt=function(e){var t=e,i=this.getCurrColumnSet();if(!i){return}for(;t<i.columns.length;t++){this.$closeCell(t)}};function s(e,t){var i=e.field,r=t.field;return o.isUndefined(i)&&o.isUndefined(r)||!o.isUndefined(i)&&!o.isUndefined(r)&&i.id===r.id}a.prototype.setColumnSet=function(e){var t=this.getCurrColumnSet(),i=0;if(!t){this.$initializeColumns(e)}else if(t.columns.length!==e.columns.length){this.$closeCellsStartingAt(0);this.$closeColumnsStartingAt(0);this.$initializeColumns(e)}else{for(;i<t.columns.length;i++){if(!s(t.columns[i],e.columns[i])){this.$closeCellsStartingAt(i);this.$closeColumnsStartingAt(i);break}}}this.$state.currColSet=e};a.prototype.$sameHeading=function(e,t){var i=this.$getCurrentCell(t);return i&&c(e)===i.id};a.prototype.applyHeading=function(e,t,i){var r,n=this.getCurrColumnSet().columns.length,o;if(!this.$sameHeading(e,i)){for(r=i;r<n;r++){this.$closeCell(r)}this.$openCell(e,t,i)}else{this.$addRowToCell(e,t,i)}o=this.$calcParallelSize(t);if(i===0){this.$state.currParallelOffset+=o}this.$state.currColParallelSize[i]+=o};a.prototype.finish=function(){this.$closeCellsStartingAt(0);this.$closeColumnsStartingAt(0)};a.prototype.$closeCell=function(e){var t=this.$getCurrentCell(e);if(t){var i=this.$baseClasses.slice();if(t.isRollup){i.push("total")}if(this.isCellHighlighted(t)){i.push("highlighted")}this.$state.columnHtml[e]+=l(t.height,t.width,t.startRow,t.relStartRow,t.col,i,t.content,t.canSort,t.sortOrder);delete this.$state.currentCells[e]}};a.prototype.$calcParallelSize=function(e){return this.$range[e].size||this.$defaultParallelCellSize};a.prototype.$calcTransverseSize=function(e){return this.$state.columnTransverseSizes[e]};a.prototype.$currentCellHasSameTransverse=function(e){var t=this.$getCurrentCell(e),i=this.$vertical?"width":"height",r=t&&t[i];return t&&r===this.$calcTransverseSize(e)};a.prototype.$openCell=function(e,t,i){var n=this.$calcParallelSize(t),o=this.$calcTransverseSize(i),a=this.$provider.headerCanSort(this.$axis,t,i),s;if(a){s=this.$provider.headerSortOrder(this.$axis,this.$start+t)}r(!this.$state.currentCells[i],"can't open a new cell, cell currently open in "+i);this.$state.currentCells[i]={height:this.$vertical?n:o,width:this.$vertical?o:n,col:i,startRow:this.$start+t,relStartRow:t,endRow:this.$start+t,isRollup:u(e),id:c(e),content:d(e),canSort:a,sortOrder:s}};a.prototype.$addRowToCell=function(e,t,i){var n=this.$getCurrentCell(i),o=this.$calcParallelSize(t);r(n,"can't add row to cell for "+i+" because it doesn't exist!");if(this.$vertical){n.height+=o}else{n.width+=o}n.endRow=t};a.prototype.calcColSetTransverseSize=function(e){return this.$provider.getColumnSizesForColumnSet(e,this.$oppSide,this.$axis).reduce(function(e,t){return e+t},0)};a.prototype.getMaxTransverseSize=function(){var e=this;return Math.max.apply(null,this.$columnSets.map(function(t){return e.calcColSetTransverseSize(t)}))};a.prototype.$findColSetInfos=function(){var e=this,t=0,i=this.$columnSets.map(function(i){var r=e.$provider.getColumnSizesForColumnSet(i,e.$oppSide,e.$axis),n=e.calcColSetTransverseSize(i),o={start:t,end:i.length<2?t:t+i.length-1,columnTransverseSizes:r,columnSet:i,transverseSize:n};t+=i.length;return o}),r=0;i.forEach(function(e){r=Math.max(e.transverseSize,r)});this.$maxColSetTransverseSize=r};a.prototype.isCellHighlighted=function(e){if(!this.$selection||!this.$selectionRange){return false}return this.$selection.start&&this.$selection.start.x<=e.col&&this.$selectionRange.from<=e.startRow&&this.$selectionRange.to>=e.endRow};function l(e,t,i,r,o,a,s,l,u){var c='<span style="height:'+e+"px;width:"+t+'px" '+'data-row="'+i+'" '+'data-relRow= "'+r+'" '+'data-col="'+o+'" '+'data-type="text" '+'class="'+a.join(" ")+'">'+'<div class="heading_text" style="width:'+(t-25)+'px">'+n(s)+"</div>"+p(l,u)+"</span>";return c}function u(e){return!!e.config.rollup}function c(e){return e.id}function d(e){return e.label}function p(e,t){var i="sort-icon fa ";if(!e){return""}if(t){i+=t==="desc"?"fa-sort-amount-desc":"fa-sort-amount-asc"}else{i+="unsorted fa-sort-amount-asc"}return"<div class='"+i+"'></div>"}},{assert:2,"escape-html":"escape-html",lodash:70}],112:[function(e,t,i){"use strict";var r=e("../lib/oop");var n=e("../lib/dom");var o=e("../lib/event_emitter").EventEmitter;var a=e("./headings/nodes");var s=e("./heading_builder");var l=e("./headings/caretselection").CaretSelection;var u=e("./headings/headingcaret");var c=e("assert");var d=e("lodash");var p=e("../utils");function f(e,t){a.call(this);p.type.assertArgs(arguments,[Object,Object]);this.renderer=t;this.element=n.createElement("div");this.visible=true;this.caretSelection=new l(this);this.caretSelection.on("selectionChanged",this.$onSelectionChanged.bind(this));this.dataRange=[[]];this.offset=0;this.maxDepth=0}r.inherits(f,a);r.implement(f.prototype,o);f.prototype.$onSelectionChanged=function(){var e=this.$getSelectionPositions();this._emit("headingSelectionChanged");this.headingCaret.scrollTo(e.start);this.headingCaret.renderCaret(e.startRelativePos,e.endRelativePos);this.showHighlighting()};f.prototype.$adjustSelection=function(){var e=this.$getSelectionPositions(),t={start:this.offset,end:this.offset+this.dataRange[0].length};if(!this.hasCaret()){return}if(t.start>this.$selectionRange.to||t.end<=this.$selectionRange.from){this.headingCaret.hideCaret()}else{this.headingCaret.renderCaret(e.startRelativePos,e.endRelativePos)}};f.prototype.$getSelectionPositions=function(){var e=this.caretSelection.getSelection(),t={x:e.start.x,y:e.start.y>e.end.y?e.end.y:e.start.y},i={x:e.end.x,y:e.start.y>e.end.y?e.start.y:e.end.y},r={start:t,end:i,startRelativePos:this.getRelativeHeaderPosition(t),endRelativePos:this.getRelativeHeaderPosition(i)};this.$selectionRange={from:this.$findHeadingBeginningIndex(t.x,t.y),to:this.$findHeadingEndingIndex(i.x,i.y)};return r};f.prototype.$findHeadingBeginningIndex=function(e,t){var i=this.provider.getPreviousNeighbor(this.axis,e,t);if(i){return this.provider.getNextNeighbor(this.axis,i.x,i.y).y}else{return 0}};f.prototype.$findHeadingEndingIndex=function(e,t){var i=this.provider.getNextNeighbor(this.axis,e,t);if(i){return i.y-1}else{return this.length-1}};f.prototype.showHighlighting=function(){n.addCssClass(this.element,"highlighting_visible")};f.prototype.hideHighlighting=function(){n.removeCssClass(this.element,"highlighting_visible")};f.prototype.getHeadingRowMembers=function(e){var t=this.provider.getHeadingRange({start:e,length:1},this.axis)[0];return t?t.members:[]};function h(e,t){return e.slice(0,t+1)}f.prototype.getRelativeHeaderPosition=function(e){var t=this.dataRange,i=0,r,n=h(this.getHeadingRowMembers(e.y),e.x);for(var o=0;o<e.y-this.offset;o++){r=t[o]?h(t[o].members,e.x):[];if(!d.isEqual(r,n)){i++}}return{x:e.x,y:i}};f.prototype.setDataProvider=function(e){if(this.provider&&this.provider.off)this.provider.off("updateModel",this.reset.bind(this));this.provider=e;this.reset();if(this.provider&&this.provider.on)this.provider.on("updateModel",this.reset.bind(this))};f.prototype.update=function(e,t){if(t)this.element.style.width=this.visible?"":"0px";else this.element.style.height=this.visible?"":"0px";this.element.style.overflow=this.visible?"":"hidden";this.updateRange(e,this.isVertical)};f.prototype.toggle=function(e,t){console.log("Toggling is not supported");return};function g(e,t,i){var r=0;e.columns.forEach(function(e){r+=(e.sizing.defaultSize||{}).axis||i});return r}function m(e,t){return{start:e.start,end:e.end,transverseSize:e.transverseSize,columnTransverseSizes:e.columnTransverseSizes.map(function(e){return t*e})}}f.prototype.updateRange=function(e,t){var i,r,o=this,a,l,u=this.provider,c=t?"Y":"X",d=t?e.vRange:e.hRange,p,f=0,h;if(t){i=e.firstRow;r=e.lastRow-e.firstRow+1;a=this.element.offsetWidth}else{i=e.firstCol;r=e.lastCol-e.firstCol+1;l=this.element.offsetHeight}this.offset=i;this.dataRange=u.getHeadingRange({start:i,length:r},c);p=new s(this.provider,c,i,d,this.caretSelection.getSelection(),this.$selectionRange);for(;f<this.dataRange.length;f++){var g=this.dataRange[f],m=g.colSet,v=g.headers,y=v.length;p.setColumnSet(m);for(h=0;h<y;h++){p.applyHeading(v[h],f,h)}}p.finish();o.element=n.setInnerHtml(o.element,p.getHtml());if(o.hasCaret()){var b=d.length,w=o.caretSelection.getSelection();if(b+i-1<=0||w.start.x>this.dataRange.length-1){o.removeCaret()}else{o.$adjustSelection()}}if(t){if(o.element.offsetWidth!=a)o._emit("changeWidth")}else{if(o.element.offsetHeight!=l)o._emit("changeHeight")}};f.prototype.destroy=function(){};f.prototype.isBlankHeader=function(e){return e&&e.indexOf("blank")>-1};f.prototype.headerValue=function(e){return e&&!this.isBlankHeader(e)&&e||"&nbsp;"};f.prototype.headerEditValue=function(e){return e&&!this.isBlankHeader(e)&&e||""};f.prototype.isHighlighted=function(e,t,i){var r=this.caretSelection.getSelection();return this.$selectionRange&&r.start&&r.start.x<=e&&this.$selectionRange.from<=t&&this.$selectionRange.to>=i};f.prototype.moveDown=function(){var e=this.caretSelection.getSelection();if(this.caretSelection.nextNeighbor(e.start.x,e.start.y)===-1){this.caretSelection.setSelection(e.start.x,this.length-1)}else{this.caretSelection.onDown()}};f.prototype.moveRight=function(){this.caretSelection.onRight()};f.prototype.moveUp=function(){var e=this.caretSelection.getSelection(),t=this.getRelativeHeaderPosition(e.start);if(t.y===0&&!this.caretSelection.isCellTop(e.start.x,this.offset)){this.caretSelection.goToCellTop(e.start.x,e.start.y)}else if(t.y>0){this.caretSelection.goToCellTop(e.start.x,this.caretSelection.prevNeighbor(e.start.x,e.start.y))}};f.prototype.moveLeft=function(){this.caretSelection.onLeft()};f.prototype.getCaret=function(){var e,t,i=this.isVertical;var r=i?this.renderer.vHeadingCaret:this.renderer.hHeadingCaret;if(!r){t=this.selectionLayer;e=t.appendChild(document.createElement("div"));if(i){this.renderer.vHeadingCaret=e}else{this.renderer.hHeadingCaret=e}e.className="pivot_heading_caret";e.addEventListener("mousedown",function(e){e.stopPropagation()})}else{e=i?this.renderer.vHeadingCaret:this.renderer.hHeadingCaret}return e};f.prototype.scroll=function(e){this.update(e)};f.prototype.updateRows=function(e){this.update(e)};f.prototype.getHeaderIndex=function(e){var t=0,i=0;while(t<e){t+=this.getLevelSize()[i];i++}return i};f.prototype.getColumnSizesAtNode=function(e){return this.provider.getHeadingColumnSizesAtRow(this.axis,e.index)};f.prototype.findColumnIndexOfDepthAtNode=function(e,t){var i=this.getColumnSizesAtNode(e),r=i.length,n=0,o=0;while(o<t&&n<r){o+=i[n];n++}if(o<=t){return t>0?r-1:0}else{return n-1}};f.prototype.findDepthOffsetOfColumnIndexAt=function(e,t){var i=this.getColumnSizesAtNode(e),r=0,n=0;for(;r<t;r++){n+=i[r]}return n};f.prototype.findColumnSizeOfIndexAt=function(e,t){var i=this.getColumnSizesAtNode(e);return i[t]};f.prototype.reset=function(){var e=this.provider.getHeadingData(),t=e.getHeadingAxisInfo(this.axis),i=this.provider.getSizingInfo(this.axis);this.maxDepth=this.getMaxDepth(t);this.initialize(t.getLength(),i.defaultRanges,i.customSizeNodes)};f.prototype.getCustomSizeNodes=function(){};f.prototype.getMaxDepth=function(e){var t=e.getColumnSets();return d.max(t,d.property("columns.length")).columns.length};f.prototype.$mergeHeadersWithRollups=function(e,t){var i=[],r=e[0],n=t[0],o=1,a=1;if(!e.length){return t}if(!t.length){return e}while(r||n){if(r&&!n||r&&r.index<n.index){i.push(r);r=e[o++]}else{i.push(n);n=t[a++]}}return i};f.prototype.getLevelSize=function(){throw new Error("getLevelSize not implemented in base class")};function v(e,t){var i=this;f.call(this,e,t);this.axis="X";this.isVertical=false;this.element.className="pivot_heading pivot_horheading-layer";e.appendChild(this.element);this.selectionLayer=n.createElement("div");this.selectionLayer.className="pivot_layer pivot_selection-layer";e.appendChild(this.selectionLayer);document.addEventListener("click",function(e){if(!b(t.container,e.target))i.removeCaret()});this.headingCaret=new u(this)}r.inherits(v,f);v.prototype.getLevelSize=function(){return d.map(this.provider.getColumnHeaderSizes(),"height")};v.prototype.removeCaret=function(){document.removeEventListener("keydown",this.keyDownHandler,true);this.caretSelection.clear();if(this.selectionLayer.firstChild)this.selectionLayer.removeChild(this.renderer.hHeadingCaret);delete this.renderer.hHeadingCaret;this.headingCaret.showCaret=false;this.hideHighlighting()};v.prototype.hasCaret=function(){return!!this.renderer.hHeadingCaret};v.prototype.canAcceptSelection=function(){return true};function y(e,t){var i=this;f.call(this,e,t);this.axis="Y";this.isVertical=true;this.element.className="pivot_heading pivot_verheading-layer";e.appendChild(this.element);this.selectionLayer=n.createElement("div");this.selectionLayer.className="pivot_layer pivot_selection-layer";e.appendChild(this.selectionLayer);document.addEventListener("click",function(e){if(!b(t.container,e.target))i.removeCaret()});this.headingCaret=new u(this)}r.inherits(y,f);y.prototype.getLevelSize=function(){return d.map(this.provider.getRowHeaderSizes(),"width")};y.prototype.removeCaret=function(){document.removeEventListener("keydown",this.keyDownHandler,true);this.caretSelection.clear();if(this.selectionLayer.firstChild)this.selectionLayer.removeChild(this.renderer.vHeadingCaret);delete this.renderer.vHeadingCaret;this.hideHighlighting()};y.prototype.hasCaret=function(){return!!this.renderer.vHeadingCaret};y.prototype.canAcceptSelection=function(){var e=this.provider.getHeadingInfo(this.axis);return e&&e.getLength()>0};function b(e,t){var i=t.parentNode;while(i!==null){if(i===e){return true}i=i.parentNode}return false}i.VerHeading=y;i.HorHeading=v},{"../lib/dom":117,"../lib/event_emitter":120,"../lib/oop":124,"../utils":143,"./heading_builder":111,"./headings/caretselection":113,"./headings/headingcaret":114,"./headings/nodes":115,assert:2,lodash:70}],113:[function(e,t,i){"use strict";var r=e("assert");var n=e("../../lib/oop");var o=e("../../lib/event_emitter").EventEmitter;var a=e("lodash");function s(e){this.$selection={start:null,end:null};this.$heading=e}n.implement(s.prototype,o);s.prototype.getElementAt=function(e,t){var i,n,o=this.$heading.provider;if(o.getHeadingInfo(this.$heading.axis).length>0){n=o.getHeadingRange({start:t,length:1},this.$heading.axis);r(n&&n[0]&&n[0].members[e]);i=n[0].members[e]}return i};s.prototype.goToCellTop=function(e,t){var i=this.prevNeighbor(e,t);if(i!==-1){this.setSelection(this.$selection.start.x,this.nextNeighbor(e,i))}else{this.setSelection(this.$selection.start.x,0)}};s.prototype.isCellTop=function(e,t){if(t===0)return true;return this.getElementAt(e,t-1)!==this.getElementAt(e,t)};s.prototype.isCellBottom=function(e,t){if(t===this.$heading.length-1)return true;return this.getElementAt(e,t+1)!==this.getElementAt(e,t)};s.prototype.onUp=function(){if(this.$selection.start.y>0){if(this.prevNeighbor(this.$selection.start.x,this.$selection.start.y)!==-1){this.setSelection(this.$selection.start.x,this.$selection.start.y-(this.$selection.start.y-this.prevNeighbor(this.$selection.start.x,this.$selection.start.y)))}}};s.prototype.onDown=function(){if(this.$selection.start.y<this.$heading.length-1){if(this.nextNeighbor(this.$selection.start.x,this.$selection.start.y)!==-1){this.setSelection(this.$selection.start.x,this.$selection.start.y+(this.nextNeighbor(this.$selection.start.x,this.$selection.start.y)-this.$selection.start.y))}}};s.prototype.onLeft=function(){if(this.$selection.start.x>0){this.setSelection(this.$selection.start.x-1,this.$selection.start.y)}};s.prototype.onRight=function(){var e=this.$heading,t=e.axis,i=this.$selection,r=e.getColumnSizesAtNode(e.findNodeByIndex(i.start.y)).length;if(i.start.x<r-1){this.setSelection(i.start.x+1,i.start.y)}};s.prototype.setSelection=function(e,t,i){var r={x:e,y:t};if(!i||i&&!this.$selection.start&&!this.$selection.end){this.$selection.start=r;this.$selection.end=r}else if(i&&this.$selection.start&&r.x===this.$selection.start.x){this.$selection.end=r}this._emit("selectionChanged")};s.prototype.hasParent=function(e){return e>0};s.prototype.nextNeighbor=function(e,t){var i=this.$heading.provider.getNextNeighbor(this.$heading.axis,e,t);return!a.isUndefined(i)?i.y:-1};s.prototype.prevNeighbor=function(e,t){var i=this.$heading.provider.getPreviousNeighbor(this.$heading.axis,e,t,-1);return!a.isUndefined(i)?i.y:-1};s.prototype.clear=function(){this.$selection={start:null,end:null}};s.prototype.getSelection=function(){return this.$selection};i.CaretSelection=s},{"../../lib/event_emitter":120,"../../lib/oop":124,assert:2,lodash:70}],114:[function(e,t,i){"use strict";function r(e){this.heading=e;this.isVertical=e.isVertical;this.getCellElement=function(e,t){var i=this.heading.element.querySelector("[data-col='"+e+"'][data-relRow='"+t+"']");if(e>0&&!i){this.heading.caretSelection.setSelection(0,t)}else{return i}};this.getHeadingElement=function(e){return this.getCellElement(e.x,e.y)};this.getCellPixelPosition=function(e){var t=this.heading.findOffsetAtIndex(this.heading.offset),i=this.heading.findOffsetAtIndex(e.y),r=i-t;return{startPixel:r,endPixel:r+this.heading.findNodeByIndex(e.y).size}};this.scrollTo=function(e){var t=this.getCellPixelPosition(e),i=0;if(t.startPixel<=0){i=t.startPixel-this.heading.renderer.layerConfig[this.isVertical?"vOffset":"hOffset"]}else if(t.endPixel>this.heading.renderer.layerConfig[this.isVertical?"height":"width"]){i=t.endPixel-this.heading.renderer.layerConfig[this.isVertical?"height":"width"]}if(i){if(this.isVertical)this.heading.renderer.scrollBy(0,i);else this.heading.renderer.scrollBy(i,0)}};this.renderCaret=function(e){var t=this.heading.getCaret(),i=t.parentNode.getBoundingClientRect(),r=this.getCellElement(e.x,e.y),n=this.getCellElement(e.x,e.y),o=r?r.getBoundingClientRect():false,a=n?n.getBoundingClientRect():false,s=this.heading.renderer.container.querySelector(".pivot_caret");if(s){s.style.display="none"}t.style.left=o.left-i.left+"px";t.style.top=o.top-i.top+"px";t.style.display="block";t.style.width=a.left-o.left+a.width+"px";t.style.height=a.top-o.top+a.height+"px"};this.hideCaret=function(){var e=this.heading.getCaret();e.style.display="none"}}t.exports=r},{}],115:[function(e,t,i){var r=e("lodash");function n(){this.list=[];this.list.size=0;this.defaultRanges=[];this.numberOfNodes=0}n.prototype={get length(){return this.numberOfNodes},get size(){return this.list.size},initialize:function(e,t,i){var n=e-1,o=0,a={size:0};this.list=i;this.defaultRanges=t;this.numberOfNodes=e;this.repeatedRangesCt=this.defaultRanges.filter(function(e){return!r.isUndefined(e.repeatDistance)}).length;if(e){o=this.findOffsetAtIndex(n);a=this.findNodeByIndex(n)}this.list.size=o+a.size},getRange:function(e,t){var i=this.findNodeAtOffset(e),r=e,n=i.index,o=[],a=this.numberOfNodes-1;if(this.numberOfNodes){o.index=n;o.offset=this.findOffsetAtIndex(n);o.push(i);while(n<a&&r<t){i=this.findNodeByIndex(++n);r+=i.size;o.push(i)}}return o},findNodeAtOffset:function(e){var t=this.list.length,i=this.defaultRanges[this.defaultRanges.length-1],r;if(e<=0){r=t&&this.list[0].index===0&&this.list[0]||{index:0,size:this.defaultRanges[0].size}}else if(e>=this.list.size){r=t&&this.list[t-1].index>=i.range[1]&&this.list[t-1]||{index:i.range[1],size:i.size}}else{r=this.findNodeByCorrectOffset(e,0,this.numberOfNodes)}return r},findRangeIndexes:function(e){var t=0,i=this.defaultRanges,n=this.list,o=i.length,a=this.list.length,s,l,u,c=0,d,p,f;for(s=0,l=0;s<o;s++){f=i[s];c=f.range[0];d=f.range[1]+1;p=f.size;t+=p*(d-c);for(;l<a;l++){u=n[l];if(r.inRange(u.index,c,d)){t+=u.size-p}else{break}}if(t>e){return{start:f.range[0],end:f.range[1]}}}},findNodeByCorrectOffset:function(e,t,i){var r,n,o;while(t<=i){n=(t+i)/2|0;r=this.findOffsetAtIndex(n);if(e>r){o=this.findNodeByIndex(n);if(e<=r+o.size){return o}else{t=n+1}}else i=n-1}},findNodeByIndex:function(e){return this.getNonDefaultNodeByIndex(e,0,this.list.length-1)||this.getDefaultNodeByIndex(e)},getNonDefaultNodeByIndex:function(e,t,i){var r,n,o=this.list,a;while(t<=i){r=(t+i)/2|0;a=o[r];n=a.index;if(n===e){return a}if(n>e){i=r-1}else{t=r+1}}},getDefaultNodeByIndex:function(e){var t=0,i=this.defaultRanges,r,n=i.length;for(;t<n;t++){r=i[t];if(this.isIndexInRange(e,r)){return{index:e,size:r.size}}}},findOffsetAtIndex:function(e){var t=r.filter(this.defaultRanges,function(t){return t.range[0]<e}),i=this;return t.reduce(function(t,r){return t+i.computeRangeSizeUntilIndex(r,e)},0)},computeRangeSizeUntilIndex:function(e,t){var i=e.range[0],r=this.getRowCtInRange(e,i,t),n=this.getNonDefaultNodesInRange(e,i,t),o=n.reduce(function(e,t){return e+t.size},0);
return o+e.size*(r-n.length)},getNonDefaultNodesInRange:function(e,t,i){var r=e.range[0],n=e.range[1],o=e.repeatDistance||n-r,a=e.rowCount,s=Math.max(r,t),l=Math.min(e.range[1]+1,i),u=this.list,c=0,d=u.length,p,f,h=[],g,m,v;for(;c<d;c++){p=u[c];f=p.index;if(s<=f&&f<l){g=f-r;m=Math.floor(g/o);m=Number.isFinite(m)?m:0;v=o*m;if(g<v+a)h.push(p)}else if(l<=f){break}}return h},getRowCtInRange:function(e,t,i){var r=e.range[0],n=e.rowCount,o=e.range[1],a=e.repeatDistance||o-r,s=Math.max(e.range[0],t),l=s-r,u=Math.floor(l/a),c=Number.isFinite(u)?u:0,d=a*c,p=d+(n===a/this.repeatedRangesCt?n:n-1),f=Math.max(p-l,0),h=Math.min(e.range[1]+1,i),g=h-r,m=Math.floor(g/a),v=Number.isFinite(m)?m:0,y=a*v,b=Math.min(g-y,n,g-l),w=Math.max(v-c-1,0),C=v===c?b:w*n+f+b;return C},isIndexInRange:function(e,t){var i=r.inRange(e,t.range[0],t.range[1]+1),n=t.range[1]-t.range[0]+1,o=t.rowCount,a=t.range[0],s=0,l=a+s,u=t.repeatDistance||n,c=false;if(i){while(!c&&s<n){l=a+s;c=r.inRange(e,l,l+o);s+=u}}return c}};t.exports=n},{lodash:70}],116:[function(e,t,i){"use strict";var r=e("assert");var n=e("../lib/dom");var o=e("lodash");var a="<div class='pivot_caret' style='{0}'<span></span></div>";var s=function(e,t){var i=this;this.element=n.createElement("div");this.element.className="pivot_layer pivot_selection-layer";this.element.style.display="none";e.appendChild(this.element);this.renderer=t;this.$isVisible=false;this.$displaySelection=o.debounce(function(){i.element.style.display=i.$isVisible?"block":"none"},100)};(function(){this.setDataProvider=function(e){this.provider=e};this.renderSelection=function(e,t,i){var r=e.vRange;var n=e.hRange;var o=t.start;var a=t.end;var s=Math.min(o.row,a.row)-e.firstRow;var l=Math.min(e.lastRow,Math.max(o.row,a.row))-e.firstRow+1;var u=Math.min(o.column,a.column)-e.firstCol;var c=Math.min(e.lastCol,Math.max(o.column,a.column))-e.firstCol+1;if(l-s<1&&c-u<1||l-s<1||c-u<1)return;var d,p,f,h,g;d=0,h=1;for(g=0;g<s;g++)d+=r[g].size;for(g=Math.max(0,s);g<l;g++)h+=r[g].size;p=0,f=1;for(g=0;g<u;g++)p+=n[g].size;for(g=Math.max(0,u);g<c;g++)f+=n[g].size;i.push("<div class='pivot_selection_range' style='left:"+p+"px;top:"+d+"px;width:"+f+"px;height:"+h+"px;'></div>")};this.renderCaret=function(e,t,i){var r=t.row-e.firstRow,n=t.column-e.firstCol;if(r<0||n<0||t.row>e.lastRow||t.column>e.lastCol){return}var s=e.vRange,l=e.hRange,u=t.row===e.lastRow,c=t.column===e.lastCol,d=t.row===0,p=t.column===0,f=o.reduce(s.slice(0,r),function(e,t){return e+t.size},0),h=o.reduce(l.slice(0,n),function(e,t){return e+t.size},0),g=l[n].size,m=s[r]?s[r].size:0,v={top:f+"px",left:h+"px",height:m+(u?1:0)+"px",width:g+(c?1:0)+"px","margin-top":d?null:"-0.5px","margin-left":p?null:"-0.5px",display:this.renderer.hHeadingCaret||this.renderer.vHeadingCaret?"none":null},y=o.reduce(v,function(e,t,i){return e+(t!==null?i+":"+t+";":"")},""),b=a.replace("{0}",y);i.push(b)};this.update=function(e){this.config=e;var t=[this.provider.selection.getRange()];var i=this.provider.selection.getCaret();var r=[];for(var o=0,a=t.length;o<a;o++){this.renderSelection(e,t[o],r)}this.renderCaret(e,i,r);this.element=n.setInnerHtml(this.element,r.join(""))};this.destroy=function(){clearInterval(this.intervalId);clearTimeout(this.timeoutId)};this.hide=function(){this.$isVisible=false;this.$displaySelection()};this.show=function(){this.$isVisible=true;this.$displaySelection()}}).call(s.prototype);i.Selection=s},{"../lib/dom":117,assert:2,lodash:70}],117:[function(e,t,i){"use strict";var r="http://www.w3.org/1999/xhtml";i.getDocumentHead=function(e){if(!e)e=document;return e.head||e.getElementsByTagName("head")[0]||e.documentElement};i.createElement=function(e,t){return document.createElementNS?document.createElementNS(t||r,e):document.createElement(e)};i.hasCssClass=function(e,t){if(!e||!e.className||!e.className.split)return false;var i=e.className.split(/\s+/g);return i.indexOf(t)!==-1};i.addCssClass=function(e,t){if(!i.hasCssClass(e,t)){e.className+=" "+t}};i.removeCssClass=function(e,t){var i=e.className.split(/\s+/g);while(true){var r=i.indexOf(t);if(r==-1){break}i.splice(r,1)}e.className=i.join(" ")};i.toggleCssClass=function(e,t){var i=e.className.split(/\s+/g),r=true;while(true){var n=i.indexOf(t);if(n==-1){break}r=false;i.splice(n,1)}if(r)i.push(t);e.className=i.join(" ");return r};i.setCssClass=function(e,t,r){if(r){i.addCssClass(e,t)}else{i.removeCssClass(e,t)}};i.hasCssString=function(e,t){var i=0,r;t=t||document;if(t.createStyleSheet&&(r=t.styleSheets)){while(i<r.length)if(r[i++].owningElement.id===e)return true}else if(r=t.getElementsByTagName("style")){while(i<r.length)if(r[i++].id===e)return true}return false};i.importCssString=function e(t,n,o){o=o||document;if(n)n="style_"+n;if(n&&i.hasCssString(n,o))return null;var a;if(o.createStyleSheet){a=o.createStyleSheet();a.cssText=t;if(n)a.owningElement.id=n}else{a=o.createElementNS?o.createElementNS(r,"style"):o.createElement("style");a.appendChild(o.createTextNode(t));if(n)a.id=n;i.getDocumentHead(o).appendChild(a)}};i.importCssStylsheet=function(e,t){if(t.createStyleSheet){t.createStyleSheet(e)}else{var r=i.createElement("link");r.rel="stylesheet";r.href=e;i.getDocumentHead(t).appendChild(r)}};i.getInnerWidth=function(e){return parseInt(i.computedStyle(e,"paddingLeft"),10)+parseInt(i.computedStyle(e,"paddingRight"),10)+e.clientWidth};i.getInnerHeight=function(e){return parseInt(i.computedStyle(e,"paddingTop"),10)+parseInt(i.computedStyle(e,"paddingBottom"),10)+e.clientHeight};if(window.pageYOffset!==undefined){i.getPageScrollTop=function(){return window.pageYOffset};i.getPageScrollLeft=function(){return window.pageXOffset}}else{i.getPageScrollTop=function(){return document.body.scrollTop};i.getPageScrollLeft=function(){return document.body.scrollLeft}}if(window.getComputedStyle)i.computedStyle=function(e,t){if(t)return(window.getComputedStyle(e,"")||{})[t]||"";return window.getComputedStyle(e,"")||{}};else i.computedStyle=function(e,t){if(t)return e.currentStyle[t];return e.currentStyle};i.scrollbarWidth=function(e){var t=i.createElement("ace_inner");t.style.width="100%";t.style.minWidth="0px";t.style.height="200px";t.style.display="block";var r=i.createElement("ace_outer");var n=r.style;n.position="absolute";n.left="-10000px";n.overflow="hidden";n.width="200px";n.minWidth="0px";n.height="150px";n.display="block";r.appendChild(t);var o=e.documentElement;o.appendChild(r);var a=t.offsetWidth;n.overflow="scroll";var s=t.offsetWidth;if(a==s){s=r.clientWidth}o.removeChild(r);return a-s};i.setInnerHtml=function(e,t){var i=e.cloneNode(false);i.innerHTML=t;e.parentNode.replaceChild(i,e);return i};if("textContent"in document.documentElement){i.setInnerText=function(e,t){e.textContent=t};i.getInnerText=function(e){return e.textContent}}else{i.setInnerText=function(e,t){e.innerText=t};i.getInnerText=function(e){return e.innerText}}i.getParentWindow=function(e){return e.defaultView||e.parentWindow};i.remove=function(e){var t=e&&e.parentNode;t&&t.removeChild(e)};i.findFirstParentWithClass=function(e,t){var r=e;while(r.parentNode){r=r.parentNode;if(r!==document&&i.hasCssClass(r,t)){return r}}return undefined};i.findParentWithClass=function(e,t){while(e){if(i.hasCssClass(e,t)){return e.$dragTarget||e}e=e.parentElement}}},{}],118:[function(e,t,i){"use strict";var r=e("lodash");var n=e("./dom");var o=e("assert");var a=e("./event");var s={ESC:27,DOWN:40,UP:38,ENTER:13,BACK_SPACE:8,DELETE:46,LEFT:37,RIGHT:39,TAB:9};var l=function(e,t){this._config=e||{};this._container=t;this._activeOption=null;this._options=[];this._isOpen=false;this._disableSearch=false;this._init()};l.renderStaticView=function(e){var t=['<div class="pt-dropdown display-dropdown noselect">','<div class="pt-dropdown-toggle">','<div class="pt-dropdown-toggle-content">','<div class="pt-dropdown-display">',e,"</div>","</div>","</div>","</div>",'<div class="pt-dropdown-toggle-arrow-cover">','<div class="pt-dropdown-toggle-arrow"></div>',"</div>"];return t.join("")};l.getOptionLabelById=function(e,t){return r.result(r.findWhere(e,{id:t}),"label")};l.prototype={constructor:l,_init:function(){this.render();this.attachListeners()},_renderers:{wrapper:function(){var e=document.createElement("div");e.className="pt-dropdown-cont";return e},dropdown:function(){var e=document.createElement("div");e.className="pt-dropdown noselect";return e},toggle:function(){var e=document.createElement("div");e.className="pt-dropdown-toggle";return e},toggleContent:function(){var e=document.createElement("div");e.className="pt-dropdown-toggle-content";return e},toggleElements:function(){var e=document.createElement("div");e.className="pt-dropdown-toggle-elements";return e},toggleArrow:function(){var e=document.createElement("div");e.className="pt-dropdown-toggle-arrow-cover";var t=document.createElement("div");t.className="pt-dropdown-toggle-arrow";e.appendChild(t);return e},selection:function(e){var t=document.createElement("div");t.className="pt-dropdown-display";return t},search:function(){var e=document.createElement("input");e.type="text";e.autocomplete="off";return e},itemsWrapper:function(){var e=document.createElement("div");e.className="pt-dropdown-items";return e},itemsContent:function(){var e=document.createElement("div");e.className="pt-dropdown-items-content";return e},noItems:function(){var e=document.createElement("div");e.className="pt-dropdown-noItems disabled";e.textContent="No matching items";return e}},render:function(){this._wrapperEl=this._renderers.wrapper();this._dropdownEl=this._renderers.dropdown();this._toggleEl=this._renderers.toggle();this._toggleContentEl=this._renderers.toggleContent();this._toggleElementsEl=this._renderers.toggleElements();this._selectionEl=this._renderers.selection();this._searchEl=this._renderers.search();this._itemsWrapperEl=this._renderers.itemsWrapper();this._itemsContentEl=this._renderers.itemsContent();this._itemsWrapperEl.appendChild(this._itemsContentEl);this._toggleElementsEl.appendChild(this._selectionEl);this._toggleElementsEl.appendChild(this._searchEl);this._toggleContentEl.appendChild(this._toggleElementsEl);this._toggleEl.appendChild(this._toggleContentEl);this._dropdownEl.appendChild(this._toggleEl);this._dropdownEl.appendChild(this._itemsWrapperEl);this._wrapperEl.appendChild(this._dropdownEl);this._wrapperEl.appendChild(this._renderers.toggleArrow())},_renderItems:function(e){var t=this,i=this._renderers.itemsContent(),r;this._activeOptionElement=null;e.forEach(function(e){r=t._renderItem(e);i.appendChild(r);if(t._activeOption&&t._activeOption.id===e.id){r.className="pt-option active selected";t._activeOptionElement=r}});if(!e.length){i.appendChild(this._renderers.noItems())}this._itemsWrapperEl.replaceChild(i,this._itemsContentEl);this._itemsContentEl=i},_renderItem:function(e){var t=document.createElement("div");t.className="pt-option";t.textContent=e.label;t.setAttribute("data-value",e.id);t.addEventListener("mouseenter",this.onOptionHover.bind(this));return t},asHTMLElement:function(){return this._wrapperEl},open:function(e){if(this._isOpen)return;this._searchEl.value=this._activeOption&&this._activeOption.label?this._activeOption.label:"";this._searchEl.select();this._isOpen=true;this._disableSearch=!!e;this._dropdownEl.className="pt-dropdown open";if(this._config.onOpen&&typeof this._config.onOpen==="function"){this._config.onOpen()}this.resetPosition();if(this._container.getBoundingClientRect().bottom<this._itemsWrapperEl.getBoundingClientRect().bottom){this.invertPosition()}else{this.resetPosition()}if(this._activeOptionElement)this.scrollToOption(this._activeOptionElement,true)},close:function(){this._isOpen=false;this._dropdownEl.className="pt-dropdown";this._searchEl.style.width="4px";if(this._config.onClose&&typeof this._config.onClose==="function"){this._config.onClose()}},toggle:function(){this._isOpen?this.close():this.open()},attachListeners:function(){this._itemsWrapperEl.addEventListener("mousewheel",this.onMouseWheel.bind(this));this._itemsWrapperEl.addEventListener("mousedown",this.onOptionSelect.bind(this));this._searchEl.addEventListener("focus",this.onFocus.bind(this));this._searchEl.addEventListener("blur",this.onBlur.bind(this));a.addCommandKeyListener(this._searchEl,this.onKeyDown.bind(this));this._searchEl.addEventListener("keyup",this.onKeyUp.bind(this))},refresh:function(){var e=this._searchEl.value.toLowerCase(),t=this._options.filter(function(t){o(!r.isUndefined(t.label),"Option with id: "+t.id+" has no label");return t.label.toLowerCase().indexOf(e)!==-1});this._searchResults=t;this.activateFilterableState();this._renderItems(t);if(this._itemsContentEl&&this._itemsContentEl.firstChild&&!this._activeOptionElement&&!n.hasCssClass(this._itemsContentEl.firstChild,"disabled")){this._activeOptionElement=this._itemsContentEl.firstChild;this.highlightOption(this._itemsContentEl.firstChild)}if(n.hasCssClass(this._itemsWrapperEl,"pt-dropdown-inverted")){this.invertPosition()}else{this.resetPosition()}},focus:function(){var e=this._searchEl.value.length;this._searchEl.focus();if(this._activeOption){this._searchEl.setSelectionRange(0,e)}},clear:function(){this._searchEl.value="";this._activeOption=undefined},update:function(e,t){this.clear();if(e){this._activeOption=e}this._options=t||this._options;this.refresh()},setActiveOption:function(e,t){this._activeOption=e;if(this._config.onChange&&typeof this._config.onChange==="function"){this._config.onChange(e,t)}},scrollToOption:function(e,t){if(!t){var i=e.getBoundingClientRect().bottom,r=this._itemsWrapperEl.getBoundingClientRect().bottom,n=e.getBoundingClientRect().top,o=this._itemsWrapperEl.getBoundingClientRect().top;if(r<i){this._itemsWrapperEl.scrollTop+=i-r}if(n<o){this._itemsWrapperEl.scrollTop-=o-n}}else{this._itemsWrapperEl.scrollTop=e.offsetTop-e.offsetHeight}},highlightOption:function(e){if(this._activeOptionElement){n.removeCssClass(this._activeOptionElement,"active")}this._activeOptionElement=e;n.addCssClass(this._activeOptionElement,"active")},highlightNextOption:function(){var e=this._activeOptionElement&&this._activeOptionElement.nextSibling||this._itemsContentEl.firstChild;this.scrollToOption(e);this.highlightOption(e)},highlightPreviousOption:function(){var e=this._activeOptionElement&&this._activeOptionElement.previousSibling||this._itemsContentEl.lastChild;this.scrollToOption(e);this.highlightOption(e)},getValue:function(){return this._activeOption},deleteSelection:function(){if(this._selectionEl.textContent||this._activeOption){this._activeOption="";this.activateFilterableState()}},activateFilterableState:function(){this._searchEl.style.width="90%"},search:function(e){this.deleteSelection();this._searchEl.value=e;this.refresh()},onFocus:function(e){this.open()},onBlur:function(e){if(this._itemsWrapperEl===document.activeElement){this._searchEl.focus()}else{this.close()}},onKeyDown:function(e){switch(e.keyCode){case s.ESC:this.close();e.preventDefault();break;case s.DOWN:this.highlightNextOption();this._disableSearch=true;e.preventDefault();break;case s.UP:this.highlightPreviousOption();this._disableSearch=true;e.preventDefault();break;case s.TAB:case s.ENTER:if(this._activeOptionElement){this.onOptionSelect(e,this._activeOptionElement)}e.preventDefault();break;case s.BACK_SPACE:case s.DELETE:this.deleteSelection();break;default:this.onKeyUp(e);break}},onKeyUp:function(e){if(this._disableSearch){this._disableSearch=false;return e&&e.preventDefault()}else{this.refresh()}},onOptionSelect:function(e,t){t=t||e.target;var i=t.getAttribute("data-value");if(!i){e.stopPropagation();return}this.setActiveOption(i,e)},onOptionHover:function(e){this.highlightOption(e.target)},resetPosition:function(){n.removeCssClass(this._itemsWrapperEl,"pt-dropdown-inverted");delete this._itemsWrapperEl.style.bottom},invertPosition:function(){n.addCssClass(this._itemsWrapperEl,"pt-dropdown-inverted");this._itemsWrapperEl.style.bottom=this._itemsWrapperEl.getBoundingClientRect().height+this._toggleEl.getBoundingClientRect().height+"px"},onMouseWheel:function(e){e.stopPropagation()}};t.exports=l},{"./dom":117,"./event":119,assert:2,lodash:70}],119:[function(e,t,i){"use strict";var r=e("./keys");var n=e("./useragent");var o=e("./dom");i.addListener=function(e,t,i){if(e.addEventListener){return e.addEventListener(t,i,false)}if(e.attachEvent){var r=function(){i(window.event)};i._wrapper=r;e.attachEvent("on"+t,r)}};i.removeListener=function(e,t,i){if(e.removeEventListener){return e.removeEventListener(t,i,false)}if(e.detachEvent){e.detachEvent("on"+t,i._wrapper||i)}};i.stopEvent=function(e){i.stopPropagation(e);i.preventDefault(e);return false};i.stopPropagation=function(e){if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true};i.preventDefault=function(e){if(e.preventDefault)e.preventDefault();else e.returnValue=false};i.getButton=function(e){if(e.type=="dblclick")return 0;if(e.type=="contextmenu"||e.ctrlKey&&n.isMac)return 2;if(e.preventDefault){return e.button}else{return{1:0,2:2,4:1}[e.button]}};i.capture=function(e,t,i){function r(e){t&&t(e);i&&i(e);document.removeEventListener("mousemove",t,true);document.removeEventListener("mouseup",r,true)}document.addEventListener("mousemove",t,true);document.addEventListener("mouseup",r,true)};i.addMouseWheelListener=function(e,t){var r=8;var n=function(e){if(e.wheelDelta!==undefined){if(e.wheelDeltaX!==undefined){e.wheelX=-e.wheelDeltaX/r;e.wheelY=-e.wheelDeltaY/r}else{e.wheelX=0;e.wheelY=-e.wheelDelta/r}}else{if(e.axis&&e.axis==e.HORIZONTAL_AXIS){e.wheelX=(e.detail||0)*5;e.wheelY=0}else{e.wheelX=0;e.wheelY=(e.detail||0)*5}}t(e)};i.addListener(e,"DOMMouseScroll",n);i.addListener(e,"mousewheel",n)};i.addMultiMouseDownListener=function(e,t,r,o){var a=0;var s,l,u;var c={2:"dblclick",3:"tripleclick",4:"quadclick"};i.addListener(e,"mousedown",function(e){if(i.getButton(e)!=0){a=0}else{var n=Math.abs(e.clientX-s)>5||Math.abs(e.clientY-l)>5;if(!u||n)a=0;a+=1;if(u)clearTimeout(u);u=setTimeout(function(){u=null},t[a-1]||600)}if(a==1){s=e.clientX;l=e.clientY}r[o]("mousedown",e);if(a>4)a=0;else if(a>1)return r[o](c[a],e)});if(n.isOldIE){i.addListener(e,"dblclick",function(e){a=2;if(u)clearTimeout(u);u=setTimeout(function(){u=null},t[a-1]||600);r[o]("mousedown",e);r[o](c[a],e)})}};function a(e,t,i){var o=0;if(n.isOpera&&!("KeyboardEvent"in window)&&n.isMac){o=0|(t.metaKey?1:0)|(t.altKey?2:0)|(t.shiftKey?4:0)|(t.ctrlKey?8:0)}else{o=0|(t.ctrlKey?1:0)|(t.altKey?2:0)|(t.shiftKey?4:0)|(t.metaKey?8:0)}if(i in r.MODIFIER_KEYS){switch(r.MODIFIER_KEYS[i]){case"Alt":o=2;break;case"Shift":o=4;break;case"Ctrl":o=1;break;default:o=8;break}i=0}if(o&8&&(i==91||i==93)){i=0}if(!o&&!(i in r.FUNCTION_KEYS)&&!(i in r.PRINTABLE_KEYS)){return false}return e(t,o,i)}i.addCommandKeyListener=function(e,t){var r=i.addListener;if(n.isOldGecko||n.isOpera&&!("KeyboardEvent"in window)){var o=null;r(e,"keydown",function(e){o=e.keyCode});r(e,"keypress",function(e){return a(t,e,o)})}else{var s=null;r(e,"keydown",function(e){s=e.keyIdentifier||e.keyCode;return a(t,e,e.keyCode)})}};if(window.postMessage&&!n.isOldIE){var s=1;i.nextTick=function(e,t){t=t||window;var r="zero-timeout-message-"+s;i.addListener(t,"message",function n(o){if(o.data==r){i.stopPropagation(o);i.removeListener(t,"message",n);e()}});t.postMessage(r,"*")}}i.nextFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;if(i.nextFrame)i.nextFrame=i.nextFrame.bind(window);else i.nextFrame=function(e){setTimeout(e,17)}},{"./dom":117,"./keys":121,"./useragent":125}],120:[function(e,t,i){"use strict";var r={};var n=function(){this.propagationStopped=true};var o=function(){this.defaultPrevented=true};r._emit=r._dispatchEvent=function(e,t){this._eventRegistry||(this._eventRegistry={});this._defaultHandlers||(this._defaultHandlers={});var i=this._eventRegistry[e]||[];var r=this._defaultHandlers[e];if(!i.length&&!r)return;if(typeof t!="object"||!t)t={};if(!t.type)t.type=e;if(!t.stopPropagation)t.stopPropagation=n;if(!t.preventDefault)t.preventDefault=o;for(var a=0;a<i.length;a++){i[a](t,this);if(t.propagationStopped)break}if(r&&!t.defaultPrevented)return r(t,this)};r._signal=function(e,t){var i=(this._eventRegistry||{})[e];if(!i)return;for(var r=0;r<i.length;r++)i[r](t,this)};r.once=function(e,t){var i=this;t&&this.addEventListener(e,function r(){i.removeEventListener(e,r);t.apply(null,arguments)})};r.setDefaultHandler=function(e,t){this._defaultHandlers=this._defaultHandlers||{};if(this._defaultHandlers[e])throw new Error("The default handler for '"+e+"' is already set");this._defaultHandlers[e]=t};r.on=r.addEventListener=function(e,t,i){this._eventRegistry=this._eventRegistry||{};var r=this._eventRegistry[e];if(!r)r=this._eventRegistry[e]=[];if(r.indexOf(t)==-1)r[i?"unshift":"push"](t);return t};r.off=r.removeListener=r.removeEventListener=function(e,t){this._eventRegistry=this._eventRegistry||{};var i=this._eventRegistry[e];if(!i)return;var r=i.indexOf(t);if(r!==-1)i.splice(r,1)};r.removeAllListeners=function(e){if(this._eventRegistry)this._eventRegistry[e]=[]};i.EventEmitter=r},{}],121:[function(e,t,i){"use strict";var r=e("./oop");var n=function(){var e={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,meta:8,command:8,cmd:8},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}};for(var t in e.FUNCTION_KEYS){var i=e.FUNCTION_KEYS[t].toLowerCase();e[i]=parseInt(t,10)}r.mixin(e,e.MODIFIER_KEYS);r.mixin(e,e.PRINTABLE_KEYS);r.mixin(e,e.FUNCTION_KEYS);e.enter=e["return"];e.escape=e.esc;e.del=e["delete"];e[173]="-";return e}();r.mixin(i,n);i.keyCodeToString=function(e){return(n[e]||String.fromCharCode(e)).toLowerCase()}},{"./oop":124}],122:[function(e,t,i){"use strict";i.stringReverse=function(e){return e.split("").reverse().join("")};i.stringRepeat=function(e,t){var i="";while(t>0){if(t&1)i+=e;if(t>>=1)e+=e}return i};var r=/^\s\s*/;var n=/\s\s*$/;i.stringTrimLeft=function(e){return e.replace(r,"")};i.stringTrimRight=function(e){return e.replace(n,"")};i.copyObject=function(e){var t={};for(var i in e){t[i]=e[i]}return t};i.copyArray=function(e){var t=[];for(var i=0,r=e.length;i<r;i++){if(e[i]&&typeof e[i]=="object")t[i]=this.copyObject(e[i]);else t[i]=e[i]}return t};i.deepCopy=function(e){if(typeof e!="object"){return e}var t=e.constructor();for(var i in e){if(typeof e[i]=="object"){t[i]=this.deepCopy(e[i])}else{t[i]=e[i]}}return t};i.arrayToMap=function(e){var t={};for(var i=0;i<e.length;i++){t[e[i]]=1}return t};i.createMap=function(e){var t=Object.create(null);for(var i in e){t[i]=e[i]}return t};i.arrayRemove=function(e,t){for(var i=0;i<=e.length;i++){if(t===e[i]){e.splice(i,1)}}};i.escapeRegExp=function(e){return e.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")};i.escapeHTML=function(e){return e.replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")};i.getMatchOffsets=function(e,t){var i=[];e.replace(t,function(e){i.push({offset:arguments[arguments.length-2],length:e.length})});return i};i.deferredCall=function(e){var t=null;var i=function(){t=null;e()};var r=function(e){r.cancel();t=setTimeout(i,e||0);return r};r.schedule=r;r.call=function(){this.cancel();e();return r};r.cancel=function(){clearTimeout(t);t=null;return r};return r};i.delayedCall=function(e,t){var i=null;var r=function(){i=null;e()};var n=function(e){i&&clearTimeout(i);i=setTimeout(r,e||t)};n.delay=n;n.schedule=function(e){if(i==null)i=setTimeout(r,e||0)};n.call=function(){this.cancel();e()};n.cancel=function(){i&&clearTimeout(i);i=null};n.isPending=function(){return i};return n}},{}],123:[function(e,t,i){"use strict";var r=e("./dom");i.get=function(e,t){var i=new XMLHttpRequest;i.open("GET",e,true);i.onreadystatechange=function(){if(i.readyState===4){t(i.responseText)}};i.send(null)};i.loadScript=function(e,t){var i=r.getDocumentHead();var n=document.createElement("script");n.src=e;i.appendChild(n);n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||n.readyState=="loaded"||n.readyState=="complete"){n=n.onload=n.onreadystatechange=null;if(!i)t()}}}},{"./dom":117}],124:[function(e,t,i){"use strict";i.inherits=function(){var e=function(){};return function(t,i){e.prototype=i.prototype;t.super_=i.prototype;t.prototype=new e;t.prototype.constructor=t}}();i.mixin=function(e,t){for(var i in t){e[i]=t[i]}return e};i.implement=function(e,t){i.mixin(e,t)}},{}],125:[function(e,t,i){"use strict";i.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"};i.getOS=function(){if(i.isMac){return i.OS.MAC}else if(i.isLinux){return i.OS.LINUX}else{return i.OS.WINDOWS}};var r=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase();var n=navigator.userAgent;i.isWin=r=="win";i.isMac=r=="mac";i.isLinux=r=="linux";i.isIE=(navigator.appName=="Microsoft Internet Explorer"||navigator.appName.indexOf("MSAppHost")>=0)&&parseFloat(navigator.userAgent.match(/MSIE ([0-9]+[\.0-9]+)/)[1]);i.isOldIE=i.isIE&&i.isIE<9;i.isGecko=i.isMozilla=window.controllers&&window.navigator.product==="Gecko";i.isOldGecko=i.isGecko&&parseInt((navigator.userAgent.match(/rv\:(\d+)/)||[])[1],10)<4;i.isOpera=window.opera&&Object.prototype.toString.call(window.opera)=="[object Opera]";i.isWebKit=parseFloat(n.split("WebKit/")[1])||undefined;i.isChrome=parseFloat(n.split(" Chrome/")[1])||undefined;i.isAIR=n.indexOf("AdobeAIR")>=0;i.isIPad=n.indexOf("iPad")>=0;i.isTouchPad=n.indexOf("TouchPad")>=0},{}],126:[function(e,t,i){"use strict";var r=e("lodash");var n=e("./utils");var o=e("./lib/dom");function a(e,t,i,n,o){this.element=document.createElement("div");this.element.className="modal-content link-box";this.body=document.createElement("div");this.body.className="form-inline link-box-form";this.urlLabel=document.createElement("a");this.urlLabel.className="link-box-url";this.urlLabel.target="_blank";this.urlLabel.rel="noreferrer";this.body.appendChild(this.urlLabel);if(!o){this.editButton=document.createElement("button");this.editButton.className="btn btn-default link-box-edit-btn";this.editButton.innerHTML="Edit";this.editButton.id="link_edit_button";this.body.appendChild(this.editButton);this.editClick=function(e){e.preventDefault();this.editClickFn()};this.editButton.addEventListener("click",this.editClick.bind(this));this.editClickFn=i}this.element.appendChild(this.body);this.isOpen=false;this.link=e;this.position=t;this.onCloseFn=n;this.keypress=function(e){if(r.includes([9,13,37,38,39,40,46],e.keyCode)){this.close()}};this.bindClose=this.close.bind(this);this.bindKeypress=this.keypress.bind(this)}a.prototype.open=function(){this.isOpen=true;this.urlLabel.innerHTML=this.link;this.urlLabel.href=this.link;this.element.style.display="block";this.element.style.top=this.position.top+"px";this.element.style.left=this.position.left+"px";if(this.editButton){this.editButton.style.display="inline-block"}if(this.position.left+this.element.offsetWidth+32>window.innerWidth-this.position.left)this.element.style.left=this.position.left-(32+(this.position.left+this.element.offsetWidth-(window.innerWidth-this.position.left))/2)+"px";document.body.addEventListener("click",this.bindClose,true);document.body.addEventListener("keydown",this.bindKeypress,true)};a.prototype.close=function(e){this.hide();if(!e||e.target.id!=="link_edit_button")this.onCloseFn()};a.prototype.hide=function(){document.body.removeEventListener("click",this.bindClose,true);document.body.removeEventListener("keydown",this.bindKeypress,true);this.element.style.display="none";this.isOpen=false};i.mkLinkBox=function(e,t,i,r,n,o){var s=new a(e,t,r,n,o);i.parentElement.appendChild(s.element);if(!s.isOpen)s.open();return s}},{"./lib/dom":117,"./utils":143,lodash:70}],127:[function(e,t,i){"use strict";var r=e("lodash");var n=e("./lib/oop");var o=e("escape-html");var a=e("./utils");var s=e("./cell_type_util");var l=e("./cell_renderer");var u=e("./cell_editor");var c=e("./lib/event_emitter").EventEmitter;var d=e("./link_box").mkLinkBox;var p=200;var f=155;var h=function(){};n.inherits(h,l);h.prototype.shouldTriggerTooltip=function(e){var t="link-cell-caption",i=e&&e.className.indexOf(t)>-1?e:e.getElementsByClassName(t)[0];var r=i&&i.scrollWidth-i.clientWidth;return r>1};h.prototype.shouldTriggerAlwaysEditing=function(e){return true};h.prototype.renderContent=function(e){var t=" ",i="",n="<span class='fa fa-exclamation-triangle' alt='Incorrect data' title='Incorrect data'></span>",s;if(!e.showSpinner&&!r.isUndefined(e.data.value.value)){s=a.isJSON(a.getSingleValue(e.data.value.value.formattedValue));if(r.isObject(s)){if(s.url&&a.isUrl(s.url)){if(s.caption){i="<span class='link-cell-caption'>"+o(s.caption)+"&nbsp;&nbsp;</span>"}t="<a class='link-cell' target='_blank'>"+i+"<span class='link-cell-icon fa fa-external-link'></span></a>"}else{t=n}}else{s=a.getSingleValue(e.data.value.value.formattedValue);if(a.isUrl(s)){t="<a class='link-cell' target='_blank' title='"+s+"'><span class='link-cell-icon fa fa-external-link'></span></a>"}else if(!r.isUndefined(s)){t=n}}}return t};i.mkLinkCellRenderer=function(){return new h};n.inherits(g,u);n.implement(g.prototype,c);function g(e){var t=this;this.initialCellValue=null;this.container=e;this.element=document.createElement("div");this.element.className="modal-body";this.form=document.createElement("form");this.form.autocomplete="off";this.urlGroup=document.createElement("div");this.urlGroup.className="form-group";this.urlLabel=document.createElement("label");this.urlLabel.innerHTML="URL:";this.urlInput=document.createElement("input");this.urlInput.id="urlInput";this.urlInput.className="form-control";this.captionGroup=document.createElement("div");this.captionGroup.className="form-group";this.captionLabel=document.createElement("label");this.captionLabel.innerHTML="Caption:";this.captionInput=document.createElement("input");this.captionInput.id="captionInput";this.captionInput.className="form-control";this.urlGroup.appendChild(this.urlLabel);this.urlGroup.appendChild(this.urlInput);this.captionGroup.appendChild(this.captionLabel);this.captionGroup.appendChild(this.captionInput);this.form.appendChild(this.urlGroup);this.form.appendChild(this.captionGroup);this.element.appendChild(this.form);this.containerElement=document.createElement("div");this.containerElement.appendChild(this.element);this.container.appendChild(this.containerElement);this.directCellTyping=false;this.realEditorOpen=false;this.hide();this.$bindOnBlur=this.onBlur.bind(this);this.$bindHandleKeypress=t.handleKeypress.bind(this);document.body.addEventListener("click",this.$bindOnBlur);document.body.addEventListener("keydown",this.$bindHandleKeypress);this.element.addEventListener("click",function(e){e.preventDefault();e.stopPropagation()});var i=r.debounce(function(){t.validateValue(t.coord,t.$getValue())},50);this.urlInput.addEventListener("input",i);this.captionInput.addEventListener("input",i)}g.prototype.onBlur=function(e){if(!this.$editing||!this.realEditorOpen||e.srcElement.id==="link_edit_button"){return}if(!this.valuesAreEqual(this.initialCellValue,this.$getValue())&&this.validateValue(this.coord,this.$getValue(),true)){this.$confirmEdit(e)}else{this.$cancelEdit()}this.initialCellValue=null};g.prototype.handleKeypress=function(e){
if(e.keyCode===13){if(this.validateValue(this.coord,this.$getValue(),true)){this.$confirmEdit(e);e.preventDefault()}}else if(e.keyCode===27){this.$cancelEdit()}};g.prototype.initialize=function(e,t,i){var n,o,s=false,l={left:this.linkBoxLeft,top:this.linkBoxTop},u=e.readonly||e.protected||e.locked;if(r.isObject(e)){n=e.data.value;o=n&&n.edit&&n.edit.rawValue||n.value.rawValue;if(r.isUndefined(o)){o=""}}if(r.isArray(o)){s=a.isJSON(a.getSingleValue(o))}if(r.isObject(s)){this.urlInput.value=s.url;this.captionInput.value=s.caption}else{this.urlInput.value=o;this.captionInput.value=""}this.directCellTyping=false;this.realEditorOpen=false;this.$editing=true;this.coord={X:t.dataset.col,Y:t.dataset.row};this.initialCellValue=a.getSingleValue(o);this.validateValue(this.coord,i||this.initialCellValue);this.containerElement.style.display="none";this.createLinkBox(l,this.extractURL(this.initialCellValue),u)};g.prototype.focus=function(){var e=this.urlInput.value.length;this.urlInput.focus();this.urlInput.setSelectionRange(e,e)};g.prototype.hide=function(){this.realEditorOpen=false;this.containerElement.style.display="none";this.$editing=false;this.markCellValid()};g.prototype.show=function(){if(this.realEditorOpen)this.containerElement.style.display="block"};g.prototype.showRealEditor=function(){this.realEditorOpen=true;this.$editing=true;this.focus();this.show()};g.prototype.destroy=function(){document.body.removeEventListener("click",this.$bindOnBlur);document.body.removeEventListener("keydown",this.$bindHandleKeypress)};g.prototype.renderOver=function(e){var t=e.getBoundingClientRect(),i=this.containerElement.parentNode.getBoundingClientRect(),r=window.getComputedStyle(this.containerElement),n=s.parseResolvedValue(r.marginTop),o=s.parseResolvedValue(r.marginLeft),a=t.top-i.top-n-1,l=t.left-i.left-o-1;this.linkBoxTop=a+t.height+8;this.linkBoxLeft=l-8;this.element.style.width="100%";this.element.style.height="100%";if(a+f>window.innerHeight-a){a-=f-t.height}if(l+p>window.innerWidth-l){l-=p-t.width}this.containerElement.style.left=l+"px";this.containerElement.style.top=a+"px";this.containerElement.style.width=p+"px";this.containerElement.style.height=f+"px";this.containerElement.style.position="absolute";this.containerElement.className="editable-container modal-content"};g.prototype.valuesAreEqual=function(e,t){var i=a.isJSON(e),n=a.isJSON(t);if(r.isObject(i)==r.isObject(n)){return e===t}if(r.isObject(i)){return i.caption===""&&i.url===t}return n.caption===""&&n.url===e};g.prototype.convertData=function(e){return r.isUndefined(e)?"":e};g.prototype.formatValues=function(){var e=this.urlInput.value,t=this.captionInput.value;return{url:e,caption:t}};g.prototype.validateValue=function(e,t,i){var n=a.isJSON(t),o=a.isUrl(r.isObject(n)?n.url:t);if(!o){this.markCellInvalid("Link must be a valid URL.",i)}else{this.markCellValid()}return o};g.prototype.extractURL=function(e){var t=a.isJSON(e);if(r.isObject(t)){return t.url}return e};g.prototype.validateData=function(e){if(isNaN(e)){this.element.style.background="red";return false}else{this.element.style.background="white";return true}};g.prototype.$getValue=function(){return JSON.stringify(this.formatValues())};g.prototype.$confirmEdit=function(e){var t=JSON.stringify(this.formatValues()),i=false;if(t==="")i=true;if(this.$editing){this._emit("confirm-edit",{value:t,delete:i,keyEvent:e});this.$editing=false}};g.prototype.$cancelEdit=function(){if(this.$editing){this._emit("cancel-edit",{value:this.$getValue()});this.$editing=false;this.invalid=false}};g.prototype.markCellValid=function(){var e=this.popupElem;if(e){e.parentElement.removeChild(e);this.popupElem=null}var t=this.element.parentElement;if(t.className.match("invalid-input")){t.className=t.className.replace("invalid-input","")}};g.prototype.markCellInvalid=function(e,t){var i=this.popupElem,r=150,n="right",o,a="validation-popup",s,l;if(!this.element.parentElement.className.match("invalid-input")){this.element.parentElement.className+=" invalid-input"}if(!t){return}if(!i){l=document.createElement("div");l.className="info-text";l.innerHTML=e;s=document.createElement("div");s.className="info message";s.appendChild(l);i=document.createElement("div");i.id=a;i.className="notification alert alert-warning material";o=this.element.parentElement.clientWidth-this.element.parentElement.offsetLeft;if(o<r){n+="left"}i.className+=" "+n;i.appendChild(s);this.popupElem=i;this.element.parentElement.appendChild(i)}else{l=i.querySelector(".info-text");l.innerHTML=e}};g.prototype.createLinkBox=function(e,t,i){var r=d(t,e,this.containerElement,this.showRealEditor.bind(this),this.$cancelEdit.bind(this),i);if(!a.isUrl(t)){r.hide();this.showRealEditor()}};i.mkLinkCellEditor=function(e){return new g(e.container)};i.$LinkCellRenderer=h},{"./cell_editor":91,"./cell_renderer":92,"./cell_type_util":96,"./lib/event_emitter":120,"./lib/oop":124,"./link_box":126,"./utils":143,"escape-html":"escape-html",lodash:70}],128:[function(e,t,i){"use strict";var r=e("../lib/dom");var n=e("../lib/useragent");var o=e("../utils");var a=e("../cell_type_registry").DisplayTypes;function s(e){e.$clickSelection=null;var t=e.editor;t.setDefaultHandler("mousedown",this.onMouseDown.bind(e));t.setDefaultHandler("mouseover",this.onMouseOver.bind(e));t.setDefaultHandler("mouseout",this.onMouseOut.bind(e));t.setDefaultHandler("click",this.onClick.bind(e));t.setDefaultHandler("dblclick",this.onDoubleClick.bind(e));t.setDefaultHandler("mousewheel",this.onMouseWheel.bind(e));t.setDefaultHandler("rightclick",this.onMouseRightClick.bind(e));var i=["select","startSelect","removeHeadingCaret","onMouseRightDown"];i.forEach(function(t){e[t]=this[t]},this);e.selectByRows=this.extendSelectionBy.bind(e,"getRowRange")}(function(){this.onClick=function(e){var t=this.editor,i=e.domEvent.target,n=t.getContainingCell(i),s=n&&o.getPositionFromTarget(n),l=r.hasCssClass(i,"sort-icon")||r.hasCssClass(i,"sorted-icon"),u,c;if(l){c=r.hasCssClass(n,"horizontal_heading")?"X":"Y";t.provider.setSort(c,{x:s.column,y:s.row})}else if(s&&t.shouldTriggerAlwaysEditing(n,i)&&!t.renderer.editing){u=t.provider.getCellData({X:s.column,Y:s.row});if(u&&!u.readonly||u.displayType===a.LINK||u.displayType===a.MOUSEOVER){t.showEditor(n,false);e.preventDefault();e.stopPropagation()}}};this.removeHeadingCaret=function(){if(this.editor.renderer.hHeadingCaret)this.editor.renderer.$horHeadingLayer.removeCaret();if(this.editor.renderer.vHeadingCaret)this.editor.renderer.$verHeadingLayer.removeCaret()};this.onMouseRightDown=function(e){var t=this.editor,i=t.getSelectionRange();this.removeHeadingCaret();if(i.isEmpty()||!c(i,e)){if(e){t.moveCaretToPosition(e)}t.selection.clearSelection()}};this.onMouseDown=function(e){var t=this.editor,i=e.domEvent.target,r=t.getContainingCell(i),n=e.inSelection(),a=r&&o.getPositionFromTarget(r),s=e.getButton();this.mousedownEvent=e;if(t.isHeadingCell(r)||!a||s===1)return;if(e.getButton()===2){this.onMouseRightDown(a);return}if(n&&!t.isFocused()){t.focus();return}this.removeHeadingCaret();this.startSelect(a);this.captureMouse(e)};this.onMouseOver=function(e){var t=this.editor,i=e.domEvent.target,r=t.getContainingCell(i);if(t.shouldTriggerTooltip(r,i)){t.showTooltip(r,i);e.preventDefault()}};this.onMouseOut=function(e){var t=this.editor,i=e.domEvent.target,r=t.getContainingCell(i);if(t.shouldTriggerTooltip(r,i)){t.hideTooltip();e.preventDefault()}};this.onMouseRightClick=function(e){e.preventDefault();var t=e.domEvent&&e.domEvent.target,i=t&&t.offsetParent;if(!i||i.className.indexOf("dropdown-menu")===-1){this.editor.showContextMenu(t,e.clientX,e.clientY)}};this.startSelect=function(e){e=e||this.editor.renderer.screenToTextCoordinates(this.x,this.y);if(this.mousedownEvent.getShiftKey()){this.editor.selection.selectToPosition(e)}else if(!this.$clickSelection){this.editor.moveCaretToPosition(e);this.editor.selection.clearSelection()}this.setState("select")};this.select=function(){var e,t=this.editor;var i=t.renderer.screenToTextCoordinates(this.x,this.y);if(!i)return;if(this.$clickSelection){var r=this.$clickSelection.comparePoint(i);if(r==-1){e=this.$clickSelection.end}else if(r==1){e=this.$clickSelection.start}else{var n=u(this.$clickSelection,i);i=n.cursor;e=n.anchor}t.selection.setSelectionAnchor(e.row,e.column)}t.selection.selectToPosition(i);t.renderer.scrollCaretIntoView()};this.extendSelectionBy=function(e){var t,i=this.editor;var r=i.renderer.screenToTextCoordinates(this.x,this.y);if(!r)return;var n=i.selection[e](r.row,r.column);if(this.$clickSelection){var o=this.$clickSelection.comparePoint(n.start);var a=this.$clickSelection.comparePoint(n.end);if(o==-1&&a<=0){t=this.$clickSelection.end;if(n.end.row!=r.row||n.end.column!=r.column)r=n.start}else if(a==1&&o>=0){t=this.$clickSelection.start;if(n.start.row!=r.row||n.start.column!=r.column)r=n.end}else if(o==-1&&a==1){r=n.end;t=n.start}else{var s=u(this.$clickSelection,r);r=s.cursor;t=s.anchor}i.selection.setSelectionAnchor(t.row,t.column)}i.selection.selectToPosition(r);i.renderer.scrollCaretIntoView()};this.startDrag=function(){var e=this.editor;this.setState("drag");e.clearSelection();r.addCssClass(e.container,"ace_dragging");if(!this.$dragKeybinding){this.$dragKeybinding={handleKeyboard:function(e,t,i){if(i=="esc")return{command:this.command}},command:{exec:function(e){var t=e.$mouseHandler;t.dragCaret=null;t.dragEnd();t.startSelect()}}}}e.keyBinding.addKeyboardHandler(this.$dragKeybinding)};this.onDoubleClick=function(e){var t=this.editor,i=e.domEvent.target,r=t.getContainingCell(i),n=t.canReceiveMouseEvents(r);if(!n){e.preventDefault();e.stopPropagation();return}if(t.isHeadingCell(i)||l(r,"readonly"))return;var s=o.getPositionFromTarget(r),u;if(s&&!t.renderer.editing){u=t.provider.getCellData({X:s.column,Y:s.row});if(u&&!u.readonly||u.displayType===a.LINK||u.displayType===a.MOUSEOVER){t.showEditor(r,false);e.preventDefault()}}};this.onMouseWheel=function(e){if(e.getShiftKey()||e.getAccelKey())return;var t=e.domEvent.timeStamp;var i=t-(this.$lastScrollTime||0);var r=this.editor;var n=this;var o=r.renderer.isScrollableBy(e.wheelX*e.speed,e.wheelY*e.speed);if(o||i<200){n.$lastScrollTime=t;r.renderer.scrollBy(e.wheelX*e.speed,e.wheelY*e.speed);r.stopEditing();return e.stop()}}}).call(s.prototype);i.DefaultHandlers=s;function l(e,t){var i=e.parentElement,r=i&&i.parentElement;return e.className.indexOf(t)!==-1||i&&i.className.indexOf(t)!==-1||r&&r.className.indexOf(t)!==-1}function u(e,t){var i;if(e.start.row===e.end.row){i=2*t.column-e.start.column-e.end.column}else{i=2*t.row-e.start.row-e.end.row}return i<0?{cursor:e.start,anchor:e.end}:{cursor:e.end,anchor:e.start}}function c(e,t){return e.start.row<=t.row&&e.end.row>=t.row&&(e.start.column<=t.column&&e.end.column>=t.column)}},{"../cell_type_registry":95,"../lib/dom":117,"../lib/useragent":125,"../utils":143}],129:[function(e,t,i){"use strict";var r=e("../lib/dom");var n=e("../lib/event");var o=e("./util");var a=e("../utils");function s(e){var t=e.editor;var i=t.renderer.$horHeadingLayer;var r=t.renderer.$verHeadingLayer;var n=t.renderer.$horheading;var s=this,l=4,u,c,d;function p(e){var r=t.renderer.$horheading.getBoundingClientRect(),n=e.y-r.top,o=h(e),a=o&&o.node,u=o&&o.depth,c=a&&i.findColumnSizeOfIndexAt(a,u),p=a&&i.findDepthOffsetOfColumnIndexAt(a,u),f=0;if(!a){return false}s.up=p;if(i.maxDepth===i.getColumnSizesAtNode(a).length){if(s.up+(c-l)<n&&n<s.up+c){d=o;d.dragIndex=a.index}else{return false}d.dragSize=c;return true}return false}function f(e){var r=t.renderer.$horheading.getBoundingClientRect(),n=e.x-r.left,o=h(e),a=o&&o.node,u;if(o&&o.depth===i.getColumnSizesAtNode(a).length-1){u=a.size;s.left=o.relOffset;if(s.left+(u-l)<n&&n<s.left+u){d=o;d.dragIndex=a.index}else{return false}d.dragSize=u;return true}return false}function h(e){if(!(e.mousedownEvent||e.domEvent)){throw new Error}var r=t.renderer.layerConfig,n=t.renderer.$horheading.getBoundingClientRect(),a=e.y-n.top,s=e.x-n.left,l=o.getHeadingEventCoords(e,t),u=l&&i.findNodeByIndex(l.row),c=u&&o.findLayerHeadingAtMouseCoord(i,r,s,a,o.Axes.HORIZONTAL,u);if(c){c.axisCoords=l}return c}e.editor.setDefaultHandler("horizontaldblclick",function(e){var i=e.domEvent.target,r=t.getContainingCell(i),n=r&&a.getPositionFromTarget(r);e.preventDefault();if(t.canReceiveMouseEvents(r)&&t.isEditableHeader(r))t.showEditor(r,true,"X")});e.editor.setDefaultHandler("horizontalmousedown",function(t){if(!o.isRightClick(t)){var i=u||m(t);if(i){e.setState(i);e.captureMouse(t);c=true}}});function g(e){var n,o=h(e);if(e.domEvent.target.classList.contains("sort-icon")){n=e.domEvent.target.parentNode.attributes;t._emit("sortHeader",{axis:"X",coord:{x:n.getNamedItem("data-row"),y:n.getNamedItem("data-col")}})}else if(t.isHeadingCell(t.getContainingCell(e.domEvent.target))){i.caretSelection.setSelection(o.axisCoords.col,o.axisCoords.row,e.getShiftKey())}r.removeCaret()}e.editor.setDefaultHandler("horizontalclick",g);e.editor.setDefaultHandler("horizontalrightclick",g);e.editor.setDefaultHandler("horizontalmousemove",function(e){if(!c){m(e)}});function m(e){var t=p(e)?"resizeHVertical":f(e)?"resizeHorizontal":"";n.style.cursor=t=="resizeHorizontal"?"ew-resize":t=="resizeHVertical"?"ns-resize":"";return u=t}e.resizeHorizontal=function(){var i=t.renderer.$horheading.getBoundingClientRect(),r=this.x-i.left;if(!e.startPos){r=e.adjustPointerPosition(r,s.left,t.getMinCellWidth())}if(i.left<this.x&&this.x<i.left+t.container.offsetWidth){e.onResize(false,false,r,d)}};e.resizeHorizontalEnd=function(t){c=false;n.style.cursor="";e.onResizeEnd(false,false,0,d,t.ctrlKey||t.metaKey)};e.resizeHVertical=function(i){var r=t.renderer.$horheading.getBoundingClientRect(),n=Math.abs(this.y-r.top);if(!e.startPos){n=e.adjustPointerPosition(n,s.up,t.cellMinHeight)}if(r.top<this.y&&this.y<r.top+t.container.offsetHeight){e.onResize(false,true,n,d)}};e.resizeHVerticalEnd=function(t){c=false;n.style.cursor="";e.onResizeEnd(false,true,0,d,t.ctrlKey||t.metaKey)}}i.HorizontalHandler=s},{"../lib/dom":117,"../lib/event":119,"../utils":143,"./util":133}],130:[function(e,t,i){"use strict";var r=e("../lib/dom");var n=e("../lib/event");var o=e("./util");var a=e("../utils");function s(e){var t=e.editor;var i=t.renderer.$verHeadingLayer;var r=t.renderer.$horHeadingLayer;var n=t.renderer.$verheading;var s=this,l=4,u,c,d;function p(e){var r=t.renderer.$verheading.getBoundingClientRect(),n=e.y-r.top,o=h(e),a=o&&o.node,u;if(o&&o.depth===i.getColumnSizesAtNode(a).length-1){u=a.size;s.up=o.relOffset;if(s.up+(u-l)<n&&n<s.up+u){d=o;d.dragIndex=a.index}else{return false}d.dragSize=u;return true}return false}function f(e){var r=t.renderer.$verheading.getBoundingClientRect(),n=e.x-r.left,o=h(e),a=o&&o.node,u=o&&o.depth,c=a&&i.findDepthOffsetOfColumnIndexAt(a,u),p=a&&i.findColumnSizeOfIndexAt(a,u),f=0;if(!a){return false}s.left=c;if(i.maxDepth===i.getColumnSizesAtNode(a).length){if(s.left+(p-l)<n&&n<s.left+p){d=o;d.dragIndex=a.index}else{return false}d.dragSize=p;return true}return false}function h(e){if(!(e.mousedownEvent||e.domEvent)){throw new Error}var r=t.renderer.layerConfig,n=t.renderer.$verheading.getBoundingClientRect(),a=e.y-n.top,s=e.x-n.left,l=(e.domEvent||e.mousedownEvent.domEvent).target,u=o.getHeadingEventCoords(e,t),c=u&&i.findNodeByIndex(u.row),d=c&&o.findLayerHeadingAtMouseCoord(i,r,s,a,o.Axes.VERTICAL,c);if(d){d.axisCoords=u}return d}function g(e){var n,o=h(e);if(e.domEvent.target.classList.contains("sort-icon")){n=e.domEvent.target.parentNode.attributes;t._emit("sortHeader",{axis:"Y",coord:{x:n.getNamedItem("data-row"),y:n.getNamedItem("data-col")}})}else if(t.isHeadingCell(t.getContainingCell(e.domEvent.target))){i.caretSelection.setSelection(o.axisCoords.col,o.axisCoords.row,e.getShiftKey())}r.removeCaret()}e.editor.setDefaultHandler("verticalclick",g);e.editor.setDefaultHandler("verticalrightclick",g);e.editor.setDefaultHandler("verticalmousedown",function(t){if(o.isRightClick(t)){return}var i=u||m(t);if(i){e.setState(i);e.captureMouse(t);c=true}});function m(e){var t=p(e)?"resizeVertical":f(e)?"resizeVHorizontal":"";n.style.cursor=t=="resizeVertical"?"ns-resize":t=="resizeVHorizontal"?"ew-resize":"";return u=t}e.editor.setDefaultHandler("verticaldblclick",function(e){var i=e.domEvent.target,r=t.getContainingCell(i),n=r&&a.getPositionFromTarget(r);e.preventDefault();if(t.canReceiveMouseEvents(r)&&t.isEditableHeader(r)){t.showEditor(r,true,"Y")}});e.editor.setDefaultHandler("verticalmousemove",function(e){if(!c){m(e)}});e.resizeVertical=function(){var i=t.renderer.$verheading.getBoundingClientRect(),r=this.y-i.top;if(!e.startPos){r=e.adjustPointerPosition(r,s.up,t.getMinCellHeight())}if(i.top<this.y&&this.y<i.top+t.container.offsetHeight){e.onResize(true,true,r,d)}};e.resizeVerticalEnd=function(t){c=false;n.style.cursor="";e.onResizeEnd(true,true,0,d,t.ctrlKey||t.metaKey)};e.resizeVHorizontal=function(i){var r=t.renderer.$verheading.getBoundingClientRect(),n=Math.abs(this.x-r.left);if(!e.startPos){n=e.adjustPointerPosition(n,s.left,t.getMinCellWidth())}if(r.left<this.x&&this.x<r.left+t.container.offsetWidth){e.onResize(true,false,n,d)}};e.resizeVHorizontalEnd=function(t){c=false;n.style.cursor="";e.onResizeEnd(true,false,0,d,t.ctrlKey||t.metaKey)}}i.VerticalHandler=s},{"../lib/dom":117,"../lib/event":119,"../utils":143,"./util":133}],131:[function(e,t,i){"use strict";var r=e("../lib/event");var n=e("../lib/useragent");var o=i.MouseEvent=function(e,t){this.domEvent=e;this.editor=t;this.x=this.clientX=e.clientX;this.y=this.clientY=e.clientY;this.$pos=null;this.$inSelection=null;this.propagationStopped=false;this.defaultPrevented=false};(function(){this.stopPropagation=function(){r.stopPropagation(this.domEvent);this.propagationStopped=true};this.preventDefault=function(){r.preventDefault(this.domEvent);this.defaultPrevented=true};this.stop=function(){this.stopPropagation();this.preventDefault()};this.getDocumentPosition=function(){if(this.$pos)return this.$pos;this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY);return this.$pos};this.inSelection=function(){if(this.$inSelection!==null)return this.$inSelection;var e=this.editor;if(e.getReadOnly()){this.$inSelection=false}else{var t=e.getSelectionRange();if(t.isEmpty())this.$inSelection=false;else{var i=this.getDocumentPosition();if(!i)return false;this.$inSelection=t.contains(i.row,i.column)}}return this.$inSelection};this.getButton=function(){return r.getButton(this.domEvent)};this.getShiftKey=function(){return this.domEvent.shiftKey};this.getAccelKey=n.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}).call(o.prototype)},{"../lib/event":119,"../lib/useragent":125}],132:[function(e,t,i){"use strict";var r=e("../lib/event");var n=e("../lib/useragent");var o=e("./default_handlers").DefaultHandlers;var a=e("./default_horizontal_handler").HorizontalHandler;var s=e("./default_vertical_handler").VerticalHandler;var l=e("./mouse_event").MouseEvent;var u=e("../config");var c=function(e){this.editor=e;new o(this);new a(this);new s(this);r.addListener(e.container,"mousedown",function(t){var i=t.target,r=i===e.renderer.scrollBarV.element||i===e.renderer.scrollBarH.element;setTimeout(function(){if(!e.renderer.editing||r){e.focus(true)}})});var t=e.renderer.getMouseEventTarget();r.addListener(t,"click",this.onMouseEvent.bind(this,"click"));r.addListener(t,"mousemove",this.onMouseMove.bind(this,"mousemove"));r.addListener(t,"mouseover",this.onMouseOver.bind(this,"mouseover"));r.addListener(t,"mouseout",this.onMouseOut.bind(this,"mouseout"));r.addMultiMouseDownListener(t,[300,300,250],this,"onMouseEvent");r.addMultiMouseDownListener(e.renderer.scrollBarV.inner,[300,300,250],this,"onMouseEvent");r.addMultiMouseDownListener(e.renderer.scrollBarH.inner,[300,300,250],this,"onMouseEvent");r.addMouseWheelListener(e.container,this.onMouseWheel.bind(this,"mousewheel"));var i=e.renderer.$horheading;r.addListener(i,"mousedown",this.onMouseEvent.bind(this,"horizontalmousedown"));r.addListener(i,"click",this.onMouseEvent.bind(this,"horizontalclick"));r.addListener(i,"dblclick",this.onMouseEvent.bind(this,"horizontaldblclick"));r.addListener(i,"mousemove",this.onMouseEvent.bind(this,"horizontalmousemove"));r.addListener(i,"contextmenu",this.onMouseEvent.bind(this,"horizontalrightclick"));var n=e.renderer.$verheading;r.addListener(n,"mousedown",this.onMouseEvent.bind(this,"verticalmousedown"));r.addListener(n,"click",this.onMouseEvent.bind(this,"verticalclick"));r.addListener(n,"dblclick",this.onMouseEvent.bind(this,"verticaldblclick"));r.addListener(n,"mousemove",this.onMouseEvent.bind(this,"verticalmousemove"));r.addListener(n,"contextmenu",this.onMouseEvent.bind(this,"verticalrightclick"));r.addListener(t,"contextmenu",this.onMouseEvent.bind(this,"rightclick"))};(function(){this.onMouseEvent=function(e,t){this.editor._emit(e,new l(t,this.editor))};this.onMouseMove=function(e,t){var i=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;if(!i||!i.length)return;this.editor._emit(e,new l(t,this.editor))};this.onMouseOver=function(e,t){this.editor._emit(e,new l(t,this.editor))};this.onMouseOut=function(e,t){this.editor._emit(e,new l(t,this.editor))};this.onMouseWheel=function(e,t){var i=new l(t,this.editor);i.speed=this.$scrollSpeed*2;i.wheelX=t.wheelX;i.wheelY=t.wheelY;this.editor._emit(e,i)};this.setState=function(e){this.state=e};this.captureMouse=function(e,t){if(t)this.setState(t);this.x=e.x;this.y=e.y;this.isMousePressed=true;var i=this.editor.renderer;if(i.$keepTextAreaAtCursor)i.$keepTextAreaAtCursor=null;var o=this;var a=function(e){o.x=e.clientX;o.y=e.clientY};var s=function(e){clearInterval(u);l();o[o.state+"End"]&&o[o.state+"End"](e);o.$clickSelection=null;if(i.$keepTextAreaAtCursor==null){i.$keepTextAreaAtCursor=true;i.$moveTextAreaToCursor()}o.isMousePressed=false;o.onMouseEvent("mouseup",e)};var l=function(){o[o.state]&&o[o.state]()};if(n.isOldIE&&e.domEvent.type=="dblclick"){return setTimeout(function(){s(e.domEvent)})}r.capture(this.editor.container,a,s);var u=setInterval(l,20)};this.adjustPointerPosition=function(e,t,i){var r=e-t;var n=r<i?e+i-r:e;return n};this.onResize=function(e,t,i,r){var n=this.editor.container,o=n.querySelector(".preview"),a=this.editor,s=this,l,u,c,d,p,f;if(!o){o=document.createElement("div");o.className="preview "+(t?"vertical":"horizontal")}if(!s.heading){s.heading=r}l=e?a.renderer.layerConfig.vRange:a.renderer.layerConfig.hRange;s.targetHeading=s.heading;if(s.startPos===undefined){s.startPos=i}s.endPos=i;u=s.endPos-s.startPos;if(t){d=s.targetHeading.dragSize;p=a.getMinCellHeight()<=d+u;i=p?i:s.startPos+a.getMinCellHeight()-d;o.style.top=(e?i+a.renderer.$verheading.offsetTop:i)+"px"}else{c=s.targetHeading.dragSize;p=a.getMinCellWidth()<=c+u;i=p?i:s.startPos-(c-a.getMinCellWidth());o.style.left=(e?i:i+a.renderer.$horheading.offsetLeft)+"px"}if(!s.previewExists){n.appendChild(o);s.previewExists=true}};this.onResizeEnd=function(e,t,i,r,n){var o=this.editor,a=r.dragSize,s=this.editor.container,l=s.querySelector(".preview"),u=this,c,d;if(t){d=e?a+(u.endPos-u.startPos):r.dragSize+(u.endPos-u.startPos);d=!d?o.getMinCellHeight():d<o.getMinCellHeight()?o.getMinCellHeight():d;if(e){o.setRowHeaderHeight(d,r.axisCoords,n)}else{o.setColumnHeaderHeight(d,r.axisCoords)}}else{c=e?r.dragSize+u.endPos-u.startPos:a+u.endPos-u.startPos;c=!c?o.getMinCellWidth():c<o.getMinCellWidth()?o.getMinCellWidth():c;if(e){o.setRowHeaderWidth(c,r.axisCoords)}else{o.setColumnHeaderWidth(c,r.axisCoords,n)}}u.startPos=undefined;if(l){s.removeChild(l)}u.previewExists=false;o.renderer.once("afterRender",function(){if(!u.targetHeading){u.targetHeading=u.heading}u.heading=null;if(e){o.scrollToRow(u.targetHeading.dragIndex,true)}else{o.scrollToColumn(u.targetHeading.dragIndex,true)}})}}).call(c.prototype);u.defineOptions(c.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:150},focusTimout:{initialValue:0}});i.MouseHandler=c},{"../config":101,"../lib/event":119,"../lib/useragent":125,"./default_handlers":128,"./default_horizontal_handler":129,"./default_vertical_handler":130,"./mouse_event":131}],133:[function(e,t,i){"use strict";var r=t.exports;var n=e("lodash");var o=e("../lib/useragent");r.Axes={HORIZONTAL:"HORIZONTAL",VERTICAL:"VERTICAL"};r.findLayerHeadingAtMouseCoord=function(e,t,i,n,o,a){var s=o===r.Axes.VERTICAL,l=s?i:n,u=s?t.firstRow:t.firstCol,c=e.findOffsetAtIndex(u),d=e.findColumnIndexOfDepthAtNode(a,l),p=e.findOffsetAtIndex(a.index);return{node:a,absOffset:p,relOffset:p-c,relIndex:a.index-u,depth:d}};r.getEventTarget=function(e){var t=(e.domEvent||e.mousedownEvent.domEvent).target;return t};r.getHeadingEventCoords=function(e,t){return t.getHeadingCellAxisCoords(t.getContainingCell(r.getEventTarget(e)))};r.isRightClick=function(e){e=e.domEvent;return"which"in e&&e.which===3||"button"in e&&e.button==2||o.isMac&&e.ctrlKey}},{"../lib/useragent":125,lodash:70}],134:[function(e,t,i){"use strict";var r=e("./lib/dom");var n=e("./cell_editor");var o=e("./lib/event_emitter").EventEmitter;var a=e("lodash");var s=e("./lib/oop");var l=e("escape-html");var u=e("./cell_type_util");var c=e("./utils");var d=e("./cell_renderer");var p=e("./cell_tooltip");var f=e("./link_box").mkLinkBox;var h=200;var g=155;function m(){}s.inherits(m,d);m.prototype.renderContent=function(e){var t=" ",i="",r="",n="<span class='fa fa-exclamation-triangle' alt='Incorrect data' title='Incorrect data'></span>",o;if(!e.showSpinner&&!a.isUndefined(e.data.value.value)){o=c.isJSON(c.getSingleValue(e.data.value.value.formattedValue));if(a.isObject(o)){if(o.url&&c.isUrl(o.url)){if(o.caption){i="<span class='mouseover-cell-caption'>"+l(o.caption)+"&nbsp;&nbsp;</span>";r="title='"+l(o.caption)+"'"}t="<a class='mouseover-cell' target='_blank' "+r+">"+i+"<span class='mouseover-cell-icon fa fa-picture-o'></span></a>"}else{t=n}}else{o=c.getSingleValue(e.data.value.value.formattedValue);if(c.isUrl(o)){t="<a class='mouseover-cell fa fa-picture-o' target='_blank'></a>"}else if(!a.isUndefined(o)){t=n}}}return t};m.prototype.shouldTriggerTooltip=function(e){return true};m.prototype.shouldTriggerAlwaysEditing=function(e){return true};function v(e){this.container=e;this.element=document.createElement("div");this.element.className="pivot_tooltip";this.containerElement=document.createElement("div");this.containerElement.className="tooltip-container";this.containerElement.appendChild(this.element);this.container.appendChild(this.containerElement)}s.inherits(v,p);v.prototype.initialize=function(){};v.prototype.setDataProvider=function(e){this.provider=e};v.prototype.render=function(e,t){var i=this,r=t&&t.getBoundingClientRect()||e.getBoundingClientRect(),n=e.getAttribute("data-row"),o=e.getAttribute("data-col"),s=this.provider.getDataRange({Y:{start:n,length:1},X:{start:o,length:1}}),l=s&&s[0]&&s[0][0][0],d=a.isObject(l.data)?l.data.value.value.rawValue:null,p=a.property("0.0.0.data.value.value.rawValue.0.0")(s)||"",f=c.isJSON(p),h=this.containerElement.parentNode.getBoundingClientRect(),g=getComputedStyle(this.containerElement),m=u.parseResolvedValue(g.marginTop),v=u.parseResolvedValue(g.marginLeft),y=false,b;if(a.isObject(f)){p=f.url}this.containerElement.style.padding="0";this.containerElement.style.top=r.top-h.top-m-5+"px";this.containerElement.style.left=r.left-h.left-v+15+"px";this.containerElement.style.width="15px";this.containerElement.style.height="15px";this.containerElement.style.position="absolute";this.containerElement.style.display="block";this.containerElement.style.opacity=1;this.element.style.width="100%";this.element.style.height="100%";this.element.innerHTML="";this.image=new Image;this.image.onload=function(){i.element.style.position="absolute";i.element.style.left="0px";y=true;b=i.renderImageTooltip(p);i.calculateTooltipPosition(b,r)};this.image.onerror=function(){i.element.style.position="absolute";i.element.style.left="0px";y=true;b=i.renderErrorTooltip();i.calculateTooltipPosition(b,r)};this.image.src=p;setTimeout(function(){if(!y){i.element.style.position="relative";i.element.style.left=r.width+"px";i.renderLoadingIndicator()}})};v.prototype.renderImageTooltip=function(e){var t=this.renderTooltip(e);this.element.innerHTML="";this.element.appendChild(t);return t};v.prototype.renderErrorTooltip=function(){this.element.innerHTML="";this.element.innerHTML="<div class='pt-tooltip'><div class='content'>The requested image doesn't exist.</div></div>";return this.element.children[0]};v.prototype.calculateTooltipPosition=function(e,t){e.style.left=t.width+"px";e.style.top=(t.height-e.getBoundingClientRect().height)/2+"px"};v.prototype.renderLoadingIndicator=function(){this.element.innerHTML="";this.element.innerHTML="<div class='image-loading'><i class='fa fa-arrow-circle-o-down'></i></div>"};v.prototype.show=function(){this.containerElement.style.display="block"};v.prototype.hide=function(){this.containerElement.style.display="none";if(this.image){this.image.onload=a.noop;this.image.onerror=a.noop}};v.prototype.renderTooltip=function(e){var t=document.createElement("div"),i=document.createElement("div"),r=document.createElement("img");r.src=e;i.className="content";i.appendChild(r);t.className="pt-tooltip";t.appendChild(i);return t};s.inherits(y,n);s.implement(y.prototype,o);function y(e){var t=this;this.initialCellValue=null;this.container=e;this.element=document.createElement("div");this.element.className="modal-body";this.form=document.createElement("form");this.form.autocomplete="off";this.urlGroup=document.createElement("div");this.urlGroup.className="form-group";this.urlLabel=document.createElement("label");this.urlLabel.innerHTML="URL:";this.urlInput=document.createElement("input");this.urlInput.id="urlInput";this.urlInput.className="form-control";this.captionGroup=document.createElement("div");this.captionGroup.className="form-group";this.captionLabel=document.createElement("label");this.captionLabel.innerHTML="Caption:";this.captionInput=document.createElement("input");this.captionInput.id="captionInput";this.captionInput.className="form-control";this.urlGroup.appendChild(this.urlLabel);this.urlGroup.appendChild(this.urlInput);this.captionGroup.appendChild(this.captionLabel);this.captionGroup.appendChild(this.captionInput);this.form.appendChild(this.urlGroup);this.form.appendChild(this.captionGroup);this.element.appendChild(this.form);this.containerElement=document.createElement("div");this.containerElement.appendChild(this.element);this.container.appendChild(this.containerElement);this.directCellTyping=false;this.realEditorOpen=false;this.hide();document.body.addEventListener("click",this.onBlur.bind(this));document.body.addEventListener("keydown",this.handleKeypress.bind(this));this.element.addEventListener("click",function(e){e.preventDefault();e.stopPropagation()});var i=a.debounce(function(){t.validateValue(t.coord,t.$getValue())},50);this.urlInput.addEventListener("input",i);this.captionInput.addEventListener("input",i)}y.prototype.onBlur=function(e){if(!this.$editing||!this.realEditorOpen||e.srcElement.id==="link_edit_button"){return}if(!this.valuesAreEqual(this.initialCellValue,this.$getValue())&&this.validateValue(this.coord,this.$getValue(),true)){this.$confirmEdit(e)}else{this.$cancelEdit()}this.initialCellValue=null};y.prototype.handleKeypress=function(e){if(e.keyCode===13){if(this.validateValue(this.coord,this.$getValue(),true)){this.$confirmEdit(e);e.preventDefault()}}else if(e.keyCode===27){this.$cancelEdit()}};y.prototype.initialize=function(e,t,i){var r,n,o=false,s={left:this.linkBoxLeft,top:this.linkBoxTop},l=e.readonly||e.protected||e.locked;if(a.isObject(e)){r=e.data.value;n=r&&r.edit&&r.edit.rawValue||r.value.rawValue;if(a.isUndefined(n))n=""}if(a.isArray(n))o=c.isJSON(c.getSingleValue(n));if(a.isObject(o)){this.urlInput.value=o.url;this.captionInput.value=o.caption}else{this.urlInput.value=n;this.captionInput.value=""}this.directCellTyping=false;this.realEditorOpen=false;this.$editing=true;this.coord={X:t.dataset.col,Y:t.dataset.row};this.initialCellValue=c.getSingleValue(n);
this.validateValue(this.coord,i||this.initialCellValue);this.containerElement.style.display="none";this.createLinkBox(s,this.extractURL(this.initialCellValue),l)};y.prototype.focus=function(){var e=this.urlInput.value.length;this.urlInput.focus();this.urlInput.setSelectionRange(e,e)};y.prototype.hide=function(){this.realEditorOpen=false;this.containerElement.style.display="none";this.$editing=false;this.markCellValid()};y.prototype.show=function(){if(this.realEditorOpen)this.containerElement.style.display="block"};y.prototype.showRealEditor=function(){this.realEditorOpen=true;this.$editing=true;this.focus();this.show()};y.prototype.destroy=function(){document.body.removeEventListener("click",me.onBlur);document.body.removeEventListener("keydown",me.handleKeypress)};y.prototype.renderOver=function(e){var t=e.getBoundingClientRect(),i=this.containerElement.parentNode.getBoundingClientRect(),r=window.getComputedStyle(this.containerElement),n=u.parseResolvedValue(r.marginTop),o=u.parseResolvedValue(r.marginLeft),a=t.top-i.top-n-1,s=t.left-i.left-o-1;this.linkBoxTop=a+t.height+8;this.linkBoxLeft=s-8;this.element.style.width="100%";this.element.style.height="100%";if(a+g>window.innerHeight-a)a-=g-t.height;if(s+h>window.innerWidth-s)s-=h-t.width;this.containerElement.style.left=s+"px";this.containerElement.style.top=a+"px";this.containerElement.style.width=h+"px";this.containerElement.style.height=g+"px";this.containerElement.style.position="absolute";this.containerElement.className="editable-container modal-content"};y.prototype.valuesAreEqual=function(e,t){var i=c.isJSON(e),r=c.isJSON(t);if(a.isObject(i)==a.isObject(r)){return e===t}if(a.isObject(i)){return i.caption===""&&i.url===t}return r.caption===""&&r.url===e};y.prototype.convertData=function(e){return a.isUndefined(e)?"":e};y.prototype.formatValues=function(){var e=this.urlInput.value,t=this.captionInput.value;return{url:e,caption:t}};y.prototype.validateValue=function(e,t,i){var r=c.isJSON(t),n=c.isUrl(a.isObject(r)?r.url:t);if(!n){this.markCellInvalid("Link must be a valid URL.",i)}else{this.markCellValid()}return n};y.prototype.validateData=function(e){if(isNaN(e)){this.element.style.background="red";return false}else{this.element.style.background="white";return true}};y.prototype.$getValue=function(){return JSON.stringify(this.formatValues())};y.prototype.extractURL=function(e){var t;t=c.isJSON(e);if(a.isObject(t)){return t.url}return e};y.prototype.$confirmEdit=function(e){var t=JSON.stringify(this.formatValues()),i=false;if(t==="")i=true;if(this.$editing){this._emit("confirm-edit",{value:t,delete:i,keyEvent:e});this.$editing=false}};y.prototype.$cancelEdit=function(){if(this.$editing){this._emit("cancel-edit",{value:this.$getValue()});this.$editing=false;this.invalid=false}};y.prototype.markCellValid=function(){var e=this.popupElem;if(e){e.parentElement.removeChild(e);this.popupElem=null}var t=this.element.parentElement;if(t.className.match("invalid-input")){t.className=t.className.replace("invalid-input","")}};y.prototype.markCellInvalid=function(e,t){var i,r=150,n="right",o,a="validation-popup",s,l;if(!this.element.parentElement.className.match("invalid-input")){this.element.parentElement.className+=" invalid-input"}if(!t)return;i=this.popupElem;if(!i){l=document.createElement("div");l.className="info-text";l.innerHTML=e;s=document.createElement("div");s.className="info message";s.appendChild(l);i=document.createElement("div");i.id=a;i.className="notification alert alert-warning material";o=this.element.parentElement.clientWidth-this.element.parentElement.offsetLeft;if(o<r){n+="left"}i.className+=" "+n;i.appendChild(s);this.popupElem=i;this.element.parentElement.appendChild(i)}else{l=i.querySelector(".info-text");l.innerHTML=e}};y.prototype.createLinkBox=function(e,t,i){var r=f(t,e,this.containerElement,this.showRealEditor.bind(this),this.$cancelEdit.bind(this),i);if(!c.isUrl(t)){r.hide();this.showRealEditor()}};i.mkMouseoverCellEditor=function(e){return new y(e.container)};i.mkMouseoverCellRenderer=function(){return new m};i.mkMouseoverTooltip=function(e){return new v(e.container)};i.$MouseoverCellRenderer=m},{"./cell_editor":91,"./cell_renderer":92,"./cell_tooltip":93,"./cell_type_util":96,"./lib/dom":117,"./lib/event_emitter":120,"./lib/oop":124,"./link_box":126,"./utils":143,"escape-html":"escape-html",lodash:70}],135:[function(e,t,i){"use strict";var r=e("./lib/event_emitter").EventEmitter;var n=e("lodash");var o=e("./lib/oop");var a=e("./cell_type_util");var s=e("./utils");var l=e("./text_cell_control").$TextCellEditor;var u=e("./cell_renderer");o.inherits(c,u);function c(){}o.inherits(d,l);function d(e){l.call(this,e);this.element.className="pivot_editable_cell percentage_cell"}d.prototype.initialize=function(e,t,i){var r,o,a;if(n.isObject(e)){o=e.data.value;r=o.edit&&o.edit.formattedValue||o.value.formattedValue;if(n.isUndefined(r)){r=""}}if(i){this.directCellTyping=true;this.element.value=i==="space"?"":i}else{this.directCellTyping=false;this.element.value=r}this.coord=s.getCoordFromTarget(t);this.validateValue(this.coord,i||r);this.initialCellValue=n.isNumber(r)?r.toString():r||""};d.prototype.$confirmEdit=function(e){var t=this.$getValue(),i=false;if(t==="")i=true;if(this.$editing){this._emit("confirm-edit",{value:t,delete:i,keyEvent:e});this.$editing=false}};i.mkPercentageCellRenderer=function(){return new c};i.mkPercentageCellEditor=function(e){return new d(e.container)};i.$PercentageCellRenderer=c;i.$PercentageCellEditor=d},{"./cell_renderer":92,"./cell_type_util":96,"./lib/event_emitter":120,"./lib/oop":124,"./text_cell_control":142,"./utils":143,lodash:70}],136:[function(e,t,i){"use strict";var r=e("./virtual_renderer").VirtualRenderer;i.config=e("./config");var n=e("./lib/oop");var o=e("./lib/dom");var a=e("./lib/useragent");var s=e("./keyboard/textinput").TextInput;var l=e("./mouse/mouse_handler").MouseHandler;var u=e("./keyboard/keybinding").KeyBinding;var c=e("./selection").Selection;var d=e("./lib/event_emitter").EventEmitter;var p=e("./commands/command_manager").CommandManager;var f=e("./commands/default_commands").commands;var h=e("./cell_type_manager").CellTypeManager;var g=e("./utils");var m=e("lodash");var v=e("clipboard-js");var y=e("./config");var b=e("./store/pivot_focus");var w=e("./constants").Direction;var C=e("./cell_type_registry").DisplayTypes;var E=65,S=20,T="Data load complete",x="Copy to Clipboard",_=2e3,M=50;var A=function(e,t){var i=this;this._id=m.uniqueId(e);this.container=t||o.createElement("div");this.menuContainer=o.createElement("div");this.container.appendChild(this.menuContainer);this.cellTypeManager=new h(this.container);var n={getCellRenderFn:this.cellTypeManager.getCellRenderFn.bind(this.cellTypeManager),getContentRenderFn:this.cellTypeManager.getContentRenderFn.bind(this.cellTypeManager)};this.renderer=new r(e,this.container,n);this.renderer.$verHeadingLayer.on("headingSelectionChanged",this.onHeadingSelectionChange.bind(this,this.createVerSelectionRange.bind(this)));this.renderer.$horHeadingLayer.on("headingSelectionChanged",this.onHeadingSelectionChange.bind(this,this.createHorSelectionRange.bind(this)));this.onPaste=function(e){if(!this.$copyInProgress&&!i.renderer.isCaretOnHeading()){i.renderer.showLoader("paste");setTimeout(function(){i.selection.copySelectionRange=null;i.renderer.onPaste(e);i.renderer.hideLoader("paste")})}};this.onEscape=function(){i.selection.copySelectionRange=null;i.renderer.showCopiedSelection()};this.commands=new p(a.isMac?"mac":"win",f);this.textInput=new s(this.container,this);this.keyBinding=new u(this);this.$mouseHandler=new l(this);this.$blockScrolling=0;this.$checkIsEditorVisible=m.debounce(function(){if(i.renderer.editing&&!i.$isCaretVisible()){i.stopEditing()}},100,{leading:false,trailing:true});this.$copyInProgress=false;this.$isCut=false;this.$onCopyReady=this.$onCopyReady.bind(this);y.resetOptions(this);y._emit("pivot",this)};(function(){n.implement(this,d);this.$getSelectionRange=function(){var e=this.provider.selection&&this.provider.selection.getRange();return g.convertToMultiAxisRange(e)};this.showContextMenu=function(e,t,i){var r=this.getContainingCell(e),n=this.isPivotCell(r),o=this.isHeadingCell(r),a,s;if(!(n||o)){return}a=g.getDataFromTarget(r);s={coords:{row:parseInt(a.row),col:parseInt(a.col)},x:t,y:i,selectionRange:this.$getSelectionRange()};if(o){s=m.extend(s,{axis:this.getHeadingCellAxis(r),isHeadingCell:true})}this._emit("contextMenu",s)};this.concatCells=function(e){var t,i,r,n="",o=this.cellTypeManager.getClipboardContentRenderFn.bind(this.cellTypeManager);for(t=0;t<e[0].length;t++){if(t>0){n+="\n"}for(i=0;i<e.length;i++){if(i>0){n+="\t"}if(typeof e[i][t][0]!=="undefined"){r=g.parseCellData(e[i][t][0],false);if(!r.invalid)n+=o(r.displayType)(r)}}}return n};this.getCopyText=function(e){var t,i=this.getMultiAxisSelectionRange();if(this.$copyInProgress){return}t=this.provider.getCopyData(i,e);if(t){this.selection.copySelectionRange=i;this.renderer.showCopiedSelection();this.$notificationsHandler.info("Data copied to clipboard","",null,{autoDismiss:3});return this.concatCells(t)}else{this.$isCut=e;this.$copyInProgress=true;this.renderer.showLoader("copy")}};this.$fireWhenNotUpdating=function(e,t){t=t||performance.now();var i=this,r=function(){if(!i.renderer.isUpdatingCells()){e()}else if(performance.now()-t<_){i.$fireWhenNotUpdating(e,t)}else{console.warn("Timed out trying to retrieve copy data while waiting for cell update to complete")}};setTimeout(r,M)};this.$onCopyReady=function(){var e=this,t;if(!e.$copyInProgress||e.renderer.isDialogVisible()){return}t=e.getMultiAxisSelectionRange();e.$fireWhenNotUpdating(function(){var i=e.provider.getCopyData(t,e.$isCut);if(i){i=e.concatCells(i);e.selection.copySelectionRange=t;e.renderer.showCopiedSelection()}else{i=""}e.renderer.hideLoader("copy");e.renderer.showDialog(T,x,function(){e.copyToClipboard(i);e.$copyInProgress=false})})};this.copyToClipboard=function(e){v.copy(e)};this.getMultiAxisSelectionRange=function(){var e=this.selection.getSelectionAnchor(),t=this.selection.getSelectionLead();return{X:{start:e.column<t.column?e.column:t.column,length:e.column<t.column?1+t.column-e.column:1+e.column-t.column},Y:{start:e.row<t.row?e.row:t.row,length:e.row<t.row?1+t.row-e.row:1+e.row-t.row}}};this.canReceiveMouseEvents=function(e){return this.isDataCell(e)||this.isHeadingCell(e)};this.isEditableHeader=function(e){if(this.isHeadingCell(e)){return this.getOption("editHeaders")}return false};this.isDataCell=function(e){return o.hasCssClass(e,"data_cell")};this.isPivotCell=function(e){return o.hasCssClass(e,"pivot_cell")};this.isHeadingCell=function(e){return o.hasCssClass(e,"heading_cell")};this.getHeadingCellAxis=function(e){return o.hasCssClass(e,"vertical_heading")?"Y":"X"};this.getHeadingCellAxisCoords=function(e){if(!e||!e.attributes)return;var t=e.attributes;return{row:Number(t.getNamedItem("data-row").value),col:Number(t.getNamedItem("data-col").value)}};this.shouldTriggerAlwaysEditing=function(e,t){if(!this.isDataCell(e))return false;var i=g.getDataFromTarget(e);return this.cellTypeManager.getRenderer(i.type||"text").shouldTriggerAlwaysEditing(t)};this.shouldTriggerTooltip=function(e,t){if(!this.isDataCell(e))return false;var i=g.getDataFromTarget(e);return this.cellTypeManager.getRenderer(i.type||"text").shouldTriggerTooltip(t)};this.getSelectedElement=function(){var e=this.renderer.isCaretOnHeading(),t,i,r;if(e){t=this.renderer.getHeadingLayerWithCaret();return t.getCaret()}else{i=this.selection.getCaret();r=this.renderer.absoluteToRelativeCoordinates(i.row,i.column);return this.renderer.getCellElement(r.row,r.column)}};this.getContainingCell=function(e){if(this.isPivotCell(e))return e;return o.findFirstParentWithClass(e,"pivot_cell")};this.onClearValue=function(e){var t=this.selection.anchor,i=this.selection.lead,r=this.selection.isEmpty(),n,o,a,s,l,u,c,d,p,f,h=[];if(r){o=this.getSelectedElement();a=this.renderer.isCaretOnHeading();l=g.getDataFromTarget(o);u=l.type==="text"?"":false;if(!a&&this.isEditableTarget(o))this.deleteDataCells([g.getCoordFromTarget(o)]);else if(!this.isEditableTarget(o))console.warn("That cell is not editable")}else{c=Math.min(i.row,t.row);d=Math.max(t.row,i.row);p=Math.min(i.column,t.column);f=Math.max(t.column,i.column);for(var m=c;m<=d;m++){for(var v=p;v<=f;v++){n=this.renderer.absoluteToRelativeCoordinates(m,v);o=this.renderer.getCellElement(n.row,n.column);if(this.isEditableTarget(o)){h.push({Y:m,X:v})}}}this.deleteDataCells(h)}};this.onCellTyping=function(e){var t=this.renderer.isCaretOnHeading(),i=this.getSelectedElement();if(!this.isEditableTarget(i))return;this.showEditor(i,t,!!this.renderer.vHeadingCaret,e.keyString)};this.getHeadingEditor=function(e,t,i){var r=this.cellTypeManager.getEditor("text"),n=this;if(this.isEmptyCell(e)){r.once("confirm-edit",function(e){n.addHeader(t,i);n.stopEditing()})}else{r.once("confirm-edit",function(e){n.editHeading(t,e.value,i);n.stopEditing()})}r.once("cancel-edit",function(e){n.stopEditing()});return r};this.getCellEditor=function(e,t){var i=t.type,r=this.cellTypeManager.getEditor(i||"text"),n=this;if(!r){return null}r.on("confirm-edit",function(e){n.editDataCell(e.value,Number(t.row),Number(t.col));if(e.keyEvent){if(e.keyEvent.shiftKey){if(e.keyEvent.keyCode===13)n.navigateUp();if(e.keyEvent.keyCode===9)n.navigatePrev()}else{switch(e.keyEvent.keyCode){case 37:n.navigateLeft();break;case 38:n.navigateUp();break;case 13:case 40:case 46:n.navigateDown();break;case 39:n.navigateRight();break;case 9:n.navigateNext();break;default:n.navigateRight();break}}}n.stopEditing()});r.on("cancel-edit",function(e){n.stopEditing()});return r};this.showEditor=function(e,t,i,r){var n,o;e=this.$getTargetCellElement(e);n=g.getDataFromTarget(e);if(!this.isEditableTarget(e)&&n.type!==C.LINK&&n.type!==C.MOUSEOVER){return}if(!this.cellTypeManager.hasEditor(n.type||C.TEXT)){return}this.renderer.editing=true;if(this.currentEditor){this.currentEditor.hide();this.currentEditor.removeAllListeners("confirm-edit");this.currentEditor.removeAllListeners("cancel-edit")}if(t){o=this.getHeadingEditor(e,i,g.getPositionFromTarget(e))}else{o=this.getCellEditor(e,n)}this.currentEditor=o;this.currentEditor.show();this.currentEditor.renderOver(e);this.currentEditor.initialize(this.provider.getCellData(g.getCoordFromTarget(e)),e,r);this.currentEditor.focus()};this.$getTargetCellElement=function(e){var t=e&&e.offsetParent,i;if(t&&o.hasCssClass(t,"tooltip-container")){i=g.getPositionFromTarget(e);return this.renderer.getCellElement(i.row,i.column)}return e};this.getCellTooltip=function(e,t){return this.cellTypeManager.getTooltip(t.type||"text")};this.showTooltip=function(e,t){var i=g.getDataFromTarget(e),r;this.currentTooltip&&this.currentTooltip.hide();r=this.getCellTooltip(e,i);this.currentTooltip=r;this.currentTooltip.show();this.currentTooltip.render(e,t,i);this.currentTooltip.initialize()};this.hideTooltip=function(){this.currentTooltip&&this.currentTooltip.hide()};this.isEditableTarget=function(e){return!this._locked&&(o.hasCssClass(e,"editable")&&!o.hasCssClass(e,"spinner")||this.isEmptyCell(e))};this.isEmptyCell=function(e){return o.hasCssClass(e,"empty_cell")};this.stopEditing=function(){this.renderer.editing=false;this.currentEditor&&this.currentEditor.hide();this.focus()};function e(e,t){return!!e[t]}this.editHeading=function(e,t,i){t=t.trim();if(t!==""){this._emit("editHeader",{axis:e,coord:i,value:t})}};this.deleteDataCells=function(e){this.selection.copySelectionRange=null;this.provider.deleteCells(e)};this.editDataCell=function(e,t,i){this.selection.copySelectionRange=null;e=e&&e.charCodeAt&&e.charCodeAt()===160?"":e;this.provider.editCells([{coord:{Y:t,X:i},value:e}])};this.onEnterKey=function(){var e,t;if(this.renderer.hHeadingCaret){}else if(this.renderer.vHeadingCaret){}else{this.navigateDown()}};this.addHeader=function(e,t){var i=e==="X"?this.renderer.$horHeadingLayer:this.renderer.$verHeadingLayer;if(this.getOption("addHeader")&&i.caretSelection.isLastChild(t.start.x,t.start.y)){this._emit("addHeader",{axis:e,coord:{x:t.start.x,y:t.start.y}});this.renderer.once("afterRender",function(){i.moveDown()})}};this.setDataProvider=function(e){var t;if(this.provider){t=this.provider;if(this.provider.off){this.provider.off("updateModel",this.$onModelChange);this.selection.off("changeCaret",this.$onCaretChange);this.selection.off("changeSelection",this.$onSelectionChange)}}this.provider=e;this.cellTypeManager.setDataProvider(e);this.renderer.setDataProvider(e);this.selection=new c(this);this.provider.selection=this.selection;this.$onCaretChange=this.onCaretChange.bind(this);this.selection.on("changeCaret",this.$onCaretChange);this.$onSelectionChange=this.onSelectionChange.bind(this);this.selection.on("changeSelection",this.$onSelectionChange);this.$onModelChange=this.onModelChange.bind(this);if(this.provider.on){this.provider.on("updateModel",this.$onModelChange);this.provider.on("copyReady",this.$onCopyReady)}this.$blockScrolling+=1;this.onCaretChange();this.$blockScrolling-=1;this.onScrollTopChange();this.onScrollLeftChange();this.onSelectionChange();this.renderer.updateFull();this._emit("changeDataProvider",{provider:e,oldProvider:t})};this.setNotificationsHandler=function(e){this.$notificationsHandler=e};this.getLength=function(){return this.renderer.$verHeadingLayer.length};this.getLine=function(e){return{length:this.renderer.$horHeadingLayer.length-1}};this.getDataProvider=function(){return this.provider};this.getSelection=function(){return this.selection};this.resize=function(e){var t=this;this.renderer.once("renderComplete",this.$checkIsEditorVisible);this.renderer.onResize(e)};this.$isCaretVisible=function(){var e=this.getCaretPosition();return e&&this.renderer.isCellInVisibleRange(e.row,e.column)};this.getMinCellWidth=function(){return E};this.getMinCellHeight=function(){return S};this.setColumnHeaderWidth=function(e,t,i){e=Math.max(e,this.getMinCellWidth());this.renderer.setColumnHeaderWidth(e,t,i)};this.setColumnHeaderHeight=function(e,t){e=Math.max(e,this.getMinCellHeight());this.renderer.setColumnHeaderHeight(e,t)};this.setRowHeaderWidth=function(e,t){e=Math.max(e,this.getMinCellWidth());this.renderer.setRowHeaderWidth(e,t)};this.setRowHeaderHeight=function(e,t,i){e=Math.max(e,this.getMinCellHeight());this.renderer.setRowHeaderHeight(e,t,i)};this.focus=function(e){if(e){b.set(this._id)}var t=b.get();if(this._id!==t)return;var i=this;setTimeout(function(){i.textInput.focus()});i.textInput.focus()};this.isFocused=function(){return this.textInput.isFocused()};this.blur=function(){this.textInput.blur()};this.onFocus=function(){if(this.$isFocused)return;this.$isFocused=true;this.renderer.visualizeFocus();this.renderer.showSelection();this._emit("focus")};this.onBlur=function(){if(!this.$isFocused)return;this.$isFocused=false;this.renderer.visualizeBlur();this.renderer.hideSelection();this._emit("blur")};this.onScrollTopChange=function(){this.renderer.scrollToY(this.renderer.getScrollTop())};this.onScrollLeftChange=function(){this.renderer.scrollToX(this.renderer.getScrollLeft())};this.onModelChange=function(){this.renderer.updateFull()};this.$caretChange=function(){this.renderer.updateHeadings();this.renderer.updateCaret()};this.onCaretChange=function(){this.$caretChange();if(!this.$blockScrolling){this.renderer.scrollCaretIntoView()}this._emit("changeSelection")};this.onSelectionChange=function(e){this.onCaretChange()};this.execCommand=function(e,t){this.commands.exec(e,this,t)};this.onTextInput=function(e){if(this.$copyInProgress){return}this.keyBinding.onTextInput(e)};this.onCommandKey=function(e,t,i){if(this.$copyInProgress){return}this.keyBinding.onCommandKey(e,t,i)};this.insertEntityOption=function(e,t){};this.removeEntityOption=function(e,t){};this.onHeadingSelectionChange=function(e){var t=e();this.renderer.updateHeadings();this.$blockScrolling++;this.selection.setSelectionRange(t);this.$blockScrolling--};this.createVerSelectionRange=function(){var e=this.renderer.$horHeadingLayer,t=this.renderer.$verHeadingLayer;return{start:{column:0,row:t.$selectionRange.from},end:{column:e.length,row:t.$selectionRange.to}}};this.createHorSelectionRange=function(){var e=this.renderer.$horHeadingLayer,t=this.renderer.$verHeadingLayer;return{start:{column:e.$selectionRange.from,row:0},end:{column:e.$selectionRange.to,row:t.length}}};this.$getSelectedRows=function(){var e=this.getSelectionRange().collapseRows();return{first:e.start.row,last:e.end.row}};this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()};this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()};this.isRowVisible=function(e){return e>=this.getFirstVisibleRow()&&e<=this.getLastVisibleRow()};this.isRowFullyVisible=function(e){return e>=this.renderer.getFirstFullyVisibleRow()&&e<=this.renderer.getLastFullyVisibleRow()};this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1};this.$moveByPage=function(e,t){var i=this.renderer;var r=this.renderer.layerConfig;var n=this.selection.getCaret();var o=this.renderer.$verHeadingLayer;var a,s,l,u,c;if(e>0){var d=Math.min(r.lastRow,this.renderer.getLastFullyVisibleRow()+1);if(n.row==o.length-1)return;if(n.row>=d){a=r.vRange.offset+r.height;s=o.getRange(a,a+r.height);l=s.length+s.index-n.row-1}else{c=o.findOffsetAtIndex(d+1);s=o.getRange(c-r.height,c);l=d-n.row}}else{var p=Math.max(r.firstRow,this.renderer.getFirstFullyVisibleRow()-1);if(n.row===0)return;if(n.row<=p+1){a=r.vRange.offset-r.height;s=o.getRange(a,a+r.height);l=s.index-n.row}else{c=o.findOffsetAtIndex(p);s=o.getRange(c,c+r.height);l=p-n.row}}this.$blockScrolling++;if(t===true){this.selection.$moveSelection(function(){this.moveCaretBy(l,0)})}else if(t===false){this.selection.moveCaretBy(l,0);this.selection.clearSelection()}this.$blockScrolling--;var f=i.scrollTop;n=this.selection.getCaret();u=e>0?o.findOffsetAtIndex(Math.min(o.length-1,n.row+1))-r.height:o.findOffsetAtIndex(n.row);i.setScrollTop(u);if(t!==null){i.scrollCaretIntoView(null,.5)}i.animateScrolling(f)};this.selectPageDown=function(){this.$moveByPage(1,true)};this.selectPageUp=function(){this.$moveByPage(-1,true)};this.gotoPageDown=function(){this.$moveByPage(1,false)};this.gotoPageUp=function(){this.$moveByPage(-1,false)};this.scrollPageDown=function(){this.$moveByPage(1)};this.scrollPageUp=function(){this.$moveByPage(-1)};this.scrollToRow=function(e,t,i,r){this.renderer.scrollToRow(e,t,i,r)};this.scrollToColumn=function(e,t,i,r){this.renderer.scrollToColumn(e,t,i,r)};this.centerSelection=function(){var e=this.getSelectionRange();var t={row:Math.floor(e.start.row+(e.end.row-e.start.row)/2),column:Math.floor(e.start.column+(e.end.column-e.start.column)/2)};this.renderer.alignCaret(t,.5)};this.getCaretPosition=function(){return this.selection.getCaret()};this.getCaretPositionScreen=function(){return this.session.documentToScreenPosition(this.getCaretPosition())};this.getSelectionRange=function(){return this.selection.getRange()};this.selectAll=function(){this.$blockScrolling+=1;this.selection.selectAll();this.$blockScrolling-=1};this.clearSelection=function(){this.selection.clearSelection()};this.moveCaretTo=function(e,t){this.selection.moveCaretTo(e,t)};this.moveCaretToPosition=function(e){this.selection.moveCaretToPosition(e)};this.gotoRow=function(e,t,i){this.selection.clearSelection();if(t===undefined)t=this.selection.getCaret().column;this.$blockScrolling+=1;this.moveCaretTo(e-1,t||0);this.$blockScrolling-=1;if(!this.isRowFullyVisible(e-1))this.scrollToRow(e-1,true,i)};this.navigateTo=function(e,t){this.clearSelection();this.moveCaretTo(e,t)};this.moveToDataGrid=function(e,t,i){i.removeCaret();this.moveCaretToPosition({row:e,column:t});this.selection.clearSelection()};this.selectHeadingCell=function(e){var t=e?this.renderer.$verHeadingLayer:this.renderer.$horHeadingLayer,i=e?"row":"column",r,n;if(!t.canAcceptSelection())return;r=this.selection.lead.getPosition()[i];n=t.getColumnSizesAtNode(t.findNodeByIndex(r)).length-1;t.caretSelection.setSelection(n,r)};this.executeIfUnlocked=function(e){return this._locked?false:e&&e()};this.navigateUp=function(e){var t,i=this.getSelectedElement();e=e||1;if(this.isEmptyCell(i))return;if(this.renderer.hHeadingCaret){t=this.renderer.$horHeadingLayer;t.moveLeft()}else if(this.renderer.vHeadingCaret){t=this.renderer.$verHeadingLayer;t.moveUp()}else if(this.selection.lead.getPosition().row===0){this.selectHeadingCell(false)}else{this.selection.moveCaretBy(-e,0);this.selection.clearSelection()}};this.navigateDown=function(e){var t,i,r;e=e||1;if(this.renderer.hHeadingCaret){t=this.renderer.$horHeadingLayer;i=t.caretSelection.getSelection();r=t.getColumnSizesAtNode(t.findNodeByIndex(i.start.y)).length;if(i.start.x===r-1){this.moveToDataGrid(0,i.start.y,t)}else{t.moveRight()}}else if(this.renderer.vHeadingCaret){t=this.renderer.$verHeadingLayer;t.moveDown()}else{this.selection.getCaret();this.selection.moveCaretBy(e,0);this.selection.clearSelection()}};this.navigateLeft=function(e){var t,i=this.getSelectedElement();e=e||1;if(this.isEmptyCell(i))return;if(this.renderer.hHeadingCaret){t=this.renderer.$horHeadingLayer;t.moveUp()}else if(this.renderer.vHeadingCaret){t=this.renderer.$verHeadingLayer;t.moveLeft()}else if(this.selection.lead.getPosition().column===0){this.selectHeadingCell(true)}else{while(e--){this.selection.moveCaretLeft()}this.clearSelection()}};this.navigateRight=function(e){var t,i=this.getSelectedElement(),r,n;e=e||1;if(this.isEmptyCell(i))return;if(this.renderer.hHeadingCaret){t=this.renderer.$horHeadingLayer;t.moveDown()}else if(this.renderer.vHeadingCaret){t=this.renderer.$verHeadingLayer;r=t.caretSelection.getSelection();n=t.getColumnSizesAtNode(t.findNodeByIndex(r.start.y)).length;if(r.start.x===n-1){this.moveToDataGrid(r.start.y,0,t)}else{t.moveRight()}}else{while(e--){this.selection.moveCaretRight()}this.clearSelection()}};this.isCaretInLastColumn=function(){var e=this.selection.getCaret(),t=this.selection.getColumnLength();return e&&e.column===t};this.isCaretInLastRow=function(){var e=this.selection.getCaret(),t=this.selection.getRowLength()-1;return e&&e.row===t};this.isCaretInFirstColumn=function(){var e=this.selection.getCaret();return e&&e.column===0};this.isCaretInFirstRow=function(){var e=this.selection.getCaret();return e&&e.row===0};this.navigateNext=function(e){var t=this.getOption("moveSelectionDirection"),i=I[t];e=e||1;if(i.isCaretInLastCell(this)){i.navigateNextColRow(this);e-=1}if(e){i.navigateNextCell(e,this)}};this.navigatePrev=function(e){var t=this.getOption("moveSelectionDirection"),i=I[t];e=e||1;if(i.isCaretInFirstCell(this)){i.navigatePrevColRow(this);e-=1}if(e){i.navigatePrevCell(e,this)}};this.navigateRowStart=function(){this.selection.moveCaretRowStart();this.clearSelection()};this.navigateRowEnd=function(){this.selection.moveCaretRowEnd();this.clearSelection()};this.navigateColumnStart=function(){this.selection.moveCaretColumnStart();this.clearSelection()};this.navigateColumnEnd=function(){this.selection.moveCaretColumnEnd();this.clearSelection()};this.navigateFileEnd=function(){var e=this.renderer.scrollTop;this.selection.moveCaretFileEnd();this.clearSelection();this.renderer.animateScrolling(e)};this.navigateFileStart=function(){var e=this.renderer.scrollTop;this.selection.moveCaretFileStart();this.clearSelection();this.renderer.animateScrolling(e)};this.revealRange=function(e,t){this.$blockScrolling+=1;this.session.unfold(e);this.selection.setSelectionRange(e);this.$blockScrolling-=1;var i=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(e.start,e.end,.5);if(t!=false)this.renderer.animateScrolling(i)};this.undo=function(){this.$blockScrolling++;this.session.getUndoManager().undo();this.$blockScrolling--;this.renderer.scrollCaretIntoView(null,.5)};this.redo=function(){this.$blockScrolling++;this.session.getUndoManager().redo();this.$blockScrolling--;this.renderer.scrollCaretIntoView(null,.5)};this.getReadOnly=function(){return this.getOption("readOnly")};this.destroy=function(){cellTypeManager.destroyEditors();this.renderer.destroy();this._emit("destroy",this)};this.setHorHeadingVisible=function(e){this.renderer.setHorHeadingVisible(e)};this.setVerHeadingVisible=function(e){this.renderer.setVerHeadingVisible(e)};this.setAlignment=function(e,t,i){this.renderer.setAlignment(e,t,i)};this.setDefaultAlignment=function(e,t){this.renderer.setDefaultAlignment(e,t)};this.lockEditing=function(){this._locked=true};this.unlockEditing=function(){this._locked=false};this.setAutoScrollEditorIntoView=function(e){if(e===false)return;var t;var i=this;var r=false;if(!this.$scrollAnchor)this.$scrollAnchor=document.createElement("div");var n=this.$scrollAnchor;n.style.cssText="position:absolute";this.container.insertBefore(n,this.container.firstChild);var o=this.on("changeSelection",function(){r=true});var a=this.renderer.on("beforeRender",function(){if(r)t=i.renderer.container.getBoundingClientRect()});var s=this.renderer.on("afterRender",function(){if(r&&t&&i.isFocused()){var e=i.renderer;var o=e.$CaretLayer.$pixelPos;var a=e.layerConfig;var s=o.top-a.offset;if(o.top>=0&&s+t.top<0){r=true}else if(o.top<a.height&&o.top+t.top+a.rowHeight>window.innerHeight){r=false}else{r=null}if(r!=null){n.style.top=s+"px";n.style.left=o.left+"px";n.style.height=a.rowHeight+"px";n.scrollIntoView(r)}r=t=null}});this.setAutoScrollEditorIntoView=function(e){if(e===true)return;delete this.setAutoScrollEditorIntoView;this.off("changeSelection",o);this.renderer.off("afterRender",s);this.renderer.off("beforeRender",a)}}}).call(A.prototype);y.defineOptions(A.prototype,"pivot",{toggle:{set:function(e){},initialValue:false},readOnly:{set:function(e){this.textInput.setReadOnly(e)},initialValue:false},animatedScroll:"renderer",scrollSpeed:"$mouseHandler",addHeaders:{set:function(e){},initialValue:true},editHeaders:{set:function(e){},initialValue:true},moveSelectionDirection:{set:function(e){this.$moveSelectionDirection=e},get:function(){return this.$moveSelectionDirection||w.RIGHT},initialValue:w.RIGHT}});var I={};I[w.RIGHT]={navigateNextCell:function(e,t){!t.isCaretInLastColumn()&&t.navigateRight(e)},navigatePrevCell:function(e,t){!t.isCaretInFirstColumn()&&t.navigateLeft(e)},navigateNextColRow:function(e){e.navigateDown();e.navigateRowStart()},navigatePrevColRow:function(e){e.navigateUp();e.navigateRowEnd()},isCaretInLastCell:function(e){return e.isCaretInLastColumn()&&!e.isCaretInLastRow()},isCaretInFirstCell:function(e){return e.isCaretInFirstColumn()&&!e.isCaretInFirstRow()}};I[w.LEFT]={navigateNextCell:function(e,t){!t.isCaretInFirstColumn()&&t.navigateLeft()},navigatePrevCell:function(e,t){!t.isCaretInLastColumn()&&t.navigateRight()},navigateNextColRow:function(e){e.navigateDown();e.navigateRowEnd()},navigatePrevColRow:function(e){e.navigateUp();e.navigateRowStart()},isCaretInLastCell:function(e){return e.isCaretInFirstColumn()&&!e.isCaretInLastRow()},isCaretInFirstCell:function(e){return!e.isCaretInFirstRow()&&e.isCaretInLastColumn()}};I[w.DOWN]={navigateNextCell:function(e,t){!t.isCaretInLastRow()&&t.navigateDown(e)},navigatePrevCell:function(e,t){!t.isCaretInFirstRow()&&t.navigateUp(e)},navigateNextColRow:function(e){e.navigateRight();e.navigateColumnStart()},navigatePrevColRow:function(e){e.navigateLeft();e.navigateColumnEnd()},isCaretInLastCell:function(e){return!e.isCaretInLastColumn()&&e.isCaretInLastRow()},isCaretInFirstCell:function(e){return!e.isCaretInFirstColumn()&&e.isCaretInFirstRow()}};I[w.UP]={navigateNextCell:function(e,t){!t.isCaretInFirstRow()&&t.navigateUp(e)},navigatePrevCell:function(e,t){!t.isCaretInLastRow()&&t.navigateDown(e)},navigateNextColRow:function(e){e.navigateRight();e.navigateColumnEnd()},navigatePrevColRow:function(e){e.navigateLeft();e.navigateColumnStart()},isCaretInLastCell:function(e){return!e.isCaretInLastColumn()&&e.isCaretInFirstRow()},isCaretInFirstCell:function(e){return!e.isCaretInFirstColumn()&&e.isCaretInLastRow();
}};t.exports=A},{"./cell_type_manager":94,"./cell_type_registry":95,"./commands/command_manager":99,"./commands/default_commands":100,"./config":101,"./constants":102,"./keyboard/keybinding":107,"./keyboard/textinput":108,"./lib/dom":117,"./lib/event_emitter":120,"./lib/oop":124,"./lib/useragent":125,"./mouse/mouse_handler":132,"./selection":140,"./store/pivot_focus":141,"./utils":143,"./virtual_renderer":144,"clipboard-js":"clipboard-js",lodash:70}],137:[function(e,t,i){"use strict";var r=function(e,t){return e.row-t.row||e.column-t.column};var n=function(e,t,i,r){this.start={row:e,column:t};this.end={row:i,column:r}};(function(){this.isEqual=function(e){return this.start.row===e.start.row&&this.end.row===e.end.row&&this.start.column===e.start.column&&this.end.column===e.end.column};this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"};this.contains=function(e,t){return this.compare(e,t)==0};this.compareRange=function(e){var t,i=e.end,r=e.start;t=this.compare(i.row,i.column);if(t==1){t=this.compare(r.row,r.column);if(t==1){return 2}else if(t==0){return 1}else{return 0}}else if(t==-1){return-2}else{t=this.compare(r.row,r.column);if(t==-1){return-1}else if(t==1){return 42}else{return 0}}};this.comparePoint=function(e){return this.compare(e.row,e.column)};this.containsRange=function(e){return this.comparePoint(e.start)==0&&this.comparePoint(e.end)==0};this.intersects=function(e){var t=this.compareRange(e);return t==-1||t==0||t==1};this.isEnd=function(e,t){return this.end.row==e&&this.end.column==t};this.isStart=function(e,t){return this.start.row==e&&this.start.column==t};this.setStart=function(e,t){if(typeof e=="object"){this.start.column=e.column;this.start.row=e.row}else{this.start.row=e;this.start.column=t}};this.setEnd=function(e,t){if(typeof e=="object"){this.end.column=e.column;this.end.row=e.row}else{this.end.row=e;this.end.column=t}};this.inside=function(e,t){if(this.compare(e,t)==0){if(this.isEnd(e,t)||this.isStart(e,t)){return false}else{return true}}return false};this.insideStart=function(e,t){if(this.compare(e,t)==0){if(this.isEnd(e,t)){return false}else{return true}}return false};this.insideEnd=function(e,t){if(this.compare(e,t)==0){if(this.isStart(e,t)){return false}else{return true}}return false};this.compare=function(e,t){if(!this.isMultiLine()){if(e===this.start.row){return t<this.start.column?-1:t>this.end.column?1:0}}if(e<this.start.row)return-1;if(e>this.end.row)return 1;if(this.start.row===e)return t>=this.start.column?0:-1;if(this.end.row===e)return t<=this.end.column?0:1;return 0};this.compareStart=function(e,t){if(this.start.row==e&&this.start.column==t){return-1}else{return this.compare(e,t)}};this.compareEnd=function(e,t){if(this.end.row==e&&this.end.column==t){return 1}else{return this.compare(e,t)}};this.compareInside=function(e,t){if(this.end.row==e&&this.end.column==t){return 1}else if(this.start.row==e&&this.start.column==t){return-1}else{return this.compare(e,t)}};this.clipRows=function(e,t){if(this.end.row>t)var i={row:t+1,column:0};else if(this.end.row<e)var i={row:e,column:0};if(this.start.row>t)var r={row:t+1,column:0};else if(this.start.row<e)var r={row:e,column:0};return n.fromPoints(r||this.start,i||this.end)};this.extend=function(e,t){var i=this.compare(e,t);if(i==0)return this;else if(i==-1)var r={row:e,column:t};else var o={row:e,column:t};return n.fromPoints(r||this.start,o||this.end)};this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column};this.isMultiLine=function(){return this.start.row!==this.end.row};this.clone=function(){return n.fromPoints(this.start,this.end)};this.collapseRows=function(){if(this.end.column==0)return new n(this.start.row,0,Math.max(this.start.row,this.end.row-1),0);else return new n(this.start.row,0,this.end.row,0)};this.toScreenRange=function(e){var t=e.documentToScreenPosition(this.start);var i=e.documentToScreenPosition(this.end);return new n(t.row,t.column,i.row,i.column)};this.moveBy=function(e,t){this.start.row+=e;this.start.column+=t;this.end.row+=e;this.end.column+=t}}).call(n.prototype);n.fromPoints=function(e,t){return new n(e.row,e.column,t.row,t.column)};n.comparePoints=r;n.comparePoints=function(e,t){return e.row-t.row||e.column-t.column};i.Range=n},{}],138:[function(e,t,i){"use strict";var r=e("./lib/event");var n=function(e,t,i){this.onRender=e;this.onComplete=t;this.pending=false;this.changes=0;this.window=i||window};(function(){this.schedule=function(e){this.changes=this.changes|e;if(!this.pending){this.pending=true;var t=this;r.nextFrame(function(){var e,i=performance.now();t.pending=false;while(e=t.changes){t.changes=0;t.onRender(e)}r.nextFrame(t.onComplete.bind(t),t.window);console.log("RenderFrame time taken: "+(performance.now()-i))})}}}).call(n.prototype);i.RenderLoop=n},{"./lib/event":119}],139:[function(e,t,i){"use strict";var r=e("./lib/oop");var n=e("./lib/dom");var o=e("./lib/event");var a=e("./lib/event_emitter").EventEmitter;var s=function(e){this.element=n.createElement("div");this.element.className="ace_scrollbar";this.inner=n.createElement("div");this.inner.className="ace_scrollbar-inner";this.element.appendChild(this.inner);e.appendChild(this.element);this.width=n.scrollbarWidth(e.ownerDocument);this.fullWidth=this.width;this.inner.style.width=this.element.style.width=(this.width||15)+5+"px";this.setVisible(false);this.element.style.overflowY="scroll";o.addListener(this.element,"scroll",this.onScrollV.bind(this))};var l=function(e){this.element=n.createElement("div");this.element.className="ace_scrollbar-h";this.inner=n.createElement("div");this.inner.className="ace_scrollbar-inner";this.element.appendChild(this.inner);e.appendChild(this.element);this.height=n.scrollbarWidth(e.ownerDocument);this.fullHeight=this.height;this.inner.style.height=this.element.style.height=(this.height||15)+5+"px";this.setVisible(false);this.element.style.overflowX="scroll";o.addListener(this.element,"scroll",this.onScrollH.bind(this))};(function(){r.implement(this,a);this.setVisible=function(e){if(e){this.element.style.display="";if(this.fullWidth)this.width=this.fullWidth;if(this.fullHeight)this.height=this.fullHeight}else{this.element.style.display="none";this.height=this.width=0}};this.onScrollV=function(){this.scrollTop=this.element.scrollTop;this._emit("scroll",{data:this.scrollTop})};this.onScrollH=function(){this.scrollLeft=this.element.scrollLeft;this._emit("scroll",{data:this.scrollLeft})};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.setHeight=function(e){this.element.style.height=e+"px"};this.setWidth=function(e){this.element.style.width=e+"px"};this.setInnerHeight=function(e){this.inner.style.height=e+"px"};this.setInnerWidth=function(e){this.inner.style.width=e+"px"};this.setScrollTop=function(e){if(this.scrollTop!=e){this.scrollTop=this.element.scrollTop=e}};this.setScrollLeft=function(e){if(this.scrollLeft!=e){this.scrollLeft=this.element.scrollLeft=e}}}).call(s.prototype);l.prototype=s.prototype;i.ScrollBar=s;i.ScrollBarV=s;i.ScrollBarH=l},{"./lib/dom":117,"./lib/event":119,"./lib/event_emitter":120,"./lib/oop":124}],140:[function(e,t,i){"use strict";var r=e("./lib/oop");var n=e("./lib/lang");var o=e("./lib/event_emitter").EventEmitter;var a=e("./range").Range;var s=e("./anchor").Anchor;var l=function(e){this.pivot=e;this.clearSelection();this.lead=this.selectionLead=new s(e,0,0);this.anchor=this.selectionAnchor=new s(e,0,0);var t=this;this.lead.on("change",function(e){t._emit("changeCaret");if(!t.$isEmpty)t._emit("changeSelection");if(!t.$keepDesiredColumnOnChange&&e.old.column!=e.value.column)t.$desiredColumn=null});this.selectionAnchor.on("change",function(){if(!t.$isEmpty)t._emit("changeSelection")})};(function(){r.implement(this,o);this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column};this.isMultiRow=function(){if(this.isEmpty()){return false}return this.getRange().isMultiLine()};this.getCaret=function(){return this.lead.getPosition()};this.setSelectionAnchor=function(e,t){this.anchor.setPosition(e,t);if(this.$isEmpty){this.$isEmpty=false;this._emit("changeSelection")}};this.getSelectionAnchor=function(){if(this.$isEmpty)return this.getSelectionLead();else return this.anchor.getPosition()};this.getSelectionLead=function(){return this.lead.getPosition()};this.shiftSelection=function(e){if(this.$isEmpty){this.moveCaretTo(this.lead.row,this.lead.column+e);return}var t=this.getSelectionAnchor();var i=this.getSelectionLead();var r=this.isBackwards();if(!r||t.column!==0)this.setSelectionAnchor(t.row,t.column+e);if(r||i.column!==0){this.$moveSelection(function(){this.moveCaretTo(i.row,i.column+e)})}};this.isBackwards=function(){var e=this.anchor;var t=this.lead;return e.row>t.row||e.row==t.row&&e.column>t.column};this.getRange=function(){var e=this.anchor;var t=this.lead;if(this.isEmpty())return a.fromPoints(t,t);if(this.isBackwards()){return a.fromPoints(t,e)}else{return a.fromPoints(e,t)}};this.clearSelection=function(){if(!this.$isEmpty){this.$isEmpty=true;this._emit("changeSelection")}if(this.selectionLead){this.setSelectionAnchor(this.selectionLead.row,this.selectionLead.column)}};this.selectAll=function(){var e=this.getRowLength()-1;this.setSelectionAnchor(0,0);this.moveCaretTo(e,this.getColumnLength())};this.setRange=this.setSelectionRange=function(e,t){if(t){this.setSelectionAnchor(e.end.row,e.end.column);this.selectTo(e.start.row,e.start.column)}else{this.setSelectionAnchor(e.start.row,e.start.column);this.selectTo(e.end.row,e.end.column)}this.$desiredColumn=null};this.$moveSelection=function(e){var t=this.lead;if(this.$isEmpty)this.setSelectionAnchor(t.row,t.column);e.call(this)};this.selectTo=function(e,t){this.$moveSelection(function(){this.moveCaretTo(e,t)})};this.selectToPosition=function(e){this.$moveSelection(function(){this.moveCaretToPosition(e)})};this.selectUp=function(){this.$moveSelection(this.moveCaretUp)};this.selectDown=function(){this.$moveSelection(this.moveCaretDown)};this.selectRight=function(){this.$moveSelection(this.moveCaretRight)};this.selectLeft=function(){this.$moveSelection(this.moveCaretLeft)};this.selectRowStart=function(){this.$moveSelection(this.moveCaretRowStart)};this.selectRowEnd=function(){this.$moveSelection(this.moveCaretRowEnd)};this.selectFileEnd=function(){this.$moveSelection(this.moveCaretFileEnd)};this.selectFileStart=function(){this.$moveSelection(this.moveCaretFileStart)};this.getRowRange=function(e){var t=typeof e=="number"?e:this.lead.row;return new a(t,0,t,this.getColumnLength())};this.selectRow=function(){this.setSelectionRange(this.getRowRange())};this.moveCaretUp=function(){this.moveCaretBy(-1,0)};this.moveCaretDown=function(){this.moveCaretBy(1,0)};this.moveCaretLeft=function(){var e=this.lead.getPosition();if(e.column==0){return}else{this.moveCaretBy(0,-1)}};this.getRowLength=function(){return this.pivot.renderer.$verHeadingLayer.length};this.getColumnLength=function(){return this.pivot.renderer.$horHeadingLayer.length-1};this.moveCaretRight=function(){if(this.lead.column==this.getColumnLength()){return}else{this.moveCaretBy(0,1)}};this.moveCaretRowStart=function(){var e=this.lead.row;this.moveCaretToPosition({row:e,column:0})};this.moveCaretRowEnd=function(){this.moveCaretTo(this.lead.row,this.getColumnLength())};this.moveCaretColumnStart=function(){var e=this.lead.column;this.moveCaretToPosition({row:0,column:e})};this.moveCaretColumnEnd=function(){this.moveCaretTo(this.getRowLength(),this.lead.column)};this.moveCaretFileEnd=function(){var e=this.getRowLength()-1;var t=this.getColumnLength();this.moveCaretTo(e,t)};this.moveCaretFileStart=function(){this.moveCaretTo(0,0)};this.moveCaretBy=function(e,t){this.moveCaretTo(this.lead.row+e,this.lead.column+t,t===0)};this.moveCaretToPosition=function(e){this.moveCaretTo(e.row,e.column)};this.moveCaretTo=function(e,t,i){this.$keepDesiredColumnOnChange=true;this.lead.setPosition(Math.max(0,e),Math.max(0,t));this.$keepDesiredColumnOnChange=false;if(!i)this.$desiredColumn=null;this.pivot._emit("caretMoved",{row:e,column:t})};this.moveCaretToScreen=function(e,t,i){var r=this.session.screenToDocumentPosition(e,t);this.moveCaretTo(r.row,r.column,i)};this.detach=function(){this.lead.detach();this.anchor.detach();this.session=this.doc=null};this.fromOrientedRange=function(e){this.setSelectionRange(e,e.cursor==e.start);this.$desiredColumn=e.desiredColumn||this.$desiredColumn};this.toOrientedRange=function(e){var t=this.getRange();if(e){e.start.column=t.start.column;e.start.row=t.start.row;e.end.column=t.end.column;e.end.row=t.end.row}else{e=t}e.cursor=this.isBackwards()?e.start:e.end;e.desiredColumn=this.$desiredColumn;return e}}).call(l.prototype);i.Selection=l},{"./anchor":89,"./lib/event_emitter":120,"./lib/lang":122,"./lib/oop":124,"./range":137}],141:[function(e,t,i){"use strict";var r=null;t.exports={set:function(e){r=e},get:function(){return r}}},{}],142:[function(e,t,i){"use strict";var r=e("./lib/event_emitter").EventEmitter;var n=e("lodash");var o=e("./lib/oop");var a=e("./cell_type_util");var s=e("./cell_renderer");var l=e("./cell_editor");var u=e("assert");var c=e("./lib/event");var d=e("./lib/dom");var p=e("./utils");var f=function(){};o.inherits(f,s);f.prototype.shouldTriggerTooltip=function(e){var t=e&&e.scrollWidth-e.clientWidth;return t>1||d.hasCssClass(e,"invalid_cell")};o.inherits(h,l);o.implement(h.prototype,r);function h(e){var t=this;this.initialCellValue=null;this.container=e;this.element=this.$createElement();this.element.className="pivot_editable_cell text_cell";this.containerElement=document.createElement("div");this.containerElement.appendChild(this.element);this.container.appendChild(this.containerElement);this.directCellTyping=false;this.hide();this.element.addEventListener("blur",function(e){if(t.initialCellValue!==t.element.value){if(t.validateValue(t.coord,t.$getValue(),true)){t.$confirmEdit(e.keyCode)}else{t.focus()}}else{t.$cancelEdit()}t.initialCellValue=null});c.addCommandKeyListener(this.element,function(e){if(e.keyCode===13||e.keyCode===9||n.includes([37,38,39,40],e.keyCode)&&t.directCellTyping){if(t.validateValue(t.coord,t.$getValue(),true)){t.$confirmEdit(e);e.preventDefault()}}else if(e.keyCode===27){t.$cancelEdit()}});var i=n.debounce(function(){t.validateValue(t.coord,t.$getValue())},50);this.element.addEventListener("input",i)}h.prototype.$createElement=function(){var e=document.createElement("input");e.type="text";return e};h.prototype.initialize=function(e,t,i){var r,o;if(n.isObject(e)){r=e.data.value;o=r&&(r.edit&&r.edit.rawValue||r.value.rawValue);if(n.isUndefined(o))o=""}if(i){this.directCellTyping=true;this.element.value=i==="space"?"":i}else{this.directCellTyping=false;this.element.value=o}this.coord=p.getCoordFromTarget(t);this.validateValue(this.coord,i||o);this.initialCellValue=n.isNumber(o)?o.toString():o||""};h.prototype.focus=function(){var e=this.element.value.length;this.element.focus();this.element.setSelectionRange(e,e)};h.prototype.blur=function(){this.element.blur()};h.prototype.hide=function(){this.containerElement.style.display="none";this.$editing=false;this.markCellValid()};h.prototype.show=function(){this.containerElement.style.display="block"};h.prototype.renderOver=function(e){var t=e.getBoundingClientRect(),i=this.containerElement.parentNode.getBoundingClientRect(),r=window.getComputedStyle(this.containerElement),n=a.parseResolvedValue(r.marginTop),o=a.parseResolvedValue(r.marginLeft);this.element.style.width="100%";this.element.style.height="100%";this.containerElement.style.top=t.top-i.top-n-1+"px";this.containerElement.style.left=t.left-i.left-o-1+"px";this.containerElement.style.width=t.width+"px";this.containerElement.style.height=t.height+"px";this.containerElement.style.position="absolute";this.containerElement.style.display="block";this.containerElement.className="editable-container";this.$editing=true};h.prototype.convertData=function(e){return n.isUndefined(e)?"":e};h.prototype.validateValue=function(e,t,i){var r=this.provider.validateValue(e,t);if(!r.valid){this.markCellInvalid(r.info,i)}else{this.markCellValid()}return r.valid};h.prototype.validateData=function(e){if(isNaN(e)){this.element.style.background="red";return false}else{this.element.style.background="white";return true}};h.prototype.$getValue=function(){return this.element.value};h.prototype.$confirmEdit=function(e){var t=this.$getValue(),i=false;if(t==="")i=true;if(this.$editing){this._emit("confirm-edit",{value:t,delete:i,keyEvent:e});this.$editing=false}};h.prototype.$cancelEdit=function(){if(this.$editing){this._emit("cancel-edit",{value:this.$getValue()});this.$editing=false;this.invalid=false}};h.prototype.markCellValid=function(){var e="validation-popup",t=this.popupElem;if(t){t.parentElement.removeChild(t);this.popupElem=null}var i=this.element.parentElement;if(i.className.match("invalid-input")){i.className=i.className.replace("invalid-input","")}};h.prototype.markCellInvalid=function(e,t){var i,r=150,n="right",o,a="validation-popup",s,l,u;if(!this.element.parentElement.className.match("invalid-input")){this.element.parentElement.className+=" invalid-input"}if(!t)return;i=this.popupElem;if(!i){u=document.createElement("div");u.className="info-text";u.innerHTML=e;l=document.createElement("div");l.className="info message";l.appendChild(u);i=document.createElement("div");i.id=a;i.className="notification alert alert-warning material";o=this.element.parentElement.clientWidth-this.element.parentElement.offsetLeft;if(o<r){n+="left"}i.className+=" "+n;i.appendChild(l);this.popupElem=i;this.element.parentElement.appendChild(i)}else{u=i.querySelector(".info-text");u.innerHTML=e}};i.mkTextCellRenderer=function(){return new f};i.mkTextCellEditor=function(e){return new h(e.container)};i.$TextCellRenderer=f;i.$TextCellEditor=h},{"./cell_editor":91,"./cell_renderer":92,"./cell_type_util":96,"./lib/dom":117,"./lib/event":119,"./lib/event_emitter":120,"./lib/oop":124,"./utils":143,assert:2,lodash:70}],143:[function(e,t,i){"use strict";var r=e("assert");var n=e("lodash");var o=e("is-url-superb");function a(e,t){if(typeof e!=="object"||!(t instanceof Array))return false;return t.every(function(t,i){switch(typeof t){case"string":return typeof e[i]===t;case"function":return e[i]instanceof t;case"object":return t.tag==="or"&&(a([e[i]],[t.ty1])||a([e[i]],[t.ty2]));default:return false}})}var s={or:function(e,t){return{tag:"or",ty1:e,ty2:t}},checkBool:a,assertArgs:function(e,t){r(s.checkBool(e,t))}};i.JSONObjectToStyleAttribute=function e(t){var i="";if(t&&Object.keys(t).length){for(var r in t){i+=r+":"+t[r]+"; "}}return i};i.type=s;i.isJSON=function e(t){var i=false;try{i=JSON.parse(t)}catch(e){return false}return i};i.isUrl=function e(t){if(!n.isString(t)){return false}return i.isAbsoluteUrl(t)||i.isRelativeUrl(t)};i.isAbsoluteUrl=function e(t){return o(t)};i.isRelativeUrl=function e(t){if(i.isAbsoluteUrl(t)){return false}return i.isAbsoluteUrl(window.location.origin+t)};i.PercentageConverter={toDecimal:function(e){return e/100},toPercentage:function(e){return e*100}};i.escapeDataAttribute=function e(t){return encodeURIComponent(t).replace(/'/g,"%27")};i.unescapeDataAttribute=function e(t){return decodeURIComponent(t).replace("%27","'")};i.convertToMultiAxisRange=function(e){if(!e||!e.start||!e.end){return null}var t=Math.min(e.start.column,e.end.column),i=Math.max(e.start.column,e.end.column),r=Math.min(e.start.row,e.end.row),n=Math.max(e.start.row,e.end.row);return{X:{start:t,length:i-t+1},Y:{start:r,length:n-r+1}}};i.getSingleValue=function(e){if(e&&e.length===1&&e[0].length===1){return e[0][0]}};i.checkCellDataOutstandingValue=function(e){var t={},i;if(!e.invalid){i=e.data.value;if(i.queryOutstanding){t.queryOutstanding=true}if(i.saveOutstanding){t.saveOutstanding=true}}return t};i.parseCellData=function(e,t,i){var o={},a;o.displayType=e.displayType||"text";e.invalid=e.invalid||e.data&&typeof e.data.value==="undefined";if(!e.invalid){r(e.data!==undefined,"A cell must always have a data object.");r(e.data.value!==undefined,"A cell must always have a value property for the data object.");a=e.data.value;o.lastChanged=a.value?a.value.lastChanged:undefined;o.lastSaved=a.value?a.value.lastSaved:undefined;o.showSpinner=(n.isUndefined(a.value)||n.isUndefined(o.lastChanged))&&a.queryOutstanding;o.isFiltered=e.filtered;o.isLocked=!!e.locked;o.isEdited=!n.isUndefined(a.edit);o.isSaving=a.outstandingSave;if(o.isEdited){o.formattedData=[[a.edit.edit.isDelete?"":a.edit.edit.formattedValue]]}else if(a.outstandingSave){o.formattedData=[[a.outstandingSave.edit.isDelete?"":a.outstandingSave.edit.formattedValue]]}else if(a.value){o.formattedData=a.value.formattedValue}}o.isRollup=e.isRollup;o.isUpdated=i&&o.lastChanged>i;o.isSaved=i&&o.lastSaved>i;o.invalid=e.invalid;o.isReadOnly=t||e.readonly||o.isLocked;o.isProtected=e.protected;o.type=e.displayType;o.validityMessages=e.validityMessages;o.data=e.data;return o};i.getDataFromTarget=function(e){var t={};Object.keys(e.dataset).forEach(function(i){t[i]=e.dataset[i];if(t[i]==="undefined")t[i]=undefined});return t};i.getPositionFromTarget=function(e){var t=i.getDataFromTarget(e);if(!t.row){return}return{row:Number(t.row),column:Number(t.col)}};i.getCoordFromTarget=function(e){var t=i.getDataFromTarget(e);if(!t.row){return}return{Y:Number(t.row),X:Number(t.col)}}},{assert:2,"is-url-superb":43,lodash:70}],144:[function(e,t,i){"use strict";var r=e("./lib/oop");var n=e("./lib/dom");var o=e("./config");var a=e("lodash");var s=e("./layer/headings").HorHeading;var l=e("./layer/headings").VerHeading;var u=e("./layer/cells").Cells;var c=e("./layer/selection").Selection;var d=e("./layer/copied_selection").CopiedSelection;var p=e("./scrollbar").ScrollBarH;var f=e("./scrollbar").ScrollBarV;var h=e("./renderloop").RenderLoop;var g=e("./lib/event_emitter").EventEmitter;var m=e("./constants").CommitMode;var v=function(e,t,i){var r=this;this.container=t;n.addCssClass(this.container,"pivot");this.$horheadingWrapper=n.createElement("div");this.$horheadingWrapper.className="pivot-horheading-wrapper";this.$horheading=n.createElement("div");this.$horheading.className="pivot_horheading";this.$horheadingWrapper.appendChild(this.$horheading);this.container.appendChild(this.$horheadingWrapper);this.$verheadingWrapper=n.createElement("div");this.$verheadingWrapper.className="pivot-verheading-wrapper";this.$verheading=n.createElement("div");this.$verheading.className="pivot_verheading";this.$verheadingWrapper.appendChild(this.$verheading);this.container.appendChild(this.$verheadingWrapper);this.scroller=n.createElement("div");this.scroller.className="pivot_scroller";this.container.appendChild(this.scroller);this.cells=n.createElement("div");this.cells.className="pivot_cells";this.scroller.appendChild(this.cells);this.cover=n.createElement("div");this.cover.className="pivot_cover";this.container.appendChild(this.cover);this.commitbutton=n.createElement("div");this.commitbutton.className="pushchanges";this.commitbutton.innerHTML='<i class="fa fa-upload"></i>';this.cover.appendChild(this.commitbutton);this.loader=n.createElement("div");this.loader.className="cssloader-container";this.loader.innerHTML="<div><div class='cssloader-box'><div class='cssloader-loader'><div class='cssloader-flipper'><div class='cssloader-front'></div><div class='cssloader-back'></div></div></div><span>Loading...</span></div></div>";this.$loaderVisibility={};this.container.appendChild(this.loader);this.lineLoader=n.createElement("div");this.lineLoader.className="line-loader hidden";this.lineLoader.innerHTML="<div class='line'></div><div class='break'></div>";this.container.appendChild(this.lineLoader);this.notifications=n.createElement("span");this.notifications.className="notifications";this.container.appendChild(this.notifications);this.dialog=n.createElement("div");this.dialog.className="overlay hidden";this.dialog.innerHTML="<div class='dialog'><div class='message'></div><button class='btn'>OK</button></div>";this.container.appendChild(this.dialog);this.dialogMessage=this.dialog.querySelector(".message");this.dialogButton=this.dialog.querySelector(".btn");this.$verHeadingLayer=new l(this.$verheading,this);this.$horHeadingLayer=new s(this.$horheading,this);this.$selectionLayer=new c(this.cells,this);this.$copiedSelectionLayer=new d(this.cells,this);this.$horHeadingLayer.on("sort-by-values",function(e){r._emit("sort-by-values",e)});this.$verHeadingLayer.on("sort-by-values",function(e){r._emit("sort-by-values",e)});var o=this.onResize.bind(this);this.$verHeadingLayer.on("changeWidth",function(){o(true)});this.$horHeadingLayer.on("changeHeight",function(){o(true)});this.$cellLayer=new u(e,this.cells,i.getCellRenderFn,i.getContentRenderFn);this.canvas=this.$cellLayer.element;this.$horizScroll=false;this.scrollBarV=new f(this.container);this.scrollBarV.setVisible(true);this.scrollBarV.addEventListener("scroll",function(e){if(!r.$inScrollAnimation)r.setScrollTop(e.data)});this.scrollBarH=new p(this.container);this.scrollBarH.addEventListener("scroll",function(e){if(!r.$inScrollAnimation)r.setScrollLeft(e.data)});this.scrollTop=0;this.scrollLeft=0;this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0};this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:1,characterWidth:1,minHeight:1,maxHeight:1,offset:0,height:1};this.$loop=new h(this.$renderChanges.bind(this),this.$emitComplete.bind(this),this.container.ownerDocument.defaultView);this.$loop.schedule(this.CHANGE_FULL)};(function(){this.CHANGE_SCROLL=1;this.CHANGE_COLUMN=2;this.CHANGE_ROW=4;this.CHANGE_CELLS=8;this.CHANGE_SIZE=16;this.CHANGE_SELECTION=32;this.CHANGE_FULL=64;this.CHANGE_H_SCROLL=1024;r.implement(this,g);this.getCellElement=function(e,t){if(!this.$cellLayer.element.childNodes||!this.$cellLayer.element.childNodes[e])console.error("no such row");else if(!this.$cellLayer.element.childNodes[e].childNodes||!this.$cellLayer.element.childNodes[e].childNodes[t])console.error("no such column");else return this.$cellLayer.element.childNodes[e].childNodes[t]};this.relativeToAbsoluteCoordinates=function(e,t){return{row:e+this.layerConfig.firstRow,column:t+this.layerConfig.firstCol}};this.absoluteToRelativeCoordinates=function(e,t){return{row:e-this.layerConfig.firstRow,column:t-this.layerConfig.firstCol}};this.setDataProvider=function(e){this.provider=e;this.scroller.className="pivot_scroller";this.$horHeadingLayer.setDataProvider(e);this.$verHeadingLayer.setDataProvider(e);this.$cellLayer.setDataProvider(e);this.$selectionLayer.setDataProvider(e);this.$copiedSelectionLayer.setDataProvider(e);this.$loop.schedule(this.CHANGE_FULL)};this.updateCaret=function(){this.$loop.schedule(this.CHANGE_SELECTION)};this.updateCells=function(){this.$loop.schedule(this.CHANGE_CELLS)};this.updateScroll=function(){this.$loop.schedule(this.CHANGE_SCROLL)};this.updateFull=function(e){if(e)this.$renderChanges(this.CHANGE_FULL,true);else this.$loop.schedule(this.CHANGE_FULL)};this.updateHorizontalHeadings=function(){this.$loop.schedule(this.CHANGE_COLUMN)};this.updateVerticalHeadings=function(){this.$loop.schedule(this.CHANGE_ROW)};this.updateHeadings=function(){this.$loop.schedule(this.CHANGE_COLUMN|this.CHANGE_ROW)};this.$changes=0;this.onResize=function(e,t,i){if(this.resizing>2)return;else if(this.resizing>0)this.resizing++;else this.resizing=e?1:0;var r=this.container;if(!i)i=r.clientHeight||r.scrollHeight;if(!t)t=r.clientWidth||r.scrollWidth;var n=this.$updateCachedSize(e,t,i);if(!this.$size.scrollerHeight||!t&&!i)return this.resizing=0;if(e)this.$renderChanges(n,true);else this.$loop.schedule(n|this.$changes);if(this.resizing)this.resizing=0};this.$updateCachedSize=function(e,t,i){var r=0;var n=this.$size;var o={width:n.width,height:n.height,scrollerHeight:n.scrollerHeight,scrollerWidth:n.scrollerWidth};if(i&&(e||n.height!=i)){n.height=i;r=this.CHANGE_SIZE;var a=this.$horHeadingLayer.element.offsetHeight;this.$verheading.style.top=this.scroller.style.top=this.scrollBarV.element.style.top=this.cover.style.height=a+"px";this.$verheadingWrapper.style.width=this.$verheading.offsetWidth+"px";n.scrollerHeight=n.height-a;if(this.$horizScroll){n.scrollerHeight-=this.scrollBarH.getHeight()}this.scrollBarV.element.style.bottom=this.scroller.style.bottom=this.scrollBarH.getHeight()+"px";this.scrollBarV.setHeight(n.scrollerHeight);this.setScrollTop(this.getScrollTop());r=r|this.CHANGE_FULL}if(t&&(e||n.width!=t)){r=this.CHANGE_SIZE;n.width=t;var s=this.$verHeadingLayer.element.offsetWidth;this.$horheading.style.left=this.scroller.style.left=this.scrollBarH.element.style.left=this.cover.style.width=s+"px";this.$horheadingWrapper.style.height=this.$horheading.offsetHeight+"px";n.scrollerWidth=Math.max(0,t-s-this.scrollBarV.getWidth());this.$horheading.style.right=this.scrollBarH.element.style.right=this.scroller.style.right=this.scrollBarV.getWidth()+"px";this.setScrollLeft(this.getScrollLeft());r=r|this.CHANGE_FULL}if(r)this._signal("resize",o);return r};this.setHorHeadingVisible=function(e){this.$horHeadingLayer.visible=e;if(this.layerConfig.vRange&&this.layerConfig.hRange){this.$renderChanges(this.CHANGE_FULL,true);this.onResize(true)}};this.setVerHeadingVisible=function(e){this.$verHeadingLayer.visible=e;if(this.layerConfig.vRange&&this.layerConfig.hRange){this.$renderChanges(this.CHANGE_FULL,true);this.onResize(true)}};this.setAlignment=function(e,t,i){(e?this.$verHeadingLayer:this.$horHeadingLayer).setAlignment(t,i);if(this.layerConfig.vRange&&this.layerConfig.hRange)this.$renderChanges(this.CHANGE_CELLS,true)};this.setDefaultAlignment=function(e,t){this.$cellLayer.setDefaultAlignment(e,t);if(this.layerConfig.vRange&&this.layerConfig.hRange)this.$renderChanges(this.CHANGE_CELLS,true)};this.getContainerElement=function(){return this.container};this.getMouseEventTarget=function(){return this.container};this.getFirstVisibleRow=function(){return this.layerConfig.firstRow};this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(this.layerConfig.offset===0?0:1)};this.getLastFullyVisibleRow=function(){var e=this.layerConfig.vRange;var t=this.layerConfig;var i=-1*t.vOffset;var r=0;while(i<t.height)i+=e[r++].size;return e.index+r-2};this.isCellInVisibleRange=function(e,t){var i=this.layerConfig;return e>=i.firstRow&&e<=i.lastRow&&t>=i.firstCol&&t<=i.lastCol};this.getLastVisibleRow=function(){return this.layerConfig.lastRow};this.$updateScrollBar=function(){this.$updateScrollBarH();this.$updateScrollBarV();this._emit("scroll")};this.$updateScrollBarV=function(){var e=this.$horHeadingLayer.dataRange;this.scrollBarV.setInnerHeight(this.layerConfig.maxHeight);var t=this.$horheading.offsetHeight;var i=this.$verHeadingLayer.size-this.$size.scrollerHeight+t;var r=this.getScrollTop();r=r>=i?i+t+this.scrollBarH.height:r;this.scrollBarV.setScrollTop(r)};this.$updateScrollBarH=function(){var e=this.$horHeadingLayer.dataRange;if(e.length===0||e[0].length!==0){this.scrollBarH.setInnerWidth(this.layerConfig.maxWidth);var t=this.$verheading.offsetWidth;var i=this.$horHeadingLayer.size-this.$size.scrollerWidth+t;var r=this.scrollLeft>=i?i+t:this.scrollLeft;this.scrollBarH.setScrollLeft(r)}};this.$emitComplete=function(){this._emit("renderComplete")};this.$renderChanges=function(e,t){var i=this.provider.getHeadingData();if(this.$changes){e|=this.$changes;this.$changes=0}if(!this.provider||!this.provider.hasHeadingData()||!this.container.offsetWidth||!e&&!t){this.$changes|=e;if(!this.provider.hasHeadingData()){this.showLoader("headings")}return}if(!this.$size.width){this.$changes|=e;return this.onResize(true)}this._signal("beforeRender");if(e&this.CHANGE_FULL||e&this.CHANGE_SIZE||e&this.CHANGE_SCROLL||e&this.CHANGE_H_SCROLL||e&this.CHANGE_COLUMN||e&this.CHANGE_ROW||e&this.CHANGE_CELLS){this.$computeLayerConfig()}if(e&this.CHANGE_FULL){if(!i.hasLoadingHeadings()&&!i.isLoadingSlice()){this.$updateScrollBar();this.$horHeadingLayer.update(this.layerConfig);
this.$verHeadingLayer.update(this.layerConfig);this.$handleCellChanges(this.$cellLayer.update(this.layerConfig));this.$selectionLayer.update(this.layerConfig);this.$copiedSelectionLayer.update(this.layerConfig);this._signal("afterRender");this.hideLoader("headings");return}else{this.showLoader("headings")}}if(e&this.CHANGE_SCROLL){if(e&this.CHANGE_ROW||e&this.CHANGE_COLUMN||e&this.CHANGE_CELLS){this.$horHeadingLayer.update(this.layerConfig);this.$verHeadingLayer.update(this.layerConfig);this.$handleCellChanges(this.$cellLayer.update(this.layerConfig))}else{this.$horHeadingLayer.scroll(this.layerConfig);this.$verHeadingLayer.scroll(this.layerConfig);this.$cellLayer.scroll(this.layerConfig)}this.$selectionLayer.update(this.layerConfig);this.$copiedSelectionLayer.update(this.layerConfig);this.$updateScrollBar();this._signal("afterRender");return}if(e&this.CHANGE_SELECTION){this.$selectionLayer.update(this.layerConfig);this.$copiedSelectionLayer.update(this.layerConfig)}if(e&this.CHANGE_ROW)this.$verHeadingLayer.update(this.layerConfig);if(e&this.CHANGE_COLUMN)this.$horHeadingLayer.update(this.layerConfig);if(e&this.CHANGE_CELLS)this.$handleCellChanges(this.$cellLayer.update(this.layerConfig));if(e&this.CHANGE_SIZE)this.$updateScrollBar();this._signal("afterRender")};this.$handleCellChanges=function(e){var t=!n.hasCssClass(this.lineLoader,"hidden");if(e.queryOutstanding||e.saveOutstanding||this.provider.containsQueuedEdits()){if(!t){n.removeCssClass(this.lineLoader,"hidden")}}else if(t){n.addCssClass(this.lineLoader,"hidden")}};this.isUpdatingCells=function(){return!n.hasCssClass(this.lineLoader,"hidden")};this.$autosize=function(){var e=this.session.getScreenLength()*this.lineHeight;var t=this.$maxLines*this.lineHeight;var i=Math.max(this.lineHeight,Math.min(t,e));var r=e>t;if(i!=this.desiredHeight||this.$size.height!=this.desiredHeight||r!=this.$vScroll){if(r!=this.$vScroll){this.$vScroll=r;this.scrollBarV.setVisible(r)}var n=this.container.clientWidth;this.container.style.height=i+"px";this.$updateCachedSize(true,n,i);this.desiredHeight=i}};this.$computeLayerConfig=function(){if(this.$maxLines&&this.lineHeight>1)this.$autosize();var e=this.provider;var t=this.$verHeadingLayer;var i=this.$horHeadingLayer;var r=i.getLevelSize().reduce(function(e,t){return e+t},0);var n=t.getLevelSize().reduce(function(e,t){return e+t},0);var o=this.getScrollTop();var a=this.getScrollLeft();var s=t.getRange(o,o+this.$size.height-r);var l=i.getRange(a,a+this.$size.width-n);var u=o-s.offset;var c=this.$size.scrollerHeight;var d=t.size;var p=a-l.offset;var f=this.$size.scrollerWidth;var h=i.size;var g=this.$size.height<=2*10;var m=!g&&(this.$hScrollBarAlwaysVisible||this.$size.scrollerWidth-h<0);var v=this.$horizScroll!==m;if(v){this.$horizScroll=m;this.scrollBarH.setVisible(m)}var y=!g&&(this.$vScrollBarAlwaysVisible||this.$size.scrollerHeight-d<0);var b=this.$vScroll!==y;if(b){this.$vScroll=y;this.scrollBarV.setVisible(y)}var w=this.$verHeadingLayer.dataRange;var C=this.$horHeadingLayer.dataRange;this.setScrollTop(Math.min(o,Math.max(0,this.$verHeadingLayer.size-this.$size.scrollerHeight+this.$horheading.offsetHeight)));if(w.length===0||w[0].length!==0){this.setScrollLeft(Math.min(a,Math.max(0,this.$horHeadingLayer.size-this.$size.scrollerWidth+this.$verheading.offsetWidth)))}var E=s.length;var S=s.index;var T=S+E-1;var x=l.length;var _=l.index;var M=_+x-1;if(this.layerConfig)this.layerConfig.discard=true;var A=0;if(v||b){A=this.$updateCachedSize(true,this.$size.width,this.$size.height);this._signal("scrollbarVisibilityChanged")}this.layerConfig={vRange:s,hRange:l,width:f,height:c,firstRow:S,lastRow:T,firstCol:_,lastCol:M,minHeight:c,maxHeight:d,minWidth:f,maxWidth:h,vOffset:u,hOffset:p};var I=this.layerConfig,O=this;if(s.length){I.view=e.getDataRange({X:{start:l.index,length:l.length},Y:{start:s.index,length:s.length}})}this.$verheading.style.marginTop=this.cells.style.marginTop=-u+"px";this.$horheading.style.marginLeft=this.cells.style.marginLeft=-p+"px";this.cells.style.width=I.width+"px";this.cells.style.height=I.height+(s[0]?s[0].size:0)+"px";return A};this.scrollSelectionIntoView=function(e,t,i){this.scrollCaretIntoView(e,i);this.scrollCaretIntoView(t,i)};this.scrollCaretIntoView=function(e,t){if(this.$size.scrollerHeight===0)return;if(!e)e=this.provider.selection.getCaret();if(!this.$verHeadingLayer.findNodeByIndex(e.row))return;var i=this.$horHeadingLayer.findOffsetAtIndex(e.column);var r=this.$horHeadingLayer.findNodeByIndex(e.column).size;var n=this.$verHeadingLayer.findOffsetAtIndex(e.row);var o=this.$verHeadingLayer.findNodeByIndex(e.row).size;var a=this.getScrollTop();if(a>n){if(t)n-=t*this.$size.scrollerHeight;this.setScrollTop(n)}else if(a+this.$size.scrollerHeight<n+o){if(t)n+=t*this.$size.scrollerHeight;this.setScrollTop(n+o-this.$size.scrollerHeight)}var s=this.getScrollLeft();if(s>i){if(i<0)i=0;this.setScrollLeft(i)}else if(s+this.$size.scrollerWidth<i+r){this.setScrollLeft(Math.round(i+r-this.$size.scrollerWidth))}};this.getScrollTop=function(){var e=typeof this.scrollTop==="number"&&!isNaN(this.scrollTop)?this.scrollTop:0,t=this.$verHeadingLayer.size-this.$size.scrollerHeight;return Math.max(0,Math.min(e,t))};this.getScrollLeft=function(){var e=typeof this.scrollLeft==="number"&&!isNaN(this.scrollLeft)?this.scrollLeft:0,t=this.$horHeadingLayer.size-this.$size.scrollerWidth;return Math.max(0,Math.min(e,t))};this.setScrollTop=function(e){var t=this.layerConfig;var i=Math.max(0,t.maxHeight-t.minHeight);var r=this.$horHeadingLayer.dataRange;if(i!==0&&!isNaN(i)){if(this.scrollTop===e)return;this.scrollToY(e)}};this.setScrollLeft=function(e){var t=this.layerConfig;var i=Math.max(0,t.maxWidth-t.minWidth);var r=this.$verHeadingLayer.dataRange;if(i!==0&&!isNaN(i)&&(r.length===0||r[0].length!==0)){if(this.scrollLeft===e)return;this.scrollToX(e)}};this.getScrollTopRow=function(){return this.layerConfig.firstRow};this.getScrollBottomRow=function(){return this.layerConfig.lastRow};this.setColumnHeaderWidth=function(e,t,i){this.provider.setHeadingWidth("X",t,e,i);this.updateScroll();this.updateHorizontalHeadings();this.updateCells();this.updateCaret()};this.setColumnHeaderHeight=function(e,t){this.provider.setHeadingHeight("X",t,e,false);this.updateScroll();this.updateHorizontalHeadings();this.updateCells();this.updateCaret()};this.setRowHeaderWidth=function(e,t){this.provider.setHeadingWidth("Y",t,e,false);this.updateScroll();this.updateVerticalHeadings();this.updateCells();this.updateCaret()};this.setRowHeaderHeight=function(e,t,i){this.provider.setHeadingHeight("Y",t,e,i);this.updateScroll();this.updateVerticalHeadings();this.updateCells();this.updateCaret()};this.alignCaret=function(e,t){if(typeof e==="number")e={row:e,column:0};var i=this.$verHeadingLayer.findNodeByIndex(e.row);var r=this.$verHeadingLayer.findOffsetAtIndex(e.row);var n=this.$size.scrollerHeight;var o=r-(n-i.size)*(t||0);this.setScrollTop(o);return o};this.STEPS=8;this.$calcSteps=function(e,t){var i=0;var r=this.STEPS;var n=[];var o=function(e,t,i){return i*(Math.pow(e-1,3)+1)+t};for(i=0;i<r;++i)n.push(o(i/this.STEPS,e,t-e));return n};this.scrollToColumn=function(e,t,i,r){var n=this.$horHeadingLayer.findNodeByIndex(e);var o=this.$horHeadingLayer.findOffsetAtIndex(e);if(t)o-=(this.$size.scrollerWidth-n.size)/2;var a=this.getScrollLeft();this.setScrollLeft(o);if(!i)this.animateScrolling(a,r)};this.scrollToRow=function(e,t,i,r){var n=this.$verHeadingLayer.findNodeByIndex(e);var o=this.$verHeadingLayer.findOffsetAtIndex(e);if(t)o-=(this.$size.scrollerHeight-n.size)/2;var a=this.getScrollTop();this.setScrollTop(Math.max(o,0));if(i!==false)this.animateScrolling(a,r)};this.animateScrolling=function(e,t){var i=this.getScrollTop();if(this.$animatedScroll&&Math.abs(e-i)<1e5){var r=this;var n=r.$calcSteps(e,i);this.$inScrollAnimation=true;clearInterval(this.$timer);r.session.setScrollTop(n.shift());this.$timer=setInterval(function(){if(n.length){r.setScrollTop(n.shift());r.scrollTop=i}else if(i!=null){r.scrollTop=-1;r.setScrollTop(i);i=null}else{r.$timer=clearInterval(r.$timer);r.$inScrollAnimation=false;t&&t()}},10)}};this.scrollToY=function(e){if(e<0||!a.isNumber(e))e=0;if(this.scrollTop!==e){this.$loop.schedule(this.CHANGE_SCROLL);this.scrollTop=e}};this.scrollToX=function(e){if(e<0||!a.isNumber(e))e=0;if(this.scrollLeft!==e){this.$loop.schedule(this.CHANGE_SCROLL);this.scrollLeft=e}};this.scrollBy=function(e,t){var i=this.$cellLayer.config;var r=this.getScrollTop()+t;var n=i.maxHeight-i.minHeight;t&&this.setScrollTop(r>n?n:r>0?r:0);e&&this.setScrollLeft(this.getScrollLeft()+e)};this.isScrollableBy=function(e,t){if(t<0&&this.getScrollTop()>=1)return true;if(t>0&&this.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1)return true;if(e<0&&this.getScrollLeft()>=1)return true;if(e>0&&this.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.maxWidth<-1)return true};this.screenToTextCoordinates=function(e,t){var i=this.scroller.getBoundingClientRect();var r=this.layerConfig;var n=this.getScrollLeft();var o,a,s;o=-1*r.hOffset,a=0,e-=i.left;if(e>0){s=this.$horHeadingLayer.getRange(n,n+e);a=0;while(o<e){if(!s[a])break;o+=s[a++].size}a-=1}else{s=this.$horHeadingLayer.getRange(n+e,n);a=s.length-1;while(o>e){if(!s[a]){a++;break}o-=s[a--].size}}var l=s.index+a,u=this.getScrollTop();o=-1*r.vOffset,t-=i.top;if(t>0){s=this.$verHeadingLayer.getRange(u,u+t);a=0;while(o<t){if(!s[a])break;o+=s[a++].size}a-=1}else{s=this.$verHeadingLayer.getRange(u+t,u);a=s.length-1;while(o>t){if(!s[a]){a++;break}o-=s[a--].size}}var c=s.index+a;return{row:c,column:l}};this.$moveTextAreaToCursor=function(){};this.visualizeFocus=function(){n.addCssClass(this.container,"pivot_focus")};this.visualizeBlur=function(){n.removeCssClass(this.container,"pivot_focus")};this.setStyle=function e(t,i){n.setCssClass(this.container,t,i!==false)};this.unsetStyle=function e(t){n.removeCssClass(this.container,t)};this.destroy=function(){this.$cellLayer.destroy();if(this.$CaretLayer)this.$CaretLayer.destroy()};this.clipboard=[];this.$getSelection=function(){var e=this.provider.selection,t=this.getStartSelection(e.selectionAnchor,e.selectionLead),i=this.getEndSelection(e.selectionAnchor,e.selectionLead);return{start:t,end:i}};this.getStartSelection=function(e,t){return{column:e.column<t.column?e.column:t.column,row:e.row<t.row?e.row:t.row}};this.getEndSelection=function(e,t){return{column:e.column>t.column?e.column:t.column,row:e.row>t.row?e.row:t.row}};this.getCellValue=function(e){var t="";if(e){if(this.provider.getCommitMode()===m.SINGLE){t=e.value.rawValue}else{t=!a.isUndefined(e.edit)?e.edit.rawValue:e.value.rawValue}}return t};this.onPaste=function(e){var t,i,r,n;if(!e){return}t=this.$getSelection();r=this.$parsePasteText(e);if(r.length*2<=t.end.row-t.start.row+1||r[0].length*2<=t.end.column-t.start.column+1){r=this.$extendClipboardToSelection(r,t)}n=this.$buildCellsEdits(t.start,r);i={X:{start:t.start.column,length:a.maxBy(r,function(e){return e.length}).length},Y:{start:t.start.row,length:r.length}};this.provider.pasteCells(n,i)};this.$extendClipboardToSelection=function(e,t){var i,r,n=t.end.column-t.start.column+1,o=t.end.row-t.start.row+1,s,l,u=Math.floor(o/e.length)||1,c=Math.floor(n/a.maxBy(e,function(e){return e.length}).length)||1,d=[],p;for(s=0;s<u;s++){for(i=0;i<e.length;i++){p=[];d.push(p);for(l=0;l<c;l++){for(r=0;r<e[i].length;r++){p.push(e[i][r])}}}}return d};this.$buildCellsEdits=function(e,t){var i,r,n=this.provider.getHeadingData().getHeadingAxisInfo("Y").getLength(),o=this.provider.getHeadingData().getHeadingAxisInfo("X").getLength(),s,l=[];n=a.min([n-e.row,t.length]);o-=e.column;for(i=0;i<n;i++){s=a.min([o,t[i].length]);for(r=0;r<s;r++){l.push({value:t[i][r],coord:{X:e.column+r,Y:e.row+i}})}}return l};this.$parsePasteText=function(e){if(e.length===0){return[]}e=e.replace(/\r\n/g,"\n");if(e.indexOf('"')<0){return this.$parsePasteTextSimple(e)}return this.$parsePasteTextMultiline(e)};this.$parsePasteTextSimple=function(e){return e.split("\n").map(function(e){return e.split("\t").map(function(e){return e||" "})})};this.$parsePasteTextMultiline=function(e){var t,i,r=[],n=[r],o,a=0,s=/\"+|\t|\n/g,l=false,u=false,c;while(a<e.length){i=s.exec(e);if(i==null){r.push(e.substring(a)||" ");break}t=i.index;o=i[0];if(!l){if(o==="\t"||o==="\n"){c=e.substring(a,t);if(u){r[r.length-1]+=c}else{r.push(c||" ")}a=t+1;u=false;if(o==="\n"){r=[];n.push(r)}if(t===e.length-1){r.push(" ")}}else if(t===a&&o.length%2>0){l=true}}else if(o[0]==='"'&&o.length%2>0){c=e.substring(a,t+o.length);c=this.$removeMultilineQuotes(c);r.push(c);a=t+o.length;u=true;l=false}}return n};this.$removeMultilineQuotes=function(e){var t=0,i=undefined;e=e.replace(/""/g,'"');if(e[0]==='"'){t=1}if(e[e.length-1]==='"'){i=e.length-1}return e.substring(t,i)};this.isCaretOnHeading=function(){return!!(this.hHeadingCaret||this.vHeadingCaret)};this.getHeadingLayerWithCaret=function(){if(this.isCaretOnHeading()){return this[this.hHeadingCaret?"$horHeadingLayer":"$verHeadingLayer"]}};this.showSelection=function(){this.$selectionLayer.show()};this.hideSelection=function(){this.$selectionLayer.hide()};this.showCopiedSelection=function(){this.updateCaret()};this.showLoader=function(e){if(n.hasCssClass(this.loader,"hidden")){this.$loaderVisibility[e]=true;n.removeCssClass(this.loader,"hidden")}};this.hideLoader=function(e){if(!n.hasCssClass(this.loader,"hidden")){this.$loaderVisibility[e]=false;if(!this.checkLoaderVisibility()){n.addCssClass(this.loader,"hidden")}}};this.checkLoaderVisibility=function(){var e=this;return Object.keys(this.$loaderVisibility).reduce(function(t,i){return t||e.$loaderVisibility[i]},false)};this.isDialogVisible=function(){return!n.hasCssClass(this.dialog,"hidden")};this.showDialog=function(e,t,i){var r=this,o=function(){if(!n.hasCssClass(r.dialog,"hidden")){n.addCssClass(r.dialog,"hidden");i&&i()}r.dialogButton.removeEventListener("click",o)};if(n.hasCssClass(this.dialog,"hidden")){this.dialogMessage.innerText=e;this.dialogButton.innerText=t;this.dialogButton.addEventListener("click",o);n.removeCssClass(this.dialog,"hidden")}}}).call(v.prototype);o.defineOptions(v.prototype,"renderer",{animatedScroll:{initialValue:false},hScrollBarAlwaysVisible:{set:function(e){this.$hScrollBarAlwaysVisible=e;if(!this.$hScrollBarAlwaysVisible||!this.$horizScroll)this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:false}});i.VirtualRenderer=v},{"./config":101,"./constants":102,"./layer/cells":109,"./layer/copied_selection":110,"./layer/headings":112,"./layer/selection":116,"./lib/dom":117,"./lib/event_emitter":120,"./lib/oop":124,"./renderloop":138,"./scrollbar":139,lodash:70}],145:[function(e,t,i){"use strict";var r=e("./lib/oop");var n=e("./lib/event_emitter").EventEmitter;var o=e("./text_cell_control");function a(){}r.inherits(a,o.$TextCellRenderer);a.prototype.renderCell=function(e,t){var i=function(e){return"<span>"+t(e)+"</span>"};if(!e.hasOwnProperty("additionalClasses")){e.additionalClasses=[]}e.additionalClasses.push("wrapped_text_cell");return a.super_.renderCell(e,i)};var s=e("./utils");a.prototype.renderClipboardContent=function(e){var t=s.getSingleValue(e.formattedData);t=!e.showSpinner&&t?t.toString():" ";if(t.match(/^(.*)(\n+.*)+$/)){return'"'+t.replace(/"/g,'""')+'"'}return t};function l(e){o.$TextCellEditor.call(this,e)}r.inherits(l,o.$TextCellEditor);r.implement(l.prototype,n);l.prototype.$createElement=function(){return document.createElement("textarea")};i.mkWrappedTextCellRenderer=function(){return new a};i.mkWrappedTextCellEditor=function(e){return new l(e.container)};i.$WrappedTextCellRenderer=a;i.$WrappedTextCellEditor=l},{"./lib/event_emitter":120,"./lib/oop":124,"./text_cell_control":142,"./utils":143}],146:[function(e,t,i){"use strict";t.exports={PopupMenu:e("./src/popupmenu"),Menu:e("./src/menu"),MenuItem:e("./src/menu_item"),MenuItemIcon:e("./src/menu_item_icon"),Divider:e("./src/divider"),MenuItemsTypes:e("./src/constants").MenuItemsTypes}},{"./src/constants":147,"./src/divider":148,"./src/menu":149,"./src/menu_item":150,"./src/menu_item_icon":151,"./src/popupmenu":153}],147:[function(e,t,i){"use strict";t.exports={OpenInPosition:{TOP_LEFT:"TOP_LEFT",BOTTOM_LEFT:"BOTTOM_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_RIGHT:"BOTTOM_RIGHT"},MenuItemsTypes:{MenuItem:"MenuItem",Divider:"Divider",SubMenu:"SubMenu",OpenViewItem:"OpenViewItem",FormulaEditor:"FormulaEditor"}}},{}],148:[function(e,t,i){"use strict";var r=e("react");t.exports=function(){return r.DOM.hr({className:"context-menu-divider"})}},{react:"react"}],149:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("react-addons-pure-render-mixin");var a=e("classnames");var s=r.createClass({displayName:"Menu",propTypes:{onClose:r.PropTypes.func},mixins:[o],render:function(){var e=this,t=r.Children.map(this.props.children,function(t){return t&&!n.isString(t.type)&&r.cloneElement(t,{onClose:e.props.onClose})||t});return r.DOM.ul({className:a("dropdown-menu",this.props.className)},t)}});t.exports=s},{classnames:6,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],150:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=e("./constants").MenuItemsTypes;var a=e("./menu_item_icon");var s=e("classnames");var l=r.createClass({displayName:"MenuItem",propTypes:{itemType:r.PropTypes.string,data:r.PropTypes.any,onClose:r.PropTypes.func,label:r.PropTypes.string,onClick:r.PropTypes.func,disabled:r.PropTypes.bool,iconName:r.PropTypes.string},mixins:[n],getInitialProps:function(){return{itemType:o.MenuItem}},handleClick:function(e){e.preventDefault();if(!this.props.disabled){if(this.props.data){this.props.onClick(this.props.data)}else{this.props.onClick()}}this.props.onClose()},render:function(){var e={disabled:this.props.disabled};return this.props.itemType===o.Divider?r.DOM.hr({className:"context-menu-divider"}):r.DOM.li({className:s(e),onClick:this.handleClick},r.DOM.a({tabIndex:-1,href:"#"},this.props.iconName?r.createElement(a,{iconName:this.props.iconName}):null,this.props.children,this.props.label))}});t.exports=l},{"./constants":147,"./menu_item_icon":151,classnames:6,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],151:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=e("classnames");var a=r.createClass({displayName:"MenuItemIcon",propTypes:{iconName:r.PropTypes.string.isRequired,extraClasses:r.PropTypes.arrayOf(r.PropTypes.string)},mixins:[n],render:function(){var e={};e["fa fa-"+this.props.iconName]=true;if(this.props.extraClasses){this.props.extraClasses.forEach(function(t){e[t]=true})}return r.DOM.i({className:o(e)})}});t.exports=a},{classnames:6,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],152:[function(e,t,i){"use strict";var r=e("classnames");var n=e("lodash");var o=e("react");var a=e("react-dom");var s=e("react-addons-pure-render-mixin");var l=o.createClass({displayName:"MenuPosition",propTypes:{children:o.PropTypes.element.isRequired,openInCorner:o.PropTypes.string,openPosX:o.PropTypes.number,openPosY:o.PropTypes.number},mixins:[s],componentDidMount:function(){this.setPosition()},getInitialState:function(){return{style:{},classes:{}}},initTopPosition:function(e,t){var i=window.innerHeight,r=t.offsetHeight,n=i-e,o=10,a=Math.max(n,e);if(a>r){return e<n?e+(window.scrollY||window.pageYOffset)+"px":e-r+(window.scrollY||window.pageYOffset)+"px"}else{if(i>r){return Math.floor((window.innerHeight-r)/2)+"px"}t.style.maxHeight=i-o+"px";t.style.overflowY="auto";return 0}},setPosition:function(){var e=a.findDOMNode(this.refs.child),t=this.props.openPosX,i=this.props.openPosY,r=window.innerWidth-t,n={position:"absolute",top:this.initTopPosition(i,e)},o={};if(t>r){n.left=t-e.offsetWidth+(window.scrollX||window.pageXOffset)+"px";o["pull-left"]=true}else{n.left=t+(window.scrollX||window.pageXOffset)+"px";o["pull-left"]=false}this.setState({style:n,classes:o})},render:function(){var e={open:true};e=n.extend(e,this.state.classes);return o.DOM.div({className:r(e),style:this.state.style},o.cloneElement(o.Children.only(this.props.children),{ref:"child"}))}});t.exports=l},{classnames:6,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],153:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-addons-pure-render-mixin");var a=e("./portal");var s=e("./menu_position");var l=n.createClass({displayName:"PopupMenu",propTypes:{children:n.PropTypes.element.isRequired,onClose:n.PropTypes.func.isRequired,closeOnEsc:n.PropTypes.bool,openPositionX:n.PropTypes.number.isRequired,openPositionY:n.PropTypes.number.isRequired},mixins:[o],createId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,i=e=="x"?t:t&3|8;return i.toString(16)})},render:function(){return n.createElement(a,{portalId:this.createId(),closeOnEsc:this.props.closeOnEsc,onClose:this.props.onClose},n.createElement(s,{openPosX:this.props.openPositionX,openPosY:this.props.openPositionY},this.props.children))}});t.exports=l},{"./menu_position":152,"./portal":154,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],154:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("react-addons-pure-render-mixin");var a=27;var s=r.createClass({displayName:"Portal",propTypes:{portalId:r.PropTypes.string.isRequired,onClose:r.PropTypes.func,closeOnEsc:r.PropTypes.bool},mixins:[o],$portalElement:null,$portal:null,getDefaultProps:function(){return{closeOnEsc:true}},componentDidMount:function(){document.addEventListener("click",this.handleClick,true);document.addEventListener("contextmenu",this.handleClick,true);window.addEventListener("resize",this.close,false);if(this.props.closeOnEsc){document.addEventListener("keydown",this.handleKeydown)}this.componentDidUpdate()},componentWillUnmount:function(){document.removeEventListener("click",this.handleClick,true);document.removeEventListener("contextmenu",this.handleClick,true);window.removeEventListener("resize",this.close,false);if(this.props.closeOnEsc){document.removeEventListener("keydown",this.handleKeydown)}n.unmountComponentAtNode(this.$portalElement);document.body.removeChild(this.$portalElement)},componentDidUpdate:function(){this.renderComponent()},handleClick:function(e){var t=e.target,i=n.findDOMNode(this.$portal);if(!i||i.contains(t))return;this.close()},handleKeydown:function(e){if(e.keyCode===a){this.close()}},close:function(){this.props.onClose&&this.props.onClose()},renderComponent:function(){if(!this.$portalElement){this.renderPortalElement()}this.$portal=n.render(r.cloneElement(this.props.children),this.$portalElement)},renderPortalElement:function(){var e=this.props.portalId&&document.getElementById(this.props.portalId);if(!e){e=document.createElement("div");e.id=this.props.portalId;document.body.appendChild(e)}this.$portalElement=e},render:function(){return null}});t.exports=s},{react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],155:[function(e,t,i){var r=t.exports={};var n;var o;function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){n=setTimeout}else{n=a}}catch(e){n=a}try{if(typeof clearTimeout==="function"){o=clearTimeout}else{o=s}}catch(e){o=s}})();function l(e){if(n===setTimeout){return setTimeout(e,0)}if((n===a||!n)&&setTimeout){n=setTimeout;return setTimeout(e,0)}try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}function u(e){if(o===clearTimeout){return clearTimeout(e)}if((o===s||!o)&&clearTimeout){o=clearTimeout;return clearTimeout(e)}try{return o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}var c=[];var d=false;var p;var f=-1;function h(){if(!d||!p){return}d=false;if(p.length){c=p.concat(c)}else{f=-1}if(c.length){g()}}function g(){if(d){return}var e=l(h);d=true;var t=c.length;while(t){p=c;c=[];while(++f<t){if(p){p[f].run()}}f=-1;t=c.length}p=null;d=false;u(e)}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}c.push(new m(e,t));if(c.length===1&&!d){l(g)}};function m(e,t){this.fun=e;this.array=t}m.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=true;r.env={};r.argv=[];r.version="";r.versions={};function v(){}r.on=v;r.addListener=v;r.once=v;r.off=v;r.removeListener=v;r.removeAllListeners=v;r.emit=v;r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0}},{}],156:[function(e,t,i){t.exports=e("react/lib/shallowCompare")},{"react/lib/shallowCompare":196}],157:[function(e,t,i){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};var n=e("react");var o={position:"absolute",top:0,left:0,visibility:"hidden",height:0,overflow:"scroll",whiteSpace:"pre"};var a=n.createClass({displayName:"AutosizeInput",propTypes:{className:n.PropTypes.string,defaultValue:n.PropTypes.any,inputClassName:n.PropTypes.string,inputStyle:n.PropTypes.object,minWidth:n.PropTypes.oneOfType([n.PropTypes.number,n.PropTypes.string]),onChange:n.PropTypes.func,placeholder:n.PropTypes.string,placeholderIsMinWidth:n.PropTypes.bool,style:n.PropTypes.object,value:n.PropTypes.any},getDefaultProps:function e(){return{minWidth:1}},getInitialState:function e(){return{inputWidth:this.props.minWidth}},componentDidMount:function e(){this.copyInputStyles();this.updateInputWidth()},componentDidUpdate:function e(){this.updateInputWidth()},copyInputStyles:function e(){if(!this.isMounted()||!window.getComputedStyle){return}var t=window.getComputedStyle(this.refs.input);if(!t){return}var i=this.refs.sizer;i.style.fontSize=t.fontSize;i.style.fontFamily=t.fontFamily;i.style.fontWeight=t.fontWeight;i.style.fontStyle=t.fontStyle;i.style.letterSpacing=t.letterSpacing;if(this.props.placeholder){var r=this.refs.placeholderSizer;r.style.fontSize=t.fontSize;r.style.fontFamily=t.fontFamily;r.style.fontWeight=t.fontWeight;r.style.fontStyle=t.fontStyle;r.style.letterSpacing=t.letterSpacing}},updateInputWidth:function e(){if(!this.isMounted()||typeof this.refs.sizer.scrollWidth==="undefined"){return}var t=undefined;if(this.props.placeholder&&(!this.props.value||this.props.value&&this.props.placeholderIsMinWidth)){t=Math.max(this.refs.sizer.scrollWidth,this.refs.placeholderSizer.scrollWidth)+2}else{t=this.refs.sizer.scrollWidth+2}if(t<this.props.minWidth){t=this.props.minWidth}if(t!==this.state.inputWidth){this.setState({inputWidth:t})}},getInput:function e(){return this.refs.input},focus:function e(){this.refs.input.focus()},blur:function e(){this.refs.input.blur()},select:function e(){this.refs.input.select()},render:function e(){var t=this.props.defaultValue||this.props.value||"";var i=this.props.style||{};if(!i.display)i.display="inline-block";var a=r({},this.props.inputStyle);a.width=this.state.inputWidth+"px";a.boxSizing="content-box";var s=r({},this.props);s.className=this.props.inputClassName;s.style=a;delete s.inputClassName;delete s.inputStyle;delete s.minWidth;delete s.placeholderIsMinWidth;return n.createElement("div",{className:this.props.className,style:i},n.createElement("input",r({},s,{ref:"input"})),n.createElement("div",{ref:"sizer",style:o},t),this.props.placeholder?n.createElement("div",{ref:"placeholderSizer",style:o},this.props.placeholder):null)}});t.exports=a},{react:"react"}],158:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i.default=o;var n=e("js-search");function o(e){var t=e.indexes,i=e.indexStrategy,o=e.labelKey,a=o===undefined?"label":o,s=e.options,l=s===undefined?[]:s,u=e.sanitizer,c=e.searchIndex,d=e.tokenizer,p=e.valueKey,f=p===undefined?"value":p;var h=new n.Search(f);h.searchIndex=c||new n.UnorderedSearchIndex;h.indexStrategy=i||new n.AllSubstringsIndexStrategy;if(u){h.sanitizer=u}if(d){h.tokenizer=d}if(t){t.forEach(function(e){h.addIndex(e)})}else{h.addIndex(a)}h.addDocuments(l);return function e(t,i,n){var o=i?h.search(i):t;if(Array.isArray(n)&&n.length){var a=function(){var e=n.map(function(e){return e[f]});return{v:o.filter(function(t){return!e.includes(t[f])})}}();if((typeof a==="undefined"?"undefined":r(a))==="object")return a.v}return o}}},{"js-search":45}],159:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var o=function e(t,i,r){var n=true;e:while(n){var o=t,a=i,s=r;n=false;if(o===null)o=Function.prototype;var l=Object.getOwnPropertyDescriptor(o,a);if(l===undefined){var u=Object.getPrototypeOf(o);if(u===null){return undefined}else{t=u;i=a;r=s;n=true;l=u=undefined;continue e}}else if("value"in l){return l.value}else{var c=l.get;if(c===undefined){return undefined}return c.call(s)}}};function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,i){if(t in e){Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true})}else{e[t]=i}return e}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=e("react");var d=a(c);var p=e("./Select");var f=a(p);var h=e("./utils/stripDiacritics");var g=a(h);var m={autoload:d["default"].PropTypes.bool.isRequired,cache:d["default"].PropTypes.any,children:d["default"].PropTypes.func.isRequired,ignoreAccents:d["default"].PropTypes.bool,ignoreCase:d["default"].PropTypes.bool,loadingPlaceholder:c.PropTypes.string.isRequired,loadOptions:d["default"].PropTypes.func.isRequired,options:c.PropTypes.array.isRequired,placeholder:d["default"].PropTypes.oneOfType([d["default"].PropTypes.string,d["default"].PropTypes.node]),searchPromptText:d["default"].PropTypes.oneOfType([d["default"].PropTypes.string,d["default"].PropTypes.node])};var v={autoload:true,cache:{},children:b,ignoreAccents:true,ignoreCase:true,loadingPlaceholder:"Loading...",options:[],searchPromptText:"Type to search"};var y=function(e){u(t,e);function t(e,i){l(this,t);o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i);this.state={isLoading:false,options:e.options};this._onInputChange=this._onInputChange.bind(this)}n(t,[{key:"componentDidMount",value:function e(){var t=this.props.autoload;if(t){this.loadOptions("")}}},{key:"componentWillUpdate",value:function e(t,i){var r=this;var n=["options"];n.forEach(function(e){if(r.props[e]!==t[e]){r.setState(s({},e,t[e]))}})}},{key:"loadOptions",value:function e(t){var i=this;var r=this.props;var n=r.cache;var e=r.loadOptions;if(n&&n.hasOwnProperty(t)){this.setState({options:n[t]});return}var o=function e(r,o){if(e===i._callback){i._callback=null;var a=o&&o.options||[];if(n){n[t]=a;
}i.setState({isLoading:false,options:a})}};this._callback=o;var a=e(t,o);if(a){a.then(function(e){return o(null,e)},function(e){return o(e)})}if(this._callback&&!this.state.isLoading){this.setState({isLoading:true})}return t}},{key:"_onInputChange",value:function e(t){var i=this.props;var r=i.ignoreAccents;var n=i.ignoreCase;if(r){t=(0,g["default"])(t)}if(n){t=t.toLowerCase()}return this.loadOptions(t)}},{key:"render",value:function e(){var t=this.props;var i=t.children;var n=t.loadingPlaceholder;var o=t.placeholder;var a=t.searchPromptText;var s=this.state;var l=s.isLoading;var u=s.options;var c={noResultsText:l?n:a,placeholder:l?n:o,options:l?[]:u};return i(r({},this.props,c,{isLoading:l,onInputChange:this._onInputChange}))}}]);return t}(c.Component);i["default"]=y;y.propTypes=m;y.defaultProps=v;function b(e){return d["default"].createElement(f["default"],e)}t.exports=i["default"]},{"./Select":163,"./utils/stripDiacritics":168,react:"react"}],160:[function(e,t,i){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};function n(e){return e&&e.__esModule?e:{default:e}}var o=e("react");var a=n(o);var s=e("./Select");var l=n(s);var u=a["default"].createClass({displayName:"AsyncCreatableSelect",render:function e(){var t=this;return a["default"].createElement(l["default"].Async,this.props,function(e){return a["default"].createElement(l["default"].Creatable,t.props,function(t){return a["default"].createElement(l["default"],r({},e,t,{onInputChange:function(i){t.onInputChange(i);return e.onInputChange(i)}}))})})}});t.exports=u},{"./Select":163,react:"react"}],161:[function(e,t,i){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var i={};for(var r in e){if(t.indexOf(r)>=0)continue;if(!Object.prototype.hasOwnProperty.call(e,r))continue;i[r]=e[r]}return i}var a=e("react");var s=n(a);var l=e("./Select");var u=n(l);var c=e("./utils/defaultFilterOptions");var d=n(c);var p=e("./utils/defaultMenuRenderer");var f=n(p);var h=s["default"].createClass({displayName:"CreatableSelect",propTypes:{children:s["default"].PropTypes.func,filterOptions:s["default"].PropTypes.any,isOptionUnique:s["default"].PropTypes.func,isValidNewOption:s["default"].PropTypes.func,menuRenderer:s["default"].PropTypes.any,newOptionCreator:s["default"].PropTypes.func,options:s["default"].PropTypes.array,promptTextCreator:s["default"].PropTypes.func,shouldKeyDownEventCreateNewOption:s["default"].PropTypes.func},statics:{isOptionUnique:m,isValidNewOption:v,newOptionCreator:y,promptTextCreator:b,shouldKeyDownEventCreateNewOption:w},getDefaultProps:function e(){return{filterOptions:d["default"],isOptionUnique:m,isValidNewOption:v,menuRenderer:f["default"],newOptionCreator:y,promptTextCreator:b,shouldKeyDownEventCreateNewOption:w}},createNewOption:function e(){var t=this.props;var i=t.isValidNewOption;var r=t.newOptionCreator;var n=t.options;var o=n===undefined?[]:n;var a=t.shouldKeyDownEventCreateNewOption;if(i({label:this.inputValue})){var s=r({label:this.inputValue,labelKey:this.labelKey,valueKey:this.valueKey});var l=this.isOptionUnique({option:s});if(l){o.unshift(s);this.select.selectValue(s)}}},filterOptions:function e(){var t=this.props;var e=t.filterOptions;var i=t.isValidNewOption;var r=t.options;var n=t.promptTextCreator;var o=arguments[2]||[];var a=e.apply(undefined,arguments)||[];if(i({label:this.inputValue})){var s=this.props.newOptionCreator;var l=s({label:this.inputValue,labelKey:this.labelKey,valueKey:this.valueKey});var u=this.isOptionUnique({option:l,options:o.concat(a)});if(u){var c=n(this.inputValue);this._createPlaceholderOption=s({label:c,labelKey:this.labelKey,valueKey:this.valueKey});a.unshift(this._createPlaceholderOption)}}return a},isOptionUnique:function e(t){var i=t.option;var r=t.options;var e=this.props.isOptionUnique;r=r||this.select.filterOptions();return e({labelKey:this.labelKey,option:i,options:r,valueKey:this.valueKey})},menuRenderer:function e(t){var e=this.props.menuRenderer;return e(r({},t,{onSelect:this.onOptionSelect}))},onInputChange:function e(t){this.inputValue=t},onInputKeyDown:function e(t){var i=this.props.shouldKeyDownEventCreateNewOption;var r=this.select.getFocusedOption();if(r&&r===this._createPlaceholderOption&&i({keyCode:t.keyCode})){this.createNewOption();t.preventDefault()}},onOptionSelect:function e(t,i){if(t===this._createPlaceholderOption){this.createNewOption()}else{this.select.selectValue(t)}},render:function e(){var t=this;var i=this.props;var n=i.children;var a=n===undefined?g:n;var s=i.newOptionCreator;var l=i.shouldKeyDownEventCreateNewOption;var u=o(i,["children","newOptionCreator","shouldKeyDownEventCreateNewOption"]);var c=r({},u,{allowCreate:true,filterOptions:this.filterOptions,menuRenderer:this.menuRenderer,onInputChange:this.onInputChange,onInputKeyDown:this.onInputKeyDown,ref:function e(i){t.select=i;if(i){t.labelKey=i.props.labelKey;t.valueKey=i.props.valueKey}}});return a(c)}});function g(e){return s["default"].createElement(u["default"],e)}function m(e){var t=e.option;var i=e.options;var r=e.labelKey;var n=e.valueKey;return i.filter(function(e){return e[r]===t[r]||e[n]===t[n]}).length===0}function v(e){var t=e.label;return!!t}function y(e){var t=e.label;var i=e.labelKey;var r=e.valueKey;var n={};n[r]=t;n[i]=t;n.className="Select-create-option-placeholder";return n}function b(e){return'Create option "'+e+'"'}function w(e){var t=e.keyCode;switch(t){case 9:case 13:case 188:return true}return false}t.exports=h},{"./Select":163,"./utils/defaultFilterOptions":166,"./utils/defaultMenuRenderer":167,react:"react"}],162:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var n=e("react");var o=r(n);var a=e("classnames");var s=r(a);var l=o["default"].createClass({displayName:"Option",propTypes:{children:o["default"].PropTypes.node,className:o["default"].PropTypes.string,instancePrefix:o["default"].PropTypes.string.isRequired,isDisabled:o["default"].PropTypes.bool,isFocused:o["default"].PropTypes.bool,isSelected:o["default"].PropTypes.bool,onFocus:o["default"].PropTypes.func,onSelect:o["default"].PropTypes.func,onUnfocus:o["default"].PropTypes.func,option:o["default"].PropTypes.object.isRequired,optionIndex:o["default"].PropTypes.number},blockEvent:function e(t){t.preventDefault();t.stopPropagation();if(t.target.tagName!=="A"||!("href"in t.target)){return}if(t.target.target){window.open(t.target.href,t.target.target)}else{window.location.href=t.target.href}},handleMouseDown:function e(t){t.preventDefault();t.stopPropagation();this.props.onSelect(this.props.option,t)},handleMouseEnter:function e(t){this.onFocus(t)},handleMouseMove:function e(t){this.onFocus(t)},handleTouchEnd:function e(t){if(this.dragging)return;this.handleMouseDown(t)},handleTouchMove:function e(t){this.dragging=true},handleTouchStart:function e(t){this.dragging=false},onFocus:function e(t){if(!this.props.isFocused){this.props.onFocus(this.props.option,t)}},render:function e(){var t=this.props;var i=t.option;var r=t.instancePrefix;var n=t.optionIndex;var a=(0,s["default"])(this.props.className,i.className);return i.disabled?o["default"].createElement("div",{className:a,onMouseDown:this.blockEvent,onClick:this.blockEvent},this.props.children):o["default"].createElement("div",{className:a,style:i.style,role:"option",onMouseDown:this.handleMouseDown,onMouseEnter:this.handleMouseEnter,onMouseMove:this.handleMouseMove,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,onTouchEnd:this.handleTouchEnd,id:r+"-option-"+n,title:i.title},this.props.children)}});t.exports=l},{classnames:6,react:"react"}],163:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var i={};for(var r in e){if(t.indexOf(r)>=0)continue;if(!Object.prototype.hasOwnProperty.call(e,r))continue;i[r]=e[r]}return i}function a(e,t,i){if(t in e){Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true})}else{e[t]=i}return e}var s=e("react");var l=n(s);var u=e("react-dom");var c=n(u);var d=e("react-input-autosize");var p=n(d);var f=e("classnames");var h=n(f);var g=e("./utils/defaultArrowRenderer");var m=n(g);var v=e("./utils/defaultFilterOptions");var y=n(v);var b=e("./utils/defaultMenuRenderer");var w=n(b);var C=e("./Async");var E=n(C);var S=e("./AsyncCreatable");var T=n(S);var x=e("./Creatable");var _=n(x);var M=e("./Option");var A=n(M);var I=e("./Value");var O=n(I);function D(e){var t=typeof e;if(t==="string"){return e}else if(t==="object"){return JSON.stringify(e)}else if(t==="number"||t==="boolean"){return String(e)}else{return""}}var N=l["default"].PropTypes.oneOfType([l["default"].PropTypes.string,l["default"].PropTypes.node]);var R=1;var P=l["default"].createClass({displayName:"Select",propTypes:{addLabelText:l["default"].PropTypes.string,"aria-label":l["default"].PropTypes.string,"aria-labelledby":l["default"].PropTypes.string,arrowRenderer:l["default"].PropTypes.func,autoBlur:l["default"].PropTypes.bool,autofocus:l["default"].PropTypes.bool,autosize:l["default"].PropTypes.bool,backspaceRemoves:l["default"].PropTypes.bool,backspaceToRemoveMessage:l["default"].PropTypes.string,className:l["default"].PropTypes.string,clearAllText:N,clearValueText:N,clearable:l["default"].PropTypes.bool,delimiter:l["default"].PropTypes.string,disabled:l["default"].PropTypes.bool,escapeClearsValue:l["default"].PropTypes.bool,filterOption:l["default"].PropTypes.func,filterOptions:l["default"].PropTypes.any,ignoreAccents:l["default"].PropTypes.bool,ignoreCase:l["default"].PropTypes.bool,inputProps:l["default"].PropTypes.object,inputRenderer:l["default"].PropTypes.func,instanceId:l["default"].PropTypes.string,isLoading:l["default"].PropTypes.bool,joinValues:l["default"].PropTypes.bool,labelKey:l["default"].PropTypes.string,matchPos:l["default"].PropTypes.string,matchProp:l["default"].PropTypes.string,menuBuffer:l["default"].PropTypes.number,menuContainerStyle:l["default"].PropTypes.object,menuRenderer:l["default"].PropTypes.func,menuStyle:l["default"].PropTypes.object,multi:l["default"].PropTypes.bool,name:l["default"].PropTypes.string,noResultsText:N,onBlur:l["default"].PropTypes.func,onBlurResetsInput:l["default"].PropTypes.bool,onChange:l["default"].PropTypes.func,onClose:l["default"].PropTypes.func,onCloseResetsInput:l["default"].PropTypes.bool,onFocus:l["default"].PropTypes.func,onInputChange:l["default"].PropTypes.func,onInputKeyDown:l["default"].PropTypes.func,onMenuScrollToBottom:l["default"].PropTypes.func,onOpen:l["default"].PropTypes.func,onValueClick:l["default"].PropTypes.func,openAfterFocus:l["default"].PropTypes.bool,openOnFocus:l["default"].PropTypes.bool,optionClassName:l["default"].PropTypes.string,optionComponent:l["default"].PropTypes.func,optionRenderer:l["default"].PropTypes.func,options:l["default"].PropTypes.array,pageSize:l["default"].PropTypes.number,placeholder:N,required:l["default"].PropTypes.bool,resetValue:l["default"].PropTypes.any,scrollMenuIntoView:l["default"].PropTypes.bool,searchable:l["default"].PropTypes.bool,simpleValue:l["default"].PropTypes.bool,style:l["default"].PropTypes.object,tabIndex:l["default"].PropTypes.string,tabSelectsValue:l["default"].PropTypes.bool,value:l["default"].PropTypes.any,valueComponent:l["default"].PropTypes.func,valueKey:l["default"].PropTypes.string,valueRenderer:l["default"].PropTypes.func,wrapperStyle:l["default"].PropTypes.object},statics:{Async:E["default"],AsyncCreatable:T["default"],Creatable:_["default"]},getDefaultProps:function e(){return{addLabelText:'Add "{label}"?',arrowRenderer:m["default"],autosize:true,backspaceRemoves:true,backspaceToRemoveMessage:"Press backspace to remove {label}",clearable:true,clearAllText:"Clear all",clearValueText:"Clear value",delimiter:",",disabled:false,escapeClearsValue:true,filterOptions:y["default"],ignoreAccents:true,ignoreCase:true,inputProps:{},isLoading:false,joinValues:false,labelKey:"label",matchPos:"any",matchProp:"any",menuBuffer:0,menuRenderer:w["default"],multi:false,noResultsText:"No results found",onBlurResetsInput:true,onCloseResetsInput:true,openAfterFocus:false,optionComponent:A["default"],pageSize:5,placeholder:"Select...",required:false,scrollMenuIntoView:true,searchable:true,simpleValue:false,tabSelectsValue:true,valueComponent:O["default"],valueKey:"value"}},getInitialState:function e(){return{inputValue:"",isFocused:false,isOpen:false,isPseudoFocused:false,required:false}},componentWillMount:function e(){this._instancePrefix="react-select-"+(this.props.instanceId||++R)+"-";var t=this.getValueArray(this.props.value);if(this.props.required){this.setState({required:this.handleRequired(t[0],this.props.multi)})}},componentDidMount:function e(){if(this.props.autofocus){this.focus()}},componentWillReceiveProps:function e(t){var i=this.getValueArray(t.value,t);if(t.required){this.setState({required:this.handleRequired(i[0],t.multi)})}},componentWillUpdate:function e(t,i){if(i.isOpen!==this.state.isOpen){this.toggleTouchOutsideEvent(i.isOpen);var r=i.isOpen?t.onOpen:t.onClose;r&&r()}},componentDidUpdate:function e(t,i){if(this.menu&&this.focused&&this.state.isOpen&&!this.hasScrolledToOption){var r=c["default"].findDOMNode(this.focused);var n=c["default"].findDOMNode(this.menu);n.scrollTop=r.offsetTop;this.hasScrolledToOption=true}else if(!this.state.isOpen){this.hasScrolledToOption=false}if(this._scrollToFocusedOptionOnUpdate&&this.focused&&this.menu){this._scrollToFocusedOptionOnUpdate=false;var o=c["default"].findDOMNode(this.focused);var a=c["default"].findDOMNode(this.menu);var s=o.getBoundingClientRect();var l=a.getBoundingClientRect();if(s.bottom>l.bottom||s.top<l.top){a.scrollTop=o.offsetTop+o.clientHeight-a.offsetHeight}}if(this.props.scrollMenuIntoView&&this.menuContainer){var u=this.menuContainer.getBoundingClientRect();if(window.innerHeight<u.bottom+this.props.menuBuffer){window.scrollBy(0,u.bottom+this.props.menuBuffer-window.innerHeight)}}if(t.disabled!==this.props.disabled){this.setState({isFocused:false});this.closeMenu()}},componentWillUnmount:function e(){document.removeEventListener("touchstart",this.handleTouchOutside)},toggleTouchOutsideEvent:function e(t){if(t){document.addEventListener("touchstart",this.handleTouchOutside)}else{document.removeEventListener("touchstart",this.handleTouchOutside)}},handleTouchOutside:function e(t){if(this.wrapper&&!this.wrapper.contains(t.target)){this.closeMenu()}},focus:function e(){if(!this.input)return;this.input.focus();if(this.props.openAfterFocus){this.setState({isOpen:true})}},blurInput:function e(){if(!this.input)return;this.input.blur()},handleTouchMove:function e(t){this.dragging=true},handleTouchStart:function e(t){this.dragging=false},handleTouchEnd:function e(t){if(this.dragging)return;this.handleMouseDown(t)},handleTouchEndClearValue:function e(t){if(this.dragging)return;this.clearValue(t)},handleMouseDown:function e(t){if(this.props.disabled||t.type==="mousedown"&&t.button!==0){return}if(t.target.tagName==="INPUT"){return}t.stopPropagation();t.preventDefault();if(!this.props.searchable){this.focus();return this.setState({isOpen:!this.state.isOpen})}if(this.state.isFocused){this.focus();var i=this.input;if(typeof i.getInput==="function"){i=i.getInput()}i.value="";this.setState({isOpen:true,isPseudoFocused:false})}else{this._openAfterFocus=true;this.focus()}},handleMouseDownOnArrow:function e(t){if(this.props.disabled||t.type==="mousedown"&&t.button!==0){return}if(!this.state.isOpen){return}t.stopPropagation();t.preventDefault();this.closeMenu()},handleMouseDownOnMenu:function e(t){if(this.props.disabled||t.type==="mousedown"&&t.button!==0){return}t.stopPropagation();t.preventDefault();this._openAfterFocus=true;this.focus()},closeMenu:function e(){if(this.props.onCloseResetsInput){this.setState({isOpen:false,isPseudoFocused:this.state.isFocused&&!this.props.multi,inputValue:""})}else{this.setState({isOpen:false,isPseudoFocused:this.state.isFocused&&!this.props.multi,inputValue:this.state.inputValue})}this.hasScrolledToOption=false},handleInputFocus:function e(t){if(this.props.disabled)return;var i=this.state.isOpen||this._openAfterFocus||this.props.openOnFocus;if(this.props.onFocus){this.props.onFocus(t)}this.setState({isFocused:true,isOpen:i});this._openAfterFocus=false},handleInputBlur:function e(t){if(this.menu&&(this.menu===document.activeElement||this.menu.contains(document.activeElement))){this.focus();return}if(this.props.onBlur){this.props.onBlur(t)}var i={isFocused:false,isOpen:false,isPseudoFocused:false};if(this.props.onBlurResetsInput){i.inputValue=""}this.setState(i)},handleInputChange:function e(t){var i=t.target.value;if(this.state.inputValue!==t.target.value&&this.props.onInputChange){var r=this.props.onInputChange(i);if(r!=null&&typeof r!=="object"){i=""+r}}this.setState({isOpen:true,isPseudoFocused:false,inputValue:i})},handleKeyDown:function e(t){if(this.props.disabled)return;if(typeof this.props.onInputKeyDown==="function"){this.props.onInputKeyDown(t);if(t.defaultPrevented){return}}switch(t.keyCode){case 8:if(!this.state.inputValue&&this.props.backspaceRemoves){t.preventDefault();this.popValue()}return;case 9:if(t.shiftKey||!this.state.isOpen||!this.props.tabSelectsValue){return}this.selectFocusedOption();return;case 13:if(!this.state.isOpen)return;t.stopPropagation();this.selectFocusedOption();break;case 27:if(this.state.isOpen){this.closeMenu();t.stopPropagation()}else if(this.props.clearable&&this.props.escapeClearsValue){this.clearValue(t);t.stopPropagation()}break;case 38:this.focusPreviousOption();break;case 40:this.focusNextOption();break;case 33:this.focusPageUpOption();break;case 34:this.focusPageDownOption();break;case 35:if(t.shiftKey){return}this.focusEndOption();break;case 36:if(t.shiftKey){return}this.focusStartOption();break;default:return}t.preventDefault()},handleValueClick:function e(t,i){if(!this.props.onValueClick)return;this.props.onValueClick(t,i)},handleMenuScroll:function e(t){if(!this.props.onMenuScrollToBottom)return;var i=t.target;if(i.scrollHeight>i.offsetHeight&&!(i.scrollHeight-i.offsetHeight-i.scrollTop)){this.props.onMenuScrollToBottom()}},handleRequired:function e(t,i){if(!t)return true;return i?t.length===0:Object.keys(t).length===0},getOptionLabel:function e(t){return t[this.props.labelKey]},getValueArray:function e(t,i){var r=this;var n=typeof i==="object"?i:this.props;if(n.multi){if(typeof t==="string")t=t.split(n.delimiter);if(!Array.isArray(t)){if(t===null||t===undefined)return[];t=[t]}return t.map(function(e){return r.expandValue(e,n)}).filter(function(e){return e})}var o=this.expandValue(t,n);return o?[o]:[]},expandValue:function e(t,i){var r=typeof t;if(r!=="string"&&r!=="number"&&r!=="boolean")return t;var n=i.options;var o=i.valueKey;if(!n)return;for(var a=0;a<n.length;a++){if(n[a][o]===t)return n[a]}},setValue:function e(t){var i=this;if(this.props.autoBlur){this.blurInput()}if(!this.props.onChange)return;if(this.props.required){var r=this.handleRequired(t,this.props.multi);this.setState({required:r})}if(this.props.simpleValue&&t){t=this.props.multi?t.map(function(e){return e[i.props.valueKey]}).join(this.props.delimiter):t[this.props.valueKey]}this.props.onChange(t)},selectValue:function e(t){var i=this;this.hasScrolledToOption=false;if(this.props.multi){this.setState({inputValue:"",focusedIndex:null},function(){i.addValue(t)})}else{this.setState({isOpen:false,inputValue:"",isPseudoFocused:this.state.isFocused},function(){i.setValue(t)})}},addValue:function e(t){var i=this.getValueArray(this.props.value);this.setValue(i.concat(t))},popValue:function e(){var t=this.getValueArray(this.props.value);if(!t.length)return;if(t[t.length-1].clearableValue===false)return;this.setValue(t.slice(0,t.length-1))},removeValue:function e(t){var i=this.getValueArray(this.props.value);this.setValue(i.filter(function(e){return e!==t}));this.focus()},clearValue:function e(t){if(t&&t.type==="mousedown"&&t.button!==0){return}t.stopPropagation();t.preventDefault();this.setValue(this.getResetValue());this.setState({isOpen:false,inputValue:""},this.focus)},getResetValue:function e(){if(this.props.resetValue!==undefined){return this.props.resetValue}else if(this.props.multi){return[]}else{return null}},focusOption:function e(t){this.setState({focusedOption:t})},focusNextOption:function e(){this.focusAdjacentOption("next")},focusPreviousOption:function e(){this.focusAdjacentOption("previous")},focusPageUpOption:function e(){this.focusAdjacentOption("page_up")},focusPageDownOption:function e(){this.focusAdjacentOption("page_down")},focusStartOption:function e(){this.focusAdjacentOption("start")},focusEndOption:function e(){this.focusAdjacentOption("end")},focusAdjacentOption:function e(t){var i=this._visibleOptions.map(function(e,t){return{option:e,index:t}}).filter(function(e){return!e.option.disabled});this._scrollToFocusedOptionOnUpdate=true;if(!this.state.isOpen){this.setState({isOpen:true,inputValue:"",focusedOption:this._focusedOption||i[t==="next"?0:i.length-1].option});return}if(!i.length)return;var r=-1;for(var n=0;n<i.length;n++){if(this._focusedOption===i[n].option){r=n;break}}if(t==="next"&&r!==-1){r=(r+1)%i.length}else if(t==="previous"){if(r>0){r=r-1}else{r=i.length-1}}else if(t==="start"){r=0}else if(t==="end"){r=i.length-1}else if(t==="page_up"){var o=r-this.props.pageSize;if(o<0){r=0}else{r=o}}else if(t==="page_down"){var o=r+this.props.pageSize;if(o>i.length-1){r=i.length-1}else{r=o}}if(r===-1){r=0}this.setState({focusedIndex:i[r].index,focusedOption:i[r].option})},getFocusedOption:function e(){return this._focusedOption},getInputValue:function e(){return this.state.inputValue},selectFocusedOption:function e(){if(this._focusedOption){return this.selectValue(this._focusedOption)}},renderLoading:function e(){if(!this.props.isLoading)return;return l["default"].createElement("span",{className:"Select-loading-zone","aria-hidden":"true"},l["default"].createElement("span",{className:"Select-loading"}))},renderValue:function e(t,i){var r=this;var n=this.props.valueRenderer||this.getOptionLabel;var o=this.props.valueComponent;if(!t.length){return!this.state.inputValue?l["default"].createElement("div",{className:"Select-placeholder"},this.props.placeholder):null}var a=this.props.onValueClick?this.handleValueClick:null;if(this.props.multi){return t.map(function(e,t){return l["default"].createElement(o,{id:r._instancePrefix+"-value-"+t,instancePrefix:r._instancePrefix,disabled:r.props.disabled||e.clearableValue===false,key:"value-"+t+"-"+e[r.props.valueKey],onClick:a,onRemove:r.removeValue,value:e},n(e,t),l["default"].createElement("span",{className:"Select-aria-only"},"Â "))})}else if(!this.state.inputValue){if(i)a=null;return l["default"].createElement(o,{id:this._instancePrefix+"-value-item",disabled:this.props.disabled,instancePrefix:this._instancePrefix,onClick:a,value:t[0]},n(t[0]))}},renderInput:function e(t,i){var n=this;if(this.props.inputRenderer){return this.props.inputRenderer()}else{var s;var u=(0,h["default"])("Select-input",this.props.inputProps.className);var c=!!this.state.isOpen;var d=(0,h["default"])((s={},a(s,this._instancePrefix+"-list",c),a(s,this._instancePrefix+"-backspace-remove-message",this.props.multi&&!this.props.disabled&&this.state.isFocused&&!this.state.inputValue),s));var f=r({},this.props.inputProps,{role:"combobox","aria-expanded":""+c,"aria-owns":d,"aria-haspopup":""+c,"aria-activedescendant":c?this._instancePrefix+"-option-"+i:this._instancePrefix+"-value","aria-labelledby":this.props["aria-labelledby"],"aria-label":this.props["aria-label"],className:u,tabIndex:this.props.tabIndex,onBlur:this.handleInputBlur,onChange:this.handleInputChange,onFocus:this.handleInputFocus,ref:function e(t){return n.input=t},required:this.state.required,value:this.state.inputValue});if(this.props.disabled||!this.props.searchable){var g=this.props.inputProps;var m=g.inputClassName;var v=o(g,["inputClassName"]);return l["default"].createElement("div",r({},v,{role:"combobox","aria-expanded":c,"aria-owns":c?this._instancePrefix+"-list":this._instancePrefix+"-value","aria-activedescendant":c?this._instancePrefix+"-option-"+i:this._instancePrefix+"-value",className:u,tabIndex:this.props.tabIndex||0,onBlur:this.handleInputBlur,onFocus:this.handleInputFocus,ref:function(e){return n.input=e},"aria-readonly":""+!!this.props.disabled,style:{border:0,width:1,display:"inline-block"}}))}if(this.props.autosize){return l["default"].createElement(p["default"],r({},f,{minWidth:"5px"}))}return l["default"].createElement("div",{className:u},l["default"].createElement("input",f))}},renderClear:function e(){if(!this.props.clearable||!this.props.value||this.props.value===0||this.props.multi&&!this.props.value.length||this.props.disabled||this.props.isLoading)return;return l["default"].createElement("span",{className:"Select-clear-zone",title:this.props.multi?this.props.clearAllText:this.props.clearValueText,"aria-label":this.props.multi?this.props.clearAllText:this.props.clearValueText,onMouseDown:this.clearValue,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,onTouchEnd:this.handleTouchEndClearValue},l["default"].createElement("span",{className:"Select-clear",dangerouslySetInnerHTML:{__html:"&times;"}}))},renderArrow:function e(){var t=this.handleMouseDownOnArrow;var i=this.props.arrowRenderer({onMouseDown:t});return l["default"].createElement("span",{className:"Select-arrow-zone",onMouseDown:t},i)},filterOptions:function e(t){var i=this.state.inputValue;var r=this.props.options||[];if(this.props.filterOptions){var e=typeof this.props.filterOptions==="function"?this.props.filterOptions:y["default"];return e(r,i,t,{filterOption:this.props.filterOption,ignoreAccents:this.props.ignoreAccents,ignoreCase:this.props.ignoreCase,labelKey:this.props.labelKey,matchPos:this.props.matchPos,matchProp:this.props.matchProp,valueKey:this.props.valueKey})}else{return r}},onOptionRef:function e(t,i){if(i){this.focused=t}},renderMenu:function e(t,i,r){if(t&&t.length){return this.props.menuRenderer({focusedOption:r,focusOption:this.focusOption,instancePrefix:this._instancePrefix,labelKey:this.props.labelKey,onFocus:this.focusOption,onSelect:this.selectValue,optionClassName:this.props.optionClassName,optionComponent:this.props.optionComponent,optionRenderer:this.props.optionRenderer||this.getOptionLabel,options:t,selectValue:this.selectValue,valueArray:i,valueKey:this.props.valueKey,onOptionRef:this.onOptionRef})}else if(this.props.noResultsText){return l["default"].createElement("div",{className:"Select-noresults"},this.props.noResultsText)}else{return null}},renderHiddenField:function e(t){var i=this;if(!this.props.name)return;if(this.props.joinValues){var r=t.map(function(e){return D(e[i.props.valueKey])}).join(this.props.delimiter);return l["default"].createElement("input",{type:"hidden",ref:function(e){return i.value=e},name:this.props.name,value:r,disabled:this.props.disabled})}return t.map(function(e,t){return l["default"].createElement("input",{key:"hidden."+t,type:"hidden",ref:"value"+t,name:i.props.name,value:D(e[i.props.valueKey]),disabled:i.props.disabled})})},getFocusableOptionIndex:function e(t){var i=this._visibleOptions;if(!i.length)return null;var r=this.state.focusedOption||t;if(r&&!r.disabled){var n=i.indexOf(r);if(n!==-1){return n}}for(var o=0;o<i.length;o++){if(!i[o].disabled)return o}return null},renderOuter:function e(t,i,r){var n=this;var o=this.renderMenu(t,i,r);if(!o){return null}return l["default"].createElement("div",{ref:function(e){return n.menuContainer=e},className:"Select-menu-outer",style:this.props.menuContainerStyle},l["default"].createElement("div",{ref:function(e){return n.menu=e},role:"listbox",className:"Select-menu",id:this._instancePrefix+"-list",style:this.props.menuStyle,onScroll:this.handleMenuScroll,onMouseDown:this.handleMouseDownOnMenu},o))},render:function e(){var t=this;var i=this.getValueArray(this.props.value);var r=this._visibleOptions=this.filterOptions(this.props.multi?this.getValueArray(this.props.value):null);var n=this.state.isOpen;if(this.props.multi&&!r.length&&i.length&&!this.state.inputValue)n=false;var o=this.getFocusableOptionIndex(i[0]);var a=null;if(o!==null){a=this._focusedOption=r[o]}else{a=this._focusedOption=null}var s=(0,h["default"])("Select",this.props.className,{"Select--multi":this.props.multi,"Select--single":!this.props.multi,"is-disabled":this.props.disabled,"is-focused":this.state.isFocused,"is-loading":this.props.isLoading,"is-open":n,"is-pseudo-focused":this.state.isPseudoFocused,"is-searchable":this.props.searchable,"has-value":i.length});var u=null;if(this.props.multi&&!this.props.disabled&&i.length&&!this.state.inputValue&&this.state.isFocused&&this.props.backspaceRemoves){u=l["default"].createElement("span",{id:this._instancePrefix+"-backspace-remove-message",className:"Select-aria-only","aria-live":"assertive"},this.props.backspaceToRemoveMessage.replace("{label}",i[i.length-1][this.props.labelKey]))}return l["default"].createElement("div",{ref:function(e){return t.wrapper=e},className:s,style:this.props.wrapperStyle},this.renderHiddenField(i),l["default"].createElement("div",{ref:function(e){return t.control=e},className:"Select-control",style:this.props.style,onKeyDown:this.handleKeyDown,onMouseDown:this.handleMouseDown,onTouchEnd:this.handleTouchEnd,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove},l["default"].createElement("span",{className:"Select-multi-value-wrapper",id:this._instancePrefix+"-value"},this.renderValue(i,n),this.renderInput(i,o)),u,this.renderLoading(),this.renderClear(),this.renderArrow()),n?this.renderOuter(r,!this.props.multi?i:null,a):null)}});i["default"]=P;t.exports=i["default"]},{"./Async":159,"./AsyncCreatable":160,"./Creatable":161,"./Option":162,"./Value":164,"./utils/defaultArrowRenderer":165,"./utils/defaultFilterOptions":166,"./utils/defaultMenuRenderer":167,classnames:6,react:"react","react-dom":"react-dom","react-input-autosize":157}],164:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var n=e("react");var o=r(n);var a=e("classnames");var s=r(a);var l=o["default"].createClass({displayName:"Value",propTypes:{children:o["default"].PropTypes.node,disabled:o["default"].PropTypes.bool,id:o["default"].PropTypes.string,onClick:o["default"].PropTypes.func,onRemove:o["default"].PropTypes.func,value:o["default"].PropTypes.object.isRequired},handleMouseDown:function e(t){if(t.type==="mousedown"&&t.button!==0){return}if(this.props.onClick){t.stopPropagation();this.props.onClick(this.props.value,t);return}if(this.props.value.href){t.stopPropagation()}},onRemove:function e(t){t.preventDefault();t.stopPropagation();this.props.onRemove(this.props.value)},handleTouchEndRemove:function e(t){if(this.dragging)return;this.onRemove(t)},handleTouchMove:function e(t){this.dragging=true},handleTouchStart:function e(t){this.dragging=false},renderRemoveIcon:function e(){if(this.props.disabled||!this.props.onRemove)return;return o["default"].createElement("span",{className:"Select-value-icon","aria-hidden":"true",onMouseDown:this.onRemove,onTouchEnd:this.handleTouchEndRemove,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove},"Ã")},renderLabel:function e(){var t="Select-value-label";return this.props.onClick||this.props.value.href?o["default"].createElement("a",{className:t,href:this.props.value.href,target:this.props.value.target,onMouseDown:this.handleMouseDown,onTouchEnd:this.handleMouseDown},this.props.children):o["default"].createElement("span",{
className:t,role:"option","aria-selected":"true",id:this.props.id},this.props.children)},render:function e(){return o["default"].createElement("div",{className:(0,s["default"])("Select-value",this.props.value.className),style:this.props.value.style,title:this.props.value.title},this.renderRemoveIcon(),this.renderLabel())}});t.exports=l},{classnames:6,react:"react"}],165:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i["default"]=a;function r(e){return e&&e.__esModule?e:{default:e}}var n=e("react");var o=r(n);function a(e){var t=e.onMouseDown;return o["default"].createElement("span",{className:"Select-arrow",onMouseDown:t})}t.exports=i["default"]},{react:"react"}],166:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var n=e("./stripDiacritics");var o=r(n);function a(e,t,i,r){var n=this;if(r.ignoreAccents){t=(0,o["default"])(t)}if(r.ignoreCase){t=t.toLowerCase()}if(i)i=i.map(function(e){return e[r.valueKey]});return e.filter(function(e){if(i&&i.indexOf(e[r.valueKey])>-1)return false;if(r.filterOption)return r.filterOption.call(n,e,t);if(!t)return true;var a=String(e[r.valueKey]);var s=String(e[r.labelKey]);if(r.ignoreAccents){if(r.matchProp!=="label")a=(0,o["default"])(a);if(r.matchProp!=="value")s=(0,o["default"])(s)}if(r.ignoreCase){if(r.matchProp!=="label")a=a.toLowerCase();if(r.matchProp!=="value")s=s.toLowerCase()}return r.matchPos==="start"?r.matchProp!=="label"&&a.substr(0,t.length)===t||r.matchProp!=="value"&&s.substr(0,t.length)===t:r.matchProp!=="label"&&a.indexOf(t)>=0||r.matchProp!=="value"&&s.indexOf(t)>=0})}t.exports=a},{"./stripDiacritics":168}],167:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var n=e("classnames");var o=r(n);var a=e("react");var s=r(a);function l(e){var t=e.focusedOption;var i=e.instancePrefix;var r=e.labelKey;var n=e.onFocus;var a=e.onSelect;var l=e.optionClassName;var u=e.optionComponent;var c=e.optionRenderer;var d=e.options;var p=e.valueArray;var f=e.valueKey;var h=e.onOptionRef;var g=u;return d.map(function(e,r){var u=p&&p.indexOf(e)>-1;var d=e===t;var m=(0,o["default"])(l,{"Select-option":true,"is-selected":u,"is-focused":d,"is-disabled":e.disabled});return s["default"].createElement(g,{className:m,instancePrefix:i,isDisabled:e.disabled,isFocused:d,isSelected:u,key:"option-"+r+"-"+e[f],onFocus:n,onSelect:a,option:e,optionIndex:r,ref:function(e){h(e,d)}},c(e,r))})}t.exports=l},{classnames:6,react:"react"}],168:[function(e,t,i){"use strict";var r=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}];t.exports=function e(t){for(var i=0;i<r.length;i++){t=t.replace(r[i].letters,r[i].base)}return t}},{}],169:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default={GLOBAL:{HIDE:"__react_tooltip_hide_event",REBUILD:"__react_tooltip_rebuild_event",SHOW:"__react_tooltip_show_event"}}},{}],170:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=function(e){e.prototype.isCustomEvent=function(e){var t=this.state.event;return t||!!e.getAttribute("data-event")};e.prototype.customBindListener=function(e){var t=this;var i=this.state;var n=i.event;var a=i.eventOff;var s=e.getAttribute("data-event")||n;var l=e.getAttribute("data-event-off")||a;s.split(" ").forEach(function(i){e.removeEventListener(i,o);o=r.bind(t,l);e.addEventListener(i,o,false)});if(l){l.split(" ").forEach(function(i){e.removeEventListener(i,t.hideTooltip);e.addEventListener(i,t.hideTooltip,false)})}};e.prototype.customUnbindListener=function(e){var t=this.state;var i=t.event;var r=t.eventOff;var n=i||e.getAttribute("data-event");var a=r||e.getAttribute("data-event-off");e.removeEventListener(n,o);if(a)e.removeEventListener(a,this.hideTooltip)}};var r=function e(t,i){var r=this.state.show;var o=this.props.id;var a=i.currentTarget.getAttribute("data-iscapture");var s=a&&a==="true"||this.props.isCapture;var l=i.currentTarget.getAttribute("currentItem");if(!s)i.stopPropagation();if(r&&l==="true"){if(!t)this.hideTooltip(i)}else{i.currentTarget.setAttribute("currentItem","true");n(i.currentTarget,this.getTargetArray(o));this.showTooltip(i)}};var n=function e(t,i){for(var r=0;r<i.length;r++){if(t!==i[r]){i[r].setAttribute("currentItem","false")}else{i[r].setAttribute("currentItem","true")}}};var o=void 0},{}],171:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=function(e){e.prototype.isCapture=function(e){var t=e.getAttribute("data-iscapture");return t&&t==="true"||this.props.isCapture||false}}},{}],172:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=function(e){e.hide=function(e){a(n.default.GLOBAL.HIDE,{target:e})};e.rebuild=function(){a(n.default.GLOBAL.REBUILD)};e.show=function(e){a(n.default.GLOBAL.SHOW,{target:e})};e.prototype.globalRebuild=function(){if(this.mount){this.unbindListener();this.bindListener()}};e.prototype.globalShow=function(e){if(this.mount){var t={currentTarget:e.detail.target};this.showTooltip(t,true)}};e.prototype.globalHide=function(e){if(this.mount){var t=e&&e.detail&&e.detail.target&&true||false;this.hideTooltip({currentTarget:t&&e.detail.target},t)}}};var r=e("../constant");var n=o(r);function o(e){return e&&e.__esModule?e:{default:e}}var a=function e(t,i){var r=void 0;if(typeof window.CustomEvent==="function"){r=new window.CustomEvent(t,{detail:i})}else{r=document.createEvent("Event");r.initEvent(t,false,true);r.detail=i}window.dispatchEvent(r)}},{"../constant":169}],173:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=function(e){e.prototype.bindWindowEvents=function(e){window.removeEventListener(n.default.GLOBAL.HIDE,this.globalHide);window.addEventListener(n.default.GLOBAL.HIDE,this.globalHide,false);window.removeEventListener(n.default.GLOBAL.REBUILD,this.globalRebuild);window.addEventListener(n.default.GLOBAL.REBUILD,this.globalRebuild,false);window.removeEventListener(n.default.GLOBAL.SHOW,this.globalShow);window.addEventListener(n.default.GLOBAL.SHOW,this.globalShow,false);if(e){window.removeEventListener("resize",this.onWindowResize);window.addEventListener("resize",this.onWindowResize,false)}};e.prototype.unbindWindowEvents=function(){window.removeEventListener(n.default.GLOBAL.HIDE,this.globalHide);window.removeEventListener(n.default.GLOBAL.REBUILD,this.globalRebuild);window.removeEventListener(n.default.GLOBAL.SHOW,this.globalShow);window.removeEventListener("resize",this.onWindowResize)};e.prototype.onWindowResize=function(){if(!this.mount)return;this.hideTooltip()}};var r=e("../constant");var n=o(r);function o(e){return e&&e.__esModule?e:{default:e}}},{"../constant":169}],174:[function(e,t,i){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var o,a,s;var l=e("react");var u=I(l);var c=e("react-dom");var d=I(c);var p=e("classnames");var f=I(p);var h=e("./decorators/staticMethods");var g=I(h);var m=e("./decorators/windowListener");var v=I(m);var y=e("./decorators/customEvent");var b=I(y);var w=e("./decorators/isCapture");var C=I(w);var E=e("./utils/getPosition");var S=I(E);var T=e("./utils/getTipContent");var x=I(T);var _=e("./utils/aria");var M=e("./style");var A=I(M);function I(e){return e&&e.__esModule?e:{default:e}}function O(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function D(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function N(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var R=(0,g.default)(o=(0,v.default)(o=(0,b.default)(o=(0,C.default)(o=(s=a=function(e){N(t,e);function t(e){O(this,t);var i=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i.state={place:"top",type:"dark",effect:"float",show:false,border:false,placeholder:"",offset:{},extraClass:"",html:false,delayHide:0,delayShow:0,event:e.event||null,eventOff:e.eventOff||null,currentEvent:null,currentTarget:null,ariaProps:(0,_.parseAria)(e),isEmptyTip:false,disable:false};i.bind(["showTooltip","updateTooltip","hideTooltip","globalRebuild","globalShow","globalHide","onWindowResize"]);i.mount=true;i.delayShowLoop=null;i.delayHideLoop=null;i.intervalUpdateContent=null;return i}n(t,[{key:"bind",value:function e(t){var i=this;t.forEach(function(e){i[e]=i[e].bind(i)})}},{key:"componentDidMount",value:function e(){var t=this.props;var i=t.insecure;var r=t.resizeHide;if(i){this.setStyleHeader()}this.bindListener();this.bindWindowEvents(r)}},{key:"componentWillReceiveProps",value:function e(t){var i=this.state.ariaProps;var r=(0,_.parseAria)(t);var n=Object.keys(r).some(function(e){return r[e]!==i[e]});if(n){this.setState({ariaProps:r})}}},{key:"componentWillUnmount",value:function e(){this.mount=false;this.clearTimer();this.unbindListener();this.removeScrollListener();this.unbindWindowEvents()}},{key:"getTargetArray",value:function e(t){var i=void 0;if(!t){i=document.querySelectorAll("[data-tip]:not([data-for])")}else{i=document.querySelectorAll('[data-tip][data-for="'+t+'"]')}return Object.keys(i).filter(function(e){return e!=="length"}).map(function(e){return i[e]})}},{key:"bindListener",value:function e(){var t=this;var i=this.props;var r=i.id;var n=i.globalEventOff;var o=this.getTargetArray(r);o.forEach(function(e){var i=t.isCapture(e);if(e.getAttribute("currentItem")===null){e.setAttribute("currentItem","false")}t.unbindBasicListener(e);if(t.isCustomEvent(e)){t.customBindListener(e);return}e.addEventListener("mouseenter",t.showTooltip,i);if(t.state.effect==="float"){e.addEventListener("mousemove",t.updateTooltip,i)}e.addEventListener("mouseleave",t.hideTooltip,i)});if(n){window.removeEventListener(n,this.hideTooltip);window.addEventListener(n,this.hideTooltip,false)}}},{key:"unbindListener",value:function e(){var t=this;var i=this.props;var r=i.id;var n=i.globalEventOff;var o=this.getTargetArray(r);o.forEach(function(e){t.unbindBasicListener(e);if(t.isCustomEvent(e))t.customUnbindListener(e)});if(n)window.removeEventListener(n,this.hideTooltip)}},{key:"unbindBasicListener",value:function e(t){var i=this.isCapture(t);t.removeEventListener("mouseenter",this.showTooltip,i);t.removeEventListener("mousemove",this.updateTooltip,i);t.removeEventListener("mouseleave",this.hideTooltip,i)}},{key:"showTooltip",value:function e(t,i){var r=this;if(i){var n=this.getTargetArray(this.props.id);var o=n.some(function(e){return e===t.currentTarget});if(!o||this.state.show)return}var a=this.props;var s=a.children;var l=a.multiline;var u=a.getContent;var c=t.currentTarget.getAttribute("data-tip");var d=t.currentTarget.getAttribute("data-multiline")||l||false;var p=void 0;if(u){if(Array.isArray(u)){p=u[0]&&u[0]()}else{p=u()}}var f=(0,x.default)(c,s,p,d);var h=typeof f==="string"&&f===""||f===null;var g=t instanceof window.FocusEvent||i;var m=true;if(t.currentTarget.getAttribute("data-scroll-hide")){m=t.currentTarget.getAttribute("data-scroll-hide")==="true"}else if(this.props.scrollHide!=null){m=this.props.scrollHide}this.setState({placeholder:f,isEmptyTip:h,place:t.currentTarget.getAttribute("data-place")||this.props.place||"top",type:t.currentTarget.getAttribute("data-type")||this.props.type||"dark",effect:g&&"solid"||t.currentTarget.getAttribute("data-effect")||this.props.effect||"float",offset:t.currentTarget.getAttribute("data-offset")||this.props.offset||{},html:t.currentTarget.getAttribute("data-html")?t.currentTarget.getAttribute("data-html")==="true":this.props.html||false,delayShow:t.currentTarget.getAttribute("data-delay-show")||this.props.delayShow||0,delayHide:t.currentTarget.getAttribute("data-delay-hide")||this.props.delayHide||0,border:t.currentTarget.getAttribute("data-border")?t.currentTarget.getAttribute("data-border")==="true":this.props.border||false,extraClass:t.currentTarget.getAttribute("data-class")||this.props.class||"",disable:t.currentTarget.getAttribute("data-tip-disable")?t.currentTarget.getAttribute("data-tip-disable")==="true":this.props.disable||false},function(){if(m)r.addScrollListener(t);r.updateTooltip(t);if(u&&Array.isArray(u)){r.intervalUpdateContent=setInterval(function(){if(r.mount){var e=r.props.getContent;var t=(0,x.default)(c,e[0](),d);var i=typeof t==="string"&&t==="";r.setState({placeholder:t,isEmptyTip:i})}},u[1])}})}},{key:"updateTooltip",value:function e(t){var i=this;var r=this.state;var n=r.delayShow;var o=r.show;var a=r.isEmptyTip;var s=r.disable;var l=this.props.afterShow;var u=this.state.placeholder;var c=o?0:parseInt(n,10);var d=t.currentTarget;if(a||s)return;var p=function e(){if(Array.isArray(u)&&u.length>0||u){(function(){var e=!i.state.show;i.setState({currentEvent:t,currentTarget:d,show:true},function(){i.updatePosition();if(e&&l)l()})})()}};clearTimeout(this.delayShowLoop);if(n){this.delayShowLoop=setTimeout(p,c)}else{p()}}},{key:"hideTooltip",value:function e(t,i){var r=this;var n=this.state;var o=n.delayHide;var a=n.isEmptyTip;var s=n.disable;var l=this.props.afterHide;if(!this.mount)return;if(a||s)return;if(i){var u=this.getTargetArray(this.props.id);var c=u.some(function(e){return e===t.currentTarget});if(!c||!this.state.show)return}var d=function e(){var t=r.state.show;r.setState({show:false},function(){r.removeScrollListener();if(t&&l)l()})};this.clearTimer();if(o){this.delayHideLoop=setTimeout(d,parseInt(o,10))}else{d()}}},{key:"addScrollListener",value:function e(t){var i=this.isCapture(t.currentTarget);window.addEventListener("scroll",this.hideTooltip,i)}},{key:"removeScrollListener",value:function e(){window.removeEventListener("scroll",this.hideTooltip)}},{key:"updatePosition",value:function e(){var t=this;var i=this.state;var r=i.currentEvent;var n=i.currentTarget;var o=i.place;var a=i.effect;var s=i.offset;var l=d.default.findDOMNode(this);var u=(0,S.default)(r,n,l,o,a,s);if(u.isNewState){return this.setState(u.newState,function(){t.updatePosition()})}l.style.left=u.position.left+"px";l.style.top=u.position.top+"px"}},{key:"setStyleHeader",value:function e(){if(!document.getElementsByTagName("head")[0].querySelector('style[id="react-tooltip"]')){var t=document.createElement("style");t.id="react-tooltip";t.innerHTML=A.default;document.getElementsByTagName("head")[0].appendChild(t)}}},{key:"clearTimer",value:function e(){clearTimeout(this.delayShowLoop);clearTimeout(this.delayHideLoop);clearInterval(this.intervalUpdateContent)}},{key:"render",value:function e(){var t=this.state;var i=t.placeholder;var n=t.extraClass;var o=t.html;var a=t.ariaProps;var s=t.disable;var l=t.isEmptyTip;var c=(0,f.default)("__react_component_tooltip",{show:this.state.show&&!s&&!l},{border:this.state.border},{"place-top":this.state.place==="top"},{"place-bottom":this.state.place==="bottom"},{"place-left":this.state.place==="left"},{"place-right":this.state.place==="right"},{"type-dark":this.state.type==="dark"},{"type-success":this.state.type==="success"},{"type-warning":this.state.type==="warning"},{"type-error":this.state.type==="error"},{"type-info":this.state.type==="info"},{"type-light":this.state.type==="light"});if(o){return u.default.createElement("div",r({className:c+" "+n},a,{"data-id":"tooltip",dangerouslySetInnerHTML:{__html:i}}))}else{return u.default.createElement("div",r({className:c+" "+n},a,{"data-id":"tooltip"}),i)}}}]);return t}(l.Component),a.propTypes={children:l.PropTypes.any,place:l.PropTypes.string,type:l.PropTypes.string,effect:l.PropTypes.string,offset:l.PropTypes.object,multiline:l.PropTypes.bool,border:l.PropTypes.bool,insecure:l.PropTypes.bool,class:l.PropTypes.string,id:l.PropTypes.string,html:l.PropTypes.bool,delayHide:l.PropTypes.number,delayShow:l.PropTypes.number,event:l.PropTypes.string,eventOff:l.PropTypes.string,watchWindow:l.PropTypes.bool,isCapture:l.PropTypes.bool,globalEventOff:l.PropTypes.string,getContent:l.PropTypes.any,afterShow:l.PropTypes.func,afterHide:l.PropTypes.func,disable:l.PropTypes.bool,scrollHide:l.PropTypes.bool,resizeHide:l.PropTypes.bool},a.defaultProps={insecure:true,resizeHide:true},s))||o)||o)||o)||o;t.exports=R},{"./decorators/customEvent":170,"./decorators/isCapture":171,"./decorators/staticMethods":172,"./decorators/windowListener":173,"./style":175,"./utils/aria":176,"./utils/getPosition":177,"./utils/getTipContent":178,classnames:6,react:"react","react-dom":"react-dom"}],175:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default='.__react_component_tooltip{border-radius:3px;display:inline-block;font-size:13px;left:-999em;opacity:0;padding:8px 21px;position:fixed;pointer-events:none;transition:opacity 0.3s ease-out;top:-999em;visibility:hidden;z-index:999}.__react_component_tooltip:before,.__react_component_tooltip:after{content:"";width:0;height:0;position:absolute}.__react_component_tooltip.show{opacity:0.9;margin-top:0px;margin-left:0px;visibility:visible}.__react_component_tooltip.type-dark{color:#fff;background-color:#222}.__react_component_tooltip.type-dark.place-top:after{border-top-color:#222;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-dark.place-bottom:after{border-bottom-color:#222;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-dark.place-left:after{border-left-color:#222;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-dark.place-right:after{border-right-color:#222;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-dark.border{border:1px solid #fff}.__react_component_tooltip.type-dark.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-dark.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-dark.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-dark.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-success{color:#fff;background-color:#8DC572}.__react_component_tooltip.type-success.place-top:after{border-top-color:#8DC572;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-success.place-bottom:after{border-bottom-color:#8DC572;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-success.place-left:after{border-left-color:#8DC572;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-success.place-right:after{border-right-color:#8DC572;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-success.border{border:1px solid #fff}.__react_component_tooltip.type-success.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-success.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-success.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-success.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-warning{color:#fff;background-color:#F0AD4E}.__react_component_tooltip.type-warning.place-top:after{border-top-color:#F0AD4E;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-warning.place-bottom:after{border-bottom-color:#F0AD4E;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-warning.place-left:after{border-left-color:#F0AD4E;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-warning.place-right:after{border-right-color:#F0AD4E;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-warning.border{border:1px solid #fff}.__react_component_tooltip.type-warning.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-warning.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-warning.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-warning.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-error{color:#fff;background-color:#BE6464}.__react_component_tooltip.type-error.place-top:after{border-top-color:#BE6464;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-error.place-bottom:after{border-bottom-color:#BE6464;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-error.place-left:after{border-left-color:#BE6464;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-error.place-right:after{border-right-color:#BE6464;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-error.border{border:1px solid #fff}.__react_component_tooltip.type-error.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-error.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-error.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-error.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-info{color:#fff;background-color:#337AB7}.__react_component_tooltip.type-info.place-top:after{border-top-color:#337AB7;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-info.place-bottom:after{border-bottom-color:#337AB7;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-info.place-left:after{border-left-color:#337AB7;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-info.place-right:after{border-right-color:#337AB7;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-info.border{border:1px solid #fff}.__react_component_tooltip.type-info.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-info.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-info.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-info.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-light{color:#222;background-color:#fff}.__react_component_tooltip.type-light.place-top:after{border-top-color:#fff;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-light.place-bottom:after{border-bottom-color:#fff;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-light.place-left:after{border-left-color:#fff;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-light.place-right:after{border-right-color:#fff;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-light.border{border:1px solid #222}.__react_component_tooltip.type-light.border.place-top:before{border-top:8px solid #222}.__react_component_tooltip.type-light.border.place-bottom:before{border-bottom:8px solid #222}.__react_component_tooltip.type-light.border.place-left:before{border-left:8px solid #222}.__react_component_tooltip.type-light.border.place-right:before{border-right:8px solid #222}.__react_component_tooltip.place-top{margin-top:-10px}.__react_component_tooltip.place-top:before{border-left:10px solid transparent;border-right:10px solid transparent;bottom:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-top:after{border-left:8px solid transparent;border-right:8px solid transparent;bottom:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-bottom{margin-top:10px}.__react_component_tooltip.place-bottom:before{border-left:10px solid transparent;border-right:10px solid transparent;top:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-bottom:after{border-left:8px solid transparent;border-right:8px solid transparent;top:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-left{margin-left:-10px}.__react_component_tooltip.place-left:before{border-top:6px solid transparent;border-bottom:6px solid transparent;right:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-left:after{border-top:5px solid transparent;border-bottom:5px solid transparent;right:-6px;top:50%;margin-top:-4px}.__react_component_tooltip.place-right{margin-left:10px}.__react_component_tooltip.place-right:before{border-top:6px solid transparent;border-bottom:6px solid transparent;left:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-right:after{border-top:5px solid transparent;border-bottom:5px solid transparent;left:-6px;top:50%;margin-top:-4px}.__react_component_tooltip .multi-line{display:block;padding:2px 0px;text-align:center}';
},{}],176:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.parseAria=r;function r(e){var t={};Object.keys(e).filter(function(e){return/(^aria-\w+$|^role$)/.test(e)}).forEach(function(i){t[i]=e[i]});return t}},{}],177:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=function(e,t,i,s,l,u){var c=i.clientWidth;var d=i.clientHeight;var p=r(e,t,l);var f=p.mouseX;var h=p.mouseY;var g=n(l,t.clientWidth,t.clientHeight,c,d);var m=o(u);var v=m.extraOffset_X;var y=m.extraOffset_Y;var b=window.innerWidth;var w=window.innerHeight;var C=a(i);var E=C.parentTop;var S=C.parentLeft;var T=function e(t){var i=g[t].l;return f+i+v};var x=function e(t){var i=g[t].r;return f+i+v};var _=function e(t){var i=g[t].t;return h+i+y};var M=function e(t){var i=g[t].b;return h+i+y};var A=function e(){var t=false;var i=void 0;if(_("left")<0&&M("left")<=w&&M("bottom")<=w){t=true;i="bottom"}else if(M("left")>w&&_("left")>=0&&_("top")>=0){t=true;i="top"}return{result:t,newPlace:i}};var I=function e(){var t=A();var i=t.result;var r=t.newPlace;if(i&&D().result){return{result:false}}if(!i&&T("left")<0&&x("right")<=b){i=true;r="right"}return{result:i,newPlace:r}};var O=function e(){var t=A();var i=t.result;var r=t.newPlace;if(i&&D().result){return{result:false}}if(!i&&x("right")>b&&T("left")>=0){i=true;r="left"}return{result:i,newPlace:r}};var D=function e(){var t=false;var i=void 0;if(T("top")<0&&x("top")<=b&&x("right")<=b){t=true;i="right"}else if(x("top")>b&&T("top")>=0&&T("left")>=0){t=true;i="left"}return{result:t,newPlace:i}};var N=function e(){var t=D();var i=t.result;var r=t.newPlace;if(i&&A().result){return{result:false}}if(!i&&_("top")<0&&M("bottom")<=w){i=true;r="bottom"}return{result:i,newPlace:r}};var R=function e(){var t=D();var i=t.result;var r=t.newPlace;if(i&&A().result){return{result:false}}if(!i&&M("bottom")>w&&_("top")>=0){i=true;r="top"}return{result:i,newPlace:r}};var P=I();var L=O();var k=N();var $=R();if(s==="left"&&P.result){return{isNewState:true,newState:{place:P.newPlace}}}else if(s==="right"&&L.result){return{isNewState:true,newState:{place:L.newPlace}}}else if(s==="top"&&k.result){return{isNewState:true,newState:{place:k.newPlace}}}else if(s==="bottom"&&$.result){return{isNewState:true,newState:{place:$.newPlace}}}return{isNewState:false,position:{left:parseInt(T(s)-S,10),top:parseInt(_(s)-E,10)}}};var r=function e(t,i,r){var n=i.getBoundingClientRect();var o=n.top;var a=n.left;var s=i.clientWidth;var l=i.clientHeight;if(r==="float"){return{mouseX:t.clientX,mouseY:t.clientY}}return{mouseX:a+s/2,mouseY:o+l/2}};var n=function e(t,i,r,n,o){var a=void 0;var s=void 0;var l=void 0;var u=void 0;var c=3;var d=2;var p=12;if(t==="float"){a={l:-(n/2),r:n/2,t:-(o+c+d),b:-c};l={l:-(n/2),r:n/2,t:c+p,b:o+c+d+p};u={l:-(n+c+d),r:-c,t:-(o/2),b:o/2};s={l:c,r:n+c+d,t:-(o/2),b:o/2}}else if(t==="solid"){a={l:-(n/2),r:n/2,t:-(r/2+o+d),b:-(r/2)};l={l:-(n/2),r:n/2,t:r/2,b:r/2+o+d};u={l:-(n+i/2+d),r:-(i/2),t:-(o/2),b:o/2};s={l:i/2,r:n+i/2+d,t:-(o/2),b:o/2}}return{top:a,bottom:l,left:u,right:s}};var o=function e(t){var i=0;var r=0;if(Object.prototype.toString.apply(t)==="[object String]"){t=JSON.parse(t.toString().replace(/\'/g,'"'))}for(var n in t){if(n==="top"){r-=parseInt(t[n],10)}else if(n==="bottom"){r+=parseInt(t[n],10)}else if(n==="left"){i-=parseInt(t[n],10)}else if(n==="right"){i+=parseInt(t[n],10)}}return{extraOffset_X:i,extraOffset_Y:r}};var a=function e(t){var i=t;while(i){if(window.getComputedStyle(i).getPropertyValue("transform")!=="none")break;i=i.parentElement}var r=i&&i.getBoundingClientRect().top||0;var n=i&&i.getBoundingClientRect().left||0;return{parentTop:r,parentLeft:n}}},{}],178:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=function(e,t,i,r){if(t)return t;if(i!==undefined&&i!==null)return i;if(i===null)return null;var o=/<br\s*\/?>/;if(!r||r==="false"||!o.test(e)){return e}return e.split(o).map(function(e,t){return n.default.createElement("span",{key:t,className:"multi-line"},e)})};var r=e("react");var n=o(r);function o(e){return e&&e.__esModule?e:{default:e}}},{react:"react"}],179:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var o=e("react");var a=f(o);var s=e("react-select");var l=f(s);var u=e("react-virtualized/dist/commonjs/AutoSizer");var c=f(u);var d=e("react-virtualized/dist/commonjs/List");var p=f(d);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function g(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var v=function(e){m(t,e);function t(e,i){h(this,t);var r=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));r._renderMenu=r._renderMenu.bind(r);r._optionRenderer=r._optionRenderer.bind(r);return r}n(t,[{key:"recomputeOptionHeights",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(this._virtualScroll){this._virtualScroll.recomputeRowHeights(t)}}},{key:"render",value:function e(){var t=this._getSelectComponent();return a.default.createElement(t,r({},this.props,{menuRenderer:this._renderMenu,menuStyle:{overflow:"hidden"}}))}},{key:"_renderMenu",value:function e(t){var i=this;var n=t.focusedOption;var o=t.focusOption;var s=t.labelKey;var l=t.onSelect;var u=t.options;var d=t.selectValue;var f=t.valueArray;var h=this.props;var g=h.listProps;var m=h.optionRenderer;var v=u.indexOf(n);var y=this._calculateListHeight({options:u});var b=m||this._optionRenderer;function w(e){var t=e.index;var i=e.key;var r=e.style;var a=u[t];return b({focusedOption:n,focusedOptionIndex:v,focusOption:o,key:i,labelKey:s,onSelect:l,option:a,optionIndex:t,options:u,selectValue:l,style:r,valueArray:f})}return a.default.createElement(c.default,{disableHeight:true},function(e){var t=e.width;return a.default.createElement(p.default,r({className:"VirtualSelectGrid",height:y,ref:function e(t){return i._virtualScroll=t},rowCount:u.length,rowHeight:function e(t){var r=t.index;return i._getOptionHeight({option:u[r]})},rowRenderer:w,scrollToIndex:v,width:t},g))})}},{key:"_calculateListHeight",value:function e(t){var i=t.options;var r=this.props.maxHeight;var n=0;for(var o=0;o<i.length;o++){var a=i[o];n+=this._getOptionHeight({option:a});if(n>r){return r}}return n}},{key:"_getOptionHeight",value:function e(t){var i=t.option;var r=this.props.optionHeight;return r instanceof Function?r({option:i}):r}},{key:"_getSelectComponent",value:function e(){var t=this.props;var i=t.async;var r=t.selectComponent;if(r){return r}else if(i){return l.default.Async}else{return l.default}}},{key:"_optionRenderer",value:function e(t){var i=t.focusedOption;var n=t.focusOption;var o=t.key;var s=t.labelKey;var l=t.option;var u=t.selectValue;var c=t.style;var d=["VirtualizedSelectOption"];if(l===i){d.push("VirtualizedSelectFocusedOption")}if(l.disabled){d.push("VirtualizedSelectDisabledOption")}var p=l.disabled?{}:{onClick:function e(){return u(l)},onMouseOver:function e(){return n(l)}};return a.default.createElement("div",r({className:d.join(" "),key:o,style:c},p),l[s])}}]);return t}(o.Component);v.propTypes={async:o.PropTypes.bool,listProps:o.PropTypes.object,maxHeight:o.PropTypes.number.isRequired,optionHeight:o.PropTypes.oneOfType([o.PropTypes.number,o.PropTypes.func]).isRequired,optionRenderer:o.PropTypes.func,selectComponent:o.PropTypes.func};v.defaultProps={async:false,maxHeight:200,optionHeight:35};i.default=v},{react:"react","react-select":163,"react-virtualized/dist/commonjs/AutoSizer":183,"react-virtualized/dist/commonjs/List":193}],180:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=undefined;var r=e("./VirtualizedSelect");var n=o(r);function o(e){return e&&e.__esModule?e:{default:e}}i.default=n.default},{"./VirtualizedSelect":179}],181:[function(e,t,i){arguments[4][180][0].apply(i,arguments)},{"./VirtualizedSelect":180,dup:180}],182:[function(e,t,i){(function(t){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var n=e("react");var o=c(n);var a=e("react-addons-shallow-compare");var s=c(a);var l=e("../vendor/detectElementResize");var u=c(l);function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=function(e){f(t,e);function t(e){d(this,t);var i=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i.state={height:0,width:0};i._onResize=i._onResize.bind(i);i._setRef=i._setRef.bind(i);return i}r(t,[{key:"componentDidMount",value:function e(){this._parentNode=this._autoSizer.parentNode;this._detectElementResize=(0,u.default)();this._detectElementResize.addResizeListener(this._parentNode,this._onResize);this._onResize()}},{key:"componentWillUnmount",value:function e(){if(this._detectElementResize){this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}}},{key:"render",value:function e(){var t=this.props;var i=t.children;var r=t.disableHeight;var n=t.disableWidth;var a=this.state;var s=a.height;var l=a.width;var u={overflow:"visible"};if(!r){u.height=0}if(!n){u.width=0}return o.default.createElement("div",{ref:this._setRef,style:u},i({height:s,width:l}))}},{key:"shouldComponentUpdate",value:function e(t,i){return(0,s.default)(this,t,i)}},{key:"_onResize",value:function e(){var t=this.props.onResize;var i=this._parentNode.getBoundingClientRect();var r=i.height||0;var n=i.width||0;var o=window.getComputedStyle(this._parentNode)||{};var a=parseInt(o.paddingLeft,10)||0;var s=parseInt(o.paddingRight,10)||0;var l=parseInt(o.paddingTop,10)||0;var u=parseInt(o.paddingBottom,10)||0;this.setState({height:r-l-u,width:n-a-s});t({height:r,width:n})}},{key:"_setRef",value:function e(t){this._autoSizer=t}}]);return t}(n.Component);h.defaultProps={onResize:function e(){}};i.default=h;t.env.NODE_ENV!=="production"?h.propTypes={children:n.PropTypes.func.isRequired,disableHeight:n.PropTypes.bool,disableWidth:n.PropTypes.bool,onResize:n.PropTypes.func.isRequired}:void 0}).call(this,e("_process"))},{"../vendor/detectElementResize":195,_process:155,react:"react","react-addons-shallow-compare":156}],183:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.AutoSizer=i.default=undefined;var r=e("./AutoSizer");var n=o(r);function o(e){return e&&e.__esModule?e:{default:e}}i.default=n.default;i.AutoSizer=n.default},{"./AutoSizer":182}],184:[function(e,t,i){(function(t){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.DEFAULT_SCROLLING_RESET_TIME_INTERVAL=undefined;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var o=e("react");var a=x(o);var s=e("classnames");var l=x(s);var u=e("./utils/calculateSizeAndPositionDataAndUpdateScrollOffset");var c=x(u);var d=e("./utils/ScalingCellSizeAndPositionManager");var p=x(d);var f=e("../utils/createCallbackMemoizer");var h=x(f);var g=e("./utils/getOverscanIndices");var m=x(g);var v=e("dom-helpers/util/scrollbarSize");var y=x(v);var b=e("react-addons-shallow-compare");var w=x(b);var C=e("./utils/updateScrollIndexHelper");var E=x(C);var S=e("./defaultCellRangeRenderer");var T=x(S);function x(e){return e&&e.__esModule?e:{default:e}}function _(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function M(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function A(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var I=i.DEFAULT_SCROLLING_RESET_TIME_INTERVAL=150;var O={OBSERVED:"observed",REQUESTED:"requested"};var D=function(e){A(t,e);function t(e,i){_(this,t);var r=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));r.state={isScrolling:false,scrollDirectionHorizontal:g.SCROLL_DIRECTION_FORWARD,scrollDirectionVertical:g.SCROLL_DIRECTION_FORWARD,scrollLeft:0,scrollTop:0};r._onGridRenderedMemoizer=(0,h.default)();r._onScrollMemoizer=(0,h.default)(false);r._debounceScrollEndedCallback=r._debounceScrollEndedCallback.bind(r);r._invokeOnGridRenderedHelper=r._invokeOnGridRenderedHelper.bind(r);r._onScroll=r._onScroll.bind(r);r._updateScrollLeftForScrollToColumn=r._updateScrollLeftForScrollToColumn.bind(r);r._updateScrollTopForScrollToRow=r._updateScrollTopForScrollToRow.bind(r);r._columnWidthGetter=r._wrapSizeGetter(e.columnWidth);r._rowHeightGetter=r._wrapSizeGetter(e.rowHeight);r._columnSizeAndPositionManager=new p.default({cellCount:e.columnCount,cellSizeGetter:function e(t){return r._columnWidthGetter(t)},estimatedCellSize:r._getEstimatedColumnSize(e)});r._rowSizeAndPositionManager=new p.default({cellCount:e.rowCount,cellSizeGetter:function e(t){return r._rowHeightGetter(t)},estimatedCellSize:r._getEstimatedRowSize(e)});r._cellCache={};r._styleCache={};return r}n(t,[{key:"measureAllCells",value:function e(){var t=this.props;var i=t.columnCount;var r=t.rowCount;this._columnSizeAndPositionManager.getSizeAndPositionOfCell(i-1);this._rowSizeAndPositionManager.getSizeAndPositionOfCell(r-1)}},{key:"recomputeGridSize",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.columnIndex;var r=i===undefined?0:i;var n=t.rowIndex;var o=n===undefined?0:n;this._columnSizeAndPositionManager.resetCell(r);this._rowSizeAndPositionManager.resetCell(o);this._cellCache={};this._styleCache={};this.forceUpdate()}},{key:"componentDidMount",value:function e(){var t=this.props;var i=t.scrollLeft;var r=t.scrollToColumn;var n=t.scrollTop;var o=t.scrollToRow;if(!this._scrollbarSizeMeasured){this._scrollbarSize=(0,y.default)();this._scrollbarSizeMeasured=true;this.setState({})}if(i>=0||n>=0){this._setScrollPosition({scrollLeft:i,scrollTop:n})}if(r>=0||o>=0){this._updateScrollLeftForScrollToColumn();this._updateScrollTopForScrollToRow()}this._invokeOnGridRenderedHelper();this._invokeOnScrollMemoizer({scrollLeft:i||0,scrollTop:n||0,totalColumnsWidth:this._columnSizeAndPositionManager.getTotalSize(),totalRowsHeight:this._rowSizeAndPositionManager.getTotalSize()})}},{key:"componentDidUpdate",value:function e(t,i){var n=this;var o=this.props;var a=o.autoHeight;var s=o.columnCount;var l=o.height;var u=o.rowCount;var c=o.scrollToAlignment;var d=o.scrollToColumn;var p=o.scrollToRow;var f=o.width;var h=this.state;var g=h.scrollLeft;var m=h.scrollPositionChangeReason;var v=h.scrollTop;var y=s>0&&t.columnCount===0||u>0&&t.rowCount===0;if(m===O.REQUESTED){if(g>=0&&(g!==i.scrollLeft&&g!==this._scrollingContainer.scrollLeft||y)){this._scrollingContainer.scrollLeft=g}if(!a&&v>=0&&(v!==i.scrollTop&&v!==this._scrollingContainer.scrollTop||y)){this._scrollingContainer.scrollTop=v}}(0,E.default)({cellSizeAndPositionManager:this._columnSizeAndPositionManager,previousCellsCount:t.columnCount,previousCellSize:t.columnWidth,previousScrollToAlignment:t.scrollToAlignment,previousScrollToIndex:t.scrollToColumn,previousSize:t.width,scrollOffset:g,scrollToAlignment:c,scrollToIndex:d,size:f,updateScrollIndexCallback:function e(t){return n._updateScrollLeftForScrollToColumn(r({},n.props,{scrollToColumn:t}))}});(0,E.default)({cellSizeAndPositionManager:this._rowSizeAndPositionManager,previousCellsCount:t.rowCount,previousCellSize:t.rowHeight,previousScrollToAlignment:t.scrollToAlignment,previousScrollToIndex:t.scrollToRow,previousSize:t.height,scrollOffset:v,scrollToAlignment:c,scrollToIndex:p,size:l,updateScrollIndexCallback:function e(t){return n._updateScrollTopForScrollToRow(r({},n.props,{scrollToRow:t}))}});this._invokeOnGridRenderedHelper();if(g!==i.scrollLeft||v!==i.scrollTop){var b=this._rowSizeAndPositionManager.getTotalSize();var w=this._columnSizeAndPositionManager.getTotalSize();this._invokeOnScrollMemoizer({scrollLeft:g,scrollTop:v,totalColumnsWidth:w,totalRowsHeight:b})}}},{key:"componentWillMount",value:function e(){this._scrollbarSize=(0,y.default)();if(this._scrollbarSize===undefined){this._scrollbarSizeMeasured=false;this._scrollbarSize=0}else{this._scrollbarSizeMeasured=true}this._calculateChildrenToRender()}},{key:"componentWillUnmount",value:function e(){if(this._disablePointerEventsTimeoutId){clearTimeout(this._disablePointerEventsTimeoutId)}}},{key:"componentWillUpdate",value:function e(t,i){var r=this;if(t.columnCount===0&&i.scrollLeft!==0||t.rowCount===0&&i.scrollTop!==0){this._setScrollPosition({scrollLeft:0,scrollTop:0})}else if(t.scrollLeft!==this.props.scrollLeft||t.scrollTop!==this.props.scrollTop){this._setScrollPosition({scrollLeft:t.scrollLeft,scrollTop:t.scrollTop})}if(t.columnWidth!==this.props.columnWidth||t.rowHeight!==this.props.rowHeight){this._styleCache={}}this._columnWidthGetter=this._wrapSizeGetter(t.columnWidth);this._rowHeightGetter=this._wrapSizeGetter(t.rowHeight);this._columnSizeAndPositionManager.configure({cellCount:t.columnCount,estimatedCellSize:this._getEstimatedColumnSize(t)});this._rowSizeAndPositionManager.configure({cellCount:t.rowCount,estimatedCellSize:this._getEstimatedRowSize(t)});(0,c.default)({cellCount:this.props.columnCount,cellSize:this.props.columnWidth,computeMetadataCallback:function e(){return r._columnSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:t,nextCellsCount:t.columnCount,nextCellSize:t.columnWidth,nextScrollToIndex:t.scrollToColumn,scrollToIndex:this.props.scrollToColumn,updateScrollOffsetForScrollToIndex:function e(){return r._updateScrollLeftForScrollToColumn(t,i)}});(0,c.default)({cellCount:this.props.rowCount,cellSize:this.props.rowHeight,computeMetadataCallback:function e(){return r._rowSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:t,nextCellsCount:t.rowCount,nextCellSize:t.rowHeight,nextScrollToIndex:t.scrollToRow,scrollToIndex:this.props.scrollToRow,updateScrollOffsetForScrollToIndex:function e(){return r._updateScrollTopForScrollToRow(t,i)}});this._calculateChildrenToRender(t,i)}},{key:"render",value:function e(){var t=this;var i=this.props;var n=i.autoContainerWidth;var o=i.autoHeight;var s=i.className;var u=i.containerStyle;var c=i.height;var d=i.id;var p=i.noContentRenderer;var f=i.style;var h=i.tabIndex;var g=i.width;var m=this.state.isScrolling;var v={boxSizing:"border-box",direction:"ltr",height:o?"auto":c,position:"relative",width:g,WebkitOverflowScrolling:"touch",willChange:"transform"};var y=this._columnSizeAndPositionManager.getTotalSize();var b=this._rowSizeAndPositionManager.getTotalSize();var w=b>c?this._scrollbarSize:0;var C=y>g?this._scrollbarSize:0;v.overflowX=y+w<=g?"hidden":"auto";v.overflowY=b+C<=c?"hidden":"auto";var E=this._childrenToDisplay;var S=E.length===0&&c>0&&g>0;return a.default.createElement("div",{ref:function e(i){t._scrollingContainer=i},"aria-label":this.props["aria-label"],className:(0,l.default)("ReactVirtualized__Grid",s),id:d,onScroll:this._onScroll,role:"grid",style:r({},v,f),tabIndex:h},E.length>0&&a.default.createElement("div",{className:"ReactVirtualized__Grid__innerScrollContainer",style:r({width:n?"auto":y,height:b,maxWidth:y,maxHeight:b,overflow:"hidden",pointerEvents:m?"none":""},u)},E),S&&p())}},{key:"shouldComponentUpdate",value:function e(t,i){return(0,w.default)(this,t,i)}},{key:"_calculateChildrenToRender",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.state;var r=t.cellRenderer;var n=t.cellRangeRenderer;var o=t.columnCount;var a=t.height;var s=t.overscanColumnCount;var l=t.overscanRowCount;var u=t.rowCount;var c=t.width;var d=i.isScrolling;var p=i.scrollDirectionHorizontal;var f=i.scrollDirectionVertical;var h=i.scrollLeft;var g=i.scrollTop;this._childrenToDisplay=[];if(a>0&&c>0){var v=this._columnSizeAndPositionManager.getVisibleCellRange({containerSize:c,offset:h});var y=this._rowSizeAndPositionManager.getVisibleCellRange({containerSize:a,offset:g});var b=this._columnSizeAndPositionManager.getOffsetAdjustment({containerSize:c,offset:h});var w=this._rowSizeAndPositionManager.getOffsetAdjustment({containerSize:a,offset:g});this._renderedColumnStartIndex=v.start;this._renderedColumnStopIndex=v.stop;this._renderedRowStartIndex=y.start;this._renderedRowStopIndex=y.stop;var C=(0,m.default)({cellCount:o,overscanCellsCount:s,scrollDirection:p,startIndex:this._renderedColumnStartIndex,stopIndex:this._renderedColumnStopIndex});var E=(0,m.default)({cellCount:u,overscanCellsCount:l,scrollDirection:f,startIndex:this._renderedRowStartIndex,stopIndex:this._renderedRowStopIndex});this._columnStartIndex=C.overscanStartIndex;this._columnStopIndex=C.overscanStopIndex;this._rowStartIndex=E.overscanStartIndex;this._rowStopIndex=E.overscanStopIndex;this._childrenToDisplay=n({cellCache:this._cellCache,cellRenderer:r,columnSizeAndPositionManager:this._columnSizeAndPositionManager,columnStartIndex:this._columnStartIndex,columnStopIndex:this._columnStopIndex,horizontalOffsetAdjustment:b,isScrolling:d,rowSizeAndPositionManager:this._rowSizeAndPositionManager,rowStartIndex:this._rowStartIndex,rowStopIndex:this._rowStopIndex,scrollLeft:h,scrollTop:g,styleCache:this._styleCache,verticalOffsetAdjustment:w,visibleColumnIndices:v,visibleRowIndices:y})}}},{key:"_debounceScrollEnded",value:function e(){var t=this.props.scrollingResetTimeInterval;if(this._disablePointerEventsTimeoutId){clearTimeout(this._disablePointerEventsTimeoutId)}this._disablePointerEventsTimeoutId=setTimeout(this._debounceScrollEndedCallback,t)}},{key:"_debounceScrollEndedCallback",value:function e(){this._disablePointerEventsTimeoutId=null;var t=this._styleCache;this._cellCache={};this._styleCache={};for(var i=this._rowStartIndex;i<=this._rowStopIndex;i++){for(var r=this._columnStartIndex;r<=this._columnStopIndex;r++){var n=i+"-"+r;this._styleCache[n]=t[n]}}this.setState({isScrolling:false})}},{key:"_getEstimatedColumnSize",value:function e(t){return typeof t.columnWidth==="number"?t.columnWidth:t.estimatedColumnSize}},{key:"_getEstimatedRowSize",value:function e(t){return typeof t.rowHeight==="number"?t.rowHeight:t.estimatedRowSize}},{key:"_invokeOnGridRenderedHelper",value:function e(){var t=this.props.onSectionRendered;this._onGridRenderedMemoizer({callback:t,indices:{columnOverscanStartIndex:this._columnStartIndex,columnOverscanStopIndex:this._columnStopIndex,columnStartIndex:this._renderedColumnStartIndex,columnStopIndex:this._renderedColumnStopIndex,rowOverscanStartIndex:this._rowStartIndex,rowOverscanStopIndex:this._rowStopIndex,rowStartIndex:this._renderedRowStartIndex,rowStopIndex:this._renderedRowStopIndex}})}},{key:"_invokeOnScrollMemoizer",value:function e(t){var i=this;var r=t.scrollLeft;var n=t.scrollTop;var o=t.totalColumnsWidth;var a=t.totalRowsHeight;this._onScrollMemoizer({callback:function e(t){var r=t.scrollLeft;var n=t.scrollTop;var s=i.props;var l=s.height;var u=s.onScroll;var c=s.width;u({clientHeight:l,clientWidth:c,scrollHeight:a,scrollLeft:r,scrollTop:n,scrollWidth:o})},indices:{scrollLeft:r,scrollTop:n}})}},{key:"_setScrollPosition",value:function e(t){var i=t.scrollLeft;var r=t.scrollTop;var n={scrollPositionChangeReason:O.REQUESTED};if(i>=0){n.scrollDirectionHorizontal=i>this.state.scrollLeft?g.SCROLL_DIRECTION_FORWARD:g.SCROLL_DIRECTION_BACKWARD;n.scrollLeft=i}if(r>=0){n.scrollDirectionVertical=r>this.state.scrollTop?g.SCROLL_DIRECTION_FORWARD:g.SCROLL_DIRECTION_BACKWARD;n.scrollTop=r}if(i>=0&&i!==this.state.scrollLeft||r>=0&&r!==this.state.scrollTop){this.setState(n)}}},{key:"_wrapPropertyGetter",value:function e(t){return t instanceof Function?t:function(){return t}}},{key:"_wrapSizeGetter",value:function e(t){return this._wrapPropertyGetter(t)}},{key:"_updateScrollLeftForScrollToColumn",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.state;var r=t.columnCount;var n=t.scrollToAlignment;var o=t.scrollToColumn;var a=t.width;var s=i.scrollLeft;if(o>=0&&r>0){var l=Math.max(0,Math.min(r-1,o));var u=this._columnSizeAndPositionManager.getUpdatedOffsetForIndex({align:n,containerSize:a,currentOffset:s,targetIndex:l});if(s!==u){this._setScrollPosition({scrollLeft:u})}}}},{key:"_updateScrollTopForScrollToRow",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.state;var r=t.height;var n=t.rowCount;var o=t.scrollToAlignment;var a=t.scrollToRow;var s=i.scrollTop;if(a>=0&&n>0){var l=Math.max(0,Math.min(n-1,a));var u=this._rowSizeAndPositionManager.getUpdatedOffsetForIndex({align:o,containerSize:r,currentOffset:s,targetIndex:l});if(s!==u){this._setScrollPosition({scrollTop:u})}}}},{key:"_onScroll",value:function e(t){if(t.target!==this._scrollingContainer){return}this._debounceScrollEnded();var i=this.props;var r=i.height;var n=i.width;var o=this._scrollbarSize;var a=this._rowSizeAndPositionManager.getTotalSize();var s=this._columnSizeAndPositionManager.getTotalSize();var l=Math.min(Math.max(0,s-n+o),t.target.scrollLeft);var u=Math.min(Math.max(0,a-r+o),t.target.scrollTop);if(this.state.scrollLeft!==l||this.state.scrollTop!==u){var c=l>this.state.scrollLeft?g.SCROLL_DIRECTION_FORWARD:g.SCROLL_DIRECTION_BACKWARD;var d=u>this.state.scrollTop?g.SCROLL_DIRECTION_FORWARD:g.SCROLL_DIRECTION_BACKWARD;this.setState({isScrolling:true,scrollDirectionHorizontal:c,scrollDirectionVertical:d,scrollLeft:l,scrollPositionChangeReason:O.OBSERVED,scrollTop:u})}this._invokeOnScrollMemoizer({scrollLeft:l,scrollTop:u,totalColumnsWidth:s,totalRowsHeight:a})}}]);return t}(o.Component);D.defaultProps={"aria-label":"grid",cellRangeRenderer:T.default,estimatedColumnSize:100,estimatedRowSize:30,noContentRenderer:function e(){return null},onScroll:function e(){return null},onSectionRendered:function e(){return null},overscanColumnCount:0,overscanRowCount:10,scrollingResetTimeInterval:I,scrollToAlignment:"auto",style:{},tabIndex:0};i.default=D;t.env.NODE_ENV!=="production"?D.propTypes={"aria-label":o.PropTypes.string,autoContainerWidth:o.PropTypes.bool,autoHeight:o.PropTypes.bool,cellRenderer:o.PropTypes.func.isRequired,cellRangeRenderer:o.PropTypes.func.isRequired,className:o.PropTypes.string,columnCount:o.PropTypes.number.isRequired,columnWidth:o.PropTypes.oneOfType([o.PropTypes.number,o.PropTypes.func]).isRequired,containerStyle:o.PropTypes.object,estimatedColumnSize:o.PropTypes.number.isRequired,estimatedRowSize:o.PropTypes.number.isRequired,height:o.PropTypes.number.isRequired,id:o.PropTypes.string,noContentRenderer:o.PropTypes.func.isRequired,onScroll:o.PropTypes.func.isRequired,onSectionRendered:o.PropTypes.func.isRequired,overscanColumnCount:o.PropTypes.number.isRequired,overscanRowCount:o.PropTypes.number.isRequired,rowHeight:o.PropTypes.oneOfType([o.PropTypes.number,o.PropTypes.func]).isRequired,rowCount:o.PropTypes.number.isRequired,scrollingResetTimeInterval:o.PropTypes.number,scrollLeft:o.PropTypes.number,scrollToAlignment:o.PropTypes.oneOf(["auto","end","start","center"]).isRequired,scrollToColumn:o.PropTypes.number,scrollTop:o.PropTypes.number,scrollToRow:o.PropTypes.number,style:o.PropTypes.object,tabIndex:o.PropTypes.number,width:o.PropTypes.number.isRequired}:void 0}).call(this,e("_process"))},{"../utils/createCallbackMemoizer":194,"./defaultCellRangeRenderer":185,"./utils/ScalingCellSizeAndPositionManager":188,"./utils/calculateSizeAndPositionDataAndUpdateScrollOffset":189,"./utils/getOverscanIndices":190,"./utils/updateScrollIndexHelper":191,_process:155,classnames:6,"dom-helpers/util/scrollbarSize":19,react:"react","react-addons-shallow-compare":156}],185:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=r;function r(e){var t=e.cellCache;var i=e.cellRenderer;var r=e.columnSizeAndPositionManager;var n=e.columnStartIndex;var o=e.columnStopIndex;var a=e.horizontalOffsetAdjustment;var s=e.isScrolling;var l=e.rowSizeAndPositionManager;var u=e.rowStartIndex;var c=e.rowStopIndex;var d=e.scrollLeft;var p=e.scrollTop;var f=e.styleCache;var h=e.verticalOffsetAdjustment;var g=e.visibleColumnIndices;var m=e.visibleRowIndices;var v=[];for(var y=u;y<=c;y++){var b=l.getSizeAndPositionOfCell(y);for(var w=n;w<=o;w++){var C=r.getSizeAndPositionOfCell(w);var E=w>=g.start&&w<=g.stop&&y>=m.start&&y<=m.stop;var S=y+"-"+w;var T=void 0;if(f[S]){T=f[S]}else{T={height:b.size,left:C.offset+a,position:"absolute",top:b.offset+h,width:C.size};f[S]=T}var x={columnIndex:w,isScrolling:s,isVisible:E,key:S,rowIndex:y,style:T};var _=void 0;if(s&&!a&&!h){if(!t[S]){t[S]=i(x)}_=t[S]}else{_=i(x)}if(_==null||_===false){continue}v.push(_)}}return v}},{}],186:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.defaultCellRangeRenderer=i.Grid=i.default=undefined;var r=e("./Grid");var n=s(r);var o=e("./defaultCellRangeRenderer");var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}i.default=n.default;i.Grid=n.default;i.defaultCellRangeRenderer=a.default},{"./Grid":184,"./defaultCellRangeRenderer":185}],187:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function e(t){var i=t.cellCount;var r=t.cellSizeGetter;var o=t.estimatedCellSize;n(this,e);this._cellSizeGetter=r;this._cellCount=i;this._estimatedCellSize=o;this._cellSizeAndPositionData={};this._lastMeasuredIndex=-1}r(e,[{key:"configure",value:function e(t){var i=t.cellCount;var r=t.estimatedCellSize;this._cellCount=i;this._estimatedCellSize=r;
}},{key:"getCellCount",value:function e(){return this._cellCount}},{key:"getEstimatedCellSize",value:function e(){return this._estimatedCellSize}},{key:"getLastMeasuredIndex",value:function e(){return this._lastMeasuredIndex}},{key:"getSizeAndPositionOfCell",value:function e(t){if(t<0||t>=this._cellCount){throw Error("Requested index "+t+" is outside of range 0.."+this._cellCount)}if(t>this._lastMeasuredIndex){var i=this.getSizeAndPositionOfLastMeasuredCell();var r=i.offset+i.size;for(var n=this._lastMeasuredIndex+1;n<=t;n++){var o=this._cellSizeGetter({index:n});if(o==null||isNaN(o)){throw Error("Invalid size returned for cell "+n+" of value "+o)}this._cellSizeAndPositionData[n]={offset:r,size:o};r+=o}this._lastMeasuredIndex=t}return this._cellSizeAndPositionData[t]}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function e(){return this._lastMeasuredIndex>=0?this._cellSizeAndPositionData[this._lastMeasuredIndex]:{offset:0,size:0}}},{key:"getTotalSize",value:function e(){var t=this.getSizeAndPositionOfLastMeasuredCell();return t.offset+t.size+(this._cellCount-this._lastMeasuredIndex-1)*this._estimatedCellSize}},{key:"getUpdatedOffsetForIndex",value:function e(t){var i=t.align;var r=i===undefined?"auto":i;var n=t.containerSize;var o=t.currentOffset;var a=t.targetIndex;if(n<=0){return 0}var s=this.getSizeAndPositionOfCell(a);var l=s.offset;var u=l-n+s.size;var c=void 0;switch(r){case"start":c=l;break;case"end":c=u;break;case"center":c=l-(n-s.size)/2;break;default:c=Math.max(u,Math.min(l,o));break}var d=this.getTotalSize();return Math.max(0,Math.min(d-n,c))}},{key:"getVisibleCellRange",value:function e(t){var i=t.containerSize;var r=t.offset;var n=this.getTotalSize();if(n===0){return{}}var o=r+i;var a=this._findNearestCell(r);var s=this.getSizeAndPositionOfCell(a);r=s.offset+s.size;var l=a;while(r<o&&l<this._cellCount-1){l++;r+=this.getSizeAndPositionOfCell(l).size}return{start:a,stop:l}}},{key:"resetCell",value:function e(t){this._lastMeasuredIndex=Math.min(this._lastMeasuredIndex,t-1)}},{key:"_binarySearch",value:function e(t){var i=t.high;var r=t.low;var n=t.offset;var o=void 0;var a=void 0;while(r<=i){o=r+Math.floor((i-r)/2);a=this.getSizeAndPositionOfCell(o).offset;if(a===n){return o}else if(a<n){r=o+1}else if(a>n){i=o-1}}if(r>0){return r-1}}},{key:"_exponentialSearch",value:function e(t){var i=t.index;var r=t.offset;var n=1;while(i<this._cellCount&&this.getSizeAndPositionOfCell(i).offset<r){i+=n;n*=2}return this._binarySearch({high:Math.min(i,this._cellCount-1),low:Math.floor(i/2),offset:r})}},{key:"_findNearestCell",value:function e(t){if(isNaN(t)){throw Error("Invalid offset "+t+" specified")}t=Math.max(0,t);var i=this.getSizeAndPositionOfLastMeasuredCell();var r=Math.max(0,this._lastMeasuredIndex);if(i.offset>=t){return this._binarySearch({high:r,low:0,offset:t})}else{return this._exponentialSearch({index:r,offset:t})}}}]);return e}();i.default=o},{}],188:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.DEFAULT_MAX_SCROLL_SIZE=undefined;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var n=e("./CellSizeAndPositionManager");var o=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var i={};for(var r in e){if(t.indexOf(r)>=0)continue;if(!Object.prototype.hasOwnProperty.call(e,r))continue;i[r]=e[r]}return i}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var u=i.DEFAULT_MAX_SCROLL_SIZE=15e5;var c=function(){function e(t){var i=t.maxScrollSize;var r=i===undefined?u:i;var n=s(t,["maxScrollSize"]);l(this,e);this._cellSizeAndPositionManager=new o.default(n);this._maxScrollSize=r}r(e,[{key:"configure",value:function e(t){this._cellSizeAndPositionManager.configure(t)}},{key:"getCellCount",value:function e(){return this._cellSizeAndPositionManager.getCellCount()}},{key:"getEstimatedCellSize",value:function e(){return this._cellSizeAndPositionManager.getEstimatedCellSize()}},{key:"getLastMeasuredIndex",value:function e(){return this._cellSizeAndPositionManager.getLastMeasuredIndex()}},{key:"getOffsetAdjustment",value:function e(t){var i=t.containerSize;var r=t.offset;var n=this._cellSizeAndPositionManager.getTotalSize();var o=this.getTotalSize();var a=this._getOffsetPercentage({containerSize:i,offset:r,totalSize:o});return Math.round(a*(o-n))}},{key:"getSizeAndPositionOfCell",value:function e(t){return this._cellSizeAndPositionManager.getSizeAndPositionOfCell(t)}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function e(){return this._cellSizeAndPositionManager.getSizeAndPositionOfLastMeasuredCell()}},{key:"getTotalSize",value:function e(){return Math.min(this._maxScrollSize,this._cellSizeAndPositionManager.getTotalSize())}},{key:"getUpdatedOffsetForIndex",value:function e(t){var i=t.align;var r=i===undefined?"auto":i;var n=t.containerSize;var o=t.currentOffset;var a=t.targetIndex;var s=t.totalSize;o=this._safeOffsetToOffset({containerSize:n,offset:o});var l=this._cellSizeAndPositionManager.getUpdatedOffsetForIndex({align:r,containerSize:n,currentOffset:o,targetIndex:a,totalSize:s});return this._offsetToSafeOffset({containerSize:n,offset:l})}},{key:"getVisibleCellRange",value:function e(t){var i=t.containerSize;var r=t.offset;r=this._safeOffsetToOffset({containerSize:i,offset:r});return this._cellSizeAndPositionManager.getVisibleCellRange({containerSize:i,offset:r})}},{key:"resetCell",value:function e(t){this._cellSizeAndPositionManager.resetCell(t)}},{key:"_getOffsetPercentage",value:function e(t){var i=t.containerSize;var r=t.offset;var n=t.totalSize;return n<=i?0:r/(n-i)}},{key:"_offsetToSafeOffset",value:function e(t){var i=t.containerSize;var r=t.offset;var n=this._cellSizeAndPositionManager.getTotalSize();var o=this.getTotalSize();if(n===o){return r}else{var a=this._getOffsetPercentage({containerSize:i,offset:r,totalSize:n});return Math.round(a*(o-i))}}},{key:"_safeOffsetToOffset",value:function e(t){var i=t.containerSize;var r=t.offset;var n=this._cellSizeAndPositionManager.getTotalSize();var o=this.getTotalSize();if(n===o){return r}else{var a=this._getOffsetPercentage({containerSize:i,offset:r,totalSize:o});return Math.round(a*(n-i))}}}]);return e}();i.default=c},{"./CellSizeAndPositionManager":187}],189:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=r;function r(e){var t=e.cellCount;var i=e.cellSize;var r=e.computeMetadataCallback;var n=e.computeMetadataCallbackProps;var o=e.nextCellsCount;var a=e.nextCellSize;var s=e.nextScrollToIndex;var l=e.scrollToIndex;var u=e.updateScrollOffsetForScrollToIndex;if(t!==o||(typeof i==="number"||typeof a==="number")&&i!==a){r(n);if(l>=0&&l===s){u()}}}},{}],190:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=o;var r=i.SCROLL_DIRECTION_BACKWARD=-1;var n=i.SCROLL_DIRECTION_FORWARD=1;function o(e){var t=e.cellCount;var i=e.overscanCellsCount;var o=e.scrollDirection;var a=e.startIndex;var s=e.stopIndex;var l=void 0;var u=void 0;switch(o){case n:l=a;u=s+i;break;case r:l=a-i;u=s;break}return{overscanStartIndex:Math.max(0,l),overscanStopIndex:Math.min(t-1,u)}}},{}],191:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=r;function r(e){var t=e.cellSize;var i=e.cellSizeAndPositionManager;var r=e.previousCellsCount;var n=e.previousCellSize;var o=e.previousScrollToAlignment;var a=e.previousScrollToIndex;var s=e.previousSize;var l=e.scrollOffset;var u=e.scrollToAlignment;var c=e.scrollToIndex;var d=e.size;var p=e.updateScrollIndexCallback;var f=i.getCellCount();var h=c>=0&&c<f;var g=d!==s||!n||typeof t==="number"&&t!==n;if(h&&(g||u!==o||c!==a)){p(c)}else if(!h&&f>0&&(d<s||f<r)){if(l>i.getTotalSize()-d){p(f-1)}}}},{}],192:[function(e,t,i){(function(t){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var o=e("../Grid");var a=f(o);var s=e("react");var l=f(s);var u=e("classnames");var c=f(u);var d=e("react-addons-shallow-compare");var p=f(d);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){var i={};for(var r in e){if(t.indexOf(r)>=0)continue;if(!Object.prototype.hasOwnProperty.call(e,r))continue;i[r]=e[r]}return i}function g(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function m(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var y=function(e){v(t,e);function t(e,i){g(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));r._cellRenderer=r._cellRenderer.bind(r);r._onScroll=r._onScroll.bind(r);r._onSectionRendered=r._onSectionRendered.bind(r);return r}n(t,[{key:"forceUpdateGrid",value:function e(){this.Grid.forceUpdate()}},{key:"measureAllRows",value:function e(){this.Grid.measureAllCells()}},{key:"recomputeRowHeights",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;this.Grid.recomputeGridSize({rowIndex:t});this.forceUpdateGrid()}},{key:"render",value:function e(){var t=this;var i=this.props;var n=i.className;var o=i.noRowsRenderer;var s=i.scrollToIndex;var u=i.width;var d=(0,c.default)("ReactVirtualized__List",n);return l.default.createElement(a.default,r({},this.props,{autoContainerWidth:true,cellRenderer:this._cellRenderer,className:d,columnWidth:u,columnCount:1,noContentRenderer:o,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:function e(i){t.Grid=i},scrollToRow:s}))}},{key:"shouldComponentUpdate",value:function e(t,i){return(0,p.default)(this,t,i)}},{key:"_cellRenderer",value:function e(t){var i=t.rowIndex;var n=t.style;var o=h(t,["rowIndex","style"]);var a=this.props.rowRenderer;n.width="100%";return a(r({index:i,style:n},o))}},{key:"_onScroll",value:function e(t){var i=t.clientHeight;var r=t.scrollHeight;var n=t.scrollTop;var o=this.props.onScroll;o({clientHeight:i,scrollHeight:r,scrollTop:n})}},{key:"_onSectionRendered",value:function e(t){var i=t.rowOverscanStartIndex;var r=t.rowOverscanStopIndex;var n=t.rowStartIndex;var o=t.rowStopIndex;var a=this.props.onRowsRendered;a({overscanStartIndex:i,overscanStopIndex:r,startIndex:n,stopIndex:o})}}]);return t}(s.Component);y.defaultProps={estimatedRowSize:30,noRowsRenderer:function e(){return null},onRowsRendered:function e(){return null},onScroll:function e(){return null},overscanRowCount:10,scrollToAlignment:"auto",style:{}};i.default=y;t.env.NODE_ENV!=="production"?y.propTypes={"aria-label":s.PropTypes.string,autoHeight:s.PropTypes.bool,className:s.PropTypes.string,estimatedRowSize:s.PropTypes.number.isRequired,height:s.PropTypes.number.isRequired,noRowsRenderer:s.PropTypes.func.isRequired,onRowsRendered:s.PropTypes.func.isRequired,overscanRowCount:s.PropTypes.number.isRequired,onScroll:s.PropTypes.func.isRequired,rowHeight:s.PropTypes.oneOfType([s.PropTypes.number,s.PropTypes.func]).isRequired,rowRenderer:s.PropTypes.func.isRequired,rowCount:s.PropTypes.number.isRequired,scrollToAlignment:s.PropTypes.oneOf(["auto","end","start","center"]).isRequired,scrollToIndex:s.PropTypes.number,scrollTop:s.PropTypes.number,style:s.PropTypes.object,tabIndex:s.PropTypes.number,width:s.PropTypes.number.isRequired}:void 0}).call(this,e("_process"))},{"../Grid":186,_process:155,classnames:6,react:"react","react-addons-shallow-compare":156}],193:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.List=i.default=undefined;var r=e("./List");var n=o(r);function o(e){return e&&e.__esModule?e:{default:e}}i.default=n.default;i.List=n.default},{"./List":192}],194:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=r;function r(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var t={};return function(i){var r=i.callback;var n=i.indices;var o=Object.keys(n);var a=!e||o.every(function(e){var t=n[e];return Array.isArray(t)?t.length>0:t>=0});var s=o.length!==Object.keys(t).length||o.some(function(e){var i=t[e];var r=n[e];return Array.isArray(r)?i.join(",")!==r.join(","):i!==r});t=n;if(a&&s){r(n)}}}},{}],195:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.default=r;function r(){var e;if(typeof window!=="undefined"){e=window}else if(typeof self!=="undefined"){e=self}else{e=this}var t=typeof document!=="undefined"&&document.attachEvent;if(!t){var i=function(){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||function(t){return e.setTimeout(t,20)};return function(e){return t(e)}}();var r=function(){var t=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.clearTimeout;return function(e){return t(e)}}();var n=function e(t){var i=t.__resizeTriggers__,r=i.firstElementChild,n=i.lastElementChild,o=r.firstElementChild;n.scrollLeft=n.scrollWidth;n.scrollTop=n.scrollHeight;o.style.width=r.offsetWidth+1+"px";o.style.height=r.offsetHeight+1+"px";r.scrollLeft=r.scrollWidth;r.scrollTop=r.scrollHeight};var o=function e(t){return t.offsetWidth!=t.__resizeLast__.width||t.offsetHeight!=t.__resizeLast__.height};var a=function e(t){if(t.target.className.indexOf("contract-trigger")<0&&t.target.className.indexOf("expand-trigger")<0){return}var a=this;n(this);if(this.__resizeRAF__)r(this.__resizeRAF__);this.__resizeRAF__=i(function(){if(o(a)){a.__resizeLast__.width=a.offsetWidth;a.__resizeLast__.height=a.offsetHeight;a.__resizeListeners__.forEach(function(e){e.call(a,t)})}})};var s=false,l="animation",u="",c="animationstart",d="Webkit Moz O ms".split(" "),p="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),f="";{var h=document.createElement("fakeelement");if(h.style.animationName!==undefined){s=true}if(s===false){for(var g=0;g<d.length;g++){if(h.style[d[g]+"AnimationName"]!==undefined){f=d[g];l=f+"Animation";u="-"+f.toLowerCase()+"-";c=p[g];s=true;break}}}}var m="resizeanim";var v="@"+u+"keyframes "+m+" { from { opacity: 0; } to { opacity: 0; } } ";var y=u+"animation: 1ms "+m+"; "}var b=function e(){if(!document.getElementById("detectElementResize")){var t=(v?v:"")+".resize-triggers { "+(y?y:"")+"visibility: hidden; opacity: 0; } "+'.resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.id="detectElementResize";r.type="text/css";if(r.styleSheet){r.styleSheet.cssText=t}else{r.appendChild(document.createTextNode(t))}i.appendChild(r)}};var w=function i(r,o){if(t)r.attachEvent("onresize",o);else{if(!r.__resizeTriggers__){var s=e.getComputedStyle(r);if(s&&s.position=="static"){r.style.position="relative"}b();r.__resizeLast__={};r.__resizeListeners__=[];(r.__resizeTriggers__=document.createElement("div")).className="resize-triggers";r.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div>'+'<div class="contract-trigger"></div>';r.appendChild(r.__resizeTriggers__);n(r);r.addEventListener("scroll",a,true);if(c){r.__resizeTriggers__.__animationListener__=function e(t){if(t.animationName==m)n(r)};r.__resizeTriggers__.addEventListener(c,r.__resizeTriggers__.__animationListener__)}}r.__resizeListeners__.push(o)}};var C=function e(i,r){if(t)i.detachEvent("onresize",r);else{i.__resizeListeners__.splice(i.__resizeListeners__.indexOf(r),1);if(!i.__resizeListeners__.length){i.removeEventListener("scroll",a,true);if(i.__resizeTriggers__.__animationListener__){i.__resizeTriggers__.removeEventListener(c,i.__resizeTriggers__.__animationListener__);i.__resizeTriggers__.__animationListener__=null}i.__resizeTriggers__=!i.removeChild(i.__resizeTriggers__)}}};return{addResizeListener:w,removeResizeListener:C}}},{}],196:[function(e,t,i){"use strict";var r=e("fbjs/lib/shallowEqual");function n(e,t,i){return!r(e.props,t)||!r(e.state,i)}t.exports=n},{"fbjs/lib/shallowEqual":39}],197:[function(e,t,i){var r={"Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"AE","Ã":"C","Ã":"E","Ã":"E","Ã":"E","Ã":"E","Ã":"I","Ã":"I","Ã":"I","Ã":"I","Ã":"D","Ã":"N","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Å":"O","Ã":"O","Ã":"U","Ã":"U","Ã":"U","Ã":"U","Å°":"U","Ã":"Y","Ã":"TH","Ã":"ss","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã¦":"ae","Ã§":"c","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã°":"d","Ã±":"n","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Å":"o","Ã¸":"o","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Å±":"u","Ã½":"y","Ã¾":"th","Ã¿":"y","áº":"SS","Î±":"a","Î²":"b","Î³":"g","Î´":"d","Îµ":"e","Î¶":"z","Î·":"h","Î¸":"8","Î¹":"i","Îº":"k","Î»":"l","Î¼":"m","Î½":"n","Î¾":"3","Î¿":"o","Ï":"p","Ï":"r","Ï":"s","Ï":"t","Ï":"y","Ï":"f","Ï":"x","Ï":"ps","Ï":"w","Î¬":"a","Î­":"e","Î¯":"i","Ï":"o","Ï":"y","Î®":"h","Ï":"w","Ï":"s","Ï":"i","Î°":"y","Ï":"y","Î":"i","Î":"A","Î":"B","Î":"G","Î":"D","Î":"E","Î":"Z","Î":"H","Î":"8","Î":"I","Î":"K","Î":"L","Î":"M","Î":"N","Î":"3","Î":"O","Î ":"P","Î¡":"R","Î£":"S","Î¤":"T","Î¥":"Y","Î¦":"F","Î§":"X","Î¨":"PS","Î©":"W","Î":"A","Î":"E","Î":"I","Î":"O","Î":"Y","Î":"H","Î":"W","Îª":"I","Î«":"Y","Å":"s","Å":"S","Ä±":"i","Ä°":"I","Ã§":"c","Ã":"C","Ã¼":"u","Ã":"U","Ã¶":"o","Ã":"O","Ä":"g","Ä":"G","Ð°":"a","Ð±":"b","Ð²":"v","Ð³":"g","Ð´":"d","Ðµ":"e","Ñ":"yo","Ð¶":"zh","Ð·":"z","Ð¸":"i","Ð¹":"j","Ðº":"k","Ð»":"l","Ð¼":"m","Ð½":"n","Ð¾":"o","Ð¿":"p","Ñ":"r","Ñ":"s","Ñ":"t","Ñ":"u","Ñ":"f","Ñ":"h","Ñ":"c","Ñ":"ch","Ñ":"sh","Ñ":"sh","Ñ":"u","Ñ":"y","Ñ":"","Ñ":"e","Ñ":"yu","Ñ":"ya","Ð":"A","Ð":"B","Ð":"V","Ð":"G","Ð":"D","Ð":"E","Ð":"Yo","Ð":"Zh","Ð":"Z","Ð":"I","Ð":"J","Ð":"K","Ð":"L","Ð":"M","Ð":"N","Ð":"O","Ð":"P","Ð ":"R","Ð¡":"S","Ð¢":"T","Ð£":"U","Ð¤":"F","Ð¥":"H","Ð¦":"C","Ð§":"Ch","Ð¨":"Sh","Ð©":"Sh","Ðª":"U","Ð«":"Y","Ð¬":"","Ð­":"E","Ð®":"Yu","Ð¯":"Ya","Ð":"Ye","Ð":"I","Ð":"Yi","Ò":"G","Ñ":"ye","Ñ":"i","Ñ":"yi","Ò":"g","Ä":"c","Ä":"d","Ä":"e","Å":"n","Å":"r","Å¡":"s","Å¥":"t","Å¯":"u","Å¾":"z","Ä":"C","Ä":"D","Ä":"E","Å":"N","Å":"R","Å ":"S","Å¤":"T","Å®":"U","Å½":"Z","Ä":"a","Ä":"c","Ä":"e","Å":"l","Å":"n","Ã³":"o","Å":"s","Åº":"z","Å¼":"z","Ä":"A","Ä":"C","Ä":"e","Å":"L","Å":"N","Å":"S","Å¹":"Z","Å»":"Z","Ä":"a","Ä":"c","Ä":"e","Ä£":"g","Ä«":"i","Ä·":"k","Ä¼":"l","Å":"n","Å¡":"s","Å«":"u","Å¾":"z","Ä":"A","Ä":"C","Ä":"E","Ä¢":"G","Äª":"i","Ä¶":"k","Ä»":"L","Å":"N","Å ":"S","Åª":"u","Å½":"Z","â¬":"euro","â¢":"cruzeiro","â£":"french franc","Â£":"pound","â¤":"lira","â¥":"mill","â¦":"naira","â§":"peseta","â¨":"rupee","â©":"won","âª":"new shequel","â«":"dong","â­":"kip","â®":"tugrik","â¯":"drachma","â°":"penny","â±":"peso","â²":"guarani","â³":"austral","â´":"hryvnia","âµ":"cedi","Â¢":"cent","Â¥":"yen","å":"yuan","å":"yen","ï·¼":"rial","â ":"ecu","Â¤":"currency","à¸¿":"baht",$:"dollar","Â©":"(c)","Å":"oe","Å":"OE","â":"sum","Â®":"(r)","â ":"+","â":'"',"â":'"',"â":"'","â":"'","â":"d","Æ":"f","â¢":"tm","â ":"sm","â¦":"...","Ë":"o","Âº":"o","Âª":"a","â¢":"*","â":"delta","â":"infinity","â¥":"love","&":"and","|":"or","<":"less",">":"greater"};i=t.exports=function(e,t){return e.split("").reduce(function(e,t){if(r[t]){t=r[t]}t=t.replace(/[^\w\s$\*_\+~\.\(\)'"!\-:@]/g,"");e+=t;return e},"").replace(/^\s+|\s+$/g,"").replace(/[-\s]+/g,t||"-").replace("#{replacement}$","")}},{}],198:[function(e,t,i){var r;if(typeof window!=="undefined"){r=window}else if(typeof self!=="undefined"){r=self}else{console.warn("Using browser-only version of superagent in non-browser environment");r=this}var n=e("emitter");var o=e("./request-base");var a=e("./is-object");function s(){}var l=t.exports=e("./request").bind(null,y);l.getXHR=function(){if(r.XMLHttpRequest&&(!r.location||"file:"!=r.location.protocol||!r.ActiveXObject)){return new XMLHttpRequest}else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}throw Error("Browser-only verison of superagent could not find XHR")};var u="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};function c(e){if(!a(e))return e;var t=[];for(var i in e){d(t,i,e[i])}return t.join("&")}function d(e,t,i){if(i!=null){if(Array.isArray(i)){i.forEach(function(i){d(e,t,i)})}else if(a(i)){for(var r in i){d(e,t+"["+r+"]",i[r])}}else{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}}else if(i===null){e.push(encodeURIComponent(t))}}l.serializeObject=c;function p(e){var t={};var i=e.split("&");var r;var n;for(var o=0,a=i.length;o<a;++o){r=i[o];n=r.indexOf("=");if(n==-1){t[decodeURIComponent(r)]=""}else{t[decodeURIComponent(r.slice(0,n))]=decodeURIComponent(r.slice(n+1))}}return t}l.parseString=p;l.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};l.serialize={"application/x-www-form-urlencoded":c,"application/json":JSON.stringify};l.parse={"application/x-www-form-urlencoded":p,"application/json":JSON.parse};function f(e){var t=e.split(/\r?\n/);var i={};var r;var n;var o;var a;t.pop();for(var s=0,l=t.length;s<l;++s){n=t[s];r=n.indexOf(":");o=n.slice(0,r).toLowerCase();a=u(n.slice(r+1));i[o]=a}return i}function h(e){return/[\/+]json\b/.test(e)}function g(e){return e.split(/ *; */).shift()}function m(e){return e.split(/ *; */).reduce(function(e,t){var i=t.split(/ *= */),r=i.shift(),n=i.shift();if(r&&n)e[r]=n;return e},{})}function v(e,t){t=t||{};this.req=e;this.xhr=this.req.xhr;this.text=this.req.method!="HEAD"&&(this.xhr.responseType===""||this.xhr.responseType==="text")||typeof this.xhr.responseType==="undefined"?this.xhr.responseText:null;this.statusText=this.req.xhr.statusText;this._setStatusProperties(this.xhr.status);this.header=this.headers=f(this.xhr.getAllResponseHeaders());this.header["content-type"]=this.xhr.getResponseHeader("content-type");this._setHeaderProperties(this.header);this.body=this.req.method!="HEAD"?this._parseBody(this.text?this.text:this.xhr.response):null}v.prototype.get=function(e){return this.header[e.toLowerCase()]};v.prototype._setHeaderProperties=function(e){var t=this.header["content-type"]||"";this.type=g(t);var i=m(t);for(var r in i)this[r]=i[r]};v.prototype._parseBody=function(e){var t=l.parse[this.type];if(!t&&h(this.type)){t=l.parse["application/json"]}return t&&e&&(e.length||e instanceof Object)?t(e):null};v.prototype._setStatusProperties=function(e){if(e===1223){e=204}var t=e/100|0;this.status=this.statusCode=e;this.statusType=t;this.info=1==t;this.ok=2==t;this.clientError=4==t;this.serverError=5==t;this.error=4==t||5==t?this.toError():false;this.accepted=202==e;this.noContent=204==e;this.badRequest=400==e;this.unauthorized=401==e;this.notAcceptable=406==e;this.notFound=404==e;this.forbidden=403==e};v.prototype.toError=function(){var e=this.req;var t=e.method;var i=e.url;var r="cannot "+t+" "+i+" ("+this.status+")";var n=new Error(r);n.status=this.status;n.method=t;n.url=i;return n};l.Response=v;function y(e,t){var i=this;this._query=this._query||[];this.method=e;this.url=t;this.header={};this._header={};this.on("end",function(){var e=null;var t=null;try{t=new v(i)}catch(t){e=new Error("Parser is unable to parse the response");e.parse=true;e.original=t;e.rawResponse=i.xhr&&i.xhr.responseText?i.xhr.responseText:null;e.statusCode=i.xhr&&i.xhr.status?i.xhr.status:null;return i.callback(e)}i.emit("response",t);var r;try{if(t.status<200||t.status>=300){r=new Error(t.statusText||"Unsuccessful HTTP response");r.original=e;r.response=t;r.status=t.status}}catch(e){r=e}if(r){i.callback(r,t)}else{i.callback(null,t)}})}n(y.prototype);for(var b in o){y.prototype[b]=o[b]}y.prototype.type=function(e){this.set("Content-Type",l.types[e]||e);return this};y.prototype.responseType=function(e){this._responseType=e;return this};y.prototype.accept=function(e){this.set("Accept",l.types[e]||e);return this};y.prototype.auth=function(e,t,i){if(!i){i={type:"basic"}}switch(i.type){case"basic":var r=btoa(e+":"+t);this.set("Authorization","Basic "+r);break;case"auto":this.username=e;this.password=t;break}return this};y.prototype.query=function(e){if("string"!=typeof e)e=c(e);if(e)this._query.push(e);return this};y.prototype.attach=function(e,t,i){this._getFormData().append(e,t,i||t.name);return this};y.prototype._getFormData=function(){if(!this._formData){this._formData=new r.FormData}return this._formData};y.prototype.callback=function(e,t){var i=this._callback;this.clearTimeout();i(e,t)};y.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=true;e.status=this.status;e.method=this.method;e.url=this.url;this.callback(e)};y.prototype._timeoutError=function(){var e=this._timeout;var t=new Error("timeout of "+e+"ms exceeded");t.timeout=e;this.callback(t)};y.prototype._appendQueryString=function(){var e=this._query.join("&");if(e){this.url+=~this.url.indexOf("?")?"&"+e:"?"+e}};y.prototype.end=function(e){var t=this;var i=this.xhr=l.getXHR();var r=this._timeout;var n=this._formData||this._data;this._callback=e||s;i.onreadystatechange=function(){if(4!=i.readyState)return;var e;try{e=i.status}catch(t){e=0}if(0==e){if(t.timedout)return t._timeoutError();if(t._aborted)return;return t.crossDomainError()}t.emit("end")};var o=function(e,i){if(i.total>0){i.percent=i.loaded/i.total*100}i.direction=e;t.emit("progress",i)};if(this.hasListeners("progress")){try{i.onprogress=o.bind(null,"download");if(i.upload){i.upload.onprogress=o.bind(null,"upload")}}catch(e){}}if(r&&!this._timer){this._timer=setTimeout(function(){t.timedout=true;t.abort()},r)}this._appendQueryString();if(this.username&&this.password){i.open(this.method,this.url,true,this.username,this.password)}else{i.open(this.method,this.url,true)}if(this._withCredentials)i.withCredentials=true;if("GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof n&&!this._isHost(n)){var a=this._header["content-type"];var u=this._serializer||l.serialize[a?a.split(";")[0]:""];if(!u&&h(a))u=l.serialize["application/json"];if(u)n=u(n)}for(var c in this.header){if(null==this.header[c])continue;i.setRequestHeader(c,this.header[c])}if(this._responseType){i.responseType=this._responseType}this.emit("request",this);i.send(typeof n!=="undefined"?n:null);return this};l.Request=y;l.get=function(e,t,i){var r=l("GET",e);if("function"==typeof t)i=t,t=null;if(t)r.query(t);if(i)r.end(i);return r};l.head=function(e,t,i){var r=l("HEAD",e);if("function"==typeof t)i=t,t=null;if(t)r.send(t);if(i)r.end(i);return r};l.options=function(e,t,i){var r=l("OPTIONS",e);if("function"==typeof t)i=t,t=null;if(t)r.send(t);if(i)r.end(i);return r};function w(e,t){var i=l("DELETE",e);if(t)i.end(t);return i}l["del"]=w;l["delete"]=w;l.patch=function(e,t,i){var r=l("PATCH",e);if("function"==typeof t)i=t,t=null;if(t)r.send(t);if(i)r.end(i);return r};l.post=function(e,t,i){var r=l("POST",e);if("function"==typeof t)i=t,t=null;if(t)r.send(t);if(i)r.end(i);return r};l.put=function(e,t,i){var r=l("PUT",e);if("function"==typeof t)i=t,t=null;if(t)r.send(t);if(i)r.end(i);return r}},{"./is-object":199,"./request":201,"./request-base":200,emitter:7}],199:[function(e,t,i){function r(e){return null!==e&&"object"===typeof e}t.exports=r},{}],200:[function(e,t,i){var r=e("./is-object");i.clearTimeout=function e(){this._timeout=0;clearTimeout(this._timer);return this};i.parse=function e(t){this._parser=t;return this};i.serialize=function e(t){this._serializer=t;return this};i.timeout=function e(t){this._timeout=t;return this};i.then=function e(t,i){if(!this._fullfilledPromise){var r=this;this._fullfilledPromise=new Promise(function(e,t){r.end(function(i,r){if(i)t(i);else e(r)})})}return this._fullfilledPromise.then(t,i)};i.catch=function(e){return this.then(undefined,e)};i.use=function e(t){t(this);return this};i.get=function(e){return this._header[e.toLowerCase()]};i.getHeader=i.get;i.set=function(e,t){if(r(e)){for(var i in e){this.set(i,e[i])}return this}this._header[e.toLowerCase()]=t;this.header[e]=t;return this};i.unset=function(e){delete this._header[e.toLowerCase()];delete this.header[e];return this};i.field=function(e,t){if(null===e||undefined===e){throw new Error(".field(name, val) name can not be empty")}if(r(e)){for(var i in e){this.field(i,e[i])}return this}if(null===t||undefined===t){throw new Error(".field(name, val) val can not be empty")}this._getFormData().append(e,t);return this};i.abort=function(){if(this._aborted){return this}this._aborted=true;this.xhr&&this.xhr.abort();this.req&&this.req.abort();this.clearTimeout();this.emit("abort");return this};i.withCredentials=function(){this._withCredentials=true;return this};i.redirects=function(e){this._maxRedirects=e;return this};i.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}};i._isHost=function e(t){var i={}.toString.call(t);switch(i){case"[object File]":case"[object Blob]":case"[object FormData]":return true;default:return false}};i.send=function(e){var t=r(e);var i=this._header["content-type"];if(t&&r(this._data)){for(var n in e){this._data[n]=e[n]}}else if("string"==typeof e){if(!i)this.type("form");i=this._header["content-type"];if("application/x-www-form-urlencoded"==i){this._data=this._data?this._data+"&"+e:e}else{this._data=(this._data||"")+e}}else{this._data=e}if(!t||this._isHost(e))return this;if(!i)this.type("json");return this}},{"./is-object":199}],201:[function(e,t,i){function r(e,t,i){if("function"==typeof i){return new e("GET",t).end(i)}if(2==arguments.length){return new e("GET",t)}return new e(t,i)}t.exports=r},{}],202:[function(e,t,i){"use strict";t.exports={view:{FilterInput:e("./src/view/filterinput"),TreeBrowser:e("./src/view/treebrowser"),TreeBrowserNode:e("./src/view/treenode"),TreeBrowserNodes:e("./src/view/treenodes"),TreeBrowserView:e("./src/view/treebrowserview")},TreeBrowserState:e("./src/treebrowserstate"),Constants:e("./src/constants")}},{"./src/constants":203,"./src/treebrowserstate":204,"./src/view/filterinput":205,"./src/view/treebrowser":207,"./src/view/treebrowserview":208,"./src/view/treenode":209,"./src/view/treenodes":211}],203:[function(e,t,i){"use strict";var r=Object.freeze({BACKSPACE:"BACKSPACE",CANCEL:"CANCEL",MOVE_OUT_UP:"MOVE_OUT_UP",MOVE_LEFT:"MOVE_LEFT",MOVE_RIGHT:"MOVE_RIGHT",SELECT:"SELECT",SELECT_RANGE:"SELECT_RANGE",SEARCH:"SEARCH",NODE_KEY_UP:"NODE_KEY_UP"});var n=Object.freeze({BACKSPACE:8,TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40});var o=Object.freeze({SIMPLE:"SIMPLE",SINGLE:"SINGLE",MULTI:"MULTI",BY_ID:"BY_ID"});t.exports.Actions=r;t.exports.KeyCodes=n;t.exports.SelectionModes=o},{}],204:[function(e,t,i){"use strict";var r=e("lodash");function n(e){this.$toggleStateNormal=null;this.$toggleStateFiltered=null;this.$tree=null;this.tree=null;this.filterBy="";this.initialize(e)}n.prototype.getToggleState=function(){return this.filterBy?this.$toggleStateFiltered:this.$toggleStateNormal;
};n.prototype.setToggleState=function(e){if(this.filterBy){this.$toggleStateFiltered=e}else{this.$toggleStateNormal=e}};n.prototype.isEmpty=function(){return this.$tree.children.length===0};n.prototype.initialize=function(e,t,i){var r={$depth:-1,children:[]},o;this.$tree=n.buildTree(e||r);if(t){this.tree=n.filter(this.$tree.children,t,i);if(this.filterBy!==t){this.filterBy=t;this.setToggleState(null)}else{n.applyToggleState(this.tree,this.getToggleState())}}else{this.tree=this.$tree;this.filterBy="";o=this.getToggleState();if(o){n.applyToggleState(this.tree,o)}else{this.setToggleState(n.gatherToggleState(this.tree))}}};n.prototype.getSelectedNodes=function(){var e=[];n.goRecursivelyThroughChildren(this.$tree.children,function(t){var i=t.nodeObj;if(i.isSelected){e.push(i)}});return e};n.prototype.getNodeByIndex=function(e){var t,i=0;n.goRecursivelyThroughChildren(this.$tree.children,function(r){if(i===e){t=r;return false}i++});return t};n.prototype.getIndexByNode=function(e){var t,i=0;n.goRecursivelyThroughChildren(this.$tree.children,function(r){if(r.nodeObj.id===e){t=i;return false}i++});return t};n.prototype.getLength=function(){return this.$tree.length};n.prototype.getFilteredTreeLength=function(){return this.tree?this.tree.length:0};n.prototype.toggleNode=function(e){var t=this.getToggleState();e.nodeObj.isOpen=!e.nodeObj.isOpen;if(t){t[e.nodeObj.id]=e.nodeObj.isOpen}else{this.setToggleState(n.gatherToggleState(this.tree))}};n.prototype.selectNode=function(e,t){if(t&&e.nodeObj.isSelected){e.nodeObj.isSelected=false}else{n.unselectAllNodes(this.$tree.children);e.nodeObj.isSelected=true}};n.prototype.toggleNodeSelection=function(e){e.nodeObj.isSelected=!e.nodeObj.isSelected};n.prototype.selectNodesById=function(e,t,i){var o=r.isUndefined(t);if(i){n.unselectAllNodes(this.$tree.children)}if(!r.isArray(e)){e=[e]}n.goRecursivelyThroughChildren(this.$tree.children,function(i){var r=i.nodeObj;if(e.indexOf(r.id)>=0){r.isSelected=o?!r.isSelected:t}})};n.prototype.filterTree=function(e,t){if(!e){this.filterBy="";if(this.tree!==this.$tree){this.tree=this.$tree;n.applyToggleState(this.tree,this.getToggleState())}}else if(this.filterBy!==e){this.filterBy=e;this.setToggleState(null);this.tree=n.filter(this.$tree.children,e,t)}};n.gatherToggleState=function(e){var t={};n.goRecursivelyThroughChildren(e.children,function(e){t[e.nodeObj.id]=e.nodeObj.isOpen});return t};n.applyToggleState=function(e,t){if(t){n.goRecursivelyThroughChildren(e.children,function(e){var i=e.nodeObj.id;e.nodeObj.isOpen=t.hasOwnProperty(i)?t[i]:false})}};n.buildTree=function(e){var t=0,i,n="TreeNode";function o(e,i){var a=e.length,s=0,l,u,c,d,p;i=i||[];for(;s<a;s++){l=e[s];p=l.children;u={};for(c in l){if(l.hasOwnProperty(c)&&c!=="children"&&c!=="parent"){u[c]=l[c]}}u.$id=r.uniqueId(n);d={nodeObj:u};i.push(d);t++;if(p){d.children=[];o(p,d.children)}}return i}i=o(e.children);return{$depth:-1,length:t,children:i}};n.filter=function(e,t,i){var r=0;function o(e,t,i,a){var s=[],l,u=e.length;if(i){t=t.toLowerCase()}a=a||0;for(l=0;l<u;l++){var c=e[l],d=c.nodeObj.label||"",p=c.children,f,h,g;if(i){d=d.toLowerCase()}h=d.indexOf(t);if(h===-1){if(p){f=o(p,t,i);if(f.length){g={children:f,nodeObj:c.nodeObj};n.copyNodeProperties(c,g);g.nodeObj.isOpen=true;s.push(g);r++}}continue}g={nodeObj:c.nodeObj};g.nodeObj.isOpen=true;if(p){f=o(p,t,i);if(f.length===0){continue}g.children=f}n.copyNodeProperties(c,g);if(h===0){s.splice(a,0,g);r++;a++}else{s.push(g);r++}}return s}return{$depth:-1,children:o(e,t,i),length:r}};n.copyNodeProperties=function(e,t){var i;for(i in e){if(e.hasOwnProperty(i)&&i!=="children"&&i!=="nodeObj"){t[i]=e[i]}}};n.unselectAllNodes=function(e){n.goRecursivelyThroughChildren(e,function(e){e.nodeObj.isSelected=false})};n.selectChildren=function(e,t){n.goRecursivelyThroughChildren(e.children,function(e){e.nodeObj.isSelected=t})};n.goRecursivelyThroughChildren=function(e,t,i){var n=false;i=i||r.noop;var o=function(e,t){if(e){i(e);for(var r=0;r<e.length;r++){if(n){break}if(t(e[r])===false){n=true;break}else{o(e[r].children,t)}}}};return o(e,t)};t.exports=n},{lodash:70}],205:[function(t,i,r){"use strict";var n=t("react");var o=t("react-dom");var a=n.PropTypes;var s=n.createClass({displayName:"FilterInput",propTypes:{change:a.func.isRequired,keyword:a.string.isRequired,placeholder:a.string,clearButtonText:a.string,onFocus:a.func},getDefaultProps:function(){return{placeholder:"Search...",clearButtonText:"Clear"}},onInputChange:function(e){this.props.change(e,o.findDOMNode(this.refs.filterInput).value)},onResetClick:function(e){o.findDOMNode(this.refs.filterInput).value="";this.onInputChange(e)},onFocus:function(){this.props.onFocus&&this.props.onFocus(e)},render:function(){var e=null;if(this.props.keyword.length){e=n.DOM.a({className:"lb-filter-reset",href:"javascript:",onClick:this.onResetClick},this.props.clearButtonText)}return n.DOM.div({className:"lb-filter-input-container"},n.DOM.input({className:"lb-filter-input",type:"text",ref:"filterInput",value:this.props.keyword,placeholder:this.props.placeholder,onChange:this.onInputChange,onFocus:this.onFocus}),e)}});i.exports=s},{react:"react","react-dom":"react-dom"}],206:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("classnames");var a=r.createClass({displayName:"TreeBrowserToggle",propTypes:{onClickHandler:n.func.isRequired,isOpen:n.bool},getDefaultProps:function(){return{isOpen:false}},render:function(){var e=o({"toggle-icon":true,open:this.props.isOpen});return r.DOM.span({className:e,onClick:this.props.onClickHandler},r.DOM.span({className:"icon"}))}});t.exports=a},{classnames:6,react:"react"}],207:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.PropTypes;var a=e("../constants").SelectionModes;var s=e("../treebrowserstate");var l=e("./treebrowserview");var u={paddingLeft:10,addCheckbox:false};var c=n.createClass({displayName:"TreeBrowser",propTypes:{tree:o.object.isRequired,selectionMode:o.oneOf(Object.keys(a)),allowDeselect:o.bool,allowPressAndMoveSelection:o.bool,filterable:o.bool,filterKeyword:o.string,caseInsensitiveFiltering:o.bool,collapsible:o.bool,allowCollapsibleNodeSelect:o.bool,nodeElement:o.any,groupElement:o.func,onSelect:o.func,infiniteScrolling:n.PropTypes.bool,focus:o.shape({index:o.number,disable:o.bool}),onAction:o.func,nodeConfig:o.shape({paddingLeft:o.number,addCheckbox:o.bool,checkboxElement:o.any}),validators:o.shape({selectNode:o.func,toggleNode:o.func,filterTree:o.func})},getDefaultProps:function(){return{treeId:r.uniqueId(this.constructor.displayName),filterable:false,caseInsensitiveFiltering:true,collapsible:true,allowCollapsibleNodeSelect:false,allowPressAndMoveSelection:false,allowDeselect:false,validators:{}}},getInitialState:function(){var e=this.props,t=new s(e.tree);if(e.filterKeyword){t.filterTree(e.filterKeyword,e.caseInsensitiveFiltering)}return{treeBrowser:t}},componentWillReceiveProps:function(e){if(e.tree!==this.props.tree){this.state.treeBrowser.initialize(e.tree,e.filterKeyword,e.caseInsensitiveFiltering)}else if(this.props.filterKeyword!==e.filterKeyword){this.state.treeBrowser.filterTree(e.filterKeyword,e.caseInsensitiveFiltering)}this.$updateComponent()},render:function(){return n.createElement(l,this.$getViewProps())},$getViewProps:function(){var e=r.merge({},u,this.props.nodeConfig||{}),t={tree:this.state.treeBrowser.tree,filterBy:this.state.treeBrowser.filterBy,nodeElement:this.props.nodeElement,groupElement:this.props.groupElement,selectNode:this.$getSelectionHandler(),nodeConfig:e,infiniteScrolling:this.props.infiniteScrolling,focus:this.props.focus,onAction:this.props.onAction,allowCollapsibleNodeSelect:this.props.allowCollapsibleNodeSelect,allowPressAndMoveSelection:this.props.allowPressAndMoveSelection};this.props.collapsible&&(t.toggleNode=this.$toggleNode);this.props.filterable&&(t.filterTree=this.$filterTree);return t},$updateComponent:function(){this.forceUpdate()},$getSelectionHandler:function(){switch(this.props.selectionMode){case a.SINGLE:return this.$selectSingle;case a.SIMPLE:return this.$selectSimple;case a.MULTI:return this.$selectMulti;case a.BY_ID:return this.$selectById;default:return r.noop}},$filterTree:function(e){if(this.$validate("filterTree",e)){this.state.treeBrowser.filterTree(e,this.props.caseInsensitiveFiltering);this.$updateComponent()}},$toggleNode:function(e){if(this.$validate("toggleNode",e)){this.state.treeBrowser.toggleNode(e);this.$updateComponent()}},$selectSingle:function(e){if(this.$validate("selectNode",e)){this.props.onSelect&&this.props.onSelect(e.nodeObj);this.state.treeBrowser.selectNode(e,this.props.allowDeselect);this.$updateComponent()}},$selectSimple:function(e){if(this.$validate("selectNode",e)){this.props.onSelect&&this.props.onSelect(e.nodeObj);this.state.treeBrowser.toggleNodeSelection(e);this.$updateComponent()}},$selectMulti:function(){console.warn("TreeBrowser: 'MULTI' selection mode is not available yet.")},$selectById:function(e){if(this.$validate("selectNode",e)){this.state.treeBrowser.selectNodesById(e.nodeObj.id);this.props.onSelect&&this.props.onSelect(e.nodeObj);this.$updateComponent()}},$validate:function(e,t){var i=true,e=this.props.validators[e];if(e)i=e(t);return i},getSelection:function(){return this.state.treeBrowser.getSelectedNodes()},getTreeState:function(){return this.state.treeBrowser}});t.exports=c},{"../constants":203,"../treebrowserstate":204,"./treebrowserview":208,lodash:70,react:"react"}],208:[function(e,t,i){"use strict";var r=e("classnames");var n=e("lodash");var o=e("react");var a=o.PropTypes;var s=e("./treenodes");var l=e("./filterinput");var u=o.createClass({displayName:"TreeBrowserView",propTypes:{tree:a.object.isRequired,filterBy:a.string.isRequired,allowCollapsibleNodeSelect:a.bool,allowPressAndMoveSelection:a.bool,nodeElement:a.any,groupElement:a.func,nodeConfig:a.shape({paddingLeft:a.number.isRequired,addCheckbox:a.bool.isRequired,checkboxElement:a.any}).isRequired,toggleNode:a.func,selectNode:a.func,filterTree:a.func,infiniteScrolling:o.PropTypes.bool,focus:a.shape({index:a.number,disable:a.bool}),onAction:a.func},getDefaultProps:function(){return{enableNodeCheckboxes:false,allowCollapsibleNodeSelect:false,filterBy:""}},render:function(){var e=this.props,t=null,i=null,n=r({"lb-tree-browser":true,multiselect:e.nodeConfig.addCheckbox,"collapsible-nodes-unselectable":!e.allowCollapsibleNodeSelect});if(e.filterTree){t=o.createElement(l,{change:this.filterTree,keyword:e.filterBy})}if(e.tree.children.length){i=o.createElement(s,{tree:e.tree,allowCollapsibleNodeSelect:e.allowCollapsibleNodeSelect,allowPressAndMoveSelection:e.allowPressAndMoveSelection,nodeConfig:e.nodeConfig,onToggleClickHandler:this.toggleNode,onNodeClickHandler:this.selectNode,infiniteScrolling:this.props.infiniteScrolling,focus:this.props.focus,onAction:this.props.onAction,nodeElement:this.props.nodeElement,groupElement:this.props.groupElement})}else{i=o.DOM.div({className:"lb-tree-node lb-no-results-msg"},"No results...")}return o.DOM.div({className:n},t,i)},selectNode:function(e,t){if(!this.props.allowCollapsibleNodeSelect&&t.hasOwnProperty("children")){this.toggleNode(e,t)}else{this.props.selectNode&&this.props.selectNode(t)}},toggleNode:function(e,t){e.stopPropagation();this.props.toggleNode&&this.props.toggleNode(t)},filterTree:function(e,t){this.props.filterTree&&this.props.filterTree(t)}});t.exports=u},{"./filterinput":205,"./treenodes":211,classnames:6,lodash:70,react:"react"}],209:[function(e,t,i){"use strict";var r=e("react");var n=e("classnames");var o=r.PropTypes;var a=e("lodash");var s=e("./toggle");var l=r.createClass({displayName:"TreeNode",propTypes:{onClickHandler:o.func.isRequired,onToggleClickHandler:o.func.isRequired,treeNode:o.object.isRequired,depth:o.number.isRequired,hasCheckbox:o.bool.isRequired,extraClasses:o.string,paddingLeft:o.number.isRequired,checkboxElement:o.any},render:function(){var e=this.props.treeNode.nodeObj,t=l.getLabel(e),i=e.isSelected,o=this.props.treeNode.hasOwnProperty("children"),u=e.isDisabled,c=n({"lb-tree-node":true,selected:i,collapsible:o,disabled:u}),d={paddingLeft:this.props.depth*this.props.paddingLeft+"px"},p;if(this.props.extraClasses){c+=" "+this.props.extraClasses}var f=o?r.createElement(s,{onClickHandler:this.onToggleClick,isOpen:e.isOpen}):null;var h=r.DOM.span({className:"content",title:t},t);var g={checked:i,readOnly:true,disabled:u};if(this.props.hasCheckbox){var m=this.props.checkboxElement?r.createElement(this.props.checkboxElement,g):r.DOM.input(a.extend({type:"checkbox",className:"lb-checkbox"}));h=r.DOM.span(null,m,h)}p={className:c,disabled:u};if(this.props.allowPressAndMoveSelection){if(!o){p.onMouseDown=this.onMouseEnter;p.onMouseEnter=this.onMouseEnter}else{p.onClick=this.onNodeClick}}else{p.onClick=this.onNodeClick}return r.DOM.div(p,r.DOM.span({className:"lb-node-content",style:d},f,h,this.props.children))},onToggleClick:function(e){this.props.onToggleClickHandler(e,this.props.treeNode)},onMouseEnter:function(e){if(e.hasOwnProperty("buttons")&&e.buttons===1){this.onNodeClick(e,true)}},onNodeClick:function(e,t){if(!this.props.treeNode.nodeObj.isDisabled){this.props.onClickHandler(e,this.props.treeNode,t)}},statics:{getLabel:function(e){return e.label||e.title||e.id}}});t.exports=l},{"./toggle":206,classnames:6,lodash:70,react:"react"}],210:[function(e,t,i){"use strict";var r=e("classnames");var n=e("lodash");var o=e("react");var a=o.PropTypes;var s=e("./treenode");var l=o.createClass({displayName:"TreeNodeContainer",propTypes:{focused:a.bool,focusIndex:a.number.isRequired,nodeElement:a.any,nodeData:a.object.isRequired},onKeyUp:function(e){this.props.nodeData.onNodeKeyUp(e,this.props.focusIndex,this.props.nodeData.treeNode)},onClick:function(e){this.props.nodeData.onClickHandler(e,this.props.focusIndex,this.props.nodeData.treeNode)},render:function(){var e={className:r({"lb-node-container":true,focused:this.props.focused})},t=n.assign({},this.props.nodeData,{onNodeKeyUp:this.onKeyUp,onClickHandler:this.onClick}),i;if(!n.isUndefined(this.props.focusIndex)){e.tabIndex=this.props.focusIndex;e.onKeyUp=this.onKeyUp}if(!this.props.nodeElement||this.props.nodeElement instanceof o.constructor){i=o.createElement(this.props.nodeElement||s,t)}else{i=this.props.nodeElement(t)}return o.DOM.div(e,i)}});t.exports=l},{"./treenode":209,classnames:6,lodash:70,react:"react"}],211:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-dom");var a=e("react-addons-pure-render-mixin");var s=n.PropTypes;var l=e("classnames");var u=e("../constants");var c=u.Actions;var d=u.KeyCodes;var p=e("./treenodecontainer");var f=2;var h=n.createClass({displayName:"TreeNodes",mixins:[a],propTypes:{tree:s.object.isRequired,allowCollapsibleNodeSelect:s.bool.isRequired,allowPressAndMoveSelection:s.bool,nodeConfig:s.shape({paddingLeft:s.number.isRequired,addCheckbox:s.bool.isRequired}).isRequired,onNodeClickHandler:s.func.isRequired,onToggleClickHandler:s.func.isRequired,focus:s.shape({index:s.number,disable:s.bool}),infiniteScrolling:s.bool,onAction:s.func,nodeElement:s.any,groupElement:s.func},getInitialState:function(){return{visibleNodesLength:this.getVisibleNodesLength(this.props.tree.children),canGoUp:true,offset:0,size:1}},componentDidMount:function(){var e,t,i,n;if(this.props.infiniteScrolling&&!this.state.nodeHeight){e=this.refs.scroller;if(e.firstChild){t=e.firstChild.offsetHeight;i=e.parentNode.offsetHeight;n=Math.floor(i/t)+f;this.setState(r.extend({viewportHeight:i,nodeHeight:t,scrollerHeight:t*this.state.visibleNodesLength,size:n},this.applyFocus(this.props,n)))}}},componentDidUpdate:function(){var e,t;if(!r.isUndefined(this.props.focus)&&!this.state.dontSetFocus){t=this.props.infiniteScrolling?this.state.focusIndex-this.state.offset:this.state.focusIndex;e=this.refs.scroller.children[t]}e&&e.focus();if(this.props.focus&&this.props.focus.disable){o.findDOMNode(this).scrollTop=this.state.nodeHeight*this.state.offset}},componentWillReceiveProps:function(e){var t=this.getVisibleNodesLength(e.tree.children),i=r.extend({canGoUp:true,scrollerHeight:this.state.nodeHeight*t,visibleNodesLength:t},this.applyFocus(e,this.state.size));if(e.tree.length!==this.props.tree.length){o.findDOMNode(this).scrollTop=0}this.setState(i)},getVisibleNodesLength:function(e,t){t=t||{length:0};for(var i=0;i<e.length;i++){t.length++;if(e[i].nodeObj.isOpen&&e[i].children){this.getVisibleNodesLength(e[i].children,t)}}return t.length},$getNodesInRange:function(e,t,i,r,n){n=n||{index:0};i=i||0;r=r||i;for(var o=0;o<t.length;o++){if(n.index>=i&&n.index<=r){e.push(t[o])}n.index++;if(t[o].nodeObj.isOpen&&t[o].children){this.$getNodesInRange(e,t[o].children,i,r,n)}}},applyFocus:function(e,t){var i={},r=false;if(e.focus){i.dontSetFocus=e.focus.disable;if(!e.focus.disable&&e.focus.index!==null){i.focusIndex=e.focus.index}if(e.focus.index!==null){i.offset=this.getOffsetForFocus(e.focus.index,t)}}return i},getOffsetForFocus:function(e,t,i){i=!r.isUndefined(i)?i:this.state.offset;t=!r.isUndefined(t)?t:this.state.size;if(!r.isUndefined(e)&&e!==-1&&(e<i||e>i+t-f)){return Math.min(e,this.props.tree.length)}else{return i}},onScroll:function(e){var t=Math.floor(e.target.scrollTop/this.state.nodeHeight);this.setState({offset:t,dontSetFocus:true})},onFocus:function(e){this.setState({focusIndex:e.target.tabIndex})},onBlur:function(){this.setState({focusIndex:-1})},onKeyUp:function(e){switch(e.keyCode){case d.BACKSPACE:e.preventDefault();this.props.onAction(c.BACKSPACE);break;case d.ESC:this.props.onAction(c.CANCEL);break;case d.LEFT:this.props.onAction(c.MOVE_LEFT);break;case d.UP:if(this.state.focusIndex===0){if(this.state.canGoUp){this.props.onAction(c.MOVE_OUT_UP);this.setState({canGoUp:false})}else{this.setState({canGoUp:true})}}break;case d.RIGHT:this.props.onAction(c.MOVE_RIGHT);break}},onKeyDown:function(e){if([d.BACKSPACE,d.TAB,d.SPACE,d.UP,d.DOWN].indexOf(e.keyCode)!==-1){e.preventDefault()}switch(e.keyCode){case d.TAB:if(e.shiftKey){this.focusPrevious()}else{this.focusNext()}break;case d.UP:if(this.state.focusIndex!==0){this.setState({canGoUp:false})}this.focusPrevious();break;case d.DOWN:this.setState({canGoUp:false});this.focusNext();break}},onKeyPress:function(e){if(e.charCode!==d.ENTER&&e.charCode!==d.SPACE){this.props.onAction(c.SEARCH,String.fromCharCode(e.charCode))}},onClickHandler:function(e,t,i){var r=[],n,o;if(this.props.onAction){if(this.state.lastTouchedIndex!==undefined&&e.shiftKey&&this.state.lastTouchedIndex!==t){n=this.state.lastTouchedIndex<t?this.state.lastTouchedIndex:t;o=t>this.state.lastTouchedIndex?t:this.state.lastTouchedIndex;this.$getNodesInRange(r,this.props.tree.children,n,o);this.props.onAction(c.SELECT_RANGE,{start:this.state.lastTouchedIndex,end:t,nodes:r})}else{this.props.onAction(c.SELECT,{index:t,node:i});this.props.onNodeClickHandler(e,i)}this.setState({lastTouchedIndex:t})}else{this.props.onNodeClickHandler(e,i)}},onNodeKeyUp:function(e,t,i){this.props.onAction&&this.props.onAction(c.NODE_KEY_UP,{index:t,node:i},e);if(e.keyCode===d.ENTER||e.keyCode===d.SPACE){this.onClickHandler(e,t,i)}},changeFocus:function(e,t){var i=o.findDOMNode(this),r=this.state.size-f,n={focusIndex:this.state.focusIndex+t,dontSetFocus:false};if(this.state.focusIndex<this.state.offset||this.state.focusIndex>this.state.offset+r){n.offset=this.getOffsetForFocus(n.focusIndex,this.state.size)}else{n.offset=e?this.state.offset+t:this.state.offset;if(e){i.scrollTop+=this.state.nodeHeight*t}}this.setState(n)},focusPrevious:function(){if(this.state.focusIndex>0){this.changeFocus(this.state.focusIndex===this.state.offset,-1)}},focusNext:function(){if(this.state.focusIndex<this.state.visibleNodesLength-1){this.changeFocus(this.state.focusIndex===this.state.offset+this.state.size-f-1,1)}},renderGroup:function(e,t){if(this.props.groupElement){return this.props.groupElement(e,t)}else{return n.DOM.div({className:"lb-tree-browser-group"},t)}},renderNode:function(e,t){return n.createElement(p,{key:e.treeNode.nodeObj.$id||r.uniqueId("lb-tree-node"),focused:this.state.focusIndex===t,focusIndex:t,nodeElement:this.props.nodeElement,nodeData:e})},renderNodes:function(e,t,i,r){var n=0,o=t.length,a,s;for(;n<o;n++){if(this.props.infiniteScrolling&&e.length===this.state.size){break}a=t[n];s=a.nodeObj;var l=a.hasOwnProperty("children"),u=this.props.nodeConfig.addCheckbox&&(this.props.allowCollapsibleNodeSelect||!l),c={treeNode:a,depth:i,hasCheckbox:!!u,allowPressAndMoveSelection:this.props.allowPressAndMoveSelection,paddingLeft:this.props.nodeConfig.paddingLeft,checkboxElement:this.props.nodeConfig.checkboxElement,onClickHandler:this.onClickHandler,onNodeKeyUp:this.onNodeKeyUp,onToggleClickHandler:this.props.onToggleClickHandler},d;if(s.group){d=[];this.renderNodes(d,a.children,i,r);e.push(this.renderGroup(c,d))}else{if(!this.props.infiniteScrolling||r.index>=this.state.offset&&e.length<this.state.size){e.push(this.renderNode(c,r.index))}r.index++;if(s.isOpen&&l){this.renderNodes(e,a.children,i+2,r)}}}},render:function(){var e=[];this.renderNodes(e,this.props.tree.children,0,{index:0});return n.DOM.div({className:l({"lb-tree-nodes":true,"has-focus":!r.isUndefined(this.state.focusIndex)&&this.state.focusIndex!==-1,"infinite-scrolling":this.props.infiniteScrolling}),onFocus:!r.isUndefined(this.props.focus)?this.onFocus:undefined,onBlur:!r.isUndefined(this.props.focus)?this.onBlur:undefined,onKeyUp:this.onKeyUp,onKeyDown:!r.isUndefined(this.props.focus)?this.onKeyDown:undefined,onScroll:this.props.infiniteScrolling?this.onScroll:undefined,onKeyPress:!r.isUndefined(this.props.focus)?this.onKeyPress:undefined},n.DOM.div({ref:"scroller",className:"lb-tree-nodes-scroller",style:{height:this.state.nodeHeight?this.state.scrollerHeight:undefined,paddingTop:this.state.nodeHeight?this.state.offset*this.state.nodeHeight:undefined}},e))}});t.exports=h},{"../constants":203,"./treenodecontainer":210,classnames:6,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],212:[function(e,i,r){(function(){var e=this;var n=e._;var o=Array.prototype,a=Object.prototype,s=Function.prototype;var l=o.push,u=o.slice,c=a.toString,d=a.hasOwnProperty;var p=Array.isArray,f=Object.keys,h=s.bind,g=Object.create;var m=function(){};var v=function(e){if(e instanceof v)return e;if(!(this instanceof v))return new v(e);this._wrapped=e};if(typeof r!=="undefined"){if(typeof i!=="undefined"&&i.exports){r=i.exports=v}r._=v}else{e._=v}v.VERSION="1.8.3";var y=function(e,t,i){if(t===void 0)return e;switch(i==null?3:i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)};case 4:return function(i,r,n,o){return e.call(t,i,r,n,o)}}return function(){return e.apply(t,arguments)}};var b=function(e,t,i){if(e==null)return v.identity;if(v.isFunction(e))return y(e,t,i);if(v.isObject(e))return v.matcher(e);return v.property(e)};v.iteratee=function(e,t){return b(e,t,Infinity)};var w=function(e,t){return function(i){var r=arguments.length;if(r<2||i==null)return i;for(var n=1;n<r;n++){var o=arguments[n],a=e(o),s=a.length;for(var l=0;l<s;l++){var u=a[l];if(!t||i[u]===void 0)i[u]=o[u]}}return i}};var C=function(e){if(!v.isObject(e))return{};if(g)return g(e);m.prototype=e;var t=new m;m.prototype=null;return t};var E=function(e){return function(t){return t==null?void 0:t[e]}};var S=Math.pow(2,53)-1;var T=E("length");var x=function(e){var t=T(e);return typeof t=="number"&&t>=0&&t<=S};v.each=v.forEach=function(e,t,i){t=y(t,i);var r,n;if(x(e)){for(r=0,n=e.length;r<n;r++){t(e[r],r,e)}}else{var o=v.keys(e);for(r=0,n=o.length;r<n;r++){t(e[o[r]],o[r],e)}}return e};v.map=v.collect=function(e,t,i){t=b(t,i);var r=!x(e)&&v.keys(e),n=(r||e).length,o=Array(n);for(var a=0;a<n;a++){var s=r?r[a]:a;o[a]=t(e[s],s,e)}return o};function _(e){function t(t,i,r,n,o,a){for(;o>=0&&o<a;o+=e){var s=n?n[o]:o;r=i(r,t[s],s,t)}return r}return function(i,r,n,o){r=y(r,o,4);var a=!x(i)&&v.keys(i),s=(a||i).length,l=e>0?0:s-1;if(arguments.length<3){n=i[a?a[l]:l];l+=e}return t(i,r,n,a,l,s)}}v.reduce=v.foldl=v.inject=_(1);v.reduceRight=v.foldr=_(-1);v.find=v.detect=function(e,t,i){var r;if(x(e)){r=v.findIndex(e,t,i)}else{r=v.findKey(e,t,i)}if(r!==void 0&&r!==-1)return e[r]};v.filter=v.select=function(e,t,i){var r=[];t=b(t,i);v.each(e,function(e,i,n){if(t(e,i,n))r.push(e)});return r};v.reject=function(e,t,i){return v.filter(e,v.negate(b(t)),i)};v.every=v.all=function(e,t,i){t=b(t,i);var r=!x(e)&&v.keys(e),n=(r||e).length;for(var o=0;o<n;o++){var a=r?r[o]:o;if(!t(e[a],a,e))return false}return true};v.some=v.any=function(e,t,i){t=b(t,i);var r=!x(e)&&v.keys(e),n=(r||e).length;for(var o=0;o<n;o++){var a=r?r[o]:o;if(t(e[a],a,e))return true}return false};v.contains=v.includes=v.include=function(e,t,i,r){if(!x(e))e=v.values(e);if(typeof i!="number"||r)i=0;return v.indexOf(e,t,i)>=0};v.invoke=function(e,t){var i=u.call(arguments,2);var r=v.isFunction(t);return v.map(e,function(e){var n=r?t:e[t];return n==null?n:n.apply(e,i)})};v.pluck=function(e,t){return v.map(e,v.property(t))};v.where=function(e,t){return v.filter(e,v.matcher(t))};v.findWhere=function(e,t){return v.find(e,v.matcher(t))};v.max=function(e,t,i){var r=-Infinity,n=-Infinity,o,a;if(t==null&&e!=null){e=x(e)?e:v.values(e);for(var s=0,l=e.length;s<l;s++){o=e[s];if(o>r){r=o}}}else{t=b(t,i);v.each(e,function(e,i,o){a=t(e,i,o);if(a>n||a===-Infinity&&r===-Infinity){r=e;n=a}})}return r};v.min=function(e,t,i){var r=Infinity,n=Infinity,o,a;if(t==null&&e!=null){e=x(e)?e:v.values(e);for(var s=0,l=e.length;s<l;s++){o=e[s];if(o<r){r=o}}}else{t=b(t,i);v.each(e,function(e,i,o){a=t(e,i,o);if(a<n||a===Infinity&&r===Infinity){r=e;n=a}})}return r};v.shuffle=function(e){var t=x(e)?e:v.values(e);var i=t.length;var r=Array(i);for(var n=0,o;n<i;n++){o=v.random(0,n);if(o!==n)r[n]=r[o];r[o]=t[n]}return r};v.sample=function(e,t,i){if(t==null||i){if(!x(e))e=v.values(e);return e[v.random(e.length-1)]}return v.shuffle(e).slice(0,Math.max(0,t))};v.sortBy=function(e,t,i){t=b(t,i);return v.pluck(v.map(e,function(e,i,r){return{value:e,index:i,criteria:t(e,i,r)}}).sort(function(e,t){var i=e.criteria;var r=t.criteria;if(i!==r){if(i>r||i===void 0)return 1;if(i<r||r===void 0)return-1}return e.index-t.index}),"value")};var M=function(e){return function(t,i,r){var n={};i=b(i,r);v.each(t,function(r,o){var a=i(r,o,t);e(n,r,a)});return n}};v.groupBy=M(function(e,t,i){if(v.has(e,i))e[i].push(t);else e[i]=[t]});v.indexBy=M(function(e,t,i){e[i]=t});v.countBy=M(function(e,t,i){if(v.has(e,i))e[i]++;else e[i]=1});v.toArray=function(e){if(!e)return[];if(v.isArray(e))return u.call(e);if(x(e))return v.map(e,v.identity);return v.values(e)};v.size=function(e){if(e==null)return 0;return x(e)?e.length:v.keys(e).length};v.partition=function(e,t,i){t=b(t,i);var r=[],n=[];v.each(e,function(e,i,o){(t(e,i,o)?r:n).push(e)});return[r,n]};v.first=v.head=v.take=function(e,t,i){if(e==null)return void 0;if(t==null||i)return e[0];return v.initial(e,e.length-t)};v.initial=function(e,t,i){return u.call(e,0,Math.max(0,e.length-(t==null||i?1:t)))};v.last=function(e,t,i){if(e==null)return void 0;if(t==null||i)return e[e.length-1];return v.rest(e,Math.max(0,e.length-t))};v.rest=v.tail=v.drop=function(e,t,i){return u.call(e,t==null||i?1:t)};v.compact=function(e){return v.filter(e,v.identity)};var A=function(e,t,i,r){var n=[],o=0;for(var a=r||0,s=T(e);a<s;a++){var l=e[a];if(x(l)&&(v.isArray(l)||v.isArguments(l))){if(!t)l=A(l,t,i);var u=0,c=l.length;n.length+=c;while(u<c){n[o++]=l[u++]}}else if(!i){n[o++]=l}}return n};v.flatten=function(e,t){return A(e,t,false)};v.without=function(e){return v.difference(e,u.call(arguments,1))};v.uniq=v.unique=function(e,t,i,r){if(!v.isBoolean(t)){r=i;i=t;t=false}if(i!=null)i=b(i,r);var n=[];var o=[];for(var a=0,s=T(e);a<s;a++){var l=e[a],u=i?i(l,a,e):l;if(t){if(!a||o!==u)n.push(l);o=u}else if(i){if(!v.contains(o,u)){o.push(u);n.push(l)}}else if(!v.contains(n,l)){n.push(l)}}return n};v.union=function(){return v.uniq(A(arguments,true,true))};v.intersection=function(e){var t=[];var i=arguments.length;for(var r=0,n=T(e);r<n;r++){var o=e[r];if(v.contains(t,o))continue;for(var a=1;a<i;a++){if(!v.contains(arguments[a],o))break}if(a===i)t.push(o)}return t};v.difference=function(e){var t=A(arguments,true,true,1);return v.filter(e,function(e){return!v.contains(t,e)})};v.zip=function(){return v.unzip(arguments)};v.unzip=function(e){var t=e&&v.max(e,T).length||0;var i=Array(t);for(var r=0;r<t;r++){i[r]=v.pluck(e,r)}return i};v.object=function(e,t){var i={};for(var r=0,n=T(e);r<n;r++){if(t){i[e[r]]=t[r]}else{i[e[r][0]]=e[r][1]}}return i};function I(e){return function(t,i,r){i=b(i,r);var n=T(t);var o=e>0?0:n-1;for(;o>=0&&o<n;o+=e){if(i(t[o],o,t))return o}return-1}}v.findIndex=I(1);v.findLastIndex=I(-1);v.sortedIndex=function(e,t,i,r){i=b(i,r,1);var n=i(t);var o=0,a=T(e);while(o<a){var s=Math.floor((o+a)/2);if(i(e[s])<n)o=s+1;else a=s}return o};function O(e,t,i){return function(r,n,o){var a=0,s=T(r);if(typeof o=="number"){if(e>0){a=o>=0?o:Math.max(o+s,a)}else{s=o>=0?Math.min(o+1,s):o+s+1}}else if(i&&o&&s){o=i(r,n);return r[o]===n?o:-1}if(n!==n){o=t(u.call(r,a,s),v.isNaN);return o>=0?o+a:-1}for(o=e>0?a:s-1;o>=0&&o<s;o+=e){if(r[o]===n)return o}return-1}}v.indexOf=O(1,v.findIndex,v.sortedIndex);v.lastIndexOf=O(-1,v.findLastIndex);v.range=function(e,t,i){if(t==null){t=e||0;e=0}i=i||1;var r=Math.max(Math.ceil((t-e)/i),0);var n=Array(r);for(var o=0;o<r;o++,e+=i){n[o]=e}return n};var D=function(e,t,i,r,n){if(!(r instanceof t))return e.apply(i,n);var o=C(e.prototype);var a=e.apply(o,n);if(v.isObject(a))return a;return o};v.bind=function(e,t){if(h&&e.bind===h)return h.apply(e,u.call(arguments,1));if(!v.isFunction(e))throw new TypeError("Bind must be called on a function");var i=u.call(arguments,2);var r=function(){return D(e,r,t,this,i.concat(u.call(arguments)))};return r};v.partial=function(e){var t=u.call(arguments,1);var i=function(){var r=0,n=t.length;var o=Array(n);for(var a=0;a<n;a++){o[a]=t[a]===v?arguments[r++]:t[a]}while(r<arguments.length)o.push(arguments[r++]);return D(e,i,this,this,o)};return i};v.bindAll=function(e){var t,i=arguments.length,r;if(i<=1)throw new Error("bindAll must be passed function names");for(t=1;t<i;t++){r=arguments[t];e[r]=v.bind(e[r],e)}return e};v.memoize=function(e,t){var i=function(r){var n=i.cache;var o=""+(t?t.apply(this,arguments):r);if(!v.has(n,o))n[o]=e.apply(this,arguments);return n[o]};i.cache={};return i};v.delay=function(e,t){var i=u.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)};v.defer=v.partial(v.delay,v,1);v.throttle=function(e,t,i){var r,n,o;var a=null;var s=0;if(!i)i={};var l=function(){s=i.leading===false?0:v.now();a=null;o=e.apply(r,n);if(!a)r=n=null};return function(){var u=v.now();if(!s&&i.leading===false)s=u;var c=t-(u-s);r=this;n=arguments;if(c<=0||c>t){if(a){clearTimeout(a);a=null}s=u;o=e.apply(r,n);if(!a)r=n=null}else if(!a&&i.trailing!==false){a=setTimeout(l,c)}return o}};v.debounce=function(e,t,i){var r,n,o,a,s;var l=function(){var u=v.now()-a;if(u<t&&u>=0){r=setTimeout(l,t-u)}else{r=null;if(!i){s=e.apply(o,n);if(!r)o=n=null}}};return function(){o=this;n=arguments;a=v.now();var u=i&&!r;if(!r)r=setTimeout(l,t);if(u){s=e.apply(o,n);o=n=null}return s}};v.wrap=function(e,t){return v.partial(t,e)};v.negate=function(e){return function(){return!e.apply(this,arguments)}};v.compose=function(){var e=arguments;var t=e.length-1;return function(){var i=t;var r=e[t].apply(this,arguments);while(i--)r=e[i].call(this,r);return r}};v.after=function(e,t){return function(){if(--e<1){return t.apply(this,arguments)}}};v.before=function(e,t){var i;return function(){if(--e>0){i=t.apply(this,arguments)}if(e<=1)t=null;return i}};v.once=v.partial(v.before,2);var N=!{toString:null}.propertyIsEnumerable("toString");var R=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function P(e,t){var i=R.length;var r=e.constructor;var n=v.isFunction(r)&&r.prototype||a;var o="constructor";
if(v.has(e,o)&&!v.contains(t,o))t.push(o);while(i--){o=R[i];if(o in e&&e[o]!==n[o]&&!v.contains(t,o)){t.push(o)}}}v.keys=function(e){if(!v.isObject(e))return[];if(f)return f(e);var t=[];for(var i in e)if(v.has(e,i))t.push(i);if(N)P(e,t);return t};v.allKeys=function(e){if(!v.isObject(e))return[];var t=[];for(var i in e)t.push(i);if(N)P(e,t);return t};v.values=function(e){var t=v.keys(e);var i=t.length;var r=Array(i);for(var n=0;n<i;n++){r[n]=e[t[n]]}return r};v.mapObject=function(e,t,i){t=b(t,i);var r=v.keys(e),n=r.length,o={},a;for(var s=0;s<n;s++){a=r[s];o[a]=t(e[a],a,e)}return o};v.pairs=function(e){var t=v.keys(e);var i=t.length;var r=Array(i);for(var n=0;n<i;n++){r[n]=[t[n],e[t[n]]]}return r};v.invert=function(e){var t={};var i=v.keys(e);for(var r=0,n=i.length;r<n;r++){t[e[i[r]]]=i[r]}return t};v.functions=v.methods=function(e){var t=[];for(var i in e){if(v.isFunction(e[i]))t.push(i)}return t.sort()};v.extend=w(v.allKeys);v.extendOwn=v.assign=w(v.keys);v.findKey=function(e,t,i){t=b(t,i);var r=v.keys(e),n;for(var o=0,a=r.length;o<a;o++){n=r[o];if(t(e[n],n,e))return n}};v.pick=function(e,t,i){var r={},n=e,o,a;if(n==null)return r;if(v.isFunction(t)){a=v.allKeys(n);o=y(t,i)}else{a=A(arguments,false,false,1);o=function(e,t,i){return t in i};n=Object(n)}for(var s=0,l=a.length;s<l;s++){var u=a[s];var c=n[u];if(o(c,u,n))r[u]=c}return r};v.omit=function(e,t,i){if(v.isFunction(t)){t=v.negate(t)}else{var r=v.map(A(arguments,false,false,1),String);t=function(e,t){return!v.contains(r,t)}}return v.pick(e,t,i)};v.defaults=w(v.allKeys,true);v.create=function(e,t){var i=C(e);if(t)v.extendOwn(i,t);return i};v.clone=function(e){if(!v.isObject(e))return e;return v.isArray(e)?e.slice():v.extend({},e)};v.tap=function(e,t){t(e);return e};v.isMatch=function(e,t){var i=v.keys(t),r=i.length;if(e==null)return!r;var n=Object(e);for(var o=0;o<r;o++){var a=i[o];if(t[a]!==n[a]||!(a in n))return false}return true};var L=function(e,t,i,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;if(e instanceof v)e=e._wrapped;if(t instanceof v)t=t._wrapped;var n=c.call(e);if(n!==c.call(t))return false;switch(n){case"[object RegExp]":case"[object String]":return""+e===""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var o=n==="[object Array]";if(!o){if(typeof e!="object"||typeof t!="object")return false;var a=e.constructor,s=t.constructor;if(a!==s&&!(v.isFunction(a)&&a instanceof a&&v.isFunction(s)&&s instanceof s)&&("constructor"in e&&"constructor"in t)){return false}}i=i||[];r=r||[];var l=i.length;while(l--){if(i[l]===e)return r[l]===t}i.push(e);r.push(t);if(o){l=e.length;if(l!==t.length)return false;while(l--){if(!L(e[l],t[l],i,r))return false}}else{var u=v.keys(e),d;l=u.length;if(v.keys(t).length!==l)return false;while(l--){d=u[l];if(!(v.has(t,d)&&L(e[d],t[d],i,r)))return false}}i.pop();r.pop();return true};v.isEqual=function(e,t){return L(e,t)};v.isEmpty=function(e){if(e==null)return true;if(x(e)&&(v.isArray(e)||v.isString(e)||v.isArguments(e)))return e.length===0;return v.keys(e).length===0};v.isElement=function(e){return!!(e&&e.nodeType===1)};v.isArray=p||function(e){return c.call(e)==="[object Array]"};v.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e};v.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){v["is"+e]=function(t){return c.call(t)==="[object "+e+"]"}});if(!v.isArguments(arguments)){v.isArguments=function(e){return v.has(e,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){v.isFunction=function(e){return typeof e=="function"||false}}v.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))};v.isNaN=function(e){return v.isNumber(e)&&e!==+e};v.isBoolean=function(e){return e===true||e===false||c.call(e)==="[object Boolean]"};v.isNull=function(e){return e===null};v.isUndefined=function(e){return e===void 0};v.has=function(e,t){return e!=null&&d.call(e,t)};v.noConflict=function(){e._=n;return this};v.identity=function(e){return e};v.constant=function(e){return function(){return e}};v.noop=function(){};v.property=E;v.propertyOf=function(e){return e==null?function(){}:function(t){return e[t]}};v.matcher=v.matches=function(e){e=v.extendOwn({},e);return function(t){return v.isMatch(t,e)}};v.times=function(e,t,i){var r=Array(Math.max(0,e));t=y(t,i,1);for(var n=0;n<e;n++)r[n]=t(n);return r};v.random=function(e,t){if(t==null){t=e;e=0}return e+Math.floor(Math.random()*(t-e+1))};v.now=Date.now||function(){return(new Date).getTime()};var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var $=v.invert(k);var F=function(e){var t=function(t){return e[t]};var i="(?:"+v.keys(e).join("|")+")";var r=RegExp(i);var n=RegExp(i,"g");return function(e){e=e==null?"":""+e;return r.test(e)?e.replace(n,t):e}};v.escape=F(k);v.unescape=F($);v.result=function(e,t,i){var r=e==null?void 0:e[t];if(r===void 0){r=i}return v.isFunction(r)?r.call(e):r};var V=0;v.uniqueId=function(e){var t=++V+"";return e?e+t:t};v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/;var H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var U=/\\|'|\r|\n|\u2028|\u2029/g;var B=function(e){return"\\"+H[e]};v.template=function(e,t,i){if(!t&&i)t=i;t=v.defaults({},t,v.templateSettings);var r=RegExp([(t.escape||q).source,(t.interpolate||q).source,(t.evaluate||q).source].join("|")+"|$","g");var n=0;var o="__p+='";e.replace(r,function(t,i,r,a,s){o+=e.slice(n,s).replace(U,B);n=s+t.length;if(i){o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"}else if(r){o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"}else if(a){o+="';\n"+a+"\n__p+='"}return t});o+="';\n";if(!t.variable)o="with(obj||{}){\n"+o+"}\n";o="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(t.variable||"obj","_",o)}catch(e){e.source=o;throw e}var s=function(e){return a.call(this,e,v)};var l=t.variable||"obj";s.source="function("+l+"){\n"+o+"}";return s};v.chain=function(e){var t=v(e);t._chain=true;return t};var z=function(e,t){return e._chain?v(t).chain():t};v.mixin=function(e){v.each(v.functions(e),function(t){var i=v[t]=e[t];v.prototype[t]=function(){var e=[this._wrapped];l.apply(e,arguments);return z(this,i.apply(v,e))}})};v.mixin(v);v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];v.prototype[e]=function(){var i=this._wrapped;t.apply(i,arguments);if((e==="shift"||e==="splice")&&i.length===0)delete i[0];return z(this,i)}});v.each(["concat","join","slice"],function(e){var t=o[e];v.prototype[e]=function(){return z(this,t.apply(this._wrapped,arguments))}});v.prototype.value=function(){return this._wrapped};v.prototype.valueOf=v.prototype.toJSON=v.prototype.value;v.prototype.toString=function(){return""+this._wrapped};if(typeof t==="function"&&t.amd){t("underscore",[],function(){return v})}}).call(this)},{}],213:[function(e,t,i){"use strict";var r=e("ip-regex");t.exports=function(e){e=e||{};var t="(?:(?:[a-z]+:)?//)";var i="(?:\\S+(?::\\S*)?@)?";var n=r.v4().source;var o="(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)";var a="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*";var s="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";var l="(?::\\d{2,5})?";var u='(?:[/?#][^\\s"]*)?';var c=["(?:"+t+"|www\\.)"+i,"(?:localhost|"+n+"|"+o+a+s+")",l,u].join("");return e.exact?new RegExp("(?:^"+c+"$)","i"):new RegExp(c,"ig")}},{"ip-regex":42}],214:[function(e,t,i){t.exports=function e(t){return t&&typeof t==="object"&&typeof t.copy==="function"&&typeof t.fill==="function"&&typeof t.readUInt8==="function"}},{}],215:[function(e,t,i){(function(t,r){var n=/%[sdj%]/g;i.format=function(e){if(!E(e)){var t=[];for(var i=0;i<arguments.length;i++){t.push(s(arguments[i]))}return t.join(" ")}var i=1;var r=arguments;var o=r.length;var a=String(e).replace(n,function(e){if(e==="%%")return"%";if(i>=o)return e;switch(e){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(e){return"[Circular]"}default:return e}});for(var l=r[i];i<o;l=r[++i]){if(b(l)||!_(l)){a+=" "+l}else{a+=" "+s(l)}}return a};i.deprecate=function(e,n){if(T(r.process)){return function(){return i.deprecate(e,n).apply(this,arguments)}}if(t.noDeprecation===true){return e}var o=false;function a(){if(!o){if(t.throwDeprecation){throw new Error(n)}else if(t.traceDeprecation){console.trace(n)}else{console.error(n)}o=true}return e.apply(this,arguments)}return a};var o={};var a;i.debuglog=function(e){if(T(a))a=t.env.NODE_DEBUG||"";e=e.toUpperCase();if(!o[e]){if(new RegExp("\\b"+e+"\\b","i").test(a)){var r=t.pid;o[e]=function(){var t=i.format.apply(i,arguments);console.error("%s %d: %s",e,r,t)}}else{o[e]=function(){}}}return o[e]};function s(e,t){var r={seen:[],stylize:u};if(arguments.length>=3)r.depth=arguments[2];if(arguments.length>=4)r.colors=arguments[3];if(y(t)){r.showHidden=t}else if(t){i._extend(r,t)}if(T(r.showHidden))r.showHidden=false;if(T(r.depth))r.depth=2;if(T(r.colors))r.colors=false;if(T(r.customInspect))r.customInspect=true;if(r.colors)r.stylize=l;return d(r,e,r.depth)}i.inspect=s;s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function l(e,t){var i=s.styles[t];if(i){return"["+s.colors[i][0]+"m"+e+"["+s.colors[i][1]+"m"}else{return e}}function u(e,t){return e}function c(e){var t={};e.forEach(function(e,i){t[e]=true});return t}function d(e,t,r){if(e.customInspect&&t&&I(t.inspect)&&t.inspect!==i.inspect&&!(t.constructor&&t.constructor.prototype===t)){var n=t.inspect(r,e);if(!E(n)){n=d(e,n,r)}return n}var o=p(e,t);if(o){return o}var a=Object.keys(t);var s=c(a);if(e.showHidden){a=Object.getOwnPropertyNames(t)}if(A(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0)){return f(t)}if(a.length===0){if(I(t)){var l=t.name?": "+t.name:"";return e.stylize("[Function"+l+"]","special")}if(x(t)){return e.stylize(RegExp.prototype.toString.call(t),"regexp")}if(M(t)){return e.stylize(Date.prototype.toString.call(t),"date")}if(A(t)){return f(t)}}var u="",y=false,b=["{","}"];if(v(t)){y=true;b=["[","]"]}if(I(t)){var w=t.name?": "+t.name:"";u=" [Function"+w+"]"}if(x(t)){u=" "+RegExp.prototype.toString.call(t)}if(M(t)){u=" "+Date.prototype.toUTCString.call(t)}if(A(t)){u=" "+f(t)}if(a.length===0&&(!y||t.length==0)){return b[0]+u+b[1]}if(r<0){if(x(t)){return e.stylize(RegExp.prototype.toString.call(t),"regexp")}else{return e.stylize("[Object]","special")}}e.seen.push(t);var C;if(y){C=h(e,t,r,s,a)}else{C=a.map(function(i){return g(e,t,r,s,i,y)})}e.seen.pop();return m(C,u,b)}function p(e,t){if(T(t))return e.stylize("undefined","undefined");if(E(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}if(C(t))return e.stylize(""+t,"number");if(y(t))return e.stylize(""+t,"boolean");if(b(t))return e.stylize("null","null")}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,i,r,n){var o=[];for(var a=0,s=t.length;a<s;++a){if(L(t,String(a))){o.push(g(e,t,i,r,String(a),true))}else{o.push("")}}n.forEach(function(n){if(!n.match(/^\d+$/)){o.push(g(e,t,i,r,n,true))}});return o}function g(e,t,i,r,n,o){var a,s,l;l=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]};if(l.get){if(l.set){s=e.stylize("[Getter/Setter]","special")}else{s=e.stylize("[Getter]","special")}}else{if(l.set){s=e.stylize("[Setter]","special")}}if(!L(r,n)){a="["+n+"]"}if(!s){if(e.seen.indexOf(l.value)<0){if(b(i)){s=d(e,l.value,null)}else{s=d(e,l.value,i-1)}if(s.indexOf("\n")>-1){if(o){s=s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2)}else{s="\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")}}}else{s=e.stylize("[Circular]","special")}}if(T(a)){if(o&&n.match(/^\d+$/)){return s}a=JSON.stringify(""+n);if(a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){a=a.substr(1,a.length-2);a=e.stylize(a,"name")}else{a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");a=e.stylize(a,"string")}}return a+": "+s}function m(e,t,i){var r=0;var n=e.reduce(function(e,t){r++;if(t.indexOf("\n")>=0)r++;return e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(n>60){return i[0]+(t===""?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1]}return i[0]+t+" "+e.join(", ")+" "+i[1]}function v(e){return Array.isArray(e)}i.isArray=v;function y(e){return typeof e==="boolean"}i.isBoolean=y;function b(e){return e===null}i.isNull=b;function w(e){return e==null}i.isNullOrUndefined=w;function C(e){return typeof e==="number"}i.isNumber=C;function E(e){return typeof e==="string"}i.isString=E;function S(e){return typeof e==="symbol"}i.isSymbol=S;function T(e){return e===void 0}i.isUndefined=T;function x(e){return _(e)&&D(e)==="[object RegExp]"}i.isRegExp=x;function _(e){return typeof e==="object"&&e!==null}i.isObject=_;function M(e){return _(e)&&D(e)==="[object Date]"}i.isDate=M;function A(e){return _(e)&&(D(e)==="[object Error]"||e instanceof Error)}i.isError=A;function I(e){return typeof e==="function"}i.isFunction=I;function O(e){return e===null||typeof e==="boolean"||typeof e==="number"||typeof e==="string"||typeof e==="symbol"||typeof e==="undefined"}i.isPrimitive=O;i.isBuffer=e("./support/isBuffer");function D(e){return Object.prototype.toString.call(e)}function N(e){return e<10?"0"+e.toString(10):e.toString(10)}var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(){var e=new Date;var t=[N(e.getHours()),N(e.getMinutes()),N(e.getSeconds())].join(":");return[e.getDate(),R[e.getMonth()],t].join(" ")}i.log=function(){console.log("%s - %s",P(),i.format.apply(i,arguments))};i.inherits=e("inherits");i._extend=function(e,t){if(!t||!_(t))return e;var i=Object.keys(t);var r=i.length;while(r--){e[i[r]]=t[i[r]]}return e};function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":214,_process:155,inherits:41}],216:[function(e,t,i){function r(e){this.options=e||{locator:{}}}r.prototype.parseFromString=function(e,t){var i=this.options;var r=new c;var a=i.domBuilder||new o;var s=i.errorHandler;var l=i.locator;var u=i.xmlns||{};var d={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};if(l){a.setDocumentLocator(l)}r.errorHandler=n(s,a,l);r.domBuilder=i.domBuilder||a;if(/\/x?html?$/.test(t)){d.nbsp="Â ";d.copy="Â©";u[""]="http://www.w3.org/1999/xhtml"}u.xml=u.xml||"http://www.w3.org/XML/1998/namespace";if(e){r.parse(e,u,d)}else{r.errorHandler.error("invalid doc source")}return a.doc};function n(e,t,i){if(!e){if(t instanceof o){return t}e=t}var r={};var n=e instanceof Function;i=i||{};function a(t){var o=e[t];if(!o&&n){o=e.length==2?function(i){e(t,i)}:e}r[t]=o&&function(e){o("[xmldom "+t+"]\t"+e+s(i))}||function(){}}a("warning");a("error");a("fatalError");return r}function o(){this.cdata=false}function a(e,t){t.lineNumber=e.lineNumber;t.columnNumber=e.columnNumber}o.prototype={startDocument:function(){this.doc=(new d).createDocument(null,null,null);if(this.locator){this.doc.documentURI=this.locator.systemId}},startElement:function(e,t,i,r){var n=this.doc;var o=n.createElementNS(e,i||t);var s=r.length;u(this,o);this.currentElement=o;this.locator&&a(this.locator,o);for(var l=0;l<s;l++){var e=r.getURI(l);var c=r.getValue(l);var i=r.getQName(l);var d=n.createAttributeNS(e,i);this.locator&&a(r.getLocator(l),d);d.value=d.nodeValue=c;o.setAttributeNode(d)}},endElement:function(e,t,i){var r=this.currentElement;var n=r.tagName;this.currentElement=r.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var i=this.doc.createProcessingInstruction(e,t);this.locator&&a(this.locator,i);u(this,i)},ignorableWhitespace:function(e,t,i){},characters:function(e,t,i){e=l.apply(this,arguments);if(e){if(this.cdata){var r=this.doc.createCDATASection(e)}else{var r=this.doc.createTextNode(e)}if(this.currentElement){this.currentElement.appendChild(r)}else if(/^\s*$/.test(e)){this.doc.appendChild(r)}this.locator&&a(this.locator,r)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){if(this.locator=e){e.lineNumber=0}},comment:function(e,t,i){e=l.apply(this,arguments);var r=this.doc.createComment(e);this.locator&&a(this.locator,r);u(this,r)},startCDATA:function(){this.cdata=true},endCDATA:function(){this.cdata=false},startDTD:function(e,t,i){var r=this.doc.implementation;if(r&&r.createDocumentType){var n=r.createDocumentType(e,t,i);this.locator&&a(this.locator,n);u(this,n)}},warning:function(e){console.warn("[xmldom warning]\t"+e,s(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,s(this.locator))},fatalError:function(e){console.error("[xmldom fatalError]\t"+e,s(this.locator));throw e}};function s(e){if(e){return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}}function l(e,t,i){if(typeof e=="string"){return e.substr(t,i)}else{if(e.length>=t+i||t){return new java.lang.String(e,t,i)+""}return e}}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){o.prototype[e]=function(){return null}});function u(e,t){if(!e.currentElement){e.doc.appendChild(t)}else{e.currentElement.appendChild(t)}}var c=e("./sax").XMLReader;var d=i.DOMImplementation=e("./dom").DOMImplementation;i.XMLSerializer=e("./dom").XMLSerializer;i.DOMParser=r},{"./dom":217,"./sax":218}],217:[function(e,t,i){function r(e,t){for(var i in e){t[i]=e[i]}}function n(e,t){var i=e.prototype;if(Object.create){var n=Object.create(t.prototype);i.__proto__=n}if(!(i instanceof t)){function o(){}o.prototype=t.prototype;o=new o;r(i,o);e.prototype=i=o}if(i.constructor!=e){if(typeof e!="function"){console.error("unknow Class:"+e)}i.constructor=e}}var o="http://www.w3.org/1999/xhtml";var a={};var s=a.ELEMENT_NODE=1;var l=a.ATTRIBUTE_NODE=2;var u=a.TEXT_NODE=3;var c=a.CDATA_SECTION_NODE=4;var d=a.ENTITY_REFERENCE_NODE=5;var p=a.ENTITY_NODE=6;var f=a.PROCESSING_INSTRUCTION_NODE=7;var h=a.COMMENT_NODE=8;var g=a.DOCUMENT_NODE=9;var m=a.DOCUMENT_TYPE_NODE=10;var v=a.DOCUMENT_FRAGMENT_NODE=11;var y=a.NOTATION_NODE=12;var b={};var w={};var C=b.INDEX_SIZE_ERR=(w[1]="Index size error",1);var E=b.DOMSTRING_SIZE_ERR=(w[2]="DOMString size error",2);var S=b.HIERARCHY_REQUEST_ERR=(w[3]="Hierarchy request error",3);var T=b.WRONG_DOCUMENT_ERR=(w[4]="Wrong document",4);var x=b.INVALID_CHARACTER_ERR=(w[5]="Invalid character",5);var _=b.NO_DATA_ALLOWED_ERR=(w[6]="No data allowed",6);var M=b.NO_MODIFICATION_ALLOWED_ERR=(w[7]="No modification allowed",7);var A=b.NOT_FOUND_ERR=(w[8]="Not found",8);var I=b.NOT_SUPPORTED_ERR=(w[9]="Not supported",9);var O=b.INUSE_ATTRIBUTE_ERR=(w[10]="Attribute in use",10);var D=b.INVALID_STATE_ERR=(w[11]="Invalid state",11);var N=b.SYNTAX_ERR=(w[12]="Syntax error",12);var R=b.INVALID_MODIFICATION_ERR=(w[13]="Invalid modification",13);var P=b.NAMESPACE_ERR=(w[14]="Invalid namespace",14);var L=b.INVALID_ACCESS_ERR=(w[15]="Invalid access",15);function k(e,t){if(t instanceof Error){var i=t}else{i=this;Error.call(this,w[e]);this.message=w[e];if(Error.captureStackTrace)Error.captureStackTrace(this,k)}i.code=e;if(t)this.message=this.message+": "+t;return i}k.prototype=Error.prototype;r(b,k);function $(){}$.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var i=[],r=0;r<this.length;r++){me(this[r],i,e,t)}return i.join("")}};function F(e,t){this._node=e;this._refresh=t;V(this)}function V(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var i=e._refresh(e._node);be(e,"length",i.length);r(i,e);e._inc=t}}F.prototype.item=function(e){V(this);return this[e]};n(F,$);function q(){}function H(e,t){var i=e.length;while(i--){if(e[i]===t){return i}}}function U(e,t,i,r){if(r){t[H(t,r)]=i}else{t[t.length++]=i}if(e){i.ownerElement=e;var n=e.ownerDocument;if(n){r&&Y(n,e,r);K(n,e,i)}}}function B(e,t,i){var r=H(t,i);if(r>=0){var n=t.length-1;while(r<n){t[r]=t[++r]}t.length=n;if(e){var o=e.ownerDocument;if(o){Y(o,e,i);i.ownerElement=null}}}else{throw k(A,new Error(e.tagName+"@"+i))}}q.prototype={length:0,item:$.prototype.item,getNamedItem:function(e){var t=this.length;while(t--){var i=this[t];if(i.nodeName==e){return i}}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement){throw new k(O)}var i=this.getNamedItem(e.nodeName);U(this._ownerElement,this,e,i);return i},setNamedItemNS:function(e){var t=e.ownerElement,i;if(t&&t!=this._ownerElement){throw new k(O)}i=this.getNamedItemNS(e.namespaceURI,e.localName);U(this._ownerElement,this,e,i);return i},removeNamedItem:function(e){var t=this.getNamedItem(e);B(this._ownerElement,this,t);return t},removeNamedItemNS:function(e,t){var i=this.getNamedItemNS(e,t);B(this._ownerElement,this,i);return i},getNamedItemNS:function(e,t){var i=this.length;while(i--){var r=this[i];if(r.localName==t&&r.namespaceURI==e){return r}}return null}};function z(e){this._features={};if(e){for(var t in e){this._features=e[t]}}}z.prototype={hasFeature:function(e,t){var i=this._features[e.toLowerCase()];if(i&&(!t||t in i)){return true}else{return false}},createDocument:function(e,t,i){var r=new Q;r.implementation=this;r.childNodes=new $;r.doctype=i;if(i){r.appendChild(i)}if(t){var n=r.createElementNS(e,t);r.appendChild(n)}return r},createDocumentType:function(e,t,i){var r=new se;r.name=e;r.nodeName=e;r.publicId=t;r.systemId=i;return r}};function j(){}j.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return Z(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t);if(t){this.removeChild(t)}},removeChild:function(e){return J(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(e){return ye(this.ownerDocument||this,this,e)},normalize:function(){var e=this.firstChild;while(e){var t=e.nextSibling;if(t&&t.nodeType==u&&e.nodeType==u){this.removeChild(t);e.appendData(t.data)}else{e.normalize();e=t}}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){var t=this;while(t){var i=t._nsMap;if(i){for(var r in i){if(i[r]==e){return r}}}t=t.nodeType==l?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){var t=this;while(t){var i=t._nsMap;if(i){if(e in i){return i[e]}}t=t.nodeType==l?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){var t=this.lookupPrefix(e);return t==null}};function G(e){return e=="<"&&"&lt;"||e==">"&&"&gt;"||e=="&"&&"&amp;"||e=='"'&&"&quot;"||"&#"+e.charCodeAt()+";"}r(a,j);r(a,j.prototype);function W(e,t){if(t(e)){return true}if(e=e.firstChild){do{if(W(e,t)){return true}}while(e=e.nextSibling)}}function Q(){}function K(e,t,i){e&&e._inc++;var r=i.namespaceURI;if(r=="http://www.w3.org/2000/xmlns/"){t._nsMap[i.prefix?i.localName:""]=i.value}}function Y(e,t,i,r){e&&e._inc++;var n=i.namespaceURI;if(n=="http://www.w3.org/2000/xmlns/"){delete t._nsMap[i.prefix?i.localName:""]}}function X(e,t,i){if(e&&e._inc){e._inc++;var r=t.childNodes;if(i){r[r.length++]=i}else{var n=t.firstChild;var o=0;while(n){r[o++]=n;n=n.nextSibling}r.length=o}}}function J(e,t){var i=t.previousSibling;var r=t.nextSibling;if(i){i.nextSibling=r}else{e.firstChild=r}if(r){r.previousSibling=i}else{e.lastChild=i}X(e.ownerDocument,e);return t}function Z(e,t,i){var r=t.parentNode;if(r){r.removeChild(t)}if(t.nodeType===v){var n=t.firstChild;if(n==null){return t}var o=t.lastChild}else{n=o=t}var a=i?i.previousSibling:e.lastChild;n.previousSibling=a;o.nextSibling=i;if(a){a.nextSibling=n}else{e.firstChild=n}if(i==null){e.lastChild=o}else{i.previousSibling=o}do{n.parentNode=e}while(n!==o&&(n=n.nextSibling));X(e.ownerDocument||e,e);if(t.nodeType==v){t.firstChild=t.lastChild=null}return t}function ee(e,t){var i=t.parentNode;if(i){var r=e.lastChild;i.removeChild(t);var r=e.lastChild}var r=e.lastChild;t.parentNode=e;t.previousSibling=r;t.nextSibling=null;if(r){r.nextSibling=t}else{e.firstChild=t}e.lastChild=t;X(e.ownerDocument,e,t);return t}Q.prototype={nodeName:"#document",nodeType:g,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==v){var i=e.firstChild;while(i){var r=i.nextSibling;this.insertBefore(i,t);i=r}return e}if(this.documentElement==null&&e.nodeType==s){this.documentElement=e}return Z(this,e,t),e.ownerDocument=this,e},removeChild:function(e){if(this.documentElement==e){this.documentElement=null}return J(this,e)},importNode:function(e,t){return ve(this,e,t)},getElementById:function(e){var t=null;W(this.documentElement,function(i){if(i.nodeType==s){if(i.getAttribute("id")==e){t=i;return true}}});return t},createElement:function(e){var t=new te;t.ownerDocument=this;t.nodeName=e;t.tagName=e;t.childNodes=new $;var i=t.attributes=new q;i._ownerElement=t;return t},createDocumentFragment:function(){var e=new de;e.ownerDocument=this;e.childNodes=new $;return e},createTextNode:function(e){var t=new ne;t.ownerDocument=this;t.appendData(e);return t},createComment:function(e){var t=new oe;t.ownerDocument=this;t.appendData(e);return t},createCDATASection:function(e){var t=new ae;t.ownerDocument=this;t.appendData(e);return t},createProcessingInstruction:function(e,t){var i=new pe;i.ownerDocument=this;i.tagName=i.target=e;i.nodeValue=i.data=t;return i},createAttribute:function(e){var t=new ie;t.ownerDocument=this;t.name=e;t.nodeName=e;t.localName=e;t.specified=true;return t},createEntityReference:function(e){var t=new ce;t.ownerDocument=this;t.nodeName=e;return t},createElementNS:function(e,t){var i=new te;var r=t.split(":");var n=i.attributes=new q;i.childNodes=new $;i.ownerDocument=this;i.nodeName=t;i.tagName=t;i.namespaceURI=e;if(r.length==2){i.prefix=r[0];i.localName=r[1]}else{i.localName=t}n._ownerElement=i;return i},createAttributeNS:function(e,t){var i=new ie;var r=t.split(":");i.ownerDocument=this;i.nodeName=t;i.name=t;i.namespaceURI=e;i.specified=true;if(r.length==2){i.prefix=r[0];i.localName=r[1]}else{i.localName=t}return i}};n(Q,j);function te(){this._nsMap={}}te.prototype={nodeType:s,hasAttribute:function(e){return this.getAttributeNode(e)!=null},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var i=this.ownerDocument.createAttribute(e);i.value=i.nodeValue=""+t;this.setAttributeNode(i)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){if(e.nodeType===v){return this.insertBefore(e,null)}else{return ee(this,e)}},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);i&&this.removeAttributeNode(i)},hasAttributeNS:function(e,t){return this.getAttributeNodeNS(e,t)!=null},getAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);return i&&i.value||""},setAttributeNS:function(e,t,i){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+i;this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new F(this,function(t){var i=[];W(t,function(r){if(r!==t&&r.nodeType==s&&(e==="*"||r.tagName==e)){i.push(r)}});return i})},getElementsByTagNameNS:function(e,t){return new F(this,function(i){var r=[];W(i,function(n){if(n!==i&&n.nodeType===s&&(e==="*"||n.namespaceURI===e)&&(t==="*"||n.localName==t)){r.push(n)}});return r})}};Q.prototype.getElementsByTagName=te.prototype.getElementsByTagName;Q.prototype.getElementsByTagNameNS=te.prototype.getElementsByTagNameNS;n(te,j);function ie(){}ie.prototype.nodeType=l;n(ie,j);function re(){}re.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e;this.nodeValue=this.data=e;this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(w[S])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,i){var r=this.data.substring(0,e);var n=this.data.substring(e+t);i=r+i+n;this.nodeValue=this.data=i;this.length=i.length}};n(re,j);function ne(){}ne.prototype={nodeName:"#text",nodeType:u,splitText:function(e){var t=this.data;var i=t.substring(e);t=t.substring(0,e);this.data=this.nodeValue=t;this.length=t.length;var r=this.ownerDocument.createTextNode(i);if(this.parentNode){this.parentNode.insertBefore(r,this.nextSibling)}return r}};n(ne,re);function oe(){}oe.prototype={nodeName:"#comment",nodeType:h};n(oe,re);function ae(){}ae.prototype={nodeName:"#cdata-section",nodeType:c};n(ae,re);function se(){}se.prototype.nodeType=m;n(se,j);function le(){}le.prototype.nodeType=y;n(le,j);function ue(){}ue.prototype.nodeType=p;n(ue,j);function ce(){}ce.prototype.nodeType=d;n(ce,j);function de(){}de.prototype.nodeName="#document-fragment";de.prototype.nodeType=v;n(de,j);function pe(){}pe.prototype.nodeType=f;n(pe,j);function fe(){}fe.prototype.serializeToString=function(e,t,i){return he.call(e,t,i)};j.prototype.toString=he;function he(e,t){var i=[];var r=this.nodeType==9?this.documentElement:this;var n=r.prefix;var o=r.namespaceURI;if(o&&n==null){var n=r.lookupPrefix(o);if(n==null){var a=[{namespace:o,prefix:null}]}}me(this,i,e,t,a);return i.join("")}function ge(e,t,i){var r=e.prefix||"";var n=e.namespaceURI;if(!r&&!n){return false}if(r==="xml"&&n==="http://www.w3.org/XML/1998/namespace"||n=="http://www.w3.org/2000/xmlns/"){return false}var o=i.length;while(o--){var a=i[o];if(a.prefix==r){return a.namespace!=n}}return true}function me(e,t,i,r,n){if(r){e=r(e);if(e){if(typeof e=="string"){t.push(e);return}}else{return}}switch(e.nodeType){case s:if(!n)n=[];var a=n.length;var p=e.attributes;var y=p.length;var b=e.firstChild;var w=e.tagName;i=o===e.namespaceURI||i;t.push("<",w);for(var C=0;C<y;C++){var E=p.item(C);if(E.prefix=="xmlns"){n.push({prefix:E.localName,namespace:E.value})}else if(E.nodeName=="xmlns"){n.push({prefix:"",namespace:E.value})}}for(var C=0;C<y;C++){var E=p.item(C);if(ge(E,i,n)){var S=E.prefix||"";var T=E.namespaceURI;var x=S?" xmlns:"+S:" xmlns";t.push(x,'="',T,'"');n.push({prefix:S,namespace:T})}me(E,t,i,r,n)}if(ge(e,i,n)){var S=e.prefix||"";var T=e.namespaceURI;var x=S?" xmlns:"+S:" xmlns";t.push(x,'="',T,'"');n.push({prefix:S,namespace:T})}if(b||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(w)){t.push(">");if(i&&/^script$/i.test(w)){while(b){if(b.data){t.push(b.data)}else{me(b,t,i,r,n)}b=b.nextSibling}}else{while(b){me(b,t,i,r,n);b=b.nextSibling}}t.push("</",w,">")}else{t.push("/>")}return;case g:case v:var b=e.firstChild;while(b){me(b,t,i,r,n);b=b.nextSibling}return;case l:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,G),'"');case u:return t.push(e.data.replace(/[<&]/g,G));case c:return t.push("<![CDATA[",e.data,"]]>");case h:return t.push("<!--",e.data,"-->");case m:var _=e.publicId;var M=e.systemId;t.push("<!DOCTYPE ",e.name);if(_){t.push(' PUBLIC "',_);if(M&&M!="."){t.push('" "',M)}t.push('">')}else if(M&&M!="."){t.push(' SYSTEM "',M,'">')}else{var A=e.internalSubset;if(A){t.push(" [",A,"]")}t.push(">")}return;case f:return t.push("<?",e.target," ",e.data,"?>");
case d:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ve(e,t,i){var r;switch(t.nodeType){case s:r=t.cloneNode(false);r.ownerDocument=e;case v:break;case l:i=true;break}if(!r){r=t.cloneNode(false)}r.ownerDocument=e;r.parentNode=null;if(i){var n=t.firstChild;while(n){r.appendChild(ve(e,n,i));n=n.nextSibling}}return r}function ye(e,t,i){var r=new t.constructor;for(var n in t){var o=t[n];if(typeof o!="object"){if(o!=r[n]){r[n]=o}}}if(t.childNodes){r.childNodes=new $}r.ownerDocument=e;switch(r.nodeType){case s:var a=t.attributes;var u=r.attributes=new q;var c=a.length;u._ownerElement=r;for(var d=0;d<c;d++){r.setAttributeNode(ye(e,a.item(d),true))}break;case l:i=true}if(i){var p=t.firstChild;while(p){r.appendChild(ye(e,p,i));p=p.nextSibling}}return r}function be(e,t,i){e[t]=i}try{if(Object.defineProperty){Object.defineProperty(F.prototype,"length",{get:function(){V(this);return this.$$length}});Object.defineProperty(j.prototype,"textContent",{get:function(){return we(this)},set:function(e){switch(this.nodeType){case s:case v:while(this.firstChild){this.removeChild(this.firstChild)}if(e||String(e)){this.appendChild(this.ownerDocument.createTextNode(e))}break;default:this.data=e;this.value=e;this.nodeValue=e}}});function we(e){switch(e.nodeType){case s:case v:var t=[];e=e.firstChild;while(e){if(e.nodeType!==7&&e.nodeType!==8){t.push(we(e))}e=e.nextSibling}return t.join("");default:return e.nodeValue}}be=function(e,t,i){e["$$"+t]=i}}}catch(e){}i.DOMImplementation=z;i.XMLSerializer=fe},{}],218:[function(e,t,i){var r=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;var n=new RegExp("[\\-\\.0-9"+r.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]");var o=new RegExp("^"+r.source+n.source+"*(?::"+r.source+n.source+"*)?$");var a=0;var s=1;var l=2;var u=3;var c=4;var d=5;var p=6;var f=7;function h(){}h.prototype={parse:function(e,t,i){var r=this.domBuilder;r.startDocument();C(t,t={});g(e,t,i,r,this.errorHandler);r.endDocument()}};function g(e,t,i,r,n){function o(e){if(e>65535){e-=65536;var t=55296+(e>>10),i=56320+(e&1023);return String.fromCharCode(t,i)}else{return String.fromCharCode(e)}}function a(e){var t=e.slice(1,-1);if(t in i){return i[t]}else if(t.charAt(0)==="#"){return o(parseInt(t.substr(1).replace("x","0x")))}else{n.error("entity not found:"+e);return e}}function s(t){if(t>g){var i=e.substring(g,t).replace(/&#?\w+;/g,a);p&&l(g);r.characters(i,0,t-g);g=t}}function l(t,i){while(t>=c&&(i=d.exec(e))){u=i.index;c=u+i[0].length;p.lineNumber++}p.columnNumber=t-u+1}var u=0;var c=0;var d=/.*(?:\r\n?|\n)|.*$/g;var p=r.locator;var f=[{currentNSMap:t}];var h={};var g=0;while(true){try{var C=e.indexOf("<",g);if(C<0){if(!e.substr(g).match(/^\s*$/)){var x=r.doc;var _=x.createTextNode(e.substr(g));x.appendChild(_);r.currentElement=_}return}if(C>g){s(C)}switch(e.charAt(C+1)){case"/":var M=e.indexOf(">",C+3);var A=e.substring(C+2,M);var I=f.pop();if(M<0){A=e.substring(C+2).replace(/[\s<].*/,"");n.error("end tag name: "+A+" is not complete:"+I.tagName);M=C+1+A.length}else if(A.match(/\s</)){A=A.replace(/[\s<].*/,"");n.error("end tag name: "+A+" maybe not complete");M=C+1+A.length}var O=I.localNSMap;var D=I.tagName==A;var N=D||I.tagName&&I.tagName.toLowerCase()==A.toLowerCase();if(N){r.endElement(I.uri,I.localName,A);if(O){for(var R in O){r.endPrefixMapping(R)}}if(!D){n.fatalError("end tag name: "+A+" is not match the current start tagName:"+I.tagName)}}else{f.push(I)}M++;break;case"?":p&&l(C);M=S(e,C,r);break;case"!":p&&l(C);M=E(e,C,r,n);break;default:p&&l(C);var P=new T;var L=f[f.length-1].currentNSMap;var M=v(e,C,P,L,a,n);var k=P.length;if(!P.closed&&w(e,M,P.tagName,h)){P.closed=true;if(!i.nbsp){n.warning("unclosed xml attribute")}}if(p&&k){var $=m(p,{});for(var F=0;F<k;F++){var V=P[F];l(V.offset);V.locator=m(p,{})}r.locator=$;if(y(P,r,L)){f.push(P)}r.locator=p}else{if(y(P,r,L)){f.push(P)}}if(P.uri==="http://www.w3.org/1999/xhtml"&&!P.closed){M=b(e,M,P.tagName,a,r)}else{M++}}}catch(e){n.error("element parse error: "+e);M=-1}if(M>g){g=M}else{s(Math.max(C,g)+1)}}}function m(e,t){t.lineNumber=e.lineNumber;t.columnNumber=e.columnNumber;return t}function v(e,t,i,r,n,o){var h;var g;var m=++t;var v=a;while(true){var y=e.charAt(m);switch(y){case"=":if(v===s){h=e.slice(t,m);v=u}else if(v===l){v=u}else{throw new Error("attribute equal must after attrName")}break;case"'":case'"':if(v===u||v===s){if(v===s){o.warning('attribute value must after "="');h=e.slice(t,m)}t=m+1;m=e.indexOf(y,t);if(m>0){g=e.slice(t,m).replace(/&#?\w+;/g,n);i.add(h,g,t-1);v=d}else{throw new Error("attribute value no end '"+y+"' match")}}else if(v==c){g=e.slice(t,m).replace(/&#?\w+;/g,n);i.add(h,g,t);o.warning('attribute "'+h+'" missed start quot('+y+")!!");t=m+1;v=d}else{throw new Error('attribute value must after "="')}break;case"/":switch(v){case a:i.setTagName(e.slice(t,m));case d:case p:case f:v=f;i.closed=true;case c:case s:case l:break;default:throw new Error("attribute invalid close char('/')")}break;case"":o.error("unexpected end of input");if(v==a){i.setTagName(e.slice(t,m))}return m;case">":switch(v){case a:i.setTagName(e.slice(t,m));case d:case p:case f:break;case c:case s:g=e.slice(t,m);if(g.slice(-1)==="/"){i.closed=true;g=g.slice(0,-1)}case l:if(v===l){g=h}if(v==c){o.warning('attribute "'+g+'" missed quot(")!!');i.add(h,g.replace(/&#?\w+;/g,n),t)}else{if(r[""]!=="http://www.w3.org/1999/xhtml"||!g.match(/^(?:disabled|checked|selected)$/i)){o.warning('attribute "'+g+'" missed value!! "'+g+'" instead!!')}i.add(g,g,t)}break;case u:throw new Error("attribute value missed!!")}return m;case"Â":y=" ";default:if(y<=" "){switch(v){case a:i.setTagName(e.slice(t,m));v=p;break;case s:h=e.slice(t,m);v=l;break;case c:var g=e.slice(t,m).replace(/&#?\w+;/g,n);o.warning('attribute "'+g+'" missed quot(")!!');i.add(h,g,t);case d:v=p;break}}else{switch(v){case l:var b=i.tagName;if(r[""]!=="http://www.w3.org/1999/xhtml"||!h.match(/^(?:disabled|checked|selected)$/i)){o.warning('attribute "'+h+'" missed value!! "'+h+'" instead2!!')}i.add(h,h,t);t=m;v=s;break;case d:o.warning('attribute space is required"'+h+'"!!');case p:v=s;t=m;break;case u:v=c;t=m;break;case f:throw new Error("elements closed character '/' and '>' must be connected to")}}}m++}}function y(e,t,i){var r=e.tagName;var n=null;var o=e.length;while(o--){var a=e[o];var s=a.qName;var l=a.value;var u=s.indexOf(":");if(u>0){var c=a.prefix=s.slice(0,u);var d=s.slice(u+1);var p=c==="xmlns"&&d}else{d=s;c=null;p=s==="xmlns"&&""}a.localName=d;if(p!==false){if(n==null){n={};C(i,i={})}i[p]=n[p]=l;a.uri="http://www.w3.org/2000/xmlns/";t.startPrefixMapping(p,l)}}var o=e.length;while(o--){a=e[o];var c=a.prefix;if(c){if(c==="xml"){a.uri="http://www.w3.org/XML/1998/namespace"}if(c!=="xmlns"){a.uri=i[c||""]}}}var u=r.indexOf(":");if(u>0){c=e.prefix=r.slice(0,u);d=e.localName=r.slice(u+1)}else{c=null;d=e.localName=r}var f=e.uri=i[c||""];t.startElement(f,d,r,e);if(e.closed){t.endElement(f,d,r);if(n){for(c in n){t.endPrefixMapping(c)}}}else{e.currentNSMap=i;e.localNSMap=n;return true}}function b(e,t,i,r,n){if(/^(?:script|textarea)$/i.test(i)){var o=e.indexOf("</"+i+">",t);var a=e.substring(t+1,o);if(/[&<]/.test(a)){if(/^script$/i.test(i)){n.characters(a,0,a.length);return o}a=a.replace(/&#?\w+;/g,r);n.characters(a,0,a.length);return o}}return t+1}function w(e,t,i,r){var n=r[i];if(n==null){n=e.lastIndexOf("</"+i+">");if(n<t){n=e.lastIndexOf("</"+i)}r[i]=n}return n<t}function C(e,t){for(var i in e){t[i]=e[i]}}function E(e,t,i,r){var n=e.charAt(t+2);switch(n){case"-":if(e.charAt(t+3)==="-"){var o=e.indexOf("-->",t+4);if(o>t){i.comment(e,t+4,o-t-4);return o+3}else{r.error("Unclosed comment");return-1}}else{return-1}default:if(e.substr(t+3,6)=="CDATA["){var o=e.indexOf("]]>",t+9);i.startCDATA();i.characters(e,t+9,o-t-9);i.endCDATA();return o+3}var a=_(e,t);var s=a.length;if(s>1&&/!doctype/i.test(a[0][0])){var l=a[1][0];var u=s>3&&/^public$/i.test(a[2][0])&&a[3][0];var c=s>4&&a[4][0];var d=a[s-1];i.startDTD(l,u&&u.replace(/^(['"])(.*?)\1$/,"$2"),c&&c.replace(/^(['"])(.*?)\1$/,"$2"));i.endDTD();return d.index+d[0].length}}return-1}function S(e,t,i){var r=e.indexOf("?>",t);if(r){var n=e.substring(t,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(n){var o=n[0].length;i.processingInstruction(n[1],n[2]);return r+2}else{return-1}}return-1}function T(e){}T.prototype={setTagName:function(e){if(!o.test(e)){throw new Error("invalid tagName:"+e)}this.tagName=e},add:function(e,t,i){if(!o.test(e)){throw new Error("invalid attribute:"+e)}this[this.length++]={qName:e,value:t,offset:i}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}};function x(e,t){e.__proto__=t;return e}if(!(x({},x.prototype)instanceof x)){x=function(e,t){function i(){}i.prototype=t;i=new i;for(t in e){i[t]=e[t]}return i}}function _(e,t){var i;var r=[];var n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;n.lastIndex=t;n.exec(e);while(i=n.exec(e)){r.push(i);if(i[1])return r}}i.XMLReader=h},{}],219:[function(e,t,i){"use strict";var r=e("assert");var n=e("../logicblox.core/network").HttpHelper;function o(e,t,i){r(e&&t,"Invalid arguments to ConnectBlox constructor: urls and workspace are required.");var o=i||new n,a=e.addBlockUrl,s=e.execBlockUrl,l=e.listPredicatesUrl,u=e.measureUrl,c=e.closeBranchUrl,d=e.createBranchUrl,p=e.replaceDefaultBranchUrl,f=t;this.addBlock=function(e){var t=JSON.stringify({add_block:{logic:e},workspace_name:f});return o.post(a,t)};this.execBlock=function(e){var t=JSON.stringify({execute:{logic:e},workspace_name:f});return o.post(s,t)};this.closeBranch=function(e,t){var i={request:{workspace:e,branch:t}};return o.post(c,i)};this.createBranch=function(e,t,i){var r={request:{workspace:e,branch:t,from_branch:i,overwrite:true}};return o.post(d,r)};this.replaceDefaultBranch=function(e,t){var i={request:{workspace:e,older_branch:t}};return o.post(p,i)};this.query=function(e){var t=JSON.stringify({execute:{logic:e,return_local:"_"},workspace_name:f});return o.post(s,t)};this.listPredicates=function(){return o.post(l,JSON.stringify({workspace_name:that.workspace}))};this.restartMeasure=function(){return this.execBlock('^measure:admin:allowed[] = "enabled".').then(function(){return o.post(u,{admin_request:{kind:"RESTART"}})})}}i.ConnectBlox=o},{"../logicblox.core/network":220,assert:2}],220:[function(e,t,i){"use strict";var r=e("assert");var n=e("superagent");var o=e("querystring");var a=e("../logicblox.pivot/event_emitter").EventEmitter;var s=e("lodash");function l(){this.request=n;if(typeof window==="undefined"){this.agent=n.agent()}}s.mixin(l.prototype,a.prototype);l.prototype.$send=function(e,t,r,n,a){var l=this,u,c,d=true,p=r&&r.headers;if(!s.isEmpty(p)){if(p.hasOwnProperty("Content-Type")&&p["Content-Type"]!=="application/json"){d=false}else{delete r.headers["Content-Type"]}if(p.hasOwnProperty("Accept")&&p.Accept!=="application/json"){d=false}else{delete r.headers.Accept}}if(d&&s.isString(n)){n=JSON.parse(n)}if(t==="GET"&&a){e=e+"?"+o.stringify(a)}c=new Promise(function(r,o){u=l.request(t,e);d&&u.set("Accept","application/json");if(!s.isEmpty(p)){for(var a in p){if(p.hasOwnProperty(a)){u.set(a,p[a])}}}n&&u.send(n);l.agent&&l.agent._attachCookies(u);u.end(i.$mkHandleResponse(e,t,r,o,l.agent));l._emit("REQUEST_SENT",{url:e,method:t,data:n})});if(u&&u.abort)c.abort=u.abort.bind(u);return c};i.$mkHandleResponse=function(e,t,i,r,n){return function(o,a){n&&n._saveCookies(a);function l(i){var r,n,o=i&&(i.body||i.text),a={statusCode:i.statusCode,statusMessage:i.statusMessage,url:i.url,method:i.method,responseText:i.responseText,body:o&&JSON.stringify(o)};n="NetworkError url: "+e+", method: "+t;s.map(a,function(e,t){if(e){n+=", "+t+": "+e}});r=new Error(n);r.response=i;r.body=o;return r}var u=a&&(a.body||a.text);if(o){if(a){r(l(a));return}r(o);return}if(a.statusCode===0||a.statusCode>=400){r(l(a));return}if(u&&(u.hasOwnProperty("error_code")||u.hasOwnProperty("problem")&&u.problem.filter(function(e){return e.severity==="ERROR"}).length>0)){r(l(a));return}i(u)}};l.prototype.post=function(e,t,i){r(e,"Must specify a url to post.");r(t,"Must specify data to post.");var n;i=i||{};n=this.$send(e,"POST",{headers:i},t);n.catch(this.handleAuthError.bind(this));return n};l.prototype.put=function(e,t,i){r(e,"Must specify a url to put.");r(t,"Must specify data to put.");var n;i=i||{};n=this.$send(e,"PUT",{headers:i},t);n.catch(this.handleAuthError.bind(this));return n};l.prototype.get=function(e,t,i){r(e,"Must specify a url to get.");var n;t=t||{};n=this.$send(e,"GET",{headers:t},null,i);n.catch(this.handleAuthError.bind(this));return n};l.prototype.handleAuthError=function(e){if(e.response&&e.response.statusCode>400){if(e.response.statusCode===401){this._emit("AUTHENTICATION_FAILURE",e)}if(e.response.statusCode===403){this._emit("AUTHORIZATION_FAILURE",e)}}};l.prototype.login=function(e,t,i,r){return this.post(e,{username:t,password:i,realm:r})};l.prototype.logout=function(e,t,i){return this.post(e,{username:t,realm:i,logout:true})};l.prototype.getCurrentUser=function(e){return this.post(e,{}).then(function(e){return e.username})};i.HttpHelper=l},{"../logicblox.pivot/event_emitter":289,assert:2,lodash:70,querystring:"querystring",superagent:198}],221:[function(e,t,i){"use strict";var r=e("lodash");var n=e("../logicblox.pivot/event_emitter").EventEmitter;function o(e){return e}function a(e,t){this.$toUrl=e||o;this.$fromUrl=t||o;this.$listeners={hashchange:this.$onUrlChange.bind(this)};this.$addHashListener()}r.mixin(a.prototype,n.prototype);a.prototype.toUrl=function(e){return this.$toUrl(e)};a.prototype.fromUrl=function(e){return this.$fromUrl(e)};a.prototype.$onUrlChange=function(){this._emit("hashchange",{url:this.fromUrl(location.hash.replace(/^#/,"")),location:location})};a.prototype.$addHashListener=function(){window.addEventListener("hashchange",this.$listeners.hashchange)};a.prototype.$removeHashListener=function(){window.removeEventListener("hashchange",this.$listeners.hashchange)};i.Router=a},{"../logicblox.pivot/event_emitter":289,lodash:70}],222:[function(e,t,i){"use strict";var r=e("inherits");var n=e("../constant").ACTIONS.ActionActions;var o=e("../util/servicecaller");var a=e("../dao/actionsdao");var s=e("./actionhandler");var l=e("lodash");var u=e("assert");r(c,s);function c(e,t,i,r,n,l){s.call(this,e);this.$serviceCaller=new o(t);this.$actionsDAO=new a(t);this.$actionStore=l.actionStore;this.$logActionHandler=l.logActionHandler;this.$pivotDataActionHandler=l.pivotDataActionHandler;this.$afterAction=n;if(i){this.$getServiceUrl=i}else{throw new Error("ActionHandler does not have a service url")}if(r){this.$getActionMessage=r}}c.prototype.destroy=function(){this.$serviceCaller=null;this.$actionsDAO=null;this.$actionStore=null;this.$logActionHandler=null;this.$pivotDataActionHandler=null;this.$afterAction=null;this.$getServiceUrl=null;this.$getActionMessage=null};c.prototype.$getAction=function(e){var t,i=this;if(l.isString(e)){var r=e;t=this.$actionStore.getAction(r);if(t){return Promise.resolve(t)}else{return this.loadActions().then(function(){return i.$actionStore.getAction(r)})}}else{t=e;return Promise.resolve(t)}};c.prototype.callAction=function(e){var t=this,i=this.$afterAction,r=this.$getServiceUrl,o;var a=this.$getAction(e).then(function(a){u(!l.isUndefined(a),"Action with id: "+e+" could not be found.");var s=a.id,c=a.links&&a.links.execute,d=c&&r(c),p=t.$getActionMessage(a.message||{},c);u(d,"Action "+s+" does not have an execution url");return t.execute({fn:function(){var e=t.$serviceCaller.callService(d,{message:p});e.then(function(e){o=e;if(i){i(a,e,r)}}).catch(function(e){console.error("Error running function after action ",s);console.error(e.stack)});return e},startAction:{actionType:n.START_ACTION,actionId:s},successAction:{actionType:n.SUCCEED_ACTION,actionId:s},failAction:{actionType:n.FAIL_ACTION,actionId:s}}).then(t.loadActions.bind(t)).then(function(){return o})});a.catch(t.$logError.bind(t));return a};c.prototype.$logError=function(e){this.$logActionHandler.error({message:typeof e==="string"?e:JSON.stringify(e)})};c.prototype.markActionStarted=function(e){return this.dispatchPayload({actionType:n.START_ACTION,actionId:e})};c.prototype.markActionSucceeded=function(e,t){return this.dispatchPayload({actionType:n.SUCCEED_ACTION,actionId:e,sendQuery:t})};c.prototype.markActionFailed=function(e){return this.dispatchPayload({actionType:n.FAIL_ACTION,actionId:e})};c.prototype.loadActions=function(){var e=this,t=this.$actionsDAO;return e.execute({fn:t.getActions(),successAction:{actionType:n.LOAD_ACTIONS},successCallback:function(e){var t={};e.forEach(function(e){t[e.id]=e});return{actionConfigs:t}}})};c.prototype.clearStatus=function(e){return this.dispatchPayload({actionType:n.CLEAR_STATUS,actionId:e})};c.prototype.$getServiceUrl=l.identity;t.exports=c},{"../constant":256,"../dao/actionsdao":277,"../util/servicecaller":365,"./actionhandler":223,assert:2,inherits:41,lodash:70}],223:[function(e,t,i){"use strict";var r=e("../promisebuilder");var n=e("lodash");function o(e){this.$dispatcher=e}o.prototype.dispatchPayload=function(e){return r.do(this.$dispatcher.handleViewAction(e)).build()};o.prototype.execute=function(e){var t=this,i=e.fn||function(){},o=e.startAction,a=e.successAction,s=e.successCallback,l=e.failAction,u=e.logError;var c=function(){if(o){t.dispatchPayload(o)}};var d=function(e){if(s){e=s(e)}if(a){n.extend(a,e);t.dispatchPayload(a)}};var p=function(e){if(l){n.extend(l,{error:e});t.dispatchPayload(l)}};return r.do(c,u).thenDo(i,u).onSuccess(d).onFailure(p).build()};t.exports=o},{"../promisebuilder":331,lodash:70}],224:[function(e,t,i){"use strict";var r=e("lodash");var n=e("inherits");var o=e("./actionhandler");var a=e("../dao/collaborationdao");var s=e("../constant").Collaboration.ACTIONS;var l=e("../constant").ACTIONS.STATES;var u=e("../constant").UserActivity;var c=u.USER_ACTIVITY_STATUS;var d=u.LOCAL_STORAGE_PROPERTY;n(p,o);function p(e,t,i,n){var o=this,s=n.modelerOptionStore.getMinUpdateInterval(),l=n.modelerOptionStore.getMaxUpdateInterval();this.$updateInterval=(Math.random()*(l-s)+s)*1e3;this.$multiAxisDataActionHandler=n.multiAxisDataActionHandler;this.$actionsActionHandler=n.actionsActionHandler;this.$notificationsActionHandler=n.notificationsActionHandler;this.$userStore=n.userStore;this.updateDataWithDelay=r.throttle(function(){var e=localStorage.getItem(d);if(e===c.ACTIVE){return o.$multiAxisDataActionHandler.markAllDataDirty()}},this.$updateInterval,{leading:false,trailing:true});this.loadActionsWithDelay=r.throttle(function(){return o.$actionsActionHandler.loadActions()},this.$updateInterval,{leading:false,trailing:true});this.$dispatcher=e;this.$webSocketDriver=t;this.$collaborationDAO=new a(t,i,{onOpenConnection:this.receiveOpenConnection.bind(this),onCloseConnection:this.receiveCloseConnection.bind(this),onFullUserList:this.receiveFullUserList.bind(this),onPeerOpenConnection:this.receivePeerOpenConnection.bind(this),onPeerCloseConnection:this.receivePeerCloseConnection.bind(this),onDataUpdated:this.updateDataWithDelay.bind(this),onActionStateChanged:this.changeActionState.bind(this)})}p.prototype.$sendMessageViaWebsocket=function(e){if(!r.isUndefined(this.$webSocketDriver)&&this.$webSocketDriver.isConnected()){this.$webSocketDriver.getWebSocket().send(JSON.stringify(e))}};p.prototype.broadcastEditsWereMade=function(){var e={msg:{messageType:s.BROADCAST_EDITS_WERE_MADE}};this.$sendMessageViaWebsocket(e)};p.prototype.changeActionState=function(e){var t=e.msg.actionState,i=e.msg.actionId,n=e.msg.actionLabel,o=e.username,a=localStorage.getItem(d),s=this,u=a===c.ACTIVE;switch(t){case l.STARTED:return Promise.all([this.$actionsActionHandler.markActionStarted(i),this.$notificationsActionHandler.info("User '"+o+"' has called an action '"+n+"'.")]);case l.SUCCEEDED:s.updateDataWithDelay();s.loadActionsWithDelay();return new Promise(function(e){r.delay(function(){s.$actionsActionHandler.markActionSucceeded(i,u).then(e)},s.$updateInterval)});case l.FAILED:return this.$actionsActionHandler.markActionFailed(i);default:return Promise.resolve()}};p.prototype.broadcastActionChangedState=function(e,t,i){var r={msg:{messageType:s.BROADCAST_ACTION_CHANGED_STATE,actionId:e,actionLabel:t,actionState:i}};this.$sendMessageViaWebsocket(r)};p.prototype.receiveOpenConnection=function(){return this.$dispatcher.handleViewAction({actionType:s.UPDATE_CURRENT_SOCKET,isConnection:true})};p.prototype.receiveCloseConnection=function(){return this.$dispatcher.handleViewAction({actionType:s.UPDATE_CURRENT_SOCKET,isConnection:false})};p.prototype.receiveFullUserList=function(e){return this.$dispatcher.handleViewAction({actionType:s.UPDATE_SOCKET_LIST,sockets:e.peers,usersInfo:r.uniq(r.map(e.peers,"username")),currentUser:this.$userStore.getCurrentUserName()})};p.prototype.receivePeerOpenConnection=function(e){return this.$dispatcher.handleViewAction({actionType:s.UPDATE_USER_STATUS,socket:e.id,user:e.username,isConnection:true})};p.prototype.receivePeerCloseConnection=function(e){return this.$dispatcher.handleViewAction({actionType:s.UPDATE_USER_STATUS,socket:e.id,user:e.username,isConnection:false})};t.exports=p},{"../constant":256,"../dao/collaborationdao":278,"./actionhandler":223,inherits:41,lodash:70}],225:[function(e,t,i){"use strict";var r=e("inherits");var n=e("./actionhandler");var o=e("../constant").DND.ACTIONS;r(a,n);function a(e){n.call(this,e);return this}a.prototype.startDrag=function(e,t){return this.dispatchPayload({actionType:o.DRAG,type:e,dragData:t})};a.prototype.stopDrag=function(){return this.dispatchPayload({actionType:o.DRAGEND})};a.prototype.dragOver=function(e,t){return this.dispatchPayload({actionType:o.DRAGOVER,type:e,dragOverData:t})};a.prototype.drop=function(e,t){return this.dispatchPayload({actionType:o.DROP,type:e,dropData:t})};t.exports=a},{"../constant":256,"./actionhandler":223,inherits:41}],226:[function(e,t,i){"use strict";var r=e("../store/logstore").LogActions;function n(e){this.$dispatcher=e}n.prototype.error=function(e){return this.$dispatcher.handleViewAction({actionType:r.POST_ERROR,error:e})};n.prototype.warn=function(e,t,i){return this.$dispatcher.handleViewAction({actionType:r.POST_WARN,warningEvent:e,message:t,errorObject:i})};t.exports=n},{"../store/logstore":342}],227:[function(e,t,i){"use strict";var r=e("../store/measurelanguagestore").Actions;var n=e("../dao/measurelanguagedao").MeasureLanguageDAO;var o=e("../measurelanguage");function a(e,t,i){this.dispatcher=e;this.$measureLanguageDAO=new n(t);this.$measureLanguageStore=i}a.prototype.loadRules=function(){var e=this;return e.$measureLanguageDAO.fetchRules().then(function(t){return e.dispatcher.handleViewAction({actionType:r.LOAD_RULES,rules:t})})};a.prototype.installMeasureRule=function(e,t,i){var n=this.$measureLanguageDAO,a=this.dispatcher,s=this.loadRules.bind(this),l=this.clearAllEdits.bind(this,e),u=o.RuleBuilder.newBuilder().setPrimaryFormula(t).setInverseFormulas(i),c=u.getRuleId();return this.setRuleId(e,c).then(n.installRules.bind(n,u.build())).then(function e(){return s().then(l)},function t(i){a.handleViewAction({actionType:r.RULE_INSTALL_ERROR,ruleEditorId:e,message:i.message});throw i})};a.prototype.addRuleEditor=function(e,t){var i=this.dispatcher;return i.handleViewAction({actionType:r.ADD_RULE_EDITOR,ruleEditorId:e,ruleId:t})};a.prototype.enterEditMode=function(e,t){var i=this.dispatcher;return i.handleViewAction({actionType:r.ENTER_EDIT_MODE,ruleEditorId:e,inverseEditorId:t})};a.prototype.setRuleId=function(e,t){var i=this.dispatcher;return i.handleViewAction({actionType:r.SET_RULE_ID,ruleEditorId:e,ruleId:t})};a.prototype.clearAllEdits=function(e){var t=this.dispatcher;return t.handleViewAction({actionType:r.CLEAR_ALL_EDITS,ruleEditorId:e})};a.prototype.clearInverseFormulaEdits=function(e,t){var i=this.dispatcher;return i.handleViewAction({actionType:r.CLEAR_INVERSE_FORMULA_EDITS,ruleEditorId:e,inverseEditorId:t})};a.prototype.addInverseEditor=function(e){var t=this.dispatcher;return t.handleViewAction({actionType:r.ADD_INVERSE_EDITOR,ruleEditorId:e})};a.prototype.removeInverseEditor=function(e,t){var i=this.dispatcher;return i.handleViewAction({actionType:r.REMOVE_INVERSE_EDITOR,ruleEditorId:e,editorId:t})};a.prototype.editPrimaryFormula=function(e,t){var i=this.dispatcher;return i.handleViewAction({actionType:r.EDIT_PRIMARY_FORMULA,ruleEditorId:e,value:t})};a.prototype.editInverseFormula=function(e,t,i){var n=this.dispatcher;return n.handleViewAction({actionType:r.EDIT_INVERSE_FORMULA,ruleEditorId:e,inverseEditorId:t,value:i})};t.exports=a},{"../dao/measurelanguagedao":280,"../measurelanguage":302,"../store/measurelanguagestore":343}],228:[function(e,t,i){"use strict";var r=e("../util");var n=e("lodash");var o=e("./actionhandler");var a=e("inherits");var s=e("../promisebuilder");var l=e("../util/promisecache");var u=e("../measureservice-metamodel").MeasureServiceMetaModel;var c=e("../store/measuremodelstore").MeasureModelActions;var d=e("../dao/measuremodeldao").MeasureModelDAO;a(p,o);function p(e,t,i){o.call(this,e);this.$measureServiceMetaModelDAO=new u(t.connectblox);this.$measureModelDAO=new d(t);this.$connectblox=t.connectblox;this.$measureModelStore=i;this.$promiseCache=new l}p.prototype.destroy=function(){this.$measureServiceMetaModelDAO=null;this.$measureModelDAO=null;this.$connectblox=null;this.$measureModelStore=null;this.$promiseCache=null};p.prototype.$dispatchModel=function(e,t){return this.dispatchPayload({actionType:c.SET_MODEL,model:e,renaming:t})};p.prototype.$fetchModel=function(){var e=this;return e.$promiseCache.concurrentPromise("measure-model",function(){return e.$measureModelDAO.fetchModel()})};p.prototype.$setModel=function(e){return this.dispatchPayload({actionType:c.SET_MODEL,model:e})};p.prototype.loadModel=function(e,t){var i=this,r=new s;if(!i.$measureModelStore.getModel()||t)r=s.do(i.$fetchModel()).thenDo(function(t){return i.$dispatchModel(t,e)});return r.build()};p.prototype.updateModel=function(e){var t=this;return s.do(function(){return t.$connectblox.restartMeasure()}).thenDo(function(){return t.loadModel(e,true)}).build()};p.prototype.getModel=function(e){var t=this;if(!t.$measureModelStore.getModel()){return t.loadModel(undefined,e).then(function(){return t.$measureModelStore.getModel()})}else{return Promise.resolve(t.$measureModelStore.getModel())}};p.prototype.addLevel=function(e){var t=this;this.dispatchPayload({actionType:c.EDIT_MODEL,levelName:e});return s.do(t.$measureServiceMetaModelDAO.addLevel(e)).thenDo(function(){return t.updateModel()}).onFailure(function(i){t.dispatchPayload({actionType:c.ADD_LEVEL_ERROR,levelName:e,error:i})}).build()};p.prototype.addParentLevel=function(e,t,i,r,n){var o=this;o.dispatchPayload({actionType:c.EDIT_MODEL,levelName:e});return s.do(o.$measureServiceMetaModelDAO.addParentLevel(e,t,i,r,n)).thenDo(function(){var e={dimensionRename:{}};e.dimensionRename[t]=n;return o.updateModel(e)}).onFailure(function(t){o.dispatchPayload({actionType:c.ADD_LEVEL_ERROR,levelName:e,error:t})}).build()};p.prototype.addMetric=function(e,t){var i=this;i.dispatchPayload({actionType:c.EDIT_MODEL,metricName:e});return s.do(this.loadModel()).thenDo(function(){var r=n.values(i.$measureModelStore.getModel().allDimensions);return i.$measureServiceMetaModelDAO.addMetric(e,t,r).then(i.updateModel.bind(i))}).build()};p.prototype.renameMetric=function(e,t){var i=this;i.dispatchPayload({actionType:c.EDIT_MODEL,metricName:e});return s.do(i.loadModel()).thenDo(function(){var r={metricRename:{}};r.metricRename[e]=t;return i.$measureServiceMetaModelDAO.renameMetric(e,t).then(function(){return i.updateModel(r)})}).build()};p.prototype.setMeasureProperties=function(e,t,i){r.type.assertArgs(arguments,["string","string","string"]);var n=this;if(i!==t){return s.do(n.$measureModelDAO.setMeasureProperties(e,t,i)).thenDo(function(){return n.updateModel()}).onFailure(function(){n.dispatchPayload({actionType:c.SET_MEASURE_PROPERTIES_ERROR})}).build()}else{return Promise.resolve()}};t.exports=p},{"../dao/measuremodeldao":281,"../measureservice-metamodel":304,"../promisebuilder":331,"../store/measuremodelstore":344,"../util":357,"../util/promisecache":364,"./actionhandler":223,inherits:41,lodash:70}],229:[function(e,t,i){"use strict";var r=e("./actionhandler");var n=e("../constant");var o=n.ModalWindowActions;var a=n.ModalWindows.Types;var s=e("inherits");s(l,r);function l(e){r.call(this,e)}l.prototype.confirm=function(e,t){var i=this,r;return new Promise(function(n,o){r={resolve:n,reject:o,text:e,title:t};return i.openWindow(a.CONFIRMATION_DIALOG,r)})};l.prototype.openWindow=function(e,t){return this.dispatchPayload({actionType:o.OPEN_WINDOW,windowType:e,options:t})};l.prototype.closeWindow=function(e,t){return this.dispatchPayload({actionType:o.CLOSE_WINDOW,windowType:e,windowId:t})};t.exports=l},{"../constant":256,"./actionhandler":223,inherits:41}],230:[function(e,t,i){"use strict";var r=e("../util");var n=e("lodash");var o=e("../cubiql");var a=e("./actionhandler");var s=e("inherits");var l=e("../dao/measureservicedao");var u=e("../querygen/util");var c=e("../querygen/query");var d=e("../querygen/results");var p=e("../pivotconfig_helper");var f=e("../modelerstate");var h=e("../constant").CANVAS;var g=e("../constant").ModalWindows.Types;var m=e("../constant").ACTIONS.STATES;var v=e("../formatter");s(b,a);function y(e){return n.bindAll(e,n.functionsIn(e))}function b(e,t,i){this.$measureModelActionHandler=y(t.measureModelActionHandler);this.$multiAxisConfigActionHandler=t.multiAxisConfigActionHandler;this.$multiAxisDataActionHandler=t.multiAxisDataActionHandler;this.$collaborationActionHandler=t.collaborationActionHandler;this.$measureModelStore=t.measureModelStore;this.$pivotConfigStore=t.pivotConfigStore;this.$multiAxisConfigStore=y(t.multiAxisConfigStore);this.$fieldStore=y(t.fieldStore);this.$canvasStore=y(t.canvasStore);this.$canvasActionHandler=y(t.canvasActionHandler);this.$canvasConfigActionHandler=y(t.canvasConfigActionHandler);this.$canvasConfigStore=y(t.canvasConfigStore);this.$measureLanguageActionHandler=y(t.measureLanguageActionHandler);this.$measureLanguageStore=y(t.measureLanguageStore);this.$pivotConfigActionHandler=y(t.pivotConfigActionHandler);this.$actionsActionHandler=y(t.actionsActionHandler);this.$gridOptionActionHandler=t.gridOptionActionHandler;this.$dragAndDropStore=y(t.dragAndDropStore);this.$dragAndDropActionHandler=y(t.dragAndDropActionHandler);this.$sheetStore=y(t.sheetStore);this.$multiAxisDataStore=t.multiAxisDataStore;this.$modalWindowsActionHandler=t.modalWindowsActionHandler;this.$modelerWebSocket=t.modelerWebSocket;this.$notificationsActionHandler=t.notificationsActionHandler;this.$modelerOptionStore=t.modelerOptionStore;this.$viewActionHandler=t.viewActionHandler;this.$viewConfigStore=t.viewConfigStore;this.$viewConfigActionHandler=t.viewConfigActionHandler;this.$modelerApp=t.modelerApp;this.$measureServiceDAO=new l(i);this.$canvasInitPromises={};a.call(this,e)}b.prototype.exportToCsv=function(e){var t=this.$measureModelStore.getModel(),i=this.$pivotStore.getQueryOptions(e);return this.$createCsvFromOptions(i,t).then(r.timedFn("Dumping CSV to file",function(e){var t=new Blob([e],{type:"text/csv"}),i=URL.createObjectURL(t),r=document.createElement("a");r.style.display="none";document.body.appendChild(r);r.setAttribute("href",i);r.setAttribute("download","export.csv");r.click();setTimeout(function(){URL.revokeObjectURL(i)});document.body.removeChild(r)}))};b.prototype.createCsvFromMAConfig=function(e,t){var i=this,a=pivothelper.pivotOptionsToPivotDef(pivotOptions,t,this.$pivotConfigStore);var s=pivothelper.pivotDefToMeasureQueries(a,pivothelper.PivotQueryMode.EXPORT,t),l=c.measureQueriesToServiceQueries(s,t),p=c.serviceQueriesToServiceRequest(l,t);var f=r.timedPromise("CSV Export Request",this.$measureServiceDAO.send(p.request)).then(r.timedFn("Convert Export to CSV",function(e){
u.checkServiceResponse(p.request,e);var t=s.map(function(t){return p.responseProcessor.getMeasureQueryAsTable(t,e,true)}),r="",l,f,h,g={};function m(e){var t=c.getCoreMeasure(e.measure),r,n,o,a,l,d=["INT","DECIMAL","FLOAT"].indexOf(u.getMeasureValueType(e.measure,y))===-1;if(t&&t instanceof c.Metric){r=t.name;n=i.$pivotConfigStore.getMetricConfig(r);o=u.getMeasureValueType(s[A].measure,y);a=v.getFormatter(n&&n.format,r,o);l=a&&a.format}return function(e){var t=l?l(e):e;return d?'"'+t+'"':t}}if(t.length){var y=a.measureModel,b=s[s.length-1],w=b.measure instanceof c.ConstantTerm&&t[t.length-1],C=[].concat(b.mappedInter.qualified_level.map(function(e){return s.findIndex(function(t){return t.measure.qualifiedLevel&&o.qLevelEqual(t.measure.qualifiedLevel,e)})}),w?[t.length-1]:[]),E=d.unionResultTables(t,[],C),S,T=b.mappedInter.qualified_level.length,x=T+t.length-(w?2:1),_=0,M;for(var A=0;A<s.length;++A){g[A]=m(s[A])}r=n.compact(s.map(function(e,i){if(!w||i<t.length-1){return'"'+u.makeCaptionForMeasure(e.measure,y)+'"'}})).join(",")+"\n";for(;_<E.dataTable.length;_++){S=E.dataTable[_];for(M=T;M<=x;M++){if(n.isUndefined(S[M])){r+=""}else{l=g[M-T](S[M]);if(l){l=l.toString();h=l.startsWith('"')&&l.endsWith('"');f=!h&&csvEscapedRegex.test(l);if(f){l='"'+l+'"'}}r+=l}if(M<x){r+=","}}if(_<E.dataTable.length-1){r+="\n"}}if(t.length!==1){console.warn("Export query should produce exactly one table!")}}return r}));f.catch(r.logError);return f};b.prototype.loadPivotState=function e(t,i){var r=this;return this.$measureModelActionHandler.getModel().then(function(){var e=f.createModelerState(r.$modelerApp),n=p.pivotConfigToMultiAxisConfig(e,t,i);n=n.set("queryLevelFilterFlag",true);return r.setViewTaskConfig(t,"main",{maConfig:n,isUnmasked:false})})};function w(e){var t=[];Object.keys(e.views).forEach(function(i){var r=e.views[i];if(r.config&&r.config.pivotConfig){t.push(r.config.pivotConfig)}if(r.module===h.MODULES.CANVAS)t.concat(C(r.config))});return t}function C(e){return n.flatten(w(e))}b.prototype.initializeModeler=function(){var e=this.$modelerOptionStore,t=[this.$measureModelActionHandler.loadModel(),this.$pivotConfigActionHandler.loadConfig(),this.$actionsActionHandler.loadActions(),this.$viewConfigActionHandler.loadAllViews()],i,n=this;if(e.canEditRules()){t.push(this.$measureLanguageActionHandler.loadRules().catch(r.logError))}i=Promise.all(t);if(typeof window!=="undefined"){i.then(function(){n.$modelerWebSocket.restart()}).catch(r.logError)}return i};b.prototype.setViewTaskConfig=function(e,t,i){return this.$multiAxisConfigActionHandler.setViewTaskConfig(e,t,i)},b.prototype.callAction=function(e,t){var i=this,n,o,a;o=this.$multiAxisDataActionHandler.promptForUnsavedChanges().then(this.$actionsActionHandler.$getAction.bind(this.$actionsActionHandler,e));o.then(function(e){return i.$collaborationActionHandler.broadcastActionChangedState(e.id,t,m.STARTED)}).catch(r.logError);a=o.then(function(t){n=t;return i.$actionsActionHandler.callAction(e)});a.then(function(){return i.$multiAxisDataActionHandler.markAllDataDirty()});a.then(function(){i.$collaborationActionHandler.broadcastActionChangedState(n.id,t,m.SUCCEEDED)}).catch(function(e){i.$collaborationActionHandler.broadcastActionChangedState(n.id,t,m.FAILED);r.logError(e)});return a};b.prototype.clearUserRelatedStores=function(){return Promise.resolve(this.$viewConfigStore.clear())};b.prototype.reviewPendingEdits=function(){return this.$modalWindowsActionHandler.openWindow(g.REVIEW_EDITS_DIALOG)};b.prototype.reviewLocks=function(){return this.$modalWindowsActionHandler.openWindow(g.REVIEW_LOCKS_DIALOG)};b.prototype.notifyUserAboutLogout=function(e){return this.$modalWindowsActionHandler.openWindow(g.LOGOUT_NOTIFICATION_DIALOG,e)};b.prototype.navigateIfAllowed=function(e){return this.$multiAxisDataActionHandler.promptForUnsavedChanges().then(function(){location.hash=e})};b.prototype.sendEdits=function(e){return this.$multiAxisDataActionHandler.sendEdits(e).then(this.$collaborationActionHandler.broadcastEditsWereMade.bind(this.$collaborationActionHandler))};b.prototype.installMeasureRule=function(e,t,i,r){var n=this.$measureLanguageActionHandler,o=this.$multiAxisDataActionHandler,a=this.$pivotStore,s=this.$measureLanguageStore,l=this.moveField.bind(this),u=this.$notificationsActionHandler;return n.installMeasureRule(t,i,r).then(function t(){return o.markAllDataDirty().then(function(){var t=s.getRulesWithEditors();return Promise.all(t.map(function(t){var i=a.getFieldsIn(e,"z")[0];if(a.indexInAxis(e,t,"z")===-1){return l(e,t,"z",i&&i.name)}else return Promise.resolve()}))})},function e(t){return u.error(t.message,"Error",{},{autoDismiss:5})})};t.exports=b},{"../constant":256,"../cubiql":276,"../dao/measureservicedao":282,"../formatter":293,"../modelerstate":313,"../pivotconfig_helper":330,"../querygen/query":333,"../querygen/results":334,"../querygen/util":336,"../util":357,"./actionhandler":223,inherits:41,lodash:70}],231:[function(e,t,i){"use strict";var r=e("../store/multiaxisconfigstore").MultiAxisConfigActions;var n=e("./actionhandler");var o=e("inherits");o(a,n);function a(e,t){n.call(this,e)}a.prototype.setViewTaskConfig=function(e,t,i){return this.dispatchPayload({actionType:r.SET_VIEW_TASK_CONFIG,viewId:e,taskName:t,config:i})};a.prototype.setViewInactive=function(e){return this.dispatchPayload({actionType:r.SET_VIEW_INACTIVE,viewId:e})};a.prototype.setViewTaskActive=function(e,t){return this.dispatchPayload({actionType:r.SET_VIEW_TASK_ACTIVE,viewId:e,taskName:t})};a.prototype.setViewTaskInactive=function(e,t){return this.dispatchPayload({actionType:r.SET_VIEW_TASK_INACTIVE,viewId:e,taskName:t})};t.exports=a},{"../store/multiaxisconfigstore":347,"./actionhandler":223,inherits:41}],232:[function(e,t,i){"use strict";var r=e("../store/multiaxisdatastore");var n=r.MultiAxisDataActions;var o=e("./actionhandler");var a=e("inherits");var s=e("assert");var l=e("../util");var u=e("../dao/measureservicedao");var c=e("../store/logstore").LogEvents;var d=e("../constant/messages");var p=e("../multiaxis/updategenerator");var f=e("../querygen/query");var h=e("measure-query-gen/src/MQG");var g=e("../constant");a(m,o);function m(e,t,i){o.call(this,e);this.$madStore=i.multiAxisDataStore;this.$pivotConfigStore=i.pivotConfigStore;this.$measureModelStore=i.measureModelStore;this.$logActionHandler=i.logActionHandler;this.$notificationsActionHandler=i.notificationsActionHandler;this.$measureServiceDAO=new u(t);this.$modalWindowsActionHandler=i.modalWindowsActionHandler;this.$dispatcher=e}m.prototype.setViewTaskRange=function(e,t,i){return this.$dispatcher.handleViewAction({actionType:n.SET_VIEW_TASK_RANGE,viewId:e,taskName:t,range:i})};m.prototype.requestQuery=function(e,t){return this.$dispatcher.handleViewAction({actionType:n.REQUEST_QUERY,query:e,positions:t})};m.prototype.storePendingEditForSlice=function(e,t,i){var r=this.$madStore.getMeasureQueryForFieldSliceValue(e,i),o=f.getCoreMeasure(r.measure),a;s(o instanceof f.Attribute,"Core slice measure should be an attribute!");a=this.$madStore.getPivotDef(e).getSelectedSliceMetricQuery(o.qualifiedLevel);return this.dispatchPayload({actionType:n.STORE_PENDING_EDIT,query:r,metricQuery:a,position:{},edit:{data:t},editedMetricInters:[new h.MetricInter(a.measure.name,a.inter)]})};m.prototype.storePendingEdits=function(e){var t=this;return t.dispatchPayload({actionType:n.STORE_PENDING_EDITS,edits:e.map(function(e){return{editConfig:e.cellInfo.editConfigs[e.editConfigName],positionInfo:e.cellInfo.positionInfo,edit:e.edit}})})};m.prototype.commitPendingEdits=function(){var e=this.$madStore.getAllPendingEdits();return this.dispatchPayload({actionType:n.MARK_EDITS_FOR_COMMIT,edits:e})};m.prototype.sendEdits=function(e){var t=this,i=this.$measureModelStore.getModel(),r=this.$madStore.getLocks();return t.execute({fn:function(){var n=p.createRequestForEdits(e,r,i,t.$pivotConfigStore.getMetricsConfig());return l.timedPromise("Update Request",t.$measureServiceDAO.send(n))},startAction:{actionType:n.MARK_EDITS_IN_FLIGHT},successAction:{actionType:n.SET_EDITS_SUCCESSFUL,edits:e},failAction:{actionType:n.SET_EDITS_FAILED,edits:e}})};m.prototype.markDataDirtyByMeasure=function(e,t){return this.dispatchPayload({actionType:n.MARK_DATA_DIRTY_BY_MEASURE,measure:e,pivotIds:t})};m.prototype.markAllDataDirty=function(e){return this.dispatchPayload({actionType:n.MARK_ALL_DATA_DIRTY,pivotIds:e})};m.prototype.sendEditabilityRequest=function(e){var t=this;return this.dispatchPayload({actionType:n.MARK_EDITABILITY_IN_FLIGHT}).then(function(){return t.$measureServiceDAO.send(e.serviceRequest)}).then(function(i){s(i.editability instanceof Object);return t.dispatchPayload({actionType:n.SET_EDITABILITY_STATUS,request:e,response:i.editability})}).catch(function(i){t.$logActionHandler.warn(c.DATA_PROCESSING_ERROR,d.INCONSISTENT_EDIT_ERROR,i);return t.dispatchPayload({actionType:n.SET_EDITABILITY_STATUS,request:e,response:{}})})};m.prototype.sendOutstandingDataRequests=function(e){var t=this;return Promise.all(e.map(function(e){var i=e.serviceRequest;e.queryTime=new Date;return t.dispatchPayload({actionType:n.SET_DATA_REQUEST_RUNNING,dataRequest:e}).then(function(){return l.timedPromise("Data Requests",t.$measureServiceDAO.send(i.request))}).then(l.timedFn("Dispatching Load For Outstanding Requests",function(r){var o=t.dispatchPayload({actionType:n.LOAD_OUTSTANDING_DATA_REQUEST,processor:i.responseProcessor,response:r,dataRequest:e}).then(function(){return t.dispatchPayload({actionType:n.SET_DATA_REQUEST_FINISHED,dataRequest:e})});return l.timedPromise("Load From Outstanding Requests",o)})).catch(function(i){return t.dispatchPayload({actionType:n.SET_DATA_REQUEST_FAILED,dataRequest:e,error:i}).then(function(){return Promise.reject(i)})})}))};m.prototype.createLevel=function(e,t,i){var r=this,n=p.createRequestForLevelCreation(e,t,i);return this.$measureServiceDAO.send(n).then(function(){return r.markAllDataDirty()}).catch(function(e){return r.$notificationsActionHandler.error(e.error||d.UNEXPECTED_SERVER_ERROR,"Server Error")})};m.prototype.clearEdits=function(e){var t={actionType:n.CLEAR_EDITS,edits:e};if(e){t.edits=e}return this.dispatchPayload(t)};m.prototype.promptForUnsavedChanges=function(){var e=this;if(this.$madStore.getAllPendingEdits().length){return e.$modalWindowsActionHandler.confirm(g.MESSAGES.UNCALCULATED_CHANGES,g.MESSAGES.CONFIRM_NAVIGATION)}return Promise.resolve()};m.prototype.setLocks=function(e){return this.dispatchPayload({actionType:n.SET_LOCKS,locks:e})};m.prototype.unsetLocks=function(e){return this.dispatchPayload({actionType:n.UNSET_LOCKS,locks:e})};m.prototype.clearAllLocks=function(){return this.dispatchPayload({actionType:n.CLEAR_ALL_LOCKS})};t.exports=m},{"../constant":256,"../constant/messages":260,"../dao/measureservicedao":282,"../multiaxis/updategenerator":325,"../querygen/query":333,"../store/logstore":342,"../store/multiaxisdatastore":348,"../util":357,"./actionhandler":223,assert:2,inherits:41,"measure-query-gen/src/MQG":1}],233:[function(e,t,i){"use strict";var r=e("../store/navigationtreestore").NavigationTreeActions;var n=e("../dao/navigationtreedao");function o(e,t){this.$navigationTreeDAO=new n(t);this.$dispatcher=e}o.prototype.loadConfig=function(e){var t=this,i=this.$navigationTreeDAO;return i.fetchNavigationTreeConfig(e).then(function(e){return t.$dispatcher.handleViewAction({actionType:r.SET_CONFIG,config:e})})};o.prototype.updateConfig=function(e){this.$navigationTreeDAO.setNavigationTreeConfig(e)};o.prototype.setConfig=function(e){return this.$dispatcher.handleViewAction({actionType:r.SET_CONFIG,config:e})};t.exports=o},{"../dao/navigationtreedao":283,"../store/navigationtreestore":349}],234:[function(e,t,i){"use strict";var r=e("./actionhandler");var n=e("inherits");var o=e("../util");var a=e("../store/notificationsstore").NotificationsActions;var s=e("lodash");n(l,r);function l(e){this.$dispatcher=e}l.prototype.success=function(e,t,i,r){return this.dispatchPayload({actionType:a.SHOW_SUCCESS,message:e,title:t,action:i,options:r})};l.prototype.info=function(e,t,i,r){return this.dispatchPayload({actionType:a.SHOW_INFO,message:e,title:t,action:i,options:r})};l.prototype.warning=function(e,t,i,r){return this.dispatchPayload({actionType:a.SHOW_WARNING,message:e,title:t,action:i,options:r})};l.prototype.error=function(e,t,i,r){return this.dispatchPayload({actionType:a.SHOW_ERROR,message:e,title:t,action:i,options:r})};l.prototype.notify=function(e,t,i,r,n){return this.dispatchPayload({actionType:a.SHOW,message:t,title:i,action:r,options:n,level:e})};l.prototype.executeCallback=function(e){return this.dispatchPayload({actionType:a.EXECUTE_CALLBACK,notificationId:e})};t.exports=l},{"../store/notificationsstore":350,"../util":357,"./actionhandler":223,inherits:41,lodash:70}],235:[function(e,t,i){"use strict";var r=e("../util");var n=e("../store/pivotconfigstore").PivotConfigActions;var o=e("../dao/formattingdao");function a(e,t,i){this.$formattingDAO=new o(t);this.$dispatcher=e;this.$pivotConfigStore=i}a.prototype.loadConfig=function(){var e=this.$dispatcher,t=this.$pivotConfigStore,i=this.$formattingDAO;if(t.isConfigLoaded()){return Promise.resolve()}var o=t.isFetchingConfigDisplayFormats();if(!o){o=i.fetchFormattingConfig().then(function(t){return e.handleViewAction({actionType:n.SET_CONFIG,config:t})});o.catch(function(t){e.handleViewAction({actionType:n.ERROR_FETCHING_CONFIG});r.logError(t)});e.handleViewAction({actionType:n.SET_FETCHING_CONFIG,promise:o})}return o};t.exports=a},{"../dao/formattingdao":279,"../store/pivotconfigstore":351,"../util":357}],236:[function(e,t,i){var r=e("../util/promisecache");var n=e("../dao/userdao");var o=e("../constant").User.ACTIONS;var a="__user_login__";var s="__user_logout__";function l(e,t,i,o,a){this.$dispatcher=e;this.$userDAO=new n(t.http,t.urls.currentUserUrl,i,o,a);this.$promiseCache=new r}l.prototype.checkIsAuthenticated=function(){var e=this;return this.$promiseCache.concurrentPromise(a,function(){return e.$userDAO.getCurrentUser().then(function(t){if(t){return e.$dispatcher.handleViewAction({actionType:o.AUTHENTICATE,userName:t})}}).catch(function(){return false})})};l.prototype.authenticate=function(e,t){var i=this;return this.$promiseCache.concurrentPromise(a,function(){return i.$userDAO.authenticate(e,t).then(function(){return i.$dispatcher.handleViewAction({actionType:o.AUTHENTICATE,userName:e})})})};l.prototype.unauthenticate=function(){var e=this;return this.$promiseCache.concurrentPromise(s,function(){return e.$userDAO.unauthenticate().then(function(){return e.$dispatcher.handleViewAction({actionType:o.UNAUTHENTICATE})})})};t.exports=l},{"../constant":256,"../dao/userdao":284,"../util/promisecache":364}],237:[function(e,t,i){"use strict";var r=e("lodash");var n=e("assert");var o=e("../util/viewlayoututils");var a=e("../constant").View;var s=e("../constant").ViewConfig.MODELER_VIEW_ID;var l={options:{size:"1",openIn:"right"}};function u(e,t){this.$dispatcher=e;this.$viewConfigActions=t.viewConfigActions;this.$viewConfigStore=t.viewConfigStore;this.$viewStore=t.viewStore;this.$modelerViewUniqueId=this.$viewStore.getViewUniqueId(null,s)}u.prototype.openPage=function(e){n(e,["View`s ID has to be passed"]);var t=this.$viewStore,i=t.getCurrentPageViewId(),r=t.getViewId(this.$modelerViewUniqueId),a=this.$viewConfigStore.getViewState(r),s=t.getViewUniqueId(this.$modelerViewUniqueId,e),u={module:t.getViewModuleId(s)},c;if(i===e){return Promise.resolve()}a=i&&o.closeViewInLayout(a,i)||a;a.get("views").forEach(function(e,t){if(!e.get("module")){a=o.closeViewInLayout(a,t)}});a=o.openViewInLayout(a,e,u,l);return this.$viewConfigActions.setViewState(r,a)};u.prototype.closePage=function(){var e=this.$viewStore.getCurrentPageViewId();return e&&this.closeViewIn(this.$modelerViewUniqueId,e)||Promise.resolve()};u.prototype.openView=function(e,t,i){var r=this.$viewStore.getViewId(e),n=this.$viewStore.getParentUniqueId(e);return this.openViewIn(n,r,t,i)};u.prototype.openViewIn=function(e,t,i,r){var n=this.$viewStore.getViewId(e);return this.$doWithViewState(n,function(e){return o.openViewInLayout(e,t,i,r)})};u.prototype.closeView=function(e){var t=this.$viewStore.getViewId(e),i=this.$viewStore.getParentUniqueId(e);return this.closeViewIn(i,t)};u.prototype.closeViewIn=function(e,t){var i=this.$viewStore.getViewId(e);return this.$doWithViewState(i,function(e){if(!e){return Promise.reject({viewClosed:true})}return o.closeViewInLayout(e,t)}).catch(function(e){if(e&&e.viewClosed){return}return Promise.reject(e)})};u.prototype.setViewMode=function(e,t,i){var r=this.$viewStore.getViewId(e),n=this.$viewStore.getParentId(e);return this.$doWithViewState(n,function(e){return o.setViewModeInLayout(e,r,t,i)})};u.prototype.$doWithViewState=function(e,t){var i=this.$viewConfigActions,r=this.$viewConfigStore.getViewState(e);r=t(r);return i.setViewState(e,r).then(function(){return i.saveViewState(e,r)})};t.exports=u},{"../constant":256,"../util/viewlayoututils":367,assert:2,lodash:70}],238:[function(e,t,i){"use strict";var r=e("lodash");var n=e("assert");var o=e("immutable");var a=e("../util/promisecache");var s=e("../dao/viewconfigdao");var l=e("../constant").ViewConfig;var u=l.ACTIONS;var c=l.MODELER_VIEW_ID;var d="Configuration for view {view_id} not found in the database";var p="__load_views__";function f(e,t,i){this.$viewConfigStore=i.viewConfigStore;this.$userStore=i.userStore;this.$dispatcher=e;this.$viewConfigDAO=new s(t);this.$promiseCache=new a}f.prototype.destroy=function(){this.$viewConfigStore=null;this.$userStore=null;this.$dispatcher=null;this.$viewConfigDAO=null;this.$promiseCache=null};f.prototype.loadAllViews=function(){var e=this,t;return this.$promiseCache.concurrentPromise(p,function(){return e.$fetchViews().then(function(t){return Promise.all(r.map(t,function(t,i){return e.$dispatcher.handleViewAction({actionType:u.SET_VIEW_STATE,config:o.fromJS(t.config),state:o.fromJS(t.state),viewId:i})}))})})};f.prototype.loadView=function(e,t){var i=this,r;return this.$viewConfigDAO.fetchConfig(e).then(function(n){if(t){r=Promise.resolve(n)}else{r=i.$viewConfigDAO.fetchState(e,i.$userStore.getCurrentUserName())}return r.then(function(t){return i.$dispatcher.handleViewAction({actionType:u.SET_VIEW_STATE,config:o.fromJS(n),state:o.fromJS(t),viewId:e})})})};f.prototype.initializeView=function(e,t,i){n(e,["View`s ID has to be passed"]);var r=this.$viewConfigStore.getViewState(e);t=t||o.Map();if(!r||i&&r!==t){return this.setViewState(e,t,t)}return Promise.resolve()};f.prototype.setViewState=function(e,t,i){if(!o.Map.isMap(t)){t=o.fromJS(t)}if(i&&!o.Map.isMap(i)){i=o.fromJS(i)}return this.$dispatcher.handleViewAction({actionType:u.SET_VIEW_STATE,state:t,config:i,viewId:e})};f.prototype.saveViewState=function(e,t){n(e,["View`s ID has to be passed"]);n(t,["View state has to be passed"]);if(e===c){return Promise.resolve()}return this.$viewConfigDAO.saveState(e,t,this.$userStore.getCurrentUserName())};f.prototype.saveViewStates=function(e){e=e.filter(function(e){return e.get("id")!==c});return this.$viewConfigDAO.saveStates(e,this.$userStore.getCurrentUserName())};f.prototype.resetViewState=function(e){n(e,["View`s ID has to be passed"]);var t=this.$viewConfigStore.getViewConfig(e);return this.setViewState(e,t).then(this.saveViewState.bind(this,e,t))};f.prototype.$fetchViews=function(){var e=this,t,i;return this.$viewConfigDAO.fetchConfigs().then(function(t){return e.$viewConfigDAO.fetchStates(e.$userStore.getCurrentUserName()).then(function(e){i=r.chain(t).map(function(t){return{config:t,state:r.find(e,function(e){return e.id===t.id})}}).mapKeys(function(e){return e.config.id}).value();e.forEach(function(e){if(!i[e.id]){i[e.id]={config:r.cloneDeep(e),state:r.cloneDeep(e)}}});return i})})};t.exports=f},{"../constant":256,"../dao/viewconfigdao":285,"../util/promisecache":364,assert:2,immutable:"immutable",lodash:70}],239:[function(e,t,i){"use strict";var r=e("../store/store").createConstant;t.exports={LEVELS:{ERROR:"Error",INFO:"Info",WARNING:"Warning"},STATES:{SUCCEEDED:"SUCCEEDED",FAILED:"FAILED",STARTED:"STARTED"},ActionActions:r("ActionStore",["CLEAR_STATUS","START_ACTION","FAIL_ACTION","SUCCEED_ACTION","LOAD_ACTIONS"]),ActionEvents:r("ActionStore",["ACTION_STARTED","ACTION_FAILED","ACTION_SUCCEEDED","ACTIONS_LOADED","CHANGED"])}},{"../store/store":352}],240:[function(e,t,i){"use strict";var r=e("../store/store").createConstant;t.exports={SelectionTypes:r("SelectionTypes",["EXPLICITLY_INCLUDED","IMPLICITLY_INCLUDED","CAN_BE_INCLUDED","EXCLUDED"]),AssociationStrategy:r("AssociationStrategy",["SINGLE","GROUPED"])}},{"../store/store":352}],241:[function(e,t,i){"use strict";t.exports={X:"X",Y:"Y",SLICE:"Z"}},{}],242:[function(e,t,i){"use strict";t.exports={OK:"Ok",OK_CANCEL:"OkCancel",YES_NO_CANCEL:"YesNoCancel",CALCULATE_CONTINUE_CANCEL:"CalculateContinueCancel",CONTINUE_CANCEL:"ContinueCancel",CONFIRM_CONTINUE_CANCEL:"ConfirmContinueCancel",CONFIRM_DISCARD_CANCEL:"ConfirmDiscardCancel"}},{}],243:[function(e,t,i){"use strict";t.exports={OK:"Ok",CANCEL:"Cancel",YES:"Yes",NO:"No",CALCULATE:"Calculate & Continue",CONFIRM:"Confirm",CONTINUE:"Continue",DISCARD:"Discard"}},{}],244:[function(e,t,i){"use strict";var r=e("../store/store").createConstant;i.ACTIONS=r("Collaboration",["UPDATE_SOCKET_LIST","UPDATE_USER_STATUS","UPDATE_CURRENT_SOCKET","UPDATE_DATA_EDITS","BROADCAST_EDITS_WERE_MADE","BROADCAST_ACTION_CHANGED_STATE"]);i.EVENTS=r("Collaboration",["USER_LIST_UPDATED","DATA_UPDATED","USER_CONNECTED","USER_NEW_SOCKET","USER_SOCKET_CLOSED","USER_DISCONNECTED","CONNECT","DISCONNECT","ACTION_STATE_CHANGED"]);i.UPDATE_INTERVALS={MIN:0,MAX:6};i.STANDARD_MESSAGE_TYPES={OPEN:"open",CLOSE:"close"};i.MESSAGE_PROPERTIES={JOIN:"join",LEAVE_CODE:"leave_code",PEERS:"peers"}},{"../store/store":352}],245:[function(e,t,i){"use strict";var r=typeof window!=="undefined"&&navigator.platform.toUpperCase().indexOf("MAC")>=0;t.exports={MenuItemInfo:{Create:{key:"createItem",label:"Create "},FilterSection:{key:"filterSection"},Deferred:{key:"deferred",label:"Deferred Calc"},Lock:{key:"lock",label:r?"Lock (Cmd + L)":"Lock (Ctrl + L)"},Calculate:{key:"calculate",label:"Calculate (F9)"},Discard:{key:"discard",label:"Discard"},Review:{key:"review",label:r?"Review (Cmd + F9)":"Review (Ctrl + F9)"},Unlock:{key:"unlock",label:r?"Unlock (Cmd + Shift + L)":"Unlock (Ctrl + Shift + L)"},UnlockAll:{key:"unlockAll",label:"Unlock All"},ModelBrowser:{key:"modelBrowser",label:"Model Browser"},Measures:{key:"measures",label:"Visible Measures Panel"},ConfigurationMode:{key:"configurationMode",label:"Configuration Mode"},ChartMode:{key:"chartMode",label:"Chart Mode"},Copy:{key:"copy",label:r?"Copy (Cmd + C)":"Copy (Ctrl + C)"},Cut:{key:"cut",label:r?"Cut (Cmd + X)":"Cut (Ctrl + X)"},Paste:{key:"paste",label:r?"To Paste use (Cmd + V)":"To Paste use (Ctrl + V)"},ExportToCsv:{key:"exportToCsv",label:"Export To Csv"},ExportToExcel:{key:"exportToExcel",label:"Export To Excel"},Filter:{key:"filter",label:"Filter"},ClearFilter:{key:"clearFilter",label:"Clear Filter"},Sort:{key:"sort",label:"Sort"},SortAsc:{key:"sortAsc",label:"Sort Ascending"},SortDesc:{key:"sortDesc",label:"Sort Descending"},ClearSort:{key:"clearSort",label:"Clear Sort"},ConditionalFormatting:{key:"conditionalFormatting",label:"Conditional Formatting"},ClearFormatting:{key:"clearFormatting",label:"Clear Formatting"},FormulaEditor:{key:"formulaEditor",label:"Formula Editor"},PivotSettings:{key:"pivotSettings",label:"Pivot Settings"},ResetState:{key:"resetState",label:"Reset State"},Remove:{key:"remove",label:"Remove"},MeasureProperties:{key:"measureProperties",label:"Measure Properties"},HideOutline:{key:"hideOutline",label:"Hide Outline"},DisplayOutline:{key:"displayOutline",label:"Display As Outline"},HideRollup:{key:"hideRollup",label:"Hide Rollup"},DisplayRollup:{key:"displayRollup",label:"Display Rollup"},SyncAll:{key:"syncAll",label:"Sync All"},SyncAllOnPage:{key:"syncAllOnPage",label:"Sync All On Page"},UnsyncAll:{key:"unsyncAll",label:"Unsync All"},UnsyncAllOnPage:{key:"unsyncAllOnPage",label:"Unsync All On Page"},UnsyncThis:{key:"unsyncThis",label:"Unsync This"},SyncWith:{key:"syncWith",label:"Sync With..."},Details:{key:"details",label:"Details"}},IconInfo:{Checked:"check",Sync:"link",Unsync:"chain-broken",Lock:"lock",Unlock:"unlock",Sort:"sort",SortAsc:"sort-amount-asc",SortDesc:"sort-amount-desc",Filter:"filter",Remove:"times",Copy:"files-o",Cut:"scissors",Paste:"clipboard",Search:"search",Details:"list-alt",Plus:"plus"}}},{}],246:[function(e,t,i){"use strict";t.exports={options:{autoDismiss:3},messages:{info:"CSV exporting has started.",success:"CSV downloading completed.",empty:"Sheet is empty, nothing to export.",error:"An error has occurred during exporting CSV.",largeDataWarn:"Attempting to export a large data set (> 1 million cells). This may take a long time and may run out of memory."}}},{}],247:[function(e,t,i){"use strict";var r=e("../store/store").createConstant;t.exports=r("CustomEventTypes",["CREATED_BY_MODELER"])},{"../store/store":352}],248:[function(e,t,i){"use strict";t.exports={WIDTH:80,HEIGHT:20}},{}],249:[function(e,t,i){"use strict";t.exports={UP:"Up",RIGHT:"Right",DOWN:"Down",LEFT:"Left"}},{}],250:[function(e,t,i){"use strict";var r=e("../store/store").createConstant;t.exports={TYPES:{FIELD:"Field"},STATE:{DRAGGING:"Dragging",DROPPED:"Dropped"},ACTIONS:r("DragAndDrop",["DRAG","DRAGOVER","DROP","DRAGEND"]),EVENTS:r("DragAndDrop",["CHANGED"])}},{"../store/store":352}],251:[function(e,t,i){"use strict";t.exports={options:{autoDismiss:3},messages:{info:"Excel file exporting has started.",success:"Excel file downloading completed.",empty:"Sheet is empty, nothing to export.",error:"An error has occurred during exporting Excel file.",largeDataWarn:"Attempting to export a large data set (> 1 million cells). This may take a long time and may run out of memory."}}},{}],252:[function(e,t,i){"use strict";var r=e("./fieldtypes");var n={};n[r.LEVEL]="level";n[r.MEASURE_GROUP]="measure-group";n[r.MEASURE]="measure";t.exports=n},{"./fieldtypes":253}],253:[function(e,t,i){"use strict";var r=Object.freeze({MEASURE:1,LEVEL:2,DIMENSION:3,MEASURE_GROUP:4});t.exports=r},{}],254:[function(e,t,i){"use strict";t.exports={BUTTON_ACTIVE_TITLE:"Your user session is being recorded. This recording can be used to report issues to developers, or inform developers of your user experience.",BUTTON_INACTIVE_TITLE:"Press here to begin recording your user session. This recording can be used to report issues to developers, or inform developers of your user experience."}},{}],255:[function(e,t,i){"use strict";var r=e("../store/store").createConstant;i.ACTIONS=r("GridOptions",["SET_OPTIONS","SET_FORMATTING","ADD_RULE","REMOVE_RULE","UPDATE_RULE","UPDATE_MEASURES"]);i.EVENTS=r("GridOptions",["CHANGED"]);var n={NOT_EMPTY:{name:"notEmpty",label:"is not empty",unsupportedTypes:["BOOLEAN"]},EMPTY:{name:"empty",label:"is empty",unsupportedTypes:["BOOLEAN"]},GREATER_THAN:{name:">",label:">",unsupportedTypes:["BOOLEAN","STRING","NAMED"]},GREATER_EQUAL:{name:">=",label:">=",unsupportedTypes:["BOOLEAN","STRING","NAMED"]},LESS_THAN:{name:"<",label:"<",unsupportedTypes:["BOOLEAN","STRING","NAMED"]},LESS_EQUAL:{name:"<=",label:"<=",unsupportedTypes:["BOOLEAN","STRING","NAMED"]},EQUAL:{name:"=",label:"=",unsupportedTypes:[]},NOT_EQUAL:{name:"<>",label:"<>",unsupportedTypes:[]},RANGE:{name:"range",label:"is in range",INCLUDE_MIN:"includeMin",INCLUDE_MAX:"includeMax",unsupportedTypes:["BOOLEAN","STRING","NAMED"]}};i.CONDITIONALS=n;i.NUMERIC_CONDITIONALS=[n.LESS_EQUAL.name,n.LESS_THAN.name,n.GREATER_EQUAL.name,n.GREATER_THAN.name];i.FORMATTING_CONTROLLER={VIEW_MODES:{VIEW:"view",EDIT:"edit",REMOVE:"remove"},ALL:"All",INTERSECTIONS:"Intersections"};i.GLOBAL_OPTIONS="GLOBAL_OPTIONS"},{"../store/store":352}],256:[function(e,t,i){"use strict";t.exports={CHANGE_EVENT:"CHANGE_EVENT",DOUBLE_CLICK_TIME:500,SORT:e("./sort"),ACTIONS:e("./actions"),CSV_EXPORT:e("./csvexport"),MESSAGES:e("./messages"),DefaultCellSize:e("./defaultcellsize"),PivotEditMode:e("./pivoteditmode"),ButtonTypes:e("./buttontypes"),ButtonPanelTypes:e("./buttonpaneltypes"),ModalWindowActions:e("./modalwindowsactions"),ModalWindows:e("./modalwindows"),Direction:e("./direction"),NotificationLevels:e("./notificationlevels"),NotificationPositions:e("./notificationpositions"),Labels:e("./labels"),Collaboration:e("./collaboration"),StorageTypes:e("./storageTypes"),UserActivity:e("./useractivity"),EXCEL_EXPORT:e("./excelexport"),DND:e("./draganddrop"),AssociativeFiltering:e("./associativefiltering"),GridOptions:e("./gridoptions"),ViewConfig:e("./viewconfig"),Layout:e("./layout"),View:e("./view"),User:e("./user"),FieldTypes:e("./fieldtypes"),FieldTypeClasses:e("./fieldtypeclasses"),Keys:e("./keys"),SignalDataTypes:e("./signaldatatypes"),PagesSyncStates:e("./pages_sync_states"),VegaLite:e("./vegalite"),CustomEventTypes:e("./custom_event_types"),ContextMenu:e("./context_menu"),FilterableMeasureTypes:["DECIMAL","INT","FLOAT"],Axes:e("./axes")}},{"./actions":239,"./associativefiltering":240,"./axes":241,"./buttonpaneltypes":242,"./buttontypes":243,"./collaboration":244,"./context_menu":245,"./csvexport":246,"./custom_event_types":247,"./defaultcellsize":248,"./direction":249,"./draganddrop":250,"./excelexport":251,"./fieldtypeclasses":252,"./fieldtypes":253,"./gridoptions":255,"./keys":257,"./labels":258,"./layout":259,"./messages":260,"./modalwindows":261,"./modalwindowsactions":262,"./notificationlevels":263,"./notificationpositions":264,"./pages_sync_states":265,"./pivoteditmode":266,"./signaldatatypes":267,"./sort":268,"./storageTypes":269,"./user":270,"./useractivity":271,"./vegalite":272,"./view":273,"./viewconfig":274}],257:[function(e,t,i){t.exports={BACKSPACE:8,TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40}},{}],258:[function(e,t,i){"use strict";t.exports={MeasureFilterWindow:{NAV_RANGE_TITLE:"Range",NAV_AT_LEAST_TITLE:"At Least",NAV_AT_MOST_TITLE:"At Most"}}},{}],259:[function(e,t,i){"use strict";t.exports={VIEW_MODE:{DEFAULT:"default",CONFIGURATION:"configuration",CHART:"chart",FORM:"form"},POSITION:{LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"}}},{}],260:[function(e,t,i){"use strict";t.exports={UNEXPECTED_SERVER_ERROR:"An unexpected server error occurred.",INCONSISTENT_EDIT_ERROR:"The edits so far are inconsistent (e.g., a metric may not have an inverse, or all metrics cannot be edited simultaneously).  Please look for problems in your edits and try again.",INCONSISTENT_SINGLE_EDIT_ERROR:"Unexpected: single edit on noneditable position.",INCONSISTENT_NEW_EDITS_ERROR:"The set of edits you have made are inconsistent (e.g. a metric may not have an inverse, or all of the metrics cannot be edited simultaneously).  Please look for problems in your edits and try again.",UNEXPECTED_EDIT_ERROR:"Your edit(s) could not be committed due to a processing error or invalid/inconsistent data.  Please look for problems in your edits and try again.",CONFIRM_NAVIGATION:"Confirm Navigation",UNCALCULATED_CHANGES:"There are uncalculated changes. The data will be lost if you leave the page.",PLEASE_CONFIRM:"Please Confirm",SWITCH_DEFAULT_MODE:"This configuration can't be displayed in the form mode. Would you like to switch to the default mode?"}},{}],261:[function(e,t,i){"use strict";var r={CONFIRMATION_DIALOG:"CONFIRMATION_DIALOG",REVIEW_EDITS_DIALOG:"REVIEW_EDITS_DIALOG",REVIEW_LOCKS_DIALOG:"REVIEW_LOCKS_DIALOG",LOGOUT_NOTIFICATION_DIALOG:"LOGOUT_NOTIFICATION_DIALOG",SORT_DIALOG:"SORT_DIALOG",SIGNAL_MANAGEMENT_DIALOG:"SIGNAL_MANAGEMENT_DIALOG",SIGNALS_INFO_DIALOG:"SINGAL_INFO_DIALOG",PAGES_SYNC_DIALOG:"PAGES_SYNC_DIALOG",WARNING_DIALOG:"WARNING_DIALOG",LEVEL_CREATION_FORM:"LEVEL_CREATION_FORM"};var n={REPLACE:"REPLACE",APPEND:"APPEND"};var o={};o[r.CONFIRMATION_DIALOG]={renderPolicy:n.REPLACE};o[r.REVIEW_LOCKS_DIALOG]={renderPolicy:n.REPLACE};o[r.REVIEW_EDITS_DIALOG]={renderPolicy:n.REPLACE};o[r.LOGOUT_NOTIFICATION_DIALOG]={renderPolicy:n.REPLACE
};o[r.SORT_DIALOG]={renderPolicy:n.REPLACE};o[r.SIGNAL_MANAGEMENT_DIALOG]={renderPolicy:n.REPLACE};o[r.SIGNALS_INFO_DIALOG]={renderPolicy:n.REPLACE};o[r.PAGES_SYNC_DIALOG]={renderPolicy:n.REPLACE};o[r.WARNING_DIALOG]={renderPolicy:n.REPLACE};o[r.LEVEL_CREATION_FORM]={renderPolicy:n.REPLACE};o[r.TEST_DIALOG]={renderPolicy:n.APPEND};i.Types=r;i.RenderPolicy=n;i.Specs=o},{}],262:[function(e,t,i){"use strict";t.exports=e("../store/store").createConstant("ModalWindows",["OPEN_WINDOW","CLOSE_WINDOW"])},{"../store/store":352}],263:[function(e,t,i){"use strict";t.exports={SUCCESS:"success",INFO:"info",WARNING:"warning",ERROR:"error"}},{}],264:[function(e,t,i){"use strict";t.exports={TOP_RIGHT:"tr",TOP_LEFT:"tl",TOP_CENTER:"tc",BOTTOM_RIGHT:"br",BOTTOM_LEFT:"bl",BOTTOM_CENTER:"bc"}},{}],265:[function(e,t,i){"use strict";t.exports={SYNCED_WITH_CURRENT_SHEET:"SYNCED_WITH_CURRENT_SHEET",SYNCED:"SYNCED",UNSYNCED:"UNSYNCED"}},{}],266:[function(e,t,i){"use strict";t.exports={MULTI:"multi",SINGLE:"single"}},{}],267:[function(e,t,i){"use strict";var r=e("assert");var n=e("immutable");var o=e("joi");var a=e("lodash");var s=o.array().items(o.object().keys({qualifiedName:o.string().required(),positions:o.array().items(o.string())}));var l=o.string().required();function u(e,t,i){if(!n.List.isList(i)){i=n.List([i])}t=t.delete("measure");return e(t,i)}var c={POSITIONS:a.wrap(function(e,t){return e.set("positions",t)},u),STRING:a.wrap(function(e,t){return t.join(" ")},u)};t.exports={POSITIONS:"POSITIONS",STRING:"STRING",schemas:{POSITIONS:s,STRING:l},getTransformationFn:function(e){var t=c[e];r(a.isFunction(t),"There is no transformation function for data type "+e);return t}}},{assert:2,immutable:"immutable",joi:"joi",lodash:70}],268:[function(e,t,i){"use strict";t.exports={ASCENDING:"asc",DESCENDING:"desc",DEFAULT_ATTR:"label",DEFAULT_TYPE:"asc",getSortType:function(e){if(!e)return this.DEFAULT_TYPE;if(e.toLowerCase()==="asc"||e.toLowerCase()==="ascending")return this.ASCENDING;if(e.toLowerCase()==="desc"||e.toLowerCase()==="descending")return this.DESCENDING;return this.ASCENDING},getSortAttr:function(e){if(!e)return this.DEFAULT_ATTR;if(e.toLowerCase()==="label"||e.toLowerCase()==="order")return e;return this.DEFAULT_ATTR}}},{}],269:[function(e,t,i){t.exports={LOCAL:"local",SESSION:"session",IN_MEMORY:"in-memory"}},{}],270:[function(e,t,i){"use strict";var r=e("../store/store").createConstant;t.exports={ACTIONS:r("User",["AUTHENTICATE","UNAUTHENTICATE"]),EVENTS:r("User",["CHANGED"])}},{"../store/store":352}],271:[function(e,t,i){"use strict";t.exports={IDLE_TIME_VALUES:{NOTIFICATION_TIME:1800,LOGOUT_TIME:60,IGNORE_BROADCASTING_TIME:300},USER_ACTIVITY_STATUS:{ACTIVE:"ACTIVE",IGNORE_BROADCASTING:"IGNORE_BROADCASTING",IDLE:"IDLE",LOGGED_OUT:"LOGGED_OUT"},LOCAL_STORAGE_PROPERTY:"USER_ACTIVITY_STATUS_VALUES",LAST_ACTIVITY_TIMESTAMP:"LAST_ACTIVITY_TIMESTAMP"}},{}],272:[function(e,t,i){"use strict";t.exports={MARK:{AREA:"area",BAR:"bar",LINE:"line",POINT:"point",TEXT:"text",TICK:"tick",RULE:"rule",CIRCLE:"circle",SQUARE:"square"},FIELD_TYPE:{QUANTITATIVE:"quantitative",TEMPORAL:"temporal",ORDINAL:"ordinal",NOMINAL:"nominal"},AGGREGATE:{MEAN:"mean",COUNT:"count",SUM:"sum"}}},{}],273:[function(e,t,i){"use strict";var r=e("../store/store").createConstant;t.exports={ACTIONS:r("View",["SET_CURRENT_PAGE_VIEW"]),EVENTS:r("View",["CURRENT_PAGE_VIEW_CHANGED"]),Modules:{Page:"Page",Canvas:"CanvasView",Layout:"Layout",Sheet:"SheetView",VegaChart:"VegaChart",ModelerNavigationTree:"ModelerNavigationTree",Image:"Image",LogConsole:"LogConsole",ActionButtons:"ActionButtons",ShortcutButtons:"ShortcutButtons",ContentPresenter:"ContentPresenter",VegaLite:"VegaLite",PivotGrid:"PivotGrid",Form:"Form",Grid:"Grid",MeasureFilterWindow:"MeasureFilterWindow",ConfigMenu:"ConfigMenu",RollupWindow:"RollupWindow",Rows:"Rows",Columns:"Columns",Measures:"Measures",Slices:"Slices",ModelBrowser:"ModelBrowser",MeasureBrowser:"MeasureBrowserController",DimensionBrowser:"DimensionBrowserController",MeasureLanguageEditor:"MeasureLanguageEditor",MeasureWindow:"MeasureWindow",ConditionalFormatting:"ConditionalFormatting",SheetConfigurationPanel:"SheetConfigurationPanel"}}},{"../store/store":352}],274:[function(e,t,i){"use strict";var r=e("../store/store").createConstant;t.exports={ACTIONS:r("ViewConfig",["SET_VIEW_STATE"]),EVENTS:r("ViewConfig",["STATE_CHANGED","CONFIG_CHANGED"]),MODELER_VIEW_ID:"page-with-sidebar",PATH:{SIGNALS:["signals","output"],SIGNAL_LISTENERS:["signals","input"]}}},{"../store/store":352}],275:[function(e,t,i){"use strict";var r=t.exports;var n=5e3;r.getExportData=function(e,t,i,o){var a={attributeOptions:{includeValue:true},builderOptions:{prebuildInfoAndData:false}},s=t.getHeadingData(e,"exportCsv"),l=s.getHeadingAxisInfo("X").getLength(),u=s.getHeadingAxisInfo("Y").getLength(),c=Math.max(Math.trunc(n/l),25),d=r.mkCsvBuilder(u,l,1,0,o),p=function(r){return function(){var n={Y:{start:r,length:u-r>c?c:u-r}};if(r+n.Y.length<u){setTimeout(p(r+c))}t.getDataRange(e,"exportCsv",n,d.cellBuilder,true,a,["Y","X"]);if(r+n.Y.length>=u){i(d.getCsv())}}};setTimeout(p(0))};r.mkCsvBuilder=function(e,t,i,r,n){var o="",a="",s=n&&n.exportLevelMemberId?"id":"label",l=n&&n.exportRawValue?"rawValue":"formattedValue",u=function(e,n,u,c,d,p,f,h){var g=f(e,n,u,c,d,p),m=h(e,n,u,d),v=p[r],y=p[i],b,w,C,E,S,T;g.headings[r]=g.headings[r].filter(function(e){return!e.config.placeholder});g.headings[i]=g.headings[i].filter(function(e){return!e.config.placeholder});if(v===0){if(y===0){b=g.headings[r];b.forEach(function(e){if(o.length>0){o+=","}o+='"'+e.config.field.id+'"'})}w=g.headings[i];for(C=0;C<w.length;C++){if(!m.invalid){if(o.length>0){o+=","}o+='"'+w[C][s]+'"'}}}if(y===0){b=g.headings[r];C=0;E=b.length;for(;C<E;C++){a+='"'+b[C][s]+'",'}}T=!m.invalid&&m.queryResults.selectedDataLabel&&m.queryResults.selectedDataLabel.value;S=!m.invalid&&m.queryResults.value&&m.queryResults.value.value;if(T&&m.queryResults.selectedDataLabel&&m.queryResults.selectedDataLabel.value.formattedValue.length>0){a+='"'+m.queryResults.selectedDataLabel.value[l][0][0]+'"'}else if(S&&m.queryResults.value&&m.queryResults.value.value[l].length>0){a+='"'+m.queryResults.value.value[l][0][0]+'"'}else if(!T&&!S){a=a.slice(0,-1)}if(y===t-1)a+="\n";else a+=","};return{cellBuilder:u,getCsv:function(){if(a.length>1){a=a.slice(0,-1)}return o+"\n"+a}}}},{}],276:[function(e,t,i){"use strict";var r=e("./util");var n=t.exports;var o=e("assert");var a=e("./logiql");var s=e("lodash");var l=e("measure-query-gen/src/MQG");var u=a.rule;var c=a.and;n.noneAgg="(None)";n.noneUpd="(None)";n.parseFilter=function(e){var t=e.match(/^(.*?)([!=<>~]+)(.*?)!?$/);o(t instanceof Array);o(t.length===4);return{dimlvl:t[1],comparison:t[2],member:t[3]}};n.parseFilterString=function(e){o(s.isString(e)||s.isObject(e),"Invalid argument!");if(s.isObject(e))return e;var t=e.replace("&","|").split("|");o(t.length>0,"Empty filters");t=t.map(n.parseFilter);var i=t.map(function(e){return new n.Comparison(e.comparison,e.member)});var r=t[0].dimlvl;return new n.Filter(r,i)};n.parseFilterList=function(e){r.type.assertArgs(arguments,[Array]);return e.map(n.parseFilterString)};n.parseAgg=function(e){var t=e.match(/^([^:]+):(.*)$/);o(t.length===3);return{method:t[1],keyOrMeasure:t[2],isAll:!n.isMeasure(t[2])&&/ALL$/.test(t[2])}};n.getParser=function(e){e=e.toLowerCase();var t=function(e){if(e===true||e.toLowerCase&&e.toLowerCase()==="true")return true;else if(e===false||e.toLowerCase&&e.toLowerCase()==="false")return false;else console.error("Expected a boolean value")},i={int:function(e){var t=parseInt(e);if(isNaN(t))console.error("Couldn't parse string '"+e+"' as int.");return t},float:function(e){var t=parseFloat(e);if(isNaN(t))console.error("Couldn't parse string '"+e+"' as float.");return t},decimal:function(e){var t=parseFloat(e);if(isNaN(t)){console.error("Couldn't parse string '"+e+"' as decimal.")}return String(t)},string:function(e){return e},named:function(e){return e},bool:t,boolean:t};o(i.hasOwnProperty(e),"no parser for type "+e);return i[e]};n.parseDimLvl=function(e,t){o(typeof e==="string","parseDimLvl can only parse strings");t=!!t;var i=e.split(":");if(!t){o(i.length===2,"String "+e+" doesn't look like dimension:level");return{dimension:i[0],level:i[1]}}else{o(i.length===2||i.length===3,"String "+e+" doesn't look like dimension:level or label:dimension:level");if(i.length===2)return{dimension:i[0],level:i[1]};else return{label:i[0],dimension:i[1],level:i[2]}}};n.qualifiedLevelToQualifiedName=function(e,t){if(t)return n.qualifiedName(e.dimension,e.level,e.label);else return n.qualifiedName(e.dimension,e.level)};n.qualifiedName=function(e,t,i){return(s.isUndefined(i)?e:i)+":"+(s.isUndefined(t)?"":t)};n.mkQualifiedName=function(e){return function(t){return n.qualifiedName(e,t)}};n.pluckQualifiedName=function(e){return s.map(e,"qualifiedName")};n.pluckQualifiedLevel=function(e){return n.pluckQualifiedName(e).map(n.parseDimLvl)};n.qLevelEqual=function(e,t,i,r){var o=i?n.qlevel.labelEquals(n.qlevel.getLabel(e))(t):true,a=r?!e.hierarchy||!t.hierarchy||e.hierarchy===t.hierarchy:true;return e.dimension===t.dimension&&e.level===t.level&&a&&o};n.intersectionEqual=function(e,t,i,r,o){var a=e.qualified_level||[],s=t.qualified_level||[],l=n.qLevelEqual;i=!!i;r=!!r;o=!!o;return a.length===s.length&&a.every(function(e,t){if(i){return s.some(n.qlevel.qLevelEqual(e,r,o))}else{return l(e,s[t],r,o)}})};n.projectLabelFromIntersection=function(e,t){return new l.Intersection(e.qualified_level.filter(r.not(n.qlevel.labelEquals(t))).map(n.cloneQualifiedLevel))};n.stepIntersectionToLevels=function(e,t){return new l.Intersection(e.qualified_level.map(function(e){var i=n.qlevel.getLabel(e),r=t.filter(n.qlevel.labelEquals(i));if(r.length===0){return e}else{o(r.length===1,"Too many matches for label '"+i+"'");return n.cloneQualifiedLevel(r[0])}}))};n.isDimensionalSubset=function(e,t){var i=e.qualified_level,r=t.qualified_level;if(i.length>r)return false;return i.every(function(e){return r.some(n.qlevel.labelEquals(n.qlevel.getLabel(e)))})};n.getOverlappingLabels=function(e,t){var i=e.qualified_level,r=t.qualified_level;return i.map(n.qlevel.getLabel).filter(function(e){return r.some(n.qlevel.labelEquals(e))})};n.sortIntersectionByLabel=function(e){e.qualified_level.sort(function(e,t){var i=n.qlevel.getLabel(e),r=n.qlevel.getLabel(t);if(i<r)return-1;else if(i>r)return 1;return 0});return e};n.metricInterEqual=function(e,t){return e.metric===t.metric&&n.intersectionEqual(e.inter,t.inter,true)};n.findMetricInter=function(e,t){return s.find(e,s.curry(n.metricInterEqual)(t))};n.Comparison=function(e,t){this.comparison=e;this.member=t};n.Filter=function(e,t){if(s.isString(e)){if(e.match(":")){this.qualifiedLevel=n.parseDimLvl(e);this.is_disjunction=true}else{this.metric=e;this.is_disjunction=false}}else{this.qualifiedLevel=e;this.is_disjunction=true}if(t&&t.length){o(t[0]instanceof n.Comparison);this.comparisons=t}};n.cloneFilter=function(e){return new n.Filter(e.qualifiedLevel||e.metric,e.comparisons)};n.checkFilter=function(e){o(Array.isArray(e)&&e.length===0||e[0]instanceof Object&&e[0].hasOwnProperty("comparisons"),["Filter of unexpected form",e])};n.getMetricFilters=function(e){var t={};if(e){e.forEach(function(e){if(e.hasOwnProperty("metric")){var i=e.metric;e.comparisons.forEach(function(e){var r=e.comparison,n=e.member;if(!t[i])t[i]=[];switch(r){case">":t[i].min=n;break;case"<":t[i].max=n;break;case"=":if(!t[i].equal)t[i].equal=[];t[i].equal.push(n);break;case">=":t[i].min=n;if(!t[i].equal)t[i].equal=[];t[i].equal.push(n);break;case"<=":t[i].max=n;if(!t[i].equal)t[i].equal=[];t[i].equal.push(n);break}})}})}return t};n.isMeasure=function(e){return e.indexOf(":")===-1};n.isQualifiedLevel=function(e){return e&&e instanceof l.QualifiedLevel};n.assertMetricPredicate=function(e,t){var i='"'+e+'"',r='"'+t+'"';return u(c("+lb:web:measure:PredicateConstructor[transaction:id[]] = msgPred","+lb:web:measure:Predicate(msgPred) {"+"  +lb:web:measure:Predicate_name[] = "+r+"}","^lb:web:measure:Metric_predicate[msgMetric] = msgPred"),"lb:web:measure:Metric_name[msgMetric] = "+i)};n.retractMetricPredicate=function(e){var t='"'+e+'"';return u("-lb:web:measure:Metric_predicate[msgMetric] = msgPred",c("lb:web:measure:Metric_name[msgMetric] = "+t,"lb:web:measure:Metric_predicate@prev[msgMetric] = msgPred"))};n.assertMetricRecalc=function(e,t){var i='"'+e+'"',r='"'+t+'"';return u(c("+lb:web:measure:Recalc(msgRecalc)","+lb:web:measure:RecalcConstructor[transaction:id[]] = msgRecalc","+lb:web:measure:Recalc_rule_name[msgRecalc] = "+r,"+lb:web:measure:Metric_recalc[msgMetric] = msgRecalc"),"lb:web:measure:Metric_name[msgMetric] = "+i)};n.retractMetricRecalc=function(e){var t='"'+e+'"';return u("-lb:web:measure:Metric_recalc[msgMetric] = msgRecalc",c("lb:web:measure:Metric_name[msgMetric] = "+t,"lb:web:measure:Metric_recalc@prev[msgMetric] = msgRecalc"))};n.upsertAggMethod=function(e,t){var i='"'+e+'"',r='"'+t+'"';return u("^lb:web:measure:Metric_agg_method[msgMetric] = aggMethod",c("lb:web:measure:Metric_name[msgMetric] = "+i,"measure:schema2DimensionMsg:agg2Msg["+r+"] = aggMethod"))};n.retractAggMethod=function(e){var t='"'+e+'"';return u("-lb:web:measure:Metric_agg_method[msgMetric] = aggMethod",c("lb:web:measure:Metric_name[msgMetric] = "+t,"lb:web:measure:Metric_agg_method@prev[msgMetric] = aggMethod"))};n.retractUpdMethod=function(e){var t='"'+e+'"';return u("-lb:web:measure:Metric_update_method[msgMetric] = updMethod",c("lb:web:measure:Metric_name[msgMetric] = "+t,"lb:web:measure:Metric_update_method@prev[msgMetric] = updMethod"))};n.columnRegExp=new RegExp("^([^_]*)_column");n.getColumnValueType=function(e){var t=Object.keys(e).map(function(e){return e.match(n.columnRegExp)}).filter(function(e){return!!e});o.equal(t.length,1,"Expected only one *_column attribute in reportColumn (e.g., string_column)");return t[0][1]};n.getValueColumn=function(e){return e[n.getColumnValueType(e)+"_column"]};n.getNeutralElement=function(e){var t={STRING:"",FLOAT:0,INT:0,DECIMAL:"0.0",BOOLEAN:false};var i=t[e];o(i!==undefined);return i};n.memberValueCompare=function(e,t){return r.arrayCompare([e.qualifiedLevel.dimension,e.qualifiedLevel.level,e.memberId],[t.qualifiedLevel.dimension,t.qualifiedLevel.level,t.memberId],0)};n.cloneQualifiedLevel=function(e){return new l.QualifiedLevel(n.qlevel.getDimension(e),n.qlevel.getLevel(e),n.qlevel.getHierarchy(e),n.qlevel.getLabel(e))};n.cloneIntersection=function(e){return new l.Intersection(e.qualified_level.map(n.cloneQualifiedLevel))};n.cloneMetricIntersection=function(e){return new l.MetricInter(e.metric,n.cloneIntersection(e.inter))};n.getSortedQualifiedLevelsGroupedByLabel=function(e,t){var i=s.groupBy(e,n.qlevel.getLabel);return Object.keys(i).reduce(function(e,r){e[r]=n.sortQualifiedLevelsByHierarchy(i[r],t);return e},{})};n.sortQualifiedLevelsByHierarchy=function(e,t){if(e.length===0)return e;var i=s.map(e,"level"),r=n.qlevel.getDimension(e[0]),o=t.findHierarchiesWithLevels(r,i),a=o.length>0?o[0].path:[],l=s.map(a,"level"),u=[],c=0,d;for(;c<l.length;c++){d=i.indexOf(l[c]);if(d>-1)u.push(e[d])}return u};n.isIntersectionEqualOrHigher=function(e,t,i){if(n.intersectionEqual(e,t)){return true}var r=n.getOverlappingLabels(e,t),o,a;if(e.qualified_level.length!==r.length){return false}else{o=s.groupBy(e.qualified_level,n.qlevel.getLabel);a=s.groupBy(t.qualified_level,n.qlevel.getLabel);return s.every(o,function(e,t){var r=e[0],n=a[t][0];return!i.qLevelBelow(r,n)})}};n.relabelQL=function(e,t){return new l.QualifiedLevel(e.dimension,e.level,e.hierarchy,t)};n.groupRollupsByDimension=function(e){var t={},i,r=[],o=0;e.forEach(function(e){var i=n.parseDimLvl(e.keyOrMeasure).dimension;if(!t[i]){t[i]=[]}t[i].push(e)});i=Object.keys(t);for(;o<i.length;o++)r.push(t[i[o]]);return r};n.getRollupCombinations=function(e){var t=[];function i(e,r){if(r.length!==0)t.push(r);e.forEach(function(t,n){t.forEach(function(t){i(e.slice(n+1),r.concat(t))})})}i(e,[]);return t};n.qlevel={getDimension:function(e){return e.dimension},getLevel:function(e){return e.level},getHierarchy:function(e){return e.hierarchy},getLabel:function(e){return s.isUndefined(e.label)?n.qlevel.getDimension(e):e.label},dimensionEquals:function(e){var t=this;return function(i){return t.getDimension(i)===e}},labelEquals:function(e){var t=this;return function(i){return t.getLabel(i)===e}},qLevelEqual:function(e,t,i){return function(r){return n.qLevelEqual(r,e,t,i)}},parseDimLvl:function(e){return function(t){return n.parseDimLvl(t,e)}}};n.isMeasuresQualifiedName=function(e){return e==="-:Measures"};n.isRealLevel=function(e){var t=n.qualifiedLevelToQualifiedName(e,true);return n.qNameIsRealLevel(t)};n.qNameIsRealLevel=function(e){return!n.isMeasuresQualifiedName(e)&&n.qlevel.getLevel(n.parseDimLvl(e,true))!=="ALL"};n.positionToLevels=function(e){var t=Object.keys(e),i=[],r=0;for(;r<t.length;r++)i.push(n.parseDimLvl(t[r],true));return i};n.getPositionIdForLevel=function(e,t){return e[n.qualifiedLevelToQualifiedName(t,true)]};n.legalizeLabel=function(e){return e.replace(new RegExp(/:/,"g"),"__")}},{"./logiql":300,"./util":357,assert:2,lodash:70,"measure-query-gen/src/MQG":1}],277:[function(e,t,i){"use strict";var r=e("../util");function n(e){this.$driver=e;this.actionsUrl=e.urls.actionsUrl}n.prototype.postAction=function(e){return this.$driver.http.post(this.actionsUrl,e,{Accept:"application/json"})};n.prototype.getAction=function(e){return this.$driver.http.get(this.actionsUrl+"/"+e).then(function(e){return e.length&&e[0]})};n.prototype.getActions=function(){return this.$driver.http.get(this.actionsUrl).then(function(e){return e})};t.exports=n},{"../util":357}],278:[function(e,t,i){"use strict";var r=e("../util");var n=e("../websocketparser");var o=e("../constant").Collaboration.EVENTS;var a=e("../constant").Collaboration.STANDARD_MESSAGE_TYPES;var s=e("lodash");function l(e,t,i){this.$callbacks=i;this.$driver=t;if(e){e.setRawMessageHandler(this.handleRawMessage.bind(this))}}l.prototype.handleRawMessage=function(e){var t=n.parseMessage(e);switch(t.type){case o.DATA_UPDATED:this.$callbacks.onDataUpdated(t);break;case o.ACTION_STATE_CHANGED:this.$callbacks.onActionStateChanged(t);break;case o.USER_LIST_UPDATED:this.$callbacks.onFullUserList(t).catch(console.error);break;case o.USER_CONNECTED:this.$callbacks.onPeerOpenConnection(t).catch(console.error);break;case o.USER_DISCONNECTED:this.$callbacks.onPeerCloseConnection(t).catch(console.error);break;case a.OPEN:this.$callbacks.onOpenConnection();break;case a.CLOSE:this.$callbacks.onCloseConnection();break;default:console.warn("Unknown message type.");break}};t.exports=l},{"../constant":256,"../util":357,"../websocketparser":522,lodash:70}],279:[function(e,t,i){"use strict";var r=e("../../logicblox.core/network").HttpHelper;function n(e){this.$driver=e}n.prototype.fetchFormattingConfig=function(){return this.$driver.http.post(this.$driver.urls.measureConfigUrl,{})};t.exports=n},{"../../logicblox.core/network":220}],280:[function(e,t,i){"use strict";var r=e("lodash");var n=e("../util/formulaast");var o=e("immutable");function a(e){this.$measureServiceUrl=e.urls.measureUrl;this.$rulesUrl=e.urls.rulesUrl;this.$http=e.http}a.prototype.installRules=function(e){var t=JSON.stringify({install_request:{rules:e}});return this.$http.post(this.$measureServiceUrl,t).catch(function(e){var t=e.body,i=t&&t.problem,n=i&&r.map(i,"text").join("\n");if(n){throw new Error(n)}else throw e})};a.prototype.fetchRules=function(){return this.$http.post(this.$rulesUrl,{}).then(function(e){return a.buildRuleObj(e.rule)})};a.buildRuleObj=function(e){var t={primary:{},inverses:{}},i=function(e){var t=r(e.formula&&e.formula[0]);if(!t){console.warn("Ignoring rule "+e.name+" since it is invalid.")}return t},r=function(e){var t=n.isValid(e);if(!t){console.warn("Ignoring formula "+e.name+" since it is invalid.")}return t};e&&e.filter(i).forEach(function(e){var i=new n(e.formula[0]),o=e.formula.slice(1).filter(r).map(function(e){return new n(e)}),a=i.name;if(t.primary[a]){console.error("A primary formula for "+a+" already exists")}t.primary[a]=i;t.inverses[a]=t.inverses[a]||[];o.forEach(function(e){t.inverses[a].push(e)})});return o.fromJS(t)};i.MeasureLanguageDAO=a},{"../util/formulaast":362,immutable:"immutable",lodash:70}],281:[function(e,t,i){"use strict";var r=e("lodash");var n=e("measure-query-gen/src/MQG");var o=e("../cubiql");var a=e("../util/promisecache");var s=Array.prototype.push;function l(e){this.$connectblox=e.connectblox;this.$http=e.http;this.$measureUrl=e.urls.measureUrl}l.prototype.fetchModel=function(){var e=this.$measureUrl,t=this.$http,i=new a;return i.concurrentPromise("fetchModel",function(){return t.post(e,new n.ModelRequestRequest).then(function(e){return e.model})})};l.prototype.setMeasureProperties=function(e,t,i){var r=this,n,a=[],l,u=false;if(i!==t){if(t==="RECALC"){n=e;s.apply(a,[o.retractMetricRecalc(e),o.assertMetricPredicate(e,n)])}else if(i==="RECALC"){n=e;s.apply(a,[o.retractMetricPredicate(e),o.assertMetricRecalc(e,n)]);u=true}if(i==="RECALC"||i===o.noneAgg){a.push(o.retractAggMethod(e))}else{a.push(o.upsertAggMethod(e,i))}l=a.join("\n");return r.$connectblox.execBlock(l).catch(function(e){var t=JSON.parse(e.responseText).error;throw new Error(["Error executing logic to set measure properties",t,e])}).then(function(){return r.$connectblox.restartMeasure()}).catch(function(e){throw new Error(["Error restarting measure service",e])}).then(function(){if(u){return r.$connectblox.query("_(name) <- lb:web:measure:Rule_name[_]=name.").then(function(t){if(u){assert(t,"MeasureWindow: Expected list of measure language rules.");var i=t.response.return_local[0].column[0].string_column,r=i.values||[];if(r.indexOf(e)===-1){var n="Metric '"+e+"' automatically defined using measure language rule named '"+e+"', but no such rule exists.  Metric cannot be viewed until such a rule is defined.";alert(n)}}})}})}else return Promise.resolve()};i.MeasureModelDAO=l},{"../cubiql":276,"../util/promisecache":364,lodash:70,"measure-query-gen/src/MQG":1}],282:[function(e,t,i){"use strict";var r=e("lodash");function n(e){this.message=e}function o(e){this.$driver=e}o.prototype.send=function(e){return this.$driver.http.post(this.$driver.urls.measureUrl,e).then(function(e){var t=e&&!r.isUndefined(e.exception),i=t&&e.problem,o=i&&i.filter(function(e){return e.severity==="ERROR"}).length>0;if(o){throw new n(r.map(i,"text").join("\n"))}else{return e}})};t.exports=o},{lodash:70}],283:[function(e,t,i){"use strict";var r=e("../../logicblox.core/network").HttpHelper;function n(e){this.$driver=e}n.prototype.fetchNavigationTreeConfig=function(e){var t=this.$driver.urls.navigationTreeUrl+"/"+e;return this.$driver.http.get(t)};n.prototype.setNavigationTreeConfig=function(e){var t=this.$driver.urls.navigationTreeUrl;return this.$driver.http.post(t,e)};t.exports=n},{"../../logicblox.core/network":220}],284:[function(e,t,i){"use strict";function r(e,t,i,r,n){this.$http=e;this.$realm=n;this.$currentUserUrl=t;this.$loginUrl=i;this.$logoutUrl=r}r.prototype.getCurrentUser=function(){return this.$http.getCurrentUser(this.$currentUserUrl)};r.prototype.authenticate=function(e,t){return this.$http.login(this.$loginUrl,e,t,this.$realm)};r.prototype.unauthenticate=function(){return this.$http.logout(this.$logoutUrl,"",this.$realm)};t.exports=r},{}],285:[function(e,t,i){"use strict";var r=e("lodash");function n(e){this.$driver=e;this.viewsConfigsUrl=e.urls.viewsConfigsUrl;this.viewsStatesUrl=e.urls.viewsStatesUrl;this.viewConfigUrl=e.urls.viewConfigUrl;this.viewStateUrl=e.urls.viewStateUrl}n.prototype.fetchConfigs=function(){return this.$driver.http.get(this.viewsConfigsUrl)};n.prototype.saveConfigs=function(e){return this.$driver.http.post(this.viewsConfigsUrl,{View:e})};n.prototype.fetchConfig=function(e){var t=this.$buildViewUrl(this.viewConfigUrl,e);return this.$driver.http.get(t)};n.prototype.saveConfig=function(e,t){var i=this.$buildViewUrl(this.viewConfigUrl,e);return this.$driver.http.post(i,t)};n.prototype.fetchStates=function(e){var t=this.$buildViewUrl(this.viewsStatesUrl,null,e);return this.$driver.http.get(t)};n.prototype.fetchState=function(e,t){var i=this.$buildViewUrl(this.viewStateUrl,e,t);return this.$driver.http.get(i)};n.prototype.saveState=function(e,t,i){var r=this.$buildViewUrl(this.viewStateUrl,e,i);return this.$driver.http.post(r,t)};n.prototype.saveStates=function(e,t){var i=this.$buildViewUrl(this.viewsStatesUrl,undefined,t);return this.$driver.http.post(i,{viewstates:e})};n.prototype.$buildViewUrl=function(e,t,i){var n={};if(t){n.id=t}if(i){n.user=i}if(Object.keys(n).length){e+="?"+r.map(n,function(e,t){return t+"="+e}).join("&")}return e};t.exports=n},{lodash:70}],286:[function(e,t,i){"use strict";function r(e){this.$driver=e;this.workbooksUrl=e.urls.workbooksUrl}r.prototype.get=function(e){return this.$driver.http.get(this.workbooksUrl,null,e).then(function(e){return e.workbooks||[]})};t.exports=r},{}],287:[function(e,t,i){var r=e("./constant").StorageTypes;var n=e("./util");var o=e("lodash");var a=500;var s=function(){this.$values={};this.$storages={};this.$asyncWaitForChanges(a)};s.prototype.add=function(e,t,i,r,n){if(!o.isFunction(n)){return}this.$storages[e]=r;this.$values[t]=this.$values[t]||{storageId:e,modified:null,props:{}};this.$values[t].props[i]=this.$values[t].props[i]||{modified:null,callback:n}};s.prototype.remove=function(e,t){if(this.$values[e]){delete this.$values[e].props[t];if(!o.keys(this.$values[e].props).length){delete this.$storages[this.$values[e].storageId];delete this.$values[e]}}};s.prototype.$asyncWaitForChanges=function(e){var t=this,i,r,n,a,s,l;var u=function(){o.delay(function(){n=Object.keys(t.$values);for(var e=0,c=n.length;e<c;e++){s=n[e];a=t.$values[s];r=t.$storages[a.storageId];i=r.getItem(s);if(i&&a.modified!==i.meta.modified){o.forEach(i.props,function(e,t){l=a.props[t];if(e.modified!==l.modified){l.modified=e.modified;o.delay(function(){l.callback()},0)}})}}u()},e)};u()};var l=new s;var u=function(e,t,i){Object.defineProperty(this,"value",{get:this.get.bind(this),set:this.set.bind(this)});this.$ownerId=e;this.$propertyName=t;this.$storageUid=o.uniqueId(e);this.$storageType=n.checkEnumValue(i,r,r.IN_MEMORY);this.$storage=this.$getStorage(this.$storageType);this.$propertyId=this.$getPropertyId();this.$value=this.$storage.getItem(this.$propertyId);this.$callbacks={}};u.prototype.get=function(){return this.$value};u.prototype.set=function(e){var t=Date.now();this.$storage.setItem(this.$propertyId,e);this.$value=e;this.$updateTimestamp(t);o.forEach(this.$callbacks,function(t){o.isFunction(t)&&t(e)})};u.prototype.subscribe=function(e){if(!o.isFunction(e)){return}var t=n.hashCode(e.toString());if(!Object.keys(this.$callbacks).length){l.add(this.$storageUid,this.$ownerId,this.$propertyName,this.$storage,this.$invokeCallback.bind(this))}this.$callbacks[t]=e};u.prototype.$invokeCallback=function(){var e=this.$storage.getItem(this.$propertyId);if(!o.eq(this.$value,e)){this.$value=e;o.forEach(this.$callbacks,function(t){o.isFunction(t)&&t(e)})}};u.prototype.unsubscribe=function(e){var t=n.hashCode(e.toString());delete this.$callbacks[t];if(!Object.keys(this.$callbacks).length){l.remove(this.$storageUid,this.$propertyName)}};u.prototype.destroy=function(){this.$callbacks=[];l.remove(this.$storageUid,this.$propertyName)};u.prototype.$updateTimestamp=function(e){var t=this.$storage.getItem(this.$ownerId);t.props[this.$propertyName].modified=e;t.meta.modified=e;this.$storage.setItem(this.$ownerId,t)};u.prototype.$getPropertyId=function(){var e=this.$storage.getItem(this.$ownerId),t;if(!e||!e.props){e={meta:{modified:null},props:{}}}t=e.props[this.$propertyName];if(!t){t={modified:null,uid:n.uuid()};e.props[this.$propertyName]=t;this.$storage.setItem(this.$ownerId,e)}return t.uid};u.prototype.$getStorage=function(e){switch(e){case r.LOCAL:return f;break;case r.SESSION:return p;break;case r.IN_MEMORY:default:return d;break}};var c=function(e){var t;if(typeof window!=="undefined"){switch(e){case r.LOCAL:t=h("localStorage")&&window.localStorage;break;case r.SESSION:t=h("sessionStorage")&&window.sessionStorage;break}}if(!t){return d}return{getItem:function(e){var i=t.getItem(e);try{return i&&JSON.parse(i)}catch(e){}},setItem:function(e,i){var r=o.isString(i)?i:JSON.stringify(i);t.setItem(e,r)},removeItem:function(e){t.removeItem(e)}}};var d=function(){var e={};return{getItem:function(t){return e[t]},setItem:function(t,i){e[t]=i},removeItem:function(t){delete e[t]}}}();var p=c(r.SESSION);var f=c(r.LOCAL);function h(e){try{var t=window[e],i="__storage_test__";t.setItem(i,i);t.removeItem(i);return true}catch(e){return false}}t.exports=u},{"./constant":256,"./util":357,lodash:70}],288:[function(e,t,i){"use strict";function r(){var e=[];var t=[];this.register=function(t){e.push(t);return e.length-1};this.destroy=function(){e=[]};this.dispatch=function(i){var r=[];var n=[];t=e.map(function(e,t){return new Promise(function(e,i){r[t]=e;n[t]=i})});var o=e.map(function(e,t){try{return Promise.resolve(e(i)).then(function(){r[t](i)},function(e){console.error(e.stack);n[t](new Error("Dispatcher callback unsuccessful"))})}catch(e){console.error(e.stack);n[t](new Error("Dispatcher callback unsuccessful"))}});t=[];return Promise.all(o)};this.waitFor=function(e,i){var r=e.map(function(e){return t[e]});return Promise.all(r).then(i).catch(function(e){console.error(e.stack)})};this.handleViewAction=function(e){return this.dispatch({actionType:"VIEW_ACTION",action:e})}}i.Dispatcher=r},{}],289:[function(e,t,i){"use strict";var r=e("lodash");var n=e("assert");function o(){}o.prototype.stopPropagation=function(){this.propagationStopped=true};o.prototype.preventDefault=function(){this.defaultPrevented=true};o.prototype._emit=o.prototype._dispatchEvent=function(e,t){this._eventRegistry||(this._eventRegistry={});this._defaultHandlers||(this._defaultHandlers={});var i=this._eventRegistry[e]||[],n,o=this._defaultHandlers[e];if(!i.length&&!o)return;if(typeof t!="object"||!t)t={};if(!t.type)t.type=e;if(!t.stopPropagation)t.stopPropagation=this.stopPropagation;if(!t.preventDefault)t.preventDefault=this.preventDefault;n=r.clone(i);for(var a=0;a<n.length;a++){try{n[a](t,this)}catch(e){console.error(e.stack||e);throw e}if(t.propagationStopped)break}if(o&&!t.defaultPrevented)return o(t,this)};o.prototype._signal=function(e,t){var i=(this._eventRegistry||{})[e];if(!i)return;for(var r=0;r<i.length;r++)i[r](t,this)};o.prototype.once=function(e,t){var i=this;t&&this.addEventListener(e,function r(){i.removeEventListener(e,r);t.apply(null,arguments)})};o.prototype.setDefaultHandler=function(e,t){this._defaultHandlers=this._defaultHandlers||{};if(this._defaultHandlers[e])throw new Error("The default handler for '"+e+"' is already set");this._defaultHandlers[e]=t};o.prototype.on=o.prototype.addEventListener=function(e,t,i){this._eventRegistry=this._eventRegistry||{};var r=this._eventRegistry[e];if(!r)r=this._eventRegistry[e]=[];if(r.indexOf(t)==-1)r[i?"unshift":"push"](t);return t};o.prototype.off=o.prototype.removeListener=o.prototype.removeEventListener=function(e,t){this._eventRegistry=this._eventRegistry||{};var i=this._eventRegistry[e];if(!i)return;var r=i.indexOf(t);if(r!==-1)i.splice(r,1)};o.prototype.removeAllListeners=function(e){if(e&&this._eventRegistry)this._eventRegistry[e]=[];else this._eventRegistry={}};o.prototype.executeWhen=function(e,t,i){var r=this;function n(i){if(e()){i();r.removeEventListener(t,n)}}if(e()){i()}else{this.addEventListener(t,n)}};function a(){}a.prototype.on=function(e,t,i){this.$eventEmitters=this.$eventEmitters||{};var r=Array.from(arguments);n(arguments.length===2||arguments.length===3);if(arguments.length===2){r.unshift("no-owners");e=r[0];t=r[1];i=r[2]}if(!this.$eventEmitters[e])this.$eventEmitters[e]=new o;var a=this.$eventEmitters[e];a.on(t,i)};a.prototype.once=function(e,t,i){this.$eventEmitters=this.$eventEmitters||{};var r=Array.from(arguments);n(r.length===2||r.length===3);
if(r.length===2){r.unshift("no-owners");e=r[0];t=r[1];i=r[2]}if(!this.$eventEmitters[e])this.$eventEmitters[e]=new o;var a=this.$eventEmitters[e];a.once(t,i)};a.prototype._emit=function(e,t,i){this.$eventEmitters=this.$eventEmitters||{};var r=this.$eventEmitters[e];if(r){r._emit(t,i)}r=this.$eventEmitters["no-owners"];if(r){r._emit(t,i)}};a.prototype.removeEventListener=function(e,t,i){this.$eventEmitters=this.$eventEmitters||{};var r=Array.from(arguments);n(r.length===2||r.length===3);if(r.length===2){r.unshift("no-owners");e=r[0];t=r[1];i=r[2]}var o=this.$eventEmitters[e];o.removeEventListener(t,i)};a.prototype.removeAllListeners=function(){this.$eventEmitters={}};i.EventEmitter=o;i.StoreEventEmitter=a},{assert:2,lodash:70}],290:[function(e,t,i){"use strict";var r=e("./util/excelcreator");var n=5e3;function o(e,t,i,o){var a={attributeOptions:{includeValue:true},builderOptions:{prebuildInfoAndData:false}},s=t.getModel(),l=t.getHeadingData(e,"exportExcel"),u=new r.ExcelCreator(s,l,"Y","X","Z"),c=l.getHeadingAxisInfo("X").getLength(),d=l.getHeadingAxisInfo("Y").getLength(),p=c>=d?"X":"Y",f=c>=d?c:d,h=c>=d?d:c,g=u.mkCellBuilder(),m=Math.max(Math.trunc(n/h),25),v=function(r){return function(){var n={Z:{length:1}};n[p]={start:r,length:f-r>m?m:f-r};if(r+n[p].length<f){setTimeout(v(r+m))}t.getDataRange(e,"exportExcel",n,g,true,a);if(r+n[p].length>=f){o(u.exportData(i))}}};setTimeout(v(0))}t.exports.getExportData=o},{"./util/excelcreator":361}],291:[function(e,t,i){"use strict";var r=e("./util");var n=t.exports;n.downloadFileContent=function(e,t,i){r.timedFn("Dumping "+e+" to file",function(e,t,i){var r=new Blob([t],{type:i});n.downloadFileBlob(e,r)})(e,t,i)};n.downloadFileBlob=function(e,t){var i=navigator.userAgent.match(/MSIE\s([\d.]+)/),r=navigator.userAgent.match(/Trident\/7.0/)&&navigator.userAgent.match(/rv:11/),n=navigator.userAgent.match(/Edge/g),o=i?i[1]:r?11:n?12:-1,a,s;if(i&&o<10){console.warn("No blobs on IE ver<10");return}if(o>-1){navigator.msSaveBlob(t,e)}else{a=URL.createObjectURL(t);s=document.createElement("a");s.style.display="none";document.body.appendChild(s);s.setAttribute("href",a);s.setAttribute("download",e);s.click();setTimeout(function(){URL.revokeObjectURL(a)});document.body.removeChild(s)}}},{"./util":357}],292:[function(e,t,i){"use strict";function r(){this.$formatters={};this.$regExp=new RegExp("([$â¬â¡Â£â¹Â¥â©â¦â±â²à¸¿â´â«%]|zÅ)?([#0]+)([\\.\\,])?([#0]+)?([\\.\\,])?(\\d+)?([$â¬â¡Â£â¹Â¥â©â¦â±â²à¸¿â´â«%]|zÅ)?");this.$prefixSymbolIndex=1;this.$postfixSymbolIndex=7;this.$thousandsDelimiterIndex=3}r.prototype.parse=function(e,t){var i=this.$getFormatterName(e,t),r=this.$formatters[i];if(!r){r=this.$parse(e,t);this.$formatters[i]=r}return r};r.prototype.$parse=function(e,t){var i=this.$getDefaultFormat(),r,n;if(t&&t.match){r=t.match(this.$regExp);n=r[this.$prefixSymbolIndex]||r[this.$postfixSymbolIndex];i.delimiters.thousands=r[this.$thousandsDelimiterIndex];i.delimiters.decimal=i.delimiters.thousands===","?".":",";if(n){if(n==="%"){i.isPercentage=true}else{i.currency={symbol:n,isPrefix:!!r[this.$prefixSymbolIndex]};i.isPercentage=false}}}return i};r.prototype.$getFormatterName=function(e,t){return e+":"+t};r.prototype.$getDefaultFormat=function(){return{isPercentage:false,delimiters:{thousands:",",decimal:"."}}};t.exports=new r},{}],293:[function(e,t,i){"use strict";var r=t.exports;var n=e("assert");var o=e("./formatparser");var a=e("numeral");var s=e("lodash");function l(e,t,i){if(e){if(i){if(i.currency&&i.currency.symbol){e=e.replace(i.currency.symbol,"$")}}else{t="en"}return function(i){a.language(t);return i&&a(i).format(e)}}else{return s.identity}}function u(e,t){var i;if(!t){e="en"}else{i=t.isPercentage}return function(t){a.language(e);return i&&!s.includes(t,"%")?a().unformat(t)/100:a().unformat(t)}}function c(e,t,i){var r,n;try{a.language(t)}catch(e){r=true}if(r&&i){a.language(t,i)}n={formatPattern:e,format:l(e,t,i),unformat:u(t,i),isPercentage:i&&i.isPercentage};return n}r.getFormatter=function(e,t,i){n(t||i,"Measure name and data type are required.");if(!e){return c(null,t)}var r=o.parse(i,e),a={delimiters:{thousands:r.delimiters.thousands,decimal:r.delimiters.decimal},abbreviations:{thousand:"[kK]",million:"[mM]",billion:"[bB]",trillion:"[tT]"},currency:{symbol:r.currency&&r.currency.symbol},isPercentage:r.isPercentage};return c(e,t,a)}},{"./formatparser":292,assert:2,lodash:70,numeral:71}],294:[function(e,t,i){"use strict";var r=e("lodash");var n="_fs_";var o=n+"shutdown";var a="fs.js";function s(e){window["_fs_debug"]=true;window["_fs_host"]="www.fullstory.com";window["_fs_org"]=e;(function(e,t,i,r,n,o,s,l){s=e[i]=function(e,t){s.q?s.q.push([e,t]):s._api(e,t)};s.q=[];o=t.createElement(r);o.async=1;o.src="https://"+_fs_host+"/s/"+a;l=t.getElementsByTagName(r)[0];l.parentNode.insertBefore(o,l);s.identify=function(e,t){s(n,{uid:e});if(t)s(n,t)};s.setUserVars=function(e){FS(n,e)};s.identifyAccount=function(e,t){o="account";t=t||{};t.acctId=e;FS(o,t)};s.clearUserCookie=function(e,i){e=t.domain;while(1){t.cookie="fs_uid=;domain="+e+";path=/;expires="+new Date(0);i=e.indexOf(".");if(i<0)break;e=e.slice(i+1)}}})(window,document,"FS","script","user")}function l(e,t){if(typeof FS==="undefined"){s(e)}FS.identify(t,{displayName:t})}function u(){var e;if(typeof FS!=="undefined"){FS.clearUserCookie();e=window[o];typeof e==="function"&&e();delete window.FS}c()}function c(){Object.keys(window).forEach(function(e){if(e.indexOf(n)===0){delete window[e]}});d(a)}function d(e){var t=document.getElementsByTagName("script"),i=t.length,r,n,o;for(o=i;o>=0;o--){r=t[o];n=r&&r.getAttribute("src");if(n&&n.indexOf(e)!==-1){r.parentNode&&r.parentNode.removeChild(r)}}}i.startFullStoryRecording=l;i.clearFullStoryRecording=u},{lodash:70}],295:[function(e,t,i){"use strict";var r=e("./multiaxisconfig");var n=e("lodash");var o=e("assert");var a=e("./querygen/results");var s=e("./querygen/util");var l=e("immutable");var u=e("./multiaxisheading");t.exports.HeadingGenerator=c;function c(e){this.$measureModel=e}c.prototype.generateMAHNestTerm=function(e,t,i,c,p){var f=this,h=this.$measureModel,g=e.fieldTerms.map(function(e){return r.getField(p,e.fieldId)}),m=g.filter(function(e){return e.displayMode===r.LevelDisplayMode.OUTLINE}),v=m.map(function(e){return e.id}),y=g.map(function(e){return e.id}),b=g.map(function(e){return r.levelToQualifiedLevel(e.level)}),w=new Map,C=new Map,E=new Map,S=new Map,T=new Map,x=true,_,M;b.forEach(function(e,r){var p=g.get(r),f=t.get(p),m=i.get(p),v=r>0&&g.get(r-1),y=v&&b.get(r-1),_=v&&v.id,M=p.id,A=v&&c.get(new l.List([v,p])),I=[],O=[],D=[],N,R,P,L,k,$,F,V,q,H=[],U=new Map,B=new Map,z=new Map,j,G,W=0;o(f.get("id"),"Expected to receive 'id' data for level's field data");f.keySeq().forEach(function(e){O.push(f.get(e));I.push(e)});P=I.indexOf("label")>-1?I.indexOf("label"):0;p.sortConfigs.forEach(function(e,t){var i=O.length;O.push(m[t]);var r={tableIdx:i,direction:e.sortType};if(m[t].resultTable)r.valueType=s.getMeasureValueType(m[t].resultTable.columnInfo[1].measure,h);D.push(r)});if(A){L=O.length;O.push(A)}k=O.every(function(e){return!n.isUndefined(e.resultTable)});$=O.some(function(e){return e.isDirty});if(k){N=a.unionResultTables(n.map(O,"resultTable"),D,[0]);R=N.dataTable;C.set(_,B);T.set(_,[]);E.set(M,H);for(;W<R.length;W++){G=R[W];V=G[1];q=new u.Member(V,G[P+1],d(G,p,I));z.set(V,q);if(y){F=G[L+1];U.set(V,F)}else{H.push(q)}j=B.get(F);if(j){j.push(V)}else{B.set(F,[V])}}}else{x=false}S.set(M,z);w.set(M,U)});function A(e){var t=e.id,i=y.indexOf(t);return{fieldId:t,fieldMembers:E.get(t),rollupConfig:e.rollupConfigs.size&&e.rollupConfigs.get(0),isOutline:e.displayMode===r.LevelDisplayMode.OUTLINE,memberLookup:S.get(t),parentToChildMap:C.get(t),mapping:T.get(t),immediateChildField:i<y.size-1&&g.get(i+1)}}function I(e,t,i,r){if(!e.immediateChildField)return;var o=e.immediateChildField,a=A(o),s=a.isOutline,l=a.fieldMembers,c=t.member,d;if(s){d=new u.Member(u.mkRollupMemberId(e.rollupConfig,c.config.field.id,c.id),!a.immediateChildField?c.label:"",t.rollupMemberConfig);l.push(d);if(i&&!n.isUndefined(r)){i.push([d.id,r])}}if(a.immediateChildField)I(a,t,s?a.mapping:i,s?d.id:r)}function O(e,t,i,r,n){if(!e.immediateChildField)return;var o=e.immediateChildField,a=A(o),s=a.isOutline,l=a.memberLookup,c=s?a.mapping:r,d=e.rollupConfig,p=d&&{rollupConfig:d,member:i,rollupMemberConfig:u.mkRollupMemberConfig(d,i)},f=a.fieldMembers,h,g,m,v,y=0,b,w;if(d)I(e,p,r,n);h=e.parentToChildMap.get(t);if(h&&h.length){for(y=0;y<h.length;y++){m=h[y];g=l.get(m);if(s){f.push(g);v=m}else{v=n}if(n&&r)r.push([m,n]);O(a,m,g,c,v)}}else if(n&&r){b=n+"_NO_CHILDREN";w=new u.Member(b,"",{field:o,invalidHeadings:true});r.push([b,n]);f.push(w);O(a,b,w,c,b)}}if(x){E.get(y.get(0)).forEach(function(e){var t=e.id,i=A(g.get(0)),r=i.isOutline&&i,n=r&&t,o=r&&r.mapping;O(i,t,e,o,n)});M=n.compact(v.map(function(e,t){if(t<m.size-1){return new u.FieldMap(m.get(t),m.get(t+1),T.get(e))}}).toArray());_=v.map(function(e,t){var i=E.get(e);return i.length?new u.FieldTerm(m.get(t),i):f.$createInvalidFieldTermForField(m.get(t))}).toArray()}else{M=n.compact(g.map(function(e,t){if(t<g.size-1){return new u.FieldMap(e,g.get(t+1),[[u.LOADING_MEMBER_ID,u.LOADING_MEMBER_ID]])}}).toArray());_=g.map(function(e,t){return f.$createLoadingFieldTermForField(e)}).toArray()}if(M.length&&_.length>1)return new u.NestTerm(e.fieldId,_,M);else return _[0]};c.prototype.generateMAHFieldTermForMeasureField=function(e,t){var i=r.getField(t,e.fieldId);return new u.FieldTerm(i,[new u.Member(i.id,i.fieldLabel,{field:i})])};c.prototype.generateMAHFieldTermForLevelField=function(e,t,i,s){var c=this,p=r.getField(s,e.fieldId),f=[],h=[],g=[],m=[],v,y=true,b,w=[],C,E,S,T=0;o(p,"Couldn't find field for id "+e.fieldId);o(t.get("id"),"Expected to receive 'id' data for level's field data");f.push(t.get("id"));h.push("id");p.data.forEach(function(e){f.push(t.get(e.name));h.push(e.name)});m=h.indexOf("label")>-1?h.indexOf("label"):0;(p.sortConfigs||new l.List).forEach(function(e,t){var n=f.length;f.push(i[t]);g.push({tableIdx:n,direction:e.sortType,valueType:r.getMeasureValueType(e.measure,c.$measureModel)})});y=f.every(function(e){return!n.isUndefined(e.resultTable)});if(y){v=a.unionResultTables(n.map(f,"resultTable"),g,[0]);b=v.dataTable;for(;T<b.length;T++){C=b[T];E=C[1];S=new u.Member(E,C[m+1],d(C,p,h));w.push(S)}return w.length?new u.FieldTerm(p,w):this.$createInvalidFieldTermForField(p)}else{return this.$createLoadingFieldTermForField(p)}};c.prototype.$createLoadingFieldTermForField=function(e){var t="Loading "+(e.fieldLabel||e.id)+"...";return new u.FieldTerm(e,[new u.Member(u.LOADING_MEMBER_ID,t,{field:e,loading:true})])};c.prototype.$createInvalidFieldTermForField=function(e){return new u.FieldTerm(e,[new u.Member(u.INVALID_MEMBER_ID,"",{field:e,invalidHeadings:true})])};function d(e,t,i){var r={field:t},n=i.length,o=1;for(;o<n;o++){r[i[o]]=e[o+1]}return r}},{"./multiaxisconfig":328,"./multiaxisheading":329,"./querygen/results":334,"./querygen/util":336,assert:2,immutable:"immutable",lodash:70}],296:[function(e,t,i){"use strict";var r=e("immutable");var n=e("../multiaxisconfig");var o=t.exports;o.getFieldStateFromStore=function(e){return e.getFields()};o.getFieldFromQualifiedName=function(e,t){return e.get(a(t,n.FieldTypes.LEVEL))||e.get(a(t,n.FieldTypes.MEASURE))||e.get(a(t,n.FieldTypes.MEASURE_GROUP))};o.getField=function(e,t,i){return e.get(a(t,i))};o.getLevelFieldsForDimension=function(e,t){return e.toList().filter(function(e){return e instanceof n.LevelField&&e.level.dimensionName===t})};function a(e,t){return r.Map({id:e,type:t})}o.getCanonicalMeasureGroup=function(e,t){var i=o.getField(e,t,n.FieldTypes.MEASURE_GROUP);if(!i){i=new n.MeasureGroupField({id:t,fieldLabel:t})}return i}},{"../multiaxisconfig":328,immutable:"immutable"}],297:[function(e,t,i){"use strict";var r=t.exports;r.getMeasureModelFromStore=function(e){return e.getModel()}},{}],298:[function(e,t,i){"use strict";var r=t.exports;var n=e("../constant").SORT;r.getPivotConfigFromStore=function(e){return{levelsConfig:e.getLevels(),metricsConfig:e.getMetricsConfig()}};r.getMetricFormat=function(e,t){var i=r.getMetricConfig[t];return i&&i.format};r.getMetricConfig=function(e,t){return e.metricsConfig&&e.metricsConfig[t]};r.getLevelDefaultSort=function(e,t){var i=this.getLevelConfig(e,t);return{sortAttr:i&&i.sortAttr||n.DEFAULT_ATTR,sortType:i&&i.sortType||n.DEFAULT_TYPE}};r.getLevelConfig=function(e,t){var i=t.dimensionName+":"+t.levelName;return e.levelsConfig&&e.levelsConfig[i]}},{"../constant":256}],299:[function(e,t,i){"use strict";var r=e("assert");var n=e("lodash");function o(e){this.formatter=e;this.SPREAD_METHOD_SUFFIX={E:"EVEN",R:"REPLICATE",P:"RATIO",D:"DELTA"};this.$isCalculatorRegExp=new RegExp("^(((\\+-|[+/*])(?=.*[^%]$))|(\\+-|\\+(?=.*%$)))");this.$isSpreadRegExp=new RegExp("[ERPD]$");this.NON_NUMERIC_TYPES=["STRING","NAMED","BOOLEAN"]}o.prototype.$isCalculator=function(e){var t=e.toString().match(this.$isCalculatorRegExp);return t&&t[0]};o.prototype.$isSpread=function(e){var t=e.toString().match(this.$isSpreadRegExp);return t&&t[0]};o.prototype.$adjustValueWithDelta=function(e,t,i){var o=this.formatter.unformat(t);var a=this.formatter.unformat(e);switch(i){case"+":case"+-":if(this.formatter.isPercentage||!n.includes(t,"%")){return a+o}else{return a+o*a}case"*":if(this.formatter.isPercentage){return a*o*100}return a*o;case"/":if(this.formatter.isPercentage){return a/(o*100)}return a/o;default:r(false,"Unsupported delta operator.")}};o.prototype.parseEditInput=function(e,t,i){var o,a,s={data:e,spreadMethod:undefined};if(!n.includes(this.NON_NUMERIC_TYPES,t)){o=this.$isCalculator(e);r(!(o&&!i),"Somehow an operator was applied to a cell we don't have data for, probably because it was offscreen. This is not currently supported.");if(o&&i){s.data=this.$adjustValueWithDelta(i,e,o[0])}else{s.data=e?this.formatter.unformat(e):undefined}a=this.$isSpread(e);if(a){s.spreadMethod=this.SPREAD_METHOD_SUFFIX[a[0]]}}return s};t.exports.createParser=function(e){return new o(e)}},{assert:2,lodash:70}],300:[function(e,t,i){"use strict";i.rule=function(e,t){return e+" <- "+t+"."};i.and=function(){return Array.prototype.slice.call(arguments,0).join(",")}},{}],301:[function(e,t,i){var r=e("./multiaxisconfig");var n=t.exports;n.validateRollupConfigs=function(e,t){var i=r.getAxisFields(e,function(e){return e instanceof r.LevelField}),n=[];i.forEach(function(e){if(e.rollupConfigs&&e.rollupConfigs.size>1)n.push("LevelFields may have at most 1 rollupconfig but '"+e.id+"' has more than 1")});return n}},{"./multiaxisconfig":328}],302:[function(e,t,i){"use strict";var r=e("lodash");var n=t.exports;n.rule=function(e,t){return'rule "'+e+'" { '+t.join(" ")+" }"};n.formula=function(e,t){return'formula "'+e+'" { '+t+" }"};n.parseFormula=function(e){var t=/\s*(\w+)[\s\[]*/.exec(e);if(t){return{name:t[1],body:e}}};n.RuleBuilder=o;function o(){this.$primaryFormula=null;this.$inverseFormulas=[]}o.newBuilder=function(){return new o};o.prototype.setPrimaryFormula=function(e){this.$primaryFormula=n.parseFormula(e);return this};o.prototype.setInverseFormulas=function(e){e=e||[];this.$inverseFormulas=e.map(function(e){return n.parseFormula(e)});return this};o.prototype.getRuleId=function(){return this.$primaryFormula.name};o.prototype.build=function(){var e=this.$primaryFormula,t=this.$inverseFormulas,i=[e].concat(t).map(function(e){return n.formula(e.name,e.body)});return n.rule(e.name,i)}},{lodash:70}],303:[function(e,t,i){var r=e("immutable");var n=e("assert");var o=e("lodash");var a=e("./cubiql");var s=["Boolean","Int","Float","String","Decimal"];var l=["NEGATE","SQRT","LOG","TO_UPPER","TO_LOWER","ADD","MAX","SUBTRACT","MULTIPLY","DIVIDE","FLOOR","CEIL","POW","MOD","ABS"];var u=["COLLECT","AMBIG","TOTAL","MIN","MAX","COUNT","MODE","COUNT_DISTINCT","HISTOGRAM","SORT","AVERAGE","KEY_SORT"];var c={aggregation:r.List,operator:r.List,metric:r.List,type:r.List,dimension:r.List};function d(e){e=e.withMutations(function(e){o.forEach(c,function(t,i){if(!e.has(i)){e.set(i,t())}})});var t=e.get("metric"),i=e.get("dimension");this.$model=e;this.$metrics=r.Map().withMutations(function(e){t.forEach(function(t){e.set(t.get("name"),t)})});this.$dimensions=r.Map().withMutations(function(e){i.forEach(function(t){e.set(t.get("name"),t)})})}d.prototype.isPrimitiveDimension=function(e){return s.indexOf(e)>-1};d.prototype.hasMeasureInfo=function(e){return this.$metrics.has(e)};d.prototype.hasDimension=function(e){return this.$dimensions.has(e)};d.prototype.getMeasureInfo=function(e){var t=this.$metrics.get(e);return t&&new f(t)};d.prototype.getBackingType=function(e){var t=this.$model.get("type").find(function(t){return t.get("type")===e});return t&&t.get("backing_type").get("kind")};d.prototype.getAttributeType=function(e,t,i){var r=this.$dimensions.get(t),n=r&&r.get("level").find(function(e){return e.get("name")===i}),o=n&&n.get("attribute").find(function(t){return t.get("name")===e}),a=o&&o.get("type").get("kind");return a};d.prototype.getParents=function(e,t,i){var n=this.$dimensions.get(e),o=n&&i?n.get("hierarchy").filter(function(e){return e.get("name")===i}):n.get("hierarchy"),s=r.Set();o.forEach(function(e){var i=e.get("path").skipUntil(function(e){return e.get("level")===t});s=s.concat(i.shift())});return s.map(function(t){return a.qualifiedName(e,t.get("level"))})};d.prototype.qLevelBelow=function(e,t){n(e instanceof Object&&e.hasOwnProperty("dimension")&&e.hasOwnProperty("level"));n(t instanceof Object&&t.hasOwnProperty("dimension")&&t.hasOwnProperty("level"));if(e.dimension!==t.dimension)return false;var i=this.getParents(e.dimension,e.level),r=a.qualifiedName(t.dimension,t.level);return i.has(r)||e.level!=="ALL"&&t.level==="ALL"};d.prototype.sortLevels=function(e,t){if(!Array.isArray(t)||t.length===0)return[];var i=t.map(function(e){return e.level}).filter(function(e){return e!=="ALL"}),r=this.$getHierarchiesForDimension(e),n=this.$getHierarchiesWithLevels(r,i),o;if(!n||n.size===0)return[];o=n.get(0).get("path");return t.slice().sort(function(e,t){var i=o.findIndex(function(t){return t.get("level")===e.level}),r=o.findIndex(function(e){return e.get("level")===t.level});return i>r?1:-1})};d.prototype.findLowestLevel=function(e,t){var i=this.sortLevels(e,t);return i.length>0?i[0]:undefined};d.prototype.findHighestLevel=function(e,t){var i=this.sortLevels(e,t);return i.length>0?i[i.length-1]:undefined};d.prototype.listLevelsInHierarchy=function(e){var t=a.parseDimLvl(e),i=this.$getHierarchiesForDimension(t.dimension),n=this.$getHierarchiesWithLevels(i,[t.level]);return n.map(function(e){return r.Map({name:e.get("name"),levels:e.get("path").map(function(e){return a.qualifiedName(t.dimension,e.get("level"))})})}).toJS()};d.prototype.getDefaultHierarchyName=function(e,t){var i=this.$dimensions.get(e),r=i.get("default_hierarchy");if(t)if(t==="ALL")return r;else return this.findHierarchiesWithLevels(e,[t])[0].name;else return r};d.prototype.$getHierarchiesForDimension=function(e){var t=this.$dimensions.get(e),i=t&&t.get("hierarchy")||i.List(),r=t.get("default_hierarchy");return i.sortBy(function(e){var t=e.get("name");if(t===r){return""}else{return t}})};d.prototype.$getHierarchiesWithLevels=function(e,t){return e.filter(function(e){var i=e.get("path").map(function(e){return e.get("level")});return i.isSuperset(t)})};d.prototype.findHierarchiesWithLevels=function(e,t){var i=this.$getHierarchiesForDimension(e),r=this.$getHierarchiesWithLevels(i,t);return r.toJS()};var p=new RegExp("_(first|last)$");d.prototype.getHierarchyWith=function(e,t){var i=this.$getHierarchiesForDimension(e),r=this.$getHierarchiesWithLevels(i,t).filter(function(e){return!p.test(e.get("name"))});return r.size>0&&r.first().toJS()};d.prototype.getLevelNameByPredicate=function(e){var t=r.Map({kind:"NAMED",named:e});return this.$model.get("dimension").reduce(function(e,i){if(e)return e;var n=i.get("level").find(function(e){return r.is(e.get("type"),t)});if(n)return a.qualifiedName(i.get("name"),n.get("name"))},false)};d.prototype.getDimension=function(e){var t=this.$dimensions.get(e);return t&&t.toJS()};d.prototype.getNonPrimitiveDimensions=function(){return this.$model.get("dimension").filterNot(function(e){return this.isPrimitiveDimension(e.get("name"))},this).toJS()};d.prototype.getLevel=function(e,t){var i=this.$dimensions.get(e).get("level").find(function(e){return e.get("name")===t});return i&&i.toJS()};d.prototype.getLevelAttr=function(e,t){return e.attribute.find(function(e){return e.name===t})};d.prototype.getLevelAttributePredicateName=function(e,t){return this.getLevelAttr(e,t).predicate.name};d.prototype.sortHierarchies=function(e,t){e.sort(function(e,i){if(e.name===t)return-1;else if(i.name===t)return 1;else return e.name.localeCompare(i.name)});return e};d.prototype.isRecalc=function(e){return this.$metrics.get(e).has("recalc")};d.prototype.isPctParentMetric=function(e){var t=this.$getMetricIntersection(e).get("qualified_level");if(!this.isRecalc(e))return false;return t.groupBy(function(e){return e.get("dimension")}).some(function(e){return e.size===2})};d.prototype.getPctParentConfig=function(e){var t=this.$getMetricIntersection(e).get("qualified_level"),i=t&&t.groupBy(function(e){return e.get("dimension")}),r=i&&i.find(function(e){return e.size===2});if(!r||!this.isRecalc(e))return;return{dimension:r.get(0).get("dimension"),childLabel:r.get(0).get("label"),parentLabel:r.get(1).get("label")}};d.prototype.$getMetricIntersection=function(e){return this.$metrics.get(e).get("signature").get("base_signature").get("intersection")};d.prototype.getOperator=function(e,t){return this.$model.get("operator").find(function(i){return i.get("name")===e&&(!t||r.is(r.fromJS(t),i.get("domain")))})};d.prototype.getMetrics=function(){return this.$metrics.toList()};d.prototype.getAggregation=function(e){return this.$model.get("aggregation").find(function(t){return t.get("name")===e})};d.prototype.getSpreadDefinition=function(e){return this.$model.get("spread").find(function(t){return t.get("name")===e})};d.prototype.getPrimitiveAggMethods=function(){return u};d.prototype.getLowestLevelsInDimension=function(e){var t=this.$dimensions.get(e).get("hierarchy"),i=[];t.forEach(function(t){var r=t.getIn(["path",0]);i.push(a.qualifiedName(e,r.get("level")))});return i};function f(e){this.$metric=e}Object.defineProperties(f.prototype,{name:{get:function(){return this.$metric.get("name")}},inter:{get:function(){var e=this.$metric.getIn(["signature","base_signature","intersection"]);return e.size>0?e.toJS():{qualified_level:[]}}},caption:{get:function(){return this.$metric.has("caption")?this.$metric.get("caption"):undefined}},predicate:{get:function(){return this.$metric.has("predicate")?this.$metric.get("predicate"):undefined}},recalc:{get:function(){return this.$metric.has("recalc")?this.$metric.get("recalc").toJS():undefined}},type:{get:function(){return this.$metric.getIn(["signature","base_signature","type","type"]).toJS()}},agg_method:{get:function(){return this.$metric.has("agg_method")?this.$metric.get("agg_method").toJS():undefined}},update_method:{get:function(){return this.$metric.has("update_method")?this.$metric.get("update_method").toJS():undefined}}});t.exports=d},{"./cubiql":276,assert:2,immutable:"immutable",lodash:70}],304:[function(e,t,i){"use strict";var r;var n=e("./util");var o=function(e){r=e};(function(){this.addLevel=l;this.renameMetric=d;this.addMetric=function(e,t,i){return p(e,t,i)};this.addParentLevel=c}).call(o.prototype);function a(e){var t="###ABORT###";var i="###ENDABORT###";var r=e.substring(e.indexOf(t)+t.length,e.indexOf(i));var n=r.split("###");var o;if(n.length==2){o={error_code:n[0],error_message:n[1]}}else{o={error_message:e}}return o}function s(e,t){Object.keys(t).forEach(function(i){var r=t[i];e=e.replace(new RegExp(n.escapeRegExp(i),"g"),r)});return e}function l(e){var t={$levelName:e,$refModePredName:e+"_id",$labelPredName:e+"_label"},i=function(e){return s(e,t)},n=i('+lb:web:config:abort:error_response(500, "Dimension $levelName already exists.")'+"   <-"+"    lb:web:measure:Dimension_name@prev[dim] = name,\n"+'    name = "$levelName".'),o=i("$levelName(f), $refModePredName(f:id) -> string(id).\n"+"$labelPredName[f] = label -> $levelName(f), string(label).\n"+"lang:entity(`$levelName)."),l=i("+lb:web:measure:Dimension(dim),"+"+pivot:measure:metamodel:Dim_cons[mm, name] = dim,"+"\n"+"+lb:web:measure:Dimension:Hierarchy(hier),"+"+pivot:measure:metamodel:Hier_cons[dim, hier_name] = hier,"+"+lb:web:measure:Dimension_default_hierarchy[dim] = hier_name,"+"\n"+"+lb:web:measure:Dimension:Level(level),"+"+pivot:measure:metamodel:Level_cons[dim, name] = level,"+"+lb:web:measure:Dimension:Level_type[level] = new_level_type,"+"+pivot:measure:metamodel:Type_cons[name] = new_level_type,\n"+"+lb:web:measure:Type(new_level_type),\n"+'+lb:web:measure:Type_kind[new_level_type] = lb:web:measure:Type:Kind_enum["NAMED"],\n'+"+lb:web:measure:Type_named[new_level_type] = name,\n"+"\n"+"+lb:web:measure:Dimension:Hierarchy:Path(path),"+"+pivot:measure:metamodel:Path_cons[hier, name] = path,"+"+lb:web:measure:Dimension:Hierarchy_path[hier, 0] = path,\n"+"\n"+'+pivot:measure:metamodel:Attr_cons[level, "id"] = id_attr,'+"+lb:web:measure:Attribute(id_attr),"+'+lb:web:measure:Attribute_name(id_attr, "id"),'+"+lb:web:measure:Attribute_type[id_attr] = string_type,"+"+lb:web:measure:Attribute_predicate(id_attr, refPred),"+"\n"+'+pivot:measure:metamodel:Predicate_cons["$refModePredName"] = refPred,'+"+lb:web:measure:Predicate(refPred),"+'+lb:web:measure:Predicate_name(refPred, "$refModePredName"),'+"\n"+'+pivot:measure:metamodel:Attr_cons[level, "label"] = label_attr,'+"+lb:web:measure:Attribute(label_attr),"+"+lb:web:measure:Attribute_type[label_attr] = string_type,"+"+lb:web:measure:Attribute_predicate(label_attr, labelPred),"+"\n"+'+pivot:measure:metamodel:Predicate_cons["$labelPredName"] = labelPred,'+"+lb:web:measure:Predicate(labelPred),"+'+lb:web:measure:Predicate_name(labelPred, "$labelPredName"),'+"\n"+"+lb:web:measure:Type(string_type),"+"+lb:web:measure:Type_kind[string_type] = kind,"+'+modeler_config:metamodel:config:type_fromtypename["STRING"] = string_type '+"\n"+"    <-"+"    lb:web:measure:MeasureModel(mm),"+'    hier_name = "Default",'+'    kind = lb:web:measure:Type:Kind_enum["STRING"],'+'    name = "$levelName".\n');return r.execBlock(n).catch(function(e){throw{message:a(e.message).error_message,error:e.message}}).then(function(){return r.addBlock(o)}).catch(function(e){if(e.message)throw e;throw{message:"Error adding level predicate",error:e}}).then(function(){return r.execBlock(l)}).catch(function(e){if(e.message)throw e;var t=JSON.parse(e.responseText).error;throw new Error({message:a(t).error_message,error:t})})}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,i=e=="x"?t:t&3|8;return i.toString(16)})}function c(e,t,i,n,o){var l=e+"2"+n,c=n.toLowerCase()+"-1",d=u(),p={$levelName:e,$dimensionName:t,$hierarchyName:i,$newLevelName:n,$newDimensionName:o,$newLevelRefPredName:n+"_id",$newLevelLabelPredName:n+"_label",$mappingPredicate:l,$newMemberId:d,$newMemberValue:c},f=function(e){return s(e,p)},h=f('+lb:web:config:abort:error_response(500, "A dimension named $dimensionName already exists.")'+"   <-"+'    old_dimension_name = "$dimensionName",\n'+'    dimension_name = "$newDimensionName",\n'+"    lb:web:measure:Dimension@prev(dim),"+"    old_dimension_name != dimension_name,"+"   lb:web:measure:Dimension_name@prev[dim] = dimension_name."+'+lb:web:config:abort:error_response(500, "A level named $newLevelName already exists in dimension $newDimensionName.")'+"   <-"+'    dimension_name = "$newDimensionName",\n'+'    name = "$newLevelName",'+"    lb:web:measure:Dimension_name[dim] = dimension_name,\n"+"    lb:web:measure:Dimension_level@prev(dim, level),\n"+"   lb:web:measure:Dimension:Level_name@prev[level] = name."+"\n"+'+lb:web:config:abort:error_response(500, "Base level $levelName is not at top of hierarchy"\n)'+"    <-\n"+'    dimension_name = "$newDimensionName",\n'+'    hierarchy_name = "$hierarchyName",\n'+'    level_name = "$levelName",\n'+"    lb:web:measure:Dimension_name[dim] = dimension_name,\n"+"    pivot:measure:metamodel:Hier_cons@prev[dim, hierarchy_name] = hier,\n"+"    lb:web:measure:Dimension:Hierarchy_path@prev[hier, i] = path,\n"+"    lb:web:measure:Dimension:Hierarchy:Path_level@prev[path] = level_name,\n"+"    i < _max_level_index[hier].\n"+"_max_level_index[hier] = max_i\n"+"    <-"+"    agg<<max_i = max(i)>>\n"+"    lb:web:measure:Dimension:Hierarchy_path@prev[hier, i] = _.\n"),g=f("$newLevelName(f), $newLevelRefPredName(f:id) -> string(id).\n"+"$newLevelLabelPredName[f] = label -> $newLevelName(f), string(label).\n"+"$mappingPredicate[l1] = l2 -> $levelName(l1), $newLevelName(l2)."+"lang:entity(`$newLevelName)."),m=f("^lb:web:measure:Dimension_name[dim] = dimension_name\n"+"    <-\n"+'    dimension_name = "$newDimensionName",\n'+'    old_dimension_name = "$dimensionName",\n'+"    lb:web:measure:Dimension_name@prev[dim] = old_dimension_name.\n"+"+pivot:measure:metamodel:Level_cons[dim, new_level_name] = level,\n"+"+lb:web:measure:Dimension:Level(level),\n"+"+lb:web:measure:Dimension:Level_type[level] = new_level_type,\n"+"+pivot:measure:metamodel:Type_cons[new_level_name] = new_level_type,\n"+"+lb:web:measure:Type(new_level_type),\n"+'+lb:web:measure:Type_kind[new_level_type] = lb:web:measure:Type:Kind_enum["NAMED"],\n'+"+lb:web:measure:Type_named[new_level_type] = new_level_name,\n"+"\n"+"+lb:web:measure:Attribute(id_attr),\n"+'+pivot:measure:metamodel:Attr_cons[level, "id"] = id_attr,\n'+"+lb:web:measure:Attribute_predicate(id_attr, id_pred),\n"+'+pivot:measure:metamodel:Predicate_cons["$newLevelRefPredName"] = id_pred,\n'+"+lb:web:measure:Predicate(id_pred),\n"+'+lb:web:measure:Predicate_name(id_pred, "$newLevelRefPredName"),\n'+"+lb:web:measure:Attribute_type[id_attr] = string_type,\n"+"\n"+"+lb:web:measure:Attribute(label_attr),\n"+'+pivot:measure:metamodel:Attr_cons[level, "label"] = label_attr,\n'+"+lb:web:measure:Attribute_predicate(label_attr, label_pred),\n"+'+pivot:measure:metamodel:Predicate_cons["$newLevelLabelPredName"] = label_pred,\n'+"+lb:web:measure:Predicate(label_pred),\n"+'+lb:web:measure:Predicate_name(label_pred, "$newLevelLabelPredName"),\n'+"+lb:web:measure:Attribute_type[label_attr] = string_type,\n"+"+lb:web:measure:Type(string_type),"+"+lb:web:measure:Type_kind[string_type] = string_kind,"+'+modeler_config:metamodel:config:type_fromtypename["STRING"] = string_type '+"    <-\n"+'    lb:web:measure:Type:Kind_enum["STRING"] = string_kind,\n'+'    dimension_name = "$newDimensionName",\n'+'    new_level_name = "$newLevelName",\n'+"    lb:web:measure:Dimension_name[dim] = dimension_name.\n"+"+pivot:measure:metamodel:Hier_cons[dim, hierarchy_name] = hier,\n"+"+lb:web:measure:Dimension:Hierarchy(hier),\n"+"\n"+"+pivot:measure:metamodel:Path_cons[hier, new_level_name] = path,\n"+"+lb:web:measure:Dimension:Hierarchy:Path(path),\n"+"+lb:web:measure:Dimension:Hierarchy_path[hier, 1] = path,\n"+"\n"+"+pivot:measure:metamodel:Path_cons[hier, base_level_name] = moved_path,\n"+"+lb:web:measure:Dimension:Hierarchy_path[hier, 0] = moved_path,\n"+"+lb:web:measure:Dimension:Hierarchy:Path(moved_path),\n"+"+lb:web:measure:Dimension:Hierarchy:Path_pred[moved_path] = mapping_predicate,\n"+"+pivot:measure:metamodel:Predicate_cons[mapping_predicate_name] = mapping_predicate,\n"+"+lb:web:measure:Predicate(mapping_predicate),\n"+"+lb:web:measure:Predicate_name(mapping_predicate, mapping_predicate_name)\n"+"    <-\n"+'    dimension_name = "$newDimensionName",\n'+'    new_level_name = "$newLevelName",\n'+'    hierarchy_name = "$hierarchyName",\n'+'    base_level_name = "$levelName",\n'+'    mapping_predicate_name = "$mappingPredicate",\n'+"    !(pivot:measure:metamodel:Hier_cons@prev[dim, hierarchy_name] = _),\n"+"    pivot:measure:metamodel:Level_cons@prev[dim, base_level_name] = _,\n"+"    lb:web:measure:Dimension_name[dim] = dimension_name.\n"+"\n"+"+pivot:measure:metamodel:Path_cons[hier, new_level_name] = path,\n"+"+lb:web:measure:Dimension:Hierarchy:Path(path),\n"+"+lb:web:measure:Dimension:Hierarchy_path[hier, i + 1] = path,\n"+"+lb:web:measure:Dimension:Hierarchy:Path_pred[base_path] = mapping_predicate,\n"+"+pivot:measure:metamodel:Predicate_cons[mapping_predicate_name] = mapping_predicate,\n"+"+lb:web:measure:Predicate(mapping_predicate),\n"+"+lb:web:measure:Predicate_name(mapping_predicate, mapping_predicate_name)\n"+"    <-\n"+'    dimension_name = "$newDimensionName",\n'+'    new_level_name = "$newLevelName",\n'+'    hierarchy_name = "$hierarchyName",\n'+'    mapping_predicate_name = "$mappingPredicate",\n'+"    lb:web:measure:Dimension_name[dim] = dimension_name,\n"+"    pivot:measure:metamodel:Hier_cons@prev[dim, hierarchy_name] = hier,\n"+"    lb:web:measure:Dimension:Hierarchy_path@prev[hier, i] = base_path,\n"+"    _max_level_index[hier] = i.\n"+"_max_level_index[hier] = max_i\n"+"    <-"+"    agg<<max_i = max(i)>>\n"+"    lb:web:measure:Dimension:Hierarchy_path@prev[hier, i] = _.\n"+"+$mappingPredicate(l1, l2)\n"+"    <-\n"+'  $newLevelRefPredName[l2] = "$newMemberId",\n'+"  $levelName@prev(l1).\n"+'+$newLevelName(l), +$newLevelRefPredName[l] = "$newMemberId", +$newLevelLabelPredName[l] = "$newMemberValue".\n');
return r.execBlock(h).catch(function(e){var t=JSON.parse(e.responseText).error;throw new Error(a(t).error_message)}).then(function(){return r.addBlock(g)}).catch(function(e){if(e.message)throw e;throw new Error("Could not create level predicate")}).then(function(){return r.execBlock(m)}).catch(function(e){if(e.message)throw e;var t=JSON.parse(e.responseText).error;throw new Error(a(t).error_message)})}function d(e,t){var i="^lb:web:measure:Metric_caption[metric] = caption,"+"^lb:web:measure:Metric_name[metric] = caption"+"    <-"+"    lb:web:measure:Metric(metric),"+"    lb:web:measure:Metric_name@prev[metric] = name,"+'    name = "'+e+'",\n'+'    caption = "'+t+'".\n';return r.execBlock(i).catch(function(e){if(e.message)throw e;var t=JSON.parse(e.responseText).error;throw{message:a(t).error_message,error:t}}).then(function(){return r.restartMeasure()}).catch(function(e){if(e.message)throw e;throw{message:"Error restarting measure service",error:e}})}function p(e,t,i){var n='+lb:web:measure:Intersection(intersection), +pivot:measure:metamodel:Intersection_cons["'+u()+'"] = intersection,';var o="decimal(f)";var s=function(e){var t={};e.forEach(function(e){if(typeof t[e.dimension]==="undefined"){t[e.dimension]=[]}t[e.dimension].push(e.name)});return t};var l=function(e,t){var i=function(e){return t.every(function(t){return e.path.find(function(e){return t===e.level})})};var r=e.filter(i);if(r.length===0)throw new Error("All levels must be in same hierarchy.");var n=r[0];var o=n.path.map(function(e){return e.level});var a=1e9;t.forEach(function(e){var t=o.indexOf(e);if(t>-1&&t<a)a=t});return n.path[a].level};var c=[];var d=s(t);Object.keys(d).forEach(function(e){var t=i.find(function(t){return t.name===e});if(t){var r=t.hierarchy;var n=d[e];var o=l(r,n);var a=t.level.find(function(e){return e.name===o});c.push({dimension:e,name:a.name,impl:a.type.named})}});var p="";var f=[];for(var h=0;h<c.length;h++){var g=c[h];f.push("p"+h);o+=","+g.impl+"(p"+h+")";n+="+pivot:measure:metamodel:QualifiedLevel_cons[dim"+h+", level"+h+"] = qualifiedlevel_"+h+","+"+lb:web:measure:QualifiedLevel(qualifiedlevel_"+h+"),"+"+lb:web:measure:Intersection_qualified_level[intersection,"+h+"] = qualifiedlevel_"+h+",";p+="lb:web:measure:Dimension_name[dim"+h+'] = "'+g.dimension+'",'+"lb:web:measure:Dimension:Level_name[level"+h+'] = "'+g.name+'",'}f="["+f.join(", ")+"]";o+=".\n";var m="Custom_Metric"+u().replace(/-/g,"_");var v=e;var y=m+f+"= f -> "+o;var b="lb:web:measure:Metric@prev(metric),"+'name = "'+v+'"'+"   ->"+"   lb:web:measure:Metric_name@prev[metric] != name."+""+n+""+"+lb:web:measure:Predicate(predicate),"+"+pivot:measure:metamodel:Predicate_cons[predicate_name] = predicate,"+""+"+lb:web:measure:Metric(metric),"+"+lb:web:measure:Metric_name[metric] = caption,"+"+pivot:measure:metamodel:Metric_cons[id, name] = metric,"+"+lb:web:measure:Metric_type[metric] = decimal_type,"+"+lb:web:measure:Metric_agg_method[metric] = agg_type,"+"+lb:web:measure:Metric_update_method[metric] = spread_type,"+"+lb:web:measure:Metric_predicate[metric] = predicate,"+"+lb:web:measure:Metric_inter[metric] = intersection,"+"+lb:web:measure:Metric_caption[metric] = caption,"+"\n"+"+lb:web:measure:Type(decimal_type),"+"+lb:web:measure:Type_kind[decimal_type] = decimal_kind,"+'+modeler_config:metamodel:config:type_fromtypename["DECIMAL"] = decimal_type '+"    <-"+p+'     lb:web:measure:Type:Kind_enum["DECIMAL"] = decimal_kind,\n'+"     lb:web:measure:AggExpr:Method_primitive[agg_type] = agg_kind,\n"+'     lb:web:measure:AggExpr:Method:Primitive_enum["TOTAL"] = agg_kind,\n'+"     lb:web:measure:UpdateExpr:Transform:SpreadKind_primitive[spread_type] = spread_kind,\n"+'     lb:web:measure:UpdateExpr:Transform:SpreadKind:Primitive_enum["RATIO"] = spread_kind,\n'+"    lb:web:measure:MeasureModel(id),"+'    name = "'+m+'",\n'+'    caption = "'+v+'",\n'+"    predicate_name = name.\n";return r.addBlock(y).catch(function(e){throw new Error("Could not create metric predicate")}).then(function(){return r.execBlock(b)}).catch(function(e){if(e.message)throw e;var t=JSON.parse(e.responseText).error;throw new Error(a(t).error_message)}).then(function(){return r.restartMeasure()}).catch(function(e){if(e.message)throw e;throw new Error("Error restarting measure service")})}i.addLevel=l;i.addMetric=p;i.addParentLevel=c;i.uuid=u;i.MeasureServiceMetaModel=o;i.parseErrorMessage=a},{"./util":357}],305:[function(e,t,i){var r=e("react");var n=e("react-addons-pure-render-mixin");var o=e("popupmenu").MenuItem;var a=e("popupmenu").MenuItemsTypes;var s=e("../util/viewlayoututils");var l=e("../view/sheetconfigurationpanel");var u=e("../view/sheetview");var c=e("../constant");var d=c.Layout;var p=c.View;var f=d.VIEW_MODE;var h=c.ContextMenu.MenuItemInfo;var g=c.ContextMenu.IconInfo;var m=r.createClass({displayName:"ConfigurationMenuSection",mixins:[n],propTypes:{sheetId:r.PropTypes.string.isRequired,sheetUniqueId:r.PropTypes.string.isRequired,modelerApp:r.PropTypes.object.isRequired,openComponentFn:r.PropTypes.func.isRequired,sheetViewMode:r.PropTypes.string.isRequired,sheetConfig:r.PropTypes.object,fromCell:r.PropTypes.bool,onClose:r.PropTypes.func},$switchViewMode:function(e,t){e=e||this.props.sheetUniqueId;return this.props.modelerApp.getViewActionHandler().setViewMode(e,t)},$switchPanel:function(e,t){var i=s.getInlineViewId(this.props.sheetConfig,p.Modules.SheetConfigurationPanel),r=s.getInlineViewState(this.props.sheetConfig,p.Modules.SheetConfigurationPanel);r=l.toogleComponentVisibility(r,t);this.props.openComponentFn(i,e,r)},$isPanelOpened:function(e){var t=s.getInlineViewState(this.props.sheetConfig,p.Modules.SheetConfigurationPanel);return l.isComponentOpened(t,e)},$isPanelDisabled:function(){return!u.isViewModuleAllowed(p.Modules.SheetConfigurationPanel,this.props.sheetViewMode)},$switchConfigurationMode:function(){var e=this.props.sheetViewMode===f.DEFAULT?f.CONFIGURATION:f.DEFAULT;this.$switchViewMode(this.props.sheetUniqueId,e)},$switchModelBrowser:function(){var e={options:{size:"200px",openIn:d.POSITION.LEFT}};this.$switchPanel(e,p.Modules.ModelBrowser)},$switchVisibleMeasures:function(){var e={options:{size:"200px",openIn:d.POSITION.LEFT}};this.$switchPanel(e,p.Modules.Measures)},$switchChartMode:function(){var e=s.getInlineViewId(this.props.sheetConfig,p.Modules.PivotGrid),t=this.props.modelerApp.getViewStore(),i,r,n;if(e){i=t.getViewUniqueId(this.props.sheetUniqueId,e);r=s.getCurrentViewModeInParentLayout(e,this.props.sheetConfig);n=r===f.DEFAULT?f.CHART:f.DEFAULT;this.$switchViewMode(i,n)}},$chartModeChecked:function(){var e=s.getInlineViewId(this.props.sheetConfig,p.Modules.PivotGrid);return!!e&&s.getCurrentViewModeInParentLayout(e,this.props.sheetConfig)!==f.DEFAULT},render:function(){return r.DOM.div({},r.createElement(o,{key:h.ConfigurationMode.key,label:h.ConfigurationMode.label,itemType:a.MenuItem,iconName:this.props.sheetViewMode===f.CONFIGURATION?g.Checked:"",onClick:this.$switchConfigurationMode,onClose:this.props.onClose}),this.props.fromCell||this.$isPanelDisabled()?null:r.createElement(o,{key:h.ModelBrowser.key,label:h.ModelBrowser.label,itemType:a.MenuItem,iconName:this.$isPanelOpened(p.Modules.ModelBrowser)?g.Checked:"",onClick:this.$switchModelBrowser,onClose:this.props.onClose}),this.props.fromCell||this.$isPanelDisabled()?null:r.createElement(o,{key:h.Measures.key,label:h.Measures.label,itemType:a.MenuItem,iconName:this.$isPanelOpened(p.Modules.Measures)?g.Checked:"",onClick:this.$switchVisibleMeasures,onClose:this.props.onClose}),r.createElement(o,{key:h.ChartMode.key,label:h.ChartMode.label,itemType:a.MenuItem,iconName:this.$chartModeChecked()?g.Checked:"",disabled:!s.getInlineViewId(this.props.sheetConfig,p.Modules.PivotGrid),onClick:this.$switchChartMode,onClose:this.props.onClose}))}});t.exports=m},{"../constant":256,"../util/viewlayoututils":367,"../view/sheetconfigurationpanel":487,"../view/sheetview":488,popupmenu:146,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],306:[function(e,t,i){var r=e("react");var n=e("react-addons-pure-render-mixin");var o=e("popupmenu").MenuItem;var a=e("popupmenu").MenuItemsTypes;var s=e("../constant");var l=s.ContextMenu.MenuItemInfo;var u=r.createClass({displayName:"ExportMenuSection",mixins:[n],propTypes:{exportToCsv:r.PropTypes.func.isRequired,exportToExcel:r.PropTypes.func.isRequired,onClose:r.PropTypes.func},render:function(){return r.DOM.div({},r.createElement(o,{key:l.ExportToCsv.key,label:l.ExportToCsv.label,itemType:a.MenuItem,onClick:this.props.exportToCsv,onClose:this.props.onClose}),r.createElement(o,{key:l.ExportToExcel.key,label:l.ExportToExcel.label,itemType:a.MenuItem,onClick:this.props.exportToExcel,onClose:this.props.onClose}))}});t.exports=u},{"../constant":256,popupmenu:146,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],307:[function(e,t,i){var r=e("react");var n=e("react-addons-pure-render-mixin");var o=e("lodash");var a=e("../multiaxisconfig");var s=e("../view/pivot/config_helper");var l=e("popupmenu").MenuItem;var u=e("popupmenu").MenuItemsTypes;var c=["DECIMAL","INT","FLOAT"];var d=e("../constant");var p=d.ContextMenu.MenuItemInfo;var f=d.ContextMenu.IconInfo;var h=r.createClass({displayName:"FilterSortMenuSection",mixins:[n],propTypes:{openFilter:r.PropTypes.func,clearFilter:r.PropTypes.func,isFilterable:r.PropTypes.bool,pivotState:r.PropTypes.object,updatePivotState:r.PropTypes.func,modelerApp:r.PropTypes.object,modelerState:r.PropTypes.object,sort:r.PropTypes.func,clearSort:r.PropTypes.func,dataProvider:r.PropTypes.object,field:r.PropTypes.object,isSlice:r.PropTypes.bool,selectedRange:r.PropTypes.object,selectedMeasure:r.PropTypes.string,onClose:r.PropTypes.func},$createLevelMenu:function(){var e=this.props.field;return s.isAllField(e)?[]:this.$buildSortSection().concat(this.$buildFilterSection(false))},$createMeasureFieldMenu:function(){var e=this.props.field,t=!o.isUndefined(this.props.isFilterable)?this.props.isFilterable:this.$isMeasureFilterable(this.props.field.id);return s.isAllField(e)?[]:this.$buildFilterSection(!t)},$buildFilterSection:function(e){return[r.createElement(l,{key:p.Filter.key,label:p.Filter.label,itemType:u.MenuItem,disabled:e,onClick:this.$handleFilterClick,iconName:f.Filter,onClose:this.props.onClose}),r.createElement(l,{key:p.ClearFilter.key,label:p.ClearFilter.label,itemType:u.MenuItem,disabled:e,onClick:this.$handleClearFilterClick,onClose:this.props.onClose})]},$buildCellSortSection:function(e,t){var i=this.$isSortingDisabled(e,t);return[r.createElement(l,{key:p.SortAsc.key,label:p.SortAsc.label,itemType:u.MenuItem,disabled:i,data:"asc",onClick:this.$handleSortClick,iconName:f.SortAsc,onClose:this.props.onClose}),r.createElement(l,{key:p.SortDesc.key,label:p.SortDesc.label,itemType:u.MenuItem,disabled:i,data:"desc",onClick:this.$handleSortClick,iconName:f.SortDesc,onClose:this.props.onClose}),r.createElement(l,{key:p.ClearSort.key,label:p.ClearSort.label,itemType:u.MenuItem,onClick:this.$clearSortForMeasure,onClose:this.props.onClose})]},$handleFilterClick:function(){this.props.openFilter(this.props.selectedMeasure||this.props.field.id)},$handleClearFilterClick:function(){this.props.clearFilter(this.props.selectedMeasure||this.props.field)},$handleSortClick:function(e){if(this.props.selectedMeasure){this.$setSortForMeasure(e)}else{this.props.sort(this.props.field.id)}},$setSortForMeasure:function(e){var t=this.props.selectedMeasure,i=this.props.selectedRange,r=this.props.pivotState,n=s.findAxisForField(r,s.getVisibleMeasures(r).id),o=this.$getSortPositions(t,i),a=this.$getFloatingAxisName(n,i),l=s.setSortByMeasureValue(this.props.modelerState,r,t,a,o,e);this.props.updatePivotState(l)},$clearSortForMeasure:function(){var e=s.clearSortByMeasureValue(this.props.pivotState);this.props.updatePivotState(e)},$buildSortSection:function(){return[r.createElement(l,{key:p.Sort.key,label:p.Sort.label,itemType:u.MenuItem,onClick:this.$handleSortClick,iconName:f.Sort,onClose:this.props.onClose})]},$isMeasureFilterable:function(e){if(e){var t=this.props.modelerApp.getMeasureModelStore().getModel().getMeasureInfo(e);return c.indexOf(t.type.kind)!==-1}return false},$getSortPositions:function(e,t){function i(e){return e.config.field instanceof a.LevelField}var r=this.props.dataProvider.getSelectedDataRange(t),n=r.dataArray[0].info.headings,s=[],l;o.forEach(n,function(e){s=s.concat(e.filter(i))});l=s.map(function(e){var t=e.config.field.level;return{qualifiedLevel:{level:t.get("levelName"),dimension:t.get("dimensionName"),label:t.get("labelName")},memberId:e.id}});return l},$getFloatingAxisName:function(e,t){if(e==="Z"){return t.Y.length>=t.X.length?"Y":"X"}else{return e==="X"?"Y":"X"}},$isSortingDisabled:function(e,t){return s.findAxisForField(this.props.pivotState,s.getVisibleMeasures(this.props.pivotState).id)==="Z"||!t||this.$selectionHasMultipleRowsAndColumns(e)},$selectionHasMultipleRowsAndColumns:function(e){var t=s.findAxisForField(this.props.pivotState,s.getVisibleMeasures(this.props.pivotState).id);if(t==="Z"){return e.X.length>1&&e.Y.length>1}return e[t].length!==1},render:function(){var e=this.props.field,t;if(e){if(!this.props.isSlice){switch(e.constructor){case a.LevelField:t=this.$createLevelMenu();break;case a.MeasureField:t=this.$createMeasureFieldMenu();break}}else{if(e instanceof a.LevelField){t=this.$buildSortSection()}}}else{t=[this.$buildFilterSection(!this.$isMeasureFilterable(this.props.selectedMeasure)),this.$buildCellSortSection(this.props.selectedRange,this.props.selectedMeasure)]}return r.DOM.div({},t)}});t.exports=h},{"../constant":256,"../multiaxisconfig":328,"../view/pivot/config_helper":455,lodash:70,popupmenu:146,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],308:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=e("../view/pivot/config_helper");var a=e("popupmenu").MenuItem;var s=e("popupmenu").MenuItemsTypes;var l=e("../util/viewlayoututils");var u=e("../constant");var c=u.ContextMenu.MenuItemInfo;var d=u.ContextMenu.IconInfo;var p=u.View;var f=u.Layout;var h=u.MESSAGES;var g=r.createClass({displayName:"FormatMenuSection",mixins:[n],propTypes:{modelerApp:r.PropTypes.object.isRequired,sheetId:r.PropTypes.string.isRequired,openComponentFn:r.PropTypes.func.isRequired,closeComponentFn:r.PropTypes.func.isRequired,pivotState:r.PropTypes.object,updatePivotState:r.PropTypes.func,selectedMeasure:r.PropTypes.string,fromCell:r.PropTypes.bool,onClose:r.PropTypes.func},getInitialState:function(){return{sheetConfig:this.props.modelerApp.getViewConfigStore().getViewState(this.props.sheetId)}},$switchViewMode:function(e){var t=e.config,i=l.getInlineViewId(this.state.sheetConfig,t.module);if(!l.isViewOpenedInLayout(this.state.sheetConfig,i)){this.props.openComponentFn(i,e.position,t)}else{this.props.closeComponentFn(i)}},$isOpened:function(e){var t=l.getInlineViewId(this.state.sheetConfig,e);return l.isViewOpenedInLayout(this.state.sheetConfig,t)},$switchConditionalFormatting:function(){var e={config:{module:p.Modules.ConditionalFormatting,selectedMeasure:this.props.selectedMeasure},position:{options:{size:"300px",openIn:f.POSITION.RIGHT}}};this.$switchViewMode(e)},$removeFormatting:function(){var e=this,t=this.props.modelerApp.getModalWindowsActionHandler();t.confirm("Remove conditional formatting for "+this.props.selectedMeasure+"?",h.PLEASE_CONFIRM).then(function(){var t=o.removeConditionalFormattingForMeasure(e.props.pivotState,e.props.selectedMeasure);e.props.updatePivotState(t)})},$switchFormulaEditor:function(){var e={config:{module:p.Modules.MeasureLanguageEditor},position:{options:{size:"1",openIn:f.POSITION.BOTTOM}}};this.$switchViewMode(e)},render:function(){return r.DOM.div({},r.createElement(a,{key:c.ConditionalFormatting.key,label:c.ConditionalFormatting.label,itemType:s.MenuItem,iconName:this.$isOpened(p.Modules.ConditionalFormatting)?d.Checked:"",onClick:this.$switchConditionalFormatting,onClose:this.props.onClose}),!this.props.selectedMeasure?null:r.createElement(a,{key:c.ClearFormatting.key,label:c.ClearFormatting.label,itemType:s.MenuItem,disabled:!o.hasConditionalFormatting(this.state.sheetConfig,this.props.selectedMeasure),onClick:this.$removeFormatting,onClose:this.props.onClose}),this.props.fromCell||!this.props.modelerApp.getModelerOptionStore().canEditRules()?null:r.createElement(a,{key:c.FormulaEditor.key,label:c.FormulaEditor.label,itemType:s.MenuItem,iconName:this.$isOpened(p.Modules.MeasureLanguageEditor)?d.Checked:"",onClick:this.$switchFormulaEditor,onClose:this.props.onClose}))}});t.exports=g},{"../constant":256,"../util/viewlayoututils":367,"../view/pivot/config_helper":455,popupmenu:146,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],309:[function(e,t,i){var r=e("react");var n=e("immutable");var o=e("react-addons-pure-render-mixin");var a=e("../view/pivotsettingswindow");var s=e("popupmenu").MenuItem;var l=e("popupmenu").MenuItemsTypes;var u=e("../constant");var c=u.ContextMenu.MenuItemInfo;var d=e("../util/viewlayoututils");var p=r.createClass({displayName:"GlobalMenuSection",mixins:[o],propTypes:{sheetId:r.PropTypes.string.isRequired,sheetUniqueId:r.PropTypes.string.isRequired,modelerApp:r.PropTypes.object.isRequired,pivotState:r.PropTypes.object.isRequired,updatePivotState:r.PropTypes.func.isRequired,fromCell:r.PropTypes.bool,onClose:r.PropTypes.func},$resetStateDisabled:function(){var e=this.props.modelerApp.getViewConfigStore(),t=e.getViewState(this.props.sheetId),i=e.getViewConfig(this.props.sheetId);return n.is(t,i)},$switchViewMode:function(e,t){e=e||this.props.sheetUniqueId;return this.props.modelerApp.getViewActionHandler().setViewMode(e,t)},$resetState:function(){var e=this.props.modelerApp,t=this.props.sheetId,i=this.props.sheetUniqueId,r=e.getViewStore(),n=r.getParentId(i),o;e.getViewConfigActionHandler().resetViewState(t).then(function(){o=e.getViewConfigStore().getViewConfig(n);this.$switchViewMode(i,d.getCurrentViewModeInParentLayout(t,o))}.bind(this))},$openPivotSettings:function(){if(!this.pivotSettingsWindowContainer){this.pivotSettingsWindowContainer=document.getElementById("settings-window-container")||document.createElement("div");this.pivotSettingsWindowContainer.id="settings-window-container";document.body.appendChild(this.pivotSettingsWindowContainer)}ReactDOM.render(r.createElement(a,{modelerApp:this.props.modelerApp,pivotId:this.props.sheetId,pivotState:this.props.pivotState,updatePivotState:this.props.updatePivotState}),this.pivotSettingsWindowContainer)},render:function(){return r.DOM.div({},r.createElement(s,{key:c.ResetState.key,label:c.ResetState.label,itemType:l.MenuItem,disabled:this.$resetStateDisabled(),onClick:this.$resetState,onClose:this.props.onClose}),this.props.fromCell?null:r.createElement(s,{key:c.PivotSettings.key,label:c.PivotSettings.label,itemType:l.MenuItem,onClick:this.$openPivotSettings,onClose:this.props.onClose}))}});t.exports=p},{"../constant":256,"../util/viewlayoututils":367,"../view/pivotsettingswindow":479,immutable:"immutable",popupmenu:146,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],310:[function(e,t,i){"use strict";var r=e("./constant").ModalWindows.Types;var n={};n[r.CONFIRMATION_DIALOG]=e("./view/confirmationdialogcontroller");n[r.REVIEW_EDITS_DIALOG]=e("./view/revieweditsdialogcontroller");n[r.REVIEW_LOCKS_DIALOG]=e("./view/reviewlocksdialogcontroller");n[r.SORT_DIALOG]=e("./view/sortwindow").SortController;n[r.LOGOUT_NOTIFICATION_DIALOG]=e("./view/logoutnotificationdialog");n[r.SIGNAL_MANAGEMENT_DIALOG]=e("./view/signal_management_dialog").SignalManagementDialog;n[r.SIGNALS_INFO_DIALOG]=e("./view/signals_info_dialog");n[r.PAGES_SYNC_DIALOG]=e("./view/pages_sync_dialog");n[r.WARNING_DIALOG]=e("./view/warningmodalwindow");n[r.LEVEL_CREATION_FORM]=e("./view/level_creation_form_modal");t.exports=n},{"./constant":256,"./view/confirmationdialogcontroller":392,"./view/level_creation_form_modal":423,"./view/logoutnotificationdialog":428,"./view/pages_sync_dialog":451,"./view/revieweditsdialogcontroller":481,"./view/reviewlocksdialogcontroller":482,"./view/signal_management_dialog":492,"./view/signals_info_dialog":496,"./view/sortwindow":501,"./view/warningmodalwindow":519}],311:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("./modelerapp");var a=e("./view/modelerview");function s(e){this.$build(e)}s.prototype.$build=function(e){var t=new o(e);this.$modelerApp=t;this.$modelerView=this.$newModelerView(e.pageConfig,t)};s.prototype.$newModelerView=function(e,t){return r.createElement(a,{modelerApp:t,config:e,onClose:this.closePage})};s.prototype.render=function(e){n.render(this.$modelerView,e)};s.prototype.getApp=function(){return this.$modelerApp};s.prototype.getView=function(){return this.$modelerView};s.prototype.start=function(){return this.$modelerApp.start()};s.prototype.close=function(){this.closePage();this.$modelerApp.close()};s.prototype.closePage=function(){this.$modelerApp.getViewActionHandler().closePage()};t.exports=s},{"./modelerapp":312,"./view/modelerview":442,react:"react","react-dom":"react-dom"}],312:[function(e,t,i){"use strict";var r=e("./event_emitter").EventEmitter;var n=e("./util");var o=e("lodash");var a=e("./dispatcher").Dispatcher;var s=e("../logicblox.core/routing").Router;var l=e("./urldriver").UrlDriver;var u=e("./websocket").ModelerWebSocket;var c=e("./store/fieldstore");var d=e("./store/multiaxisconfigstore");var p=e("./store/measurelanguagestore");var f=e("./store/measuremodelstore");var h=e("./store/multiaxisdatastore");var g=e("./store/pivotconfigstore");var m=e("./store/navigationtreestore");var v=e("./store/logstore");var y=e("./store/actionstore");var b=e("./store/modeleroptionstore");var w=e("./store/draganddropstore");var C=e("./store/collaborationstore");var E=e("./store/modalwindowsstore");var S=e("./store/notificationsstore");var T=e("./store/userstore");var x=e("./store/viewconfigstore");var _=e("./store/viewstore");var M=e("./dao/measureservicedao");var A=e("./dao/workbookdao");var I=e("./action/measurelanguageactionhandler");var O=e("./action/measuremodelactions");var D=e("./action/modeleractions");var N=e("./action/multiaxisconfigactions");var R=e("./action/multiaxisdataactions");var P=e("./action/pivotconfigactions");var L=e("./action/navigationtreeactions");var k=e("./action/logactions");var $=e("./action/actionactions");var F=e("./action/draganddropactions");var V=e("./action/collaborationactions");var q=e("./action/modalwindowsactions");var H=e("./action/notificationsactions");var U=e("./action/viewconfigactions");var B=e("./action/viewactions");var z=e("./action/useractions");var j=e("./modelerstate");var G=e("./modelerviews");function W(e){if(o.isUndefined(e)){console.warn("Modeling feature flags are undefined. Default settings will be used.");return}if(o.isUndefined(e.editSchema)||!o.isBoolean(e.editSchema)){console.warn("Flag for edit schema feature ('editSchema') is either not found or its value is not a 'true' or 'false' value. Default value of 'true' will be used.")}if(o.isUndefined(e.editRules)||!o.isBoolean(e.editRules)){console.warn("Flag for formula editor feature ('editRules') is either not found or its value is not a 'true' or 'false' value. Default value of 'false' will be used.")}}function Q(e){var t=e.appPrefix||e.urls&&e.urls.appPrefix||"",i=e.broadcastUrlPrefix||t,r=e.workbookId,n=r?t+"/workbook-"+r:t,a=e.modelingFeatures&&e.modelingFeatures.collaboration,s={measureUrl:n+"/measure",measureUpdateUrl:n+"/measure-update",measureConfigUrl:n+"/pivot_config",rulesUrl:n+"/rules",navigationTreeUrl:n+"/navtree",actionsUrl:n+"/actions",userBroadcastUrl:a&&i+"/websocket/broadcast_auth/workbook-"+(r||"0"),workbooksUrl:t+"/workbooks",sheetUrl:t+"/sheet",resetSheetUrl:t+"/reset_sheet",currentUserUrl:t+"/admin/current_user",lbWebAdminUrl:t+"/lb-web/admin",connectBloxUrl:t+"/connectblox",addBlockUrl:t+"/connectblox/addblock",execBlockUrl:t+"/connectblox/exec",listPredicatesUrl:t+"/connectblox/list-predicates",createBranchUrl:t+"/connectblox/create_branch",closeBranchUrl:t+"/connectblox/close_branch",replaceDefaultBranchUrl:t+"/connectblox/replace_default_branch",viewsConfigsUrl:t+"/views",viewsStatesUrl:t+"/viewstates",viewConfigUrl:t+"/view",viewStateUrl:t+"/viewstate"},l=o.merge({urls:s},o.omit(e,["pageConfig"]));l.pageConfig=e.pageConfig;if(!l.workspace){throw new Error("workspace needs to be set in config")}l.getServiceUrl=e.getServiceUrl||function(e){if(e.indexOf("/commit")!==-1||e.indexOf("/refresh")!==-1){e=t+e}else{e=n+e}return e};l.getActionMessage=e.getActionMessage||function(e,t){if(r&&t.indexOf("/commit")!==-1||t.indexOf("/refresh")!==-1){e=K(e,r)}return e};if(e.workspace){l.connectblox={workspace:e.workspace}}l.routing=e.routing||{};W(e.modelingFeatures);l.modelingFeatures=e.modelingFeatures||{editSchema:true,editRules:true};return l}function K(e,t){e.workbook_id=t;return e}o.mixin(Y.prototype,r.prototype);function Y(t){var i=this.config=Q(t||{});var W=new a;var K=new r;var Y=new v.LogStore(W);var X=new k(W);var J;var Z=this.urlDriver=new l(i);var ee=i.events||{},te=ee.onAuthenticationFailure,ie=ee.onAuthorizationFailure,re=ee.afterAction;Z.on("AUTHENTICATION_FAILURE",function(e){if(te){te(e)}});Z.on("AUTHORIZATION_FAILURE",function(e){if(ie){ie(e)}});var ne=new T(W);var oe=new z(W,Z,t.loginUrl,t.loginUrl,t.realm);if(typeof window!=="undefined"){var ae=new s(i.routing.toUrlFn,i.routing.fromUrlFn);var se=i.views||e("./modelerviews");J=new u(i.urls.userBroadcastUrl,Z,X,ne)}var le=new E(W);var ue=new q(W);var ce=new S(W);var de=new H(W);var pe=new g.PivotConfigStore(W);var fe=new P(W,Z,pe);var he=new f.MeasureModelStore(W);var ge=new O(W,Z,he);var me=new c.FieldStore(W,he,pe);var ve=new M(Z);var ye=new A(Z);var be=new d.MultiAxisConfigStore(W,he,me);var we=new p(W,be);var Ce=new I(W,Z);var Ee=new h.MultiAxisDataStore(W,{measureModelStore:he,pivotConfigStore:pe,multiAxisConfigStore:be,logActionHandler:X});var Se=new R(W,Z,{logActionHandler:X,notificationsActionHandler:de,modalWindowsActionHandler:ue,multiAxisDataStore:Ee,pivotConfigStore:pe,measureModelStore:he});var Te=new m.NavigationTreeStore(W);var xe=new L(W,Z);var _e=new y(W);var Me=new b.ModelerOptionStore(W,i.modelingFeatures);var Ae=new F(W);var Ie=new w(W);var Oe=new $(W,Z,i.getServiceUrl,i.getActionMessage,re,{logActionHandler:X,actionStore:_e});var De=new C(W);var Ne=new V(W,J,Z,{actionsActionHandler:Oe,multiAxisDataActionHandler:Se,notificationsActionHandler:de,modelerOptionStore:Me,userStore:ne});var Re=new N(W,{measureModelStore:he,fieldStore:me});var Pe=new x(W);var Le=new U(W,Z,{viewConfigStore:Pe,userStore:ne});var ke=new _(W,Pe,G.getViewComponentForModule);var $e=new B(W,{viewConfigActions:Le,viewConfigStore:Pe,viewStore:ke});var Fe=new D(W,{measureModelActionHandler:ge,multiAxisConfigActionHandler:Re,multiAxisDataActionHandler:Se,navigationTreeActionHandler:xe,measureLanguageActionHandler:Ce,pivotConfigActionHandler:fe,actionsActionHandler:Oe,dragAndDropActionHandler:Ae,modalWindowsActionHandler:ue,collaborationActionHandler:Ne,viewActionHandler:$e,viewConfigActionHandler:Le,measureModelStore:he,pivotConfigStore:pe,multiAxisConfigStore:be,fieldStore:me,navigationTreeStore:Te,dragAndDropStore:Ie,multiAxisDataStore:Ee,modelerOptionStore:Me,modelerWebSocket:J,modelerApp:this,viewConfigStore:Pe},Z);this.start=function(){var e=Fe.initializeModeler();e.catch(n.logError);return e};this.close=function(){this.getModelerActionHandler().clearUserRelatedStores().catch(n.logError)};this.destroy=function(){var e=/get(.*)(store|handler)$/i;W.destroy();Z.destroy();o.forEach(this,function(t,i){var r;if(e.test(i)){r=t();if(r.destroy||r.removeAllListeners){r.destroy&&r.destroy();r.removeAllListeners&&r.removeAllListeners()}}})};this.getModelerDispatcher=function(){return W};this.getMeasureLanguageStore=function(){return we};this.getMeasureModelStore=function(){return he};this.getMultiAxisConfigStore=function(){return be};this.getModalWindowsStore=function(){return le};this.getNotificationsStore=function(){return ce};this.getUserStore=function(){return ne};this.getMeasureServiceDAO=function(){return ve};this.getWorkbookDAO=function(){return ye};this.getMultiAxisDataStore=function(){return Ee};this.getFieldStore=function(){return me};this.getPivotConfigStore=function(){return pe};this.getNavigationTreeStore=function(){return Te};this.getLogStore=function(){return Y};this.getActionStore=function(){return _e};this.getModelerOptionStore=function(){return Me};this.getDragAndDropStore=function(){return Ie};this.getCollaborationStore=function(){return De};this.getViewConfigStore=function(){return Pe};this.getViewStore=function(){return ke};this.getMultiAxisConfigActionHandler=function(){return Re};this.getMeasureLanguageActionHandler=function(){return Ce};this.getMeasureModelActionHandler=function(){return ge};this.getModelerActionHandler=function(){return Fe};this.getMultiAxisDataActionHandler=function(){return Se};this.getPivotConfigActionHandler=function(){return fe};this.getNavigationTreeActionHandler=function(){return xe};this.getLogActionHandler=function(){return X};this.getActionActionHandler=function(){return Oe};this.getCollaborationActionHandler=function(){return Ne};this.getDragAndDropActionHandler=function(){return Ae};this.getModalWindowsActionHandler=function(){return ue};this.getNotificationsActionHandler=function(){return de};this.getUserActionHandler=function(){return oe};this.getViewConfigActionHandler=function(){return Le};this.getViewActionHandler=function(){return $e};this.getUserActionHandler=function(){return oe};this.getConnectBlox=function(){return Z.connectblox};this.getRouter=function(){return ae};this.registerViewModule=function(e,t){return G.registerViewModule(e,t)};this.getViewComponentForModule=function(e){return G.getViewComponentForModule(e)};this.getUrlDriver=function(){return Z};this.getModelerWebSocket=function(){return J};this.getGlobalSignalEmitter=function(){return K};this.getQueryGenerator=function(){return this.getMultiAxisDataStore().getQueryGenerator()};this.getModelerState=function(){return j.createModelerState(this)}}Y.prototype.getCurrentUser=function(){var e=this.config.urls.currentUserUrl,t=this.urlDriver.http;return t.getCurrentUser(e)};t.exports=Y;t.exports.MultiAxisConfigEvents=d.MultiAxisConfigEvents;t.exports.MeasureLanguageEvents=p.Events;t.exports.MeasureConfigEvents=g.MeasureConfigEvents;t.exports.MeasureModelEvents=f.MeasureModelEvents;t.exports.generateModelerAppConfig=Q},{"../logicblox.core/routing":221,"./action/actionactions":222,"./action/collaborationactions":224,"./action/draganddropactions":225,"./action/logactions":226,"./action/measurelanguageactionhandler":227,"./action/measuremodelactions":228,"./action/modalwindowsactions":229,"./action/modeleractions":230,"./action/multiaxisconfigactions":231,"./action/multiaxisdataactions":232,"./action/navigationtreeactions":233,"./action/notificationsactions":234,"./action/pivotconfigactions":235,"./action/useractions":236,"./action/viewactions":237,"./action/viewconfigactions":238,"./dao/measureservicedao":282,"./dao/workbookdao":286,"./dispatcher":288,"./event_emitter":289,"./modelerstate":313,"./modelerviews":314,"./store/actionstore":337,"./store/collaborationstore":338,"./store/draganddropstore":340,"./store/fieldstore":341,"./store/logstore":342,"./store/measurelanguagestore":343,"./store/measuremodelstore":344,"./store/modalwindowsstore":345,"./store/modeleroptionstore":346,"./store/multiaxisconfigstore":347,"./store/multiaxisdatastore":348,"./store/navigationtreestore":349,"./store/notificationsstore":350,"./store/pivotconfigstore":351,"./store/userstore":353,"./store/viewconfigstore":354,"./store/viewstore":355,"./urldriver":356,"./util":357,"./websocket":521,lodash:70}],313:[function(e,t,i){"use strict";var r=e("./helpers/fieldhelpers");var n=e("./helpers/measuremodelhelpers");var o=e("./helpers/pivotconfighelpers");
var a=e("./pivotconfig_helper");var s=e("./view/pivot/config_helper");var l=t.exports;l.createModelerState=function(e){return l.createModelerStateFromStores(e.getFieldStore(),e.getMeasureModelStore(),e.getPivotConfigStore())};l.createModelerStateFromStores=function(e,t,i){return{fields:r.getFieldStateFromStore(e),measureModel:n.getMeasureModelFromStore(t),pivotConfig:o.getPivotConfigFromStore(i),pch:a,ch:s}};l.fields=r;l.measuremodel=n;l.pivotconfig=o},{"./helpers/fieldhelpers":296,"./helpers/measuremodelhelpers":297,"./helpers/pivotconfighelpers":298,"./pivotconfig_helper":330,"./view/pivot/config_helper":455}],314:[function(e,t,i){"use strict";var r=e("assert");var n=e("./constant").View;var o={};o[n.Modules.Page]=e("./view/pageview");o[n.Modules.Canvas]=e("./view/pageview");o[n.Modules.Layout]=e("./view/layoutview");o[n.Modules.Sheet]=e("./view/sheetview");o[n.Modules.ModelerNavigationTree]=e("./view/modelernavigationtree");o[n.Modules.Image]=e("./view/image");o[n.Modules.LogConsole]=e("./view/logview");o[n.Modules.ActionButtons]=e("./view/actionbutton").ActionButtonsPanelController;o[n.Modules.VegaChart]=e("./view/vegachartcontroller");o[n.Modules.ShortcutButtons]=e("./view/shortcutbuttonscontroller");o[n.Modules.VegaLite]=e("./view/vegalite/vegalite_controller");o[n.Modules.PivotGrid]=e("./view/pivot/pivot_grid");o[n.Modules.Form]=e("./view/form/form_controller");o[n.Modules.Grid]=e("./view/pivot/grid");o[n.Modules.MeasureBrowser]=e("./view/measurebrowsercontroller");o[n.Modules.DimensionBrowser]=e("./view/dimensionbrowsercontroller");o[n.Modules.MeasureLanguageEditor]=e("./view/measurelanguageeditor").MeasureLanguageEditorController;o[n.Modules.MeasureWindow]=e("./view/measurewindow").MeasureWindowController;o[n.Modules.MeasureFilterWindow]=e("./view/measurefilterwindowcontroller");o[n.Modules.ConfigMenu]=e("./view/pivot/menu.config");o[n.Modules.Rows]=e("./view/axispanels").RowsController;o[n.Modules.Columns]=e("./view/axispanels").ColumnsController;o[n.Modules.Measures]=e("./view/visiblemeasures");o[n.Modules.Slices]=e("./view/axispanels").SlicesController;o[n.Modules.ModelBrowser]=e("./view/modelbrowser");o[n.Modules.ConditionalFormatting]=e("./view/conditionalformattingcontroller");o[n.Modules.SheetConfigurationPanel]=e("./view/sheetconfigurationpanel");function a(e,t){r(e&&t,["View module and component have to be specified"]);o[e]=t}function s(e){r(e,["View module has to be specified"]);return o[e]}t.exports.registerViewModule=a;t.exports.getViewComponentForModule=s},{"./constant":256,"./view/actionbutton":370,"./view/axispanels":382,"./view/conditionalformattingcontroller":388,"./view/dimensionbrowsercontroller":397,"./view/form/form_controller":411,"./view/image":421,"./view/layoutview":422,"./view/logview":429,"./view/measurebrowsercontroller":430,"./view/measurefilterwindowcontroller":432,"./view/measurelanguageeditor":433,"./view/measurewindow":434,"./view/modelbrowser":439,"./view/modelernavigationtree":441,"./view/pageview":452,"./view/pivot/grid":457,"./view/pivot/menu.config":459,"./view/pivot/pivot_grid":476,"./view/sheetconfigurationpanel":487,"./view/sheetview":488,"./view/shortcutbuttonscontroller":491,"./view/vegachartcontroller":511,"./view/vegalite/vegalite_controller":514,"./view/visiblemeasures":518,assert:2}],315:[function(e,t,i){"use strict";var r=e("../multiaxisconfig");var n=e("lodash");var o=e("./data");var a=e("../util");function s(e,t,i){var o=e.mappedInter.qualified_level.map(function(e,t){var n=r.mqgLevelToQName(e);if(i.indexOf(n)===-1)return t}).filter(function(e){return!n.isUndefined(e)}),a=1+o,s=l(t,a),c=u(e,i);return{createInitValueObj:function(e){return{rawValue:[],formattedValue:[],queryTime:e}},updateValueObjectWithRow:function(e,t){var i=c(t);e.rawValue.push(i);e.formattedValue.push(s(i))},reverseValueObjectValues:function(e){e.rawValue.reverse();e.formattedValue.reverse()}}}function l(e,t){var i=t-1,r=e.format;if(r){return function(e){var t=e.slice();t[i]=r(t[i]);return t}}else{return function(e){return e}}}function u(e,t){var i=e.mappedInter.qualified_level.map(function(e,i){var n=r.mqgLevelToQName(e);if(t.indexOf(n)===-1)return i}).filter(function(e){return!n.isUndefined(e)}),o=i.length,a=e.mappedInter.qualified_level.length,s=a+1;return o>0?function(e){var t=0,r=[];for(;t<o;t++){r.push(e[i[t]])}r.push(e[a]);return r}:function(e){return e.slice(a,s)}}function c(e,t){if(e<t)return-1;else if(e>t)return 1;else return 0}function d(e,t,i){this.$keyQNames=i.usedKeyMaps.map(function(e){return e.qName});this.$keyRowIndices=i.usedKeyMaps.map(function(e){return e.index});this.$keyComparators=new Array(this.$keyRowIndices.length).fill(c);this.$valueBuilder=s(e,t,this.$keyQNames)}d.prototype.setPositionTableMap=function(e){var t=new Map,i,r,n,a,s=e.entries(),l,u,c;this.$positionToTableMap=new Map;i=this.$positionToTableMap;for(;a=s.next(),!a.done,n=a.value||[],r=n[0],l=n[1];){u=l.resultTable;c=t.get(u);if(!c){c=o.sortResultTableByIndices(this.$keyRowIndices,this.$keyComparators,u);t.set(u,c)}i.set(r,c)}};d.prototype.setSingleTable=function(e,t){this.$singleResultTable=o.sortResultTableByIndices(this.$keyRowIndices,this.$keyComparators,e);this.$queryTime=t};d.prototype.getQueryTime=function(e){return this.$queryTime};d.prototype.findPositionRows=function(e){return this.findPositionsRows([e])[0]};d.prototype.findPositionValue=function(e){return this.findPositionsValue([e])[0]};d.prototype.findPositionsRows=function(e,t){var t=t||a.mkIdentityFunction();if(this.$singleResultTable)return this.findPositionRowsForSingleTable(e,t);else return this.findPositionRowsForMultipleTables(e,t)};d.prototype.findPositionsValue=function(e){return this.findPositionsRows(e,this.$valueBuilder)};d.prototype.findPositionRowsForSingleTable=function(e,t){var i=0,r=e.length,n=this.$singleResultTable,o,a,s=n.dataTable,l=n.queryTime,u=[];for(;i<r;i++){o=e[i];a=this.findRowsForPosition(o,s,0,t,l);u.push(a)}return u};d.prototype.findPositionRowsForMultipleTables=function(e,t){var i=0,r=e.length,n=this.$positionToTableMap,o,a,s,l=[];for(;i<r;i++){o=e[i];s=n.get(o.key);if(s){a=this.findRowsForPosition(o,s.dataTable,0,t,s.queryTime);l.push(a)}else{l.push(undefined)}}return l};d.prototype.findRowsForPosition=function(e,t,i,r,n){var o=this.$keyQNames,a=e.position,s=o.length,l=this.$keyRowIndices,u=this.$keyComparators,c=r.createInitValueObj(n),d=r.updateValueObjectWithRow,p=r.reverseValueObjectValues,f,h,g=0,m=[i,t.length-1],v,y,b=this.computeFirstSearchRow(m),w,C,E,S,T,x=0;T=t[b];while(T){for(x=0;x<s;x++){f=a[o[x]];h=T[l[x]];g=u[x](h,f);if(g!==0){break}}if(g===0){v=m[0];y=m[1];C=b-1;while(C>=v){w=t[C];for(x=0;x<s;x++){f=a[o[x]];h=w[l[x]];g=u[x](h,f);if(g!==0){break}}if(g===0){d(c,w);C--}else{break}}p(c);d(c,T);S=b+1;while(S<=y){E=t[S];for(x=0;x<s;x++){f=a[o[x]];h=E[l[x]];g=u[x](h,f);if(g!==0){break}}if(g===0){d(c,E);S++}else{break}}break}else{m=this.computeNextSearchRange(m,b,g);if(!m)break;b=this.computeNextSearchRow(m,b,g);T=t[b]}}return c};d.prototype.computeNextSearchRange=function(e,t,i){var r=e[0],n=e[1];if(r===n)return;if(i>0){return[r,Math.max(r,t-1)]}else if(i<0){return[Math.min(n,t+1),n]}else{return e}};d.prototype.computeNextSearchRow=function(e,t,i){var r=e[0],n=e[1],o=n-r;if(o<2||i===0)return r;else return r+Math.floor(o/2)};d.prototype.computeFirstSearchRow=function(e){return e[0]};t.exports=d},{"../multiaxisconfig":328,"../util":357,"./data":316,lodash:70}],316:[function(e,t,i){"use strict";var r=e("../multiaxisconfig");var n=e("assert");var o=t.exports;o.iterateViewRange=function(e,t,i,n,a,s){s=s||r.getOrderedAxes(e);var l={},u=[],c={};if(!t||!i)return;s.forEach(function(e){var r=i.get(e);l[e]=t.getHeadingAxisInfo(e).getHeadingRange(r.start,r.start+r.length);c[e]=r.start});if(s.length)o.iterateCells(u,[],[],[],[],[],s,c,l,0,n,a);return{dataArray:u,orderedAxisNames:s}};o.iterateCells=function(e,t,i,r,a,s,l,u,c,d,p,f,h){n(d<l.length,"O no, how did we get an axisIndex that's past the end of the ordered axis names?");var g=l[d],m=u[g],v=c[g],y=v.length,b,w,C,E,S,T=d===l.length-1,x,_,M,A=0;for(;A<y;A++){b=v[A];w=t.concat(b.fields);C=r.concat(b.rollups);E=i.concat(b.members);S=a.concat([b.headers]);M=s.concat(m+A);if(T){_=p(w,C,E,S,M,h||b.hasInvalidHeadings);e.push(_)}else{if(f){x=e}else{x=[];e.push(x)}o.iterateCells(x,w,E,C,S,M,l,u,c,d+1,p,f,h||b.hasInvalidHeadings)}}};o.sortResultTableByIndices=function(e,t,i){return{columnInfo:i.columnInfo,dataTable:o.sortDataTableByIndices(e,t,i.dataTable)}};o.sortDataTableByIndices=function(e,t,i){var r=e.length,n=function(i,n){var o=0,a=0,s;for(;o<r;o++){s=e[o];a=t[o](i[s],n[s]);if(a!==0)return a}return a},o=i.slice();o.sort(n);return o}},{"../multiaxisconfig":328,assert:2}],317:[function(e,t,i){"use strict";t.exports=r;function r(e,t,i,r,n){this.$queryDataBox=e;this.$queryDataLastUpdated=e.getLastUpdated();this.$editDataBox=t;this.$headingData=i;this.$brokenQueryKeys=r;this.$dataCache=n}r.prototype.getQueryDataBox=function(){return this.$queryDataBox};r.prototype.getEditDataBox=function(){return this.$editDataBox};r.prototype.getHeadingData=function(){return this.$headingData};r.prototype.getBrokenQueryKeys=function(){return this.$brokenQueryKeys};r.prototype.isQueryBrokenByKey=function(e){return this.$brokenQueryKeys.indexOf(e)>-1};r.prototype.getPendingEditByKeys=function(e,t){return this.$editDataBox.getPendingEditByKeys(e,t)};r.prototype.getOutstandingSaveByKeys=function(e,t){return this.$editDataBox.getOutstandingSaveByKeys(e,t)};r.prototype.getQueryPositionValue=function(e,t,i,r,n){var o=this.$dataCache&&this.$dataCache.getQueryPositionValue(i,r,n),a=o&&o.value,s=o&&o.cacheTime,l=s&&this.$queryDataLastUpdated<=s,u;if(l){return a}else{u=this.$queryDataBox.getQueryPositionValue(e,t,i,r,n);if(u)u.lastChanged=performance.now();if(this.$dataCache){this.$dataCache.cacheValue(i,r.key,r.position,u,n)}return u}}},{}],318:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("../cubiql");var a=e("../querygen/query");var s=e("./queryutil");var l=e("./querygen");var u=e("../querygen/util");var c=l.QueryGenerator;var d=e("./modelutility");var p=e("./keymanager");var f=e("../multiaxisconfig");var h=e("../multiaxisheading");var g=e("../headinggen");var m=e("assert");var v=e("./data");var y=t.exports;var b=r.Record({start:undefined,length:undefined});var w=y.DataProcessor=function(e,t,i,r){this.$maConfig=e;this.$measureModel=t;this.$modelUtility=new d(t);this.$queryGenerator=new c(t,i);this.$cellDataFactoryCache=new Map;this.$cellQueryCache=new Map;this.$intersectionEditConfigs=new Map;this.$positionInfoCacheKeyFactoryCache=new Map;this.$keyManager=new p;this.$editConfigCache=new Map;this.$includeFieldFilters=r||false};w.prototype.generateHeadingData=function(e){var t=this,i=this.$getMAConfig(),r={},n;n=this.$getSliceSelections(e);i.axis.forEach(function(n,o){var a=i.headerConfig.get(o);m(a,"Couldn't find header config for axis: ",o);r[o]=t.$generateHeadings(a,e)});return new h.HeadingData(r,n,i)};w.prototype.$generateHeadings=function(e,t){var i=new g.HeadingGenerator(this.$getModel()),r=this.$macTermToMAHTerm(e,i,t),n=r&&h.termToAxisHeading(r);return n||undefined};w.prototype.$macTermToMAHTerm=function(e,t,i){var o=this,a=this.$getMAConfig(),s,l;if(e instanceof f.PlaceholderTerm){return new h.PlaceholderTerm(e.fieldId)}if(e instanceof f.ConcatTerm){s=n.compact(e.terms.map(function(e){return o.$macTermToMAHTerm(e,t,i)}).toArray());if(s.length)return new h.ConcatTerm(e.fieldId,s)}else if(e instanceof f.CrossTerm){s=n.compact(e.terms.map(function(e){return o.$macTermToMAHTerm(e,t,i)}).toArray());if(s.length)return new h.CrossTerm(e.fieldId,s)}else if(e instanceof f.NestTerm){if(e.fieldTerms.size)return t.generateMAHNestTerm(e,new r.Map(e.fieldTerms.map(function(e){var t=f.getField(a,e.fieldId);return[t,o.$getFieldHeaderData(t,i)]})),new r.Map(e.fieldTerms.map(function(e){var t=f.getField(a,e.fieldId);return[t,o.$getFieldSortData(t,i)]})),new r.Map(e.fieldTerms.map(function(t,n){var s=f.getField(a,t.fieldId),l=e.fieldTerms.get(n+1),u=l&&f.getField(a,l.fieldId),c=new r.List([s,u]);return[c,o.$getFieldMapData(c,i)]})),a)}else if(e instanceof f.FieldTerm){l=f.getField(a,e.fieldId);m(l,"Couldn't find field referenced by field term: ",e.fieldId);if(l instanceof f.LevelField)return t.generateMAHFieldTermForLevelField(e,o.$getFieldHeaderData(l,i),o.$getFieldSortData(l,i),a);else if(l instanceof f.MeasureField)return t.generateMAHFieldTermForMeasureField(e,a)}else{throw new Error("couldn't make term into MAH Term")}};w.prototype.$getSliceSelections=function(e){var t=this,i=this.$getMAConfig(),r=i.sliceConfigs,n={};r.forEach(function(i){if(i.sourceField instanceof f.LevelField){var o=t.getUnmaskedQueryData(t.$getQueryGenerator().generateSelectedSliceQuery(i,r),e),a=!(o.resultTable&&o.resultTable.dataTable),s=!a&&o.resultTable.dataTable[0],l=undefined;if(a){l=h.LOADING_MEMBER_ID}else if(s){l=s[0]}n[i.sourceField.id]={id:l,loading:a}}else if(i.sourceField instanceof f.MeasureGroupField){m(!i.byMeasure,"byMeasure slice configuration not currently supported for Measure Group Fields");var u=i.bySelection||i.sourceField.fields.size&&i.sourceField.fields.get(0).id;n[i.sourceField.id]={id:u,loading:false}}else if(i.sourceField instanceof f.MeasureField){m(!i.byMeasure,"byMeasure slice configuration not currently supported for MeasureFields");n[i.sourceField.id]={id:i.bySelection||i.sourceField.id,loading:false}}});return n};w.prototype.$getFieldHeaderData=function(e,t){if(e instanceof f.LevelField&&!f.isAllLevelField(e)){var i=this,o=this.$getMAConfig(),a=o.sliceConfigs.filterNot(function(e){return e.get("sourceField")instanceof f.MeasureGroupField}),s=this.$getQueryGenerator().generateHeaderQueries(e,a),l=new r.Map;n.forEach(s,function(e,r){if(r!=="_sorts_")l=l.set(r,i.getUnmaskedQueryData(e,t))});return l}else if(f.isAllLevelField(e)){return new r.Map({id:C([f.levelToQualifiedLevel(e.level),{}],[[e.id,e.id]]),label:C([f.levelToQualifiedLevel(e.level),{}],[[e.id,e.fieldLabel]])})}else if(e instanceof f.MeasureField){return new r.Map({id:C([{},{}],[[e.id,e.id]]),label:C([{},{}],[[e.id,e.fieldLabel]])})}};w.prototype.$getFieldSortData=function(e,t){var i=this.$getMAConfig(),r=i.sliceConfigs.filterNot(function(e){return e.get("sourceField")instanceof f.MeasureGroupField});if(e instanceof f.LevelField&&!f.isAllLevelField(e)){var n=this,o=this.$getQueryGenerator().generateHeaderQueries(e,r),a=o._sorts_;return a.map(function(e){return n.getUnmaskedQueryData(e,t)})}else{return[]}};w.prototype.$getFieldMapData=function(e,t){m(e.size===2,"can only generate map data for two-elem field pairs!");if(!e.get(0)||!e.get(1))return{};if(f.isAllLevelField(e.get(0)))return this.$getAllFieldMapData(e.get(0),e.get(1),t);else return this.getUnmaskedQueryData(this.$getQueryGenerator().generateFieldMapQuery(e),t)};w.prototype.$getAllFieldMapData=function(e,t,i){var r=this.$getFieldHeaderData(t,i).get("id"),n=e.id,o={isAvailable:r.isAvailable,isDirty:r.isDirty},a,s=0;if(r.resultTable&&r.resultTable.dataTable){o.resultTable={columnInfo:r.resultTable.columnInfo,dataTable:[]};for(;s<r.resultTable.dataTable.length;s++){a=r.resultTable.dataTable[s];o.resultTable.dataTable.push([a[0],n])}}return o};function C(e,t){return{isDirty:false,resultTable:{columnInfo:e,dataTable:t}}}w.prototype.getUnmaskedQueryData=function(e,t){var i=this.$calcMeasureQueryCacheKey(e);return E(i,t.getQueryDataBox())};function E(e,t){var i=t.getUnmaskedQueryData(e);return{resultTable:i&&i.resultTable,isAvailable:!n.isUndefined(i)}}var S={attributeOptions:{includeValue:true,includeEdit:true,includeSaving:true,includeLockStatus:true,includeProtectedStatus:true,includeOutstandingQueryStatus:true},builderOptions:{prebuildInfoAndData:true}};Object.freeze(S);function T(e){var t="",i;if(e){if(e===S){t+="$$defaultOptions"}else{for(i in e.attributeOptions){if(e.attributeOptions[i]){t+="$$"+i}}for(i in e.builderOptions){if(e.builderOptions[i]){t+="$$"+i}}}}return t}w.prototype.getDataRange=function(e,t,i,r,n,o){n=n||S;var a=this.$getMAConfig(),s=r.getHeadingData(),l=H(e,a,s),u=this.$mkCellDataBuilder(r,n),c=this,d=t?this.$makeInnerCellBuilder(t,u,n):function(e,t,i){var r=c.$calcPositionInfo(e,i);return u(e,t,i,r)};return v.iterateViewRange(a,s,l,d,i,o)};w.prototype.$makeInnerCellBuilder=function(e,t,i){var r=i.builderOptions.prebuildInfoAndData,n=this.$buildCellInfo.bind(this),o=this;if(r){return function(i,r,n,a,s,l){var u=o.$calcPositionInfo(i,n);return e(o.$buildCellInfo(i,r,n,a,u,s,l),t(i,r,n,u))}}else{return function(i,r,a,s,l){var u=o.$calcPositionInfo(i,a);return e(i,r,a,s,u,l,n,t)}}};w.prototype.getCellInfoInRange=function(e,t){var i=this.$getMAConfig(),r=t.getHeadingData(),n=H(e,i,r),o=this,a=function(e,t,i,r,n,a){var s=o.$calcPositionInfo(e,i);return o.$buildCellInfo(e,t,i,r,s,n,a)};return v.iterateViewRange(i,r,n,a,true)};w.prototype.$buildCellInfo=function(e,t,i,r,n,o,a){return{queries:!a?this.$getCellQueries(e,t):{},fields:e,rollups:t,editConfigs:this.$getEditConfigs(e,t),positionInfo:n,coord:o,members:i,headings:r}};w.prototype.$mkCellDataBuilder=function(e,t){var i=e.getBrokenQueryKeys(),r=this;return function(n,o,a,s){return r.getCellDataForInfo(s,e,n,o,i,t)}};w.prototype.getCellDataForInfo=function(e,t,i,r,n,o){var a=this.$getCellDataFactory(i,r,n,o),s=a(e,t);if(s.someInvalid){return{invalid:true,validityMessages:s.validityMessages}}else{return{invalid:false,queryResults:s.queryData,validityMessages:s.validityMessages}}};w.prototype.$getCellDataFactory=function(e,t,i,r){var n=this.$getKeyManager().makeFieldsRollupsKey(e,t)+"$$"+i.length+T(r),o=this.$cellDataFactoryCache.get(n);if(!o){o=F(this.$getCellQueries(e,t),this.$getEditConfigs(e,t),i,r,this.$getKeyManager());this.$cellDataFactoryCache.set(n,o)}return o};w.prototype.$calcPositionInfo=function(e,t,i){return this.$getPositionInfoCacheKeyFactoryForFields(e,i)(t)};w.prototype.generateUnmaskedQueries=function(e){return this.$getQueryGenerator().generateUnmaskedQueriesFromConfig(this.$getMAConfig(),e).filter(function(e){return a.queryIsValid(e)})};w.prototype.getRequiredMaskedQueries=function(e,t){var i=this,r=new Map,n=function(e,t,n){var o=i.$getKeyManager().makeFieldsRollupsKey(e,t),a=r.get(o);if(!a){a={fields:e,rollups:t,seenPositionInfos:[]};r.set(o,a)}a.seenPositionInfos.push(i.$calcPositionInfo(e,n))},o=this.$getMAConfig(),s=e.getHeadingData(),l=H(t,o,s),u=[];if(s.hasLoadingHeadings()||s.isLoadingSlice()||s.hasOnlyInvalidHeadings()||!l){return u}v.iterateViewRange(o,s,l,n,true);r.forEach(function(e){var t=e.fields,r=e.rollups,n=e.seenPositionInfos,o,s=i.$getCellQueries(t,r),l=i.$getEditConfigs(t,r),c=Object.keys(s),d,p,f,h,g=0,m;for(;g<c.length;g++){d=c[g];p=s[d];f=l[d];h={query:p.query,queryKey:p.queryKey,positionInfos:[]};if(a.queryIsValid(p.query)){if(f)h.editableMetricInters=f.metricInters;for(m=0;m<n.length;m++){o=n[m];if(p.positionFn)h.positionInfos.push(p.positionFn(o.members));else h.positionInfos.push(o)}}u.push(h)}});return u};w.prototype.$getEditConfigs=function(e,t){var i=this.$getKeyManager().makeFieldsRollupsKey(e,t),r=this.$editConfigCache.get(i);if(!r){r=this.$generateIntersectionEditConfigs(e,t,this.$getMAConfig().sliceConfigs);this.$editConfigCache.set(i,r)}return r};w.prototype.$getCellQueries=function(e,t){var i=this,n=this.$getKeyManager().makeFieldsRollupsKey(e,t),a=this.$cellQueryCache.get(n);if(!a){var s=this.$maConfig,l=this.$getQueryGenerator().calcInnerFields(e),c=this.$getQueryGenerator().generateIntersectionQueries(e,t,s.sliceConfigs,this.$includeFieldFilters),d=this.$getQueryGenerator().calcQueryFormatters(e),p;if(s.queryLevelFilterFlag){c["_passed_filter_"]=this.$getQueryGenerator().generateFilteredFlagQuery(e,s.sliceConfigs);d["_passed_filter_"]={}}p=Object.keys(c);a={};p.forEach(function(t){var n=c[t],s=[],p=[],h,g,m,v,y,b,w=0;a[t]={query:n,queryKey:i.$calcMeasureQueryCacheKey(n),formatter:d[t]};if(!(n.validityMessages&&n.validityMessages.length)){a[t].type=u.getMeasureValueType(n.measure,i.$getModel());m=n.mappedInter.qualified_level.map(o.qlevel.getLabel);for(;w<l.size;w++){v=l.get(w);if(v instanceof f.LevelField){b=v.level.labelName;if(m.indexOf(b)>-1)p.push(v);else s.push(b)}else p.push(v)}a[t].resultDataMap=x(l,n);h=p.map(function(t){return e.indexOf(t)});if(s.length){g=h.length;m=n.mappedInter.qualified_level.map(o.qlevel.getLabel);y=i.$getPositionInfoCacheKeyFactoryForFields(new r.List(p),h);a[t].positionFn=function(e){var t=0,i=[];for(;t<g;t++){i.push(e[h[t]])}return y(new r.List(i))}}}});this.$cellQueryCache.set(n,a)}return a};function x(e,t){var i=e.map(function(e){if(e instanceof f.LevelField){return f.levelToQName(e.level)}}),r=t.mappedInter.qualified_level.map(function(e){return f.mqgLevelToQName(e)}),o=r.map(function(e,t){if(i.indexOf(e)>-1){return{qName:e,index:t}}}).filter(n.identity),a={usedKeyMaps:o};a.key=JSON.stringify(a);return a}w.prototype.$getPositionInfoCacheKeyFactoryForFields=function(e,t){var i=this.$getKeyManager().makeFieldsKey(e)+JSON.stringify(t||"undefined"),r=this.$positionInfoCacheKeyFactoryCache.get(i);if(!r){r=this.$getPositionInfoFactory(e,t);this.$positionInfoCacheKeyFactoryCache.set(i,r)}return r};var _="$$";w.prototype.$getPositionInfoFactory=function(e,t){var i=this.$getQueryGenerator().calcIntersectionFromFields(e),r=i.qualified_level.map(function(e){return f.mqgLevelToQName(e)}),o,a,s;r.sort();o="[ "+JSON.stringify(r)+" ]";a=r.map(function(i){var r=e.findIndex(function(e){return e instanceof f.LevelField&&f.levelToQName(e.level)===i});m(!n.isUndefined(r),"Couldn't find index in fields for qname: ",i);if(t)return t[r];else return r});s=a.length;return function(e){var t="",i={},n,o=0;for(;o<s;o++){n=e[a[o]];t+=n+_;i[r[o]]=n}return{key:t,position:i,members:e}}};w.prototype.$calcMeasureQueryCacheKey=function(e){return this.$getKeyManager().calcMeasureQueryCacheKey(e)};w.prototype.$getModel=function(){return this.$modelUtility.getModel()};w.prototype.$getQueryGenerator=function(){return this.$queryGenerator};w.prototype.$getMAConfig=function(){return this.$maConfig};w.prototype.$getKeyManager=function(){return this.$keyManager};w.prototype.$generateIntersectionEditConfigs=function(e,t,i){var n=new r.List([e,t,i]).hashCode(),o=this.$intersectionEditConfigs.get(n);if(!o)this.$cacheIntersectionEditConfigs(n,e,t,i);return this.$intersectionEditConfigs.get(n)};w.prototype.$cacheIntersectionEditConfigs=function(e,t,i,r){var n=this.$getQueryGenerator(),o={};n.getDataConfigsForFields(t).map(function(e){o[e.name]=this.$generateIntersectionEditConfig(e,t,i,r)},this);this.$intersectionEditConfigs=this.$intersectionEditConfigs.set(e,o)};function M(e,t){return e.findIndex(function(e){if(e instanceof f.LevelField&&e.level){return e.level.levelName===t.level&&e.level.dimensionName===t.dimension&&e.level.labelName===t.label&&e.level.hierarchyName===t.hierarchy}})}function A(e,t){m(e.length===t.length,"Must have a positionInfoFn per metric intersection.");var i=e.length;return function(r){if(t.length!==r.length){throw new Error("Expected a list of "+t.length+" member lists, got "+r.length)}var n=0,o=0,a,s,l=[];for(;n<i;n++){a=[];s=t[n].length;for(;o<s;o++){a.push(r[n][t[n][o]])}l.push(e[n](a))}return l}}w.prototype.$generateIntersectionEditConfig=function(e,t,i,r){var n=this.$getQueryGenerator(),o=n.calcEditOptionsForDataCfg(e,t,i,r),a=n.calcCoreEditMeasure(e,o),l=s.getSpreadMethodLookup(a,this.$measureModel),c=n.calcEditMetricIntersForMeasure(a,o),d=[],p=[];c.forEach(function(e){var i=[],r=[];e.inter.qualified_level.forEach(function(e){var n=M(t,e);if(n>=0){i.push(t[n]);r.push(n)}});p.push(this.$getPositionInfoCacheKeyFactoryForFields(i,r));d.push(r)},this);return{dataConfig:e,dataConfigQuery:n.generateIntersectionQueryForDataConfig(e,t,i,r),coreEditMeasure:a,editable:!o.readonly&&!!l&&c.length>0,formatter:n.calcFormatterForDataCfg(e,t),metricInters:c,metricInterKeys:c.map(function(e){return u.stringifyMetricIntersection(e,true)}),editOptions:o,positionFn:A(p,d)}};function I(e){var t=e.resultDataMap,i=e.queryKey,r=e.query,n=e.formatter;return function(e,o){var a=o.getQueryPositionValue(r,n,i,e,t);return a}}function O(e){return function(t,i){return i.getQueryDataBox().hasQueryPositionOutstandingByKey(e,t)}}function D(e){if(e)return function(t,i){return i.getEditDataBox().hasEditLockedAtPosition(e,t)};else return function(){return false}}function N(e,t){if(!e)return function(){return false};var i=t.length;return function(e,r){var n=0,o,a=false,s=r.getEditDataBox(),l=s.getCurrentEditStateKey();for(;n<i;n++){o=s.getEditabilityByKeys(l,t[n]);a=a||o&&!o.isEditable;if(a)break}return a}}function R(e){if(e)return function(t,i){return i.getOutstandingSaveByKeys(e,t)};else return function(){return}}function P(e){if(e)return function(t,i){return i.getPendingEditByKeys(e,t)};else return function(){return}}function L(e,t,i,r){var n=$(e,t,i,r),o=n.length;return function(e,t){var i=0;var r={};for(;i<o;i++){n[i](r,t,e)}return r}}function k(e,t){return function(i,r,n){i[e]=t(n,r)}}function $(e,t,i,r){var n=i.attributeOptions,o=[],a=e.queryKey,s=t&&r.calcEditConfigKey(t),l=t&&t.metricInterKeys;if(n.includeValue){o.push(k("value",I(e,r)))}if(n.includeEdit){m(s,"Need edit key to make a factory for edit");o.push(k("edit",P(s,r)))}if(n.includeSaving){m(s,"Need edit key to make a factory for save");o.push(k("outstandingSave",R(s,r)))}if(n.includeLockStatus){m(s,"Need edit key to make a factory for lock status");o.push(k("locked",D(s)))}if(n.includeProtectedStatus){m(s,"Need edit key to make a factory for protected status");m(l,"Need metric inter keys to make a factory for protected status");o.push(k("protected",N(s,l,r)))}if(n.includeOutstandingQueryStatus){o.push(k("queryOutstanding",O(a,r)))}return o}function F(e,t,i,r,o){t=t||{};var s=Object.keys(e),l=s.every(function(t){var r=e[t];return a.queryIsValid(r.query)&&!q(r.queryKey,i)}),u=n.uniq(s.reduce(function(t,i){var r=e[i],n=r.query,o=0;if(n.validityMessages&&n.validityMessages.length){for(;o<n.validityMessages.length;o++){t.push(n.validityMessages[o])}}return t},[])),c,d,p;if(l){c=s.map(function(i){var a=e[i],s=t[i],l=n.cloneDeep(r);if(!s){l.attributeOptions.includeEdit=false;l.attributeOptions.includeSaving=false;l.attributeOptions.includeLockStatus=false;l.attributeOptions.includeProtectedStatus=false}return L(a,s,l,o)});d=c.length;p=s.map(function(t){return e[t].positionFn});return function(e,t){var i=0,r={},n={queryData:r,validityMessages:u,someInvalid:false},o;for(;i<d;i++){o=p[i];if(o)r[s[i]]=c[i](o(e.members),t);else r[s[i]]=c[i](e,t)}return n}}else{return V(u)}}function V(e){var t={queryData:{},validityMessages:e,someInvalid:true};return function(){return t}}function q(e,t){return t.indexOf(e)>-1}function H(e,t,i){var o=f.getOrderedAxes(t),a=new r.Map;if(!e||!i)return;o.forEach(function(t){var r=e[t]||{},o=new b({start:r.start||0}),s=i.getHeadingAxisInfo(t);if(n.isUndefined(r.length)||r.length>s.getLength()){o=o.set("length",s.getLength())}else{o=o.set("length",r.length)}a=a.set(t,o)});return a}},{"../cubiql":276,"../headinggen":295,"../multiaxisconfig":328,"../multiaxisheading":329,"../querygen/query":333,"../querygen/util":336,"./data":316,"./keymanager":320,"./modelutility":321,"./querygen":323,"./queryutil":324,assert:2,immutable:"immutable",lodash:70}],319:[function(e,t,i){"use strict";var r=e("lodash");var n=e("assert");var o=e("../querygen/results");var a=e("../multiaxisconfig");var s=e("../cubiql");var l=t.exports;l.EditDataBox=u;function u(e,t){this.$pendingEdits=new Map;this.$editSaveOutstanding=new Map;this.$editabilityDirty=new Map;this.$editabilityRequired=new Map;this.$editabilityCache=new Map;this.$keyManager=e;this.$lockStorage=t;this.$cachedEditState=undefined;this.$committedEditsQueue=[]}u.prototype.getKeyManager=function(){return this.$keyManager};u.prototype.getEditQueue=function(){return this.$committedEditsQueue};u.prototype.pushEditsOntoQueue=function(e){return this.getEditQueue().push(e)};u.prototype.popEditQueue=function(){this.$committedEditsQueue.shift()};u.prototype.clearEditQueue=function(){this.$committedEditsQueue=[]};u.prototype.$calcEditPosKeyFromEdit=function(e){var t=this.getKeyManager();return t.calcEditPositionKeyFromKeys(t.calcEditConfigKey(e.editConfig),e.positionInfo.key)};u.prototype.storePendingEdits=function(e){var t=this,i=this.getKeyManager();e.forEach(function(e){var o=e.editConfig,a=i.calcEditConfigKey(o),s=e.positionInfo.key,l=i.calcEditPositionKeyFromKeys(a,s),u=e.edit,c;if(u.isDelete&&r.isUndefined(u.data)){c=t.getPendingEditByKeys(a,e.positionInfo);if(c&&!c.edit.isDelete){t.removePendingEditByKey(l)}else{}}else{n(!r.isUndefined(u.data));u.formattedValue=o.formatter&&o.formatter.format(u.data)||u.data;t.addPendingEdit(e,l)}})};u.prototype.removePendingEdits=function(e){if(!e){this.$pendingEdits=new Map}else{e.forEach(this.removeEdit.bind(this))}};u.prototype.getPendingEditByKeys=function(e,t){return this.$pendingEdits.get(this.getKeyManager().calcEditPositionKeyFromKeys(e,t.key))};u.prototype.addPendingEdit=function(e,t){this.$dirtyEditState();return this.$pendingEdits.set(t,e)};u.prototype.removePendingEditByKey=function(e){this.$dirtyEditState();this.$pendingEdits.delete(e)};u.prototype.removeEdit=function(e){var t=this.$calcEditPosKeyFromEdit(e);this.removePendingEditByKey(t)};u.prototype.getAllPendingEdits=function(){return Array.from(this.$pendingEdits.values())};u.prototype.markOutstandingSaveByKey=function(e,t){this.$editSaveOutstanding.set(e,t)};u.prototype.markOutstandingSave=function(e){var t=this.$calcEditPosKeyFromEdit(e);this.markOutstandingSaveByKey(t,e)};u.prototype.unmarkOutstandingSave=function(e){var t=this.$calcEditPosKeyFromEdit(e);this.unmarkOutstandingSaveByKey(t)};u.prototype.unmarkOutstandingSaveByKey=function(e){this.$editSaveOutstanding.delete(e)};u.prototype.getOutstandingSaveByKeys=function(e,t){var i=this.getKeyManager();return this.$editSaveOutstanding.get(i.calcEditPositionKeyFromKeys(e,t.key))};u.prototype.markEditsForCommit=function(e){var t=this;if(e.length===0){return}this.pushEditsOntoQueue(e);e.forEach(function(e){t.removeEdit(e);t.markOutstandingSave(e)})};u.prototype.onEditsSucceeded=function(e){var t=new Map,i=this.getKeyManager(),r=new Map,n=this;e.forEach(function(e){var a=e.editConfig,s=e.edit,l=e.positionInfo,u=a.dataConfigQuery,d=i.calcMeasureQueryCacheKey(u),p=s.isDelete?undefined:s.data,f,h,g;if(!r.has(d))r.set(d,new Map);if(!t.has(d))t.set(d,{query:u,positionInfos:[],resultTable:o.createResultTableForQuery(u,[])});f=t.get(d);f.positionInfos.push(l);h=c(u,e.positionInfo,p);g=r.get(d);g.set(h.key,h.data);n.unmarkOutstandingSave(e)});r.forEach(function(e,i){t.get(i).resultTable.dataTable=Array.from(e.values())});this.popEditQueue();return t};function c(e,t,i){var o=t.position,s=[],l="",u,c=0,d=e.mappedInter.qualified_level,p=d.length;for(;c<p;c++){u=o[a.mqgLevelToQName(d[c])];if(r.isUndefined(u))n(false,"can't make data row, position: "+t.key+" is too small for query: "+JSON.stringify(e));s.push(u);l+=c+"_"+u+"__"}return{key:l,data:s.concat(i)}}u.prototype.onEditsFailed=function(e){var t=this;e.forEach(function(e){t.unmarkOutstandingSave(e)});this.clearEditQueue()};u.prototype.isEditabilityDirtyByKey=function(e){return this.$editabilityDirty.get(e)===true};u.prototype.markAllEditabilityDirty=function(){this.$editabilityCache.forEach(function(e,t){this.$editabilityCache.set(t,true)},this)};u.prototype.markEditabilityRequiredByKey=function(e,t){this.$editabilityRequired.set(e,t)};u.prototype.markEditabilityRequired=function(e){var t=this.getKeyManager(),i=t.calcMetricInterKey(e);this.markEditabilityRequiredByKey(i,e)};u.prototype.unmarkEditabilityRequiredByKey=function(e){this.$editabilityRequired.delete(e)};u.prototype.unmarkEditabilityRequired=function(e){var t=this.getKeyManager(),i=t.calcMetricInterKey(e);this.unmarkEditabilityRequiredByKey(i)};u.prototype.getOutstandingEditabilityNeeds=function(){var e=this.getCurrentEditState(),t=this.getCurrentEditStateKey(),i,n,o=[];this.$editabilityRequired.forEach(function(e,a){i=this.getKeyManager().calcEditabilityCacheKeyFromKeys(t,a);
n=this.$editabilityCache.get(i);if(r.isUndefined(n)||this.isEditabilityDirtyByKey(i)){o.push(this.$editabilityRequired.get(a))}},this);return{editState:e,metricInters:o}};u.prototype.destroy=function(){this.$lockStorage.destroy();this.$lockStorage=null};u.prototype.$dirtyEditState=function(){delete this.$cachedEditState};u.prototype.getCurrentEditState=function(){if(this.$cachedEditState)return this.$cachedEditState;var e={},t=this.getLockData(),i=function(t){var i=t.editConfig.metricInters,r=t.editConfig.metricInterKeys,n,o=i.length,a=0;for(;a<o;a++){n=r[a];if(!e[n])e[n]=i[a]}},n;this.getAllPendingEdits().forEach(i);t&&r.values(t).forEach(i);this.$cachedEditState=n=r.values(e);return n};u.prototype.getCurrentEditStateKey=function(){return this.getKeyManager().calcEditabilityStateKey(this.getCurrentEditState())};u.prototype.storeEditability=function(e,t,i){var r=this.getKeyManager(),n=r.calcEditabilityCacheKeyFromKeys(r.calcEditabilityStateKey(e),r.calcMetricInterKey(t));this.$editabilityCache.set(n,{editState:e,metricInter:t,isEditable:i});this.unmarkEditabilityRequiredByKey(n)};u.prototype.getEditabilityByKeys=function(e,t){var i=this.getKeyManager().calcEditabilityCacheKeyFromKeys(e,t);return this.$editabilityCache.get(i)};u.prototype.getLockData=function(){return this.$lockStorage.value};u.prototype.setLockData=function(e){this.$dirtyEditState();this.$lockStorage.value=e};u.prototype.hasEditLockedAtPosition=function(e,t){var i=this.getLockData(),r=i&&i[e];return r&&r.positions[t.key]};u.prototype.setLocks=function(e){n(!!e,["locks should be specified"]);var t=this.getLockData(),i=this.getKeyManager(),r={},o,a,s=e.length,l,u,c,d=0;for(;d<s;d++){o=e[d];a=i.calcEditConfigKey(o.editConfig);if(!r[a]){r[a]={editConfig:o.editConfig,positions:{}}}for(var p=0;p<o.positions.length;p++){u=o.positions[p];r[a].positions[u.key]=u}}for(a in t){if(!r[a]){r[a]=t[a]}else{c=t[a].positions;for(l in c){r[a].positions[l]=c[l]}}}this.setLockData(r)};u.prototype.unsetLocks=function(e){n(!!e,["locks should be specified"]);var t=this.getLockData(),i=this.getKeyManager(),r=0,o=0,a=e.length,s,l,u;if(!t||!Object.keys(t).length){return}for(;r<a;r++){l=e[r];u=i.calcEditConfigKey(l.editConfig);if(t[u]){s=l.positions.length;for(o=0;o<s;o++){delete t[u].positions[l.positions[o].key]}if(Object.keys(t[u].positions).length===0){delete t[u]}}}this.setLockData(t)};u.prototype.clearAllLocks=function(){this.setLockData(null)};u.prototype.hasLocks=function(){var e=this.getLockData();return e&&Object.keys(e).length>0};u.prototype.getLocks=function(){if(!this.hasLocks()){return[]}return r.map(this.getLockData(),function(e){return{editConfig:e.editConfig,positions:r.values(e.positions)}})}},{"../cubiql":276,"../multiaxisconfig":328,"../querygen/results":334,assert:2,lodash:70}],320:[function(e,t,i){"use strict";var r=e("../querygen/util");t.exports=n;function n(){}n.prototype.calcMeasureQueryCacheKey=function(e){if(!e.$queryKey){e.$queryKey=r.stringifyMeasureQuery(e)}return e.$queryKey};n.prototype.calcMeasureQueryPositionCacheKeyWithKeys=function(e,t){return e+"|"+t};n.prototype.calcEditabilityCacheKeyFromKeys=function(e,t){return"edited="+e+"|checked="+t};n.prototype.calcEditPositionKeyFromKeys=function(e,t){return e+"|"+t};n.prototype.calcEditConfigKey=function(e){return e.coreEditMeasure.toString()+JSON.stringify(e.editOptions)};n.prototype.calcEditabilityStateKey=function(e){var t=[],i=0;for(;i<e.length;i++)t.push(this.calcMetricInterKey(e[i]));t.sort();return t.join(":")};n.prototype.calcViewTaskKey=function(e,t){return e+"|"+t};n.prototype.calcMetricInterKey=function(e){return r.stringifyMetricIntersection(e,true)};n.prototype.makeFieldsKey=function(e){var t=0,i=e.length,r="";for(;t<i;t++){r+=e[t].id+"_"}return r};n.prototype.makeFieldsRollupsKey=function(e,t){var i=0,r=t.len,n,o=this.makeFieldsKey(e)+"_rollups_";for(i=0;i<r;i++){n=t[i];o+=(n?n.toString():"undefined")+"_"}return o};n.prototype.makeFieldsRollupsSliceKey=function(e,t,i){var r=this.makeFieldsRollupsKey(e,t),n=0,o=i.size,a=r+"_slices_";for(;n<o;n++){a+=i.get(n).sourceField.id+"_"}return a}},{"../querygen/util":336}],321:[function(e,t,i){"use strict";var r=e("../multiaxisconfig");var n=e("./keymanager");var o=e("measure-query-gen/src/MQG");var a=e("lodash");function s(e){this.$measureModel=e;this.$keyManager=new n;this.$innerFieldCache=new Map;this.$intersectionCache=new Map}t.exports=s;s.prototype.getModel=function(){return this.$measureModel};s.prototype.getKeyManager=function(){return this.$keyManager};s.prototype.calcInnerFields=function(e){var t=this.getKeyManager().makeFieldsKey(e),i=this.$innerFieldCache.get(t);if(!i){i=l(e,this.$measureModel);this.$innerFieldCache.set(t,i)}return i};function l(e,t){var i=e.filter(function(e){return e instanceof r.LevelField}),n=a.groupBy(i,function(e){return e.level.labelName}),o=r.compareLevelFields.bind(null,t),s=a.values(a.mapValues(n,function(e){e=e.slice();e.sort(o);return e[0]}));return a.uniq(e.filter(function(e){return!(e instanceof r.LevelField)||s.indexOf(e)>-1}))}s.prototype.calcIntersectionFromFields=function(e){var t=this.getKeyManager().makeFieldsKey(e),i=this.$intersectionCache.get(t);if(!i){var n=this.calcInnerFields(e),a=n.filter(function(e){return e instanceof r.LevelField});i=new o.Intersection(a.map(function(e){return r.levelToQualifiedLevel(e.level)}));this.$intersectionCache.set(t,i)}return i}},{"../multiaxisconfig":328,"./keymanager":320,lodash:70,"measure-query-gen/src/MQG":1}],322:[function(e,t,i){"use strict";var r=e("./binary_pos_search");var n=e("./data");function o(e,t,i){return{resultTable:e,dirty:t,saved:i}}function a(){this.$initialize()}a.prototype.$initialize=function(){this.$unmaskedQueryCache=new Map;this.$unmaskedQueryIsDirty=new Map;this.$maskedQueryCache=new Map;this.$positionSearcherCache=new Map;this.$querySearcherCache=new Map;this.initializeRequiredQueries();this.$sortCaches=new Map;this.$updateVersion()};a.prototype.initializeRequiredQueries=function(){this.$requiredUnmaskedQueries=new Map;this.$requiredMaskedQueries=new Map};a.prototype.clearDataCache=function(){this.$initialize()};a.prototype.getLastUpdated=function(){return this.$lastUpdated};a.prototype.$updateVersion=function(){this.$lastUpdated=performance.now()};a.prototype.markMeasureQueryRequired=function(e,t){this.$requiredUnmaskedQueries.set(e,{query:t})};a.prototype.requiresUnmaskedQueryByKey=function(e){return this.$requiredUnmaskedQueries.has(e)};a.prototype.unmarkMaskedQueryPositionRequiredByKey=function(e,t){var i=this.$requiredMaskedQueries.get(e);if(i)i.positionInfos.delete(t)};a.prototype.requiresMaskedQueryPositionForQueryKey=function(e){var t=this.$requiredMaskedQueries.get(e);if(t)return t.positionInfos.size>0};a.prototype.requiresMaskedQueryPositionForKeys=function(e,t){var i=this.$requiredMaskedQueries.get(e);return i&&i.positionInfos.has(t)};a.prototype.markMaskedQueryPositionRequired=function(e,t,i){var r=i.key,n=this.$getOrCreateRequiredMaskedQueries(t,e);n.positionInfos.set(r,i)};a.prototype.$getOrCreateRequiredMaskedQueries=function(e,t){if(!this.$requiredMaskedQueries.has(e))this.$requiredMaskedQueries.set(e,{query:t,positionInfos:new Map});return this.$requiredMaskedQueries.get(e)};a.prototype.markAllDirty=function(){var e=this,t,i,r,n;this.$unmaskedQueryCache.forEach(function(t,i){e.markUnmaskedQueryDirtyByKey(i)});this.$maskedQueryCache.forEach(function(e){r=e.entries();for(;t=r.next(),!t.done,i=t.value||[],n=i[1];){n.dirty=true}})};a.prototype.markUnmaskedQueryDirtyByKey=function(e){this.$unmaskedQueryIsDirty.set(e,true);this.$updateVersion()};a.prototype.markUnmaskedQueryCleanByKey=function(e){this.$unmaskedQueryIsDirty.set(e,false);this.$updateVersion()};a.prototype.isUnmaskedQueryDirtyByKey=function(e){return this.$unmaskedQueryIsDirty.get(e)===true};a.prototype.markMaskedQueryPositionDirtyByKey=function(e,t){var i=this.$maskedQueryCache.get(e),r;if(i){r=i.get(t);if(r){r.dirty=true}}this.$updateVersion()};a.prototype.markMaskedQueryPositionCleanByKey=function(e,t){var i=this.$maskedQueryCache.get(e),r;if(i){r=i.get(t);if(r){r.dirty=false}}this.$updateVersion()};a.prototype.hasCleanMaskedQueryPosition=function(e,t){var i=this.$maskedQueryCache.get(e),r;if(i){r=i.get(t)}return!!r&&r.dirty!==true};a.prototype.getMaskedQueryPositionSavedByKey=function(e,t){var i=this.$maskedQueryCache.get(e),r,n;if(i){r=i.get(t);n=r&&r.saved}return n};a.prototype.markMaskedQueryPositionSavedByKey=function(e,t,i){var r=this.$maskedQueryCache.get(e),n;if(r){n=r.get(t).saved=i}this.$updateVersion()};a.prototype.hasQueryPositionOutstandingByKey=function(e,t){var i=this.$requiredMaskedQueries.get(e),r=this.$maskedQueryCache.get(e),n=t.key,o=r&&r.get(n),a=i&&i.positionInfos.has(n);return a&&(!o||o.dirty)};a.prototype.hasCleanUnmaskedQueryData=function(e){return this.hasUnmaskedQueryData(e)&&!this.isUnmaskedQueryDirtyByKey(e)};a.prototype.getOutstandingUnmaskedQueries=function(){var e=[],t=this;this.$requiredUnmaskedQueries.forEach(function(i,r){if(!t.hasCleanUnmaskedQueryData(r))e.push(i.query)});return e};a.prototype.getOutstandingMaskedQueryPositions=function(){var e=[],t,i,r=this.$requiredMaskedQueries.entries(),n,o,a,s,l,u,c,d;for(;t=r.next(),!t.done,i=t.value||[],n=i[0],o=i[1];){l=this.$maskedQueryCache.get(n);a=o.query;d=o.positionInfos.entries();for(;t=d.next(),!t.done,i=t.value||[],c=i[0],u=i[1];){s=l&&l.get(c);if(!s||s.dirty)e.push({query:a,queryKey:n,positionInfo:u})}}return e};a.prototype.$getOrCreateMaskedQueryCache=function(e){var t=this.$maskedQueryCache.get(e);if(!t){t=new Map;this.$maskedQueryCache.set(e,t)}return t};a.prototype.storeResultTableForPositions=function(e,t,i,r){var n=this.$getOrCreateMaskedQueryCache(e),a=0,s=performance.now(),l=t.length,u=!!r,c;for(;a<l;a++){c=t[a].key;n.set(c,o(i,u,r&&s))}this.$updateVersion();this.$clearSearcherCache(e)};a.prototype.setUnmaskedMeasureQueryByKey=function(e,t){this.$unmaskedQueryCache.set(e,t);this.markUnmaskedQueryCleanByKey(e);this.$updateVersion();this.$clearSearcherCache(e)};a.prototype.hasQueryPositionData=function(e,t){return this.hasUnmaskedQueryData(e)||this.hasMaskedDataForPosition(e,t)};a.prototype.hasUnmaskedQueryData=function(e){return this.$unmaskedQueryCache.has(e)};a.prototype.getUnmaskedQueryData=function(e){var t=this.$unmaskedQueryCache.get(e),i;if(t){if(t.resultTable)i=this.$getSortedResultTable(t.resultTable);return{queryTime:t.queryTime,resultTable:i}}};a.prototype.$getSortedResultTable=function(e,t){t=t||s(e);var i=this.$getOrCreateSortCache(e),r=JSON.stringify(t),o=i.get(r);if(!o){o=n.sortResultTableByIndices(t,this.$makeSortComparatorsForTable(e,t),e);i.set(r,o)}return o};function s(e){var t=e.columnInfo,i=t.length-1,r=0,n=[];for(;r<i;r++)n.push(r);return n}a.prototype.$makeSortComparatorsForTable=function(e,t){return t.map(function(){return function(e,t){if(e<t)return-1;else if(e>t)return 1;else return 0}})};a.prototype.$getOrCreateSortCache=function(e){var t=this.$sortCaches.get(e);if(!t){t=new Map;this.$sortCaches.set(e,t)}return t};a.prototype.hasMaskedDataForPosition=function(e,t){return this.$getOrCreateMaskedQueryCache(e).has(t)};a.prototype.getQueryPositionValue=function(e,t,i,r,n){var o=this.$preparePositionSearcher(e,t,i,n),a=o.findPositionValue(r);if(a)a.lastSaved=o.getQueryTime()||this.getMaskedQueryPositionSavedByKey(i,r.key);return a};a.prototype.$preparePositionSearcher=function(e,t,i,n){var o=this.$getCachedPositionSearcher(i,n),a;if(!o){o=new r(e,t,n);if(this.hasUnmaskedQueryData(i)){a=this.getUnmaskedQueryData(i);o.setSingleTable(a.resultTable,a.queryTime)}else{o.setPositionTableMap(this.$getOrCreateMaskedQueryCache(i))}this.$cachePositionSearcher(i,n,o)}return o};a.prototype.$getCachedPositionSearcher=function(e,t){var i=this.$querySearcherCache.get(e);return i&&i.get(t.key)};a.prototype.$clearSearcherCache=function(e){this.$querySearcherCache.delete(e)};a.prototype.$cachePositionSearcher=function(e,t,i){var r=this.$querySearcherCache.get(e);if(!r){r=new Map}r=r.set(t.key,i);this.$querySearcherCache.set(e,r)};t.exports=a},{"./binary_pos_search":315,"./data":316}],323:[function(e,t,i){"use strict";var r=e("../cubiql");var n=e("../querygen/util");var o=e("../querygen/query");var a=e("../querygen/filter");var s=e("../multiaxisconfig");var l=e("../multiaxisheading");var u=e("measure-query-gen/src/MQG");var c=e("assert");var d=e("lodash");var p=e("../util");var f=e("immutable");var h=e("../constant/sort");var g=e("./modelutility");var m=e("./queryutil");var v=e("./validity");var y=e("../formatter");var b={HEADER:"HEADER",SELECTED_SLICE:"SELECTED_SLICE",INTERSECTION:"INTERSECTION",INTERSECTION_UNMASKED:"INTERSECTION_UNMASKED"};Object.freeze(b);function w(e,t){this.$measureModel=e;this.$metricConfigs=t;this.$modelUtility=new g(e);this.$nameCache=new f.Map;this.$intersectionQueries=new f.Map;this.$formatters=new f.Map;this.$headerQueryCache=new f.Map;this.$mapQueryCache=new f.Map}w.prototype.generateUnmaskedQueriesFromConfig=function(e,t){var i=new f.List,r=e.sliceConfigs.filterNot(function(e){return e.get("sourceField")instanceof s.MeasureGroupField}),n=this;if(!e)return i;if(t.indexOf(b.HEADER)>-1){e.axis.forEach(function(e){e.forEach(function(e){if(e instanceof s.LevelField&&!s.isAllLevelField(e)){i=i.concat(C(n.generateHeaderQueries(e,r)))}else if(e instanceof s.DimensionField){e.fields.forEach(function(t,o){var a;if(!s.isAllLevelField(t)){i=i.concat(C(n.generateHeaderQueries(t,r)))}if(o>0&&!s.isAllLevelField(e.fields.get(o-1))){a=new f.List([e.fields.get(o-1),t]);i=i.push(n.generateFieldMapQuery(a))}})}})})}if(t.indexOf(b.SELECTED_SLICE)>-1){e.sliceConfigs.forEach(function(e){if(e.sourceField instanceof s.LevelField)i=i.push(n.generateSelectedSliceQuery(e,r))})}if(t.indexOf(b.INTERSECTION)>-1){this.computeAllFieldListsWithRollups(e).forEach(function(t){i=i.concat(C(n.generateIntersectionQueries(t.fieldList,t.rollupConfigs,r,true)));if(e.queryLevelFilterFlag){i=i.push(n.generateFilteredFlagQuery(t.fieldList,r))}})}return i};w.prototype.computeAllFieldListsWithRollups=function(e){var t=e.headerConfig,i,r,n,o=f.Set();i=t.map(function(t){var i=l.makePrototypeFromMacTerm(t,e);return i});var a=d.compact(i.valueSeq().toJS()),s=a.length;a=d.sortBy(a,function(e,t){if(e instanceof l.ConcatTerm){return s+t}else{return t}});r=new l.CrossTerm(undefined,a);n=l.termToAxisHeading(r);n.getHeadingRange(0,n.getLength()).forEach(function(e){var t={fieldList:e.fields,rollupConfigs:d.compact(e.rollups)};o=o.add(t)});return o.toArray()};function C(e){var t=Object.keys(e),i,r=t.length,n=0,o=[];for(;n<r;n++){i=e[t[n]];if(d.isArray(i))o=o.concat(i);else o.push(i)}return o}w.prototype.generateHeaderQueries=function(e,t){var i=new f.List([e,t]),r=this.$headerQueryCache.get(i);if(!r){if(e instanceof s.LevelField){r=T(e,t,this.$measureModel)}else{throw new Error("can't generate header queries for field: ",e)}this.$headerQueryCache=this.$headerQueryCache.set(i,r)}return r};w.prototype.generateSelectedSliceQuery=function(e,t){var i=new f.List([e,t]),r=this.$headerQueryCache.get(i);c(e.sourceField instanceof s.LevelField,"Can only generate slice query for slices on level fields");if(!r){r=$(e,t,this.$measureModel);this.$headerQueryCache=this.$headerQueryCache.set(i,r)}return r};function E(e,t){var i=d.groupBy(e,function(e){return e.level.labelName});var r=d.mapValues(i,function(e,i){var r=e[0].level.dimensionName,n=e.map(function(e){return s.levelToQualifiedLevel(e.level)});return t.findLowestLevel(r,n)});var n=d.values(r).filter(function(e){return e.level!=="ALL"});return new u.Intersection(n)}w.prototype.generateFilteredFlagQuery=function(e,t){var i=t.filterNot(function(e){return e.get("sourceField")instanceof s.MeasureGroupField}),r=this.$measureModel,a=e.filter(function(e){return e instanceof s.LevelField}),l=d.flatten(a.map(function(e){return A(e,i,r)})),u=E(a,r),c=ee(l);return{label:"Filtered intersection point query",measure:new o.ConstantTerm(1,o.Type.INT),inter:u,interLabelMap:n.calcSelfLabelMap(u.qualified_level,true),aggMethodLookup:{},filter:c.length?te(undefined,u,c,r):undefined,mappedInter:u,labelMap:n.calcSelfLabelMap(u.qualified_level),functionalQuery:true}};w.prototype.generateIntersectionQueries=function(e,t,i,r){var n=this,o=new f.List([e,t,i]),a=this.$intersectionQueries.get(o);if(a)return a;a={};this.getDataConfigsForFields(e).map(function(o){a[o.name]=n.generateIntersectionQueryForDataConfig(o,e,t,i,r)});this.$intersectionQueries=this.$intersectionQueries.set(o,a);return a};w.prototype.calcInnerFields=function(e){return this.getModelUtil().calcInnerFields(e)};w.prototype.calcIntersectionFromFields=function(e){return this.getModelUtil().calcIntersectionFromFields(e)};w.prototype.generateIntersectionQueryForDataConfig=function(e,t,i,r,o){var a=v.checkIntersectionQueryValidity(e,t,i,this.getModelUtil()),s=a.length===0,l="intersection query for "+e.name;if(!s)return{label:l,validityMessages:a};var u=this.$measureModel,c=z(e.measure,u),d=m.getRollupConfigsByMeasureLabel(c.inter,t,i,this.getModelUtil()),p=m.generateAggMethodLookupForMeasure(e.measure,d,u),f=e.filters?e.filters.map(function(e){return P(e,u)}).toArray():[];if(o){t.forEach(function(e){if(e.filters){f=f.concat(e.filters.map(function(e){return P(e,u)}).toArray())}})}return{label:l,measure:c.measure,inter:c.inter,mappedInter:c.mappedInter,labelMap:n.calcSelfLabelMap(c.inter.qualified_level),interLabelMap:c.interLabelMap,filter:f.length?te(c.measure,c.inter,f,u):undefined,constrainByAncestor:c.constrainByAncestor,aggMethodLookup:p,functionalQuery:true}};w.prototype.getDataConfigsForFields=function(e){var t=e.filter(function(e){return e instanceof s.MeasureField}),i=e.filter(function(e){return e instanceof s.LevelField}),r=new f.List,n=f.Set(i);if(t.length){t.forEach(function(e){r=r.concat(e.dataPerFieldSet.get(n)||e.data)})}return r};w.prototype.generateFieldMapQuery=function(e){var t=this.$mapQueryCache.get(e);if(!t){c(e.size===2,"Field Maps can only be generated for a list of exactly 2 fields");c(e.get(0)instanceof s.LevelField,"Must be a Level Field");c(e.get(1)instanceof s.LevelField,"Must be a Level Field");var i=e.get(0),r=e.get(1),a=s.levelToQualifiedLevel(i.level),l=s.levelToQualifiedLevel(r.level),d=new u.Intersection(l),p=new o.LevelMap(l,a),f=L(i,e,this.$measureModel);c(f.size===2,"Both fields in pair need to be of same labelled dimension");t={label:p.name,measure:p,inter:d,mappedInter:d,aggMethodLookup:{},labelMap:n.calcSelfLabelMap([l]),functionalQuery:true};this.$mapQueryCache.set(e,t)}return t};w.prototype.calcCoreEditMeasure=function(e,t){if(e.customEdit){return this.$calcCoreEditFromCustomEdit(e.customEdit,e,t)}else if(e.measure.metric){var i=this.$metricConfigs&&this.$metricConfigs[e.measure.metric.name];if(i&&i.headMetric)return e.measure.set("metric",this.$mapMetricToHeadMetric(e.measure.metric,i.headMetric,t)).delete("labelMap");else return e.measure}else{return e.measure}};w.prototype.$mapMetricToHeadMetric=function(e,t,i){var n=this.$measureModel.getMeasureInfo(t),o=n.inter,a=[],s=e.intersection.map(function(e){var t=o.qualified_level.findIndex(function(t){return e.labelName===r.qlevel.getLabel(t)});if(t>-1&&!a.indexOf(t)>-1){a.push(t);return e}}).filter(d.identity);return e.set("name",t).set("intersection",s)};w.prototype.$calcCoreEditFromCustomEdit=function(e,t,i){c(e.editTarget,"CustomEdit must have editTarget");c(e.editTarget.metricName,"Currently only EditTargets with a metricName are supported");var r=e.editTarget.metricName,n=this.$getCoreMetricFromMetric(t.measure),o=n&&this.$mapMetricToHeadMetric(n,r,i);c(o,"Couldn't calculate core edit metric for custom edit");return t.measure.delete("operator").set("metric",o)};w.prototype.$getCoreMetricFromMetric=function(e){c(e.metric||e.operator,"Can't get core metric from a measure that is not either a metric or operator");if(e.metric)return e.metric;else if(e.operator)return this.$getCoreMetricFromMetric(e.operator.measures.get(0))};w.prototype.calcEditMetricIntersForMeasure=function(e,t){if(!e.metric)return[];var i=new u.MetricInter(e.metric.name,s.intersectionToMQGIntersection(s.getIntersectionForMeasure(e,this.$measureModel))),n=[],o,a=t.pctParentConfig;if(!m.isDimensionSplit(e.labelMap)){n=[new u.MetricInter(e.metric.name,m.invertIntersectionLabelling(i.inter,e.labelMap))];if(a){o=new u.Intersection(i.inter.qualified_level.map(function(e){if(e.dimension==a.parentLevel.dimensionName){e=r.cloneQualifiedLevel(e);e.level=a.parentLevel.levelName;return e}else return e}).filter(function(e){return e&&e.level!=="ALL"}));n.push(new u.MetricInter(e.metric.name,m.invertIntersectionLabelling(o,e.labelMap)))}}return n};w.prototype.calcEditOptionsForDataCfg=function(e,t,i,r){if(e.measure.metric){return this.calcEditOptionsForDataCfgForMetric(e,t,i,r)}else{return{}}};w.prototype.calcEditOptionsForDataCfgForMetric=function(e,t,i,r){var n=e.measure.metric.name,o=this.$measureModel.getMeasureInfo(n),a={};a.customSpreadMethodAllowed=!o.recalc;a.pctParentConfig=this.calcPctParentEditConfig(e,n,t);a.readonly=this.$metricConfigs[n]&&this.$metricConfigs[n].readonly;return a};w.prototype.calcPctParentEditConfig=function(e,t){var i=e.measure.metric.name,r=this.$measureModel.getMeasureInfo(i),n=this.$measureModel.getPctParentConfig(i);if(!n)return;var o=e.measure.labelMap.get(n.childLabel),a=o&&o.get(0)||n.childLabel,s=e.measure.metric.intersection.find(function(e){return e.labelName===a})||S(n.dimension,a,this.$measureModel.getDefaultHierarchyName(n.dimension)),l=e.measure.metric.intersection.find(function(e){return e.labelName===n.parentLabel})||S(n.dimension,n.parentLabel,s.hierarchyName);return{childLevel:s,parentLevel:l}};w.prototype.calcQueryFormatters=function(e){var t=this,i=e,r=this.$formatters.get(i);if(r)return r;r={};this.getDataConfigsForFields(e).map(function(i){r[i.name]=t.calcFormatterForDataCfg(i,e)});this.$formatters=this.$formatters.set(i,r);return r};w.prototype.calcFormatterForDataCfg=function(e,t){if(!e.measure.metric){return y.getFormatter(undefined,"Simple")}var i=e.format||null,r=e.measure.metric.name,n=this.$measureModel.getMeasureInfo(r).type.kind;return y.getFormatter(i,r,n)};w.prototype.getModelUtil=function(){return this.$modelUtility};function S(e,t,i){return s.mkLevel({dimensionName:e,labelName:t||e,hierarchyName:i||"Default",levelName:"ALL"})}function T(e,t,i){var r={id:D(e,t,i),_sorts_:[]};e.data.forEach(function(n){r[n.name]=R(n,e,t,i)});e.sortConfigs.forEach(function(n,o){r._sorts_.push(N(o,e,t,i))});return r}function x(e,t){var i=e.level,r=t.level;if(!i||!r)return false;return i.dimensionName===r.dimensionName&&(d.isUndefined(i.labelName)&&d.isUndefined(r.labelName)||i.labelName===r.labelName)}function _(e,t){var i=e.level,r=t.level;if(!i||!r)return false;return i.dimensionName===r.dimensionName}function M(e,t,i){var r=f.List(),n=s.levelToQualifiedLevel(e.level),o,a,l;if(e.filterByAllSlicesInDimension){o=t.filter(function(t){var r=_(t.sourceField,e);return r&&t.sourceField.level&&!i.qLevelBelow(s.levelToQualifiedLevel(t.sourceField.level),n)});r=o.map(function(r){var o=_(r.sourceField,e)?n.label:undefined;return k(r,t,i,o)})}a=e.filters.reduce(function(t,i){if(!i.measure.metric){return t}var r=s.getIntersectionForMeasure(i.measure);return t.concat(r.filter(function(t){return t.labelName!==e.level.labelName}).map(function(e){return e.labelName}))},f.List());l=t.filter(function(e){var t=e.sourceField.level.labelName;return a.some(function(e){return e===t})});r=r.concat(l.map(function(e){return k(e,t,i)}));return r}function A(e,t,i){var r=t.find(function(t){return t.sourceField.id===e.id}),n=r?new f.List:M(e,t,i);return d.compact(e.filters.map(function(e){return P(e,i)}).toArray().concat(n.toArray()))}function I(e){return e.labelMap&&e.labelMap.toJS()||{}}function O(e){var t=e.labelName,i=e.dimensionName,r={};if(t!==i)r[i]=[t];return r}function D(e,t,i){var r=s.levelToQualifiedLevel(e.level),a=new u.Intersection(r),l=ee(A(e,t,i)),c=new o.Attribute("id",r);return{label:"Header query for id for field: "+e.id,measure:c,inter:a,interLabelMap:O(e.level),aggMethodLookup:{},filter:l.length?te(c,a,l,i):undefined,mappedInter:a,labelMap:n.calcSelfLabelMap(a.qualified_level),functionalQuery:true}}function N(e,t,i,r){var o=s.levelToQualifiedLevel(t.level),a=new u.Intersection(o),l=t.sortConfigs.get(e),c=l.measure.metric?new u.Intersection(l.measure.metric.intersection.map(s.levelToQualifiedLevel).toJS()):a,d=n.calcSelfLabelMap(c.qualified_level),p=W(l.measure,r,i),f=p.queryMeasure,h=p.interLabelMap,g=A(t,i,r),v=j(f,c,r),y=ee(v.concat(g)),b=y.length?te(f,c,y,r):undefined,w=m.generateAggMethodLookupForMeasureAndIntersection(l.measure,p.inter,h,{},r);return{label:"Header query for sort config #"+e+"' for field: "+t.id,measure:f,inter:c,interLabelMap:h,aggMethodLookup:w,filter:b,mappedInter:a,labelMap:d,functionalQuery:true}}function R(e,t,i,r){var o=e.measure,a=s.getIntersectionForMeasure(o,r),l=s.intersectionToMQGIntersection(a),u=d.compact(A(t,i,r,o).concat(e.filters.map(function(e){return P(e,r)}).toArray())),p=j(o,l,r),f=ee(p.concat(u)),h=W(o,r).queryMeasure,g=m.generateAggMethodLookupForMeasure(o,{},r),v=I(o);c(a.size===1,"unexpected intersection for measure of header query");return{label:"Header query for data '"+e.name+"' for field: "+t.id,measure:h,inter:l,interLabelMap:v,aggMethodLookup:g,filter:f.length?te(h,l,f,r):undefined,mappedInter:l,labelMap:n.calcSelfLabelMap(l.qualified_level),functionalQuery:true}}function P(e,t){var i=W(e.measure,t).queryMeasure,r=s.intersectionToMQGIntersection(s.getIntersectionForMeasure(e.measure,t)),l=I(e.measure),c=[],p=e.comparisons.groupBy(function(e){return e.operator}),f=!!e.measure.metric,h=f?m.generateAggMethodLookupForMetric(e.measure.metric,e.measure.labelMap,{},t):{},g,v;if(r.qualified_level.length===1&&p.keySeq().toJS().length===1&&p.get("=")&&p.get("=").every(function(e){return!d.isUndefined(e.comparator.literal)})){return new a.MeasureQueryFilter([U(r,p.get("=").map(function(e){return[e.comparator.literal]}).toArray())],true,true)}else if(e.comparisons.size){c=e.comparisons.map(function(e){if(e.comparator.metric){g=new o.Metric(e.comparator.metric.name);v={label:"by metricName filter",measure:g,inter:s.intersectionToMQGIntersection(s.getIntersectionForMetric(e.comparator.metric,t)),mappedInter:new u.Intersection};if(n.getMeasureValueType(g,t)!==n.getMeasureValueType(i,t))v={label:"cast filter metric value of "+g.name+" to filter measure type",measure:new o.Cast(v,n.getMeasureValueType(i,t)),inter:v.inter,mappedInter:v.mappedInter};return{label:"measure filter "+i.name+" "+e.operator+" "+e.comparator.metric.name,measure:i,inter:r,mappedInter:r,interLabelMap:l,aggMethodLookup:h,labelMap:n.calcSelfLabelMap(r.qualified_level),filter:new a.MeasureQueryFilter([v],false,false,{operator:e.operator})}}else if(!d.isUndefined(e.comparator.literal)){return{label:"measure filter "+i.name+" "+e.operator+" "+e.comparator.literal,measure:i,inter:r,mappedInter:r,interLabelMap:l,aggMethodLookup:h,labelMap:n.calcSelfLabelMap(r.qualified_level),filter:new a.MeasureQueryFilter([U(new u.Intersection,[[e.comparator.literal]],undefined,n.getMeasureValueType(i,t))],true,false,{operator:e.operator})}}}).toArray();if(c.length)return new a.MeasureQueryFilter(c,true,true)}else{return new a.MeasureQueryFilter([{label:"by-position filter using "+s.stringifyFilter(e),measure:i,inter:r,interLabelMap:l,aggMethodLookup:h,labelMap:n.calcSelfLabelMap(r.qualified_level),mappedInter:r}],false,true)}}function L(e,t,i){var r=t.filter(function(t){if(!t.level)return false;else return x(t,e)}).sort(function(e,t){return s.compareLevelFields(i,e,t)}).reverse();return r}function k(e,t,i,r){var l=$(e,t,i),c=r?e.sourceField.level.set("labelName",r):e.sourceField.level,d=s.levelToQualifiedLevel(c),p=new u.Intersection(d);return new a.MeasureQueryFilter([{label:"filter for selected slice value of "+s.mqgLevelToQName(d),measure:new o.Attribute("id",d),inter:p,mappedInter:p,interLabelMap:O(c),aggMethodLookup:{},filter:new a.MeasureQueryFilter([l],false,false,{operator:"="}),labelMap:n.calcSelfLabelMap([d])}],true,true)}function $(e,t,i){var r=e.sourceField,n=t.map(function(e){return e.sourceField}),l=L(r,n,i),u=l.indexOf(r),p=l.filter(function(e,t){return t>u}),f=p.findLast(function(e){var i=t.get(n.indexOf(e));return i.bySelection}),h=f&&t.get(n.indexOf(f)),g=z(s.mkMeasure({attribute:{name:"id",level:r.level}}),i),m=p.filter(function(e){var i=t.get(n.indexOf(e));return i.byMeasure}),v,y,b=[];if(h){v=o.cloneMeasureQuery(g);v.filter=P(s.mkFilter({measure:{attribute:{name:"id",level:h.sourceField.level}},comparisons:[{operator:"=",comparator:{literal:h.bySelection}}]}),i);b.push(H(v))}else if(e.bySelection){y=o.cloneMeasureQuery(g);y.filter=new a.MeasureQueryFilter([B(e.bySelection)],true,false,{operator:"="});b.push(H(y))}else{m.reverse().forEach(function(e){var r=t.get(n.indexOf(e)),a=o.cloneMeasureQuery(g);c(r.byMeasure.metric,"Only slices configured by a measure which is a Metric are currently supported");a.filter=P(s.mkFilter({measure:{attribute:{name:"id",level:e.level}},comparisons:[{operator:"=",comparator:{metric:{name:r.byMeasure.metric.name}}}]}),i);b.push(H(a))});if(e.byMeasure)b.push(F(e.sourceField,e.byMeasure,t,i))}b.push(q(e.sourceField,t,i));b=d.compact(b);c(b.length,"Couldn't generate any slice queries for slice config!");return{label:"Overriden Selected Slice For "+s.levelToQName(r.level),measure:new o.OverriddenMeasureQuery(b),inter:b[0].inter,mappedInter:b[0].mappedInter,aggMethodLookup:b[0].aggMethodLookup,labelMap:b[0].labelMap,functionalQuery:true}}function F(e,t,i,r){var a=z(t,r),s=a.mappedInter,l=n.getMeasureValueType(a.measure,r),u;if(l==="STRING"){u=a}else if(l==="NAMED"){u={label:"selected slice query of "+e.id+" by measure",measure:new o.Cast(a,"STRING"),inter:s,mappedInter:s,aggMethodLookup:{},labelMap:n.calcSelfLabelMap(s.qualified_level),functionalQuery:true}}else{throw new Error("Unable to use slice metric of type: "+l)}u=H(u);u.label="Selected slice for "+e.id+" by "+t.metric.name;return u}function V(e,t,i){return s.compareLevelFields(e,t.sourceField,i.sourceField)}function q(e,t,i){var r=D(e,t,i),l=D(e,t,i),c=l,d=e.level.labelName,p=V.bind(null,i),f=t.filter(function(t){return _(t.sourceField,e)&&s.compareLevelFields(i,t.sourceField,e)>0}),g=f.size&&f.sort(p).last();if(g){c.filter=c.filter?a.conjunctFilters([c.filter,k(g,t,i)]):c.filter=k(g,t,i)}e.sortConfigs.forEach(function(r,l){var p=N(l,e,t,i),f=N(l,e,t,i),g=p.measure;p.filter=new a.MeasureQueryFilter([c],true,true);var m={label:"Min of Sort Attribute: "+n.stringifyMeasure(g)+" for "+s.levelToQName(e.level),measure:new o.FilteredMeasureQuery(p),inter:new u.Intersection,mappedInter:new u.Intersection,aggMethodLookup:{},labelMap:{},functionalQuery:true};m.aggMethodLookup[d]={primitive:r.sortType===h.ASCENDING?"MIN":"MAX"};if(f.filter){f.filter=a.conjunctFilters([f.filter,new a.MeasureQueryFilter([m],false,false,{operator:"="})])}else{f.filter=new a.MeasureQueryFilter([m],false,false,{operator:"="})}c=f});var m;if(!o.measuresEqual(r.measure,c.measure)){m=o.cloneMeasureQuery(r);m.filter=new a.MeasureQueryFilter([c],true,true)}else{m=c}return H(m)}function H(e){if(e.mappedInter.qualified_level.length===0)return e;var e={label:"Scalar version of inner query",measure:new o.FilteredMeasureQuery(e),inter:e.mappedInter,mappedInter:new u.Intersection,aggMethodLookup:{},labelMap:{},functionalQuery:true};e.inter.qualified_level.forEach(function(t){var i=r.qlevel.getLabel(t);e.aggMethodLookup[i]={primitive:"MIN"}});return e}function U(e,t,i,r){var a=new o.LiteralRelation(e,t,i,r);return{label:"literal relation query: "+i,measure:a,inter:e,mappedInter:e,aggMethodLookup:{},labelMap:n.calcSelfLabelMap(e.qualified_level)}}function B(e){return{label:"Literal scalar query = "+e,measure:new o.LiteralRelation(new u.Intersection,[[e]],undefined,"STRING"),inter:new u.Intersection,mappedInter:new u.Intersection,aggMethodLookup:{},labelMap:{},functionalQuery:true}}function z(e,t){var i=s.intersectionToMQGIntersection(s.getIntersectionForMeasure(e,t)),o=W(e,t),a=o.queryMeasure,l=o.interLabelMap,c=m.generateAggMethodLookupForMeasure(e,{},t),d=e.metric&&t.isPctParentMetric(e.metric.name),f=d&&t.getPctParentConfig(e.metric.name).parentLabel,h=d?new u.Intersection(i.qualified_level.filter(p.not(r.qlevel.labelEquals(f)))):i;
return{label:"measure query for "+n.stringifyMeasure(a),measure:a,inter:i,interLabelMap:l,aggMethodLookup:c,mappedInter:h,constrainByAncestor:d,labelMap:n.calcSelfLabelMap(i.qualified_level,i.qualified_level)}}function j(e,t,i){if(e instanceof o.FilteredMeasureQuery){var r=e.measureQuery.measure,n=e.measureQuery.filter,a=j(r,t,i),s=G(n,t,i),l=[];if(s){delete e.measureQuery.filter;l=[n]}if(a.length>0){l.concat(a)}return l}else{return[]}}function G(e,t,i){if(!e){return false}else if(e instanceof a.CompositeFilter){return e.filters&&e.filters.every(function(e){return G(e,t,i)})}else if(e instanceof a.MeasureQueryFilter){return e.queries&&e.queries.every(function(e){return r.isIntersectionEqualOrHigher(e.inter,t,i)})}else{throw new Error("Unknown filter of type:"+e.constructor.name)}}function W(e,t,i){if(e.operator){return Q(e,t,i)}else if(e.metric){return K(e,t,i)}else if(e.attribute){return Y(e,t,i)}else if(e.application){return X(e,t,i)}else{c(false,"Don't know how to make query measure from measure type")}}function Q(e,t,i){var r=e.operator,n=r.measures.map(function(e){return z(e,t,i)}).toArray();return{queryMeasure:new o.Operator(n,r.name),inter:s.intersectionToMQGIntersection(s.getIntersectionForMeasure(e,t)),interLabelMap:I(e)}}function K(e,t,i){if(e.metric.filters.size||i&&i.size)return Z(e,t,i);else return{queryMeasure:new o.Metric(e.metric.name),inter:t.getMeasureInfo(e.metric.name).inter,interLabelMap:I(e)}}function Y(e,t){var i=e.attribute;c(!!t.getLevel(i.level.dimensionName,i.level.levelName),"Could not generate query for attribute due to invalid level.");var r=s.levelToQualifiedLevel(i.level),n=s.intersectionToMQGIntersection(s.getIntersectionForMeasure(e,t)),a=I(e);if(i.name==="label"){return{queryMeasure:new o.OverriddenAttribute([new o.Attribute("label",r),new o.Attribute("id",r)]),inter:n,interLabelMap:a}}else{return{queryMeasure:new o.Attribute(i.name,r),inter:n,interLabelMap:a}}}function X(e,t,i){var r=e.application,n=new o.Application(s.signatureToMQGSignature(r.signature),J(r.abstraction,t,i),r.interArgs.map(function(e){var t=e.intersection?s.intersectionToMQGIntersection(e.intersection):undefined;return new u.InterArgument(e.name,t)}).toArray(),r.exprArgs.map(function(e){var t=e.exprStr?new u.Expr(undefined,undefined,e.exprStr):undefined;return new u.ExprArgument(e.name,t)}).toArray(),r.valueType);return{queryMeasure:n,inter:s.intersectionToMQGIntersection(s.getIntersectionForMeasure(e,t)),interLabelMap:I(e)}}function J(e){return new o.Abstraction(new o.StringMeasure(e.bodyStr),e.interArgs.map(function(e){var t=e.intersection?s.intersectionToMQGIntersection(e.intersection):undefined;return new u.InterArgument(e.name,t)}).toArray(),e.exprArgs.map(function(e){var t=e.exprStr?new u.Expr(undefined,undefined,e.exprStr):undefined;return new u.ExprArgument(e.name,t)}).toArray())}function Z(e,t,i){var r=e.metric,a=new o.Metric(r.name),s=r.filters.map(function(e){return P(e,t)}),l=ie(r,t),u=I(e),c=o.applyMultiLabelMapToIntersection(u,l),d;if(i){s=s.concat(i.map(function(e){return k(e,i,t)}))}s=ee(s.toArray());d=new o.FilteredMeasureQuery({label:"filtered query for "+r.name,measure:a,interLabelMap:u,inter:c,aggMethodLookup:{},filter:te(e,c,s,t),mappedInter:c,labelMap:n.calcSelfLabelMap(c.qualified_level)});return{queryMeasure:d,inter:c,interLabelMap:{}}}function ee(e){return e.reduce(function(e,t){if(t instanceof a.CompositeFilter&&t.is_disjunction===false){return e.concat(ee(t.filters))}e.push(t);return e},[])}function te(e,t,i,r){var n=ae(e,t,i,r),o=oe(n);return o}function ie(e,t){return t.getMeasureInfo(e.name).inter}function re(e){var t=oe(e.children),i=a.cloneFilter(e.filter);c(!(i instanceof a.PositionFilter)||i instanceof a.PositionFilter&&d.isUndefined(t),"a PositionFilter cannot have children!");if(t)ne(i,t);return i}function ne(e,t){if(e instanceof a.MeasureQueryFilter){e.queries.forEach(function(e){e.filter=a.conjunctFilters(d.compact([e.filter,t]))})}else if(e.measureQuery){e.measureQuery.filter=a.conjunctFilters(d.compact([e.measureQuery.filter,t]))}else{throw new Error("couldn't figure out how to apply children filter!")}}function oe(e){var t=e.map(function(e){return re(e)});return t.length>1?a.conjunctFilters(t):t[0]}function ae(e,t,i,r){var n=p.partition(i,function(t){if(t.measureQuery&&o.measuresEqual(e,t.measureQuery.measure))return true;return false}),a=n[0],s=n[1],l=se(undefined,t,s,r),u=i.filter(function(e){return ue(e).qualified_level.length===0}).map(function(e){return{filter:e,children:[]}});if(a.length){a.forEach(function(e){l=[{filter:e,children:l}]})}return[].concat(l,u)}function se(e,t,i,n){i=i.map(a.cloneFilter);var o=pe(t,i.filter(function(t){return!le(t,e)})),s=ce(o,n),l=s.filter(function(e,i){var o=ue(e),a=r.getOverlappingLabels(o,t),l=[];if(a.length){l=s.slice(0,i).filter(function(e){var i=ue(e),s=r.getOverlappingLabels(i,t),l,u,c,d=0;for(;d<a.length;d++){c=a[d];l=o.qualified_level.find(r.qlevel.labelEquals(c));u=i.qualified_level.find(r.qlevel.labelEquals(c));if(!u){return false}}return a.every(function(e){if(s.indexOf(e)===-1||!n.findHierarchiesWithLevels(l.dimension,[l.level,u.level]).length){return false}return true})})}return l.length===0&&(a.length>0||o.qualified_level.length===0)}),u=l.map(function(t){return{root:e,filter:t}}),p=u.map(function(e){return se(e,ue(e.filter),i,n)});c(s.length<i.length||d.isUndefined(e),"big f up!");return u.map(function(e,t){e.children=p[t];return e})}function le(e,t){if(d.isUndefined(t))return false;return n.filtersEqual(t.filter,e)||le(e,t.root)}function ue(e){if(e instanceof a.PositionFilter)return e.inter;else if(e instanceof a.AttributeFilter)return new u.Intersection(e.attribute.qualifiedLevel);else if(e instanceof a.MeasureQueryFilter)return e.queries[0].mappedInter;else if(e instanceof a.CompositeFilter)return e.filters[0].queries[0].mappedInter;else return e.measureQuery.mappedInter}function ce(e,t){var i=e.filter(function(e){var t=ue(e);return t.qualified_level.length===1}),n=d.groupBy(i,function(e){var t=ue(e);return s.mqgLevelToQName(t.qualified_level[0])}),o=i.map(function(e){var t=ue(e);return{label:r.qlevel.getLabel(t.qualified_level[0]),hierarchy:r.qlevel.getHierarchy(t.qualified_level[0])}}),a=o.map(function(t){return e.findIndex(function(e){var i=ue(e);return i.qualified_level.length===1&&r.qlevel.getLabel(i.qualified_level[0])===t.label&&r.qlevel.getHierarchy(i.qualified_level[0])===t.hierarchy})}),l=d.reduce(i,function(e,t,i){var r=de(o[i].hierarchy,o[i].label);e[r]=e[r]||[];e[r].push(t);return e},{}),u=d.mapValues(l,function(e){var i=e.map(function(e){return ue(e).qualified_level[0]});return r.sortQualifiedLevelsByHierarchy(i,t)}),c=d.compact(d.flatten(e.map(function(e,t){var i=ue(e),o=i.qualified_level.length===1,l;if(!o){return e}else if(a.indexOf(t)>-1){l=de(r.qlevel.getHierarchy(i.qualified_level[0]),r.qlevel.getLabel(i.qualified_level[0]));return d.flatten(u[l].map(function(e){var t=s.mqgLevelToQName(e);return n[t]}))}})));return c}function de(e,t){return e+":"+t}function pe(e,t){return d.sortBy(t,function(t){var i=ue(t);return(r.getOverlappingLabels(i,e).length*100+i.qualified_level.length)*-1})}t.exports.ConfigQueryTypes=b;t.exports.QueryGenerator=w;t.exports.$combineFiltersForMeasure=te;t.exports.$createQueryFiltersForLevelField=A;t.exports.generateAbstractionMeasure=J},{"../constant/sort":268,"../cubiql":276,"../formatter":293,"../multiaxisconfig":328,"../multiaxisheading":329,"../querygen/filter":332,"../querygen/query":333,"../querygen/util":336,"../util":357,"./modelutility":321,"./queryutil":324,"./validity":326,assert:2,immutable:"immutable",lodash:70,"measure-query-gen/src/MQG":1}],324:[function(e,t,i){"use strict";var r=e("../cubiql");var n=e("../multiaxisconfig");var o=e("immutable");var a=e("assert");var s=e("lodash");var l=e("measure-query-gen/src/MQG");var u=t.exports;u.getSpreadMethodLookup=function(e,t){if(!e.metric)return;var i=e.metric,a=t.getMeasureInfo(i.name),s=a.inter,l=n.intersectionToMQGIntersection(n.getIntersectionForMetric(i,t)),c=a.update_method,d={},p=e.labelMap||new o.Map,f=[],h=true;s.qualified_level.forEach(function(e){var t=r.qlevel.getLabel(e),i=p.get(t),n=i?i.toJS()[0]:t,o=l.qualified_level.find(r.qlevel.labelEquals(n));if(!o||e.level!==o.level)f.push(t)});f.forEach(function(e){if(!c&&!a.recalc)h=false;else if(c&&c.primitive&&!c.named)d[e]=c.primitive;else if(c&&c.named)d[e]=u.getNamedSpreadMethodForLabel(c.named,e,t)});if(h)return d;else return};u.getNamedSpreadMethodForLabel=function(e,t,i){var r=i.getSpreadDefinition(e),n;a(r,"Could not find spread by the name "+e);n=r.get("spread").get("composite");return n.find(function(e){return e.get("label")===t||e.get("dimension")===t})};u.generateAggMethodLookupForMetric=function(e,t,i,r){var n=r.getMeasureInfo(e.name),o=n.inter,a=n.agg_method,s=!!n.recalc;return u.generateAggMethodLookupForIntersection(o,a,s,t,i,r)};u.generateAggMethodLookupForIntersection=function(e,t,i,n,a,s){var l=[],c={},d;if(i)return c;d=u.invertLabelMap(n);n=o.Map.isMap(n)?n.toJS():{};e.qualified_level.forEach(function(e){var t=r.qlevel.getLabel(e),i=n[t];if(!i||!i.length)l.push(t);else l=l.concat(i)});l.forEach(function(e){var i=a[e],r,n=d.get(e)||e;if(!i||!i.methodName||i.methodName==="DEFAULT")r=t;else{r=u.generateAggMethodByName(i.methodName,s)}if(r){if(!r.named){c[e]=r}else{var o=u.getNamedMethodForToLabel(r.named,n,s);if(o){o=o.toJS();o.label=e;c[e]=o}}}});return c};u.getNamedMethodForToLabel=function(e,t,i){var r=i.getAggregation(e),n;a(r,"Could not find aggregation by the name "+e);n=r.get("method").get("composite");return n.find(function(e){return e.get("label")===t})};u.generateAggMethodByName=function(e,t){var i=t.getAggregation(e);if(i){return{named:e}}else{a(t.getPrimitiveAggMethods().indexOf(e),"Unknown primitive aggregation method '"+e+"'");return{primitive:e}}};u.generateAggMethodLookupForMeasure=function(e,t,i){if(e.metric)return u.generateAggMethodLookupForMetric(e.metric,e.labelMap,t,i);else return{}};u.generateAggMethodLookupForMeasureAndIntersection=function(e,t,i,r,n){if(e.metric){var o=n.getMeasureInfo(e.metric.name),a=o.agg_method;return u.generateAggMethodLookupForIntersection(t,a,!!o.recalc,i,{},n)}else return{}};u.getRollupConfigsByMeasureLabel=function(e,t,i,o){var l={},u=o.calcInnerFields(t),c=u.filter(function(e){return e instanceof n.LevelField}),d=s.groupBy(c,function(e){return e.level.labelName});e.qualified_level.map(function(e){var n=r.qlevel.getLabel(e),o=d[n],s=o&&o[0],u=s&&t.indexOf(s),c=s&&u>-1&&i[u];a(!o||o.length===1,"Too many inner fields for the label: "+n);if(c)l[n]=c});return l};u.isDimensionSplit=function(e){if(!e)return false;return e.some(function(e){return e.size>1})};u.invertLabelMap=function(e){if(!e)return o.Map();if(!o.Map.isMap(e))e=o.fromJS(e);var t=e.reduce(function(e,t,i){return t.reduce(function(e,t){return e.set(t,i)},e)},o.Map());return t};u.invertIntersectionLabelling=function(e,t){a(!u.isDimensionSplit(t),"Cannot invert the labelling of a split dimension.");if(!t)return e;var i=u.invertLabelMap(t),r=e.qualified_level.map(function(e){var t=i.has(e.label)?i.get(e.label):e.label;return new l.QualifiedLevel(e.dimension,e.level,e.hierarchy,t)});return new l.Intersection(r)}},{"../cubiql":276,"../multiaxisconfig":328,assert:2,immutable:"immutable",lodash:70,"measure-query-gen/src/MQG":1}],325:[function(e,t,i){"use strict";var r=e("assert");var n=e("measure-query-gen/src/MQG");var o=e("../multiaxisconfig");var a=e("../cubiql");var s=e("../util");var l=e("../querygen/query");var u=e("../querygen/util");var c=e("./querygen.js");var d=e("lodash");var p=t.exports;p.createRequestForEdits=function(e,t,i,o){var a=[],s=[];d.forEach(d.groupBy(e,function(e){return e.editConfig.coreEditMeasure.toString()+e.edit.isDelete+e.edit.spreadMethod}),function(e){var t=e[0],o=t.editConfig,l=t.editConfig.coreEditMeasure,u=m(i.getMeasureInfo(l.metric.name),i),c=t.edit.isDelete,d=p.computeInputSignatureForEdit(l,o,i),f=p.computeDistributionFromEditMeasure(l,c,i),h=t.edit.spreadMethod?{primitive:t.edit.spreadMethod}:undefined,g=[],v=p.computeKeyPositionKeys(l,o,i),y=v.map(function(){return[]}),b;r(l.metric,"Currently only implementing edits for metrics");e.forEach(function(e){var t=0,i=e.positionInfo.position,r=e.edit;for(;t<v.length;t++){y[t].push(i[v[t]])}g.push(r.data)});b=d.intersection.qualified_level.map(function(e,t){var r=i.getAttributeType("id",e.dimension,e.level);return p.mkColumn(new n.Type(r),y[t],i)});b.push(p.mkColumn(u,g,i));if(o.editOptions.pctParentConfig){s=s.concat(p.generatePctParentLockExprs(o,b,i))}var w=new n.UpdateExpr(c?"REMOVE":"SPREAD",l.metric.name,f?[new n.UpdateTransform(h,f)]:[]);a.push(new n.UpdateRequest(w,p.createSource(o,b,c,i)))});s=s.concat(p.computeLocks(e,t||[],i,o));return new n.Request(undefined,a,undefined,undefined,s)};p.generatePctParentLockExprs=function(e,t,i){var r=e.coreEditMeasure,s=e.editOptions.pctParentConfig,l=p.computeInputSignatureForEdit(r,e,i),u=l.intersection,c=new n.Intersection(u.qualified_level.map(function(e){if(e.dimension==s.parentLevel.dimensionName)return a.relabelQL(o.levelToQualifiedLevel(s.parentLevel),a.qlevel.getLabel(e));else return e}).filter(function(e){return e.level!=="ALL"})),d=g(l.type.type,c,i).diceBy(new n.LiteralExpr("GENERAL",l,t));return new n.Lock(r.metric.name,d,true)};p.createSource=function(e,t,i,r){if(i)return p.createDeleteSource(e,t,r);else return p.createEditSource(e,t,r)};p.createEditSource=function(e,t,i){var r=e.coreEditMeasure,s=p.computeInputSignatureForEdit(r,e,i),d=s.intersection,f=r.metric.name,h=i.getMeasureInfo(f),g=new n.LiteralExpr("GENERAL",s,t),m,v,y={};if(e.editOptions.pctParentConfig){v=e.editOptions.pctParentConfig;m=new n.Intersection(d.qualified_level.map(function(e){if(e.dimension==v.parentLevel.dimensionName)return a.relabelQL(o.levelToQualifiedLevel(v.parentLevel),a.qlevel.getLabel(e));else return e}).filter(function(e){return e.level!=="ALL"}));h.inter.qualified_level.forEach(function(e){y[e.label]=l.getAggMethod(undefined,i.getMeasureInfo(f))});return l.explicitAggExpr(new n.MetricExpr(f),m,y,i).prev().widen(d).multiply(g)}else if(e.dataConfig.customEdit){var b=c.generateAbstractionMeasure(e.dataConfig.customEdit.inputAbstraction);var w=o.signatureToMQGSignature(e.dataConfig.customEdit.inputValueSignature);w.intersection.qualified_level=d.qualified_level.concat(w.intersection.qualified_level);g=new n.LiteralExpr("GENERAL",w,t);var C=new l.Application(w,b,[new n.InterArgument("inter",s.intersection)],[new n.ExprArgument("input",g)]);var E=l.createApplicationExpr(C,i);u.cleanMQGExpr(E);return E}else{return g}};p.createDeleteSource=function(e,t,i){var r=e.coreEditMeasure,o=r.metric.name,a=m(i.getMeasureInfo(r.metric.name)),s=p.computeInputSignatureForEdit(r,e,i),u=p.computeInputSignatureForEdit(r,e,i),c=i.getMeasureInfo(o),d={},f=t.slice(0,t.length-1),h,g;u.type=undefined;h=new n.LiteralExpr("GENERAL",u,f);c.inter.qualified_level.forEach(function(e){d[e.label]=l.getAggMethod(undefined,i.getMeasureInfo(o))});g=l.createMeasureExpr(new l.Metric(r.metric.name),s.intersection,{},d,i);if(u.intersection.qualified_level.length)g=g.diceBy(h);g=g.prev();if(c.type&&c.type.kind==="STRING")g=g.drop();return g};p.computeInputSignatureForEdit=function(e,t,i){var r=i.getMeasureInfo(e.metric.name),u=m(r),c=o.intersectionToMQGIntersection(o.getIntersectionForMeasure(e,i)),d=e.labelMap&&e.labelMap.toJS()||{},p=l.reverseMultiLabelMapOnIntersection(d,c);if(t.editOptions.pctParentConfig)p=new n.Intersection(p.qualified_level.filter(s.not(a.qlevel.labelEquals(t.editOptions.pctParentConfig.parentLevel.labelName))));return new n.BaseSignature(p,new n.ValueType("SINGLETON",u))};p.computeKeyPositionKeys=function(e,t,i){var r=o.intersectionToMQGIntersection(o.getIntersectionForMeasure(e,i));if(t.editOptions.pctParentConfig)r=new n.Intersection(r.qualified_level.filter(s.not(a.qlevel.labelEquals(t.editOptions.pctParentConfig.parentLevel.labelName))));return r.qualified_level.map(o.mqgLevelToQName)};p.computeDistributionFromEditMeasure=function(e,t,i){var r=e.metric.name,n=i.getMeasureInfo(e.metric.name),s=o.intersectionToMQGIntersection(o.getIntersectionForMeasure(e,i)),l=i.getMeasureInfo(r).inter;if(!a.intersectionEqual(s,l)&&!(t&&n.type.kind==="STRING")){return l.qualified_level.map(function(e){var t={dimension:e.dimension,level:e.level},i=s.qualified_level.find(a.qlevel.labelEquals(a.qlevel.getLabel(e))),r=i?i.hierarchy:"hierarchy"in e&&e.hierarchy!==undefined?e.hierarchy:undefined;t.hierarchy=r;return t})}};p.mkColumn=function(e,t,i){var r=v(e,i);return new n.Column(r,t.map(a.getParser(r)))};p.computeLocks=function(e,t,i,r){var o={},a={};e.forEach(function(e){var t=e.editConfig.coreEditMeasure,i=t.metric.name;if(!a[i])a[i]=true});d.forEach(a,function(e,t){var i=r&&r[t];if(i){o[t]=i.locks||[]}});t.forEach(function(e){var t=e.editConfig.coreEditMeasure.metric.name,i=e.editConfig.positionFn,r=o[t]||[],n=e.positions.map(function(e){return i([e.members])}),a=d.flatten(n.map(function(t){return e.editConfig.metricInters.map(function(e,i){return{qualifiedLevels:e.inter.qualified_level,members:t[i].members,historical:false}})}));o[t]=r.concat(a)});var s=d.chain(o).map(function(e,t){var r=i.getMeasureInfo(t),o=r.inter;return e.map(function(e){var a=!e.historical,s=m(r,i),l=e.historical?new n.MetricExpr(e.name):f(i,e.qualifiedLevels,e.members,s),u=e.historical?new n.Intersection(o.qualified_level):new n.Intersection(e.qualifiedLevels),c=g(s,u,i).diceBy(l);return new n.Lock(t,c,a)})}).value();return Array.prototype.concat.apply([],s)};p.createRequestForLevelCreation=function(e,t,i){var r=new n.QualifiedLevel(e.dimensionName,e.levelName),a=new n.ParamExpr("id-"+t,new n.BaseSignature(new n.Intersection(["String.String.String"]))),s=new n.ParamExpr("label-"+t,new n.BaseSignature(new n.Intersection([r]),new n.ValueType("SINGLETON",new n.Type("string")))),l=[new n.UpdateRequest(new n.UpdateExpr("SPREAD",new n.Target(r),[]),a),new n.UpdateRequest(new n.UpdateExpr("SPREAD",new n.Target(o.levelAttributeToMQGAttribute(e,"label")),[]),s)],u=[new n.RelationBinding(a,new n.LiteralExpr("GENERAL",new n.BaseSignature(new n.Intersection(["String.String.String"])),[new n.Column("STRING",t)])),new n.RelationBinding(s,new n.LiteralExpr("GENERAL",new n.BaseSignature(new n.Intersection([r]),new n.ValueType("SINGLETON",new n.Type("string"))),[new n.Column("STRING",t),new n.Column("STRING",i)]))];return new n.Request(undefined,l,u)};function f(e,t,i,r){var o=h(r,e),a,s,l,u;if(d.isArray(i[0])){i.push(d.map(d.range(0,i[0].length),function(){return o}))}else{i.push(o)}s=t.map(function(t){return new n.Type(e.getAttributeType("id",t.dimension,t.level))}).concat([r]);l=s.map(function(t,r){a=i[r];return p.mkColumn(t,d.isArray(a)?a:[a],e)});u=new n.BaseSignature(new n.Intersection(t),new n.ValueType("SINGLETON",r));return new n.LiteralExpr("GENERAL",u,l)}function h(e,t){var i=v(e,t);return a.getParser(i)(a.getNeutralElement(i))}function g(e,t,i){var o=h(e,i),a=v(e,i);r(!d.isUndefined(o),"Couldn't get a value of type '"+JSON.stringify(e)+"'");return new n.ConstantExpr(o,a).widenBy(t)}function m(e){return e.type&&new n.Type(e.type.kind,e.type.named)}function v(e,t){if(!e.named)return e.kind;else return t.getBackingType(e.named)}},{"../cubiql":276,"../multiaxisconfig":328,"../querygen/query":333,"../querygen/util":336,"../util":357,"./querygen.js":323,assert:2,lodash:70,"measure-query-gen/src/MQG":1}],326:[function(e,t,i){"use strict";var r=e("../querygen/util");var n=e("./queryutil");var o=e("lodash");var a=e("../multiaxisconfig");var s=e("../cubiql");var l=e("measure-query-gen/src/MQG");var u=t.exports;u.checkIntersectionQueryValidity=function(e,t,i,r){var n=[];if(!n.length)n=n.concat(u.checkForIllegalFields(e,t));if(!n.length)n=n.concat(u.checkForIllegalSplitting(e,t,r));if(!n.length)n=n.concat(u.checkForIllegalAggregation(e,t,i,r));return n};u.checkForIllegalFields=function(e,t){var i=t.filter(function(e){return e instanceof a.MeasureField}),r=[];if(i.length>1)r.push("Cannot display values from two metrics in one cell ("+i.map(function(e){return e.fieldLabel}).join(", ")+")");return r};u.checkForIllegalSplitting=function(e,t,i){var o=e.measure,s=[],l=i.getModel();if(o.metric){var u=l.getMeasureInfo(o.metric.name),c=a.intersectionToMQGIntersection(a.getIntersectionForMeasure(o,l)),d=n.isDimensionSplit(o.labelMap);if(d&&u.recalc){s.push("Metric "+o.metric.name+" cannot be queried for this intersection, "+r.stringifyIntersection(c)+", because it requires dimension splitting and recalc metrics cannot be queried with split dimensions.")}}return s};u.checkForIllegalAggregation=function(e,t,i,l){var u=e.measure,f=[];if(u.metric){var h=u.metric,g=l.getModel(),m=a.intersectionToMQGIntersection(a.getIntersectionForMeasure(u,g)),v=g.getMeasureInfo(h.name),y=p(v.inter,u.labelMap),b,w,C;if(v.recalc)return f;if(s.intersectionEqual(y,m,true,true))return f;if(d(m,y,g).length)f.push("Query is at "+r.stringifyIntersection(m)+" which is below the intersection of "+h.name+": "+r.stringifyIntersection(y));if(!c(m,y,g)){f.push("Query is at "+r.stringifyIntersection(m)+" which is not reachable from the intersection of "+h.name+": "+r.stringifyIntersection(y))}C=d(y,m,g);b=n.getRollupConfigsByMeasureLabel(m,t,i,l);w=n.generateAggMethodLookupForMeasure(u,b,g);C.forEach(function(e){var t=s.qlevel.getLabel(e);if(o.isUndefined(w[t]))f.push("Unable to aggregate "+h.name+" along the "+t+" labelled dimension because no aggregation method could be found.")})}return f};function c(e,t,i){var r=[];e.qualified_level.forEach(function(e){var n=s.qlevel.getLabel(e),o=s.qlevel.getDimension(e),a=t.qualified_level.find(s.qlevel.labelEquals(n)),l=!a,u=s.qLevelEqual(e,a),c=a&&!!i.findHighestLevel(o,[e,a]);if(l||u||c)r.push(e)});return r.length===e.qualified_level.length}function d(e,t,i){var r=[];e.qualified_level.forEach(function(e){var n=s.qlevel.getLabel(e),o=s.qlevel.getDimension(e),a=t.qualified_level.find(s.qlevel.labelEquals(n)),l=a&&i.findHighestLevel(o,[e,a]);if(!a||!s.qLevelEqual(e,a)&&l&&s.qLevelEqual(l,a))r.push(e)});return r}function p(e,t){if(!t)return e;var i=[];e.qualified_level.forEach(function(e){var r=s.qlevel.getLabel(e),n=t.get(r);if(!n||!n.size){i.push(e)}else{n.forEach(function(t){i.push(s.relabelQL(e,t))})}});return new l.Intersection(i)}function f(e,t){return!$metricBaseAboveQueryInter(e,t)&&(h(e,t)||$metricHasDefaultAggMethod(e,t)||$isRecalcMetric(e,t))}function h(e,t){return s.intersectionEqual(t.getMeasureInfo(e.measure.name).inter,e.inter,true,true)}},{"../cubiql":276,"../multiaxisconfig":328,"../querygen/util":336,"./queryutil":324,lodash:70,"measure-query-gen/src/MQG":1}],327:[function(e,t,i){"use strict";t.exports=r;function r(e){this.$metricInterStorage=new Map;this.$keyManager=e;this.$headingStorage=new Map;this.$dataCaches=new Map}r.prototype.getKeyManager=function(){return this.$keyManager};r.prototype.$getOrCreateHeadingStorage=function(e,t){var i=this.getKeyManager().calcViewTaskKey(e,t);if(!this.$headingStorage.has(i))this.$headingStorage.set(i,{});return this.$headingStorage.get(i)};r.prototype.getHeadingData=function(e,t){var i=this.$getOrCreateHeadingStorage(e,t);return i&&i.headingData};r.prototype.setHeadingData=function(e,t,i){var r=this.$getOrCreateHeadingStorage(e,t);r.headingData=i;r.updatedTime=performance.now()};r.prototype.$getOrCreateMetricReferenceStorage=function(e,t){if(!this.$metricInterStorage.has(e))this.$metricInterStorage.set(e,{metricInter:t,associatedViewTasks:new Map});return this.$metricInterStorage.get(e)};r.prototype.associateMetricInter=function(e,t,i){var r=this.getKeyManager(),n=r.calcMetricInterKey(i),o=r.calcViewTaskKey(e,t),a=this.$getOrCreateMetricReferenceStorage(n,i);if(a.associatedViewTasks.has(o))return false;else{a.associatedViewTasks.set(o,true);return true}};r.prototype.getDereferencedMetricInters=function(){var e=[];this.$metricInterStorage.forEach(function(t){if(t.associatedViewTasks.size===0)e.push(t.metricInter)});return e};r.prototype.dissociateAllMetricInters=function(e,t){var i=this.getKeyManager().calcViewTaskKey(e,t);this.$metricInterStorage.forEach(function(e){e.associatedViewTasks.delete(i)})};r.prototype.dissociateMetricInter=function(e,t,i){var r=this.getKeyManager(),n=r.calcMetricInterKey(i),o=r.calcViewTaskKey(e,t),a=this.$getOrCreateMetricReferenceStorage(n);if(a.associatedViewTasks.has(o)){a.associatedViewTasks.delete(o);return true}else{return false}};r.prototype.$getOrCreateDataCache=function(e,t){var i=this.getKeyManager().calcViewTaskKey(e,t);if(!this.$dataCaches.has(i))this.$dataCaches.set(i,new n);return this.$dataCaches.get(i)};r.prototype.getDataCache=function(e,t){return this.$getOrCreateDataCache(e,t)};r.prototype.clearDataCache=function(e,t){var i=this.getKeyManager().calcViewTaskKey(e,t);if(this.$dataCaches.has(i))this.$dataCaches.delete(i)};function n(){this.$queryPosCache=new Map}n.prototype.$getOrCreatePosCache=function(e){if(!this.$queryPosCache.has(e))this.$queryPosCache.set(e,new Map);return this.$queryPosCache.get(e)};n.prototype.cacheValue=function(e,t,i,r,n){var a=this.$getOrCreatePosCache(e);a.set(o(i,n),{cacheTime:performance.now(),value:r})};n.prototype.getQueryPositionValue=function(e,t,i){var r=this.$getOrCreatePosCache(e);return r.get(o(t.position,i))};function o(e,t){var i=0,r=t.usedKeyMaps,n="";for(;i<r.length;i++){n+=e[r[i].qName]+"|"}return n}},{}],328:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("./cubiql");var a=e("./querygen/query");var s=e("measure-query-gen/src/MQG");var l=e("assert");var u=t.exports;function c(e){this.message=e}c.prototype=Object.create(Error.prototype);c.prototype.constructor=c;u.ValidationError=c;var d=Object.freeze({MEASURE:1,LEVEL:2,DIMENSION:3,MEASURE_GROUP:4,ATTRIBUTE:5,LEVEL_MAP:6});function p(e,t){return new r.List((e||[]).map(t))}var f=r.Record({labelName:undefined,dimensionName:undefined,hierarchyName:undefined,levelName:undefined});function h(e){if(!e)return;if(e instanceof f)return e;return new f({labelName:e.labelName,dimensionName:e.dimensionName,hierarchyName:e.hierarchyName,levelName:e.levelName})}function g(e,t){var i=o.qlevel.getDimension(e),r=o.qlevel.getLevel(e);return new f({labelName:o.qlevel.getLabel(e),dimensionName:i,hierarchyName:o.qlevel.getHierarchy(e)||t.getDefaultHierarchyName(i,r),levelName:r})}function m(e){return new s.QualifiedLevel(e.dimensionName,e.levelName,e.hierarchyName,e.labelName)}function v(e,t){return[e.dimensionName,e.levelName,t].join(".")}function y(e){var t=e.dimensionName+":"+e.labelName+":"+e.hierarchyName+":"+e.levelName;return t}function b(e){var t=o.qlevel.getDimension(e)+":"+o.qlevel.getLabel(e),i=o.qlevel.getHierarchy(e);if(i)t+=":"+i;return t+=":"+o.qlevel.getLevel(e)}function w(e){var t=e.split(":");if(t.length===3){return new s.QualifiedLevel(t[0],t[2],undefined,t[1])}else if(t.length===4){return new s.QualifiedLevel(t[0],t[3],t[2],t[1])}else{throw new Error("unable to parse qName: "+e)}}function C(e){return e.levelName==="ALL"}var E=r.Record({metric:undefined,attribute:undefined,application:undefined,operator:undefined,labelMap:undefined});function S(e,t){if(e.metric)return T(e.metric,t);else if(e.attribute)return x(e.attribute,t);else if(e.operator)return _(e.operator,t);else{l(false,"no implementation for this measure type")}}function T(e,t){var i=t.getMeasureInfo(e.name),r;if(i.type)r=a.Type[i.type.kind];else r=a.Type.NONE;return r}function x(e,t){return t.getAttributeType(e.name,e.level.dimensionName,e.level.levelName)}function _(e,t){return S(e.measures.get(0),t)}function M(e){if(!e)return;return new E({metric:R(e.metric),attribute:L(e.attribute),operator:$(e.operator),application:V(e.application),labelMap:e.labelMap})}function A(e){if(e.metric)return["metric","aggConfig"]}var I=r.Record({methodName:undefined,labelMethodMap:undefined});function O(e){if(!e)return;return new I({methodName:e.methodName,labelMethodMap:n.isUndefined(e.labelMethodMap)?undefined:new r.Map(e.labelMethodMap)})}function D(e,t){if(e.labelMethodMap.has(t))return e.labelMethodMap.get(t);else return e.methodName}var N=r.Record({name:undefined,intersection:undefined,intersectionVar:undefined,aggConfig:undefined,filters:r.List()});function R(e){if(!e)return;return new N({name:e.name,intersection:J(e.intersection),intersectionVar:e.intersectionVar,aggConfig:O(e.aggConfig),filters:p(e.filters,ke)})}var P=r.Record({name:undefined,filters:r.List(),level:undefined,intersection:undefined});function L(e){if(!e)return;return new P({name:e.name,level:h(e.level),filters:p(e.filters,ke),intersection:J(e.intersection)})}var k=r.Record({name:undefined,measures:r.List()});function $(e){if(!e)return;return new k({name:e.name,measures:p(e.measures,M)})}var F=r.Record({interArgs:r.List(),exprArgs:r.List(),abstraction:undefined,signature:undefined});function V(e){if(!e)return;l(e.interArgs&&e.interArgs.length===1,"We currently only support Applications with a single intersection argument.");l(e.signature,"Application must have a base signature.");return new F({interArgs:p(e.interArgs,K),exprArgs:p(e.exprArgs,X),abstraction:W(e.abstraction),signature:H(e.signature)})}var q=r.Record({intersection:undefined,type:undefined});function H(e){if(!e)return;return new q({intersection:J(e.intersection),type:B(e.type)})}var U=r.Record({kind:undefined,type:undefined});function B(e){if(!e)return;return new U({kind:e.kind,type:j(e.type)})}var z=r.Record({kind:undefined,named:undefined});function j(e){if(!e)return;return new z({kind:e.kind,named:e.named})}var G=r.Record({interArgs:r.List(),exprArgs:r.List(),bodyStr:undefined});function W(e){if(!e)return;return new G({interArgs:p(e.interArgs,K),exprArgs:p(e.exprArgs,X),bodyStr:e.bodyStr})}var Q=r.Record({name:undefined,intersection:undefined});function K(e){if(!e)return;return new Q({name:e.name,intersection:J(e.intersection)})}var Y=r.Record({name:undefined,exprStr:undefined});function X(e){if(!e)return;return new Y({name:e.name,exprStr:e.exprStr})}function J(e){if(!e)return;return new r.List(e.map(h))}function Z(e){return new s.Intersection(e.map(function(e){return m(e)}).toArray())}function ee(e,t){return new r.List(e.qualified_level.map(function(e){return g(e,t)}))}function te(e,t){if(e.metric)return ne(e.metric,t);else if(e.attribute)return re(e.attribute,t);else if(e.operator)return ie(e.operator,t);else if(e.application)return e.application.interArgs.get(0).intersection;else l(false,"Don't know how to get intersection for measure: "+e.toString())}function ie(e,t){return te(e.measures.get(0),t)}function re(e,t){return e.intersection||J([e.level])}function ne(e,t){var i=e.intersection||ee(t.getMeasureInfo(e.name).inter,t);return i}var oe=r.Record({name:undefined,measure:undefined,filters:r.List(),format:undefined,customEdit:undefined});function ae(e){if(!e)return;return new oe({name:e.name,measure:M(e.measure),filters:p(e.filters,ke),format:e.format,customEdit:pe(e.customEdit)})}var se=r.Record({name:undefined,level:undefined});function le(e){if(!e)return;return new se({name:e.name,level:h(e.level)})}var ue=r.Record({metricName:undefined,attribute:undefined});function ce(e){if(!e)return;return new ue({metricName:e.metricName,attribute:le(e.attribute)})}var de=r.Record({name:undefined,editTarget:undefined,inputAbstraction:undefined,inputValueSignature:undefined});function pe(e){if(!e)return;return new de({name:e.name,editTarget:ce(e.editTarget),inputAbstraction:W(e.inputAbstraction),inputValueSignature:H(e.inputValueSignature)})}var fe=r.Record({id:undefined,fieldLabel:undefined,data:r.List(),dataPerFieldSet:r.Map(),type:d.MEASURE});function he(e){if(!e)return;return new fe({id:e.id,fieldLabel:e.fieldLabel,data:p(e.data,ae),dataPerFieldSet:ge(e.dataPerFieldSet)})}function ge(e){if(!e)return new r.Map;l(e instanceof r.Map,"Can't currently automatically convert dataPerFieldSet to Immutable, so it must be done by hand");return e}function me(e,t){var i=e.data.findIndex(function(e){return e.name===t});if(!n.isUndefined(i))return["data",i]}var ve=r.Record({sortType:undefined,
measure:undefined});function ye(e){if(!e)return;return new ve({sortType:e.sortType,measure:M(e.measure)})}var be=r.Record({sourceField:undefined,byMeasure:undefined,bySelection:undefined});function we(e){if(!e)return;return new be({sourceField:Ze(e.sourceField,[qe,Ye],"sourceField for a SliceConfig must be either a LevelField or MeasureGroupField"),byMeasure:M(e.byMeasure),bySelection:e.bySelection})}var Ce=r.Record({literal:undefined,metric:undefined});function Ee(e){if(!e)return;return new Ce({literal:e.literal,metric:R(e.metric)})}var Se=r.Record({operator:undefined,comparator:undefined});function Te(e){if(!e)return;return new Se({operator:e.operator,comparator:Ee(e.comparator)})}var xe=r.Record({measure:undefined,comparisons:r.List()});var _e=u.stringifyFilter=function(e){return"Filter { measure: "+Oe(e.measure)+", comparisons: "+Me(e.comparisons)+"}"};var Me=u.stringifyComparisons=function(e){return"["+e.map(Ae).join("\n")+"]"};var Ae=u.stringifyComparison=function(e){return"Comparison { operator: "+e.operator+", comparator: "+Ie(e.comparator)+"}"};var Ie=u.stringifyComparator=function(e){return"Comparator { "+(!n.isUndefined(e.literal)?"literal: "+e.literal:"")+(!n.isUndefined(e.metric)?"metric: "+De(e.metric):"")+"}"};var Oe=u.stringifyMeasure=function(e){return"Measure { "+(e.metric?"metric: "+De(e.metric)+",":"")+(e.attribute?"attribute: "+Ne(e.attribute)+",":"")+(e.operator?"operator: "+e.operator:"")+"}"};var De=u.stringifyMetric=function(e){return"Metric { name: "+e.name+","+"intersection: "+Pe(e.intersection)+","+(e.aggConfig?+"aggConfig: "+JSON.stringify(e.aggConfig.toJS())+",":"")+(e.filters?+"filters: "+Le(e.filters):"")+"}"};var Ne=u.stringifyAttribute=function(e){return"Attribute { name: "+e.name+","+"level: "+Re(e.level)+","+(e.filters?+"filters: "+Le(e.filters):"")+"}"};var Re=u.stringifyLevel=function(e){return u.levelToQName(e)};var Pe=u.stringifyIntersection=function(e){return"["+e.map(Re).join(", ")+"]"};var Le=u.stringifyFilters=function(e){return"["+e.map(_e).join(", ")+"]"};function ke(e){if(!e)return;return new xe({measure:M(e.measure),comparisons:p(e.comparisons,Te)})}var $e=r.Record({methodName:undefined,filters:r.List()});function Fe(e){if(!e)return;return new $e({methodName:e.methodName,filters:p(e.filters,ke)})}var Ve=Object.freeze({OUTLINE:"OUTLINE",NONE:"NONE"});var qe=r.Record({id:undefined,fieldLabel:undefined,level:undefined,data:r.List(),sortConfigs:r.List(),filters:r.List(),filterByAllSlicesInDimension:false,rollupConfigs:r.List(),displayMode:Ve.OUTLINE,type:d.LEVEL});function He(e){return e instanceof qe}function Ue(e){if(!e)return;return new qe({id:e.id,fieldLabel:e.fieldLabel,level:h(e.level),data:p(e.data,ae),sortConfigs:p(e.sortConfigs,ye),filters:p(e.filters,ke),filterByAllSlicesInDimension:e.filterByAllSlicesInDimension||false,rollupConfigs:p(e.rollupConfigs,Fe),displayMode:e.displayMode||Ve.OUTLINE})}function Be(e){return C(e.level)}function ze(e,t,i,r){r=!!r;var n=e.setIn(["level",t],i);if(r){n=n.updateIn(["sortConfigs"],function(e){return e.map(function(e){if(e.measure.attribute)return e.setIn(["measure","attribute","level",t],i);else return e})}).updateIn(["data"],function(e){return e.map(function(e){if(e.measure.attribute)return e.setIn(["measure","attribute","level",t],i);else return e})})}return n}function je(e,t){return ze(e,"labelName",t,true)}function Ge(e,t,i){return ze(e,"hierarchyName",t,true)}function We(e,t){return t.set("filters",t.filters.push(e))}var Qe=r.Record({id:undefined,fieldLabel:undefined,dimension:undefined,dimensionLabel:undefined,hierarchy:undefined,fields:r.List(),type:d.DIMENSION});function Ke(e){if(!e)return;return new Qe({id:e.id,fieldLabel:e.label,dimension:e.dimension,dimensionLabel:e.dimensionLabel,hierarchy:e.hierarchy,fields:(e.fields||[]).map(function(e){return Ze(e,[qe],"Only LevelFields are allowed in the fields on a DimensionField")})})}var Ye=r.Record({id:undefined,fieldLabel:undefined,fields:r.List(),type:d.MEASURE_GROUP});function Xe(e){if(!e)return;return new Ye({id:e.id,fieldLabel:e.fieldLabel,fields:new r.List((e.fields||[]).map(function(e){return Ze(e,[fe],"Only MeasureFields are allowed in the fields on a MeasureGroupField")}))})}function Je(e,t,i){var r,n;if(t.get("id")===i.get("id"))return 0;r=m(t.level);n=m(i.level);return e.qLevelBelow(r,n)?-1:1}function Ze(e,t,i){var r=false,n=0;for(;n<t.length;n++){if(e instanceof t[n]){r=true;break}}l(r,i);return e}var et=r.Record({id:undefined,axis:r.Map({X:r.List(),Y:r.List(),Z:r.List()}),measureGroups:r.Map(),isNonEmpty:false,sliceConfigs:r.List(),useDefaultHeaderConfig:true,queryLevelFilterFlag:false,headerConfig:r.Map()});function tt(e){var t=[];e.axis.forEach(function(e,i){if(e.size)t.push(i)});return t}var it=r.Record({fieldId:undefined,terms:r.List()});var rt=r.Record({fieldId:undefined,terms:r.List()});var nt=r.Record({fieldId:undefined});var ot=r.Record({fieldId:undefined,fieldTerms:r.List()});var at=r.Record({fieldId:undefined});function st(e){return e.axis.keySeq().toJS()}function lt(e,t,i){return ut(e,function(e){return e&&e.get("id")===t},i).first()}function ut(e,t,i){return e.get("axis").reduce(function(e,r,n){if(i&&i!==n)return e;r.forEach(function(i){if(i.has("fields")){e=e.concat(i.get("fields").filter(t))}if(t(i)){e=e.push(i)}});return e},r.List())}u.addMeasureToGroup=function(e,t,i,r){var n=e.measureGroups.get(t.id);l(n,"Couldn't find measure group for "+t.id+" in config");var o=n.fields,a=o.indexOf(i),s,c;if(a>=0)o=o.delete(a);c=o.indexOf(r);if(c>=0){n=n.set("fields",o.splice(c,0,i))}else{n=n.set("fields",o.push(i))}e=e.setIn(["measureGroups",n.id],n);return u.refreshMeasureGroupFieldOnAxis(e,n)};u.removeMeasureFieldFromGroup=function(e,t,i){var r=e.measureGroups.get(t),n;l(r,"Couldn't find a measure group by the name "+t+" on this configuration");n=r.fields.indexOf(i);l(n>-1,"Couldn't find field '"+i.id+"' in the measure group '"+t+"'");r=r.set("fields",r.fields.delete(n));e=e.update("measureGroups",function(e){return e.set(t,r)});return u.refreshMeasureGroupFieldOnAxis(e,r)};u.refreshAllMeasureGroupFieldsOnAxes=function(e){e.measureGroups.forEach(function(t){e=u.refreshMeasureGroupFieldOnAxis(e,t)});return e};u.refreshMeasureGroupFieldOnAxis=function(e,t){var i=lt(e,t.id);if(i){i=i.set("fields",t.fields);e=u.replaceField(e,i);e=u.regenerateHeaderConfig(e)}return e};u.removeField=function(e,t){var i=u.findPathToField(e,t);if(i&&i.length){e=e.deleteIn(i);e=u.regenerateHeaderConfig(e)}return e};u.replaceField=function(e,t,i){i=i||t;var r=u.findPathToField(e,i);if(r.length){e=e.setIn(r,t);e=u.regenerateHeaderConfig(e)}return e};u.findPathToField=function(e,t,i){var r=[];e.get("axis").some(function(e,n){if(i&&n!==i)return false;return e.some(function(e,i){var o=t.id===e.id;if(e.has("fields")&&!o){o=e.get("fields").some(function(e,o){if(e.id===t.id){r=["axis"].concat(n,i,"fields",o);return true}})}else{if(o){r=["axis"].concat(n,i)}}return o})});return r};u.findPathToMeasureFieldInGroup=function(e,t){var i=[],r=e.measureGroups.size,n=0;e.measureGroups.forEach(function(e,r){if(i.length)return;var n=e.fields.indexOf(t);if(n>-1){i=["measureGroups",r,"fields",n]}});return i};u.regenerateHeaderConfig=function(e){if(e.useDefaultHeaderConfig)return u.generateDefaultHeaderConfig(e);else return e};u.generateDefaultHeaderConfig=function(e){e.axis.entrySeq().forEach(function(t){var i=t[0],n=t[1],o=[],a=[],s;n.forEach(function(e){if(e instanceof u.MeasureField){o.push(new u.FieldTerm({fieldId:e.id}))}else if(e instanceof u.LevelField){a.push(new u.FieldTerm({fieldId:e.id}))}else if(e instanceof u.DimensionField){if(e.fields.size)a.push(new u.NestTerm({fieldId:e.id,fieldTerms:e.fields.map(function(e){return new u.FieldTerm({fieldId:e.id})})}))}else if(e instanceof u.MeasureGroupField){if(e.fields.size)a.push(new u.ConcatTerm({fieldId:e.id,terms:e.fields.map(function(e){return new u.FieldTerm({fieldId:e.id})})}));else a.push(new u.PlaceholderTerm({fieldId:e.id}))}});if(o.length){s=new u.ConcatTerm({terms:new r.List(o)});if(a.length)s=s.set("terms",s.terms.push(new u.CrossTerm({terms:new r.List(a)})))}else{s=new u.CrossTerm({terms:new r.List(a)})}e=e.update("headerConfig",function(e){return e.set(i,s)})});return e};u.getHierarchyForLevelFields=function(e,t){var i=[],r=[];e.forEach(function(e){if(e.level.levelName!=="ALL"){i.push(e.level.levelName);r.push(e.level.dimensionName)}});r=n.uniq(r);l(r.length===1,"Bad number of dimensionNames found: "+r.length);return t.findHierarchiesWithLevels(r[0],i)[0]};u.addFieldToAxis=function(e,t,i,r){var n=e.axis.get(t),o=n.indexOf(i),a;if(o>=0)n=n.delete(o);a=n.indexOf(r);if(a>=0){n=n.splice(a,0,i)}else{n=n.push(i)}e=e.setIn(["axis",t],n);e=u.regenerateHeaderConfig(e);return e};u.getBaseIntersection=function(e){return u.getBaseLevelFields(e).map(function(e){return e.level})};u.getBaseLevelFields=function(e){return e.axis.reduce(function(t,i,r){return t.concat(u.getLowestLevelFieldsOnAxis(e,r))},r.List())};u.removeLevelsFromAxis=function(e,t){var i=e.getIn(["axis",t]).filter(function(e){return!(e instanceof u.LevelField||e instanceof u.DimensionField)});return e.setIn(["axis",t],i)};u.getOuterLabelOfMeasure=function(e,t){return e.labelMap&&e.labelMap.get(t)||t};u.getLowestLevelFieldsOnAxis=function(e,t){return e.getIn(["axis",t]).map(function(e){return e.get("type")===d.DIMENSION?e.get("fields").last():e}).filter(function(e){return e.get("type")===d.LEVEL})};u.signatureToMQGSignature=function(e){return new s.BaseSignature(Z(e.intersection),new s.ValueType(e.type.kind,new s.Type(e.type.type.kind,e.type.type.named)))};u.enableOutlineForField=function(e){return e.set("displayMode",Ve.OUTLINE)};u.disableOutlineForField=function(e){return e.set("displayMode",Ve.NONE)};u.setRollupForField=function(e,t){return e.set("rollupConfigs",new r.List([Fe({methodName:t})]))};u.removeRollupForField=function(e){return e.delete("rollupConfigs")};u.aggIntersectionIsValidForMetric=function(e,t,i){return!a.metricBaseAboveInter(e,Z(t),i)};t.exports.MAConfig=et;t.exports.getUsedAxes=tt;t.exports.CrossTerm=it;t.exports.ConcatTerm=rt;t.exports.PlaceholderTerm=at;t.exports.NestTerm=ot;t.exports.FieldTerm=nt;t.exports.getOrderedAxes=st;t.exports.getAxisFields=ut;t.exports.getField=lt;t.exports.Level=f;t.exports.mkLevel=h;t.exports.qualifiedLevelToLevel=g;t.exports.levelToQualifiedLevel=m;t.exports.levelAttributeToMQGAttribute=v;t.exports.levelToQName=y;t.exports.mqgLevelToQName=b;t.exports.qNameToMQGLevel=w;t.exports.isAllLevel=C;t.exports.getIntersectionForMeasure=te;t.exports.getIntersectionForMetric=ne;t.exports.intersectionToMQGIntersection=Z;t.exports.mqgIntersectionToIntersection=ee;t.exports.LevelDisplayMode=Ve;t.exports.SliceConfig=be;t.exports.mkSliceConfig=we;t.exports.SortConfig=ve;t.exports.mkSortConfig=ye;t.exports.RollupConfig=$e;t.exports.mkRollupConfig=Fe;t.exports.LevelField=qe;t.exports.isLevelField=He;t.exports.compareLevelFields=Je;t.exports.mkLevelField=Ue;t.exports.addFilterToLevelField=We;t.exports.updateHierarchyInLevelField=Ge;t.exports.updateDimensionLabelInLevelField=je;t.exports.isAllLevelField=Be;t.exports.MeasureField=fe;t.exports.mkMeasureField=he;t.exports.Metric=N;t.exports.mkMetric=R;t.exports.Attribute=P;t.exports.mkAttribute=L;t.exports.Operator=k;t.exports.mkOperator=$;t.exports.Measure=E;t.exports.mkMeasure=M;t.exports.getMeasureValueType=S;t.exports.findDataConfigPathInMeasureField=me;t.exports.DataConfig=oe;t.exports.mkDataConfig=ae;t.exports.EditConfig=de;t.exports.mkEditConfig=pe;t.exports.findAggConfigPathInMeasure=A;t.exports.AggConfig=I;t.exports.mkAggConfig=O;t.exports.Filter=xe;t.exports.mkFilter=ke;t.exports.Comparator=Ce;t.exports.mkComparator=Ee;t.exports.Comparison=Se;t.exports.mkComparison=Te;t.exports.mkIntersection=J;t.exports.DimensionField=Qe;t.exports.mkDimensionField=Ke;t.exports.MeasureGroupField=Ye;t.exports.mkMeasureGroupField=Xe;t.exports.mkArray=p;t.exports.FieldTypes=d},{"./cubiql":276,"./querygen/query":333,assert:2,immutable:"immutable",lodash:70,"measure-query-gen/src/MQG":1}],329:[function(e,t,i){"use strict";var r=e("pivottable/src/lib/oop");var n=e("assert");var o=e("lodash");var a=e("./multiaxisconfig");var s=t.exports;s.LOADING_MEMBER_ID="__LOADING__";s.INVALID_MEMBER_ID="__INVALID__";s.UNASSIGNED_MEMBER_ID="__UNASSIGNED__";s.makePrototypeFromMacTerm=function(e,t){var i,r,l,u;if(e instanceof a.PlaceholderTerm){return new h(e.fieldId)}if(e instanceof a.ConcatTerm){i=o.compact(e.terms.map(function(e){return s.makePrototypeFromMacTerm(e,t)}).toArray());if(i.length)return new d(e.fieldId,i)}else if(e instanceof a.CrossTerm){i=o.compact(e.terms.map(function(e){return s.makePrototypeFromMacTerm(e,t)}).toArray());if(i.length)return new c(e.fieldId,i)}else if(e instanceof a.NestTerm){if(e.fieldTerms.size)l=e.fieldTerms.filter(function(e){var i=a.getField(t,e.fieldId);return i.displayMode===a.LevelDisplayMode.OUTLINE});u=l.map(function(i){var r=a.getField(t,i.fieldId),n=e.fieldTerms.findIndex(function(e){return i.fieldId===e.fieldId}),o=e.fieldTerms.slice(0,n).map(function(e){return a.getField(t,e.fieldId)});return s.makePrototypeFieldTermForField(r,o)}).toArray();if(u.length===1){return u[0]}return new f(e.fieldId,u,o.compact(u.map(function(e,i){if(i<u.length-1){return s.makePrototypeNestMapForFieldTerms(t,e,u[i+1])}})))}else if(e instanceof a.FieldTerm){r=a.getField(t,e.fieldId);n(r,"Couldn't find field referenced by field term: ",e.fieldId);return s.makePrototypeFieldTermForField(r)}else{throw new Error("couldn't make term into MAH Term")}};s.makePrototypeNestMapForFieldTerms=function(e,t,i){var r=a.getField(e,t.fieldId),n=a.getField(e,i.fieldId),o=i.members.map(function(e){var i;if(e.config.rollup){i=t.members.find(function(t){return t.config.rollup===e.config.rollup})}return[e.id,i?i.id:"proto"]});return new u(r,n,o)};s.makePrototypeFieldMember=function(e){return new g("proto","proto",{field:e})};s.makePrototypeFieldTermForField=function(e,t){var i=[];t&&t.forEach(function(e){var t=s.makePrototypeFieldMember(e);if(e.rollupConfigs){e.rollupConfigs.forEach(function(r){var n={rollup:r,id:t.id,label:t.label},o=s.mkRollupMemberId(r,e.id,t.id);Object.keys(t.config).forEach(function(e){n[e]=t.config[e]});i.push(new g(o,o,n))})}});i.push(s.makePrototypeFieldMember(e));return new p(e,i)};var l=Object.freeze({CROSS:1,CONCAT:2,NEST:3,FIELD:4});var u=s.FieldMap=function(e,t,i){this.parentField=e;this.childField=t;this.mapping=i};var c=s.CrossTerm=function(e,t){this.fieldId=e;this.terms=t};var d=s.ConcatTerm=function(e,t){this.fieldId=e;this.terms=t};var p=s.FieldTerm=function(e,t){this.fieldId=e.id;this.field=e;this.members=t};var f=s.NestTerm=function(e,t,i){this.fieldId=e;this.fieldTerms=t;this.maps=i};var h=s.PlaceholderTerm=function(e){this.fieldId=e};var g=s.Member=function(e,t,i){this.id=e;this.label=t;this.config=i};var m=s.Heading=function(e,t,i){this.id=e;this.label=t;this.config=i};s.AxisHeading=v;function v(e,t){this.$term=e;this.$path=t||[];if(e&&e.fieldId){this.$path=this.$path.concat([e.fieldId])}}v.prototype.getLength=function(){return this.$length};function y(e,t){var i=0,r=e.length;for(;i<r;i++){if(e[i][t]()){return true}}return false}v.prototype.hasLoadingHeadings=function(){return y(this.$axisHeadings,"hasLoadingHeadings")};v.prototype.hasAllHeadingsInvalid=function(){return o.every(this.$axisHeadings,function(e){return e.hasAllHeadingsInvalid()})};v.prototype.$adjustRange=function(e,t){e=Math.min(e,this.getLength());t=Math.min(t,this.getLength());var i=t-e;return{start:e,end:t,len:i}};v.prototype.getHeadingRange=function(e,t){var i=this.$adjustRange(e,t),r=i.start,n=[];for(;r<i.end;r++){n.push(this.getHeadingRow(r))}return n};v.prototype.getHeadingRow=function(e){var t={headers:[],members:[]},i=[],r=[],n=this.getHeadingMembers(e),o=this.getColumnSetAt(e),a,s=0;for(;s<n.length;s++){a=n[s];t.headers.push(P(a));if(a.config.field){t.members.push(a.config.id||a.id);i.push(a.config.field);r.push(a.config.rollup)}t.hasInvalidHeadings=t.hasInvalidHeadings||a.config.invalidHeadings}t.colSet=o;t.fields=i;t.rollups=r;return t};v.prototype.$findColumnSetIndexForFieldPos=function(e){var t=this.getColumnSets(),i=Object.keys(e),r,n,a=0;i.sort();for(;a<t.length;a++){r=t[a];n=r.columns.map(function(e){return e.field.id});n.sort();if(o.isEqual(n,i)){return a}}};v.prototype.$findMatchingColumnSetsForFieldPos=function(e){var t=this.getColumnSets(),i=Object.keys(e),r,n,o,a=0,s,l=i.length,u,c=[],d,p;for(;a<t.length;a++){r=t[a];n=r.columns;o=n.length;u=true;for(d=0;d<l&&u;d++){u=false;s=i[d];for(p=0;p<o;p++){if(n[p].field&&n[p].field.id===s||n[p].path[0]===s)u=true}}if(u)c.push(r)}return c};v.prototype.$findColumnSetOffset=function(e){var t=this.getColumnSets(),i=0,r=0;for(;i<e;i++){r+=t[i].length}return r};v.prototype.findMatchingRowNums=function(e,t){var i=this.$findMatchingColumnSetsForFieldPos(e),r,n=[],a=0,s,l,u;for(;a<i.length;a++){r=i[a];if(o.isFunction(t)?t(r):true){l=this.findMatchingRowNumsInColSet(r,e);u=l.length;for(s=0;s<u;s++){n.push(l[s])}}}return n.sort(function(e,t){return e-t})};function b(e,t){var i=[],r=t.field,n=t.members,a=r&&e[r.id],s;if(a){s=E(a,n);if(!o.isUndefined(s))i=[s]}else if(!r){return[0]}else{for(var l=0;l<n.length;l++){i.push(l)}}return i}function w(e,t){var i=[],r=[],n,a,s=t.length,l,u;for(l=s-1;l>=0;l--){a=e[t[l].field.id];if(l===s-1){i.push(b(e,t[l]))}else if(a){r=[];n=t[l].memberRowMap.get(a.id);if(n){for(u=n.start;u<n.start+n.length;u++){r.push(u)}i.push(r)}}}return o.intersection.apply(o,i)}function C(e,t,i){var r=[],n,o=i.length,a,s;for(a=0;a<t.length;a++){n=t[a]*e;for(s=0;s<o;s++){r.push(n+i[s])}}return r}v.prototype.findMatchingRowNumsInColSet=function(e,t){var i=e.offset,r=e.columns,n,o,a=[],s,l,u=r.reduce(function(e,t,i,r){var n=t.redundant||r[i-1]&&r[i-1].redundant;if(n){if(e.length===0||!r[i-1].redundant){e.push([t])}else{e[e.length-1].push(t)}}else{e.push([t])}return e},[]),c=u.length;for(o=c-1;o>=0;o--){n=u[o];l=n.length>1;if(!l){s=b(t,n[0])}else{s=w(t,n)}if(o<c-1){a=C(n[0].step,s,a)}else{a=s}}return a.map(function(e){return e+i})};v.prototype.findRowNumForFieldPos=function(e){var t=this.$findColumnSetIndexForFieldPos(e);if(o.isUndefined(t))return;var i=this.getColumnSets()[t],r=i.offset,a=i.columns,s=a.length,l,u,c,d,p=0,f=r;for(;p<s;p++){u=a[p];c=u.field;d=e[c.id];n(d,"No position member for for field "+c.id);if(!u.redundant){l=E(d,u.members);if(o.isUndefined(l))return;f+=l*u.step}}return f};function E(e,t){var i=e.id,r=e.rollupFieldId,n=t.length,o,a=0;for(;a<n;a++){o=t[a];if(r){if(o.config.rollup&&o.config.id===r)return a}else{if(o.id===i)return a}}}v.prototype.getHeadingForField=function(e){if(this.$term.fieldId===e)return this;var t,i=this.$axisHeadings||{},r=i.length,n=0;for(;n<r;n++){if(t)break;t=i[n].getHeadingForField(e)}return t};s.CrossAxisHeading=S;function S(e){v.apply(this,arguments);var t=this.$path;this.$axisHeadings=e.terms.map(function(e){return s.termToAxisHeading(e,t)});this.$length=this.$axisHeadings.length?this.$axisHeadings.reduce(function(e,t){return e*(t.getLength()||0)},1):0}r.inherits(S,v);S.prototype.$calculateRelativeRows=function(e){var t=[],i=e,r,n,o=this.getLength(),a=0;for(;a<this.$axisHeadings.length;a++){n=this.$axisHeadings[a];o=o/n.getLength();r=Math.floor(i/o);i=i-r*o;t.push(r)}return t};S.prototype.getColumnSets=function(){if(this.$columnSets)return this.$columnSets;var e=this.$axisHeadings.map(function(e){return e.getColumnSets()}),t=e.length,i,r,n;if(!e.length)return[];if(e.length===1)return e[0];r=e[t-1];for(n=t-2;n>=0;n--){i=e[n];r=T(i,r)}this.$columnSets=r;return this.$columnSets};function T(e,t){n(e&&t);var i=[],r=e.length,a=t.length,s,l,u,c,d,p,f,h,g,m=0,v,y;d=t.reduce(function(e,t){return e+t.length},0);for(;m<r;m++){s=e[m];l=s.length;p=p||s.offset;for(v=0;v<s.columns.length;v++){s.columns[v].step*=d;if(v>0){s.columns[v].repeatDistance=s.columns[v].step*s.columns[v].length}}for(v=0;v<a;v++){u=t[v];for(y=0;y<u.columns.length;y++){c=u.columns[y];if(!c.repeatDistance){c.repeatDistance=c.step*d}if(s.columns[0].interleaved){c.repeatDistance=undefined;if(y===u.columns.length-1){c.length=s.length*d}}}f=s.interleaved?s.offset*u.length:0;h=u.interleaved?u.offset:0;i.push({columns:[].concat(s.columns.map(o.clone),u.columns.map(o.clone)),offset:s.interleaved||u.interleaved?f+h:p,length:s.length*u.length,interleaved:s.interleaved||u.interleaved});if(!u.interleaved){p+=s.length*u.length}}}return i}S.prototype.getColumnSetAt=function(e){var t=this.getColumnSets(),i=t.length,r,n,o,a,s,l=0,u,c,d;for(;l<i;l++){if(u)break;r=t[l];n=r.columns.length;o=r.columns[0];a=this.$getColumnSetSize(r)+r.offset;if(!(e<a&&e>=r.offset))continue;s=r.columns[n-1];c=r.offset;d=c+s.length;while(e>=c){if(e<d){u=r;break}c+=s.repeatDistance;d+=s.repeatDistance}}return r};S.prototype.getHeadingMembers=function(e){var t=this.$calculateRelativeRows(e),i,r=0,n,o,a=[];for(;r<t.length;r++){i=t[r];o=this.$axisHeadings[r].getHeadingMembers(i);for(n=0;n<o.length;n++)a.push(o[n])}return a};s.ConcatAxisHeading=x;function x(e){v.apply(this,arguments);var t=this.$path;this.$axisHeadings=e.terms.map(function(e){return s.termToAxisHeading(e,t)});this.$length=this.$axisHeadings.reduce(function(e,t){return e+t.getLength()},0)}r.inherits(x,v);x.prototype.getHeadingMembers=function(e){var t=e,i,r=this,n=0;for(;n<this.$axisHeadings.length;n++){i=this.$axisHeadings[n];if(t<i.getLength())return i.getHeadingMembers(t);else t-=i.getLength()}return[]};x.prototype.getColumnSetAt=function(e){var t=this.$axisHeadings,i=t.length,r=0,n,a,s;for(a=0;a<i;a++){n=t[a];if(e>=r&&e<r+n.getLength()){break}r+=n.getLength()}s=n.getColumnSetAt(e-r);return o.extend({},s,{offset:s.offset+r})};S.prototype.$getColumnSetSize=function(e){var t=e.columns[0];return t?t.length*(t.step||1):0};x.prototype.getColumnSets=function(){if(this.$columnSets)return this.$columnSets;var e=0,t=this;this.$columnSets=Array.prototype.concat.apply([],this.$axisHeadings.map(function(t){var i=t.getColumnSets();i=i.map(function(t){return o.extend({},t,{offset:t.offset+e,interleaved:true,columns:t.columns.map(function(e){return o.extend({},e,{interleaved:true})})})});e+=t.getLength();return i}));return this.$columnSets};s.NestAxisHeading=_;function _(e){v.apply(this,arguments);n(e.maps.length,"Can't have NestAxisHeading with no field mappings");n(e.fieldTerms.length>1,"Must have more than fieldTerm in to make an AxisHeading from a NestTerm");n(e.maps.length===e.fieldTerms.length-1,"Nested headings require a fieldmap for each pair of axis headings");var t=this;this.$childToParentMaps=[];this.$parentToChildrenMaps=[];this.$idMaps=e.fieldTerms.map(function(e){var t=e.members,i,r=new Map,n=0;for(;n<t.length;n++){i=t[n];r.set(i.id,i)}return r});e.maps.forEach(function(e){var i=e.mapping,r=new Map,n,o,a=0;for(;a<i.length;a++){n=i[a];o=n[1];if(!r.has(o))r.set(o,[n[0]]);else r.get(o).push(n[0])}t.$parentToChildrenMaps.push(r);t.$childToParentMaps.push(new Map(i))});this.$axisHeadings=e.fieldTerms.map(function(e){return s.termToAxisHeading(e,t.$path)});this.$length=this.$axisHeadings[this.$axisHeadings.length-1].getLength()}r.inherits(_,v);_.prototype.$getMemberById=function(e,t){return this.$idMaps[e].get(t)};_.prototype.getHeadingMembers=function(e){var t=this.$term.maps.length-1,i=this.$axisHeadings[this.$axisHeadings.length-1].getHeadingMembers(e)[0],r,n,o,a=[];for(;t>=0;t--){o=this.$childToParentMaps[t];r=o.get(i.id);if(!r){n=this.$createUnassignedParentMember()}else{n=this.$getMemberById(t,r)}a.push(i);i=n}a.push(n);a.reverse();return a};_.prototype.getColumnSetAt=function(e){if(e>=0&&e<this.getLength()){return this.getColumnSets()[0]}};_.prototype.$getMemberRowMap=function(){var e=this.$parentToChildrenMaps.reduceRight(function(e,t,i,r){var n=new Map,o=0,a;if(i===r.length-1){t.forEach(function(e,t){var i=e.length;n.set(t,{start:o,length:i});o+=i})}else{a=e[0];t.forEach(function(e,t){var i=a.get(e[0]).start,r=e.reduce(function(e,t){return e+a.get(t).length},0);n.set(t,{start:i,length:r})})}e.unshift(n);return e},[]);return e};_.prototype.getColumnSets=function(){if(this.$columnSets)return this.$columnSets;var e=this.$axisHeadings.map(function(e){return e.getColumnSets()[0]}),t=e[e.length-1],i=t.columns[0],r=this.$getMemberRowMap();this.$columnSets=[{columns:e.map(function(t,n){var o=t.columns[0];return{field:o.field,length:i.length,members:o.members,step:o.step,path:o.path,redundant:n<e.length-1,memberRowMap:r[n]}}),offset:0,length:this.getLength()}];return this.$columnSets};_.prototype.$createUnassignedParentMember=function(){return new g(s.UNASSIGNED_MEMBER_ID,"",{})};s.FieldAxisHeading=M;function M(e){v.apply(this,arguments);this.$length=e.members.length}r.inherits(M,v);M.prototype.getHeadingForField=function(e){if(this.$term.field.id===e)return this};M.prototype.hasLoadingHeadings=function(){return this.$term.members&&this.$term.members[0]&&this.$term.members[0].config.loading};M.prototype.hasAllHeadingsInvalid=function(){return!!this.$term.members&&o.every(this.$term.members,o.property("config.invalidHeadings"))};M.prototype.getHeadingMembers=function(e){var t=this.$term.members[e];if(t)return[t];else return[]};M.prototype.getColumnSetAt=function(){return this.getColumnSets()[0]};M.prototype.getColumnSets=function(){return[{columns:[{field:this.$term.field,length:this.getLength(),members:this.$term.members,path:this.$path,step:1}],offset:0,length:this.getLength()}]};function A(){v.apply(this,arguments);this.$length=0}r.inherits(A,v);A.prototype.hasLoadingHeadings=function(){return false};A.prototype.hasInvalidHeadings=function(){return false};A.prototype.getColumnSetAt=function(){return{columns:[],length:0}};A.prototype.getColumnSets=function(){return[]};A.prototype.getHeadingMembers=function(){return[[]]};A.prototype.findRowNumForFieldPos=function(){return};A.prototype.getHeadingForField=function(){return};var I="_PLACEHOLDER_";var O="";var D={placeholder:true};function N(e){v.apply(this,arguments);if(e)this.$fieldId=e.fieldId;this.$length=1;this.$member=new g(I,O,D)}r.inherits(N,v);N.prototype.hasLoadingHeadings=function(){return false};N.prototype.hasAllHeadingsInvalid=function(){return false};N.prototype.findRowNumForFieldPos=function(){return};N.prototype.getColumnSetAt=function(e){if(e===0)return this.getColumnSets()[0]};N.prototype.getColumnSets=function(){return[{columns:[{length:1,step:1,path:[]}],offset:0,length:this.getLength()}]};N.prototype.getHeadingMembers=function(e){if(e===0)return[this.$member];else return[]};N.prototype.getHeadingForField=function(e){if(this.$fieldId===e)return this};var R=s.axisHeadingToTerm=function(e){return e.$term};s.termToAxisHeading=function(e,t){if(e instanceof p)return new M(e,t);else if(e instanceof f)return new _(e,t);else if(e instanceof c)return new S(e,t);else if(e instanceof d)return new x(e,t);else if(e instanceof h)return new N(e);else throw new Error("Unhandleable term type: "+JSON.stringify(e.type))};function P(e){return new m(e.id,e.label,e.config)}var L=s.HeadingData=function(e,t,i){this.$axisHeadings=e;this.$slicePosition=t;this.$config=i;this.$usedAxes=a.getUsedAxes(i);this.$axes=i.axis.keySeq().toJS()};L.prototype.hasLoadingHeadings=function(){var e=o.compact(o.values(this.$axisHeadings));return y(e,"hasLoadingHeadings")};L.prototype.hasOnlyInvalidHeadings=function(){var e=o.compact(o.values(this.$axisHeadings));return y(e,"hasAllHeadingsInvalid")};L.prototype.isLoadingSlice=function(){var e;for(e in this.$slicePosition){if(this.$slicePosition[e]&&this.$slicePosition[e].loading){return true}}return false};L.prototype.getColumnSets=function(e){return this.getHeadingAxisInfo(e).getColumnSets()};L.prototype.getAxes=function(){return this.$axes};L.prototype.getUsedAxes=function(){return this.$usedAxes};L.prototype.isAxisUsed=function(e){return this.$usedAxes.indexOf(e)>=0};L.prototype.getSlicePosition=function(){var e,t={};for(e in this.$slicePosition){t[e]=this.$slicePosition[e].id}return t};L.prototype.getSelectedSliceFieldPos=function(e){var t=false,i=this.getSlicePosition(),r={};e.forEach(function(e){var n;if(e instanceof a.MeasureGroupField){n=i[e.id];if(!n)t=true;r[n]={id:n}}else if(e instanceof a.DimensionField){if(!e.fields.size)t=true;e.fields.forEach(function(e){n=i[e.id];if(!n)t=true;r[e.id]={id:n}})}else{n=i[e.id];if(!n)t=true;r[e.id]={id:n}}});if(!t)return r};L.prototype.getHeadingAxisInfo=function(e){var t=this.$axisHeadings[e];if(!t){if(this.$usedAxes.indexOf(e)>-1)t=new A;else t=new N}return t};L.prototype.findCoordForFieldPos=function(e){var t=this,i=this.getUsedAxes().map(this.getHeadingAxisInfo.bind(this)),r=new S(new c(undefined,i.map(function(e){return R(e)}))),n=r.findRowNumForFieldPos(e),a={};this.getAxes().forEach(function(e){if(t.getUsedAxes().indexOf(e)===-1){a[e]=0}});if(!o.isUndefined(n)){this.getUsedAxes().forEach(function(e,t){if(t<i.length-1){var r=i.slice(t+1,i.length).reduce(function(e,t){return e*t.getLength()},1),o=Math.floor(n/r);a[e]=o;n-=o*r}else{a[e]=n}});return a}};L.prototype.getRowNumByMemberOffset=function(e,t,i,r){return this.getHeadingAxisInfo(e).getRowNumByMemberOffset(t,i,r)};v.prototype.getRowNumByMemberOffset=function(e,t,i){var r=this.getHeadingRow(t),n=r.fields.slice(0,e+1),a=r.members.slice(0,e+1),s=i>0?[t+1,this.getLength()]:[0,t-1],l=this.getLength(),u=s[1]-s[0],c,d,p=function(t){var i=0,s=t.members.slice(0,e+1),l,u,c,d=t.fields.slice(0,e+1);if(t.fields.length!==r.fields.length)return true;for(;i<=e;i++){l=n[i];u=d[i];c=o.isUndefined(l)&&o.isUndefined(u)||!o.isUndefined(l)&&!o.isUndefined(u)&&l.id===u.id;if(!c)return true;if(s[i]!==a[i])return true}return false},f=-1;s[0]=s[0]>=0?s[0]:0;s[1]=s[1]<l?s[1]:l-1;while(u>0){c=u<2?i>0?s[0]:s[1]:s[0]+Math.floor(u/2);d=this.getHeadingRow(c);if(p(d)){if(i>0)s[1]=c;else s[0]=c}else{if(i>0)s[0]=c+1;else s[1]=c-1}s[0]=s[0]>=0?s[0]:0;s[1]=s[1]<l?s[1]:l-1;u=s[1]-s[0]}if(u===0){f=s[0]}else if(u===1){if(i>0)f=s[0];else f=s[1]}if(f===t||f<0||f>=l||!p(this.getHeadingRow(f)))return;else return f};s.mkRollupMemberId=function(e,t,i){return(e.methodName||"DEFAULT")+":"+t+"["+i+"]"};s.mkRollupMemberConfig=function(e,t){var i={rollup:e,id:t.id,label:t.label};Object.keys(t.config).forEach(function(e){i[e]=t.config[e]});return i}},{"./multiaxisconfig":328,assert:2,lodash:70,"pivottable/src/lib/oop":124}],330:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("./cubiql");var a=e("./util");var s=e("./multiaxisconfig");var l=e("./querygen/query");var u=e("./modelerstate");var c=s.MAConfig;var d=s.FieldTypes;var p=e("assert");var f=e("./view/pivot/config_helper");var h=e("./helpers/fieldhelpers");var g=t.exports;var m={Z:"slice",X:"x",Y:"y"};function v(e,t,i){i=f.convertOldPivotConfigToNew(i,t);if(!i.axis)i.axis={};var n=new c({id:t,axis:r.fromJS({X:[],Y:[],Z:[]})});n=n.setIn(["measureGroups","-:Measures"],B(e,i,"-:Measures"));n=M(e,n,i);n=I(e,n,i);n=y(e,n,i);n=s.generateDefaultHeaderConfig(n);n=U(n,i);n=g.updateConfig(e,n);return n}function y(e,t,i){var r=i.filter||{};n.forEach(r,function(r,n){if(o.isMeasure(n)){t=E(e,i,t,n,r)}else t=C(e,t,n,r)});t=x(e,t,i.maskFilter);return t}function b(e,t){function i(e){return s.addFilterToLevelField(t,e)}return w(e,i)}function w(e,t){["X","Y","Z"].forEach(function(i){e=e.updateIn(["axis",i],function(e){return e.map(function(e){if(e instanceof s.LevelField){return t(e)}else if(e instanceof s.DimensionField){return e.update("fields",function(e){return e.map(t)})}else{return e}})})});return e}function C(e,t,i,r){function n(t){var n=g.createPositionFilterForField(e,t,i,r);if(n){return s.addFilterToLevelField(n,t)}return t}return w(t,n)}g.applyPivotConfigLevelFilter=C;g.createPositionFilterForField=function(e,t,i,n){var a=o.parseDimLvl(i),l=s.qualifiedLevelToLevel(a,e.measureModel),u=Object.keys(n),c;if(a.dimension===t.level.dimensionName){c=e.measureModel.findHierarchiesWithLevels(l.dimensionName,[l.levelName,t.level.levelName]).map(function(e){return e.name});if(c.length===0){return}l=l.set("hierarchyName",c.indexOf(t.level.hierarchyName)>-1?t.level.hierarchyName:c[0]);l=l.set("labelName",t.level.labelName)}return new s.Filter({
measure:new s.Measure({attribute:new s.Attribute({name:"id",level:l})}),comparisons:new r.List(u.map(function(e){return new s.Comparison({operator:"=",comparator:new s.Comparator({literal:e})})}))})};function E(e,t,i,a,l){var u=f.findAxisForMeasureField(i,a),c=u?s.removeLevelsFromAxis(i,u):i,d=s.getBaseIntersection(c),p=d.map(function(i){var r=s.getAxisFields(c,function(e){return e instanceof s.LevelField&&e.level.levelName===i.levelName&&e.level.dimensionName===i.dimensionName});if(r.size){return r.get(0)}else{return z(e,t,{qualifiedName:o.qualifiedLevelToQualifiedName(s.levelToQualifiedLevel(i))})}}),h=new s.Measure({metric:new s.Metric({name:a})}),g=F(e,h.metric,i,p),m=q(e,s.getBaseIntersection(c),i),v=o.intersectionEqual(s.intersectionToMQGIntersection(g.intersection),s.intersectionToMQGIntersection(m),true);if(!v)return i;h=h.setIn(["metric","intersection"],g.intersection).set("labelMap",g.labelMap);[l.max,l.min].forEach(function(e,t){var o=t===0,a;if(!n.isUndefined(e)){a=o?l.inclusive?"<=":"<":l.inclusive?">=":">";i=b(i,new s.Filter({measure:h,comparisons:new r.List([new s.Comparison({operator:a,comparator:new s.Comparator({literal:e})})])}))}});return i}g.applyPivotConfigMetricFilter=E;function S(e,t){var i=t.method!=="DEFAULT"?t.method:undefined,r,n,o;r=s.findDataConfigPathInMeasureField(e,"value");p(r&&r.length>0,"Couldn't find data config path for value when applying ",t);n=e.getIn(r);o=s.findAggConfigPathInMeasure(n.measure);p(o&&o.length,"Couldn't find agg config path for value when applying ",t);return e.updateIn(r.concat(["measure"],o),function(e){if(e)return e.set("methodName",i);else return s.mkAggConfig({methodName:i})})}function T(e,t,i,a,l){var u=e.measureModel,c=n.chain(l.sortPositions||[]).groupBy(function(e){var t=e.qualifiedLevel;return t.dimension+"$"+t.hierarchy}).map(function(e){var t=e.map(function(e){return e.qualifiedLevel}),i=u.findLowestLevel(e[0].qualifiedLevel.dimension,t);return e.find(function(e){return e.qualifiedLevel===i})}).flatten().filter(function(e){return e.qualifiedLevel.level!=="ALL"}).value(),d=c.map(function(i){var r=s.getField(t,o.qualifiedLevelToQualifiedName(i.qualifiedLevel));if(r){return r}else{return h.getFieldFromQualifiedName(e.fields,o.qualifiedLevelToQualifiedName(i.qualifiedLevel))}}),p=s.getAxisFields(t,function(e){return e instanceof s.LevelField},"Z"),f=l.metricName,g=f&&e.measureModel.getMeasureInfo(f),m=g&&g.type.kind,v=s.mkMetric({name:f}),y=F(e,v,t,r.List([a]).concat(d).concat(p)),b=s.mkMeasure({labelMap:y.labelMap,metric:v.merge({intersection:y.intersection,filters:r.List(c).map(function(e){return s.mkFilter({measure:{attribute:{name:"id",level:s.qualifiedLevelToLevel(e.qualifiedLevel,u)}},comparisons:[{operator:"=",comparator:{literal:e.memberId}}]})})})}),w=m&&m==="NAMED"&&"AttributeMapping_label"||undefined,C=w?new s.Measure({operator:new s.Operator({name:w,measures:new r.List([b])})}):b;return a.update("sortConfigs",function(e){e=e.filter(function(e){return!e.measure.metric});return e.splice(0,0,new s.SortConfig({sortType:l.sortOrder,measure:C}))})}function x(e,t,i){i=i||[];i.forEach(function(i){var n=e.measureModel.getMeasureInfo(i),a=s.mqgIntersectionToIntersection(n.inter,e.measureModel),l=n.inter.qualified_level.map(function(i){var r=o.qualifiedLevelToQualifiedName(i);return s.getField(t,r)||h.getFieldFromQualifiedName(e.fields,r)}),u=s.mkMeasure({metric:{name:i,intersection:a}});function c(i){var n=i instanceof s.LevelField&&i.level.dimensionName,o,a,c;o=l.map(function(e){if(e.getIn(["level","dimensionName"])===n){e=e.setIn(["level","labelName"],i.level.labelName)}return e});a=r.List(o);c=new s.Filter({measure:R(e,u,t,a)});return s.addFilterToLevelField(c,i)}t=w(t,c)});return t}g.applyMaskFilters=x;function _(e,t,i){var r=e.qualifiedName,n,o;n=new s.SliceConfig({sourceField:t});if(e.value){n=n.set("bySelection",e.value)}else{o=i.find(function(e){return e.qualifiedName===r});if(o){n=n.set("byMeasure",new s.Measure({metric:new s.Metric({name:o.measure})}))}}return n}function M(e,t,i){var o={Z:"slice",X:"x",Y:"y"},a=i.sort||{},l=i["sort-by-measure-value"]||{};n.forEach(o,function(o,c){var f=n.compact(i.axis[o]||[]),h=new r.List(f.map(function(t){var n=z(e,i,t),o=a[n.id];if(n instanceof s.LevelField&&o){n=n.set("sortConfigs",new r.List([s.mkSortConfig({sortType:o.sortType,measure:{attribute:{name:o.sortAttr||"label",level:n.level}}})]))}return n})),m,v=s.compareLevelFields.bind(null,e.measureModel),y=l.floatingAxis===o,b=[];m=h.groupBy(function(e){if(e instanceof s.LevelField){b.push(e.level.dimensionName);return r.Map({type:d.DIMENSION,name:e.level.dimensionName})}else if(e instanceof s.MeasureField){return r.Map({type:d.MEASURE,name:e.get("id")})}else if(e instanceof s.MeasureGroupField){return r.Map({type:d.MEASURE_GROUP,name:e.get("id")})}else{throw new Error("Unknown field type "+JSON.stringify(e))}});b=n.uniq(b);if(y)p(b.length===1,"More than one dimension found on floating axis when using sort-by-measure: ",b);t=t.setIn(["axis",c],m.entrySeq().map(function(i){var r=i[0],n=i[1],o,a,l,f;if(r.get("type")===d.DIMENSION){a=s.getHierarchyForLevelFields(n,e.measureModel);if(!a){throw new s.ValidationError("Fields "+n.map(function(e){return e.id}).join(",")+" are in the same dimension but do not share a hierarchy. They cannot be on the same axis.")}p(a,"couldn't determine hierarchy");l=r.get("name");f=g.findAvailableDimensionLabel(l,t);if(n.size===1){o=n.get(0);o=o.set("filterByAllSlicesInDimension",true);o=s.updateDimensionLabelInLevelField(o,f);o=s.updateHierarchyInLevelField(o,a.name);return o}else{return u.fields.getField(e.fields,l,d.DIMENSION).set("fields",n.sort(v).reverse().map(function(e,t){if(t===n.size-1||c==="Z"){e=e.set("displayMode","OUTLINE")}e=e.set("filterByAllSlicesInDimension",true);return s.updateDimensionLabelInLevelField(s.updateHierarchyInLevelField(e,a.name),f)})).set("hierarchy",a.name).set("dimensionLabel",f)}}else{return n.get(0)}}).toList())});t=t.update("axis",function(i){return i.map(function(i,n){var o=l.floatingAxis===m[n];return i.map(function(i){if(o){if(i instanceof s.DimensionField){return i.updateIn(["fields",i.fields.size-1],function(i){return T(e,t,new r.List([i.level]),i,l)})}else if(i instanceof s.LevelField){return T(e,t,new r.List([i.level]),i,l)}else{return i}}else{return i}})})});return t}function A(e){var t=[],i=new r.List([new r.List]);function n(e){var t=i.size,r,n=0,o;for(;n<t;n++){r=i.get(n);for(o=0;o<e.size;o++){i=i.push(r.concat(e.get(o)))}}}e.axis.forEach(function(e){e.forEach(function(e){var i=new r.List,n=0;if(e instanceof s.LevelField)i=i.push(new r.List([e]));else if(e instanceof s.DimensionField){i=i.push(e.fields.filter(function(e){return e.displayMode===s.LevelDisplayMode.OUTLINE}));for(;n<e.fields.size-1;n++){if(e.fields.get(n).rollupConfigs.size){i=i.push(e.fields.slice(0,n+1).filter(function(e,t){return e.displayMode===s.LevelDisplayMode.OUTLINE||t===n}))}}}if(i.size)t.push(i)})});t.forEach(function(e){n(e)});i=i.push(s.getBaseLevelFields(e));return i}function I(e,t,i){var r=i.axis.z||[],a=n.values(i.aggregate||{}),l=a.filter(function(e){return o.isMeasure(e.qualifiedName)}),u=n.groupBy(l,"qualifiedName");r.forEach(function(r){var n=z(e,i,r),o=u[r.qualifiedName];if(o){p(o.length===1,"Too many aggregate configurations found for "+r.qualifiedName);n=S(n,o[0])}t=s.addMeasureToGroup(t,t.measureGroups.get("-:Measures"),n)});return t}function O(e){return function(t){return t instanceof s.LevelField&&t.level.labelName===e}}function D(e,t,i){var n=new r.Map,o=f.findAxisForMeasureField(i,t.id),a=t.data;function l(t){n=n.set(t.toSet(),a.map(function(r){return r.set("measure",R(e,r.measure,i,t)).set("filters",N(e,r.filters,i,t))}))}if(t instanceof s.MeasureField&&o){i=s.removeLevelsFromAxis(i,o)}A(i).forEach(l);return t.set("dataPerFieldSet",n)}function N(e,t,i,n){t=t||new r.List;return t.map(function(t){return t.update("measure",function(t){return R(e,t,i,n)})})}function R(e,t,i,r){if(t.metric)return L(e,t,i,r);else if(t.attribute)return k(e,t,i,r);else if(t.operator)return P(e,t,i,r);else p(false,"Data cfg is neither a metric nor attribute!")}function P(e,t,i,r){return t.updateIn(["operator","measures"],function(t){return t.map(function(t){return R(e,t,i,r)})})}function L(e,t,i,r){var n=t.metric,o=F(e,n,i,r.toList(),t.labelMap);return t.set("metric",n.set("intersection",o.intersection)).set("labelMap",o.labelMap)}function k(e,t,i,r){if(!t.attribute.intersection)return t;var n=t.attribute,a=n.level,l=s.intersectionToMQGIntersection(s.getIntersectionForMeasure(t,e.measureModel)),u=s.intersectionToMQGIntersection(s.mkIntersection([a.set("labelName",a.dimensionName)])),c=a.labelName!==a.dimensionName,d=c&&l.qualified_level.some(o.qlevel.labelEquals(a.labelName)),p=d?[a.labelName]:[],f=V(e,u,l,i,r,p,t.labelMap);return t.set("attribute",t.attribute.set("intersection",f.intersection)).set("labelMap",f.labelMap)}function $(e,t,i,r){p(i.length>0);var n=e.findHierarchiesWithLevels(t,i).map(function(e){return e.name});return r&&n.indexOf(r)>-1?r:n[0]}function F(e,t,i,n,l){var u=t&&e.measureModel.getMeasureInfo(t.name),c=u&&u.inter,d=t.intersection?s.intersectionToMQGIntersection(t.intersection):c,p=new r.List,f=[],h=l||new r.Map,g=d.qualified_level.filter(function(e){return c.qualified_level.find(o.qlevel.dimensionEquals(o.qlevel.getDimension(e)))&&!c.qualified_level.some(o.qlevel.labelEquals(o.qlevel.getLabel(e)))});function m(e,t){if(!h.get(e))h=h.set(e,new r.List);h=h.update(e,function(e){return e.push(t)})}d.qualified_level.forEach(function(t){var i=o.qlevel.getLabel(t),r=n.filter(O(i)),s=r.size&&r.last(),l;if(s){l=$(e.measureModel,o.qlevel.getDimension(t),[o.qlevel.getLevel(t),s.level.levelName],s.level.hierarchyName);if(l){p=p.push(s.level.set("hierarchyName",l))}n=n.filter(a.not(O(i)));m(i,i)}else{f.push(t)}});n.groupBy(function(e){return e instanceof s.LevelField&&e.level.labelName}).forEach(function(i){var r=i.size&&i.last(),n=r instanceof s.LevelField&&r.level.dimensionName,a=n&&r.level.labelName,l=n&&d.qualified_level.find(function(e){return o.qlevel.dimensionEquals(n)(e)&&!g.some(o.qlevel.qLevelEqual(e,true))}),u=l&&o.qlevel.getLabel(l),c=e.measureModel.getPctParentConfig(t.name),f,h,v;if(l){m(u,a);h=$(e.measureModel,o.qlevel.getDimension(l),[o.qlevel.getLevel(l),r.level.levelName],r.level.hierarchyName);if(h){p=p.push(r.level.set("hierarchyName",h))}}if(i.size>1&&c&&c.dimension===n){f=i.get(i.size-2);v=f.level;h=$(e.measureModel,o.qlevel.getDimension(l),[o.qlevel.getLevel(l),v.levelName],v.hierarchyName);if(h){v=v.set("hierarchyName",h)}p=p.push(v.set("labelName",c.parentLabel))}});p=p.concat(g.map(function(t){return s.qualifiedLevelToLevel(t,e.measureModel)}));p=p.filter(function(e){return e.levelName!=="ALL"});p=q(e,p,i);h=H(h,p,c);return{intersection:p,labelMap:h}}function V(e,t,i,n,l,u,c){var d=new r.List,p=c||new r.Map;function f(e,t){if(!p.get(e))p=p.set(e,new r.List);p=p.update(e,function(e){return e.push(t)})}i.qualified_level.forEach(function(e){var t=o.qlevel.getLabel(e),i=l.filter(O(t)),r=i.size&&i.last();if(r){d=d.push(r.level);l=l.filter(a.not(O(t)));f(t,t)}});l.groupBy(function(e){return e instanceof s.LevelField&&e.level.labelName}).forEach(function(e){var t=e.size&&e.last(),r=t instanceof s.LevelField&&t.level.dimensionName,n=r&&t.level.labelName,a=r&&i.qualified_level.find(function(e){return o.qlevel.dimensionEquals(r)(e)&&u.indexOf(o.qlevel.getLabel(e))===-1}),l=a&&o.qlevel.getLabel(a);if(a){f(l,n);d=d.push(t.level)}});d=d.concat(i.qualified_level.filter(function(e){return u.indexOf(o.qlevel.getLabel(e))>-1}).map(function(t){return s.qualifiedLevelToLevel(t,e.measureModel)}));d=d.filter(function(e){return e.levelName!=="ALL"});d=q(e,d,n);p=H(p,d,t);return{intersection:d,labelMap:p}}function q(e,t,i){var r=s.getAxisFields(i,function(e){return e instanceof s.LevelField},"Z"),n=s.getAxisFields(i,function(e){return e instanceof s.LevelField},"X"),o=s.getAxisFields(i,function(e){return e instanceof s.LevelField},"Y"),a=t.groupBy(function(e){return e.dimensionName});return t.filter(function(t){var i=t.dimensionName,s=a.get(i),l=r.find(function(e){return e.level.labelName===t.labelName}),u=l&&s.filter(function(e){return n.find(function(t){return t.level.labelName===e.labelName})||o.find(function(t){return t.level.labelName===e.labelName})}),c=u&&u.some(function(r){var n=e.measureModel.getHierarchyWith(i,[r.levelName,t.levelName]);return!!n});return!c})}g.removeZAxisSplitsFromFields=function(e,t){var i=t.axis.get("Z").filter(function(e){return e instanceof s.LevelField}),r=e.groupBy(function(e){return e.level.dimensionName});return e.filter(function(e){var t=e.level.dimensionName;if(r.get(t).size>1){return!i.find(function(t){return e.level.labelName===t.level.labelName})}else{return true}})};function H(e,t,i){var r=t.map(function(e){return e.labelName});return e.filter(function(e,t){var r=e.size===1&&t===e.get(0);return!r&&i.qualified_level.some(o.qlevel.labelEquals(t))}).map(function(e){return e.filter(function(e){return r.indexOf(e)>-1})})}function U(e,t){var i=new r.List,n=t.axis.slice||[],a=t.sliceValueMeasure||[];e.axis.get("Z").forEach(function(e){var t=function(e){var t=e.level,i=n.find(function(e){var i=o.parseDimLvl(e.qualifiedName);return o.qlevel.getLevel(i)===t.levelName});return _(i,e,a)},r=function(t){var i=n.find(function(e){return e.qualifiedName===t.id});return _(i,e,a)};if(e instanceof s.LevelField)i=i.push(t(e));else if(e instanceof s.DimensionField)i=i.concat(e.fields.map(t));else if(e instanceof s.MeasureGroupField)i=i.push(r(e))});return e.set("sliceConfigs",i)}function B(e,t,i){var r=u.fields.getCanonicalMeasureGroup(e.fields,i);return r.set("fields",r.fields.map(function(i){return j(e,t,i)}))}function z(e,t,i){var n=i.qualifiedName,o=u.fields.getFieldFromQualifiedName(e.fields,n);p(!!o,"Could not find field with qualifiedName: "+n);if(o instanceof s.MeasureField)o=j(e,t,o);else if(o instanceof s.MeasureGroupField)o=o.set("fields",o.fields.map(function(i){return j(e,t,i)}));else if(o instanceof s.LevelField){o=o.set("displayMode",s.LevelDisplayMode[i.displayMode]||s.LevelDisplayMode.OUTLINE);if(i.rollup)o=o.set("rollupConfigs",new r.List([s.mkRollupConfig({methodName:i.rollup.methodName})]))}return o}g.getVisibleMeasureGroup=function(e){return e.measureGroups.get("-:Measures")};g.getVisibleMeasureFields=function(e){var t=this.getVisibleMeasureGroup(e);return t?t.fields:r.List()};g.computeDisplayType=function(e,t){var i=u.pivotconfig.getMetricConfig(e.pivotConfig,t.name),r=i&&i.cellType,n=u.pivotconfig.getMetricFormat(e.pivotConfig,t.name),o=g.getDefaultDisplayTypeForMeasureType(t.type,n);return r||o};g.getDefaultDisplayTypeForMeasureType=function(e,t){return e.kind.toLowerCase()==="boolean"?"checkbox":e.kind.toLowerCase()==="named"?"dropdown":t&&n.includes(t,"%")?"percentage":"text"};function j(e,t,i){var r=e.measureModel.getMeasureInfo(i.id);p(r,"Can't adjust data config for measure field '"+i.id+"' b/c can't find a metric for it in model");var n=g.computeDisplayType(e,r);if(n==="dropdown"){return W(e,t,r,i)}else{return i}}function G(e,t){return(e.dropdownMeasureFilter||[]).find(function(e){return e.qualifiedName===t})}function W(e,t,i,n){var a=o.parseDimLvl(e.measureModel.getLevelNameByPredicate(i.type.named)),c=a.dimension+"."+a.level+".label",d=o.legalizeLabel(i.name+"Value"),p=new r.Map,f=G(t,i.name),h;p=p.set(a.dimension,new r.List([d]));a.label=d;h=s.qualifiedLevelToLevel(a,e.measureModel);var g=u.pivotconfig.getLevelDefaultSort(e.pivotConfig,h);var m=new s.DataConfig({name:"optionSort",measure:new s.Measure({attribute:new s.Attribute({name:g.sortAttr,level:h}),labelMap:p})});n=n.update("data",function(t){var n=t.find(function(e){return e.name==="value"});t=t.concat([n.set("name","selectedDataLabel").update("measure",function(e){return new s.Measure({operator:new s.Operator({name:"AttributeMapping_label",measures:new r.List([e])})})}).set("customEdit",s.mkEditConfig({name:"byLabel",editTarget:{metricName:i.name},inputValueSignature:{intersection:new r.List([]),type:{kind:"SINGLETON",type:{kind:l.Type.STRING}}},inputAbstraction:{interArgs:[{name:"inter"},{name:"valueInter",intersection:new r.List([h])}],exprArgs:[{name:"input"},{name:"labelAttr",exprStr:d+":"+c}],bodyStr:"demote "+d+" in #(min (demote String in (dice ((promote input) @ (inter & valueInter & {String})) by (promote labelAttr))) @ (inter & valueInter))"}})),new s.DataConfig({name:"optionLabels",measure:new s.Measure({attribute:new s.Attribute({name:"label",level:h}),labelMap:p})}),m]);if(f){var a=new r.Map;a=a.set(f.valueLabel||h.dimensionName,new r.List([h.labelName]));var u=new r.List(e.measureModel.getMeasureInfo(f.filterMeasure).inter.qualified_level.map(function(t){if(f.valueLabel){if(o.qlevel.labelEquals(f.valueLabel)(t))t=o.relabelQL(t,h.labelName)}else{if(o.qlevel.dimensionEquals(h.dimensionName)(t))t=o.relabelQL(t,h.labelName)}return s.qualifiedLevelToLevel(t,e.measureModel)})),g=u.findIndex(function(e){return e.dimensionName===h.dimensionName&&e.labelName!==h.labelName}),v=g===-1?u:u.setIn([g,"labelName"],h.dimensionName),y=new s.DataConfig({name:"optionIds",measure:new s.Measure({attribute:new s.Attribute({name:"id",level:h,intersection:v}),labelMap:new r.Map(h.labelName!==h.dimensionName?[[h.dimensionName,new r.List([h.labelName])]]:undefined)}),filters:new r.List([s.mkFilter({measure:{metric:{name:f.filterMeasure,intersection:u},labelMap:a}})])});t=t.push(y);t=t.push(y.set("name","optionsFilter"))}else{t=t.push(new s.DataConfig({name:"optionIds",measure:new s.Measure({attribute:new s.Attribute({name:"id",level:h}),labelMap:p})}))}return t});return n}g.pivotConfigToMultiAxisConfig=v;g.getUsedDimensionLabels=function(e){var t=[];e.axis.forEach(function(e){e.forEach(function(e){if(e instanceof s.LevelField){t.push(e.level.labelName)}else if(e instanceof s.DimensionField){p(e.dimensionLabel,"DimensionField '"+e.id+"' has no label!");t.push(e.dimensionLabel)}})});return n.uniq(t)};g.findAvailableDimensionLabel=function(e,t){var i=g.getUsedDimensionLabels(t),r=2,n=e+r;if(i.indexOf(e)>-1){while(i.indexOf(n)>-1){r++;n=e+r}return n}else{return e}};g.updateIntersectionForAllMeasureFields=function(e,t){t=s.refreshAllMeasureGroupFieldsOnAxes(t.set("measureGroups",t.measureGroups.map(function(i){return i.set("fields",i.fields.map(function(i){return D(e,i,t)}))})));t=t.update("axis",function(i){return i.mapEntries(function(i){var r=i[0],n=i[1];n=n.map(function(i){if(i instanceof s.MeasureField){return D(e,i,t)}else{return i}});return[r,n]})});return t};g.updateConfig=function(e,t){t=g.updateIntersectionForAllMeasureFields(e,t);return t.update("axis",function(i){return i.map(function(i){return i.map(function(i){if(i instanceof s.MeasureField)return D(e,i,t);else return i})})})}},{"./cubiql":276,"./helpers/fieldhelpers":296,"./modelerstate":313,"./multiaxisconfig":328,"./querygen/query":333,"./util":357,"./view/pivot/config_helper":455,assert:2,immutable:"immutable",lodash:70}],331:[function(e,t,i){"use strict";var r=e("./util");var n=e("lodash");function o(e){this.$logError=e===undefined?true:e;this.$promise=Promise.resolve()}o.do=function(e,t){t=!n.isUndefined(t)?t:this.$logError;return new o(t).thenDo(e)};o.prototype.onSuccess=function(e){this.thenDo(e,this.$logError);return this};o.prototype.onFailure=function(e){this.catchAndRecover(e,this.$logError);return this};o.prototype.$chain=function(e,t,i){i=!n.isUndefined(i)?i:this.$logError;var a=this,s=new o(i);s.$promise=this.$promise[e](function(){return a.$asPromise(t,arguments)});if(this.$logError)s.$promise.catch(r.logError);return s};o.prototype.catchAndRecover=function(e,t){return this.$chain("catch",e,t)};o.prototype.thenDo=function(e,t){return this.$chain("then",e,t)};o.prototype.build=function(){return this.$promise};o.prototype.$asPromise=function(e,t){var i;i=e||Promise.resolve();if(e instanceof o){i=e.$promise}else if(n.isFunction(e)){i=new Promise(function(i,r){var n=e.apply(e,t);i(n&&n.$promise||n)})}else if(e instanceof Promise){i=e}return i};o.handleTimeout=function(e,t){var i=o.prototype.$asPromise(e);t=t||6e4*5;return new Promise(function(e,r){var n=setTimeout(function(){r(new a)},t);i.then(function(){clearTimeout(n);return e.apply(i,arguments)});i.catch(function(){clearTimeout(n);return r.apply(i,arguments)})})};function a(e){this.constructor.prototype.__proto__=Error.prototype;Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);this.name=this.constructor.name;this.message=e}a.prototype=new Error;a.prototype.constructor=a;o.PromiseTimeoutError=a;t.exports=o},{"./util":357,lodash:70}],332:[function(e,t,i){"use strict";var r=e("assert");var n=e("../cubiql");var o=e("../util");var a=e("inherits");var s=e("lodash");var l=e("measure-query-gen/src/MQG");var u=e("./query");var c=e("./util");var d=e("timsort");var p=i;function f(e){this.type=e}p.Filter=f;function h(e){if(s.isUndefined(e))return e;if(e instanceof v)return y(e);else if(e instanceof b)return w(e);else if(e instanceof C)return E(e);else if(e instanceof S)return T(e);else if(e instanceof g)return m(e);else{throw new Error("Can't clone filter, of unknown type:"+JSON.stringify(e))}}p.cloneFilter=h;a(g,f);function g(e,t,i,r){f.call(this,"MEASURE_QUERY");this.queries=e;this.disjunctive=t;this.byPosition=i;this.byValue=r}p.MeasureQueryFilter=g;function m(e){var t=s.isUndefined(e.byValue)?undefined:s.clone(e.byValue);return new g(e.queries.map(u.cloneMeasureQuery),e.disjunctive,e.byPosition,t)}a(v,f);function v(e,t){f.call(this,"COMPOSITE");r(!t,"disjunctive composite filters not yet supported");this.filters=e;this.is_disjunction=t}p.CompositeFilter=v;function y(e){return new v(e.filters.map(h),e.is_disjunction)}a(b,f);function b(e,t,i,r){f.call(this,"METRIC");this.metric=e;this.valueType=t;this.comparisons=i;this.measureQuery=r}p.MetricFilter=b;function w(e){return new b(e.metric,e.valueType,e.comparisons.map(_),u.cloneMeasureQuery(e.measureQuery))}function C(e,t,i,r){f.call(this,"ATTRIBUTE");this.attribute=e;this.valueType=t;this.comparisons=i;this.measureQuery=r}p.AttributeFilter=C;function E(e){return new C(e.attribute,e.valueType,e.comparisons.map(_),u.cloneMeasureQuery(e.measureQuery))}function S(e,t){f.call(this,"POSITION");this.inter=e;this.relationComparisons=t}p.PositionFilter=S;function T(e){return new S(e.inter,e.relationComparisons)}function x(){}p.Comparison=x;function _(e){if(e instanceof M){return new M(e.comparison,e.name,e.members)}else if(e instanceof A){return new A(e.comparison,e.name,e.inter,e.members)}else if(e instanceof O){return new O}else if(e instanceof I){return new I(e.inter,e.measureName)}else if(e instanceof D){return new D}else{throw new Error("Unknown comparison to clone")}}function M(e,t,i){this.comparison=e;this.name=t;this.members=i;this.members.sort()}a(M,x);p.ParamComparison=M;function A(e,t,i,r){this.comparison=e;this.name=t;this.inter=i;this.members=r;d.sort(this.members)}a(A,x);p.RelationComparison=A;function I(e,t){this.inter=e;this.measureName=t}a(I,x);p.MeasureComparison=I;function O(){}a(O,x);p.PositionComparison=O;function D(){}a(D,x);p.ValueComparison=D;var N={METRIC:"METRIC",ATTRIBUTE:"ATTRIBUTE",COMPOSITE:"COMPOSITE",POSITION:"POSITION",MEASURE_QUERY:"MEASURE_QUERY"};p.FilterType=N;function R(e){r(e.type,"type for filter undefined");return N[e.type]}p.genRelationName=function(e,t){e=e.qualified_level?e:new l.Intersection(e);d.sort(t);var i=o.hashCode(c.stringifyIntersection(e)+JSON.stringify(t));if(i<0)i="neg"+i*-1;return"relation_"+i};p.genParamName=function(e){e.sort();var t=o.hashCode(JSON.stringify(e));if(t<0)t="neg"+t*-1;return"param_"+t};p.conjunctFilters=function(e){if(!e.length)return;if(e.length===1)return e[0];var t=[];e.forEach(function(e){if(e instanceof v&&e.is_disjunction===false){t=[].concat(t,e.filters)}else{t.push(e)}});t=s.uniq(t,c.stringifyQueryFilter);return new v(t,false)};p.concatParamBinding=function(e,t){e=s.isUndefined(e)?[]:e;t=s.isUndefined(t)?[]:t;return s.uniq([].concat(e,t),function(e){return e.param.name})};p.concatRelationBinding=p.concatParamBinding;p.filterToParamBinding=p.filterToRelationBinding=function(e){var t=[],i,r,n;switch(R(e)){case N.POSITION:e.relationComparisons.forEach(function(e){var i=s.unzip(e.members);if(e instanceof A){t=p.concatRelationBinding(t,[new l.RelationBinding(new l.ParamExpr(e.name,e.inter,undefined),new l.LiteralExpr("GENERAL",new l.BaseSignature(e.inter),e.inter.qualified_level.map(function(e,t){return new l.Column(new l.Type("STRING"),i[t])})))])}});break;case N.COMPOSITE:e.filters.forEach(function(e){t=p.concatRelationBinding(t,p.filterToRelationBinding(e))})}return t};function P(e){this.msg=e}function L(e){this.$measureModel=e}p.FilterGenerator=L;L.prototype.$validateMetricFilter=function(e){if(!this.$measureModel.getMeasureInfo(e.metric.name))throw new P("Invalid metric used in filter: "+e.metric.name)};L.prototype.$validateAttributeFilter=function(e){var t=e.attribute.qualifiedLevel,i=n.qlevel.getDimension(t),r=n.qlevel.getLevel(t),o=this.$measureModel.getLevel(i,r),a=o&&this.$measureModel.getLevelAttr(o,e.attribute.name);if(!o){throw new P("Invalid level used in filter: "+n.qualifiedLevelToQualifiedName(t))}else if(!a){throw new P("Invalid level attribute used in filter: "+n.qualifiedLevelToQualifiedName(t)+"."+e.attribute.name)}};L.prototype.$validateFilter=function(e){var t=R(e);switch(t){case N.COMPOSITE:e.filters.forEach(this.$validateFilter.bind(this));break;case N.METRIC:this.$validateMetricFilter(e);break;case N.ATTRIBUTE:this.$validateAttributeFilter(e);break}};L.prototype.$filterToDicers=function(e,t){var i=R(e);r(i===N.METRIC||i===N.ATTRIBUTE||i===N.POSITION,"invalid filter to convert to dicer");switch(i){case N.METRIC:return this.$metricFilterToDicers(e);case N.ATTRIBUTE:return this.$attributeFilterToDicers(e);case N.POSITION:return this.$positionFilterToDicers(e)}};L.prototype.$attributeFilterToDicers=function(e){var t=e.comparisons.filter(function(e){return e instanceof A}),i=e.comparisons.filter(function(e){return e instanceof I}),n=e.comparisons.filter(function(e){return e instanceof O}),o=e.comparisons.filter(function(e){return e instanceof D}),a=e.comparisons.filter(function(e){return e instanceof M}),s=[],d=p.cloneFilter(e);s=[].concat(s,i.map(V));if(o.length){r(e.measureQuery,"Can't have value comparison without a measure query!");r(c.getMeasureValueType(e.attribute,this.$measureModel)==c.getMeasureValueType(e.measureQuery.measure,this.$measureModel),"Can't do value comparison between different types");r(o.length===e.comparisons.length,"ValueComparisons must be the only comparisons in a filter");s.push(u.createMeasureExpr(e.attribute,new l.Intersection(e.attribute.qualifiedLevel),{},this.$measureModel).filterBy(new l.Comparison("=",u.createExprForMeasureQuery(e.measureQuery,this.$measureModel))))}else{if(n.length||e.measureQuery.filter){s.push(u.createExprForMeasureQuery(e.measureQuery,this.$measureModel))}if(a.length){s.push(this.applyFilterToExpr(e.attribute,u.createExprForMeasureQuery(e.measureQuery,this.$measureModel),e))}if(t.length&&e.comparisons.length===t.length){s.push(k(t[0]))}}return s};L.prototype.$metricFilterToDicers=function(e){return[this.applyFilterToExpr(e.metric,u.createExprForMeasureQuery(e.measureQuery,this.$measureModel),e)]};L.prototype.$positionFilterToDicers=function(e){return e.relationComparisons.map(k)};L.prototype.applyFilterToExpr=function(e,t,i){this.$validateFilter(i);if(i instanceof g){t=this.$applyMeasureQueryFilterToExpr(t,i)}else if(i instanceof S){t=this.$applyPositionFilterToExpr(t,i)}else if(e instanceof u.Metric){t=this.$applyFilterToMetric(e,t,i)}else if(e instanceof u.Attribute||e instanceof u.OverriddenAttribute){t=this.$applyFilterToAttribute(e,t,i)}else if(e instanceof u.ConstantTerm){t=this.$applyFilterToConstantTerm(e,t,i)}else if(e instanceof u.FilteredMeasureQuery){t=this.applyFilterToExpr(e.measureQuery.measure,t,i)}return t};L.prototype.$applyMeasureQueryFilterToExpr=function(e,t){r(!t.byValue||!t.byPosition,"byValue and byPosition are exclusive options for a MeasureQueryFilter but both are used on ",t);var i=this,n=t.queries.map(function(e){return u.createExprForMeasureQuery(e,i.$measureModel)});if(t.byValue){return e.filterBy(n.map(function(e){return new l.Comparison(t.byValue.operator,e)}),t.disjunctive)}else if(t.byPosition){return e.diceBy(n,t.disjunctive)}};L.prototype.$mergeAttributeFilters=function(e,t,i){var r=n.getOverlappingLabels(e,i.measureQuery.mappedInter),o=r.length>0,a=i.attribute,s=a.qualifiedLevel,l=t.attribute,u=l.qualifiedLevel,c=n.qlevel.getDimension(a.qualifiedLevel),d=n.qlevel.getLabel(a.qualifiedLevel),f;if(n.qlevel.labelEquals(d)(u)){if(n.qLevelEqual(u,s)){f=p.conjunctFilters([t,i])}else{if(n.qLevelEqual(s,this.$measureModel.findLowestLevel(c,[s,u])))f=i;else f=t}}else if(o){f=p.conjunctFilters([i,t])}return f};L.prototype.applyPositionFilterToMeasureQuery=function(e,t){var i=n.getOverlappingLabels(e.mappedInter,t.inter),r=i.length>0;if(!s.isUndefined(e.filter)){e.filter=p.conjunctFilters([e.filter,t])}else if(r){e.filter=t}};L.prototype.applyAttributeFilterToMeasureQuery=function(e,t){var i=n.getOverlappingLabels(e.mappedInter,t.measureQuery.mappedInter),r=n.qlevel.getLabel(t.attribute.qualifiedLevel),o=i.length>0;if(!s.isUndefined(e.filter)){e.filter=p.conjunctFilters([e.filter,t])}else if(o){e.filter=t}};L.prototype.applyAttributeFilterToFilter=function(e,t,i){var r=this;if(t instanceof C){return this.$mergeAttributeFilters(e,t,i)}else if(t instanceof v){t.filters=t.filters.map(function(t){return r.applyAttributeFilterToFilter(e,t,i)});return t}else if(t instanceof b){this.applyAttributeFilterToMeasureQuery(t.measureQuery,i);return t}};L.prototype.$applyFilterToConstantTerm=function(e,t,i){if(i instanceof v){return this.$applyCompositeFilterToConstantTerm(e,t,i)}else if(i instanceof S){return this.$applyPositionFilterToConstantTerm(t,i)}else if(i instanceof g){return this.$applyMeasureQueryFilterToExpr(t,i)}else{throw new Error("Unknown filter type: "+i)}};L.prototype.$applyCompositeFilterToConstantTerm=function(e,t,i){var r=this;i.filters.forEach(function(i){t=r.$applyFilterToConstantTerm(e,t,i)});return t};L.prototype.$applyPositionFilterToConstantTerm=function(e,t){return this.$applyPositionFilterToExpr(e,t)};L.prototype.$applyFilterToAttribute=function(e,t,i){if(i instanceof b){return this.$applyMetricFilterToAttribute(e,t,i)}else if(i instanceof C){return this.$applyAttributeFilterToAttribute(e,t,i)}else if(i instanceof v){return this.$applyCompositeFilterToAttribute(e,t,i)}else if(i instanceof S){return this.$applyPositionFilterToAttribute(t,i)}};L.prototype.$applyCompositeFilterToAttribute=function(e,t,i){var a=this,s=e.qualifiedLevel&&n.qlevel.getLabel(e.qualifiedLevel),l=o.partition(i.filters,function(t){return a.$isFilterForAttribute(e,t)}),c=l[0],d=l[1],p=u.getIntersectionOfExpr(t,false,this.$measureModel);c.forEach(function(i){t=a.$applyAttributeFilterToAttribute(e,t,i)});d.forEach(function(i){if(i instanceof v){t=a.$applyCompositeFilterToAttribute(e,t,i)}else if(i instanceof b){t=a.$applyMetricFilterToAttribute(e,t,i)}else if(i instanceof S){t=a.$applyPositionFilterToAttribute(t,i)}else if(i instanceof C){t=a.$applyAttributeFilterToAttribute(e,t,i)}else if(i instanceof g){t=a.$applyMeasureQueryFilterToExpr(t,i)}else{r(false,"unhandled filter type")}});return t};L.prototype.$applyPositionFilterToExpr=function(e,t){var i=t.relationComparisons;return e.diceBy(t.relationComparisons.map(k),false)};L.prototype.$applyPositionFilterToAttribute=function(e,t){return this.$applyPositionFilterToExpr(e,t)};L.prototype.$applyMetricFilterToAttribute=function(e,t,i){return t.diceBy(this.$filterToDicers(i),false)};L.prototype.$applyAttributeFilterToAttribute=function(e,t,i){var n=i.comparisons.filter(function(e){return e instanceof M}),o=i.comparisons.filter(function(e){return e instanceof A}),a=i.comparisons.filter(function(e){return e instanceof O}),s=i.comparisons.filter(function(e){return e instanceof D}),d=i.comparisons.filter(function(e){
return e instanceof I});if(o.length>0)t=t.diceBy(o.map(k),false);if(this.$isFilterForAttribute(e,i)){if(n.length>0){t=t.filterBy(F(n,i.valueType.toLowerCase()),false)}else if(d.length>0){t=t.diceBy(this.$filterToDicers(i),false)}else if(a.length>0){t=t.diceBy(this.$filterToDicers(i),false)}else if(s.length){r(c.getMeasureValueType(e,this.$measureModel)==c.getMeasureValueType(i.measureQuery.measure,this.$measureModel),"Can't do value comparison between different types");r(i.measureQuery,"Can't have value comparison without a measure query!");t=t.filterBy(new l.Comparison("=",u.createExprForMeasureQuery(i.measureQuery,this.$measureModel)))}else if(!o.length){throw new Error("Invalid filter for attr: "+JSON.stringify(e))}}else{if(a.length>0||n.length>0||d.length>0||s.length>0){t=t.diceBy(this.$filterToDicers(i),false)}}return t};L.prototype.$isFilterForAttribute=function(e,t){if(e instanceof u.OverriddenAttribute)e=e.attributes[0];return t instanceof C&&t.attribute.name===e.name&&n.qLevelEqual(t.attribute.qualifiedLevel,e.qualifiedLevel,true)};L.prototype.$applyFilterToMetric=function(e,t,i){if(i instanceof b){return this.$applyMetricFilterToMetric(e,t,i)}else if(i instanceof C){return this.$applyAttributeFilterToMetric(e,t,i)}else if(i instanceof v){return this.$applyCompositeFilterToMetric(e,t,i)}else if(i instanceof S){return this.$applyPositionFilterToMetric(t,i)}else{throw new Error("Unknown filter type: "+i)}};L.prototype.$isFilterForMetric=function(e,t){return t instanceof b&&e.name===t.metric.name};L.prototype.$applyCompositeFilterToMetric=function(e,t,i){var r=this,n=o.partition(i.filters,function(t){return r.$isFilterForMetric(e,t)}),a=n[0],s=n[1],l=[];a.forEach(function(i){t=r.$applyMetricFilterToMetric(e,t,i)});s.forEach(function(i){if(i instanceof v){t=r.$applyCompositeFilterToMetric(e,t,i)}else if(i instanceof S){t=r.$applyPositionFilterToMetric(t,i)}else if(i instanceof g){t=r.$applyMeasureQueryFilterToExpr(t,i)}else{l=[].concat(l,r.$filterToDicers(i))}});return t.diceBy(l,false)};L.prototype.$applyPositionFilterToMetric=function(e,t){var i=t.relationComparisons;return e.diceBy(t.relationComparisons.map(k),false)};L.prototype.$applyAttributeFilterToMetric=function(e,t,i){var r,n=i.comparisons.filter(function(e){return e instanceof A}),o=i.comparisons.filter(function(e){return e instanceof M}),a=i.comparisons.filter(function(e){return e instanceof I}),s=i.comparisons.filter(function(e){return e instanceof O}),l=i.comparisons.filter(function(e){return e instanceof D}),c;if(n.length>0)t=t.diceBy(n.map(k),false);if(o.length||a.length||s.length||l.length||i.measureQuery.filter||i.measureQuery.measure instanceof u.FilteredMeasureQuery){c=h(i);c.comparisons=c.comparisons.filter(function(e){return!(e instanceof A||e instanceof M)});t=t.diceBy(this.$filterToDicers(c),false)}return t};L.prototype.$applyMetricFilterToMetric=function(e,t,i){var r,n;if(e.name===i.metric.name){r=i.comparisons.filter(function(e){return e instanceof M});var o=u.createExprForMeasureQuery(i.measureQuery,this.$measureModel);if(c.exprContainsExpr(o,t))t=o;if(r.length>0)t=t.filterBy(F(r,i.valueType.toLowerCase()),false);return t}else{return t.diceBy(this.$filterToDicers(i),false)}};function k(e){r(e instanceof A,"Comparison is not a relation comparison");return new l.ParamExpr(e.name,n.cloneIntersection(e.inter),undefined)}function $(e,t){r(e instanceof M,"Comparison is not a param comparison");return new l.Comparison(e.comparison,new l.ParamExpr(e.name,new l.Intersection([]),new l.Type(t)))}function F(e,t){return e.map(function(e){return $(e,t)})}function V(e){r(e instanceof I,"Comparison is not a measure comparison");return new l.MetricExpr(e.measureName).aggBy("HISTOGRAM",new l.Intersection([])).relabelBy(new l.LabelMap("Bin",e.inter.qualified_level[0].dimension)).drop()}},{"../cubiql":276,"../util":357,"./query":333,"./util":336,assert:2,inherits:41,lodash:70,"measure-query-gen/src/MQG":1,timsort:"timsort"}],333:[function(e,t,i){"use strict";var r=e("assert");var n=e("../cubiql");var o=e("../util");var a=e("inherits");var s=e("lodash");var l=e("./filter");var u=e("./results");var c=e("./util");var d=e("measure-query-gen/src/MQG");var p=t.exports;p.Type={NONE:"NONE",INT:"INT",FLOAT:"FLOAT",DECIMAL:"DECIMAL",STRING:"STRING",NAMED:"NAMED",BOOLEAN:"BOOLEAN"};var f={COLLECT:"COLLECT",AMBIG:"AMBIG",TOTAL:"TOTAL",MIN:"MIN",MAX:"MAX",COUNT:"COUNT",MODE:"MODE",COUNT_DISTINCT:"COUNT_DISTINCT"};var h=function(){var e=Object.keys(f);return{INT:e,FLOAT:e,DECIMAL:e,BOOLEAN:["MIN","MAX","AMBIG","COLLECT"],STRING:["MIN","MAX","AMBIG","COLLECT"],NAMED:["MIN","MAX","MODE","AMBIG","COLLECT"]}}();p.getAggMethod=function(e,t){var i=!s.isUndefined(t.recalc),n=t.agg_method&&t.agg_method,o=e===undefined||e==="undefined"||e==="DEFAULT",a=o?n:e,l,u={},c,d=s.isUndefined(t.type);if(i||d){c="COLLECT"}else{l=t.type.kind;if(s.isString(a)){if(l&&h.hasOwnProperty(l)&&h[l].indexOf(a)!==-1){c=a}}else{c=a}}if(s.isString(c)){u.primitive=c;u.isDefault=n&&c===n.primitive}else if(s.isObject(c)){u.primitive=c.primitive;u.composite=c.composite;u.named=c.named;u.isDefault=n&&o;r(u.named||u.composite||u.primitive,"aggMethod should have either composite or primitive")}u.isDefault=i?false:u.isDefault;u.isRecalc=i;return u};function g(){}p.Measure=g;a(m,g);function m(e){this.name=e.measure.name;this.measureQuery=e}p.FilteredMeasureQuery=m;a(v,g);function v(e){this.measureQueries=e}p.OverriddenMeasureQuery=v;a(y,g);function y(e,t,i){this.qualifiedLevel=e;this.id=t;this.valueType=i}p.FixedLevel=y;a(b,g);function b(e,t){this.name="Constant("+t+") = "+e;this.constantValue=e;this.type=t}p.ConstantTerm=b;a(w,g);function w(e,t,i,r){this.inter=e;this.members=t;this.name=s.isUndefined(i)?l.genRelationName(e,t):i;this.type=r}p.LiteralRelation=w;a(C,g);function C(e){this.name=e}p.Metric=C;a(E,g);p.cloneMetric=function(e){return new C(e.name)};function E(e,t){this.name=e;this.qualifiedLevel=t}p.Attribute=E;a(S,g);function S(e,t){this.childLevel=e;this.parentLevel=t}p.LevelMap=S;a(T,g);function T(e){this.attributes=e;this.name=e[0].name;this.qualifiedLevel=e[0].qualifiedLevel}p.OverriddenAttribute=T;a(x,g);function x(e,t){this.measureQuery=e;this.type=t}p.Cast=x;a(_,g);function _(e,t){this.measureQueries=e;this.name=t}p.Operator=_;a(M,g);function M(e,t,i,r){this.signature=e;this.interArgs=i;this.exprArgs=r;this.abstraction=t}p.Application=M;a(A,g);function A(e,t,i){this.interArgs=t;this.exprArgs=i;this.expr=e}p.Abstraction=A;a(I,g);function I(e){this.str=e}p.StringMeasure=I;p.measuresEqual=function(e,t){if(e instanceof E&&t instanceof E){return e.name===t.name&&n.qLevelEqual(e.qualifiedLevel,t.qualifiedLevel)}else if(e instanceof C&&t instanceof C){return e.name===t.name}else if(e instanceof T&&t instanceof T){return e.attributes.length===t.attributes.length&&e.attributes.every(function(e){return t.attributes.some(function(t){return p.measuresEqual(e,t)})})}return false};p.measureQueriesToServiceQueries=function(e,t){return e.map(function(e){return p.measureQueryToMeasureServiceQuery(e,t)})};p.serviceQueriesToServiceRequest=function(e,t,i){var r=[],n=[],o=[],a=[],f=s.groupBy(e,function(e){return c.stringifyIntersection(e.inter,true)});Object.keys(f).forEach(function(e){var o=s.isUndefined(i)?i:i+"_"+performance.now(),a=f[e],l=p.serviceQueriesToQueryRequest(a,o,t);r.push(l.queryRequest);n.push(l.reportProcessor)});e.forEach(function(e){o=l.concatParamBinding(o,e.params)});e.forEach(function(e){a=l.concatRelationBinding(a,e.relations)});return{request:new d.Request(r,undefined,[].concat(o,a)),responseProcessor:new u.ResponseProcessor(n)}};p.serviceQueriesToQueryRequest=function(e,t,i){t=s.isUndefined(t)?"generatedReport"+performance.now():t;r(e.length>0,"need to pass more than zero serviceQueries to make QueryRequest");var a=e[0].inter,l=o.partition(e,function(e){return e.sourceQuery.measure instanceof y}),p=l[0],f=a.qualified_level.map(function(e){return{qualified_level:e,attribute:"id"}}).filter(function(e){return!p.some(function(e){return n.qLevelEqual(e.sourceQuery.qualifiedLevel,ql)})}),h=l[1].map(function(e){r(n.intersectionEqual(a,e.inter,true),"Somehow service query expression does not match others");return V(e.expr,a,i)});h.forEach(function(e){c.cleanMQGExpr(e)});return{queryRequest:new d.QueryRequest(t,f,h,true),reportProcessor:new u.ReportProcessor(a,[].concat(l[1],p),f)}};p.validateMeasureQuery=function(e,t){if(e.measure instanceof p.OverriddenMeasureQuery){e.measure.measureQueries.forEach(function(i){r(n.intersectionEqual(i.mappedInter,e.mappedInter),"OverriddenMeasureQuery mappedInter must match all underlying measure queries");r(s.isUndefined(e.filter),"an OverriddenMeasureQuery may not have a filter");p.validateMeasureQuery(i,t)})}else if(e.measure instanceof p.FilteredMeasureQuery){p.validateMeasureQuery(e.measure.measureQuery)}};p.queryIsValid=function(e){return!(e.validityMessages&&e.validityMessages.length)};var O=p.metricBaseAboveInter=function(e,t,i){var r=i.getMeasureInfo(e).inter,o=false;t.qualified_level.forEach(function(e){var t=n.qlevel.getLabel(e),a=n.qlevel.getDimension(e),s=r.qualified_level.find(n.qlevel.labelEquals(t));if(!s||!n.qLevelEqual(s,e)&&n.qLevelEqual(i.findHighestLevel(a,[e,s]),s))o=true});return o};function D(e,t){return O(e.measure.name,e.inter,t)}p.createExprForMeasureQuery=function(e,t){p.validateMeasureQuery(e,t);e.inter=n.cloneIntersection(e.inter);e.mappedInter=n.cloneIntersection(e.mappedInter);var i=p.createMeasureExpr(e.measure,e.inter,e.interLabelMap,e.aggMethodLookup,t),r=new l.FilterGenerator(t);if(!i)return;if(e.constrainByAncestor)i=k(i,t);if(e.filter){i=r.applyFilterToExpr(e.measure,i,e.filter)}i=p.moveExprToQueryInter(i,e.mappedInter,e.labelMap,e.aggMethodLookup,t);return i};p.measureQueryToMeasureServiceQuery=function(e,t){var i={sourceQuery:e,inter:e.mappedInter,params:[],relations:[]},r=R(e),o;i.expr=p.createExprForMeasureQuery(e,t);r.forEach(function(e){i.relations=[].concat(i.relations,l.filterToRelationBinding(e))});o=P(e);o.forEach(function(e){var t=s.unzip(e.members),r=e.type,o=r&&n.getParser(r),a=r&&new d.Column(r,t[e.inter.qualified_level.length].map(o)),l=[].concat(e.inter.qualified_level.map(function(e,i){return new d.Column("STRING",t[i])}),a?[a]:[]),u=r?new d.ValueType("SINGLETON",new d.Type(e.type)):undefined;i.relations.push(new d.RelationBinding(new d.ParamExpr(e.name,e.inter,e.type),new d.LiteralExpr("GENERAL",new d.BaseSignature(e.inter,u),l)))});return i};function N(e){var t=[];e.filters.forEach(function(e){if(e instanceof l.CompositeFilter){t=t.concat(N(e))}else{t.push(e)}});return t}function R(e){var t=[];if(!e)return t;if(e.filter){if(e.filter instanceof l.CompositeFilter){N(e.filter).forEach(function(i){t.push(e.filter);t=[].concat(t,R(i.measureQuery))})}else{t.push(e.filter);t=[].concat(t,R(e.filter.measureQuery))}}if(e.measure instanceof m)t=[].concat(t,R(e.measure.measureQuery));if(e.measure instanceof v)t=[].concat(t,s.flatten(e.measure.measureQueries.map(R)));if(e.measure instanceof x)t=[].concat(t,R(e.measure.measureQuery));if(e.measure instanceof _)t=[].concat(t,s.flatten(e.measure.measureQueries.map(R)));return t}function P(e){var t=[];if(!e)return t;if(e.measure instanceof w)t.push(e.measure);if(e.filter)t=[].concat(t,L(e.filter));if(e.measure instanceof m)t=[].concat(t,P(e.measure.measureQuery));if(e.measure instanceof v)t=[].concat(t,s.flatten(e.measure.measureQueries.map(P)));if(e.measure instanceof x)t=[].concat(t,P(e.measure.measureQuery));if(e.measure instanceof _)t=[].concat(t,s.flatten(e.measure.measureQueries.map(P)));return t}function L(e){var t=[];if(!e)return t;if(e.measureQuery){t=[].concat(t,P(e.measureQuery))}else if(e instanceof l.CompositeFilter){e.filters.forEach(function(e){t=[].concat(t,L(e))})}else if(e instanceof l.MeasureQueryFilter){e.queries.forEach(function(e){t=[].concat(t,P(e))})}return t}p.getCoreMeasure=function(e){if(e instanceof m){return p.getCoreMeasure(e.measureQuery.measure)}else if(e instanceof v){return p.getCoreMeasure(e.measureQueries[0].measure)}else{return e}};p.moveExprToQueryInter=function(e,t,i,r,o){var a=p.getIntersectionOfExpr(e,false,o),s=p.applyLabelMapToIntersection(i,a),l=s.qualified_level.filter(function(e){var i=n.qlevel.getLabel(e);return t.qualified_level.some(n.qlevel.labelEquals(i))}),u=p.calcBaseIntersection(l,o),c=[],f;a.qualified_level.forEach(function(e){var r=n.qlevel.getLabel(e),o=i[r]||r,a=u.qualified_level.filter(n.qlevel.labelEquals(o)),s,l;if(a.length>0&&n.qLevelEqual(e,a[0])){s=t.qualified_level.find(function(e){return e.label===a[0].label});if(s){l=n.cloneQualifiedLevel(e);l.level=s.level;c.push(l)}else{c.push(e)}}});f=new d.Intersection(c);e=p.explicitAggExpr(e,f,r,o);e=p.applyLabelMapToExpr(i,e,o);e=V(e,t,o);return e};function k(e,t){var i=p.getIntersectionOfExpr(e,false,t),o=s.groupBy(i.qualified_level,"dimension"),a=Object.keys(o).filter(function(e){return o[e].length>1}),l;l=a.map(function(e){var i=o[e];r(i.length===2,"Only support ancestor constraints for exactly 2 levels currently");i=n.sortQualifiedLevelsByHierarchy(i,t);return new d.Ancestor(e,n.qlevel.getLevel(i[0]),n.qlevel.getLevel(i[1]),"tempChildLabel",n.qlevel.getLabel(i[1])).relabelBy([new d.LabelMap("tempChildLabel",n.qlevel.getLabel(i[0]))])});if(l.length>0)return e.diceBy(l,false);else return e}p.createMeasureExpr=function(e,t,i,r,n){if(e instanceof C){return p.createMetricExpr(e,t,i,r,n)}else if(e instanceof T){return p.createOverriddenAttributeExpr(e,t,i,n)}else if(e instanceof E){return p.createAttributeExpr(e.name,e.qualifiedLevel,t,i,n)}else if(e instanceof b){return p.createConstantTermExpr(e,t)}else if(e instanceof w){return p.createLiteralRelationExpr(e)}else if(e instanceof y){return p.createFixedLevelExpr(e)}else if(e instanceof S){return p.createLevelMapExpr(e,n)}else if(e instanceof m){return p.createFilteredMeasureQueryExpr(e,t,i,r,n)}else if(e instanceof v){return p.createOverriddenMeasureQueryExpr(e,n)}else if(e instanceof x){return p.createCastExpr(e,t,r,n)}else if(e instanceof _){return p.createOperatorExpr(e,t,r,n)}else if(e instanceof M){return p.createApplicationExpr(e,n)}else{throw new Error("can't create measure expr")}};p.createFilteredMeasureQueryExpr=function(e,t,i,n,o){var a=e.measureQuery,s=p.createExprForMeasureQuery(a,o),l=p.getCoreMeasure(a.measure),u,c=false;if(l instanceof C){u=o.getMeasureInfo(l.name);c=u.recalc;if(s instanceof d.AppExpr){s=s.application.abstraction}r(!c||s instanceof d.MetricExpr||s instanceof d.RelabelExpr,"Not possible to aggregate multiple nested levels of filter queries for recalcs.")}return p.aggAndRelabelExpr(s,t,i,n,c,o)};p.createOverriddenMeasureQueryExpr=function(e,t){var i=e.measureQueries.map(function(e){return p.createExprForMeasureQuery(e,t)});return new(Function.prototype.bind.apply(d.OverrideExpr,[null].concat(i)))};p.createLevelMapExpr=function(e,t){var i=new d.AttributeExpr(e.parentLevel,"id");return V(i,new d.Intersection(e.childLevel),t)};p.createFixedLevelExpr=function(e){return undefined};p.createConstantTermExpr=function(e,t){var i=new d.ConstantExpr(e.constantValue,e.type);if(t)i=i.widenBy(t);return i};p.createLiteralRelationExpr=function(e){return new d.ParamExpr(e.name,n.cloneIntersection(e.inter),e.type)};p.createAbstractionExpr=function(e,t){r(e.expr instanceof I,"Only support string measures in abstractions currently");return new d.AbsExpr(e.interArgs,e.exprArgs,p.createStringMeasureExpr(e.expr))};p.createStringMeasureExpr=function(e){return new d.Expr(undefined,undefined,e.str)};p.createApplicationExpr=function(e,t){var i=new d.AppExpr(p.createAbstractionExpr(e.abstraction,t),e.interArgs,e.exprArgs);i.$signature=e.signature;return i};function $(e){var t=[],i=[];e=e||{};Object.keys(e).forEach(function(r){var n=e[r].slice();if(!n.length)return;if(n.indexOf(r)===-1){t.push(new d.LabelMap(r,n[0]));r=n[0];n=n.slice(1,n.length)}if(n.length){n.forEach(function(e){if(e!==r)i.push(new d.LabelMap(r,e))})}});return{relabelMaps:t,splitMaps:i}}p.generateRelabelsAndSplits=$;function F(e,t,i){if(t.length)e=e.relabelBy(t);if(i.length)e=new d.SplitExpr(e,i);return e}p.aggAndRelabelExpr=function(e,t,i,o,a,s){var l=$(i),u=l.relabelMaps,f=l.splitMaps;if(!a){e=F(e,u,f);e=p.explicitAggExpr(e,t,o,s)}else{r(!f.length,"Recalc exprs "+c.stringifyExpr(e)+" cannot be used in a split-dimension query.");if(e instanceof d.RelabelExpr){var h=e.relabel.map,g=t.qualified_level&&t.qualified_level.map(function(e){h.forEach(function(t){if(e.label===t.target){e=n.relabelQL(e,t.source)}});return e});e.relabel.expr.application.inter_arg=[new d.InterArgument("inter",new d.Intersection(g))]}else{e=new d.AppExpr(e,new d.InterArgument("inter",new d.Intersection(t.qualified_level.map(function(e){var t=n.qlevel.getLabel(e),i=u.find(function(e){return e.target===t});if(i)return n.relabelQL(e,i.source);else return e}))))}if(u.length)e=e.relabelBy(u)}return V(e,t,s)};p.createMetricExpr=function(e,t,i,r,n){var o=n.getMeasureInfo(e.name),a=new d.MetricExpr(e.name),s=o.recalc;return p.aggAndRelabelExpr(a,t,i,r,s,n)};function V(e,t,i){t=n.cloneIntersection(t);var r=p.getIntersectionOfExpr(e,false,i),o=r.qualified_level.map(n.qlevel.getLabel),a=t.qualified_level.map(n.qlevel.getLabel),s=o.filter(function(e){return a.indexOf(e)===-1});if(s.length>0){r=new d.Intersection(r.qualified_level.filter(function(e){return s.indexOf(n.qlevel.getLabel(e))===-1}));e=e.aggBy("COLLECT",r)}if(!n.intersectionEqual(r,t,true)){e=e.widenBy(t)}return e}p.aggMethodToMQGAggMethod=function(e){if(s.isObject(e)){return s.pick(e,["primitive","named","composite","header_sort_level"])}else if(s.isString(e)){return{primitive:e}}else{throw new Error("Invalid aggMethod: "+e)}};p.explicitAggExpr=function(e,t,i,o){var a=p.getIntersectionOfExpr(e,false,o);if(n.intersectionEqual(a,t,true,true))return e;var l=n.cloneIntersection(a),u;var c=s.groupBy(a.qualified_level,function(e){var t=i[n.qlevel.getLabel(e)];return t?t.primitive||JSON.stringify(t):"COLLECT"});s.forEach(c,function(a,s){var c=i[n.qlevel.getLabel(a[0])]||s,d=p.aggMethodToMQGAggMethod(c);u=l;a.forEach(function(e){var i=n.qlevel.getLabel(e),r=t.qualified_level.filter(n.qlevel.labelEquals(i)),a=r.length>0,s=a?r[0]:undefined,l=n.qlevel.getDimension(e),d=a&&n.qLevelEqual(o.findHighestLevel(l,[e,s]),s);if(!a){u=n.projectLabelFromIntersection(u,i)}else if(d){if(c.hierarchy&&c.label===i){r=r.map(function(e){var t=n.cloneQualifiedLevel(e);t.hierarchy=c.hierarchy;return t})}u=n.stepIntersectionToLevels(u,[r[0]])}});if(!n.intersectionEqual(u,l,true)){r(!(d&&d.composite),"Explicit aggregation using composite aggregations is not currently supported. Only default composite aggregations are supported.");e=e.aggBy(d,u);l=u}});return e};p.createAttributeExpr=function(e,t,i,r,o){var a=new d.QualifiedLevel(t.dimension,t.level,t.hierarchy),l=new d.AttributeExpr(a,e),u,c=[];if(r){s.forEach(r,function(e,t){c.push(new d.LabelMap(t,e[0]))});if(!s.isUndefined(t.label)&&t.dimension!==t.label&&!c.some(function(e){return e.source===t.dimension}))c.push(new d.LabelMap(t.dimension,t.label));if(c.length)l=l.relabelBy(c)}u=p.getIntersectionOfExpr(l,false,o);if(i&&!n.intersectionEqual(u,i,true,true)){l=V(l,i,o)}return l};p.createCastExpr=function(e,t,i,r){return new d.CastExpr(p.createExprForMeasureQuery(e.measureQuery,r),new d.Type(e.type))};p.createOperatorExpr=function(e,t,i,n){var o=e.name,a=e.measureQueries.map(function(e){return p.createExprForMeasureQuery(e,n)});r(n.getOperator(o),"Operator with name: "+o+" not found in measure model.");return new d.OpExpr("NAMED",a,o)};p.createOverriddenAttributeExpr=function(e,t,i,r){var n=e.attributes.map(function(e){return p.createAttributeExpr(e.name,e.qualifiedLevel,t,i,r)});var o=new(Function.prototype.bind.apply(d.OverrideExpr,[null].concat(n)));return o};p.calcBaseIntersection=function(e,t){var i=n.getSortedQualifiedLevelsGroupedByLabel(e,t);return new d.Intersection(s.compact(Object.keys(i).map(function(e){return i[e][0]})))};p.applyLabelMapToIntersection=function(e,t){var i=n.cloneIntersection(t);s.forIn(e,function(e,t){i.qualified_level.filter(n.qlevel.labelEquals(t)).forEach(function(t){t.label=e})});return i};p.reverseMultiLabelMapOnIntersection=function(e,t){var i=p.getMQGLabelMapsFromMultiLabelMap(e),o=i.relabels;r(i.splits.length===0,"Can't reverse a split because it produces an illegal intersection");return new d.Intersection(t.qualified_level.map(function(e){var t=n.qlevel.getLabel(e),i=o.find(function(e){return e.target==t});return i?n.relabelQL(e,i.source):n.cloneQualifiedLevel(e)}))};p.getMQGLabelMapsFromMultiLabelMap=function(e){return s.chain(e).reduce(function(e,t,i){if(t.length===1){e.relabels.push(new d.LabelMap(i,t[0]))}if(t.length>1){e.splits=e.splits.concat(t.filter(function(e){return e!==i}).map(function(e){return new d.LabelMap(i,e)}))}return e},{relabels:[],splits:[]}).value()};p.applyMultiLabelMapToIntersection=function(e,t){var i=p.getMQGLabelMapsFromMultiLabelMap(e);return p.calculateSplitIntersection(p.calculateRelabelIntersection(t,i.relabels),i.splits)};p.applyLabelMapToExpr=function(e,t,i){e=e||{};var r=p.getIntersectionOfExpr(t,false,i),o=Object.keys(e).map(function(t){var i=e[t];return new d.LabelMap(t,i)}).filter(function(e){return r.qualified_level.some(n.qlevel.labelEquals(e.source))&&e.source!==e.target});if(o.length>0)return t.relabelBy(o);else return t};p.cloneMeasureQuery=function(e){return{label:e.label,measure:e.measure,inter:e.inter,interLabelMap:e.interLabelMap,validityMessages:e.validityMessages,aggMethodLookup:e.aggMethodLookup,filter:l.cloneFilter(e.filter),constrainByAncestor:e.constrainByAncestor,sortConfig:e.sortConfig,mappedInter:e.mappedInter,labelMap:e.labelMap,functionalQuery:e.functionalQuery}};function q(e,t){var i=new d.Intersection([]);t.qualified_level.forEach(function(t){var r=e.qualified_level.filter(n.qlevel.labelEquals(n.qlevel.getLabel(t)));i.qualified_level=i.qualified_level.concat(r)});return i}p.getIntersectionOfExpr=function(e,t,i){var o=e.kind,a,l,u,c;t=s.isUndefined(t)?false:t;if(t)r(i,"measure model must be passed to getIntersectionOfExpr if ordered is true");r(!s.isUndefined(o),"Expected expression to have attribute kind, make sure you are passing an MQG.Expr");r(o!=="COND","CondExpr not yet supported by getIntersectionOfExpr");switch(o){case"DEMOTE":u=p.getIntersectionOfExpr(e.demote.expr,t,i);r(u,"unable to find original intersection for DemoteExpr");a=H(u,e.demote);break;case"ATTRIBUTE":a=new d.Intersection(e.attribute.qualified_level);break;case"FILTER":a=p.getIntersectionOfExpr(e.filter.expr,t,i);break;case"DICE":a=p.getIntersectionOfExpr(e.dice.expr,t,i);break;case"CAST":a=p.getIntersectionOfExpr(e.cast.expr,t,i);break;case"OP":a=p.getIntersectionOfExpr(e.op.expr[0],t,i);break;case"DROP":a=p.getIntersectionOfExpr(e.drop.expr,t,i);break;case"DIFFERENCE":a=p.getIntersectionOfExpr(e.difference.left,t,i);break;case"AGGREGATION":r(!s.isUndefined(e.aggregation.inter),"getIntersectionOfExpr does not support AggExprs that use Grouping yet");a=e.aggregation.inter;break;case"METRIC":r(e.metric.inter||i,"measure model must be passed to getIntersectionOfExpr for a MetricExpr");a=e.metric.inter||i.getMeasureInfo(e.metric.name).inter;if(t){c=i.getMeasureInfo(e.metric.name).inter;a=q(a,c)}break;case"WIDEN":a=e.widen.inter;if(t){c=p.getIntersectionOfExpr(e.widen.expr,t,i);if(n.isDimensionalSubset(a,c)){a=q(a,c)}else{n.sortIntersectionByLabel(a)}}break;case"PARAM":a=e.param.signature.intersection;break;case"OVERRIDE":a=e.override.expr.length>0?p.getIntersectionOfExpr(e.override.expr[0],t,i):undefined;break;case"COMPOSITE":a=e.composite.expr.length>0?p.getIntersectionOfExpr(e.intersection.expr[0],t,i):undefined;break;case"SPLIT":u=p.getIntersectionOfExpr(e.split.expr,t,i);r(u,"unable to find original intersection for SplitExpr");a=Q(u,e.split.map);if(t)n.sortIntersectionByLabel(a);break;case"RELABEL":u=p.getIntersectionOfExpr(e.relabel.expr,t,i);r(u,"unable to find original intersection for RelabelExpr");a=K(u,e.relabel.map);break;case"SPREAD":a=e.spread.inter;break;case"REMOVE":a=e.remove.inter;break;case"TERM":a=new d.Intersection([]);break;case"APPLICATION":if(e.$signature){a=e.$signature.intersection}else{l=e.application.inter_arg[0];if(!s.isUndefined(l)){a=l.inter}else{a=p.getIntersectionOfExpr(e.application.abstraction,t,i)}}break;case"LITERAL":a=e.literal.signature.intersection;break;default:throw new Error("Unable to find intersection of Expr of kind '"+o+"'")}if(s.isUndefined(a)){console.error("failed to find intersection for expr");console.error(e)}if(a&&s.isUndefined(a.qualified_level))a=new d.Intersection(a);return n.cloneIntersection(a)};function H(e,t){r(t.label||t.dimension,"Demote has no label or dimension");var i=e.qualified_level.filter(function(e){if(t.label&&n.qlevel.getLabel(e)===t.label){return false}else if(t.dimension&&n.qlevel.getDimension(e)===t.dimension){return false}else{return true}});return new d.Intersection(i)}p.isAtLegalEditPosition=function(e,t){if(e.measure instanceof C){return!D(e,t)&&(U(e,t)||B(e,t)||W(e,t))}else{return true}};function U(e,t){return n.intersectionEqual(t.getMeasureInfo(e.measure.name).inter,e.inter,true,true)}function B(e,t){var i=t.getMeasureInfo(e.measure.name).update_method;return!!i}function z(e,t){var i=t.getMeasureInfo(e.measure.name),r=i.agg_method,n=j(i,t);return!!r&&(!!r.primitive||!!n&&G(i,t,e.inter)||!n&&!!r.named)}function j(e,t){var i=e.agg_method&&t.getAggregation(e.agg_method.named),r=i&&i.has("method")&&i.get("method").get("composite");return e.agg_method&&r}function G(e,t,i){var r=e.inter,o,a,s,l,u,c;if(!e||!e.agg_method||!e.agg_method.named){return false}if(e.agg_method.named){o=j(e,t)}for(a=0;a<r.qualified_level.length;++a){l=n.qlevel.getDimension(r.qualified_level[a]);u=n.qlevel.getLabel(r.qualified_level[a]);s=o.toJS().find(n.qlevel.labelEquals(u));if(!s){c=i.qualified_level.find(n.qlevel.labelEquals(u));if(!c||!n.qLevelEqual(r.qualified_level[a],c)){return false}}}return true}function W(e,t){return!!t.getMeasureInfo(e.measure.name).recalc}function Q(e,t){var i=[],o=function(e){return s.map(t.filter(function(t){return t.source===e}),"target")};e.qualified_level.forEach(function(e){var t=n.qlevel.getLabel(e),a=o(t);a.forEach(function(o){r(o!==t,"SplitExprs should not split to the source label as this is already implifed");i.push(n.relabelQL(e,o))});i.push(e)});return new d.Intersection(i)}p.calculateSplitIntersection=Q;function K(e,t){var i=[],o=function(e){return s.map(t.filter(function(t){return t.source===e}),"target")};e.qualified_level.forEach(function(e){var t=n.qlevel.getLabel(e),a=o(t);r(a.length<2,"A relabel should only have one target for a given label");if(a.length>0)i.push(n.relabelQL(e,a[0]));else i.push(e)});return new d.Intersection(i)}p.calculateRelabelIntersection=K},{"../cubiql":276,"../util":357,"./filter":332,"./results":334,"./util":336,assert:2,inherits:41,lodash:70,"measure-query-gen/src/MQG":1}],334:[function(e,t,i){"use strict";var r=e("assert");var n=e("../cubiql");var o=e("lodash");var a=e("./util");var s=e("./query");var l=e("../util");var u=e("measure-query-gen/src/MQG");var c=e("../constant").SORT;var d=i;var p=l.getComparator(true);var f=l.getComparator();function h(e){return e.sourceQuery.measure instanceof s.FixedLevel}function g(e,t,i,r){this.$inter=e;this.$queries=o.reject(t,h);this.$fixedQueries=t.filter(h);this.$keyRequests=i;this.$sortConfig=r}g.prototype.$getKeyRows=function(e){var t=[];if(this.$inter.qualified_level.length>0&&e.report_column[0].int_column.value)t=e.report_column[0].int_column.value;return t};g.prototype.$getFixedLevelQuery=function(e){var t=this.$fixedQueries.find(function(t){return t.sourceQuery.measure instanceof s.FixedLevel&&n.qLevelEqual(t.sourceQuery.measure.qualifiedLevel,e)});if(t)return t};g.prototype.$getFixedLevelMember=function(e){var t=this.$getFixedLevelQuery(e);if(t)return t.sourceQuery.measure.id};g.prototype.$queryIndexToColumnIndices=function(e){var t=this.$keyRequests.length*2,i=e;if(i>=0){this.$queries.forEach(function(e,r){if(r<i&&m(e.sourceQuery)&&e.sourceQuery.mappedInter.qualified_level.length>0)t--})}return{rowsIdx:e*2+t,valuesIdx:e*2+1+t}};g.prototype.getAttributeIndex=function(e,t,i){var r=-1;if(n.intersectionEqual(i,this.$inter,true)){this.$queries.some(function(i,o){var a=i.sourceQuery.measure,l;if(a instanceof s.OverriddenAttribute){l=a.attributes[0];if(l.name===e&&n.qLevelEqual(t,l.qualifiedLevel)){r=o;return true}}else if(a.name===e&&n.qLevelEqual(t,a.qualifiedLevel)){r=o;return true}return false})}return r};g.prototype.getMetricIndex=function(e,t){var i=-1;if(t&&n.intersectionEqual(t,this.$inter,true)){this.$queries.forEach(function(t,r){if(t.sourceQuery.measure.name===e)i=r})}return i};g.prototype.hasMetric=function(e,t){return this.getMetricIndex(e,t)>-1};g.prototype.getMetricValues=function(e,t,i){var r=this.getMetricIndex(e,t),o,a;if(r>-1){o=this.$queryIndexToColumnIndices(r);a=n.getValueColumn(i.report_column[o.valuesIdx]);return a.value||[]}};g.prototype.getAttributeValues=function(e,t,i,r){if(this.$getFixedLevelMember(t))return this.$getFixedLevelColumn(t,r).values;var a=this.getAttributeIndex(e,t,i),s=this.$queryIndexToColumnIndices(a),l=r.report_column[s.valuesIdx],u;if(a>-1&&!o.isUndefined(l)){u=n.getValueColumn(l);return u.value||[]}};g.prototype.$createLiteralRelationValueColumn=function(e,t){if(!e)return e;var i=[];if(this.$inter.qualified_level.length===0){i=n.getValueColumn(t.relations[0].relation.column[0]).value}else{e.forEach(function(e){i.push(1)})}return i};function m(e){return e.measure instanceof s.LiteralRelation||e.measure instanceof s.FilteredMeasureQuery&&m(e.measure.measureQuery)}g.prototype.getResultColumn=function(e,t,i){i=o.isUndefined(i)?false:i;var a=this.$queryIndexToColumnIndices(e),s=a.rowsIdx,l=a.valuesIdx,u=m(this.$queries[e].sourceQuery);r(t.report_column[s],"Report did not have expected column at index: "+s);r(t.report_column[l]||u,"Report did not have expected column at index: "+l);var c=n.getValueColumn(t.report_column[s]).value,d=u?this.$createLiteralRelationValueColumn(c,this.$queries[e]):n.getValueColumn(t.report_column[l]).value,p=u?"INT":n.getColumnValueType(t.report_column[l]),f=[],h=this.$queries[e];return{rows:c||[],values:d||[],valueType:p,sourceQuery:h}};g.prototype.$getFixedLevelColumn=function(e,t){var i=this.$getFixedLevelMember(e),r,n,a;if(i){r=this.$getKeyRows(t);n=r.map(o.constant(i));a=this.$getFixedLevelQuery(e).sourceQuery;return{rows:r,values:n,valueType:a.measure.valueType,sourceQuery:a}}};g.prototype.getKeyColumn=function(e,t){var i=this.$inter,r=i.qualified_level.findIndex(n.qlevel.qLevelEqual(e)),o=r*2,a=r*2+1,l=n.getValueColumn(t.report_column[o]).value,u=n.getValueColumn(t.report_column[a]).value,c=n.getColumnValueType(t.report_column[a]);return{rows:l||[],values:u||[],valueType:c,sourceQuery:this.$queries.find(function(t){var i=t.sourceQuery.measure;return i instanceof s.Attribute&&i.name==="id"&&n.qLevelEqual(e,i.qualifiedLevel)})}};g.prototype.getResultColumnForMeasureQuery=function(e,t){var i,r;if(e.measure instanceof s.FixedLevel){r=this.$getFixedLevelColumn(e.measure.qualifiedLevel,t)}else{i=this.$queries.findIndex(function(t){return a.measureQueriesEqual(t.sourceQuery,e)});if(!o.isUndefined(i))r=this.getResultColumn(i,t,false)}if(o.isUndefined(r)){console.log(e);throw new Error("Couldn't find column for query: "+e)}return r};g.prototype.getColumns=function(e){var t=this;return[].concat(this.$inter.qualified_level.map(function(i){return t.$getFixedLevelColumn(i,e)}).filter(o.identity),this.$queries.map(function(i,r){return t.getResultColumn(r,e,false)}))};d.ReportProcessor=g;function v(e){this.$reportProcessors=e}v.prototype.getColumnByLabel=function(e,t){var i=[];this.$reportProcessors.forEach(function(r,n){var o=t.report[n],a=r.getColumnByLabel(e,o);if(a)i.push(a)});r(i.length<2,"More than one column found for label: '"+e+"'");if(i.length===1)return i[0]};v.prototype.getMetricValues=function(e,t,i){var r=i.report,n=r.length,o=0,a;for(;o<n;o++){a=this.$reportProcessors[o].getMetricValues(e,t,r[o]);
if(a)return a}};v.prototype.getResultColumnForMeasureQuery=function(e,t){var i=e.mappedInter,r=this.$getReportInfoForInter(i,t),n=r.processor,o=r.report;return n.getResultColumnForMeasureQuery(e,o)};v.prototype.getMeasureQueryAsTable=function(e,t,i){var r=this.getResultColumnForMeasureQuery(e,t),n=this.$getReportInfoForInter(e.mappedInter,t),a=e.mappedInter.qualified_level.map(function(e){return n.processor.getKeyColumn(e,n.report)}),s=a.length,l=d.getColumnsAsRows(a,r,false),u=e.functionalQuery,c;if(u){for(c=0;c<l.length;++c){if(o.isArray(l[c][s])){l[c][s]=l[c][s][0]}}}if(i){l.sort(function(e,t){var i=0,r,n;for(;i<s;i++){r=e[i];n=t[i];if(r<n)return-1;else if(r>n)return 1}return 0})}return d.createResultTableForQuery(e,l)};d.createResultTableForQuery=function(e,t){return{columnInfo:[].concat(e.mappedInter.qualified_level,[e]),dataTable:t}};v.prototype.$getReportIndexForInter=function(e){var t=[],i=[];this.$reportProcessors.forEach(function(r,o){if(n.intersectionEqual(r.$queries[0].sourceQuery.mappedInter,e,true,true,true)){t.push(r);i.push(o)}});if(t.length>0){r(t.length===1,"too many processors match!");return i[0]}else{console.warn("Could not find report processor for "+JSON.stringify(e));return-1}};v.prototype.$getReportInfoForInter=function(e,t){var i=this.$getReportIndexForInter(e,t);return{processor:this.$reportProcessors[i],report:t.report[i]}};v.prototype.getMetricForKeys=function(e,t,i,n){var a=this.$getReportInfoForInter(t,n),s=a.processor,l=a.report,u,c=[],d,p,f,h,g;r(s,"no processor found!");u=s.getMetricColumn(e,t,l);g=u.valueType;if(t.qualified_level.length===0){f=u.rows[0];h=u.values[0]}else{p=t.qualified_level.map(function(e){return s.getAttributeColumn("id",e,t,l)});p.forEach(function(e,t){var r=e.values,n=i[t],a=-1;if(o.isUndefined(r)||r.length===0){c=[];return}if(t===0){while(true){a=r.indexOf(n,a+1);if(a>-1)c.push(a);else break}}else{c=c.filter(function(e){return r[e]===n})}});d=c.map(function(e){return p[0].rows[e]});r(d.length<=1,"too many results for "+e+" for keys: "+i);if(u&&d.length>0){f=d[0];h=u.values[u.rows.indexOf(f)]}}return{row:f,value:h,valueType:g}};v.prototype.getAttributeValues=function(e,t,i,n){var o=this.$getReportInfoForInter(i,n),a=o.processor,s=o.report,l;r(a,"no processor found!");l=a.getAttributeValues(e,t,i,s);r(l,"Response has no values for "+e+" for "+t);return l};v.prototype.getAttributeColumn=function(e,t,i,r){var n=this.$getReportInfoForInter(i,r),o=n.processor,a=n.report;return o.getAttributeColumn(e,t,i,a)};v.prototype.getResultTables=function(e){var t=this;if(o.isUndefined(e.report)){return[]}else{return e.report.map(function(e,i){var n=t.$reportProcessors[i];r(!o.isUndefined(n),"For some reason no processor found for report index: "+i);return n.getColumns(e)})}};v.prototype.getSortColumn=function(e,t){var i=this.$getReportInfoForInter(e,t),r=i.processor,n=i.report;return r.getSortColumn(n)};d.ResponseProcessor=v;function y(e){return new u.Intersection(e.columnInfo.filter(function(e){return e.dimension&&e.level}))}d.unionResultTables=function(e,t,i,a){t=t||[];i=i||[];a=a||[];t.forEach(function(e){r(a.indexOf(e.tableIdx)===-1,"Can't hide sort table indices in a result table currently")});r(e.length>0,"Attempting to union empty list of resultTables");var s=y(e[0]),l=o.map(e,"dataTable"),u=a.length>0,d=l.length,h=s.qualified_level.length,g=i.length,m=h+d,v=Math.max.apply(null,o.compact(o.map(l,"length"))),b=e.map(function(){return 0}),w=g?function(e){var t=0;for(;t<g;t++)if(e.indexOf(i[t])===-1)return false;return true}:function(e){return true},C=function(e){return l[e][b[e]][h]},E=function(e,t){var i=0,r=0,n,o,s=new Array(m);for(;i<h;i++){s[i]=e[i]}for(;r<t.length;r++){n=t[r];o=n+h;if(!u||a.indexOf(o)===-1)s[o]=C(n);b[n]++}if(w(t))return s},S=function(e,t){if(t===undefined)return-1;var i=0;for(;i<h;i++){if(e[i]<t[i])return-1;else if(e[i]>t[i])return 1}return 0},T=0,x,_,M,A,I,O,D=[],N=[].concat(s.qualified_level.map(function(t,i){return e[0].columnInfo[i]}),e.map(function(e,t){return e.columnInfo[h]})),R;r(e.every(function(e){return n.intersectionEqual(s,y(e))}),"All ResultTables must match the intersection of the first!");for(;T<v;T++){I=0;_=undefined;M=[];for(;I<d;I++){x=l[I][b[I]];if(!x||o.isUndefined(x[h]))continue;A=S(x,_);if(A===0){M.push(I)}else if(A<0){M=[I];_=x}}if(_){O=E(_,M);if(O)D.push(O)}}if(D.length&&t.length){R=t.map(function(e){var t=h+e.tableIdx,i=e.direction===c.ASCENDING,r=e.valueType==="FLOAT"||e.valueType==="DECIMAL"||e.valueType==="INT";return function(e,n){var o=(i?e:n)[t],a=(i?n:e)[t];return r?p(o,a):f(o,a)}});D.sort(function(e,t){var i=0,r=0;while(i<R.length){r=R[i++](e,t);if(r!==0){return r}}return r})}return{columnInfo:N,dataTable:D}};d.getColumnsAsRows=function(e,t,i){var r=[].concat(e,[t]),n=r.map(function(){return 0}),a=o.isUndefined(i)||i===false,s=o.map(r,"values"),l=r.map(function(e,t){return t}),u=l.filter(function(e){return s[e]&&s[e].length>0}),c,d,p,f=r.map(function(e,t){if(u.indexOf(t)===-1){return function(){return undefined}}else{var i=r[t].values,o=r[t].rows,s=n[t],l=o[s],f=function(){s++;l=o[s]};return function(e){var t;if(e===l){t=i[s];c=e;p=true;f()}else if(a){d=true}return t}}}),h=u.map(function(e){return r[e].rows[0]}),g=u.map(function(e){return r[e].rows[s[e].length-1]}),m=Math.min.apply(Math,h),v=Math.max.apply(Math,g),y=[],b,w=[],C=e.length,E,S,T;for(b=m;b<=v;b++){y=[];S=[];if(a)d=false;for(E=0;E<C;E++){y.push(f[E](b))}do{p=false;T=f[C](b);if(p){S.push(T)}}while(p);y.push(S);if(c===b){if(!(a&&d===true&&0===S.length)){w.push(y)}}}return w};d.reportToCsv=function(e){var t=e.map(function(e){return 0}),i=o.map(e,"values"),r=e.map(function(e,t){return t}),n=r.filter(function(e){return i[e]&&i[e].length>0}),s,l=e.map(function(i,r){if(n.indexOf(r)===-1){return function(){return""}}else{var o=e[r].values,a=e[r].rows,l=e[r].valueType,u=l!=="int"&&l!=="decimal"&&l!=="float",c=t[r],d=a[c],p=function(){c++;d=a[c]};return function(e){var t;if(e===d){if(u)t='"'+o[c]+'"';else t=o[c];s=e;p()}else{t=""}return t}}}),u=n.map(function(t){return e[t].rows[0]}),c=n.map(function(t){return e[t].rows[i[t].length-1]}),d=Math.min.apply(Math,u),p=Math.max.apply(Math,c),f,h=e.map(function(e){return'"'+a.stringifyMeasure(e.sourceQuery.sourceQuery.measure)+'"'}).join(",")+"\n",g,m=false,v=l.length,y;for(g=d;g<=p;g++){f="";if(m){h+="\n";m=false}for(y=0;y<v-1;y++){f+=l[y](g)+","}f+=l[v-1](g);if(s===g){h+=f;m=true}}return h}},{"../constant":256,"../cubiql":276,"../util":357,"./query":333,"./util":336,assert:2,lodash:70,"measure-query-gen/src/MQG":1}],335:[function(e,t,i){var r=e("../cubiql");var n=function(e){var t=e.kind,i;if(e.str){return e.str}switch(t){case"AGGREGATION":i=l(e);break;case"METRIC":i=o(e);break;case"RELABEL":i=b(e);break;case"SPLIT":i=y(e);break;case"VARIABLE":i=a(e);break;case"ABSTRACTION":i=g(e);break;case"APPLICATION":i=m(e);break;default:throw new Error("Serialization of MQG message of kind '"+t+"' not yet implemented.")}return i};function o(e){return e.metric.name}function a(e){return e.variable.name}function s(e){if(e.named)return e.named;else if(e.primitive)return e.primitive.toLowerCase();else throw new Error("Can't serialize agg: "+JSON.stringify(e))}function l(e){return s(e.aggregation.method)+" ("+n(e.aggregation.expr)+") @ "+c(e.aggregation.inter)}function u(e){var t=r.qlevel.getLabel(e)+":"+r.qlevel.getDimension(e),i=r.qlevel.getHierarchy(e);if(i)t+="."+i;return t+="."+r.qlevel.getLevel(e)}function c(e){var t=e.qualified_level.map(function(e){return u(e)});return"{ "+t.join(",")+" }"}function d(e){if(e.inter){return e.name+" = "+c(e.inter)}else{return e.name}}function p(e){if(!e||e.length===0)return"";return"["+e.map(d).join(",")+"]"}function f(e){if(e.expr){return e.name+" = "+n(e.expr)}else{return e.name}}function h(e){if(!e||e.length===0)return"";return"("+e.map(f).join(",")+")"}function g(e){var t=e.abstraction,i=p(t.inter_arg),r=h(t.expr_arg),o=n(t.body);return"fun "+i+r+" in "+o}function m(e){return"("+n(e.application.abstraction)+") "+p(e.application.inter_arg)+h(e.application.expr_arg)}function v(e){return e.map(function(e){return e.source+" to "+e.target}).join(",")}function y(e){var t=v(e.split.map);return"split "+t+" in "+n(e.split.expr)}function b(e){var t=v(e.relabel.map);return"relabel "+t+" in "+n(e.relabel.expr)}t.exports=n},{"../cubiql":276}],336:[function(e,t,i){var r=e("assert");var n=e("../cubiql");var o=e("lodash");var a=e("./query");var s=e("./filter");var l=e("measure-query-gen/src/MQG");var u=e("../multiaxisconfig");var c=i;c.exprContainsExpr=function(e,t){var i=M(e);return A(e)===A(t)||i!==e&&c.exprContainsExpr(i,t)};function d(e,t){var i=e.map(function(e){return u.mqgLevelToQName(e)}),r=0,n="(";if(t){i.sort()}for(;r<i.length;r++)n+=i[r]+",";n+=")";return n}function p(e,t){if(!e)return"";return d(e.qualified_level,t)}function f(e){var t=e.slice(1,e.length-1),i=t.split(",").filter(function(e){return e.length}).map(function(e){return u.qNameToMQGLevel(e)});return new l.Intersection(i)}c.makeCaptionForMeasure=function(e,t){if(e instanceof a.FilteredMeasureQuery)return c.makeCaptionForMeasure(e.measureQuery.measure);else if(e instanceof a.Metric)return t.getMeasureInfo(e.name).caption||e.name;else if(e instanceof a.Attribute)return n.qualifiedLevelToQualifiedName(e.qualifiedLevel)+":"+e.name;else if(e instanceof a.OverriddenAttribute)return c.makeCaptionForMeasure(e.attributes[0]);else if(e instanceof a.Cast)return c.makeCaptionForMeasure(e.measureQuery.measure,t);else if(e instanceof a.Operator)return c.makeCaptionForMeasure(e.measureQueries[0].measure,t);else if(e instanceof a.OverriddenMeasureQuery)return c.makeCaptionForMeasure(e.measureQueries[0].measure,t);else return h(e)};function h(e){if(e instanceof a.Metric){return e.name}else if(e instanceof a.FilteredMeasureQuery){return"FilteredMeasureQuery["+y(e.measureQuery)+"]"}else if(e instanceof a.Attribute){return n.qualifiedLevelToQualifiedName(e.qualifiedLevel,true)+"."+e.name}else if(e instanceof a.OverriddenAttribute){return"OverridenAttribute["+e.attributes.map(h).join(",")+"]"}else if(e instanceof a.LevelMap){return"LevelMap["+n.qualifiedLevelToQualifiedName(e.childLevel,true)+","+n.qualifiedLevelToQualifiedName(e.parentLevel,true)+","+e.hierarchyName+"]"}else if(e instanceof a.ConstantTerm){return e.name}else if(e instanceof a.LiteralRelation){return e.name}else if(e instanceof a.Cast){return"Cast["+e.measureQuery.measure.name+"]"}else if(e instanceof a.Operator){return e.name+"["+e.measureQueries.map(y)+"]"}else if(e instanceof a.OverriddenMeasureQuery){return"OverriddenMeasureQuery["+e.measureQueries.map(y).join(",")+"]"}else if(e instanceof a.Application){return"Application["+h(e.abstraction)+" | "+g(e.interArgs)+" | "+m(e.exprArgs)+"]"}else if(e instanceof a.Abstraction){return"Abstraction["+h(e.expr)+" | "+g(e.interArgs)+" | "+m(e.exprArgs)+"]"}else if(e instanceof a.StringMeasure){return"String["+e.str+"]"}else{r(false,"stringifyMeasure called on unsupported type: "+JSON.stringify(e))}}function g(e){var t=" interArgs: [";if(e){t=t.concat(e.map(function(e){return"( "+e.name+" @ "+p(e.intersection)+" ),"}))}t+="]";return t}function m(e){var t=" exprArgs: [";if(e){t=t.concat(e.map(function(e){return"( "+e.name+" @ "+JSON.stringify(e.expr)+" ),"}))}t+="]";return t}function v(e){var t=Object.keys(e||{}),i=t.length,r=" by {",n;for(var o=0;o<i;o++){n=e[t[o]];if(n){r+="("+JSON.stringify(n.primitive||n.composite||n.named)+":"+t[o]+", "+n.isRecalc+", "+n.isDefault+")"}}r+="}";return r}function y(e){if(e&&e.validityMessages&&e.validityMessages.length){return b(e)}var t=h(e.measure)+" @ "+p(e.inter)+v(e.aggMethodLookup)+" @ "+p(e.mappedInter);if(e.filter){t+=" filtered by "+C(e.filter)}return t}function b(e){var t=e.label||"Unlabelled query";return"Invalid query '"+t+"', cause: "+e.validityMessages.join(", ")}function w(e){if(e instanceof s.RelationComparison){return"RelationComparison["+e.name+", "+e.members.length+" members]"}else if(e instanceof s.ParamComparison){return"ParamComparison["+e.name+", "+e.members.length+" members, "+e.comparison+" comparison]"}else if(e instanceof s.PositionComparison){return"PositionComparison[]"}}function C(e){if(e instanceof s.AttributeFilter){return"AttributeFilter["+e.comparisons.map(w).join(",")+"]:"+y(e.measureQuery)}else if(e instanceof s.CompositeFilter){return"CompositeFilter["+e.filters.map(C).join(" & ")+"]"}else if(e instanceof s.MetricFilter){return"MetricFilter["+(e.comparisons.length?e.comparisons.map(w).join(","):" position-only ")+"]:"+y(e.measureQuery)}else if(e instanceof s.PositionFilter){return"PositionFilter["+p(e.inter)+" : "+e.relationComparisons.map(w).join(",")+"]"}else if(e instanceof s.MeasureQueryFilter){return"MeasureQueryFilter["+e.queries.map(y).join(e.disjunctive?" || ":" && ")+"]--"+(e.byValue?" by "+e.byValue.operator:" by position")}else{throw new Error("Can't stringify unidentifiable filter",e)}}function E(e){return e.metric+" @ "+p(e.inter,true)}c.stringifyLevels=d;c.stringifyIntersection=p;c.unstringifyIntersection=f;c.stringifyMeasure=h;c.stringifyMeasureQuery=y;c.stringifyMetricIntersection=E;c.stringifyQueryFilter=C;c.measureQueriesEqual=function(e,t){return c.stringifyMeasureQuery(e)===c.stringifyMeasureQuery(t)};c.filtersEqual=function(e,t){return c.stringifyQueryFilter(e)===c.stringifyQueryFilter(t)};c.measureQueryDependsOnMeasure=function(e,t){if(S(e.measure,t))return true;if(e.filter&&T(e.filter,t))return true;if(t instanceof a.Attribute&&t.name==="id"&&e.mappedInter.qualified_level.some(n.qlevel.labelEquals(n.qlevel.getLabel(t.qualifiedLevel))))return true;return false};function S(e,t){if(a.measuresEqual(e,t))return true;if(e instanceof a.LevelMap&&t instanceof a.Attribute&&t.name==="id"&&(n.qLevelEqual(t.qualifiedLevel,e.childLevel)||n.qLevelEqual(t.qualifiedLevel,e.parentLevel)))return true;if(e instanceof a.OverriddenAttribute&&e.attributes.some(function(e){return a.measuresEqual(e,t)}))return true;return false}function T(e,t){if(e.measureQuery)return c.measureQueryDependsOnMeasure(e.measureQuery,t);else return false}c.calcLabelMap=function(e,t){var i={};e.forEach(function(e){var r=t.filter(n.qlevel.qLevelEqual(e));if(r.length>0)i[n.qlevel.getLabel(e)]=n.qlevel.getLabel(r[0])});return i};c.calcSelfLabelMap=function(e){return e.reduce(function(e,t){var i=n.qlevel.getLabel(t);e[i]=i;return e},{})};var x="__";c.qlToKey=function(e){return(e.label||"")+x+e.dimension+x+e.level};c.keyToQl=function(e){var t=e.split(x);return new l.QualifiedLevel(t[1],t[2],null,t[0])};c.formatServiceError=function(e){var t=e.body&&e.body.problem||[];return"Problems: \n "+t.map(function(e,t){return"  "+t+": "+e.text}).join("\n")};c.checkServiceResponse=function(e,t){if(t.exception&&t.exception==="ERROR"){var i=t.problem||[],r=o.map(i,"text");console.error("Measure Service Error received!");console.error(e,t);throw new Error("Measure Service Exceptions: "+r.join("\n"))}};c.getMeasureValueType=function(e,t){var i,r;if(e instanceof a.ConstantTerm){i=e.type}else if(e instanceof a.FixedLevel){r=e.qualifiedLevel;i=t.getAttributeType("id",n.qlevel.getDimension(r),n.qlevel.getLevel(r))}else if(e instanceof a.Attribute){r=e.qualifiedLevel;i=t.getAttributeType(e.name,n.qlevel.getDimension(r),n.qlevel.getLevel(r))}else if(e instanceof a.Metric){var s=t.getMeasureInfo(e.name);if(s.type)i=a.Type[s.type.kind];else i=a.Type.NONE}else if(e instanceof a.FilteredMeasureQuery){return c.getMeasureValueType(e.measureQuery.measure,t)}else if(e instanceof a.OverriddenMeasureQuery){return c.getMeasureValueType(e.measureQueries[0].measure,t)}else if(e instanceof a.LiteralRelation){return e.type}else if(e instanceof a.OverriddenAttribute){return c.getMeasureValueType(e.attributes[0],t)}else if(e instanceof a.Cast){return e.type}else if(e instanceof a.Operator){return t.getOperator(e.name,o.map(e.measureQueries,"measure").map(function(e){return _(e,t)})).get("range").get("kind")}else if(e instanceof a.Application){return e.signature.type.type}else{throw new Error("Cant get MeasureValueType from unimplemented measure type!")}return i};function _(e,t){var i=c.getMeasureValueType(e,t),n;if(i==="NAMED"){r(e instanceof a.Metric||e instanceof a.FilteredMeasureQuery,"Currently getMeasureTypeObject only supports Metric and FilteredMeasureQuery measures");valuePredicate=t.getMeasureInfo(e.name).type.named;return{kind:i,named:valuePredicate}}else{return{kind:i}}}function M(e){var t=e.kind;switch(t){case"DROP":return e.drop.expr;case"RELABEL":return e.relabel.expr;case"ATTRIBUTE":return e;case"FILTER":return e.filter.expr;case"DICE":return e.dice.expr;case"AGGREGATION":return e.aggregation.expr;case"METRIC":return e;case"WIDEN":return e.widen.expr;case"SPLIT":return e.split.expr;case"DEMOTE":return e.demote.expr;case"PARAM":return e;case"APPLICATION":return e.application.abstraction;default:throw new Error("Unable to get core expr of kind '"+t+"'")}}c.cleanMQGExpr=function(e){var t=e.kind,i=Object.getOwnPropertyNames(e),r,n,o=0;for(;o<i.length;o++){r=i[o];n=r[0];if(n==="$"||n==="_")delete e[r]}switch(t){case"DROP":c.cleanMQGExpr(e.drop.expr);break;case"RELABEL":c.cleanMQGExpr(e.relabel.expr);break;case"ATTRIBUTE":break;case"FILTER":c.cleanMQGExpr(e.filter.expr);break;case"DICE":c.cleanMQGExpr(e.dice.expr);break;case"AGGREGATION":c.cleanMQGExpr(e.aggregation.expr);break;case"METRIC":break;case"WIDEN":c.cleanMQGExpr(e.widen.expr);break;case"SPLIT":c.cleanMQGExpr(e.split.expr);break;case"DEMOTE":c.cleanMQGExpr(e.demote.expr);break;case"OVERRIDE":e.override.expr.forEach(function(e){c.cleanMQGExpr(e)});break;case"PARAM":break;case"APPLICATION":break;case"CAST":c.cleanMQGExpr(e.cast.expr);break;case"OP":e.op.expr.forEach(c.cleanMQGExpr);break;case"LITERAL":break;default:throw new Error("Unable to clean MQG Expr of kind: '"+t+"'")}};function A(e){var t=e.kind,i;switch(t){case"ATTRIBUTE":i=$(e);break;case"FILTER":i=k(e);break;case"DICE":i=L(e);break;case"AGGREGATION":r(!o.isUndefined(e.aggregation.inter),"getIntersectionOfExpr does not support AggExprs that use Grouping yet");i=R(e);break;case"DROP":i=A(e.drop.expr);break;case"RELABEL":i=q(e);break;case"METRIC":i=F(e);break;case"WIDEN":i=P(e);break;case"PARAM":i=V(e);break;case"DEMOTE":i=N(e);break;case"SPLIT":i=D(e);break;case"APPLICATION":i=I(e);break;case"OVERRIDE":i=O(e);break;default:throw new Error("Unable to stringify expr of kind '"+t+"'")}return t+"__"+i}c.stringifyExpr=A;function I(e){return A(e.application.abstraction)+"__expr: "+JSON.stringify(e.application.expr_arg)+" __inter: "+JSON.stringify(e.application.inter_arg)}function O(e){return"Override["+e.override.expr.map(A).join("||")+"]"}function D(e){return A(e.split.expr)+"__"+JSON.stringify(e.split.map)}function N(e){return A(e.demote.expr)+"__"+e.demote.dimension+"__"+e.demote.label}function R(e){return A(e.aggregation.expr)+"__"+p(e.aggregation.inter)+"__"+JSON.stringify(e.aggregation.method)}function P(e){return A(e.widen.expr)+"__"+p(e.widen.inter)}function L(e){return A(e.dice.expr)+"__"+e.dice.dicer.map(A).join("__")+JSON.stringify(e.dice.is_disjunction)}function k(e){return A(e.filter.expr)+"__"+JSON.stringify(e.filter.comparison)+"__"+JSON.stringify(e.filter.is_disjunction)}function $(e){return n.qualifiedLevelToQualifiedName(e.attribute.qualified_level)+"__"+e.attribute.attribute}function F(e){var t=e.metric.inter?p(e.metric.inter):"IMPLIED";return t+"__"+e.metric.name}function V(e){var t=p(e.param.signature.intersection);return t+"__"+e.param.name+"__"+JSON.stringify(e.param.type)}function q(e){return A(e.relabel.expr)+JSON.stringify(e.relabel.map)}},{"../cubiql":276,"../multiaxisconfig":328,"./filter":332,"./query":333,assert:2,lodash:70,"measure-query-gen/src/MQG":1}],337:[function(e,t,i){"use strict";var r=e("lodash");var n=e("../event_emitter").EventEmitter;var o=e("../constant").ACTIONS.LEVELS;var a=e("../constant").ACTIONS.ActionActions;var s=e("../constant").ACTIONS.ActionEvents;var l=e("../constant").MESSAGES;r.mixin(u.prototype,n.prototype);function u(e){var t=this;e.register(function(e){var i=e.action;switch(i.actionType){case a.CLEAR_STATUS:t.$clearStatus(i.actionId);break;case a.START_ACTION:t.$startAction(i.actionId);break;case a.FAIL_ACTION:t.$failAction(i.actionId);break;case a.SUCCEED_ACTION:t.$succeedAction(i.actionId,i.status,i.sendQuery);break;case a.LOAD_ACTIONS:t.$loadActions(i.actionConfigs);break}});this.$actions={};this.$actionIsRunning={};this.$status={}}u.prototype.destroy=function(){this.$actions=null;this.$actionIsRunning=null;this.$status=null};u.prototype.$startAction=function(e){this.$actionIsRunning[e]=true;this._emit(s.ACTION_STARTED,{actionId:e});this._emit(s.CHANGED)};u.prototype.$failAction=function(e){this.$actionIsRunning[e]=false;this.$status[e]={type:o.ERROR,message:l.UNEXPECTED_SERVER_ERROR};this._emit(s.ACTION_FAILED,{actionId:e});this._emit(s.CHANGED)};u.prototype.$succeedAction=function(e,t,i){this.$actionIsRunning[e]=false;this.$status[e]=t;if(i||r.isUndefined(i)){this._emit(s.ACTION_SUCCEEDED,{actionId:e})}this._emit(s.CHANGED)};u.prototype.$loadActions=function(e){this.$actions=e;this._emit(s.ACTIONS_LOADED);this._emit(s.CHANGED)};u.prototype.getAction=function(e){return this.$actions[e]};u.prototype.getAllActions=function(){return this.$actions};u.prototype.isActionEnabled=function(e){if(!this.$actions[e]){console.error("Action "+e+" does not exist");return false}return this.$actions[e].is_enabled};u.prototype.isActionRunning=function(e){return this.$actionIsRunning[e]};u.prototype.getActionStatus=function(e){var t=this.$status[e];if(r.isArray(t)){var i=r.map(t,"message").join(" "),n=r.map(t,"type"),a=n.indexOf("Error")>-1,s=n.indexOf("Warning")>-1,l=a?o.ERROR:s?o.WARNING:o.INFO;return{type:l,message:i}}return t};u.prototype.$clearStatus=function(e){this.$status[e]=null;this._emit(s.CHANGED)};t.exports=u},{"../constant":256,"../event_emitter":289,lodash:70}],338:[function(e,t,i){"use strict";var r=e("lodash");var n=e("../event_emitter").EventEmitter;var o=e("../constant").Collaboration.ACTIONS;var a=e("../constant").Collaboration.EVENTS;r.mixin(s.prototype,n.prototype);function s(e){var t=this;e.register(function(e){var i=e.action;switch(i.actionType){case o.UPDATE_SOCKET_LIST:t.$userListUpdateFull(i.sockets,i.currentUser);break;case o.UPDATE_USER_STATUS:t.$updateUserList(i.socket,i.user,i.isConnection);break;case o.UPDATE_CURRENT_SOCKET:t.$updateCurrentSocket(i.isConnection);break}});this.$userSocketMap=[];this.$usersInfo=[];this.$currentUser={}}s.prototype.$updateCurrentSocket=function(e){var t=e?a.CONNECT:a.DISCONNECT;this._emit(t)};s.prototype.$userListUpdateFull=function(e,t){var i={};for(var r=0;r<e.length;r++){i[e[r].username]=i[e[r].username]||[];i[e[r].username].push(e[r].id)}this.$userSocketMap=i;this.$usersInfo=this.$getUsersInfo([t]);this.$currentUser=t;this._emit(a.USER_LIST_UPDATED)};s.prototype.$updateUserList=function(e,t,i){if(i){if(Object.keys(this.$userSocketMap).indexOf(t)===-1)this.$addUser(e,t);else this.$addUserSocket(e,t)}else{this.$removeUserSocket(e,t)}};s.prototype.$addUser=function(e,t){this.$userSocketMap[t]=[e];this.$usersInfo[t]=this.$getUsersInfo([t])[t];this._emit(a.USER_CONNECTED)};s.prototype.$addUserSocket=function(e,t){this.$userSocketMap[t].push(e);this._emit(a.USER_NEW_SOCKET)};s.prototype.$removeUserSocket=function(e,t){if(!this.$userSocketMap[t]){console.error("user already disconnected");return}if(this.$userSocketMap[t].indexOf(e)===-1){console.error("the socket: "+e+" for user: "+t+" doesn't exist");return}this.$userSocketMap[t].splice(this.$userSocketMap[t].indexOf(e),1);if(this.$userSocketMap[t]&&!this.$userSocketMap[t].length){delete this.$userSocketMap[t];this._emit(a.USER_DISCONNECTED);return}this._emit(a.USER_SOCKET_CLOSED)};s.prototype.getUserInfo=function(e){return this.$usersInfo[e]};s.prototype.getUsers=function(){var e=Object.keys(this.$userSocketMap);e.splice(e.indexOf(this.$currentUser),1);return e};s.prototype.$getUsersInfo=function(e){var t={};for(var i=0;i<e.length;i++){t[e[i]]={userName:e[i]}}return t};t.exports=s},{"../constant":256,"../event_emitter":289,lodash:70}],339:[function(e,t,i){var r=e("lodash");var n=e("assert");var o=e("../constant").SORT;var a=e("../constant").Layout.POSITION;var s={push:false,fixed:false,addToRow:false};var l="fill";var u={flex:1};var c=/\s*,\s*/;function d(){this.$rows=null;this.$columns=null;this.$model=[];this.$widgets={}}d.prototype.removeColumns=function(e,t){var i=this;r.forEach(e.reverse(),function(e){i.removeColumn(e,true,true)});this.$columns=r.filter(this.$columns,function(t,r){return e.indexOf(r)===-1||i.$columns.length===e.length&&r===0});if(!t){this.$updateModel()}};d.prototype.removeRows=function(e,t){var i=this;r.forEach(e.reverse(),function(e){i.removeRow(e,true,true)});this.$rows=r.filter(this.$rows,function(t,r){return e.indexOf(r)===-1||i.$rows.length===e.length&&r===0});if(!t){this.$updateModel()}};d.prototype.removeColumn=function(e,t,i){n(r.isNumber(e)&&e<this.$columns.length&&e>=0,["Invalid column index:",e]);this.$removeWidgetsFromColumn(e);if(!i){this.$columns.splice(e,1)}if(!t){this.$updateModel()}};d.prototype.removeRow=function(e,t,i){n(r.isNumber(e)&&e<this.$rows.length&&e>=0,["Invalid row index:",e]);this.$removeWidgetsFromRow(e);if(!i){this.$rows.splice(e,1)}if(!t){this.$updateModel()}};d.prototype.rearrangeLayout=function(e,t){var i=this;this.$updateModel();if(!t){this.$clear()}if(e){r.forEach(this.$getMappedWidgets(),function(e){var t=i.$getExpandedWidgetPosition(e.id);if(t&&!r.eq(t,i.$widgets[e.id].position)){i.$setWidgetPosition(e.id,t)}})}};d.prototype.insertColumn=function(e,t){n(r.isNumber(e)&&e>=0&&(!this.$columns||e<=this.$columns.length),["Can't insert new column - invalid index:",e]);var i=r.range(this.$rows.length).map(function(){return null});t=t&&this.$getRowColEntry(t)||this.$columns[e]||u;this.$columns.splice(e,0,t);this.$model.splice(e,0,i);this.$removeWidgetsFromColumn(e,true);this.$updateModel()};d.prototype.insertRow=function(e,t){n(r.isNumber(e)&&e>=0&&(!this.$rows||e<=this.$rows.length),["Can't insert new row - invalid index:",e]);t=t&&this.$getRowColEntry(t)||this.$rows[t]||u;this.$rows.splice(e,0,t);r.forEach(this.$model,function(t){t.splice(e,0,null)});this.$removeWidgetsFromRow(e,true);this.$updateModel()};d.prototype.addWidget=function(e,t,i){t=r.merge({col:0,row:0,colspan:1,rowspan:1},t);options=r.merge({},s,t.options);t.col=parseInt(t.col);t.row=parseInt(t.row);n(!r.isNaN(t.col)&&!r.isNaN(t.col),["Invalid widget position."]);if(this.$widgets[e]){this.removeWidget(e,true)}var o=r.cloneDeep(t),c=this,d=!options.addToRow||!this.$columns.length,p=options.addToRow||!this.$rows.length,f=options&&options.size&&c.$getRowColEntry(options.size),h=f&&this.$serializeRowCol(f)||u,g,m;if(options.openIn){switch(options.openIn){case a.LEFT:this.insertColumn(0,h);r.merge(o,{col:0,row:0,rowspan:l,minrowspan:this.$rows.length});break;case a.TOP:this.insertRow(0,h);r.merge(o,{col:0,row:0,colspan:l});break;case a.RIGHT:r.merge(o,{col:this.$columns.length,row:0,rowspan:l});break;case a.BOTTOM:r.merge(o,{col:0,row:this.$rows.length,colspan:l});break}}else{while(!this.$canAddWidgetToPosition(o,d,p)){if(options.strictPosition){if(options.addToRow){this.insertRow(o.row,options.size);o.row+=o.row===0?0:1}else{this.insertColumn(o.col,options.size);o.col+=o.col===0?0:1}}else{o=this.$getNextWidgetPosition(o,t,options)}}}r.forEach(this.$getWidgetColumns(o),function(e){if(e>=c.$columns.length){g=f||c.$columns[e-1]||u;c.$columns.push(g)}});r.forEach(this.$getWidgetRows(o),function(e){if(e>=c.$rows.length){m=f||c.$rows[e-1]||u;c.$rows.push(m)}});this.$widgets[e]={position:o,options:options};this.$applyWidgetSize(this.$widgets[e],t,options.addToRow,f);if(!i){this.rearrangeLayout(true)}else{this.$updateModel()}};d.prototype.removeWidgets=function(e,t,i){var n=this;r.forEach(e,function(e){n.removeWidget(e,true)});if(!t){this.rearrangeLayout(i)}else{this.$updateModel()}};d.prototype.removeWidget=function(e,t,i){if(this.$widgets[e]){delete this.$widgets[e];if(!t){this.rearrangeLayout(i)}else{this.$updateModel()}}};d.prototype.setRows=function(e,t){n(typeof e==="string",["Rows should be a string."]);var i=this;this.$rows=e.split(c).map(function(e){return i.$getRowColEntry(e)});if(!t){this.$updateModel()}};d.prototype.setColumns=function(e,t){n(typeof e==="string",["Columns should be a string."]);var i=this;this.$columns=e.split(c).map(function(e){return i.$getRowColEntry(e)});if(!t){this.$updateModel()}};d.prototype.getWidgetPosition=function(e,t){if(!this.$widgets[e]){return null}var i=t?this.$transformModelToWidgetsPositions():this.$widgets,n=i[e];return n.position?r.cloneDeep(n.position):n};d.prototype.getWidgetsPositions=function(e){var t;if(e){return this.$transformModelToWidgetsPositions()}else{t=this.$getMappedWidgets();return r.zipObject(r.map(t,"id"),t)}};d.prototype.buildLayoutConfig=function(e){return{shape:{columns:r.map(this.$columns,this.$serializeRowCol).join(","),rows:r.map(this.$rows,this.$serializeRowCol).join(",")},viewPositions:this.getWidgetsPositions(e)}};d.prototype.getState=function(){var e={rows:this.$getRowsState(),columns:this.$getColumnsState(),model:r.map(this.$model,function(e){return r.map(e,function(e){return e?e.id:null})}),widgets:this.$getMappedWidgets()};return r.cloneDeep(e)};d.prototype.$clear=function(){var e=this,t=[],i=[],n;r.forEach(this.$model,function(i,n){var o=!i||!i.length||r.every(i,function(t){return!t||!e.$isWidgetInCell(n,t.row,t)});o&&t.push(n)});r.forEach(this.$model[0],function(t,o){var a=r.every(e.$model,function(t,i){n=t[o];return!n||!e.$isWidgetInCell(i,o,n)});a&&i.push(o)});t.length&&this.removeColumns(t,true);i.length&&this.removeRows(i,true);this.$updateModel()};d.prototype.$updateModel=function(){var e=this,t,i=this.$getMappedWidgets();this.$model=[];this.$iterateCells(function(n,o){t=r.find(i,function(t){return e.$isWidgetInCell(n,o,t)})||null;e.$model[n]=e.$model[n]||[];e.$model[n][o]=t});r.forEach(i,function(t){if(t.colspan===l||t.rowspan===l){var i=e.$getExpandedWidgetPosition(t.id,true);if(i&&!r.eq(i,e.$widgets[t.id].position)){e.$setWidgetPosition(t.id,i)}}})};d.prototype.$removeWidgetsFromColumn=function(e,t){var i=this;r.forEach(this.$widgets,function(r,n){var o=r.position,a=i.$getWidgetColumns(o),s=a.indexOf(e);if(s!==-1){if(s===0){o.col=parseInt(o.col)+1}if(o.colspan!==l){if(!t){o.colspan=parseInt(o.colspan)-1}if(o.colspan<=0){delete i.$widgets[n]}}}else if(o.col>e){o.col=parseInt(o.col)+(t?1:-1)}})};d.prototype.$removeWidgetsFromRow=function(e,t){var i=this;r.forEach(this.$widgets,function(r,n){var o=r.position,a=i.$getWidgetRows(o),s=a.indexOf(e);if(s!==-1){if(s===0){o.row=parseInt(o.row)+1}if(o.rowspan!==l){if(!t){o.rowspan=parseInt(o.rowspan)-1}if(o.rowspan<=0){delete i.$widgets[n]}}}else if(o.row>e){o.row=parseInt(o.row)+(t?1:-1)}})};d.prototype.$getNextWidgetPosition=function(e,t,i){var r=this.$rows.length||1,n=this.$columns.length||1,o=i&&i.push,a=i&&i.addToRow;if(a){if(o&&e.col<n-1){e.col+=1}else{e.col=o?0:t.col;e.row+=1;e.colspan=t.colspan;r+=1}}else{if(o&&e.row<r-1){e.row+=1}else{e.row=o?0:t.row;e.col+=1;e.rowspan=t.rowspan;n+=1}}if(e.rowspan!==l&&e.rowspan+e.row>=r){e.rowspan=Math.max(r-e.row,1)}if(e.colspan!==l&&e.colspan+e.col>=n){e.colspan=Math.max(n-e.col,1)}return e};d.prototype.$iterateCells=function(e){n(typeof e==="function",["Callback should be a function."]);var t=this.$columns&&this.$columns.length,i=this.$rows&&this.$rows.length;for(var r=0;r<t;r++){for(var o=0;o<i;o++){e(r,o)}}};d.prototype.$getWidgetColumns=function(e){var t=this.$getColSpan(e);return r.range(e.col,e.col+t)};d.prototype.$getWidgetRows=function(e){var t=this.$getRowSpan(e);return r.range(e.row,e.row+t)};d.prototype.$isWidgetInCell=function(e,t,i){return this.$getWidgetColumns(i).indexOf(e)!==-1&&this.$getWidgetRows(i).indexOf(t)!==-1};d.prototype.$getMappedWidgets=function(e){var t=this,i,n,a=e?o.DESCENDING:o.ASCENDING,s;return r.chain(this.$widgets).map(function(e,o){s=r.merge({id:o,size:{width:null,height:null}},e.position);i=e.size&&e.size.height;n=e.size&&e.size.width;
if(i){s.size.height=t.$serializeRowCol(i)}if(n){s.size.width=t.$serializeRowCol(n)}return s}).orderBy(["col","row"],[a,a]).value()};d.prototype.$isCellEmpty=function(e,t,i,n){var o=this.$model[e],a=o&&o[t];if(a&&!this.$isWidgetInCell(e,t,a)){return true}return a===null||i&&!o||n&&o&&r.isUndefined(a)};d.prototype.$canExpandToRow=function(e,t){var i=this.$getWidgetColumns(t),n=t.rowspan===l,o,a=this;return r.every(i,function(t){o=!n&&a.$model[t]&&a.$model[t][e];return a.$isCellEmpty(t,e)&&(n||!o||o.colspan!==l)})};d.prototype.$canExpandToColumn=function(e,t){var i=this.$getWidgetRows(t),n=t.colspan===l,o,a=this;return r.every(i,function(t){o=!n&&a.$model[e]&&a.$model[e][t];return a.$isCellEmpty(e,t)&&(n||!o||o.rowspan!==l)})};d.prototype.$getExpandedWidgetPosition=function(e,t){var i=this.$widgets[e],n=i&&r.cloneDeep(i.position),o=i&&i.options,a=!t&&!o.fixed,s=!t&&!o.fixed||t&&n.rowspan===l,u=!!a,c=!t&&!o.fixed||t&&n.colspan===l,d,p;if(!i||!n){return null}if(a){d=n.row-1;while(this.$canExpandToRow(d,n)){n.row=d;n.rowspan=this.$getRowSpan(n)+1;d-=1}}if(c){p=n.col+this.$getColSpan(n);while(this.$canExpandToColumn(p,n)){n.colspan=this.$getColSpan(n)+1;p+=1}}if(s){d=n.row+this.$getRowSpan(n);while(this.$canExpandToRow(d,n)){n.rowspan=this.$getRowSpan(n)+1;d+=1}}if(u){p=n.col-1;while(this.$canExpandToColumn(p,n)){n.col=p;n.colspan=this.$getColSpan(n)+1;p-=1}}return n};d.prototype.$setWidgetPosition=function(e,t){var i=this,n=this.$widgets[e].position||t;this.$iterateCells(function(t,r){var n=i.$model[t][r];if(n&&n.id===e){i.$model[t][r]=null}});r.forEach(i.$getWidgetColumns(t),function(o){r.forEach(i.$getWidgetRows(t),function(t){i.$model[o]=i.$model[o]||[];i.$model[o][t]=r.merge({id:e},n)})})};d.prototype.$canAddWidgetToPosition=function(e,t,i){var n=this.$getWidgetColumns(e),o=this.$getWidgetRows(e),a=this;return r.every(n,function(e){return r.every(o,function(r){return a.$isCellEmpty(e,r,t,i)})})};d.prototype.$serializeRowCol=function(e){if(e.pixels){return e.pixels+"px"}if(e.flex){return e.flex}if(e.percentage){return e.percentage+"%"}};d.prototype.$getRowColEntry=function(e){if(typeof e=="number"){return{pixels:e}}else if(parseFloat(e)==e){return{flex:parseFloat(e)}}else if(e.indexOf("%")>-1){return{percentage:parseFloat(e)/100}}else if(e.indexOf("px")>-1){return{pixels:parseInt(e,10)}}throw new Error("Invalid Row/Column Configuration")};d.prototype.$applyWidgetSize=function(e,t,i,r){var n;if(t&&t.size){n={width:t.size.width&&this.$getRowColEntry(t.size.width)||null,height:t.size.height&&this.$getRowColEntry(t.size.height)||null}}else if(r){n={width:i?null:r,height:i?r:null}}if(n){e.size=n}return e};d.prototype.$transformModelToWidgetsPositions=function(){var e={},t=this,i,r;this.$iterateCells(function(n,o){i=t.$model[n]&&t.$model[n][o];if(i){r=e[i.id];if(r){if(r.col+r.colspan===n){r.colspan+=1}if(r.row+r.rowspan===o){r.rowspan+=1}}else{e[i.id]={col:n,row:o,colspan:1,rowspan:1}}}});return e};d.prototype.$getRowSpan=function(e){var t=e.rowspan===l?e.minrowspan||1:e.rowspan,i=this.$rows&&this.$rows.length?this.$rows.length:1;if(!r.isNumber(t)){t=parseInt(t);if(r.isNaN(t)){t=1}}t=Math.min(t,i);return t};d.prototype.$getColSpan=function(e){var t=e.colspan===l?e.mincolspan||1:e.colspan,i=this.$columns&&this.$columns.length?this.$columns.length:1;if(!r.isNumber(t)){t=parseInt(t);if(r.isNaN(t)){t=1}}t=Math.min(t,i);return t};d.prototype.$getRowsState=function(){var e=this,t;return r.map(this.$rows,function(i,n){if(i.pixels){r.forEach(e.$widgets,function(e){t=e.size&&e.size.height;if(e.position&&e.position.row===n&&t&&t.pixels){i=t.pixels>i.pixels?t:i}})}return i})};d.prototype.$getColumnsState=function(){var e=this,t;return r.map(this.$columns,function(i,n){if(i.pixels){r.forEach(e.$widgets,function(e){t=e.size&&e.size.width;if(e.position&&e.position.col===n&&t&&t.pixels){i=t.pixels>i.pixels?t:i}})}return i})};t.exports=d},{"../constant":256,assert:2,lodash:70}],340:[function(e,t,i){"use strict";var r=e("../event_emitter").EventEmitter;var n=e("lodash");var o=e("../constant").DND.ACTIONS;var a=e("../constant").DND.EVENTS;var s=e("../constant").DND.STATE;n.mixin(l.prototype,r.prototype);function l(e){this.$state=null;this.$dragType=null;this.$dragData=null;this.$dragOverType=null;this.$dragOverData=null;this.$dropType=null;this.$dropData=null;if(e){this.registerActionHandlers(e)}}l.prototype.$startDrag=function(e,t){this.$state=s.DRAGGING;this.$dragType=e;this.$dragData=t;this._emit(a.CHANGED)};l.prototype.$stopDrag=function(){this.$state=null;this.$dragType=null;this.$dragData=null;this.$dragOverType=null;this.$dragOverData=null;this.$dropType=null;this.$dropData=null;this._emit(a.CHANGED)};l.prototype.$dragOver=function(e,t){this.$dragOverType=e;this.$dragOverData=t;this._emit(a.CHANGED)};l.prototype.$drop=function(e,t){this.$state=s.DROPPED;this.$dropType=e;this.$dropData=t;this._emit(a.CHANGED)};l.prototype.getDragType=function(){return this.$type};l.prototype.getDragOver=function(){return this.$dragOverData};l.prototype.getDragData=function(){return this.$dragData};l.prototype.getDropData=function(){return this.$dropData};l.prototype.getDragType=function(){return this.$dragType};l.prototype.getDragOverType=function(){return this.$dragOverType};l.prototype.getDropType=function(){return this.$dropType};l.prototype.isDragging=function(){return this.$state===s.DRAGGING};l.prototype.didDrop=function(){return this.$state===s.DROPPED};l.prototype.registerActionHandlers=function(e){var t=this;this.dispatcherIndex=e.register(function(e){var i=e.action;switch(i.actionType){case o.DRAG:t.$startDrag(i.type,i.dragData);break;case o.DRAGEND:t.$stopDrag();break;case o.DRAGOVER:t.$dragOver(i.type,i.dragOverData);break;case o.DROP:t.$drop(i.type,i.dropData);break}})};t.exports=l},{"../constant":256,"../event_emitter":289,lodash:70}],341:[function(e,t,i){"use strict";var r=e("immutable");var n=e("../event_emitter").EventEmitter;var o=e("lodash");var a=e("./measuremodelstore").MeasureModelActions;var s=e("./pivotconfigstore").PivotConfigActions;var l=e("../cubiql");var u=e("../constant").SORT;var c=e("../multiaxisconfig");function d(e,t,i){var n=this;this.$modelStore=t;this.$pivotConfigStore=i;this.$fields=r.List();this.$update();this.dispatcherIndex=e.register(function(r){var o=r.action;switch(o.actionType){case a.SET_MODEL:e.waitFor([t.dispatcherIndex],function(){n.$update()});break;case s.SET_CONFIG:e.waitFor([i.dispatcherIndex],function(){n.$update()});break}})}o.mixin(d.prototype,n.prototype);d.prototype.$update=function(){var e=this,t=this.$pivotConfigStore,i=this.$modelStore.getServerModel();if(!i)return;this.$measureFields=i.get("metric").map(function(e){var i=e.get("name");return c.mkMeasureField({id:i,fieldLabel:e.get("caption")||i,data:[{name:"value",measure:{metric:{name:i}},format:t.getMetricFormat(i)}]})});this.$dimensionFields=i.get("dimension").map(function(e){return new c.DimensionField({id:e.get("name"),dimension:e.get("name"),dimensionLabel:e.get("name"),fieldLabel:e.get("caption")||e.get("name")})});this.$levelFields=i.get("dimension").flatMap(function(e){return e.get("level").map(function(i){var r=l.qualifiedName(e.get("name"),i.get("name")),n=t.getLevelDefaultSort(r);return c.mkLevelField({id:l.qualifiedName(e.get("name"),i.get("name")),level:{labelName:e.get("name"),dimensionName:e.get("name"),levelName:i.get("name")},data:[{name:"label",measure:{attribute:{name:"label",level:{labelName:e.get("name"),dimensionName:e.get("name"),levelName:i.get("name")}}}}],sortConfigs:[{sortType:u.ASCENDING,measure:{attribute:{name:n.sortAttr,level:{dimensionName:e.get("name"),levelName:i.get("name")}}}}],fieldLabel:i.get("caption")||i.get("name")})}).push(c.mkLevelField({id:l.qualifiedName(e.get("name"),"ALL"),level:{labelName:"All "+(e.get("caption")||e.get("name")),dimensionName:e.get("name"),levelName:"ALL"},displayMode:c.LevelDisplayMode.NONE,rollupConfigs:r.List([c.mkRollupConfig({methodName:"DEFAULT"})]),fieldLabel:"All "+(e.get("caption")||e.get("name"))}))});this.$measureGroupFields=r.List([new c.MeasureGroupField({id:"-:Measures",fieldLabel:"Measures"})]);this.$fields=r.Map().withMutations(function(t){e.$measureFields.forEach(function(e){t.set(p(e),e)});e.$dimensionFields.forEach(function(e){t.set(p(e),e)});e.$levelFields.forEach(function(e){t.set(p(e),e)});e.$measureGroupFields.forEach(function(e){t.set(p(e),e)})})};function p(e){return r.Map({id:e.get("id"),type:e.get("type")})}function f(e,t){return r.Map({id:e,type:t})}d.prototype.getFields=function(e){switch(e){case c.FieldTypes.LEVEL:return this.$levelFields;case c.FieldTypes.DIMENSION:return this.$dimensionFields;case c.FieldTypes.MEASURE:return this.$measureFields;case c.FieldTypes.MEASURE_GROUP:return this.$measureGroupFields;default:return this.$fields}};d.prototype.getField=function(e,t){return this.$fields.get(f(e,t))};d.prototype.getFieldFromQualifiedName=function(e){return this.$fields.get(f(e,c.FieldTypes.LEVEL))||this.$fields.get(f(e,c.FieldTypes.MEASURE))||this.$fields.get(f(e,c.FieldTypes.MEASURE_GROUP))};t.exports.FieldStore=d},{"../constant":256,"../cubiql":276,"../event_emitter":289,"../multiaxisconfig":328,"./measuremodelstore":344,"./pivotconfigstore":351,immutable:"immutable",lodash:70}],342:[function(e,t,i){"use strict";var r=e("../util");var n=e("lodash");var o=e("../event_emitter").EventEmitter;var a=e("./store").createConstant;n.mixin(s.prototype,o.prototype);function s(e){var t=this;this.dispatcherIndex=e.register(function(e){var i=e.action;switch(i.actionType){case l.POST_ERROR:t.$postError(i.error);break;case l.POST_WARN:t.$postWarn(i.warningEvent,i.message,i.errorObject);break}})}s.prototype.$postError=function(e){this._emit(u.ERROR,e)};s.prototype.$postWarn=function(e,t,i){if(n.values(u).indexOf(e)<0){r.logError("unknown warning event :"+t);return}if(!n.isUndefined(i)){console.error(i)}this._emit(e,{message:t})};var l=a("LogActions",["POST_ERROR","POST_WARN","POST_INFO"]);var u=a("LogErrors",["ERROR","WARNING","INFO","DATA_PROCESSING_ERROR","EDITABILITY_CHECK_FAILED"]);i.LogStore=s;i.LogActions=l;i.LogEvents=u},{"../event_emitter":289,"../util":357,"./store":352,lodash:70}],343:[function(e,t,i){"use strict";var r=e("immutable");var n=e("../event_emitter").EventEmitter;var o=e("./store").createConstant;var a=e("lodash");a.mixin(s.prototype,n.prototype);function s(e){e.register(this.handlePayload.bind(this));this.$state=new l}var l=r.Record({storedRules:{primary:r.Map(),inverses:r.Map()},ruleEditors:r.Map()});var u=s.RuleEditor=r.Record({editorId:null,ruleId:null,inverseEditors:r.List(),error:null,isEditing:true,isEditable:false,formula:null,value:null});var c=s.InverseEditor=r.Record({editorId:null,isEditing:true,isEditable:true,formula:null,value:null});s.prototype.handlePayload=function(e){var t=this,i=e.action;switch(i.actionType){case p.LOAD_RULES:t.$state=s.loadRules(t.$state,i.rules);t._emit(d.CHANGE);break;case p.ADD_RULE_EDITOR:t.$state=s.addRuleEditor(t.$state,i.ruleEditorId,i.ruleId);t._emit(d.CHANGE);break;case p.ENTER_EDIT_MODE:t.$state=s.enterEditMode(t.$state,i.ruleEditorId,i.inverseEditorId);t._emit(d.CHANGE);break;case p.CLEAR_INVERSE_FORMULA_EDITS:t.$state=s.clearInverseFormulaEdits(t.$state,i.ruleEditorId,i.inverseEditorId);t._emit(d.CHANGE);break;case p.ADD_INVERSE_EDITOR:t.$state=s.addInverseEditor(t.$state,i.ruleEditorId);t._emit(d.CHANGE);break;case p.REMOVE_INVERSE_EDITOR:t.$state=s.removeInverseEditor(t.$state,i.ruleEditorId,i.inverseEditorId);t._emit(d.CHANGE);break;case p.EDIT_PRIMARY_FORMULA:t.$state=s.editPrimaryFormula(t.$state,i.ruleEditorId,i.value);break;case p.EDIT_INVERSE_FORMULA:t.$state=s.editInverseFormula(t.$state,i.ruleEditorId,i.inverseEditorId,i.value);break;case p.CLEAR_ALL_EDITS:t.$state=s.clearAllEdits(t.$state,i.ruleEditorId);t._emit(d.CHANGE);break;case p.SET_RULE_ID:t.$state=s.setRuleId(t.$state,i.ruleEditorId,i.ruleId);t._emit(d.CHANGE);break;case p.RULE_INSTALL_ERROR:t.$state=s.setRuleError(t.$state,i.ruleEditorId,i.message);t._emit(d.CHANGE);break}};s.prototype.getRuleEditor=function(e){return s.getRuleEditor(this.$state,e)};s.prototype.hasRule=function(e){return this.$state.hasIn(["storedRules","primary",e])};s.prototype.hasFormula=function(e,t){var i=s.getRuleEditor(this.$state,e,t),r;if(i){r=s.findInverseEditorIndex(i,t);if(r!==-1){return i.getIn(["inverseEditors",r,"formula"])}}};s.prototype.getRulesWithEditors=function(){return this.$state.get("ruleEditors",new r.Map).filter(function(e){return e.get("formula")}).map(function(e){return e.get("ruleId")})};s.prototype.getEditorForMetric=function(e){return this.$state.get("ruleEditors").find(function(t){return t.get("ruleId")===e})};s.addRuleEditor=function(e,t,i){var r=new u({editorId:t}),n,o,a=s.getRuleEditor(e,t);if(a){return e}if(i){n=e.getIn(["storedRules","primary",i]);o=e.getIn(["storedRules","inverses",i]);if(n){r=r.set("formula",n).set("ruleId",i).set("isEditing",false)}if(o){r=r.set("inverseEditors",o.map(function(e,t){return new c({editorId:t,formula:e,isEditing:false,isEditable:true})}))}}return e.setIn(["ruleEditors",t],r)};s.getRuleEditor=function(e,t){return e.getIn(["ruleEditors",t])};s.findInverseEditorIndex=function(e,t){return e.get("inverseEditors",r.List()).findIndex(function(e){return e.get("editorId")===t})};s.updateRuleEditor=function(e,t,i){var r=s.getRuleEditor(e,t);if(r){return e.updateIn(["ruleEditors",t],i)}else{return e}};s.updateInverseEditor=function(e,t,i){var r=s.findInverseEditorIndex(e,t);if(r!==-1){return e.updateIn(["inverseEditors",r],i)}else{return e}};s.addInverseEditor=function(e,t){return this.updateRuleEditor(e,t,function(e){var t=e.get("inverseEditors",r.List()),i=t.count();return e.set("inverseEditors",t.push(new c({editorId:i,isEditing:true,isEditable:true})))})};s.removeInverseEditor=function(e,t,i){return this.updateRuleEditor(e,t,function(e){var t=s.findInverseEditorIndex(e,i);e=e.deleteIn(["inverseEditors",t]);if(!s.isEditing(e)){e=e.delete("error")}return e})};s.enterEditMode=function(e,t,i){return this.editInverseFormula(e,t,i)};s.editPrimaryFormula=function(e,t,i){return this.updateRuleEditor(e,t,function(e){return e.set("value",i).set("isEditing",true)})};s.editInverseFormula=function(e,t,i,r){var n=this.updateInverseEditor;return this.updateRuleEditor(e,t,function(t){return n(t,i,function(n){var o=t.get("ruleId"),a;if(!r){a=e.getIn(["storedRules","inverses",o,i]);r=a&&a.toString()}return n.set("value",r).set("isEditing",true)})})};s.clearAllEdits=function(e,t){return this.updateRuleEditor(e,t,function(e){return e.delete("value").set("isEditing",false).delete("error").update("inverseEditors",r.List(),function(e){return e.map(function(e){return e.delete("value").set("isEditing",false)})})})};s.setRuleId=function(e,t,i){return this.updateRuleEditor(e,t,function(e){return e.set("ruleId",i)})};s.isEditing=function(e){if(e.get("isEditing")){return true}return e.get("inverseEditors",r.List()).some(function(e){return e.get("isEditing")})};s.clearInverseFormulaEdits=function(e,t,i){var r=this.updateInverseEditor;return this.updateRuleEditor(e,t,function(e){e=r(e,i,function(e){return e.delete("value").set("isEditing",false)});if(!s.isEditing(e)){e=e.delete("error")}return e})};s.setRuleError=function(e,t,i){return this.updateRuleEditor(e,t,function(e){return e.set("error",i)})};s.loadRules=function(e,t){var i=s.updateFormulas(e.get("ruleEditors"),t);return e.set("storedRules",t).set("ruleEditors",i)};s.updateFormulas=function(e,t){return e.map(function(e){var i=e.get("ruleId"),r=t.getIn(["primary",i]),n=t.getIn(["inverses",i]);if(r){e=e.set("formula",r)}if(n){e=e.set("inverseEditors",n.map(function(t,i){var r=e.getIn(["inverseEditors",i]);return r.set("formula",t)}))}return e})};s.prototype.getLatestPrimaryFormula=function(e){var t=s.getRuleEditor(this.$state,e),i=t&&t.get("value"),r=t.get("formula");return i||r&&r.toString()};s.prototype.getLatestInverseFormulas=function(e){var t=s.getRuleEditor(this.$state,e);return t.get("inverseEditors",r.List()).map(function(e){var t=e.get("value"),i=e.get("formula");return t||i&&i.toString()||""}).filter(a.identity).toArray()};var d=s.Events=o("MeasureLanguageStore",["CHANGE"]);var p=s.Actions=o("MeasureLanguageStore",["LOAD_RULES","ADD_RULE_EDITOR","ENTER_EDIT_MODE","CLEAR_INVERSE_FORMULA_EDITS","ADD_INVERSE_EDITOR","REMOVE_INVERSE_EDITOR","EDIT_PRIMARY_FORMULA","EDIT_INVERSE_FORMULA","SAVE_RULE","CLEAR_ALL_EDITS","SET_RULE_ID","RULE_INSTALL_ERROR"]);t.exports=s},{"../event_emitter":289,"./store":352,immutable:"immutable",lodash:70}],344:[function(e,t,i){"use strict";var r=e("immutable");var n=e("../event_emitter").EventEmitter;var o=e("lodash");var a=e("./store").createConstant;var s=e("../measuremodel");function l(e){var t=this;this.$serverModel=null;this.$measureModel=null;this.dispatcherIndex=e.register(function(e){var i=e.action;switch(i.actionType){case c.SET_MODEL:t.$setModel(i.model);break;case c.EDIT_MODEL:t.$editModel();break;case c.ADD_LEVEL_ERROR:t.$addLevelError(i.levelName,i.error);break;case c.SET_MEASURE_PROPERTIES_ERROR:t.$setMeasurePropertiesError();break}})}o.mixin(l.prototype,n.prototype);l.prototype.$addLevelError=function(e,t){this._emit(u.ADD_LEVEL_FAILED,{levelName:e,error:t})};l.prototype.$setMeasurePropertiesError=function(){this._emit(u.SET_MEASURE_PROPERTIES_FAILED)};l.prototype.$editModel=function(){this._emit(u.CHANGED)};l.prototype.$setModel=function(e){this.$serverModel=r.fromJS(e);this.$measureModel=new s(this.$serverModel);this._emit(u.CHANGED)};l.prototype.getModel=function(){return this.$measureModel};l.prototype.getServerModel=function(){return this.$serverModel};l.prototype.destroy=function(){this.$serverModel=null;this.$measureModel=null};var u=a("MeasureModel",["CHANGED","ADD_LEVEL_FAILED","SET_MEASURE_PROPERTIES_FAILED"]);var c=a("MeasureModel",["SET_MODEL","ADD_LEVEL_ERROR","EDIT_MODEL","SET_MEASURE_PROPERTIES_ERROR"]);i.MeasureModelStore=l;i.MeasureModelEvents=u;i.MeasureModelActions=c},{"../event_emitter":289,"../measuremodel":303,"./store":352,immutable:"immutable",lodash:70}],345:[function(e,t,i){"use strict";var r=e("assert");var n=e("lodash");var o=e("../constant").CHANGE_EVENT;var a=e("../event_emitter").EventEmitter;var s=e("../constant").ModalWindowActions;var l=e("../constant").ModalWindows.Specs;var u=e("../constant").ModalWindows.RenderPolicy;n.mixin(c.prototype,a.prototype);function c(e){var t=this;t.$windows={};t.$index=0;this.dispatcherIndex=e.register(function(e){var i=e.action;switch(i.actionType){case s.OPEN_WINDOW:t.$openWindow(i.windowType,i.options);break;case s.CLOSE_WINDOW:t.$closeWindow(i.windowType,i.windowId);break}})}c.prototype.$openWindow=function(e,t){r(l[e],"Modal window with a type "+e+" isn't registered.");t=t||{};r(!t.modelerApp,"Please ensure that you don't provide modelerApp as an option when opening a modal window.");if(!this.$windows[e]){this.$windows[e]=[]}var i=n.uniqueId("ModalWindowStore");switch(l[e].renderPolicy){case u.APPEND:this.$appendWindow(i,e,t);break;default:this.$replaceWindow(i,e,t)}this._emit(o)};c.prototype.$replaceWindow=function(e,t,i){this.$windows[t]=[this.$buildWindowSpec(e,t,i)]};c.prototype.$appendWindow=function(e,t,i){this.$windows[t].push(this.$buildWindowSpec(e,t,i))};c.prototype.$buildWindowSpec=function(e,t,i){return{id:e,index:this.$index++,type:t,options:i}};c.prototype.$closeWindow=function(e,t){n.remove(this.$windows[e],function(e){return e.id===t});this._emit(o)};c.prototype.getModalWindows=function(){return{views:this.$windows}};t.exports=c},{"../constant":256,"../event_emitter":289,assert:2,lodash:70}],346:[function(e,t,i){"use strict";var r=e("../event_emitter").EventEmitter;var n=e("lodash");var o=e("../constant").Collaboration.UPDATE_INTERVALS;var a=e("../constant").UserActivity.IDLE_TIME_VALUES;n.mixin(s.prototype,r.prototype);function s(e,t){this.$config=t;this.$collaborationConfig=this.$config&&this.$config.collaboration;this.$idleTimeValuesConfig=this.$config&&this.$config.idleTimeValues}s.prototype.getIdleNotificationTime=function(){return this.$idleTimeValuesConfig&&this.$idleTimeValuesConfig.idleNotificationTime||a.NOTIFICATION_TIME};s.prototype.getIdleLogoutTime=function(){return this.$idleTimeValuesConfig&&this.$idleTimeValuesConfig.idleLogoutTime||a.LOGOUT_TIME};s.prototype.getIgnoreBroadcastingTime=function(){return this.$idleTimeValuesConfig&&this.$idleTimeValuesConfig.ignoreBroadcastingTime||a.IGNORE_BROADCASTING_TIME};s.prototype.canEditSchema=function(){return this.$config&&this.$config.editSchema||false};s.prototype.canEditRules=function(){return this.$config&&this.$config.editRules||false};s.prototype.getChartActions=function(){return this.$config&&this.$config.chart||{}};s.prototype.getMinUpdateInterval=function(){return this.$collaborationConfig&&this.$collaborationConfig.minUpdateInterval||o.MIN};s.prototype.getMaxUpdateInterval=function(){return this.$collaborationConfig&&this.$collaborationConfig.maxUpdateInterval||o.MAX};i.ModelerOptionStore=s},{"../constant":256,"../event_emitter":289,lodash:70}],347:[function(e,t,i){"use strict";var r=e("../event_emitter").StoreEventEmitter;var n=e("../mac_validation");var o=e("lodash");var a=e("./store").createConstant;function s(e,t,i){var r=this;this.$measureModelStore=t;this.$fieldStore=i;this.$views={};this.dispatcherIndex=e.register(function(e){var t=e.action;switch(t.actionType){case u.SET_VIEW_TASK_CONFIG:r.$setViewTaskConfig(t.viewId,t.taskName,t.config);break;case u.SET_VIEW_TASK_ACTIVE:r.$setViewTaskActive(t.viewId,t.taskName);break;case u.SET_VIEW_TASK_INACTIVE:r.$setViewTaskInactive(t.viewId,t.taskName);break;case u.SET_VIEW_INACTIVE:r.$setViewInactive(t.viewId);break}})}o.mixin(s.prototype,r.prototype);s.prototype.$getOrCreateViewStorage=function(e){if(!this.$views[e])this.$views[e]={};return this.$views[e]};s.prototype.$setViewTaskConfig=function(e,t,i){if(i.maConfig){this.validateViewConfig(i.maConfig,true)}this.$getOrCreateViewStorage(e)[t]={active:true,config:i};this._emit(e,l.CHANGED)};s.prototype.getViewTaskConfig=function(e,t){var i=this.$views[e]&&this.$views[e][t];return i&&i.config};s.prototype.viewIsActive=function(e){return this.$views[e]&&o.every(this.$views[e],function(e){return e.active===true})};s.prototype.getActiveViewTasks=function(){return this.getViewTasks(true)};s.prototype.getViewTasks=function(e){e=e||false;var t=[],i=this;Object.keys(this.$views).forEach(function(r){var n=i.$views[r];Object.keys(n).forEach(function(i){if(!e||e&&n[i].active){t.push({viewId:r,taskName:i})}})});return t};s.prototype.viewTaskIsActive=function(e,t){var i=this.$views[e]&&this.$views[e][t];return!!i&&i.active===true};s.prototype.$setViewInactive=function(e){var t=this.$views[e];if(t){this.$views[e]=o.mapValues(t,function(e){return Object.assign({},e,{active:false})});this._emit(e,l.CHANGED)}};s.prototype.$setViewTaskActive=function(e,t){var i=this.$views[e]&&this.$views[e][t];if(i){this.$views[e][t]=Object.assign({},i,{active:true});this._emit(e,l.CHANGED)}};s.prototype.$setViewTaskInactive=function(e,t){var i=this.$views[e]&&this.$views[e][t];if(i){this.$views[e][t]=Object.assign({},i,{active:false});this._emit(e,l.CHANGED)}};s.prototype.validateViewConfig=function(e,t){var i=[],r=this.$measureModelStore.getModel();i=i.concat(n.validateRollupConfigs(e,r));if(i.length&&t)throw new Error("Invalid MultiAxis Config set!\nReasons:\n"+i.map(function(e){return"\t"+e+"\n"}).join(""));return i};var l=a("MultiAxisStore",["CHANGED"]);var u=a("MultiAxis",["SET_VIEW_TASK_CONFIG","SET_VIEW_TASK_ACTIVE","SET_VIEW_TASK_INACTIVE","SET_VIEW_INACTIVE"]);t.exports.MultiAxisConfigStore=s;t.exports.MultiAxisConfigEvents=l;t.exports.MultiAxisConfigActions=u},{"../event_emitter":289,"../mac_validation":301,"./store":352,lodash:70}],348:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("../cubiql");var a=e("measure-query-gen/src/MQG");var s=e("../querygen/query");var l=e("../querygen/util");var u=e("../querygen/filter");var c=e("./store").createConstant;var d=e("./logstore").LogEvents;var p=e("../constant/messages.js");var f=e("../constant").StorageTypes;var h=e("../event_emitter").EventEmitter;var g=e("../util");var m=e("../dataStorage");var v=e("./measuremodelstore").MeasureModelActions;var y=e("./multiaxisconfigstore").MultiAxisConfigActions;var b=e("./pivotconfigstore").PivotConfigActions;var w=e("../multiaxis/query_data");var C=e("../multiaxis/data_warehouse");var E=e("../multiaxis/edit_data").EditDataBox;var S=e("../multiaxis/keymanager");var T=e("../multiaxisconfig");var x=e("../multiaxis/dataprocessor").DataProcessor;var _=e("../multiaxis/viewtask");n.mixin(M.prototype,h.prototype);function M(e,t){var i=this;this.$measureModelStore=t.measureModelStore;this.$fieldStore=t.fieldStore;this.$macStore=t.multiAxisConfigStore;this.$pivotConfigStore=t.pivotConfigStore;this.$logActionHandler=t.logActionHandler;this.$primeDataBox=new w;this.$dataBoxesWithNewData=new Map;this.$keyManager=new S;this.$viewTaskManager=new _(this.$keyManager);this.$measureQueryQueryRunning={};this.$measureQueryPositionQueryRunning=new Map;this.$suspectQueryIncidents={};this.$brokenQueries={};this.$successfulQueries={};this.$viewStorage=new Map;this.$initializeEditStorage();this.$cancellationTime={};this.$previousViewTaskMAConfigs=new Map;this.dispatcherIndex=e.register(function(t){var r=t.action;switch(r.actionType){case v.SET_MODEL:e.waitFor([i.$measureModelStore.dispatcherIndex],function(){i.$handleModelChanges()});break;case b.SET_CONFIG:e.waitFor([i.$pivotConfigStore.dispatcherIndex],function(){i.$handlePivotConfigChanges()});break;case D.SET_VIEW_TASK_RANGE:e.waitFor([i.$macStore.dispatcherIndex],function(){i.$setViewTaskRange(r.viewId,r.taskName,r.range)});break;case y.SET_VIEW_TASK_CONFIG:e.waitFor([i.$macStore.dispatcherIndex],function(){i.$handleConfigChange(r.viewId,r.taskName)});break;case y.SET_VIEW_TASK_ACTIVE:e.waitFor([i.$macStore.dispatcherIndex],function(){i.$handleConfigChange(r.viewId,r.taskName)});break;case y.SET_VIEW_TASK_INACTIVE:e.waitFor([i.$macStore.dispatcherIndex],function(){i.$handleConfigChange(r.viewId,r.taskName)});break;case D.LOAD_OUTSTANDING_DATA_REQUEST:i.$loadOutstandingDataRequest(r.processor,r.response,r.dataRequest);break;case D.SET_DATA_REQUEST_RUNNING:r.dataRequest.measureQueryPositions.forEach(function(e){var t=e.unmodifiedQuery;e.positionInfos.forEach(function(e){i.$setMeasureQueryPositionHasQueryRunning({query:t,positionInfo:e})})});r.dataRequest.measureQueries.forEach(function(e){i.$setMeasureQueryHasQueryRunning(e)});break;case D.STORE_PENDING_EDITS:i.$storePendingEdits(r.edits);break;case D.CLEAR_EDITS:i.$clearEdits(r.edits);break;case D.MARK_EDITS_FOR_COMMIT:i.$markEditsForCommit(r.edits);break;case D.MARK_EDITS_IN_FLIGHT:i.$markEditsInFlight();break;case D.MARK_EDITABILITY_IN_FLIGHT:i.$markEditabilityInFlight();break;case D.SET_EDITS_SUCCESSFUL:i.$setEditsSuccessful(r.edits);break;case D.SET_EDITS_FAILED:i.$setEditsFailed(r.edits,r.error);break;case D.SET_EDITABILITY_STATUS:i.$setEditabilityStatus(r.request,r.response);break;case D.SET_DATA_REQUEST_FINISHED:i.$onDataRequestFinished(r.dataRequest);break;case D.SET_DATA_REQUEST_FAILED:i.$onDataRequestFailed(r.dataRequest,r.error);break;case D.SET_LOCKS:i.$setLocks(r.locks);break;case D.UNSET_LOCKS:i.$unsetLocks(r.locks);break;case D.CLEAR_ALL_LOCKS:i.$clearAllLocks();break;case D.MARK_ALL_DATA_DIRTY:i.$markAllPositionsDirty(r.pivotIds);break}});this.$scheduleDataRequest()}M.prototype.$scheduledDataRequest=null;var A=40;M.prototype.$scheduleDataRequest=function(){var e=this,t=function(){e._emit(O.DATA_REQUEST_TIMER_FIRED);e.$scheduleDataRequest()};clearTimeout(this.$scheduledDataRequest);this.$scheduledDataRequest=setTimeout(t,A)};M.prototype.getModel=function(){return this.$measureModelStore.getModel()};M.prototype.getMetricConfigs=function(){return this.$pivotConfigStore.getMetricsConfig()};M.prototype.getViewTaskManager=function(){return this.$viewTaskManager};M.prototype.getKeyManager=function(){return this.$keyManager};M.prototype.getPrimeDataBox=function(){return this.$primeDataBox};M.prototype.$handleModelChanges=function(){this.$reinitializeViewTasks();this.getEditDataBox().markAllEditabilityDirty()};M.prototype.$handlePivotConfigChanges=function(){this.$reinitializeViewTasks()};M.prototype.$handleConfigChange=function(e,t){var i=this,n,o,a,s,l,u;if(this.$macStore.viewTaskIsActive(e,t)){this.$initializeStateForViewTask(e,t);this.$requestUnmaskedViewTaskQueries(e,t);l=this.$keyManager.calcViewTaskKey(e,t);u=this.$getViewTaskMAConfig(e,t);if(u){if(!r.is(u,this.$previousViewTaskMAConfigs.get(l))){this.$generateViewTaskHeadingData(e,t)}this.$notifyTaskDataChanged([{viewId:e,tasks:[t]}]);this.$previousViewTaskMAConfigs.set(l,u)}else{this.$previousViewTaskMAConfigs.delete(l)}}else{n=this.$getViewTaskDataBox(e,t);if(n){o=i.$getDependentViewTasksForDataBox(n,true);a=o.filter(function(e){return i.$macStore.viewTaskIsActive(e.viewId,e.taskName)});if(o.length===1&&o[0].viewId===e&&o[0].taskName===t){this.$removeDataBoxFor(e,t)}else if(o.length>1){s=a.length>0;if(!s){this.$clearDataBoxCache(e,t)}n.initializeRequiredQueries();a.forEach(function(e){i.$requestUnmaskedViewTaskQueries(e.viewId,e.taskName);i.$updateMaskedRange(e.viewId,e.taskName)})}}this.getViewTaskManager().clearDataCache(e,t)}};M.prototype.$getOrCreateViewStorage=function(e){if(!this.$viewStorage.has(e))this.$viewStorage.set(e,this.$createInitialStateForView(e));return this.$viewStorage.get(e)};M.prototype.$createInitialStateForView=function(){return new Map};M.prototype.$getOrCreateViewTask=function(e,t){var i=this.$getOrCreateViewStorage(e);if(!i.has(t))this.$initializeStateForViewTask(e,t);return i.get(t)};M.prototype.$initializeStateForViewTask=function(e,t){var i=this.$getOrCreateViewStorage(e),r=this.$createInitialStateForViewTask(e,t);if(r)i.set(t,r)};M.prototype.$createInitialStateForViewTask=function(e,t){var i=this.$macStore.getViewTaskConfig(e,t);if(i)return{viewId:e,taskName:t,taskConfig:i,queryDataBox:i.isolatedData?new w:this.getPrimeDataBox(),processor:i.maConfig&&new x(i.maConfig,this.getModel(),this.getMetricConfigs(),i.isUnmasked)}};M.prototype.$removeDataBoxFor=function(e,t){this.$getOrCreateViewTask(e,t).queryDataBox=null;this.$getOrCreateViewStorage(e).delete(t)};M.prototype.$clearDataBoxCache=function(e,t){this.$getOrCreateViewTask(e,t).queryDataBox.clearDataCache()};M.prototype.$reinitializeViewTasks=function(){var e=this;this.$macStore.getActiveViewTasks().forEach(function(t){e.$initializeStateForViewTask(t.viewId,t.taskName)})};M.prototype.$notifyTaskDataChanged=function(e){this._emit(O.DATA_CHANGED,{viewTasks:e.length?e:undefined})};M.prototype.$loadOutstandingDataRequest=function(e,t,i){var r=this,n=this.getKeyManager(),o=new Map;i.measureQueries.forEach(function(a){var s=r.$loadMeasureQuery(a,e,t,i.queryTime),l=n.calcMeasureQueryCacheKey(a);s.forEach(function(e){if(!o.has(e)){o.set(e,{maskedQueriesCacheKeys:[],unmaskedQueriesCacheKeys:[]})}o.get(e).unmaskedQueriesCacheKeys.push(l)})});i.measureQueryPositions.forEach(function(a){var s=r.$loadMeasureQueryPositions(a,e,t,i.queryTime),l=n.calcMeasureQueryCacheKey(a.unmodifiedQuery);s.forEach(function(e){if(!o.has(e)){o.set(e,{maskedQueriesCacheKeys:[],unmaskedQueriesCacheKeys:[]})}o.get(e).maskedQueriesCacheKeys.push(l)})});o.forEach(this.$markDataBoxHasNewData.bind(this))};M.prototype.$onDataRequestFinished=function(e){var t=this,i=[];e.measureQueryPositions.forEach(function(e){var r=e.unmodifiedQuery;e.positionInfos.forEach(function(e){t.$unsetMeasureQueryPositionHasQueryRunning({query:r,positionInfo:e})});t.$markMeasureQuerySuccessful(r);i.push(r)});e.measureQueries.forEach(function(e){t.$unsetMeasureQueryHasQueryRunning(e);t.$markMeasureQuerySuccessful(e);i.push(e)});this.$handleDataBoxChanges()};M.prototype.$onDataRequestFailed=function(e,t){var i=this,r=e.measureQueryPositions.length+e.measureQueries.length===1;e.measureQueryPositions.forEach(function(e){var n=e.unmodifiedQuery;i.$markMeasureQuerySuspect(n,t);if(r)i.$markMeasureQueryBroken(n);
e.positionInfos.forEach(function(e){i.$unsetMeasureQueryPositionHasQueryRunning({query:n,positionInfo:e})})});e.measureQueries.forEach(function(e){i.$markMeasureQuerySuspect(e,t);if(r)i.$markMeasureQueryBroken(e);i.$unsetMeasureQueryHasQueryRunning(e)})};M.prototype.getHeadingData=function(e,t){return this.getViewTaskManager().getHeadingData(e,t)};M.prototype.$setViewTaskRange=function(e,t,i){var r=this.$getOrCreateViewTask(e,t),n=false;if(r&&!I(r.configuredRange,i)){r.configuredRange=i;n=this.$updateMaskedRange(e,t);if(n){this.$notifyTaskDataChanged([{viewId:e,tasks:[t]}])}}};function I(e,t){return JSON.stringify(e)===JSON.stringify(t)}M.prototype.$updateMaskedRange=function(e,t){var i=this.$getViewTaskDataBox(e,t),r=this.$getViewTaskRange(e,t),n=this.getEditDataBox(),o=this.$getViewTaskProcessor(e,t),a,s,l,u=this.getViewTaskManager(),c=this.$getViewTaskConfig(e,t),d,p=0,f;if(c.isUnmasked||!r){return false}u.dissociateAllMetricInters(e,t);s=o.getRequiredMaskedQueries(this.getDataWarehouseForViewTask(e,t),r);for(;p<s.length;p++){l=s[p];for(f=0;f<l.positionInfos.length;f++){i.markMaskedQueryPositionRequired(l.query,l.queryKey,l.positionInfos[f])}if(l.editableMetricInters){for(f=0;f<l.editableMetricInters.length;f++){d=l.editableMetricInters[f];u.associateMetricInter(e,t,d);a|=n.markEditabilityRequired(d)}}}u.getDereferencedMetricInters().forEach(function(e){n.unmarkEditabilityRequired(e)});return a};M.prototype.$getViewTaskRange=function(e,t){var i=this.$getOrCreateViewTask(e,t);return i&&i.configuredRange};M.prototype.$getViewTaskMAConfig=function(e,t){return this.$macStore.getViewTaskConfig(e,t)};M.prototype.getDataRange=function(e,t,i,r,n,o,a){var s=this.getDataWarehouseForViewTask(e,t),l=this.$getViewTaskProcessor(e,t);return l.getDataRange(i,r,n,s,o,a)};M.prototype.getDataAt=function(e,t,i,r){var n={},o=Object.keys(i),a=0,s=o.length,l,u;for(;a<s;a++){u=o[a];n[u]={start:i[u],length:1}}l=this.getDataRange(e,t,n,r,true);if(l.dataArray.length)return l.dataArray[0]};M.prototype.getCellInfoInRange=function(e,t,i){var r=this.getDataWarehouseForViewTask(e,t),n=this.$getViewTaskProcessor(e,t);return n.getCellInfoInRange(i,r)};M.prototype.getCellInfoAt=function(e,t,i){var r={},n=Object.keys(i),o=0,a=n.length,s;for(;o<a;o++){s=n[o];r[s]={start:i[s],length:1}}return this.getCellInfoInRange(e,t,r).dataArray[0]};M.prototype.$mkCellDataBuilder=function(e){var t=this,i=this.$calcEditabilityStateKey(this.getCurrentEditState());return function(r){return r&&t.getCellDataForInfo(e,r,i)||undefined}};M.prototype.$initializeEditStorage=function(){var e=this,t=new m("multiaxisdatastore","locks",f.IN_MEMORY);t.subscribe(function(){e.$notifyTaskDataChanged([])});this.$editDataBox=new E(this.getKeyManager(),t)};M.prototype.destroy=function(){this.$editDataBox.destroy();this.$editDataBox=null;clearTimeout(this.$scheduledDataRequest)};M.prototype.getEditDataBox=function(){return this.$editDataBox};M.prototype.$removeEdit=function(e){this.getEditDataBox().removeEdit(e)};M.prototype.getAllPendingEdits=function(){return this.getEditDataBox().getAllPendingEdits()};M.prototype.$storePendingEdits=function(e){this.getEditDataBox().storePendingEdits(e);this.$notifyTaskDataChanged([])};M.prototype.$clearEdits=function(e){this.getEditDataBox().removePendingEdits(e);this.$notifyTaskDataChanged([])};M.prototype.getNextQueuedEdits=function(){return this.getEditDataBox().getEditQueue()[0]};M.prototype.$markEditsInFlight=function(){this.$editsInFlight=true};M.prototype.$markEditabilityInFlight=function(){this.$editabilityInFlight=true};M.prototype.$markEditsNotInFlight=function(){this.$editsInFlight=false};M.prototype.$markEditabilityNotInFlight=function(){this.$editabilityInFlight=false};M.prototype.hasInflightEdits=function(){return this.$editsInFlight===true};M.prototype.hasInflightEditability=function(){return this.$editabilityInFlight===true};M.prototype.$markEditsForCommit=function(e){this.getEditDataBox().markEditsForCommit(e);this.$notifyTaskDataChanged([])};M.prototype.getOutstandingEditabilityRequest=function(){var e=this.getEditDataBox().getOutstandingEditabilityNeeds(),t=e.editState.map(o.cloneMetricIntersection),i=e.metricInters.filter(function(e){return!o.findMetricInter(t,e)});if(e.metricInters.length){return{serviceRequest:new a.EditabilityRequestRequest(new a.EditabilityRequest(t,i)),checkedMetricInters:i,editabilityState:t}}};M.prototype.$setEditabilityStatus=function(e,t){var i=this.getEditDataBox(),r=t.consistent,n=t.editable||[],a=false;if(!r){this.$logActionHandler.warn(d.DATA_PROCESSING_ERROR,p.INCONSISTENT_EDIT_ERROR,t)}e.checkedMetricInters.forEach(function(t){var s=!r||!o.findMetricInter(n,t);i.storeEditability(e.editabilityState,t,!s);a=true});e.editabilityState.forEach(function(t){i.storeEditability(e.editabilityState,t,r);a=true});this.$markEditabilityNotInFlight();if(a)this.$notifyTaskDataChanged([])};M.prototype.getOutstandingDataRequests=function(){var e=this,t=[],i=[],r,n=[];this.getAllQueryDataBoxes().forEach(function(r){r.getOutstandingUnmaskedQueries().forEach(function(i){if(!e.$measureQueryHasQueryRunning(i)&&!e.$queryIsBroken(i))t.push(i)});r.getOutstandingMaskedQueryPositions().forEach(function(t){if(!e.$measureQueryPositionHasQueryRunning(t)&&!e.$queryIsBroken(t.query))i.push(t)})});r=this.$createSuspectQueryGroups(t,i);if(r.lessSuspect.measureQueries.length||r.lessSuspect.measureQueryPositions.length)n=[].concat(n,this.$makeDataRequests(r.lessSuspect.measureQueries,r.lessSuspect.measureQueryPositions));if(r.moreSuspect.measureQueries.length||r.moreSuspect.measureQueryPositions.length)n=[].concat(n,this.$makeDataRequests(r.moreSuspect.measureQueries,r.moreSuspect.measureQueryPositions));if(r.mostSuspect.measureQueries.length||r.mostSuspect.measureQueryPositions.length)n=[].concat(n,this.$makeDataRequests(r.mostSuspect.measureQueries,r.mostSuspect.measureQueryPositions));return n};M.prototype.$makeDataRequests=function(e,t){var i=this,r,o,a,l=this.getModel();if(n.isUndefined(l)){return[]}r=n.mapValues(n.groupBy(t,function(e){return i.$calcMeasureQueryCacheKey(e.query)}),function(e){return{query:s.cloneMeasureQuery(e[0].query),unmodifiedQuery:e[0].query,positionInfos:n.map(e,"positionInfo")}});e.forEach(function(e){var t=i.$calcMeasureQueryCacheKey(e);delete r[t]});o=[].concat(e,n.values(r).map(function(e){return i.$applyPositionsFilterToMeasureQuery(e.query,e.positionInfos)}));if(o.length>0){a=s.measureQueriesToServiceQueries(o,l);return[{serviceRequest:s.serviceQueriesToServiceRequest(a,l),measureQueries:e,measureQueryPositions:n.values(r)}]}else{return[]}};M.prototype.$applyPositionsFilterToMeasureQuery=function(e,t){if(t.length===0||e.mappedInter.qualified_level.length===0)return e;var i=t[0].position,r=Object.keys(i),n=e.mappedInter.qualified_level.filter(function(e){return r.indexOf(T.mqgLevelToQName(e))>-1}),s=o.sortIntersectionByLabel(new a.Intersection(n)),l=s.qualified_level.map(function(e){return T.mqgLevelToQName(e)}),c=l.length,d,p=new u.FilterGenerator(this.getModel()),f=[];t.forEach(function(e){var t=0,i=e.position,r,n=[];for(;t<c;t++){r=i[l[t]];if(r!==undefined)n.push(r)}if(n.length)f.push(n)});d=new u.PositionFilter(s,[new u.RelationComparison("=",u.genRelationName(s,f),s,f)]);p.applyPositionFilterToMeasureQuery(e,d);return e};M.prototype.$markMeasureQuerySuccessful=function(e){var t=this.$calcMeasureQueryCacheKey(e);this.$successfulQueries[t]=true};M.prototype.$queryIsBroken=function(e){var t=this.$calcMeasureQueryCacheKey(e);return this.$queryIsBrokenByKey(t)};M.prototype.$queryIsBrokenByKey=function(e){return this.$brokenQueries[e]===true};M.prototype.$markMeasureQueryBroken=function(e){var t=this.$calcMeasureQueryCacheKey(e);console.error("ERROR, this query was isolated as failing for some reason.  Please send the following console log to technical support.");console.error("QUERY:",e);console.error("stringified query: "+l.stringifyMeasureQuery(e));console.error("Encountered the following errors:");n.uniq(this.$suspectQueryIncidents[t]).forEach(function(e){console.error(l.formatServiceError(e))});this.$brokenQueries[t]=true;this._emit(O.DATA_CHANGED)};M.prototype.$markMeasureQuerySuspect=function(e,t){var i=this.$calcMeasureQueryCacheKey(e);if(!this.$suspectQueryIncidents[i])this.$suspectQueryIncidents[i]=[];this.$suspectQueryIncidents[i].push(t)};M.prototype.$createSuspectQueryGroups=function(e,t){var i=this,r=t.reduce(function(e,t){var i=e[t.queryKey];if(!i){i=e[t.queryKey]=[]}i.push(t);return e},{}),o=Object.keys(r),a=[].concat(e,n.values(r)),s=e.map(function(e){return this.$calcMeasureQueryCacheKey(e)},this).concat(o),l=s.filter(function(e){return(i.$suspectQueryIncidents[e]||[]).length===0}),u=s.filter(function(e){return(i.$suspectQueryIncidents[e]||[]).length>0}),c=n.sortBy(u,function(e){var t=i.$suspectQueryIncidents[e]||[],r=i.$successfulQueries[e]===true;return t.length/(r?1:.1)}),d=Math.floor(c.length/2),p=[].concat(l,c.slice(0,d)),f=a.filter(function(e,t){return p.indexOf(s[t])>-1}),h=c.slice(d),g,m,v,y=function(e){return n.isArray(e)},b=function(e){return e&&e.$queryKey};if(h.length>1){m=h.pop();v=a[s.indexOf(m)]}g=a.filter(function(e,t){return h.indexOf(s[t])>-1});return{lessSuspect:{measureQueries:f.filter(b),measureQueryPositions:[].concat.apply([],f.filter(y))},moreSuspect:{measureQueries:g.filter(b),measureQueryPositions:[].concat.apply([],g.filter(y))},mostSuspect:{measureQueries:b(v)?[v]:[],measureQueryPositions:!b(v)?v||[]:[]}}};M.prototype.$cancelInFlightQueryByKey=function(e){this.$cancellationTime[e]=new Date};M.prototype.getQueryCancellationTimeByKey=function(e){return this.$cancellationTime[e]};M.prototype.$clearCancellationByKey=function(e){delete this.$cancellationTime[e]};M.prototype.$clearAllCancellations=function(){this.$cancellationTime={}};M.prototype.$setEditsSuccessful=function(e){var t=this,i=this.getEditDataBox().onEditsSucceeded(e);i.forEach(function(e,i){var r=e.positionInfos,n=e.resultTable;t.$getDataBoxesForMaskedMeasureQueryKey(i).forEach(function(e){e.storeResultTableForPositions(i,r,n,true)})});this.$markEditsNotInFlight();this.$markAllPositionsDirty();this.$notifyTaskDataChanged([])};M.prototype.$setEditsFailed=function(e,t){this.getEditDataBox().onEditsFailed(e);this.$markEditsNotInFlight();if(l.formatServiceError(t).indexOf("Couldn't find editing solution")>-1){this.$logActionHandler.warn(d.DATA_PROCESSING_ERROR,p.INCONSISTENT_NEW_EDITS_ERROR,t)}else{this.$logActionHandler.warn(d.DATA_PROCESSING_ERROR,p.UNEXPECTED_EDIT_ERROR,t)}this.$notifyTaskDataChanged([])};M.prototype.$markDataBoxHasNewData=function(e,t){if(!this.$dataBoxesWithNewData.has(t)){this.$dataBoxesWithNewData.set(t,{maskedQueriesCacheKeys:[],unmaskedQueriesCacheKeys:[]})}this.$dataBoxesWithNewData.get(t).maskedQueriesCacheKeys=this.$dataBoxesWithNewData.get(t).maskedQueriesCacheKeys.concat(e.maskedQueriesCacheKeys);this.$dataBoxesWithNewData.get(t).unmaskedQueriesCacheKeys=this.$dataBoxesWithNewData.get(t).unmaskedQueriesCacheKeys.concat(e.unmaskedQueriesCacheKeys)};M.prototype.$getDependentViewTasksForDataBox=function(e,t){t=t||false;var i=t?this.$macStore.getViewTasks():this.$macStore.getActiveViewTasks(),r,n=[],o=0;for(;o<i.length;o++){r=i[o];if(e===this.$getViewTaskDataBox(r.viewId,r.taskName))n.push(r)}return n};M.prototype.$handleDataBoxChanges=function(){var e=new Map,t=this.getKeyManager(),i=n.property("queryKey"),r=this;this.$dataBoxesWithNewData.forEach(function(n,o){var a=r.$getDependentViewTasksForDataBox(o);a.forEach(function(o){var a=o.viewId,s=o.taskName,l=r.$getViewTaskRange(a,s),u=r.$getRequiredQueriesForRange(a,s,l),c=u.unmaskedQueries.map(t.calcMeasureQueryCacheKey),d=g.findFirstIntersection(n.unmaskedQueriesCacheKeys,c),p,f;if(!d&&u.maskedQueries){p=u.maskedQueries.map(i);f=g.findFirstIntersection(n.maskedQueriesCacheKeys,p)}if(d||f){if(!e.has(a))e.set(a,new Map);if(r.$getViewTaskMAConfig(a,s)){if(d&&!e.get(a).has(s))r.$generateViewTaskHeadingData(a,s);r.$notifyTaskDataChanged([{viewId:a,tasks:[s]}])}e.get(a).set(o.taskName,true)}})});this.$dataBoxesWithNewData=new Map};M.prototype.$calcMeasureQueryCacheKey=function(e){if(!e.$queryKey){e.$queryKey=l.stringifyMeasureQuery(e)}return e.$queryKey};M.prototype.$unsetMeasureQueryHasQueryRunning=function(e){var t=this.$calcMeasureQueryCacheKey(e);delete this.$measureQueryQueryRunning[t]};M.prototype.$setMeasureQueryHasQueryRunning=function(e){var t=this.$calcMeasureQueryCacheKey(e);this.$measureQueryQueryRunning[t]=new Date};M.prototype.$measureQueryHasQueryRunning=function(e){var t=this.$calcMeasureQueryCacheKey(e);return!n.isUndefined(this.$measureQueryQueryRunning[t])};M.prototype.$calcMeasureQueryPositionCacheKeyWithKeys=function(e,t){return e+"|"+t};M.prototype.$calcMeasureQueryPositionCacheKey=function(e,t){return this.$calcMeasureQueryPositionCacheKeyWithKeys(this.$calcMeasureQueryCacheKey(e),t.key)};M.prototype.$markAllPositionsDirty=function(){var e=this;this.getAllQueryDataBoxes().forEach(function(e){e.markAllDirty()});Object.keys(this.$measureQueryQueryRunning).forEach(function(t){e.$cancelInFlightQueryByKey(t)});Array.from(this.$measureQueryPositionQueryRunning.keys()).forEach(function(t){e.$cancelInFlightQueryByKey(t)})};M.prototype.$unsetMeasureQueryPositionHasQueryRunning=function(e){var t=this.$calcMeasureQueryCacheKey(e.query),i=e.positionInfo.key,r=this.$measureQueryPositionQueryRunning.get(t);if(r){r.delete(i);if(r.size===0)this.$measureQueryPositionQueryRunning.delete(t)}};M.prototype.$setMeasureQueryPositionHasQueryRunning=function(e){var t=this.$calcMeasureQueryCacheKey(e.query),i=e.positionInfo.key,r=this.$measureQueryPositionQueryRunning.get(t);if(!r){r=new Map;this.$measureQueryPositionQueryRunning.set(t,r)}r.set(i,{time:performance.now(),measureQueryPos:e})};M.prototype.$measureQueryPositionHasQueryRunning=function(e){var t=this.$calcMeasureQueryCacheKey(e.query),i=e.positionInfo.key,r=this.$measureQueryPositionQueryRunning.get(t);return r&&r.has(i)};M.prototype.hasRunningQueries=function(){return Object.keys(this.$measureQueryQueryRunning).length>0||this.$measureQueryPositionQueryRunning.size>0};M.prototype.$setLocks=function(e){this.getEditDataBox().setLocks(e)};M.prototype.$unsetLocks=function(e){this.getEditDataBox().unsetLocks(e)};M.prototype.$clearAllLocks=function(){this.getEditDataBox().clearAllLocks()};M.prototype.hasLocks=function(){return this.getEditDataBox().hasLocks()};M.prototype.getLocks=function(){return this.getEditDataBox().getLocks()};M.prototype.$requiredQueriesAreClean=function(e,t){var i=0,r,n;for(;i<t.maskedQueries.length;i++){n=t.maskedQueries[i];for(r=0;r<n.positionInfos.length;r++){if(!e.hasCleanMaskedQueryPosition(n.queryKey,n.positionInfos[r].key)){return false}}}for(i=0;i<t.unmaskedQueries.length;i++){if(!e.hasCleanUnmaskedQueryData(this.getKeyManager().calcMeasureQueryCacheKey(t.unmaskedQueries[i]))){return false}}return true};M.prototype.hasCleanData=function(e,t,i){var r=this.$getViewTaskDataBox(e,t);if(!i){return!r.getOutstandingUnmaskedQueries().length&&!r.getOutstandingMaskedQueryPositions().length}return this.$requiredQueriesAreClean(r,this.$getRequiredQueriesForRange(e,t,i))};M.prototype.hasOutstandingRequestsForViewTask=function(e,t,i){var r=this.$getViewTaskDataBox(e,t);return!this.$requiredQueriesAreClean(r,this.$getRequiredQueriesForRange(e,t,i))};M.prototype.$getRequiredQueriesForRange=function(e,t,i){var r=this.$getViewTaskProcessor(e,t),n=this.$getViewTaskConfig(e,t),o=n.isUnmasked?["HEADER","SELECTED_SLICE","INTERSECTION"]:["HEADER","SELECTED_SLICE"],a={maskedQueries:[],unmaskedQueries:r.generateUnmaskedQueries(o).toArray()};i=i||this.$getViewTaskRange(e,t);if(!n.isUnmasked&&i){a.maskedQueries=r.getRequiredMaskedQueries(this.getDataWarehouseForViewTask(e,t),i)}return a};M.prototype.$getViewTaskProcessor=function(e,t){var i=this.$getOrCreateViewTask(e,t);return i&&i.processor};M.prototype.$getViewTaskDataBox=function(e,t){var i=this.$getOrCreateViewTask(e,t);return i&&i.queryDataBox};M.prototype.$getDataBoxesForUnmaskedMeasureQueryKey=function(e){return this.getAllQueryDataBoxes().filter(function(t){return t.requiresUnmaskedQueryByKey(e)})};M.prototype.$getDataBoxesForMaskedMeasureQueryKey=function(e){return this.getAllQueryDataBoxes().filter(function(t){return t.requiresMaskedQueryPositionForQueryKey(e)})};M.prototype.getAllQueryDataBoxes=function(){var e=this;var t=n.uniq(this.$macStore.getActiveViewTasks().map(function(t){return e.$getViewTaskDataBox(t.viewId,t.taskName)}));return t};M.prototype.$getViewTaskConfig=function(e,t){var i=this.$getOrCreateViewTask(e,t);return i&&i.taskConfig};M.prototype.$getViewTaskMAConfig=function(e,t){return this.$getViewTaskConfig(e,t).maConfig};M.prototype.getDataWarehouseForViewTask=function(e,t){var i=this.$macStore.getViewTaskConfig(e,t);return new C(this.$getViewTaskDataBox(e,t),this.getEditDataBox(),this.getViewTaskManager().getHeadingData(e,t),Object.keys(this.$brokenQueries),!!i.doNotUseViewCache?undefined:this.getViewTaskManager().getDataCache(e,t))};M.prototype.$requestUnmaskedViewTaskQueries=function(e,t){var i=this.$getViewTaskConfig(e,t),r=this.$getViewTaskProcessor(e,t),n=this.$getViewTaskDataBox(e,t),o=["HEADER","SELECTED_SLICE"],a=this,s;if(i.isUnmasked){o.push("INTERSECTION")}s=r.generateUnmaskedQueries(o);s.forEach(function(e){n.markMeasureQueryRequired(a.$calcMeasureQueryCacheKey(e),e)})};M.prototype.$generateViewTaskHeadingData=function(e,t){var i=this.$getViewTaskMAConfig(e,t),r=this.$getViewTaskProcessor(e,t),n;if(!i)return;n=r.generateHeadingData(this.getDataWarehouseForViewTask(e,t));this.getViewTaskManager().setHeadingData(e,t,n);this.$updateMaskedRange(e,t)};M.prototype.$loadMeasureQuery=function(e,t,i,r){var n=this.$calcMeasureQueryCacheKey(e),o=t.getMeasureQueryAsTable(e,i,false),a=this.getQueryCancellationTimeByKey(n),s=[];if(!(a&&a>r)){this.$getDataBoxesForUnmaskedMeasureQueryKey(n).forEach(function(e){e.setUnmaskedMeasureQueryByKey(n,{queryTime:r,resultTable:o});s.push(e)});this.$clearCancellationByKey(n)}return s};M.prototype.$loadMeasureQueryPositions=function(e,t,i,r){var n=e.query,o=e.unmodifiedQuery,a=this.$calcMeasureQueryCacheKey(o),s=this.getQueryCancellationTimeByKey(a),l,u,c=[];if(s&&s>r){return c}l=t.getMeasureQueryAsTable(n,i,false);u=e.positionInfos;this.$getDataBoxesForMaskedMeasureQueryKey(a).forEach(function(e){e.storeResultTableForPositions(a,u,l);c.push(e)});this.$clearCancellationByKey(a);return c};var O=c("MultiAxisData",["DATA_CHANGED","DATA_REQUEST_TIMER_FIRED"]);var D=c("MultiAxisData",["SET_VIEW_TASK_RANGE","SET_DATA_REQUEST_RUNNING","SET_DATA_REQUEST_FINISHED","SET_DATA_REQUEST_FAILED","LOAD_OUTSTANDING_DATA_REQUEST","STORE_PENDING_EDITS","MARK_EDITS_FOR_COMMIT","MARK_EDITS_IN_FLIGHT","MARK_EDITABILITY_IN_FLIGHT","SET_EDITS_SUCCESSFUL","SET_EDITS_FAILED","SET_LOCKS","UNSET_LOCKS","UNSET_LOCK_BY_KEY","CLEAR_ALL_LOCKS","CLEAR_EDITS","SET_EDITABILITY_STATUS","MARK_ALL_DATA_DIRTY"]);t.exports.MultiAxisDataStore=M;t.exports.MultiAxisDataEvents=O;t.exports.MultiAxisDataActions=D},{"../constant":256,"../constant/messages.js":260,"../cubiql":276,"../dataStorage":287,"../event_emitter":289,"../multiaxis/data_warehouse":317,"../multiaxis/dataprocessor":318,"../multiaxis/edit_data":319,"../multiaxis/keymanager":320,"../multiaxis/query_data":322,"../multiaxis/viewtask":327,"../multiaxisconfig":328,"../querygen/filter":332,"../querygen/query":333,"../querygen/util":336,"../util":357,"./logstore":342,"./measuremodelstore":344,"./multiaxisconfigstore":347,"./pivotconfigstore":351,"./store":352,immutable:"immutable",lodash:70,"measure-query-gen/src/MQG":1}],349:[function(e,t,i){"use strict";var r=e("./store").createConstant;var n=e("lodash");var o=e("../event_emitter").EventEmitter;n.mixin(a.prototype,o.prototype);function a(e){var t=this;this.$config={};this.dispatcherIndex=e.register(function(e){var i=e.action;switch(i.actionType){case s.SET_CONFIG:t.$setConfig(i.config);break}})}a.prototype.$setConfig=function(e){this.$config[e.id]=n.cloneDeep(e);this._emit(l.CHANGE_CONFIG)};a.prototype.getConfig=function(){return this.$config};a.prototype.getConfigById=function(e){return this.$config[e]};var s=r("NavigationTreeActions",["SET_CONFIG"]);var l=r("NavigationTreeEvents",["CHANGE_CONFIG"]);i.NavigationTreeStore=a;i.NavigationTreeEvents=l;i.NavigationTreeActions=s},{"../event_emitter":289,"./store":352,lodash:70}],350:[function(e,t,i){"use strict";var r=e("lodash");var n=e("../event_emitter").EventEmitter;var o=e("../constant").NotificationLevels;var a=e("../constant").NotificationPositions;var s=e("./store").createConstant;var l={position:a.TOP_RIGHT,dismissible:true,autoDismiss:5};var u={};u[o.SUCCESS]=r.merge({},l,{title:"Success"});u[o.INFO]=r.merge({},l,{title:"Info"});u[o.WARNING]=r.merge({},l,{title:"Warning"});u[o.ERROR]=r.merge({},l,{autoDismiss:0,title:"Error"});var c="Dismiss";r.mixin(d.prototype,n.prototype);function d(e){var t=this;this.$notifications={};this.$notificationsOptions={};e.register(function(e){var i=e.action;switch(i.actionType){case f.SHOW:t.$showNotification(i.message,i.level,i.title,i.action,i.options);break;case f.SHOW_SUCCESS:t.$showNotification(i.message,o.SUCCESS,i.title,i.action,i.options);break;case f.SHOW_INFO:t.$showNotification(i.message,o.INFO,i.title,i.action,i.options);break;case f.SHOW_WARNING:t.$showNotification(i.message,o.WARNING,i.title,i.action,i.options);break;case f.SHOW_ERROR:t.$showNotification(i.message,o.ERROR,i.title,i.action,i.options);break;case f.EXECUTE_CALLBACK:t.$executeCallback(i.notificationId);break}})}d.prototype.$executeCallback=function(e){var t=this.$notifications[e];if(t&&r.isFunction(t.callback)){t.callback()}delete this.$notifications[e]};d.prototype.$showNotification=function(e,t,i,n,a){var s,l,u=a&&a.uid||r.uniqueId("notification"),d=r.values(o);if(d.indexOf(t)===-1){t=t&&d.indexOf(t.toLowerCase())!==-1?t.toLowerCase():o.INFO}s=this.$getNotificationOptions(t);l=r.merge({message:e,level:t,uid:u},s,a);if(i){l.title=i}this.$notifications[l.uid]={level:t};if(n&&r.isFunction(n.callback)){l.action={label:n.label||c};this.$notifications[l.uid].callback=n.callback}this._emit(p.SHOW,{options:l})};d.prototype.$getNotificationOptions=function(e){if(!this.$notificationsOptions[e]){this.$notificationsOptions[e]=u[e]}return this.$notificationsOptions[e]};var p=s("NotificationsEvents",["SHOW"]);var f=s("NotificationsActions",["SHOW","SHOW_SUCCESS","SHOW_INFO","SHOW_WARNING","SHOW_ERROR","EXECUTE_CALLBACK"]);t.exports=d;t.exports.NotificationsEvents=p;t.exports.NotificationsActions=f},{"../constant":256,"../event_emitter":289,"./store":352,lodash:70}],351:[function(e,t,i){"use strict";var r=e("./store").createConstant;var n=e("lodash");var o=e("../event_emitter").EventEmitter;var a=e("../constant").SORT;n.mixin(s.prototype,o.prototype);function s(e){var t=this;this.$metricsConfig={};this.$levelsConfig={};t.dispatcherIndex=e.register(function(e){var i=e.action;switch(i.actionType){case l.SET_CONFIG:t.$setConfig(i.config);break;case l.SET_FETCHING_CONFIG:t.$setFetchingConfig(i.promise);break;case l.ERROR_FETCHING_CONFIG:t.$clearFetchingConfig();break}})}s.prototype.$clearFetchingConfig=function(){this.$fetchingConfig=null};s.prototype.$setConfig=function(e){var t,i;if(e.metric_config){t=e.metric_config.reduce(function(e,t){var i=t.metric_name||"",r=t.format||"";e[i]={};e[i].format=""!==r?r:false;e[i].halign=t.halign||false;e[i].readonly=t.readonly||false;e[i].headMetric=t.head_metric||false;e[i].dimension=t.dimension||false;e[i].locks=t.lock||[];e[i].cellType=t.cellType||false;return e},{});this.$metricsConfig=Object.freeze(t)}if(e.level_config){i=e.level_config.reduce(function(e,t){e[t.level_name]={};e[t.level_name].sortAttr=t.default_sort_attr;return e},{});this.$levelsConfig=Object.freeze(i)}this.$clearFetchingConfig();this._emit(u.CHANGE)};s.prototype.$setFetchingConfig=function(e){this.$fetchingConfig=e};s.prototype.getMetricConfig=function(e){return this.$metricsConfig&&this.$metricsConfig[e]};s.prototype.getMetricsConfig=function(){return this.$metricsConfig};s.prototype.getBackingMetric=function(e){var t=this.getMetricsConfig()[e];return t&&t.headMetric||e};s.prototype.getMetricFormat=function(e){var t=this.getMetricsConfig()[e];return t&&t.format};s.prototype.getLevels=function(){return this.$levelsConfig};s.prototype.getLevelConfig=function(e){return this.$levelsConfig&&this.$levelsConfig[e]};s.prototype.getLevelSortAttr=function(e){var t=this.getLevelConfig(e);return t&&t.sortAttr||a.DEFAULT_ATTR};s.prototype.getLevelSortType=function(e){var t=this.getLevelConfig(e);return t&&t.sortType||a.DEFAULT_TYPE};s.prototype.getLevelDefaultSort=function(e){return{sortAttr:this.getLevelSortAttr(e),sortType:this.getLevelSortType(e)}};s.prototype.getDefaultSortForLevels=function(e){var t=this,i={};n.each(e,function(e){i[e]=t.getLevelDefaultSort(e)});return i};s.prototype.isFetchingConfigDisplayFormats=function(){return this.$fetchingConfig};s.prototype.isConfigLoaded=function(){return!n.isEmpty(this.$metricsConfig)||!n.isEmpty(this.$levelsConfig)};var l=r("PivotConfigActions",["SET_CONFIG","SET_FETCHING_CONFIG","ERROR_FETCHING_CONFIG"]);var u=r("PivotConfigEvents",["CHANGE"]);i.PivotConfigStore=s;i.PivotConfigEvents=u;i.PivotConfigActions=l},{"../constant":256,"../event_emitter":289,"./store":352,lodash:70}],352:[function(e,t,i){"use strict";var r=e("lodash");var n=e("../event_emitter").EventEmitter;o.TYPES={BOOLEAN:1,STRING:2,NUMBER:3,ARRAY:4,OBJECT:8};r.mixin(o.prototype,n.prototype);function o(e,t){t=t||{};this.$state={};var i=this;Object.keys(t).forEach(function(e){i.$set(e,r.cloneDeep(t[e]))});this.definition={};if(e)this.define(e);return this}o.prototype.define=function e(t){var i=this;t.forEach(function(e){var t=e[0];var r=e[1];var n=e[2];var a=i.get(t);if(r==o.TYPES.BOOLEAN&&a==="0")a=false;a=a===undefined?n:a;i.definition[t]={type:r,defaultValue:n};if(a!==undefined)i.$set(t,a,false,true)})};o.prototype.isDefined=function e(t){return typeof this.definition[t]!=="undefined"};o.prototype.$set=function e(t,i){var n=this.$state;var o=t.split(".");for(var a=0;a<o.length-1;a++){n=n[o[a]]||(n[o[a]]={})}n[o[o.length-1]]=r.cloneDeep(i);return this};o.prototype.get=function e(t){var i=this.$state;t&&t.split(".").every(function(e){i=i[e];return i?true:false});return r.cloneDeep(i)};o.prototype.getState=function e(){var t=r.cloneDeep(this.$state);Object.seal(t);return t};function a(e,t){return t.reduce(function(t,i){t[i]=e+":"+i;return t},{})}i.Store=o;i.createConstant=a},{"../event_emitter":289,lodash:70}],353:[function(e,t,i){var r=e("lodash");var n=e("assert");var o=e("../constant").User;var a=e("../event_emitter").EventEmitter;r.mixin(s.prototype,a.prototype);function s(e){var t=this;this.$userName=null;e.register(function(e){var i=e.action;switch(i.actionType){case o.ACTIONS.AUTHENTICATE:t.$authenticate(i.userName);break;case o.ACTIONS.UNAUTHENTICATE:t.$unauthenticate();break}})}s.prototype.$authenticate=function(e){n(!!e&&e.length>0,["User name cannot be empty"]);this.$userName=e;this._emit(o.EVENTS.CHANGED,{userName:e})};s.prototype.$unauthenticate=function(){this.$userName=null;this._emit(o.EVENTS.CHANGED)};s.prototype.getCurrentUserName=function(){return this.$userName};s.prototype.isAuthenticated=function(){return!!this.$userName};t.exports=s},{"../constant":256,"../event_emitter":289,assert:2,lodash:70}],354:[function(e,t,i){"use strict";var r=e("lodash");var n=e("immutable");var o=e("../event_emitter").StoreEventEmitter;var a=e("../constant").ViewConfig;var s=a.ACTIONS;var l=a.EVENTS;var u=a.PATH;r.mixin(c.prototype,o.prototype);function c(e){var t=this;this.$views=n.Map();e.register(function(e){var i=e.action;switch(i.actionType){case s.SET_VIEW_STATE:t.$setViewState(i.viewId,i.state,i.config);break}})}c.prototype.getViewState=function(e){return this.$views.getIn([e,"state"])};c.prototype.getViewConfig=function(e){return this.$views.getIn([e,"config"])};c.prototype.hasViewState=function(e){return!!this.$views.getIn([e,"state"])};c.prototype.$setViewState=function(e,t,i){var r=this.$views.getIn([e,"state"]),n=this.$views.getIn([e,"config"]);if(!t&&i){t=i}if(this.hasViewState(e)){this.$views=this.$views.setIn([e,"state"],t);if(i){this.$views=this.$views.setIn([e,"config"],i)}else if(t&&!this.$views.getIn([e,"config"])){this.$views=this.$views.setIn([e,"config"],t)}}else{this.$views=this.$views.setIn([e,"state"],t);this.$views=this.$views.setIn([e,"config"],i)}if(!r||!r.equals(this.$views.getIn([e,"state"]))){this._emit(e,l.STATE_CHANGED,{viewId:e})}if(!n||!n.equals(this.$views.getIn([e,"config"]))){this._emit(e,l.CONFIG_CHANGED,{viewId:e})}};c.prototype.clear=function(){this.$views=n.Map()};c.prototype.getAllAvailableSignals=function(e){return this.$views.reduce(function(t,i,r){var n=i.get("state"),o=n.getIn(u.SIGNALS);if(r===e||!o){return t}return t.concat(o)},n.List())};c.prototype.findViewStatesWith=function(e,t){return this.$views.reduce(function(i,r){var n=r.getIn(["state"].concat(e));if(n&&t(n)){i=i.push(r.get("state"))}return i},n.List())};c.prototype.reduceViewStatesIn=function(e,t,i){return this.$views.reduce(function(i,r){return t(i,r.getIn(["state"].concat(e)))},i)};t.exports=c},{"../constant":256,"../event_emitter":289,immutable:"immutable",lodash:70}],355:[function(e,t,i){"use strict";var r=e("lodash");var n=e("assert");var o=e("../util");var a=e("../event_emitter").EventEmitter;var s=e("../constant").View;var l=s.Modules;var u=l.Page;var c=e("../constant").ViewConfig.MODELER_VIEW_ID;r.mixin(d.prototype,a.prototype);function d(e,t,i){var r=this;this.$views={};this.$currentPageViewId=null;this.$viewConfigStore=t;this.$getViewComponentForModule=i}d.prototype.getViewId=function(e){n(this.$views[e],["View with unique ID "+e+" doesn't exist."]);return this.$views[e].viewId};d.prototype.getParentUniqueId=function(e){n(this.$views[e],["View with unique ID "+e+" doesn't exist."]);return this.$views[e].parentUniqueId};d.prototype.getParentId=function(e){n(this.$views[e],["View with unique ID "+e+" doesn't exist."]);var t=this.getParentUniqueId(e);return t&&this.getViewId(t)};d.prototype.getViewUniqueId=function(e,t,i){n(t,["View`s ID has to be passed"]);var r=e&&this.$views[e],o=r&&r.childrenViews||this.$views,a=Object.keys(o),s;for(var l=0;l<a.length;l++){s=a[l];if(o[s].viewId===t){return s}}return!i&&this.$addView(e,t)};d.prototype.getViewComponent=function(e){n(e,["View`s unique ID has to be passed"]);var t=this.getViewModuleId(e);return this.$getViewComponentForModule(t)};d.prototype.getViewComponentByModuleId=function(e){n(e,["Module`s name has to be passed"]);return this.$getViewComponentForModule(e)};d.prototype.getViewModuleId=function(e){n(e,["View`s unique ID has to be passed"]);var t=this,i,r,o=this.getViewId(e),a=this.$viewConfigStore.getViewState(o),l;if(a){if(a.has("module")){return a.get("module")}else if(a.has("pivotConfig")&&a.has("layout")){return s.Modules.Sheet}}i=t.getParentId(e);if(i){l=t.$viewConfigStore.getViewState(i);r=l&&l.getIn(["views",o,"module"]);return r||u}return u};d.prototype.getCurrentPageViewId=function(){var e=this.$viewConfigStore.getViewState(c);return e&&e.get("views").findKey(function(e,t){return e.get("module")!==l.ModelerNavigationTree})};d.prototype.$addView=function(e,t){n(t,["View`s ID has to be passed"]);var i=e&&this.$views[e],o=this.getViewUniqueId(e,t,true)||r.uniqueId(t);this.$views[o]=r.merge({viewId:t,parentUniqueId:e,childrenViews:{}},this.$views[o]);if(i){i.childrenViews[o]=this.$views[o]}return o};t.exports=d},{"../constant":256,"../event_emitter":289,"../util":357,assert:2,lodash:70}],356:[function(e,t,i){"use strict";var r=e("lodash");var n=e("./event_emitter").EventEmitter;var o=e("../logicblox.core/network").HttpHelper;var a=e("../logicblox.connectblox/connect").ConnectBlox;r.mixin(s.prototype,n.prototype);function s(e){var t=this;this.http=new o;this.connectblox=new a(e.urls,e.connectblox.workspace,this.http);this.urls=e.urls;this.http.on("AUTHENTICATION_FAILURE",function(){t._emit("AUTHENTICATION_FAILURE")});this.http.on("AUTHORIZATION_FAILURE",function(){
t._emit("AUTHORIZATION_FAILURE")});this.getServiceUrl=e.getServiceUrl;this.destroy=function(){this.removeAllListeners()}}i.UrlDriver=s},{"../logicblox.connectblox/connect":219,"../logicblox.core/network":220,"./event_emitter":289,lodash:70}],357:[function(e,t,i){(function(t){"use strict";var r=e("assert");var n=e("lodash");var o=9007199254740992;var a=["co",{sensitivity:"base"}];var s=typeof t==="undefined"?window:t;var l=typeof s.Intl!=="undefined"?s.Intl:null;function u(e){var t=0,i=0,r;e=n.isUndefined(e)||n.isString(e)?e:JSON.stringify(e);r=n.isString(e)?e.length:0;if(r===0)return t;for(;i<r;i++){t=(t<<5)-t+e.charCodeAt(i);t|=0}return t}function c(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function d(){r(arguments.length>0&&arguments.length%2===0);var e=[],t=[],i,n=0,o,a,s,l,u=[];for(o=0;o<arguments.length;o++){if(o%2===0){e.push(arguments[o])}else{i=arguments[o];if(n<i.length){n=i.length}t.push(i)}}s=t.length;r(e.length===s);for(o=0;o<n;o++){l={};for(a=0;a<s;a++){l[e[a]]=t[a][o]}u.push(l)}return u}function p(e,t,i){var r,o,a=0,s=t.length;if(arguments.length>2){r=e;s--;while(a<s){o=t[a++];e=e[o]=n.isObject(e[o])?e[o]:{}}e[t[a]]=i;i=r}else{while((e=e[t[a++]])!=null&&a<s){}i=a<s?undefined:e}return i}function f(e,t){var i=t.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split(".");return e.map(function(e){return p(e,i)})}function h(e,t){return n.intersection(e,t).length===e.length}function g(e){var t={};e.forEach(function(e){t[e]=true});return Object.keys(t)}function m(e,t,i){var r=e,n=t-e.length,o=Math.floor(n/i.length),a=0;for(;a<o;a++)r=i+r;return r}function v(e,t){if(!t)t=0;if(e===null||!parseInt(e,10)&&parseInt(e,10)!==0)return[0,0,0,0];var i=String(e).split(/\s* \s*/);for(var r=0;r<i.length;r++)i[r]=parseInt(i[r],10)||0;switch(i.length){case 1:i[1]=i[0];i[2]=i[0];i[3]=i[0];break;case 2:i[2]=i[0];i[3]=i[1];break;case 3:i[3]=i[1];break}return i}function y(e){return e.split(":")[1]}function b(e){return e.split(":")[0]}function w(e,t){if(e===t)return true;if(e==null||t==null)return false;if(e.length!==t.length)return false;for(var i=0;i<e.length;++i){if(e[i]!==t[i])return false}return true}function C(e){console.error(e.stack||e)}function E(e){return function(t){return!e(t)}}function S(e){return function(t){return t[e]}}function T(e,t){return function(i){return e(t(i))}}function x(e,t){return T(t,e)}function _(e,t){if(typeof e!=="object"||!(t instanceof Array))return false;return t.every(function(t,i){switch(typeof t){case"string":return typeof e[i]===t;case"function":return e[i]instanceof t;case"object":return t.tag==="or"&&(_([e[i]],[t.ty1])||_([e[i]],[t.ty2]));default:return false}})}var M={or:function(e,t){return{tag:"or",ty1:e,ty2:t}},checkBool:_,assertArgs:function(e,t){r(M.checkBool(e,t))}};function A(){return function(e){return e}}var I=A();function O(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,i=e=="x"?t:t&3|8;return i.toString(16)})}function D(e,t){if(t)e=e.replace(/(images|icons)\//g,t+"/$1/");var i=document.createElement("style");i.appendChild(document.createTextNode(e));document.getElementsByTagName("head")[0].appendChild(i);return i}function N(e,t,i){r(i<=e.length);r(i<=t.length);if(e.length===i&&t.length>i)return-1;if(e.length>i&&t.length===i)return 1;if(e.length===i&&t.length===i)return 0;else if(e[i]<t[i])return-1;else if(e[i]>t[i])return 1;else return N(e,t,i+1)}function R(e,t){var i=0;function r(r){if(t(r,i)){e.apply(e,arguments)}i++}return r}var P=true;function L(){P=true}function k(){P=false}function $(e,t,i){i=n.isUndefined(i)?this:i;return function(){var r=performance.now(),n,o=t.apply(i,arguments);n=performance.now();if(P)console.log(e+" time taken: "+(n-r));return o}}function F(e,t){var i=performance.now(),r=function(){var t=performance.now();if(P)console.log(e+" time taken: "+(t-i))};t.then(function(e){r();return e});return t}function V(e,t,i,r){return e.splice.apply(e,[t,i].concat(r))}function q(e,t){while(e){if(dom.hasCssClass(e,t))return e.$dragTarget||e;e=e.parentElement}}function H(e,t){var i=[[],[]];e.forEach(function(e){if(t(e))i[0].push(e);else i[1].push(e)});return i}function U(e,t,i){if(i>=e.length){var r=i-e.length;while(r--+1){e.push(undefined)}}e.splice(i,0,e.splice(t,1)[0])}function B(e,t){var i,r;Object.freeze(e);for(r in e){i=e[r];if(i==null||!e.hasOwnProperty(r)||!(typeof i==="object")||Object.isFrozen(i)||t.indexOf(i)>-1){continue}B(i,t)}}function z(e,t){var i,r;if(!e&&l&&l.Collator){r=[null].concat(a);if(t){r.sensitivity="case"}i=new(Function.bind.apply(l.Collator,r));return function(t,r){if(!e){t=t||"";r=r||""}return i.compare(t,r)}}if(e){return function(e,t){var i=typeof e==="number"?e:parseFloat(e)||0,r=typeof t==="number"?t:parseFloat(t)||0;return i-r}}return function(e,i){e=(t?e:e&&e.toLocaleLowerCase())||"";i=(t?i:i&&i.toLocaleLowerCase())||"";if(String.prototype.localeCompare){return String.prototype.localeCompare.apply(e,[i].concat(a))}if(e<i){return-1}else if(e>i){return 1}return 0}}function j(e,t,i){return z(false,i)(e,t)}function G(e,t){return z(true)(e,t)}function W(e){var t=[],i=e.length-1;function r(n,o){var a=n.slice(),s=e[o],l=0;for(;l<s.length;l++){a.push(s[l]);if(o===i)t.push(a);else r(a,o+1)}}r([],0);return t}function Q(e){var t="/canvas/",i=e.substring(1,e.length),r;if(i.indexOf(t)===0){r=i.substring(t.length)}return r}function K(e,t,i){var r=n.values(t);if(r.indexOf(e)!==-1){return e}return i||r[0]}function Y(e){var t=e&&e.status||[];if(e&&!n.isArray(e.status))t=[e.status];return n.some(t,function(e){return e&&e.type==="Error"})}function X(e,t){var i,r=[];if(e.length<=1)return e;for(i=0;i<e.length-1;i++){r.push(e[i]);r.push(t)}r.push(e[i]);return r}function J(e){var t={};for(var i in e){var r=i.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()});t[r]=e[i]}return t}function Z(e,t){return n.isUndefined(t)?e:e+" @ "+n.map(t,"qualifiedName").join(", ")}function ee(e,t){if(n.isArray(e)&&n.isArray(t)){return t}if(n.isObject(e)&&n.isObject(t)&&!Object.keys(t).length){return t}}function te(e){e=n.merge({},e);function t(e){n.forEach(e,function(i,r){if(n.isObject(i)||n.isArray(i)){if(n.isEmpty(i)){delete e[r]}else{e[r]=t(i)}}});return e}return t(e)}function ie(e){return e&&e.$interStr&&e.$interStr.replace("(","").replace(")","")}function re(){return Array.prototype.slice.call(arguments).join("@")}function ne(e){return new Date(parseInt(e))}function oe(e){return Array.prototype.slice.call(e)}function ae(e,t){var i=e.filter(function(e){return t.find(function(t){return t.viewId===e.viewId&&e.tasks.find(function(e){return t.tasks.indexOf(e)>-1})})});return i.length?i:false}function se(e,t){return e.find(function(e){return t.indexOf(e)!==-1})}i.checkEnumValue=K;i.parseHash=Q;i.getComparator=z;i.stringCompare=j;i.numberCompare=G;i.partition=H;i.moveArrayElement=U;i.disablePerformanceTiming=k;i.enablePerformanceTiming=L;i.timedFn=$;i.timedPromise=F;i.hashCode=u;i.getBox=v;i.containsAll=h;i.padLeft=m;i.escapeRegExp=c;i.getLevelName=y;i.getDimensionName=b;i.shallowArraysEquals=w;i.MAX_INT=o;i.uniqueStrings=g;i.not=E;i.project=S;i.compose=T;i.sequence=x;i.logError=C;i.type=M;i.mkIdentityFunction=A;i.voidFunction=I;i.uuid=O;i.deepPluck=f;i.zipToObjects=d;i.deep=p;i.insertCss=D;i.arrayCompare=N;i.filterEvent=R;i.spliceAll=V;i.moveArrayElement=U;i.deepFreeze=B;i.findParentWithClass=q;i.combineArrays=W;i.actionResponseHasError=Y;i.insertBetween=X;i.arrayAndEmptyObjectMerger=ee;i.clearEmptyObjectsAndArrays=te;i.convertCSSStyleToReact=J;i.buildLevelLabel=Z;i.getIntersectionString=ie;i.concatStrings=re;i.convertStringToDate=ne;i.cleanArgs=oe;i.shouldReflectDataChange=ae;i.findFirstIntersection=se}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{assert:2,lodash:70}],358:[function(e,t,i){"use strict";var r=e("immutable");var n=e("../constant/viewconfig").MODELER_VIEW_ID;function o(e){return r.fromJS({id:n,views:{navigationTree:{module:"ModelerNavigationTree",config:{navigationTreeId:e}}},layout:{shape:{columns:"200px,1",rows:"1"},viewPositions:{navigationTree:{col:0,row:0,fixed:true}}}})}i.buildModelerNavigationCanvas=o},{"../constant/viewconfig":274,immutable:"immutable"}],359:[function(e,t,i){"use strict";var r=e("lodash");function n(e,t,i){return e.get(i)===t}function o(e,t){return r.every(e,r.partial(n,t))}function a(e,t){if(t){return r.partial(a,r.partial(e,t))}else{return r.partial(o,e())}}var s=r.partial(a,r.extend);t.exports={compareAttr:n,compareAttrs:o,create:s}},{lodash:70}],360:[function(e,t,i){"use strict";var r={$attachEventListener:function(e){var t=e.emitter,i=e.emitterId,r=e.event,n=e.callback,o=t.on&&t.on.bind(t)||t.addEventListener.bind(t);if(i){o(i,r,n)}else{o(r,n)}},$detachEventListener:function(e){var t=e.emitter,i=e.emitterId,r=e.event,n=e.callback;if(i){t.removeEventListener(i,r,n)}else{t.removeEventListener(r,n)}},attachEventListeners:function(){var e=this.setEventListeners();e.forEach(this.$attachEventListener)},detatchEventListeners:function(){var e=this.setEventListeners();e.forEach(this.$detachEventListener)},componentWillMount:function(){this.attachEventListeners()},componentWillUnmount:function(){this.detatchEventListeners()}};t.exports=r},{}],361:[function(e,t,i){"use strict";var r=e("excelbuilderjs-node");var n=e("../multiaxisconfig");var o=e("../cubiql");function a(e,t,i,n,o){this.$workbook=r.createWorkbook();this.$worksheet=this.$workbook.createWorksheet({name:"Data Sheet"});this.$workbook.addWorksheet(this.$worksheet);this.$measureModel=e;this.$headingData=t;this.$vertAxisName=i;this.$horAxisName=n;this.$sliceAxisName=o;this.$colHeaderCount=this.$getMaxColHeaderDepth();this.$rowHeaderCount=this.$getMaxRowHeaderDepth();this.$sliceCount=this.$getSliceCount();this.$hasExtraTitleRow=this.$colHeaderCount>0||this.$rowHeaderCount>0;this.$totalRowCount=this.$getTotalRowCount();this.$totalColCount=this.$getTotalColCount();this.$sheetData=[];this.$headerCellStyle=this.$createHeaderCellStyle();this.$totalHeaderCellStyle=this.$createTotalHeaderCellStyle();this.$totalCellStyle=this.$createTotalCellStyle();this.$dataBeginCol=this.$rowHeaderCount;this.$dataBeginRow=this.$colHeaderCount+this.$getFirstColumnHeaderRow();this.$columnHeadersBeginRow=this.$colHeaderCount>0?this.$getFirstColumnHeaderRow():-1;this.$columnHeadersEndRow=this.$colHeaderCount>0?this.$getFirstDataRow()-1:-1;this.$rowHeadersBeginColumn=this.$rowHeaderCount>0?0:-1;this.$rowHeadersEndColumn=this.$rowHeaderCount>0?this.$rowHeaderCount-1:-1;this.$isTotalRowHeader={};this.$isTotalColumnHeader={};this.$formattedRegularCellStyle={};this.$formattedTotalCellStyle={};this.$setSlices();this.$setTitles()}var s=t.exports;s.ExcelCreator=a;a.prototype.$getFirstColumnHeaderRow=function(){return this.$sliceCount+(this.$hasExtraTitleRow?1:0)};a.prototype.$getFirstDataRow=function(){return this.$colHeaderCount+this.$getFirstColumnHeaderRow()};a.prototype.$getTotalRowCount=function(){return this.$getCellRowCount()+this.$getFirstDataRow()};a.prototype.$getTotalColCount=function(){return this.$getCellColCount()+this.$getMaxRowHeaderDepth()};a.prototype.$getCellColCount=function(){return this.$getHeadingData().getHeadingAxisInfo(this.$horAxisName).getLength()};a.prototype.$getCellRowCount=function(){return this.$getHeadingData().getHeadingAxisInfo(this.$vertAxisName).getLength()};a.prototype.$getHeadingData=function(){return this.$headingData};a.prototype.$getMaxRowHeaderDepth=function(){return this.getMaxHeaderDepth(this.$vertAxisName)};a.prototype.getMaxHeaderDepth=function(e){if(!this.$getHeadingData().isAxisUsed(e)){return 0}return Math.max.apply(null,this.$getHeadingData().getColumnSets(e).map(function(e){return e.columns.length}))};a.prototype.$getMaxColHeaderDepth=function(){return this.getMaxHeaderDepth(this.$horAxisName)};a.prototype.$getSliceCount=function(){return this.getMaxHeaderDepth(this.$sliceAxisName)};a.prototype.$setSlices=function(){var e=this,t=this.$getHeadingData().getColumnSets("Z");if(t.length>0){t[0].columns.forEach(function(t,i){if(!t.field){return}e.$setSheetHeadingData(i,0,t.field instanceof n.MeasureField?"Measures":t.field.fieldLabel);e.$sheetData[i][1]={value:t.members[0].label}})}};a.prototype.$getQlCaption=function(e){var t=o.parseDimLvl(e),i=this.$measureModel.getDimension(t.dimension),r=this.$measureModel.getLevel(t.dimension,t.level);return(i?i.caption:t.dimension)+":"+(r?r.caption:t.level)};a.prototype.$setTitles=function(){var e=this,t,i;if(this.$getHeadingData().isAxisUsed(this.$horAxisName)){t=this.$getHeadingData().getColumnSets(this.$horAxisName)[0].columns.reduce(function(t,i){var r="";if(i.field&&i.field.type===n.FieldTypes.MEASURE){r="Measures"}else if(i.field&&i.field.type===n.FieldTypes.LEVEL){r=e.$getQlCaption(i.field.id)}return""===t?r:t+" / "+r},"");this.$setColumnHeaderTitle(t)}if(this.$getHeadingData().isAxisUsed(this.$vertAxisName)){i=this.$getHeadingData().getColumnSets(this.$vertAxisName)[0].columns.reduce(function(t,i){var r="";if(i.field.type===n.FieldTypes.MEASURE){r="Measures"}else if(i.field.type===n.FieldTypes.LEVEL){r=e.$getQlCaption(i.field.id)}return""===t?r:t+" / "+r},"");this.$setRowHeaderTitle(i)}};a.prototype.$setSheetHeadingData=function(e,t,i,r){r=r||false;var n=t<this.$rowHeaderCount;if(!this.$sheetData[e])this.$sheetData[e]=[];if(r){this.$isTotalRowHeader[e]=n;this.$isTotalColumnHeader[t]=!n}this.$sheetData[e][t]={value:i,metadata:{style:r?this.$totalHeaderCellStyle.id:this.$headerCellStyle.id,type:"text"}}};a.prototype.$setColumnHeaderTitle=function(e){if(this.$columnHeadersBeginRow===-1){return}var t=this.$columnHeadersBeginRow,i=this.$getColumnCharacter(this.$dataBeginCol),r=this.$getColumnCharacter(this.$totalColCount-1);this.$worksheet.mergeCells(i+t,r+t);this.$setSheetHeadingData(this.$columnHeadersBeginRow-1,this.$dataBeginCol,e,false)};a.prototype.$setRowHeaderTitle=function(e){if(this.$rowHeadersBeginColumn===-1||this.$rowHeadersEndColumn===-1){return}var t=this.$dataBeginRow,i=this.$getColumnCharacter(this.$rowHeadersBeginColumn),r=this.$getColumnCharacter(this.$rowHeadersEndColumn);this.$worksheet.mergeCells(i+t,r+t);this.$setSheetHeadingData(this.$dataBeginRow-1,this.$rowHeadersBeginColumn,e,false)};a.prototype.$setTotalCellStyle=function(){var e,t,i;if(this.$colHeaderCount>0){for(e=this.$dataBeginCol;e<this.$totalColCount;++e){i=false;for(t=this.$columnHeadersBeginRow;false===i&&t<=this.$columnHeadersEndRow;++t){if(this.$sheetData[t][e]){i=this.$sheetData[t][e].metadata.style===this.$totalHeaderCellStyle.id}}for(t=this.$dataBeginRow;i&&t<this.$totalRowCount;++t){if(!this.$sheetData[t][e]){this.$sheetData[t][e]={metadata:{style:this.$totalCellStyle.id}}}}}}if(this.$rowHeaderCount>0){for(t=this.$dataBeginRow;t<this.$totalRowCount;++t){i=false;for(e=this.$rowHeadersBeginColumn;false===i&&e<=this.$rowHeadersEndColumn;++e){if(this.$sheetData[t][e]){i=this.$sheetData[t][e].metadata.style===this.$totalHeaderCellStyle.id}}for(e=this.$dataBeginCol;i&&e<this.$totalColCount;++e){if(!this.$sheetData[t][e]){this.$sheetData[t][e]={metadata:{style:this.$totalCellStyle.id}}}}}}};a.prototype.$setSheetCellData=function(e,t,i,r,n){var o;if(!this.$sheetData[e])this.$sheetData[e]=new Array(this.$totalColCount);this.$sheetData[e][t]={value:i};o=this.$getCellStyleForFormat(e,t,r,n);if(o){this.$sheetData[e][t].metadata={style:o.id}}};a.prototype.mkCellBuilder=function(){var e=this,t=this.$dataBeginCol,i=this.$dataBeginRow,r=1,n=0;return function(o,a,s,l,u,c,d,p){var f=c[r],h=c[n],g=i+f,m=t+h,v,y,b,w,C,E,S=p(o,a,s,u),T,x,_,M;if(f===0){y=l[n];w=y.length;for(b=0;b<w;b++){C=y[b];e.$setSheetHeadingData(e.$columnHeadersBeginRow+b,m,C.label,!!C.config.rollup)}}if(h===0){v=l[r];w=v.length;for(b=0;b<w;b++){C=v[b];e.$setSheetHeadingData(g,e.$rowHeadersBeginColumn+b,C.label,!!C.config.rollup)}}if(!S.invalid){if(S.queryResults.selectedDataLabel&&S.queryResults.selectedDataLabel.value&&S.queryResults.selectedDataLabel.value.rawValue.length>0){T=S.queryResults.selectedDataLabel.value.rawValue[0][0]}else if(S.queryResults.value&&S.queryResults.value.value&&S.queryResults.value.value.rawValue.length>0){T=S.queryResults.value.value.rawValue[0][0]}if(undefined!==T){E=d(o,a,s,l,u);x=S.queryResults.selectedDataLabel?"":E.queries.value.formatter.formatPattern;_=S.queryResults.selectedDataLabel?false:E.queries.value.formatter.isPercentage;M=E.queries.value.type;if(M==="DECIMAL"||M==="INT"||M==="FLOAT"){T=parseFloat(T)}e.$setSheetCellData(g,m,T,x,_)}}}};a.prototype.getSheetData=function(){return this.$sheetData};a.prototype.$getFileBlob=function(){var e=r.createFile(this.$workbook,{base64:false,type:"blob"}),t=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return t};a.prototype.$computeColumnInfo=function(){var e=this.$getMaxRowHeaderDepth(),t=0,i=[],r;for(;t<this.$totalColCount;t++){r=t<e;i.push({id:r?"row"+t:"col"+t,width:r?20:10})}return i};a.prototype.$getColumnCharacter=function(e){var t="A".charCodeAt(0),i=26,r="";while(e>=0){r=String.fromCharCode(e%i+t)+r;e=Math.floor(e/i)-1}return r};a.prototype.exportData=function(e){this.$worksheet.setColumns(this.$computeColumnInfo());this.$mergeCells();this.$worksheet.setData(this.$sheetData);this.$setTotalCellStyle();if(e){return this.$sheetData}else{return this.$getFileBlob()}};a.prototype.$createHeaderCellStyle=function(){var e=this.$workbook.getStyleSheet();return e.createFormat({border:{left:{color:"FFB4B4B4",style:"thin"},right:{color:"FFB4B4B4",style:"thin"},top:{color:"FFB4B4B4",style:"thin"},bottom:{color:"FFB4B4B4",style:"thin"}},fill:{type:"pattern",patternType:"solid",fgColor:"FFF0F0F0"},alignment:{horizontal:"left",vertical:"top"}})};a.prototype.$createTotalHeaderCellStyle=function(){var e=this.$workbook.getStyleSheet();return e.createFormat({border:{left:{color:"FFABC6CB",style:"thin"},right:{color:"FFABC6CB",style:"thin"},top:{color:"FFABC6CB",style:"thin"},bottom:{color:"FFABC6CB",style:"thin"}},fill:{type:"pattern",patternType:"solid",fgColor:"FFABC6CA"},alignment:{horizontal:"left",vertical:"top"},font:{bold:true}})};a.prototype.$createTotalCellStyle=function(){var e=this.$workbook.getStyleSheet();return e.createFormat({border:{left:{color:"FFAC7CB",style:"thin"},right:{color:"FFAC7CB",style:"thin"},top:{color:"FFAC7CB",style:"thin"},bottom:{color:"FFAC7CB",style:"thin"}},fill:{type:"pattern",patternType:"solid",fgColor:"FFEBFFFF"},font:{bold:true}})};a.prototype.$getCellStyleForFormat=function(e,t,i,r){var n,o=this.$isTotalRowHeader[e]||this.$isTotalColumnHeader[t];function a(e){var t,i=e;i=i.replace(/[0]/g,"#");if(i.endsWith("[.]")){t=i.lastIndexOf("[.]");i=i.slice(0,t)}i=r?i.replace("#%","0%"):i.replace("#.##","0.00");if(!r&&!i.includes(".")&&i.endsWith("#")){i=i.slice(0,-1)+"0"}return i}if(i){n=o?this.$formattedTotalCellStyle[i]:this.$formattedRegularCellStyle[i];if(!n){if(o){n=this.$workbook.getStyleSheet().createFormat({border:{left:{color:"FFAC7CB",style:"thin"},right:{color:"FFAC7CB",style:"thin"},top:{color:"FFAC7CB",style:"thin"},bottom:{color:"FFAC7CB",style:"thin"}},fill:{type:"pattern",patternType:"solid",fgColor:"FFEBFFFF"},font:{bold:true},format:a(i)});this.$formattedTotalCellStyle[i]=n}else{n=this.$workbook.getStyleSheet().createFormat({format:a(i)});this.$formattedRegularCellStyle[i]=n}}}return n};a.prototype.$mergeCells=function(){var e,t,i,r=[],n=[],o,a,s,l,u=[],c=[],d,p,f,h;if(this.$colHeaderCount>0){for(p=this.$dataBeginCol;p<this.$totalColCount;++p){o=false;for(f=this.$columnHeadersBeginRow;f<this.$dataBeginRow;++f){d=this.$sheetData[f][p];if(!n[f]){n[f]=d;r[f]=p}else if(o||n[f].value!==d.value||p===this.$totalColCount-1&&n[f].value===d.value){if(r[f]!==p-1||p===this.$totalColCount-1&&n[f].value===d.value){e=f+1;t=this.$getColumnCharacter(r[f]);i=this.$getColumnCharacter(p===this.$totalColCount-1?p:p-1);this.$worksheet.mergeCells(t+e,i+e);o=true}n[f]=d;r[f]=p}}}}if(this.$rowHeaderCount>0){for(f=this.$dataBeginRow;f<this.$totalRowCount;++f){h=false;for(p=this.$rowHeadersBeginColumn;p<this.$dataBeginCol;++p){d=this.$sheetData[f][p];if(!c[p]){c[p]=d;u[p]=f}else if(h||c[p].value!==d.value||f===this.$totalRowCount-1&&c[p].value===d.value){if(u[p]!==f-1||f===this.$totalRowCount-1&&c[p].value===d.value){a=this.$getColumnCharacter(p);s=u[p]+1;l=f===this.$totalRowCount-1?f+1:f;this.$worksheet.mergeCells(a+s,a+l);h=true}c[p]=d;u[p]=f}}}}}},{"../cubiql":276,"../multiaxisconfig":328,"excelbuilderjs-node":38}],362:[function(e,t,i){"use strict";var r=e("lodash");var n=e("../measurelanguage");function o(e){this.$formula=e;this.name=this.accept(s)}o.isValid=function(e){try{new o(e)}catch(e){return false}return true};o.prototype.accept=function(e){return this.acceptFormula(e,this.$formula)};o.prototype.acceptFormula=function(e,t){var i=this;var r=t.equation.map(function(t){return i.acceptEquation(e,t)});return e.visitFormula(r)};o.prototype.acceptEquation=function(e,t){var i=this.acceptExpr(e,t.left),r=this.acceptExpr(e,t.right);return e.visitEquation(i,r)};o.prototype.acceptExpr=function(e,t){var i;if(t.function)i=this.acceptFunction(e,t.function);else if(t.group)i=this.acceptGroup(e,t.group);else if(t.guarded)i=this.acceptGuarded(e,t.guarded);else if(t.p2p)i=this.acceptP2P(e,t.p2p);else if(t.tuple)i=this.acceptTuple(e,t.tuple);else if(t.variable)i=this.acceptVariable(e,t.variable);else if(t.constant)i=this.acceptConstant(e,t.constant);return e.visitExpr(i)};o.prototype.acceptFunction=function(e,t){var i;if(t.name==="add")i=this.acceptOpFunction(e,t," + ");else if(t.name==="subtract")i=this.acceptOpFunction(e,t," - ");else if(t.name==="divide")i=this.acceptOpFunction(e,t," / ");else if(t.name==="multiply")i=this.acceptOpFunction(e,t," * ");else if(t.name==="negate")i=this.acceptUnaryOpFunction(e,t," -");else if(t.name==="total")i=this.acceptAggFunction(e,t);else if(t.name==="count")i=this.acceptAggFunction(e,t);else{i=this.acceptFunctionalPredicate(e,t)}return e.visitFunction(i)};o.prototype.acceptFunctionalPredicate=function(e,t){var i=this.acceptFunctionArgs(e,t.args);return e.visitFunctionalPredicate(t.name,i)};o.prototype.acceptOpFunction=function(e,t,i){var r=this.acceptExpr(e,t.args[0].arg[0]),n=this.acceptExpr(e,t.args[0].arg[1]);return e.visitOpFunction(r,i,n)};o.prototype.acceptUnaryOpFunction=function(e,t,i){var r=this.acceptExpr(e,t.args[0].arg[0]);return e.visitUnaryOpFunction(i,r)};o.prototype.acceptAggFunction=function(e,t){var i=this.acceptFunctionArgs(e,t.args);return e.visitAggFunction(t.name,i)};o.prototype.acceptFunctionArgs=function(e,t){var i=this;t=t||[];var r=t.map(function(t){return t.arg&&t.arg.map(i.acceptExpr.bind(i,e))});return e.visitArgs(r)};o.prototype.acceptGroup=function(e,t){var i=this.acceptExpr(e,t.expr);return e.visitGroup(i)};o.prototype.acceptGuarded=function(e,t){var i=this.acceptExpr(e,t.expr);var r=this.acceptGuard(e,t.guard);return e.visitGuarded(i,r)};o.prototype.acceptP2P=function(e,t){return e.visitP2P(t.name,t.arg)};o.prototype.acceptTuple=function(e,t){var i=t.expr.map(this.acceptExpr.bind(this,e));return e.visitTuple(i)};o.prototype.acceptVariable=function(e,t){return e.visitVariable(t.variable)};o.prototype.acceptConstant=function(e,t){if(!r.isUndefined(t.decimal_constant)){t=r.merge({},t);t.decimal_constant/=1e3}return e.visitConstant(t)};o.prototype.acceptGuard=function(e,t){var i;if(t.comparison)i=this.acceptComparison(e,t.comparison);else if(t.conjunction)i=this.acceptConjunction(e,t.conjunction);else if(t.disjunction)i=this.acceptDisjunction(e,t.disjunction);else if(t.exists)i=this.acceptExists(e,t.exists);else if(t.negation)i=this.acceptNegation(e,t.negation);else if(t.relation)i=this.acceptRelation(e,t.relation);return e.visitGuard(i)};o.prototype.acceptComparison=function(e,t){var i=this.acceptExpr(e,t.left),r=this.acceptOp(e,t.op),n=this.acceptExpr(e,t.right);return e.visitComparison(i,r,n)};o.prototype.acceptOp=function(e,t){return e.visitOp(t)};o.prototype.acceptConjunction=function(e,t){var i=this,r=t.guard.map(function(t){return i.acceptGuard(e,t)});return e.visitConjunction(r)};o.prototype.acceptDisjunction=function(e,t){var i=this,r=t.guard.map(function(t){return i.acceptGuard(e,t)});return e.visitDisjunction(r)};o.prototype.acceptExists=function(e,t){var i=this.acceptExpr(e,t.expr);return e.visitExists(i)};o.prototype.acceptNegation=function(e,t){var i=this.acceptGuard(e,t.guard);return e.visitNegation(i)};o.prototype.acceptRelation=function(e,t){var i=this.acceptFunction(e,t);return e.visitRelation(i)};o.prototype.toString=function(){return this.accept(a)};o.prototype.getFormulaId=function(){var e=this.toString(),t=n.parseFormula(e);return t&&t.name||""};var a={visitFormula:function(e){return e.join("\n")},visitEquation:function(e,t){return e+" = "+t+"."},visitExpr:function(e){return String(e)},visitFunction:function(e){return String(e)},visitUnaryOpFunction:function(e,t){return e+t},visitOpFunction:function(e,t,i){return e+t+i},visitFunctionalPredicate:function(e,t){if(t.length>0)return e+"["+t+"]";else return e},visitAggFunction:function(e){return String(e)},visitArgs:function(e){return r.flatten(e).join(", ")},visitGroup:function(e){return String(e)},visitGuarded:function(e,t){return e+" where "+t},visitP2P:function(e,t){return"<<"+e+" = "+t+">>"},visitTuple:function(e){return e.join(", ")},visitVariable:function(e){return String(e)},visitConstant:function(e){if(!r.isUndefined(e.boolean_constant))return e.boolean_constant;else if(!r.isUndefined(e.string_constant))return e.string_constant;else if(!r.isUndefined(e.int_constant))return e.int_constant;else if(!r.isUndefined(e.float_constant))return e.float_constant+"f";else if(!r.isUndefined(e.decimal_constant))return e.decimal_constant+"d"},visitGuard:function(e){return String(e)},visitComparison:function(e,t,i){return e+t+i},visitOp:function(e){if(e==="EQUALS")return" = ";else if(e==="NOT_EQUALS")return" != ";else if(e==="GREATER_THAN")return" > ";else if(e==="LESS_THAN")return" < ";else if(e==="GREATER_OR_EQUALS")return" >= ";else if(e==="LESS_OR_EQUALS")return" <= "},visitConjunction:function(e){return e.join(", ")},visitDisjunction:function(e){return e.join("; ")},visitExists:function(e){return String(e)},visitNegation:function(e){return"!"+e},visitRelation:function(e){return String(e)}};var s={visitFormula:function(e){return e&&e[0]},visitEquation:function(e,t){return e},visitExpr:function(e){return String(e)},visitFunction:function(e){return String(e)},visitUnaryOpFunction:function(e,t){},visitOpFunction:function(e,t,i){},visitFunctionalPredicate:function(e,t){return e},visitAggFunction:function(e){},visitArgs:function(e){},visitGroup:function(e){},visitGuarded:function(e,t){},visitP2P:function(e,t){},visitTuple:function(e){},visitVariable:function(e){},visitConstant:function(e){},visitGuard:function(e){},visitComparison:function(e,t,i){},visitOp:function(e){},visitConjunction:function(e){},visitDisjunction:function(e){},visitExists:function(e){},visitNegation:function(e){},visitRelation:function(e){}};t.exports=o},{"../measurelanguage":302,lodash:70}],363:[function(e,t,i){"use strict";var r=e("immutable");function n(e){e.forEach(function(t,i){var o;if(r.Map.isMap(t)||r.List.isList(t)){o=t.size?n(t):t;if(o.size){e=e.set(i,o)}else{e=e.delete(i)}}});return e}function o(e,t,i){if(r.Map.isMap(e)&&r.Map.isMap(t)&&t.size>0&&i!==true){return e.mergeWith(a,t)}return t}function a(e,t){return o(e,t,false)}function s(e,t){return o(e,t,true)}function l(e,t){return e.reduce(function(e,i){return e.set(i.get(t),i)},r.Map()).toList()}i.listAndEmptyMapMerger=a;i.listMapMergerOverrider=s;i.clearEmptyMapsAndLists=n;i.uniq=l},{immutable:"immutable"}],364:[function(e,t,i){"use strict";var r=e("../promisebuilder");var n=e("lodash");function o(){this.$promiseCache={}}o.prototype.concurrentPromise=function(e,t,i,o){if(!n.isFunction(t)){throw new Error("fn must be a function")}var a=this,s=a.$promiseCache[e],l;if(s)return s;l=r.handleTimeout(t,o);s=r.do(l,i).onSuccess(function(){delete a.$promiseCache[e]}).onFailure(function(){delete a.$promiseCache[e]}).build();this.$promiseCache[e]=s;return s};o.prototype.sequential=function(e,t,i,o){if(!n.isFunction(t)){throw new Error("fn must be a function")}var a=this,s=a.$promiseCache[e]||Promise.resolve(),l;l=function(){return r.handleTimeout(t,o)};s=r.do(s.then(l),i).onSuccess(function(){delete a.$promiseCache[e]}).onFailure(function(){delete a.$promiseCache[e]}).build();this.$promiseCache[e]=s;return s};t.exports=o},{"../promisebuilder":331,lodash:70}],365:[function(e,t,i){"use strict";function r(e){this.$http=e.http;this.$serverUrl=e.urls.serverUrl}r.prototype.callService=function(e,t){var i=t.message,r="post",n=(t.method||r).toLowerCase(),o,a,s;a=e.indexOf("://")>-1||e.indexOf("/")===0;s=a?e:this.$serverUrl+"/"+e;switch(n){case"post":o=this.$http.post;break;case"get":o=this.$http.get;break;default:throw new Error("Illegal action method '"+n+"' for service at "+e)}return o.call(this.$http,s,i||{})};t.exports=r},{}],366:[function(e,t,i){"use strict";var r=e("lodash");var n=e("immutable");var o=e("assert");var a=e("../util");var s=e("../constant/vegalite");var l=e("../constant/sort");var u=e("../multiaxisconfig");var c=e("../view/pivot/config_helper");var d="";var p="value";var f="formatted_value";var h="Measure Values";var g="X";var m="Y";var v="Z";var y="x";var b="y";var w="color";var C="column";var E="row";var S="text";var T="descending";var x="ascending";var _="order";var M="label";var A=s.MARK.BAR;var I="category10";var O=["#A5D6A7","#2E7D32"];var D={field:f,type:s.FIELD_TYPE.NOMINAL,axis:{title:h}};function N(e,t,i){var n=$(e,t,i);if(e.config){delete e.config.heatmap}return r.merge(n,e,{mark:n.mark})}function R(e){var t=r.cloneDeep(e);delete t.data;if(t.config){if(t.config.mark){delete t.config.mark.applyColorToBackground}if(!Object.keys(t.config).length){delete t.config}}if(t.encoding){r.forEach(t.encoding,function(e,t){delete e.field;delete e.type;delete e.aggregate;delete e.sort;if(e.axis){delete e.axis.title;delete e.axis.tickColor;delete e.axis.axisColor;if(!Object.keys(e.axis).length){delete e.axis}}if(e.scale){delete e.scale.range;if(!Object.keys(e.scale).length){delete e.scale}}});t.encoding=r.pick(t.encoding,function(e){return Object.keys(e).length})}if(t.transform&&r.isArray(t.transform.calculate)){t.transform.calculate=r.filter(t.transform.calculate,{auto_generated:false});if(!t.transform.calculate.length){delete t.transform.calculate;if(!Object.keys(t.transform).length){delete t.transform}}}return n.fromJS(t)}function P(e,t){var i=r.cloneDeep(e);t=a.checkEnumValue(t,s.MARK,A);if(t===s.MARK.TEXT){i.encoding=i.encoding||{};i.encoding[S]=D}else if(i.encoding&&i.encoding[S]){delete i.encoding[S]}i.mark=t;return i}function L(e,t,i){if(!e){return null}var n=r.cloneDeep(e);n.config=n.config||{};n.config.viewport=[t,i];return n}function k(e){switch(e){case g:return b;case m:return y;case v:break}}function $(e,t,i){var o,a,l,d={},f,S={config:{}},T=t.get("axis"),x=function(e,t,i){return e.axis.get(t).reduce(function(e,t){if(t instanceof u.DimensionField){return e.concat(t.fields)}return e.push(t)},n.List()).reverse().slice(0,i)},_=c.findAxisForField(t,c.getVisibleMeasures(t).id),M=_===v,A=k(_),I=x(t,m,2).toJS(),O=x(t,g,2).toJS();if(M){S.mark=s.MARK.TEXT;S.config={mark:{applyColorToBackground:true},heatmap:true};a=T.get(v).find(function(e){return e instanceof u.MeasureGroupField}).toJS();l=V(a,i,true);if(l===s.FIELD_TYPE.QUANTITATIVE){d.aggregate=s.AGGREGATE.MEAN}o=[E,C,w];f=[{item:I.shift(),priority:4,type:s.FIELD_TYPE.ORDINAL,axes:[E]},{item:O.shift(),type:s.FIELD_TYPE.ORDINAL,priority:3,axes:[C]},{item:{id:p,fieldLabel:h},priority:2,type:l,axes:[w],options:d}]}else{if(e&&e.config&&e.config.heatmap&&e.mark===s.MARK.TEXT){S.mark=s.MARK.BAR;S.config.heatmap=false}l=V(c.getVisibleMeasures(t).toJS(),i);o=[b,y,C,E];f=[{item:I.shift(),priority:_==m?1:2,axes:[b,E]},{item:I.shift(),priority:_==m?3:4,axes:[b,E]},{item:O.shift(),priority:_==g?1:2,axes:[y,C]},{item:O.shift(),priority:_==g?3:4,axes:[y,C]},{item:{id:p,fieldLabel:h
},type:l,priority:0,axes:[A],options:d}]}S=r.merge({},e,S,{encoding:U(f,o,i,S.config.heatmap)});F(S,a);return P(S,S.mark||e.mark)}function F(e,t){var i,n,o=[];if(t&&t.fields){i=r.chain(t.fields).filter(function(e){if(e.format&&e.format.includes("%")){return true}}).map(function(e){return"datum.Measures === '"+e.fieldLabel+"'"}).value();if(i.length){if(t.fields.length===1){n="datum.value*100"}else{n="("+i.join(" || ")+") ? datum.value * 100 : datum.value"}o.push({field:"value",expr:n,auto_generated:true})}}if(o.length){e.transform={calculate:o}}}function V(e,t,i){if(!e){return s.FIELD_TYPE.NOMINAL}var n,o;if(i&&e&&e.sliceValue){n=t.getMeasureInfo(e.sliceValue);o=n&&n.type&&n.type.kind;return H(o)}return r.chain(e.fields).map(function(e){n=t.getMeasureInfo(e.id);return H(n.type.kind)}).reduce(function(e,t){if(e===t){return e}return s.FIELD_TYPE.NOMINAL}).value()}function q(e,t){o(e&&t,"Entity and MeasureModel should be passed");var i,r,n=e.qualifiedLevel;if(n&&n.dimension&&n.level){r=t.getLevel(n.dimension,n.level)}else if(e.name){r=t.getMeasureInfo(e.name)}i=r&&r.type&&r.type.kind;if(!i){return s.FIELD_TYPE.NOMINAL}return H(i.kind)}function H(e){switch(e){case"DECIMAL":case"FLOAT":case"INT":case"PERCENTAGE":return s.FIELD_TYPE.QUANTITATIVE;default:return s.FIELD_TYPE.NOMINAL}}function U(e,t,i,n){var o=t.slice(0),a,s="empty",l=r.chain(e).filter("item").sortBy("priority","asc").slice(0,o.length).mapKeys(function(e){return r.find(e.axes,function(e){a=o.indexOf(e);if(a!==-1){return o.splice(a,1)}})||o.splice(o.length-1,1)||s}).mapValues(r.partial(B,i,n)).value();delete l[s];return l}function B(e,t,i,n){var o=i.item,a=o.fieldLabel||o.id,s={field:W(o.id),type:i.type||q(o,e),axis:{title:a,axisColor:"#666666",tickColor:"#b7b7b7"}};s=z(s,o);if(n===w){s.scale={range:t?O:I}}r.merge(s,i.options);return s}function z(e,t){var i=t.sortConfigs&&t.sortConfigs.find(function(e){return e.measure.attribute});if(i){var r=l.getSortAttr(i.measure.attribute.name),n=l.getSortType(i.sortType)===l.ASCENDING?x:T;switch(r){case _:e.sort={field:e.field+"_"+"index",op:s.AGGREGATE.MEAN,order:x};break;case M:e.sort=n;break;default:e.sort={field:e.field+"_sort",op:s.AGGREGATE.MEAN,order:n};break}}return e}function j(e,t){var i=[],n,o,a,s=e.length,l=s&&e[0]&&e[0].length,u=l&&e[0][0],c,d,p,f=0,h=function(e){var r,n=e&&e.rawValue;if(t||typeof n!=="undefined"){r=e.formattedValue;i.push(new c(e.xKeys,e.yKeys,n,r,f++))}};if(!s){return[]}if(!u){u=e[0]}u=u&&u[0];d=r.map(u.xKeys,"field");p=r.map(u.yKeys,"field");c=G(d,p);if(!l&&u){for(o=0;o<s;o++){h(e[o])}}else{for(o=0;o<s;o++){a=e[o];for(n=0;n<l;n++){h(a[n][0])}}}return i}var G=function(e,t){var i=e&&e.length||0,r=t&&t.length||0;return function(n,o,a,s,l){var u,c,d=this,h=function(e,t){d[t]=e.label||e.id;if(typeof e.index!=="undefined"){d[t+"_index"]=e.index}if(typeof e.sortValue!=="undefined"){d[t+"_sort"]=e.sortValue}};for(u=0;u<i;u++){h(n[u],W(e[u]))}for(c=0;c<r;c++){h(o[c],W(t[c]))}this[p]=a;this[f]=s||a;this.index=l}};function W(e){return e.replace(":",d).replace("-",d)}t.exports={buildVegaSpec:N,setMarkType:P,extractChartConfigFromVegaSpec:R,applyViewportSize:L,convertCellDataToVegaData:j}},{"../constant/sort":268,"../constant/vegalite":272,"../multiaxisconfig":328,"../util":357,"../view/pivot/config_helper":455,assert:2,immutable:"immutable",lodash:70}],367:[function(e,t,i){"use strict";var r=e("assert");var n=e("immutable");var o=e("lodash");var a=e("../util");var s=e("../constant");var l=s.View;var u=s.Layout;var c="viewMode";var d="config";var p="module";var f=[c,p];var h={shape:{rows:"1",columns:"1"},viewPositions:{}};function g(e){r(e,["Config can't be empty"]);var t=o.values(u.VIEW_MODE),i;i=e.get("views").find(function(e){var i=e.get(c);return t.indexOf(i)!==-1&&i!==u.VIEW_MODE.DEFAULT});return i&&i.get(c)||u.VIEW_MODE.DEFAULT}function m(e,t){r(t,["Config can't be empty"]);var i=o.values(u.VIEW_MODE),n=t.getIn(["views",e,c]);if(i.indexOf(n)!==-1){return n}return u.VIEW_MODE.DEFAULT}function v(e,t){r(e,["Config can't be empty"]);var i=e.get("views"),o;if(!i||!i.size){return[]}t=a.checkEnumValue(t,u.VIEW_MODE,u.VIEW_MODE.DEFAULT);o=i.reduce(function(e,i,r){if((i.get(c)||u.VIEW_MODE.DEFAULT)===t){e=e.push(r)}return e},n.List());return o.toJS()}function y(e){var t=g(e);return!t||t===u.VIEW_MODE.DEFAULT}function b(e,t,i,r,o){var a=e;e=e.setIn(["views",t],n.fromJS(i)||n.Map());e=e.deleteIn(["views",t,"closed"]);if(r&&(o||!E(a,t))){e=e.updateIn(["layout"],function(e){return n.fromJS(h).merge(e)});e=e.setIn(["layout","viewPositions",t],n.fromJS(r))}return e}function w(e,t,i){if(e.getIn(["views",t])){if(i){e=e.setIn(["views",t,"closed"],true)}else{e=e.deleteIn(["views",t])}}e=e.deleteIn(["layout","viewPositions",t]);return e}function C(e,t,i,r){var n;i=i||u.VIEW_MODE.DEFAULT;function o(e,t,i){return e.withMutations(function(e){if(t){if(e.get("config")){e=e.mergeIn(["config"],t)}else{e=e.set("config",t)}}if(i){e=e.set(c,i)}return e})}switch(i){case u.VIEW_MODE.CONFIGURATION:n=function(e,n){if(n===t){return o(e,r,i)}else{return e.delete(c)}};break;case u.VIEW_MODE.FORM:case u.VIEW_MODE.CHART:n=function(e,n){if(n===t){return o(e,r,i)}return e};break;default:n=function(e){return o(e,r).delete(c)};break}e=e.update("views",function(e){return e.map(n)});return e}function E(e,t){if(!e||!e.get("views")&&!e.get("layout")){return false}var i=e.getIn(["views",t]),r=e.getIn(["layout","viewPositions",t]);if(i&&i.get("closed")){return false}return!!(i||r)}function S(e,t){var i=e.getIn(["views",t]),r;if(i){if(i.has(d)){return true}return!!i.find(function(e,t){return f.indexOf(t)===-1})}return false}function T(e,t){var i,r=e.get("views");i=r.findKey(function(e){return e.get("module")===t});return i||t&&t.toLowerCase()}function x(e,t){return e.getIn(["views",T(e,t)])}function _(e,t){return e.getIn(["views",t])}function M(e,t,i){var r=i.get(p)||e.getIn(["views",t,p]),o={config:i.get(d)||i};if(i.has(d)){i.forEach(function(e,t){if(t!==d){o[t]=e}})}return e.setIn(["views",t],n.Map(o))}function A(e,t,i){var r=T(e,t);return M(e,r,i)}t.exports={getCurrentViewMode:g,getCurrentViewModeInParentLayout:m,findViewsInViewMode:v,isDefaultViewMode:y,setViewModeInLayout:C,openViewInLayout:b,closeViewInLayout:w,isViewOpenedInLayout:E,getInlineViewId:T,getInlineViewState:x,getInlineViewStateById:_,setInlineViewState:A,setInlineViewStateById:M,isViewInline:S}},{"../constant":256,"../util":357,assert:2,immutable:"immutable",lodash:70}],368:[function(e,t,i){"use strict";var r=e("lodash");var n=e("./formatparser");function o(){this.$validators={};this.$doesNotHaveNumbersRegExp=new RegExp("^([+-/*%]+)$");this.$decimalRegExp=r.template("(([1-9]\\d{0,2}(\\<%= delimiters.thousands %>\\d{3})*)|\\d{0,1}|[1-9]\\d*)?(\\<%= delimiters.decimal %>\\d*)?([kKmMbBtT])?");this.$intRegExp=r.template("(((([1-9]\\d{0,2}(\\<%= delimiters.thousands %>\\d{3})*)|\\d{0,1}|[1-9]\\d*)?([kKmMbBtT])?)|(\\d\\<%= delimiters.decimal %>((\\d{1,3}[kK])|(\\d{1,6}[mM])|(\\d{1,9}[bB])|(\\d{1,12}[tT]))))");this.$regExp=r.template("^((((\\+-|\\+)<%= numberWithSymbol %>)|(([/*])<%= decimalNumber %>)|((\\+-|\\+)<%= decimalNumber %>%))|(-?<%= numberWithSymbol %>))([ERPD])?$");this.$percentageRegExp=r.template("^((((\\+-|\\+)(<%= numberWithRequiredSymbol %>|<%= decimalNumber %>))|(([/*])<%= decimalNumber %>))|(-?<%= numberWithSymbol %>)([ERPD])?)$")}o.prototype.$getValidatorName=function(e,t){return e+":"+t};o.prototype.getFor=function(e,t){var i=this.$getValidatorName(e,t),r=this.$validators[i];if(!r){r=this.$createValidator(e,t);this.$validators[i]=r}return r};o.prototype.$createValidator=function(e,t){var i=this,o=n.parse(e,t),a=["DECIMAL","FLOAT"].indexOf(e)>=0?i.$decimalRegExp:i.$intRegExp,s,l,u,c,d=i.$decimalRegExp(o),p,f,h;a=a(o);s=a;l=a;if(o.isPercentage){p="%";u=i.$percentageRegExp}else{u=i.$regExp;if(o.currency){p=o.currency.symbol}}if(!r.isUndefined(p)){f="(\\"+p+")";h=f+"?";if(o.currency&&o.currency.isPrefix){s=h+s;l=f+l}else{s+=h;l+=f}}u=u({decimalNumber:d,numberWithSymbol:s,numberWithRequiredSymbol:l});c=new RegExp(u);return{format:o,regExpString:u,regExp:c,validate:function(r){var n={valid:true,info:"This cell is "+e+" and its format is "+t+"."};if(r==="")return n;var o=!i.$doesNotHaveNumbersRegExp.test(r);if(o){n.valid=c.test(r);return n}else{return{valid:false,info:"The input should have numbers."}}}}};o.prototype.validate=function(e,t,i){if(["DECIMAL","INT","FLOAT"].indexOf(t)<0){return{valid:true}}return this.getFor(t,i).validate(e)};t.exports=new o},{"./formatparser":292,lodash:70}],369:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=r.DOM;var a=e("./asyncwrapper");var s=e("lodash");var l=r.createClass({displayName:"AceEditor",propTypes:{code:r.PropTypes.string,completionTokens:r.PropTypes.array,commands:r.PropTypes.array,onChange:r.PropTypes.func},componentDidMount:function(){var e=this;var t=e.editor=ace.edit(n.findDOMNode(e.refs.editorContainer));t.setOptions({maxLines:5,showGutter:false,enableBasicAutocompletion:this.props.completionTokens,enableLiveAutocompletion:true,highlightActiveLine:false});t.setTheme("ace/theme/textmate");t.setValue(e.props.code||"",1);if(this.props.completionTokens){t.completers=[{getCompletions:function(t,i,r,n,o){o(null,e.props.completionTokens)}}]}t.session.on("change",this.onFormulaChange);if(this.props.mode){t.session.setMode(this.props.mode)}if(this.props.commands){this.props.commands.forEach(function(e){t.commands.addCommand(e)})}t.resize();t.focus()},getValue:function(){return this.editor.getValue().trim()},onFormulaChange:function(){var e=this.editor;try{this.props.onChange(e.getValue())}catch(e){console.error(e.stack||e)}},render:function(){return o.div({className:"editor",ref:"editorContainer"})}});var u=a(l);var c=r.createClass({render:function(){var e=s.merge({scriptUrls:["/js/ace.js","/js/ext-language_tools.js"]},this.props);return r.createElement(u,e)}});t.exports=c},{"./asyncwrapper":372,lodash:70,react:"react","react-dom":"react-dom"}],370:[function(e,t,i){"use strict";var r=e("classnames");var n=e("react");var o=e("../util/eventlistenermixin");var a=e("./spinner").CircleSpinner;var s=e("react-addons-pure-render-mixin");var l=e("../constant").ACTIONS.ActionEvents;var u=n.createClass({displayName:"ActionButtonsPanel",mixins:[s],propTypes:{children:n.PropTypes.object.isRequired},handleClick:function(e,t){t.preventDefault();this.props.onClick(e,t)},render:function(){var e=r({horizontal:this.props.width>this.props.height,vertical:this.props.height>this.props.width},"action-button-panel");return n.DOM.div({className:e,ref:"action-button-panel"},this.props.children)}});var c=n.createClass({displayName:"ActionButton",mixins:[s],propTypes:{onClick:n.PropTypes.func.isRequired,label:n.PropTypes.string.isRequired,isActive:n.PropTypes.bool,isSpinning:n.PropTypes.bool},getDefaultProps:function(){return{isActive:true,isSpinning:false}},render:function(){var e=r({"action-button":true,btn:true,"btn-default":true});return n.DOM.button({ref:this.props.label,className:e,onClick:this.props.onClick,disabled:!this.props.isActive||this.props.isSpinning,title:this.props.label},this.props.label,n.createElement(a,{visible:this.props.isSpinning,inline:true}))}});var d=n.createClass({displayName:"ActionButtonController",mixins:[o],propTypes:{actionId:n.PropTypes.string.isRequired,label:n.PropTypes.string.isRequired},setEventListeners:function(){var e=this.props.modelerApp,t=e.getActionStore();return[{emitter:t,event:l.CHANGED,callback:this.onChange}]},getInitialState:function(){return this.getStateFromStores()},render:function(){return n.createElement(c,{onClick:this.onButtonClick,label:this.props.label,isActive:this.state.isActive&&!this.hasErrorMessage(),isSpinning:this.state.isSpinning})},hasErrorMessage:function(){return this.state.status&&this.state.status.message},onChange:function(){this.setState(this.getStateFromStores())},componentDidUpdate:function(){var e=this.props.modelerApp,t=e.getNotificationsActionHandler(),i=e.getActionActionHandler();if(this.hasErrorMessage()){i.clearStatus(this.props.actionId);t.notify(this.state.status.type,this.state.status.message)}},getStateFromStores:function(){var e=this.props.modelerApp,t=this.props.actionId,i={},r;if(e){r=e.getActionStore();if(r.getAction(t)){i={isActive:r.isActionEnabled(t),isSpinning:r.isActionRunning(t),status:r.getActionStatus(t),onNotificationClose:this.onNotificationClose}}}return i},onButtonClick:function(){var e=this.props.modelerApp;var t=this.props.actionId;e.getModelerActionHandler().callAction(t,this.props.label);this.clicked=true}});var p=n.createClass({displayName:"ActionButtonsPanelController",mixins:[s],propTypes:{config:n.PropTypes.object.isRequired,modelerApp:n.PropTypes.object.isRequired},render:function(){var e=this.props.modelerApp,t=this.props.config.get("buttons"),i=t&&t.map(function(t){var i=t.get("actionId"),r=t.get("label");return n.createElement(d,{key:i,modelerApp:e,actionId:i,label:r})});return n.createElement(u,{width:this.props.width,height:this.props.height},i)}});i.ActionButtonsPanelController=p;i.ActionButton=c;i.ActionButtonController=d;i.ActionButtonsPanel=u;i.ActionButtonsPanelController=p},{"../constant":256,"../util/eventlistenermixin":360,"./spinner":502,classnames:6,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],371:[function(e,t,i){"use strict";var r=e("classnames");var n=e("lodash");var o=e("react");var a=e("react-dom");var s=e("treebrowser");var l=s.view.TreeBrowser;var u=s.Constants.Actions;var c=s.view.TreeBrowserNode;var d=e("./controlbuttons");var p=e("../constant");var f=p.Keys;var h=p.AssociativeFiltering.SelectionTypes;var g={};g[h.CAN_BE_INCLUDED]="can-be-included";g[h.EXPLICITLY_INCLUDED]="explicitly-included";g[h.IMPLICITLY_INCLUDED]="implicitly-included";g[h.EXCLUDED]="excluded";var m=o.createClass({displayName:"FilterNode",render:function(){var e=g[this.props.treeNode.nodeObj.type],t=n.extend({},this.props,{extraClasses:e}),i=null;if(this.props.treeNode.nodeObj.isSelected){i=o.DOM.span({className:"fa fa-check"})}return o.createElement(c,t,i)}});var v=o.createClass({displayName:"AssociativeFilter",propTypes:{onCancel:o.PropTypes.func.isRequired,levels:o.PropTypes.array,isSlice:o.PropTypes.bool,onSelect:o.PropTypes.func.isRequired,onSelectAll:o.PropTypes.func,onApply:o.PropTypes.func.isRequired,onDiscard:o.PropTypes.func.isRequired,onUndo:o.PropTypes.func.isRequired,onPushpin:o.PropTypes.func.isRequired,focusField:o.PropTypes.any,searchText:o.PropTypes.string},getInitialState:function(){var e=this.props.searchText?this.filterLevels(this.props.levels,this.props.searchText):this.props.levels;return{levels:e,searchKeyword:this.props.searchText,shouldUseHighlighting:true}},$isFocusFieldColumn:function(e){return this.state.levels[e].qName===this.props.focusField},$shouldUseHighlighting:function(e){return this.state.shouldUseHighlighting&&this.$isFocusFieldColumn(e)},shouldComponentUpdate:function(e){return!!e.levels},getFocusField:function(){return this.state.searchKeyword?null:this.props.focusField},onKeyUp:function(e){switch(e.keyCode){case f.ENTER:this.focusLevel(a.findDOMNode(this.refs.searchInput).value);break;case f.ESC:this.props.onCancel();break;case f.DOWN:this.focusLevel();break}},onChange:function(){this.setState({searchKeyword:a.findDOMNode(this.refs.searchInput).value,focus:undefined,shouldUseHighlighting:false});this.search(a.findDOMNode(this.refs.searchInput).value)},focusLevel:function(e){var t,i=0;if(!n.isUndefined(this.lastFocusedColumn)&&this.state.levels[this.lastFocusedColumn].children.length){t=this.lastFocusedColumn}else{for(var r=0;r<this.state.levels.length;r++){if(this.state.levels[r].children.length){if(!e){t=r;break}else{i=n.findIndex(this.state.levels[r].children,{label:e});if(i!==-1){t=r;break}}}}}if(!n.isUndefined(t)){this.setState({focus:{x:t,y:i},shouldUseHighlighting:this.$shouldUseHighlighting(t)})}},onTreeBrowserAction:function(e,t,i,r,o){var a,s,l;switch(i){case u.NODE_KEY_UP:this.onTreeBrowserNodeKeyUpAction(e,t,r,o);break;case u.CANCEL:this.props.onCancel();break;case u.SEARCH:this.search(r);this.focusSearchInput();break;case u.BACKSPACE:if(this.state.searchKeyword){this.search(this.state.searchKeyword.slice(0,-1))}this.focusSearchInput();break;case u.MOVE_OUT_UP:this.lastFocusedColumn=t;this.focusSearchInput();break;case u.MOVE_LEFT:if(t>0){this.setState({focus:{x:t-1,y:Math.max(n.findIndex(this.state.levels[t-1].children,"isSelected"),0)},shouldUseHighlighting:false})}break;case u.MOVE_RIGHT:if(t<this.state.levels.length-1){this.setState({focus:{x:t+1,y:Math.max(n.findIndex(this.state.levels[t+1].children,"isSelected"),0)},shouldUseHighlighting:false})}break;case u.SELECT:this.onTreeBroserSelectAction(e,t,r.node);break;case u.SELECT_RANGE:this.setState({focus:{x:t,y:r.end},shouldUseHighlighting:this.$shouldUseHighlighting(t)});a=r.start>r.end?r.end:r.start;s=r.end<r.start?r.start:r.end;if(this.props.onSelectAll){l=e.children.slice(a,s+1);if(a!==r.start){l.reverse()}this.props.onSelectAll(e.qName,l)}else{this.onSelect(e.field,t,e.children[r.end])}break}},onTreeBrowserNodeKeyUpAction:function(e,t,i,r){if(r.keyCode===f.SPACE||r.keyCode===f.ENTER)this.onSelect(e.field,t,i.node.nodeObj,r.keyCode===f.ENTER)},onTreeBroserSelectAction:function(e,t,i){var r=new Date;if(this.lastSelected&&this.lastSelected.id===i.nodeObj.id&&r-this.lastSelectedTime<p.DOUBLE_CLICK_TIME){this.onApply()}else{this.onSelect(e.field,t,i.nodeObj)}this.lastSelected=i.nodeObj;this.lastSelectedTime=r},filterLevels:function(e,t){t=t.toLowerCase();return e.map(function(e){return{field:e.field,qName:e.qName,label:e.label,children:e.children.filter(function(e){return e.label.toLowerCase().indexOf(t)!==-1})}})},search:n.debounce(function(e){this.setState({levels:e?this.filterLevels(this.props.levels,e):this.props.levels,searchKeyword:e,focus:undefined,shouldUseHighlighting:false})},200),focusSearchInput:function(){var e=this.refs.searchInput,t=e.value.length;e.focus();e.setSelectionRange(t,t)},onSelect:function(e,t,i,r){if(this.state.levels[t]){this.setState({focus:{x:t,y:n.findIndex(this.state.levels[t].children,{id:i.id})},shouldUseHighlighting:this.$shouldUseHighlighting(t)});this.props.onSelect(e,i,r)}},onApply:function(){this.props.onApply()},componentDidMount:function(){this.focusSearchInput()},componentWillReceiveProps:function(e){var t=this.state.searchKeyword?this.filterLevels(e.levels,this.state.searchKeyword):e.levels;this.setState({levels:t})},selectPossible:function(e,t){var i=this.state.levels.findIndex(function(t){return t.qName===e});this.props.onSelectAll(e,t.filter(function(e){return e.type!==h.EXCLUDED}));this.setState({focus:{x:i}})},concatTreeBrowserName:function(e){return"treeBrowser"+e},render:function(){var e=this,t=null;if(this.state.levels&&this.state.levels.length){t=this.state.levels.map(function(t,i){var a={index:-1,disable:true},s=null;if(e.props.onSelectAll){s=o.DOM.a({className:"select-all",title:"Select/Deselect Possible",href:"javascript:",tabIndex:"-1",onClick:e.selectPossible.bind(e,t.qName,t.children)})}if(e.props.isSlice){a.index=n.findIndex(t.children,"isSelected")}if(e.getFocusField()===t.qName&&!e.state.focus){a.index=n.findIndex(t.children,"isSelected");a.disable=false}if(e.state.focus&&e.state.focus.x===i){a.index=e.state.focus.y;a.disable=false}return o.DOM.div({className:r({"lb-af-tree-browser-wrapper":true,highlighted:e.props.focusField===t.qName}),key:e.concatTreeBrowserName(i)},o.DOM.div({className:"lb-af-tree-br-name"},o.DOM.span(null,t.label||t.qName),s),o.createElement(l,{ref:e.concatTreeBrowserName(i),tree:t,validators:{selectNode:function(e){return false}},nodeElement:m,infiniteScrolling:true,onAction:e.onTreeBrowserAction.bind(e,t,i),focus:a}))})}return o.DOM.div({className:"lb-associative-filter"},o.DOM.div({className:"lb-input-wrapper"},o.DOM.span({className:"search-input-wrapper"},o.DOM.input({className:"search-input lb-filter-input",type:"text",placeholder:"Search...",ref:"searchInput",value:this.state.searchKeyword||"",onChange:this.onChange,onKeyUp:this.onKeyUp}))),o.DOM.div({className:r({"lb-filters-wrapper":true,"has-highlightion":e.state.shouldUseHighlighting})},t),o.createElement(d,{undo:true,pin:true,isPinned:this.props.isPinned,onApply:this.onApply,onDiscard:this.props.onDiscard,onPushpin:this.props.onPushpin,onUndo:this.props.onUndo}))}});t.exports=v},{"../constant":256,"./controlbuttons":393,classnames:6,lodash:70,react:"react","react-dom":"react-dom",treebrowser:202}],372:[function(e,t,i){"use strict";var r=e("load-script");var n=e("react");window.$asyncViewPromises={};function o(e){return!!window.$asyncViewPromises[e]}function a(e){return window.$asyncViewPromises[e]}function s(e,t){window.$asyncViewPromises[e]=t}function l(e){return n.createClass({displayName:e.displayName+"AsyncView",propTypes:{scriptUrls:n.PropTypes.array.isRequired,loadingElement:n.PropTypes.element},getInitialState:function(){return{isReady:false}},componentDidMount:function(){this.promises=this.loadScripts()},componentWillUnmount:function(){this.promises=null},loadScripts:function(){var e=this,t=this.props.scriptUrls.map(function(e){var t=window.location.origin+e,i;if(o(t)){return a(t)}i=new Promise(function(t,i){r(e,{async:false},function(e,r){if(e){i(e)}else{t(r)}})});s(t,i);return i});return Promise.all(t).then(function(){if(e.promises){e.setState({isReady:true})}})},render:function(){if(this.state.isReady){return n.createElement(e,this.props)}else{return this.props.loadingElement||null}}})}t.exports=l},{"load-script":69,react:"react"}],373:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("assert");var a=e("../modeler");var s=e("./modelernavbar");var l=e("./login").LoginForm;var u=e("./unauthorizedwindow").UnauthorizedWindow;var c=e("./cssloader");var d=e("../util/canvasbuilderutil").buildModelerNavigationCanvas;var p=e("../constant").User.EVENTS;var f=r.createClass({displayName:"AuthenticatedModelerController",propTypes:{onStart:r.PropTypes.func,loginUrl:r.PropTypes.string.isRequired,workspace:r.PropTypes.string,realm:r.PropTypes.string.isRequired,loginPageUrl:r.PropTypes.string,brandImg:r.PropTypes.element,brandHref:r.PropTypes.string,navigationTreeId:r.PropTypes.string,pageConfig:r.PropTypes.object,actionButtons:r.PropTypes.array,fullStory:r.PropTypes.shape({enabled:r.PropTypes.bool,startByDefault:r.PropTypes.bool,organizationKey:r.PropTypes.string})},getInitialState:function(){return{userName:null,started:false,initialized:false}},componentWillMount:function(){var e,t;o(this.props.navigationTreeId||this.props.pageConfig,"The AuthenticatedModelerController must be passed either a pageConfig or a navigationTreeId.");this.config=n.merge({events:{onAuthenticationFailure:this.onAuthenticationFailure,onAuthorizationFailure:this.onAuthorizationFailure},pageConfig:d(this.props.navigationTreeId)},this.props);this.modeler=new a(this.config);e=this.modeler.getApp();t=e.getUserStore();t.on(p.CHANGED,this.onAuthenticationChanged);e.getUserActionHandler().checkIsAuthenticated()},componentWillUnmount:function(){this.modeler.getApp().getUserStore().off(p.CHANGED,this.onAuthenticationChanged)},onStart:function(){var e=this.modeler.getApp();if(this.originalHash){window.location.hash=this.originalHash}this.setTitle();if(n.isFunction(this.props.onStart)){this.props.onStart(e)}},setTitle:function(){var e=this.modeler.getApp(),t=this.config.workbookId,i=e.getWorkbookDAO();if(t){i.get({"workbook-id":t}).then(function(e){var t=e[0],i=t&&t.name;if(i){document.title=i}})}},onAuthenticationChanged:function(){var e=this.getModelerApp(),t=e.getUserStore(),i=e.getViewConfigActionHandler(),r=this,n=t.isAuthenticated();if(n){var o=t.getCurrentUserName();if(!this.state.started){this.modeler.start().then(this.onStart).then(function(){r.setState({started:true,initialized:true,userName:o})})}else{this.setState({userName:o})}}else{this.onUserUnauthenticated()}},onUserUnauthenticated:function(){this.stop();this.originalHash=window.location.hash;if(this.props.loginPageUrl){window.location=window.location.origin+this.props.loginPageUrl}else{window.location.hash=this.props.loginUrl}},onAuthenticationFailure:function(){this.originalHash=window.location.hash;window.location.hash="#/login";this.modeler.close();this.setState({userName:null,initialized:true})},onAuthorizationFailure:function(e){window.location.hash="#/unauthorized";this.setState({unauthorizedObjectId:e});this.buildUnauthorizedWindow()},isLoggedIn:function(){return this.getModelerApp().getUserStore().isAuthenticated()&&!this.state.unauthorizedObjectId},getModelerApp:function(){if(this.modeler){return this.modeler.getApp()}},stop:function(){if(this.modeler){this.modeler.close()}this.setState({started:false,userName:null})},buildLoginForm:function(){var e=this.modeler.getApp().getUserActionHandler();return r.createElement(l,{loginFn:e.authenticate.bind(e)})},buildUnauthorizedWindow:function(){return r.createElement(u,{title:"Unauthorized Access",width:"500px",objectId:this.state.unauthorizedObjectId.type})},buildContentView:function(){var e,t=this.getModelerApp().getUserStore(),i=t.isAuthenticated();if(!this.state.initialized){return r.createElement(c,{caption:"Loading..."})}if(!i){if(!this.props.loginPageUrl){e=this.buildLoginForm()}}else if(this.state.unauthorizedObjectId&&this.state.unauthorizedObjectId.type==="AUTHORIZATION_FAILURE"){e=this.buildUnauthorizedWindow()}else if(this.isLoggedIn()&&this.state.started){e=r.DOM.div({style:{top:"51px",bottom:"0px",width:"100%",position:"absolute"}},this.modeler.getView())}return e},render:function(){var e=this.modeler&&this.modeler.getApp(),t=this.buildContentView(),i=this.props.brandImg,n=this.props.brandHref,o=this.isLoggedIn()&&this.props.actionButtons||undefined,a=this.state.initialized?r.createElement(s,{modelerApp:e,userDisplayName:this.state.userName,brandImg:i,brandHref:n,actionButtons:o,fullStory:this.props.fullStory},this.props.menuItems):null;return r.DOM.div({className:"auth-modeler"},a,t)}});t.exports=f},{"../constant":256,"../modeler":311,"../util/canvasbuilderutil":358,"./cssloader":395,"./login":426,"./modelernavbar":440,"./unauthorizedwindow":506,assert:2,lodash:70,react:"react"}],374:[function(e,t,i){"use strict";var r=e("react");var n=e("classnames");var o=e("treebrowser");var a=o.Constants.Actions;var s=e("../controlbuttons");var l=e("./measuretreebrowser");var u=e("./dimensiontreebrowser");var c=e("../../constant");var d=c.Keys;var p={MEASURES:"MeasureTree",DIMENSIONS:"DimensionTree"};var f=r.createClass({displayName:"AxisConfiguration",propTypes:{dimensionTree:r.PropTypes.object.isRequired,measureTree:r.PropTypes.object.isRequired,onCancel:r.PropTypes.func.isRequired,onApply:r.PropTypes.func.isRequired,measureSelectionChanged:r.PropTypes.func.isRequired,dimensionSelectionChanged:r.PropTypes.func.isRequired,canAddField:r.PropTypes.func.isRequired,canAddMeasure:r.PropTypes.func.isRequired,pivotState:r.PropTypes.object,isSlice:r.PropTypes.bool,hasMeasures:r.PropTypes.bool,outlineClickHandler:r.PropTypes.func,rollupClickHandler:r.PropTypes.func,rotateIcon:r.PropTypes.bool},getInitialState:function(){return{focusOn:undefined,selectionChanged:false,filterKeyword:undefined}},onMeasureTreeBrowserAction:function(e,t,i){this.onTreeBrowserAction(p.MEASURES,e,t,i)},onDimensionTreeBrowserAction:function(e,t,i){this.onTreeBrowserAction(p.DIMENSIONS,e,t,i)},onTreeBrowserAction:function(e,t,i,r){switch(t){case a.SELECT:case a.SELECT_RANGE:this.setState({focusOn:e===p.MEASURES?p.MEASURES:p.DIMENSIONS});break;case a.CANCEL:this.props.onCancel();break;case a.MOVE_OUT_UP:this.focusInput();break;case a.NODE_KEY_UP:if(r.keyCode===d.ENTER&&!i.node.hasOwnProperty("children")){this.onApply(i.node)}break;case a.MOVE_LEFT:if(this.$showingMeasuresColumn()&&this.refs.measureTreeBrowser.hasVisibleNodes()){this.setState({focusOn:p.MEASURES})}break;case a.MOVE_RIGHT:if(this.$showingMeasuresColumn()&&this.refs.dimensionTreeBrowser.hasVisibleNodes()){this.setState({focusOn:p.DIMENSIONS})}break}},onInputKeyUp:function(e){switch(e.keyCode){case d.DOWN:this.setState({focusOn:this.refs.measureTreeBrowser&&this.refs.measureTreeBrowser.hasVisibleNodes()?p.MEASURES:p.DIMENSIONS});break;case d.ESC:this.props.onCancel();break}},onInputChange:function(){this.setState({filterKeyword:this.refs.searchInput.value})},$isDoubleClick:function(e){var t,i;if(e.length===1){t=new Date;i=e[0].id;if(this.lastSelectedId===i&&t-this.lastSelectedTime<c.DOUBLE_CLICK_TIME){return true}else{this.lastSelectedId=i;this.lastSelectedTime=t}}},onMeasureSelect:function(e,t){if(this.$isDoubleClick(e)){this.onApply()}else if(!this.changesApplied){this.props.measureSelectionChanged(e,t);this.setState({focusOn:p.MEASURES,selectionChanged:true})}},onDimensionSelect:function(e){if(this.$isDoubleClick(e)){this.onApply()}else if(!this.changesApplied){this.props.dimensionSelectionChanged(e);this.setState({focusOn:p.DIMENSIONS,selectionChanged:true})}},outlineClickHandler:function(e,t){this.props.outlineClickHandler(e,t);this.setState({selectionChanged:true})},rollupClickHandler:function(e,t){this.props.rollupClickHandler(e,t);this.setState({selectionChanged:true})},focusInput:function(){this.refs.searchInput.focus();this.setState({focusOn:undefined})},componentDidMount:function(){this.onInputChange();this.focusInput()},onApply:function(e){if(this.state.selectionChanged||e&&(e.levelIds||e.measureIds||e.attributeIds)){this.props.onApply(e);this.changesApplied=true}},$showingMeasuresColumn:function(){return this.props.hasMeasures||!this.props.isSlice},renderSearchInput:function(){return r.DOM.div({className:"search-input-wrapper"},r.DOM.input({className:"search-input lb-filter-input",type:"text",placeholder:"Search...",ref:"searchInput",value:this.state.filterKeyword||"",onKeyUp:this.onInputKeyUp,onChange:this.onInputChange}))},renderMeasureTree:function(){return r.createElement(l,{ref:"measureTreeBrowser",key:"measureTreeBrowser",tree:this.props.measureTree,onTreeBrowserAction:this.onMeasureTreeBrowserAction,onSelect:this.onMeasureSelect,canAddField:this.props.canAddField,canAddMeasure:this.props.canAddMeasure,isSlice:this.props.isSlice,hasMeasures:this.props.hasMeasures,filterKeyword:this.state.filterKeyword,hasFocus:this.state.focusOn===p.MEASURES})},renderDimensionTree:function(){return r.createElement(u,{ref:"dimensionTreeBrowser",key:"dimensionTreeBrowser",tree:this.props.dimensionTree,onTreeBrowserAction:this.onDimensionTreeBrowserAction,onSelect:this.onDimensionSelect,canAddField:this.props.canAddField,isSlice:this.props.isSlice,filterKeyword:this.state.filterKeyword,outlineClickHandler:this.outlineClickHandler,rollupClickHandler:this.rollupClickHandler,rotateIcon:this.props.rotateIcon,hasFocus:this.state.focusOn===p.DIMENSIONS})},renderControlPanel:function(){return r.createElement(s,{onApply:this.onApply,onDiscard:this.props.onCancel})},render:function(){var e=n({"on-slice":this.props.isSlice},"lb-axis-configuration");return r.DOM.div({className:e},this.renderSearchInput(),r.DOM.div({className:"lb-axis-configuration-wrapper"},this.$showingMeasuresColumn()?[this.renderMeasureTree(),this.renderDimensionTree()]:this.renderDimensionTree()),this.renderControlPanel())}});t.exports=f},{"../../constant":256,"../controlbuttons":393,"./dimensiontreebrowser":375,"./measuretreebrowser":377,classnames:6,react:"react",treebrowser:202}],375:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("../../constant");var a=o.Keys;var s=e("./dimensiontreenode");var l=e("treebrowser");var u=l.view.TreeBrowser;var c=l.Constants.Actions;var d=n.createClass({displayName:"DimensionTreeBrowser",propTypes:{tree:n.PropTypes.object.isRequired,onTreeBrowserAction:n.PropTypes.func.isRequired,onSelect:n.PropTypes.func.isRequired,canAddField:n.PropTypes.func.isRequired,isSlice:n.PropTypes.bool,filterKeyword:n.PropTypes.string,outlineClickHandler:n.PropTypes.func,rollupClickHandler:n.PropTypes.func,rotateIcon:n.PropTypes.bool,hasFocus:n.PropTypes.bool.isRequired},getInitialState:function(){
return{focusIndex:0}},getSelectedLevels:function(){return this.refs.dimensionBrowser.getSelection().filter(function(e){return!e.isDisabled})},getSelectedLevelIds:function(){return r.map(this.getSelectedLevels(),"id")},hasVisibleNodes:function(){return this.refs.dimensionBrowser.getTreeState().getFilteredTreeLength()>0},onTreeBrowserAction:function(e,t,i){var r=this,n=[],o,s;switch(e){case c.SELECT:this.setState({focusIndex:t.index});break;case c.SELECT_RANGE:if(t.start>t.end){t.nodes.reverse()}o=t.nodes.length&&!t.nodes[t.nodes.length-1].nodeObj.isSelected;t.nodes.forEach(function(e){if(!e.children&&r.canToggleNodeSelection(e)){n.push({id:e.nodeObj.id,selected:o,inline:true,rollup:true})}});this.$onSelectMultiple(n);this.setState({focusIndex:t.end});break;case c.NODE_KEY_UP:s=t.node;if(i.keyCode===a.ENTER&&!s.hasOwnProperty("children")&&!s.nodeObj.isDisabled){s.levelIds=[{id:s.nodeObj.id,selected:true}]}this.setState({focusIndex:t.index});break}this.props.onTreeBrowserAction(e,t,i)},onSelect:function(e){this.$onSelectMultiple([{id:e.id,selected:!e.isSelected,inline:true,rollup:true}])},$onSelectMultiple:function(e){this.props.onSelect(e)},canToggleNodeSelection:function(e){return!e.nodeObj.isDisabled&&(e.nodeObj.isSelected||this.props.canAddField(e.nodeObj.id))},render:function(){var e=this;return n.DOM.div({className:"lb-dimensions-browser-wrapper",key:"dimensionBrowser"},n.DOM.div({className:"lb-af-tree-br-name"},n.DOM.span(null,"Dimensions")),n.createElement(u,{ref:"dimensionBrowser",nodeElement:function(t){var i=r.assign({},t,{canAddField:e.props.canAddField,outlineClickHandler:e.props.outlineClickHandler,rollupClickHandler:e.props.rollupClickHandler,rotateIcon:e.props.rotateIcon});return n.createElement(s,i)},tree:this.props.tree,filterKeyword:this.props.filterKeyword,onAction:this.onTreeBrowserAction,focus:{index:this.props.hasFocus?this.state.focusIndex:-1,disable:false},allowDeselect:true,selectionMode:"SIMPLE",onSelect:this.onSelect,validators:{selectNode:this.canToggleNodeSelection}}))}});t.exports=d},{"../../constant":256,"./dimensiontreenode":376,lodash:70,react:"react",treebrowser:202}],376:[function(e,t,i){"use strict";var r=e("classnames");var n=e("lodash");var o=e("react");var a=e("treebrowser");var s=a.view.TreeBrowserNode;var l=o.createClass({displayName:"DimensionTreeNode",propTypes:{treeNode:o.PropTypes.object.isRequired,canAddField:o.PropTypes.func.isRequired,outlineClickHandler:o.PropTypes.func,rollupClickHandler:o.PropTypes.func,rotateIcon:o.PropTypes.bool},outlineClickHandler:function(e){this.props.outlineClickHandler&&this.props.outlineClickHandler(this.props.treeNode.nodeObj.id,!this.props.treeNode.nodeObj.hasOutline);e.stopPropagation()},rollupClickHandler:function(e){this.props.rollupClickHandler&&this.props.rollupClickHandler(this.props.treeNode.nodeObj.id,!this.props.treeNode.nodeObj.hasRollup);e.stopPropagation()},renderOutlineIcon:function(){return o.createElement("i",{className:r({"fa-rotate-90":this.props.rotateIcon,unselected:!this.props.treeNode.nodeObj.hasOutline},"fa fa-outdent fa-lg")})},renderRollupIcon:function(){return o.createElement("i",{className:r({unselected:!this.props.treeNode.nodeObj.hasRollup},"fa fa-level-up fa-lg")})},renderRollup:function(){return o.createElement("div",{className:"rollup-btn node-config-btn",onClick:this.rollupClickHandler},this.renderRollupIcon(),o.createElement("span",{className:"lb-help-text"},"Rollup"))},renderOutline:function(){return o.createElement("div",{className:"outline-btn node-config-btn",onClick:this.outlineClickHandler},this.renderOutlineIcon(),o.createElement("span",{className:"lb-help-text"},"Outline"))},render:function(){var e=this.props,t=e.treeNode.nodeObj,i={"lb-axis-configuration-dimension-leaf":!e.treeNode.hasOwnProperty("children")},a=null,l=null;if(t.isDisabled){e=n.merge({},this.props,{extraClasses:"excluded"})}if(t.isSelected){if(!n.isUndefined(t.hasOutline)){a=this.renderOutline()}if(!n.isUndefined(t.hasRollup)){l=this.renderRollup()}}return o.DOM.div({className:r(i)},o.createElement(s,e,a,l))}});t.exports=l},{classnames:6,lodash:70,react:"react",treebrowser:202}],377:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("classnames");var a=e("treebrowser");var s=a.view.TreeBrowser;var l=a.Constants.Actions;var u=e("./measuretreenode");var c=e("../../constant");var d=c.Keys;var p={MEASURE:"Measure",ATTRIBUTE:"Attribute"};var f=r.createClass({displayName:"LabelledRadio",propTypes:{selectedRadio:r.PropTypes.string,label:r.PropTypes.string,selectRadio:r.PropTypes.func.isRequired,disabled:r.PropTypes.bool},selectRadio:function(){if(!this.props.disabled){this.props.selectRadio(this.props.label)}},render:function(){return r.DOM.label({className:"lb-radio"},r.DOM.input({type:"radio",value:this.props.label,className:"labelled-radio",onChange:this.selectRadio,checked:this.props.selectedRadio===this.props.label,disabled:this.props.disabled}),r.DOM.span({className:o({"label-disabled":this.props.disabled}),onClick:this.selectRadio},this.props.label))}});var h=r.createClass({displayName:"MeasureTreeBrowser",propTypes:{tree:r.PropTypes.object.isRequired,onTreeBrowserAction:r.PropTypes.func.isRequired,onSelect:r.PropTypes.func.isRequired,canAddField:r.PropTypes.func.isRequired,canAddMeasure:r.PropTypes.func.isRequired,isSlice:r.PropTypes.bool,hasMeasures:r.PropTypes.bool,filterKeyword:r.PropTypes.string,hasFocus:r.PropTypes.bool.isRequired},getInitialState:function(){return{focusIndex:0,selectedRadio:this.props.isSlice||this.props.hasMeasures?p.MEASURE:p.ATTRIBUTE}},getSelectedMeasures:function(){return this.refs.measureBrowser.getSelection().filter(function(e){return!e.isAttribute&&!e.isDisabled})},getSelectedAttributes:function(){return this.refs.measureBrowser.getSelection().filter(function(e){return e.isAttribute&&!e.isDisabled})},canToggleNodeSelection:function(e){if(e.nodeObj.isDisabled){return false}if(e.nodeObj.isSelected){return this.state.selectedRadio===p.MEASURE&&!e.nodeObj.isAttribute||this.state.selectedRadio===p.ATTRIBUTE&&e.nodeObj.isAttribute}else{return this.state.selectedRadio===p.ATTRIBUTE?this.props.canAddField(e.nodeObj.id):this.props.canAddMeasure(e.nodeObj.id)}},canAddField:function(e){return this.state.selectedRadio===p.ATTRIBUTE?this.props.canAddField(e):this.props.canAddMeasure(e)},isMemberOfSelectedType:function(e){return this.state.selectedRadio===p.ATTRIBUTE?e.isAttribute:!e.isAttribute},hasVisibleNodes:function(){return this.refs.measureBrowser.getTreeState().getFilteredTreeLength()>0},onTreeBrowserAction:function(e,t,i){var r=this,n=[],o,a;switch(e){case l.SELECT:this.setState({focusIndex:t.index});break;case l.SELECT_RANGE:if(t.start>t.end){t.nodes.reverse()}o=t.nodes.length&&!t.nodes[t.nodes.length-1].nodeObj.isSelected;t.nodes.forEach(function(e){if(!e.children&&r.canToggleNodeSelection(e)){n.push({id:e.nodeObj.id,selected:o})}});this.$onSelectMultiple(n);this.setState({focusIndex:t.end});break;case l.NODE_KEY_UP:a=t.node;if(i.keyCode===d.ENTER&&!a.hasOwnProperty("children")&&!a.nodeObj.isDisabled){if(this.state.selectedRadio===p.ATTRIBUTE){a.attributeIds=[{id:a.nodeObj.id,selected:true}]}else{a.measureIds=[{id:a.nodeObj.id,selected:true}]}}this.setState({focusIndex:t.index});break}this.props.onTreeBrowserAction(e,t,i)},onSelect:function(e){this.$onSelectMultiple([{id:e.id,selected:!e.isSelected}])},$onSelectMultiple:function(e){this.props.onSelect(e,this.state.selectedRadio===p.ATTRIBUTE)},onSelectRadio:function(e){this.setState({selectedRadio:e})},renderRadioPanel:function(){return r.DOM.div({className:"lb-checkboxes-wrapper"},r.createElement(f,{selectRadio:this.onSelectRadio,ref:"axisRadio",selectedRadio:this.state.selectedRadio,label:p.ATTRIBUTE,disabled:!this.props.hasMeasures}),r.createElement(f,{selectRadio:this.onSelectRadio,ref:"visualMeasuresRadio",selectedRadio:this.state.selectedRadio,label:p.MEASURE,disabled:!this.props.hasMeasures}))},render:function(){var e=this;return r.DOM.div({className:o("lb-dimensions-browser-wrapper measure-browser",{measures:this.props.hasMeasures}),key:"measureBrowser"},r.DOM.div({className:"lb-af-tree-br-name"},r.DOM.span(null,"Measures")),r.createElement(s,{ref:"measureBrowser",nodeElement:function(t){var i=n.assign({},t,{canAddField:e.canAddField,isMemberOfSelectedType:e.isMemberOfSelectedType});return r.createElement(u,i)},tree:this.props.tree,filterKeyword:this.props.filterKeyword,onAction:this.onTreeBrowserAction,focus:{index:this.props.hasFocus?this.state.focusIndex:-1,disable:false},selectMode:this.state.selectedRadio,allowDeselect:true,selectionMode:"SIMPLE",onSelect:this.onSelect,validators:{selectNode:this.canToggleNodeSelection}}),!this.props.isSlice?this.renderRadioPanel():null)}});t.exports=h},{"../../constant":256,"./measuretreenode":378,classnames:6,lodash:70,react:"react",treebrowser:202}],378:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("treebrowser");var a=o.view.TreeBrowserNode;var s=r.createClass({displayName:"MeasureTreeNode",propTypes:{canAddField:r.PropTypes.func.isRequired,isMemberOfSelectedType:r.PropTypes.func.isRequired,treeNode:r.PropTypes.object.isRequired},render:function(){var e,t=this.props.treeNode.nodeObj.isUnavailable||this.props.treeNode.nodeObj.isSelected&&!this.props.isMemberOfSelectedType(this.props.treeNode.nodeObj);if(t||!this.props.treeNode.children&&!this.props.treeNode.nodeObj.isSelected&&!this.props.canAddField(this.props.treeNode.nodeObj.id)){e=n.assign({},this.props,{extraClasses:"excluded"});e.treeNode.nodeObj["isDisabled"]=true}else{e=n.assign({},this.props);e.treeNode.nodeObj["isDisabled"]=false}return r.DOM.div({className:"lb-axis-configuration-measure-leaf"},r.createElement(a,e))}});t.exports=s},{lodash:70,react:"react",treebrowser:202}],379:[function(e,t,i){var r=e("immutable");var n=e("lodash");var o=e("../multiaxisconfig");var a=e("./pivot/config_helper");var s=e("../pivotconfig_helper");var l=e("../cubiql");var u=i;u.getSlice=function(e,t,i){var a=e.getHeadingAxisInfo(t),s=e.getSlicePosition(),l=e.getSelectedSliceFieldPos(i),u=l&&a.findRowNumForFieldPos(l),c=!n.isUndefined(u)&&a.getHeadingRow(u);if(c){return Object.keys(s).reduce(function(e,t){var n=i.findIndex(function(e){return e.id===t}),a=c.fields.findIndex(function(e){return e.id===t}),l,u;if(n>=0&&i.get(n)instanceof o.MeasureGroupField){l=i.get(n).fields.find(function(e){return e.id===s[t]}).toJS();return e.set(t,r.Map({id:l.id,label:l.fieldLabel,field:i.get(n)}))}else if(a>=0){u=c.headers[a];return e.set(t,r.Map({id:u.id,label:u.label,field:c.fields[a]}))}},r.Map())}return r.Map()};u.getHeadingRow=function(e,t,i,r){var o=e.getHeadingAxisInfo(t),a=n.zipObject([i.id],[{id:r}]),s=o.findMatchingRowNums(a),l=o.getHeadingRow(s[0]);return l};u.adjustSlice=function(e,t,i,r){var n=e.getSelectedSliceFieldPos([i]),o=e.getHeadingAxisInfo(t),a=o.getHeadingForField(i.id),s=a.findMatchingRowNums(n),l=s[0]+r,c=a.getHeadingRow(l),d,p,f,h,g;if(c.headers.length>0){d=c.headers[0];f={};f[i.id]={id:d.id};h=o.findMatchingRowNums(f);g=o.getHeadingRow(h[0]);p=u.headingRowToSliceConfig(g);return p}};u.headingRowToSliceConfig=function(e,t){t=t||r.Map();return e.fields.reduce(function(t,i,n){var o=e.headers[n];return t.set(i.id,r.Map({id:o.id,label:o.label,field:i}))},t)};u.createMAConfig=function(e,t,i,n,a){var l=a&&a.filter(function(t,i){return!e.measureModel.hasMeasureInfo(i)}),u=t.updateIn(["axis",i],function(t){return t.filter(function(e){return e instanceof o.LevelField||e instanceof o.DimensionField}).map(function(e){return v(e,!l)}).map(c).map(p).map(d).map(function(t){return m(e,t,n,l)}).map(function(t){return g(e,t,n)})}),f=u.update("axis",function(e){return e.filter(function(e,t){return t===i})}),h=f.getIn(["axis",i]).reduce(function(e,t){var i=t instanceof o.LevelField?t.level.dimensionName:t.dimension;return e.set(i,r.List([t]))},r.Map()),y=t.set("axis",h).delete("headerConfig");y=y.delete("sliceConfigs");y=y.delete("measureGroups");y=o.regenerateHeaderConfig(y);y=s.updateConfig(e,y);return y};function c(e){if(e instanceof o.LevelField){return e.delete("rollupConfigs")}if(e instanceof o.DimensionField){return e.update("fields",function(e){return e.map(c)})}return e}function d(e){if(e instanceof o.LevelField){return e.set("displayMode",o.LevelDisplayMode.OUTLINE)}if(e instanceof o.DimensionField){return e.update("fields",function(e){return e.map(d)})}return e}function p(e){var t;if(e instanceof o.DimensionField){t=e.update("fields",function(e){return e.filterNot(a.isAllField)});if(t.fields.size===1){return t.fields.get(0)}else{return t}}return e}function f(e,t,i){var r;if(t.level&&i.level&&t.level.dimensionName===i.level.dimensionName){r=e.measureModel.findHierarchiesWithLevels(t.level.dimensionName,[t.level.levelName,i.level.levelName]).map(function(e){return e.name});return r.length>0}return false}function h(e,t){return new o.Filter({measure:new o.Measure({attribute:new o.Attribute({name:"id",level:e})}),comparisons:t.map(function(e){return new o.Comparison({operator:"=",comparator:new o.Comparator({literal:e})})})})}function g(e,t,i){if(t instanceof o.DimensionField){return t.update("fields",function(t){return t.map(function(t){return g(e,t,i)})})}var n=i.reduce(function(e,t){var i=t.get("field").level;return e.push(h(i,r.List([t.get("id")])))},r.List());return t.update("sortConfigs",function(e){return e.map(function(e){if(e.getIn(["measure","metric"])){var t=["measure","metric","filters"],i=e.getIn(t)||r.List();return e.setIn(t,i.concat(n))}return e})})}function m(e,t,i,n){if(t instanceof o.DimensionField){return t.update("fields",function(t){return t.map(function(t){return m(e,t,i,n)})})}var a=t.get("data"),l=n||r.Map(),u=t.get("filters"),c=l.reduce(function(i,r,n){if(n===t.id){return i}var o=s.createPositionFilterForField(e,t,n,r.toJS());return i.push(o)},r.List()),d=i.reduce(function(i,n){var a=n.get("field").level,s,l,u;if(n.get("field").id===t.id){return i}if(f(e,t,n.get("field"))){u=a.set("labelName",t.level.labelName);i=i.push(h(u,r.List([n.get("id")])))}s=t.filters.reduce(function(e,i){if(!i.measure.metric){return e}var r=o.getIntersectionForMeasure(i.measure);return e.concat(r.filter(function(e){return e.labelName!==t.level.labelName}).map(function(e){return e.labelName}))},r.List());l=s.some(function(e){return a.labelName===e});if(l){i=i.push(h(a,r.List([n.get("id")])))}return i},r.List()),p=a.get(0).set("filters",u.concat(c).concat(d)).set("name","AvailableLevels");return t.delete("filters").set("data",a.push(p))}function v(e,t){if(e instanceof o.DimensionField){return e.update("fields",function(e){return e.map(function(e){return v(e,t)})})}return e.update("filters",function(i){return i.filter(function(i){var n=i.getIn(["measure","attribute","level"]),o=!!i.getIn(["measure","metric"]);if(o){return true}if(t){if(n){return!r.is(e.level,n)}return true}return false})})}},{"../cubiql":276,"../multiaxisconfig":328,"../pivotconfig_helper":330,"./pivot/config_helper":455,immutable:"immutable",lodash:70}],380:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-dom");var a=e("immutable");var s=e("../multiaxisconfig");var l=e("./pivot/config_helper");var u=e("../helpers/fieldhelpers");var c=e("../constant");var d=c.ContextMenu.MenuItemInfo;var p=c.ContextMenu.IconInfo;var f=c.View;var h=c.SORT;var g=c.DND;var m=c.Layout;var v=e("../multiaxisconfig").FieldTypes;var y=e("./dimensiontreeprovider");var b=e("./measurebrowsercontroller");var w=e("../constant").AssociativeFiltering.SelectionTypes;var C=e("./associativefilter");var E=e("./editablefield");var S=e("./fieldpanel");var T=e("./popover");var x=e("popupmenu").MenuItem;var _=e("popupmenu").MenuItemsTypes;var M=e("../menu_sections/filter_sort");var A=e("./field").Field;var I=e("./fieldgroup");var O=e("./fielddropzone");var D=e("./draggable");var N=e("./fieldorderwrapper");var R=O(S,"AxisDropZone");var P=N(D(A,"DraggableAxisField"),"OrderedAxisField");var L=N(D(I,"DraggableAxisFieldGroup"),"OrderedAxisFieldGroup");var k=e("./axisconfig/axisconfiguration");var $=e("../util/viewlayoututils");var F="value-filter-window-";var V="measure-window-";var q={options:{size:"200px",openIn:m.POSITION.RIGHT}};var H=["DECIMAL","INT","FLOAT"];var U=n.createClass({displayName:"AxisPanel",propTypes:{sheetId:n.PropTypes.string.isRequired,pivotState:n.PropTypes.object.isRequired,modelerState:n.PropTypes.object.isRequired,updatePivotState:n.PropTypes.func.isRequired,canMoveInto:n.PropTypes.func.isRequired,axis:n.PropTypes.string.isRequired,title:n.PropTypes.string.isRequired,icon:n.PropTypes.string.isRequired,panelClass:n.PropTypes.string.isRequired,openSortWindow:n.PropTypes.func.isRequired,isVertical:n.PropTypes.bool,isActive:n.PropTypes.bool,isDraggingField:n.PropTypes.bool,dragData:n.PropTypes.object,dragOverData:n.PropTypes.object,dropData:n.PropTypes.object,dragOver:n.PropTypes.func,drop:n.PropTypes.func,startDrag:n.PropTypes.func,stopDrag:n.PropTypes.func},getInitialState:function(){return{fieldId:undefined,isConfigurationPopoverOpen:false,configurationPopoverX:undefined,configurationPopoverY:undefined,isFilterPopoverOpen:false,isFilterPopoverPinned:false,filterPopoverX:undefined,filterPopoverY:undefined,lockOrdering:undefined,undo:[],userSelectedFilters:a.Map(),trees:undefined,configPivotState:undefined}},componentWillReceiveProps:function(e){var t;if(this.state.isFilterPopoverOpen&&e.headingData){t=this.buildTrees(e.headingData);if(t){this.setState({trees:t})}}},getAllFields:function(){return this.props.pivotState.getIn(["axis",this.props.axis])},getOnlyLevelFields:function(){return l.getAxisFields(this.props.pivotState,function(e){return e instanceof s.LevelField},this.props.axis).toJS()},buildTrees:function(e){var t=this.state.userSelectedFilters.size>0?this.state.userSelectedFilters:l.getFilters(this.props.pivotState),i=false,n=this.state.trees,o=this.sortTree,a=this.state.lockOrdering,s;if(this.state.isFilterPopoverOpen&&e){s=e.getAxes().reduce(function(s,l){var u=e.getHeadingAxisInfo(l),c,d;if(u.getLength()===0){return s}d=u.getColumnSets()[0].columns.map(function(e){return e.field});c=d.map(function(e){var s=u.getHeadingForField(e.id),l=s.getLength(),c,d,p,f,h=[],g=[],m=[],v=t.has(e.id)&&t.get(e.id).size,y;for(var b=0;b<l;b++){c=s.getHeadingMembers(b)[0];p=!r.isUndefined(c.config.AvailableLevels);f=!!t.getIn([e.id,c.id]);if(!c.config.invalidHeadings){y={id:c.id,label:c.label,isSelected:false,type:w.EXCLUDED};if(f&&p){y.type=w.EXPLICITLY_INCLUDED;y.isSelected=true;g.push(y)}else if(p){y.type=v?w.CAN_BE_INCLUDED:w.IMPLICITLY_INCLUDED;h.push(y)}else{y.isSelected=f;m.push(y)}}}d=g.concat(h,m);if(c.config.loading){i=true}if(n&&a===e.id){var C=n.reduce(function(e,t,i){e[t.qName]=i;return e},{});d=o(d,n[C[e.id]].children)}return{qName:e.id,label:e.fieldLabel,field:e,children:d}});return s.concat(c)},[],this);if(!i){return s}}},sortTree:function(e,t){var i=t.reduce(function(e,t,i){e[t.id]=i;return e},{}),r=[];for(var n=0;n<e.length;n++){r[i[e[n].id]]=e[n]}return r},handleApply:function(e){var t=this.props.pivotState,i=e||this.state.userSelectedFilters;t=i.reduce(function(e,t,i){return l.setFilter(e,i,t)},t);this.props.updatePivotState(t);this.closeFilterPopover()},handleSelect:function(e,t,i){if(i&&t.isSelected){this.handleApply();return}var r=e.id,n=this.state.userSelectedFilters.size>0?this.state.userSelectedFilters:this.props.pivotState.filter,o=this.state.undo,s=n;o.push(n);if(t.type===w.EXCLUDED&&!s.has(r)){s=s.set(r,a.Map().set(t.id,true))}else{if(s.getIn([r,t.id])){s=s.deleteIn([r,t.id])}else{s=s.setIn([r,t.id],true)}}if(i){this.handleApply(s)}else{this.props.setViewTask(s);this.setState({lockOrdering:r,undo:o,userSelectedFilters:s})}},handleSelectAll:function(e,t){var i=this.state.userSelectedFilters.size>0?this.state.userSelectedFilters:this.props.pivotState.filter,r=this.state.undo,n=t.length&&!t[t.length-1].isSelected,o=i;r.push(i);t.forEach(function(t){if(!n){o=o.deleteIn([e,t.id])}else{o=o.setIn([e,t.id],true)}});this.props.setViewTask(o);this.setState({lockOrdering:e,undo:r,userSelectedFilters:o})},handleUndo:function(){var e=this.state.undo,t;if(!e.length){return}t=e[e.length-1];e=e.slice(0,-1);this.props.setViewTask(t);this.setState({undo:e,userSelectedFilters:t})},handlePushpin:function(){this.setState({isFilterPopoverPinned:!this.state.isFilterPopoverPinned})},handleSortClick:function(e){var t=this.props.pivotState,i=l.getFieldAttributeSort(e),r=i.sortType===h.ASCENDING?h.DESCENDING:h.ASCENDING,n=l.setSort(t,e.id,r,i.sortAttr);this.props.updatePivotState(n)},shouldInsertBefore:function(e){var t=this.props.dragData,i=t&&t.field,r=this.props.dragOverData,n=r&&r.field,o=this.getAllFields(),u=this.props.axis,c=this.props.pivotState,d=this.props.modelerState,p=n?l.indexInFields(o,n):-1;if(!this.props.isDraggingField){return false}if(!a.is(n,e)){return false}if(a.is(n,i)){return false}if(i instanceof s.MeasureField){return p===0||n instanceof s.MeasureField||o.get(p-1)instanceof s.MeasureField}if(l.indexInFields(o,i)>-1&&l.indexInFields(o,i)===p-1){return false}if(i&&n){return!l.axisContainsOtherFieldsWithDimension(d,c,u,i)&&this.props.canMoveInto(c,u,i,t.isMove)}return true},createMenu:function(e,t){var i,o,a=n.createElement(x,{key:d.Remove.key,label:d.Remove.label,itemType:_.MenuItem,data:e,onClick:this.handleRemoveClick,iconName:p.Remove}),u=[a].concat(n.createElement(M,{modelerApp:this.props.modelerApp,key:d.FilterSection.key,field:e,isFilterable:e instanceof s.MeasureField?this.isMeasureFilterable(e.id):undefined,pivotState:this.props.pivotState,lastInGroup:t,isFromCell:false,isSlice:false,openFilter:this.handleFilterClick,clearFilter:this.handleClearFilterClick,sort:this.props.openSortWindow}));if(e instanceof s.MeasureField){u.push(n.createElement(x,{key:d.MeasureProperties.key,label:d.MeasureProperties.label,itemType:_.MenuItem,data:e.id,onClick:this.handlePropertiesClick}))}else{if(!r.isUndefined(t)&&!t){i=e.displayMode===s.LevelDisplayMode.OUTLINE?n.createElement(x,{key:d.HideOutline.key,label:d.HideOutline.label,itemType:_.MenuItem,onClick:this.handleHideOutline.bind(this,e)}):n.createElement(x,{key:d.DisplayOutline.key,label:d.DisplayOutline.label,itemType:_.MenuItem,onClick:this.handleDisplayOutline.bind(this,e)});u.push(i);if(!l.isAllField(e)){o=e.rollupConfigs.size?n.createElement(x,{key:d.HideRollup.key,label:d.HideRollup.label,itemType:_.MenuItem,onClick:this.handleHideRollup.bind(this,e)}):n.createElement(x,{key:d.DisplayRollup.key,label:d.DisplayRollup.label,itemType:_.MenuItem,onClick:this.handleDisplayRollup.bind(this,e)});u.push(o)}}}return u},handleRemoveClick:function(e){var t=l.removeField(this.props.modelerState,this.props.pivotState,e);this.props.updatePivotState(t)},handleHideOutline:function(e){var t=this.props.pivotState,i=l.disableOutlineForField(t,e,this.props.axis);this.props.updatePivotState(i)},handleDisplayOutline:function(e){var t=this.props.pivotState,i=l.enableOutlineForField(t,e,this.props.axis);this.props.updatePivotState(i)},handleHideRollup:function(e){var t=this.props.pivotState,i=l.removeRollupForField(t,e,this.props.axis);this.props.updatePivotState(i)},handleDisplayRollup:function(e){var t=this.props.pivotState,i=l.setRollupForField(t,e,"DEFAULT",this.props.axis);this.props.updatePivotState(i)},handleFilterClick:function(e){var t=this.createRefForField(e),i=o.findDOMNode(this.refs[t]);this.openFilter(i,e)},handleClearFilterClick:function(e){var t=this.props.pivotState;if(e instanceof s.MeasureField){this.clearMeasureFilter(e.id)}else{t=l.setFilter(t,e.id,null);this.props.updatePivotState(t)}},handleDrop:function(){var e,t,i;if(this.props.isActive){e=this.props.dragData.field;t=this.props.dragOverData&&this.props.dragOverData.field;if(a.is(e,t)){t=undefined}i=l.moveField(this.props.modelerState,this.props.pivotState,e,this.props.axis,t);this.props.updatePivotState(i);this.props.drop(g.TYPES.FIELD,{sourcePivotId:this.props.sheetId,axis:this.props.axis});if(this.props.dragData.axis!==this.props.axis){this.props.stopDrag()}}},handleFieldDragStart:function(e){this.props.startDrag(g.TYPES.FIELD,{sourcePivotId:this.props.sheetId,axis:this.props.axis,field:e,isMove:true})},handleFieldDragEnd:function(e){var t=this.props.dropData&&this.props.dropData.axis===this.props.axis,i;if(this.props.dragData&&this.props.dragData.axis===this.props.axis&&!t&&(!this.props.dropData||!this.props.dropData.axis)){i=l.removeField(this.props.modelerState,this.props.pivotState,e);this.props.updatePivotState(i)}this.props.stopDrag()},handleFieldDragLeave:function(){this.props.dragOver(null,null)},handleFieldDragOver:function(e){this.props.dragOver(g.TYPES.FIELD,{sourcePivotId:this.props.sheetId,field:e})},openFilter:function(e,t){var i=l.findField(this.props.pivotState,t);if(i instanceof s.MeasureField){this.openMeasureFilter(t)}else{var r=e.getBoundingClientRect();this.props.setViewTask(this.props.pivotState.filter);this.setState({isFilterPopoverOpen:true,filterPopoverX:r.left+r.width/2,filterPopoverY:r.top+r.height/2,fieldId:t})}},openMeasureFilter:function(e){var t=F+e,i;if($.isViewOpenedInLayout(this.props.sheetConfig,t)){this.props.closeComponentFn(t)}else{i={module:f.Modules.MeasureFilterWindow,config:{id:t,measureName:e,pivotId:this.props.sheetId}};this.props.openComponentFn(t,q,i)}},clearMeasureFilter:function(e){var t=l.setMeasureFilter(this.props.pivotState,e);this.props.updatePivotState(t)},handlePropertiesClick:function(e){var t=V+e,i=a.fromJS({module:f.Modules.MeasureWindow,config:{id:t,measureName:e}});this.props.openComponentFn(t,q,i)},getPopoverTarget:function(){return o.findDOMNode(this)},closeFilterPopover:function(e){if(!r.isUndefined(e)){e=r.isBoolean(e)?e:false}if(this.state.isFilterPopoverPinned&&!e){return}this.setState({undo:[],userSelectedFilters:a.Map(),filterPopoverX:undefined,filterPopoverY:undefined,isFilterPopoverOpen:false,trees:undefined})},createFilterPopover:function(){var e=this.state.trees||[],t=e.length,i=190,r=10;return n.createElement(T,{openPoint:{x:this.state.filterPopoverX,y:this.state.filterPopoverY},getTarget:this.getPopoverTarget,onClose:this.closeFilterPopover,height:function(e,t){if(e==="left"||e==="right"){return Math.min(t.height,.5*window.innerHeight)}else{return.5*window.innerHeight}},width:function(e,n){if(e==="top"||e==="bottom"){return Math.min(t*i+r,n.width)}else{return Math.min(t*i+r,.8*window.innerWidth)}}},n.createElement(C,{onCancel:this.closeFilterPopover,levels:e,onSelect:this.handleSelect,onApply:this.handleApply,onDiscard:this.closeFilterPopover.bind(this,true),onPushpin:this.handlePushpin,onUndo:this.handleUndo,onSelectAll:this.handleSelectAll,focusField:this.state.fieldId,isPinned:this.state.isFilterPopoverPinned}))},openConfiguration:function(e){var t=e.target.getBoundingClientRect();this.setState({isConfigurationPopoverOpen:true,configurationPopoverX:t.left+t.width/2,configurationPopoverY:t.top+t.height/2})},closeConfigurationPopover:function(){this.setState({isConfigurationPopoverOpen:false,configPivotState:undefined})},getAxisConfigPivotState:function(){return this.state.configPivotState||this.props.pivotState},$updatePivotStateWithMeasureSelections:function(e,t,i){var r=this;t.forEach(function(t){var n=u.getFieldFromQualifiedName(r.props.modelerState.fields,t.id);if(!t.selected){e=l.removeField(r.props.modelerState,e,n)}else if(i){e=l.moveField(r.props.modelerState,e,n,r.props.axis)}else{e=l.addMeasureToGroup(e,e.measureGroups.get("-:Measures"),n)}});return e},measureSelectionChanged:function(e,t){this.setState({configPivotState:this.$updatePivotStateWithMeasureSelections(this.getAxisConfigPivotState(),e,t)})},$updatePivotStateWithDimensionSelections:function(e,t){var i=this;t.forEach(function(t){var r=u.getFieldFromQualifiedName(i.props.modelerState.fields,t.id),n=i.props.modelerApp.getMeasureModelStore().getModel(),o;if(!t.selected){e=l.removeField(i.props.modelerState,e,r)}else if(i.props.canMoveInto(e,i.props.axis,r,false)){if(t.id!=="-:Measures"){o=n.getLowestLevelsInDimension(r.level.get("dimensionName"));if(o.indexOf(t.id)===-1){if(t.inline){r=s.disableOutlineForField(r)}if(t.rollup){r=s.setRollupForField(r,"DEFAULT")}}}e=l.moveField(i.props.modelerState,e,r,i.props.axis)}});return e},dimensionSelectionChanged:function(e){this.setState({configPivotState:this.$updatePivotStateWithDimensionSelections(this.getAxisConfigPivotState(),e)})},applyAxisConfigChanges:function(e){var t=this.getAxisConfigPivotState();if(e){if(e.levelIds){t=this.$updatePivotStateWithDimensionSelections(t,e.levelIds,true,true)}if(e.measureIds){t=this.$updatePivotStateWithMeasureSelections(t,e.measureIds,false)}if(e.attributeIds){t=this.$updatePivotStateWithMeasureSelections(t,e.attributeIds,true)}}this.props.updatePivotState(t);this.closeConfigurationPopover()},cancelAxisConfigChanges:function(){this.closeConfigurationPopover()},canAddFieldToPanel:function(e){var t=u.getFieldFromQualifiedName(this.props.modelerState.fields,e),i=this.getAxisConfigPivotState();return this.props.canMoveInto(i,this.props.axis,t,false)},canAddMeasureToPanel:function(e){var t=this.getAxisConfigPivotState();return this.hasMeasuresFieldOnAxis()&&!l.hasVisibleMeasure(t,e)},outlineClickHandler:function(e,t){var i=this.props.modelerState,r=this.getAxisConfigPivotState(),n=u.getFieldFromQualifiedName(i.fields,e),o=this.props.axis;if(t){r=l.enableOutlineForField(r,n,o)}else{r=l.disableOutlineForField(r,n,o)}this.setState({configPivotState:r})},rollupClickHandler:function(e,t){var i=this.props.modelerState,r=this.getAxisConfigPivotState(),n=u.getFieldFromQualifiedName(i.fields,e),o=this.props.axis;if(t){r=l.setRollupForField(r,n,"DEFAULT",o)}else{r=l.removeRollupForField(r,n,o)}this.setState({configPivotState:r})},getMeasureTree:function(){var e=this.getAxisConfigPivotState(),t=this.props.modelerApp.getFieldStore().getFields(v.MEASURE),i=e.measureGroups.get("-:Measures"),r={},n={},o={},a;if(i){i.fields.map(function(e){r[e.id]=true})}l.getAxisFields(e,function(e){return e instanceof s.MeasureField&&!r[e.get("id")]},this.props.axis).map(function(e){n[e.id]=true});l.getAxisFields(e,function(e){return e instanceof s.MeasureField&&!r[e.get("id")]},this.props.axis==="X"?"Y":"X").map(function(e){o[e.id]=true});a=b.getMeasures(t).map(function(e){return{id:e.id,label:e.label,isMeasure:true,isAttribute:n[e.id],isSelected:r[e.id]||n[e.id],isUnavailable:o[e.id]}});return{children:a}},hasMeasuresFieldOnAxis:function(){return!!l.getField(this.props.pivotState,"-:Measures",this.props.axis)},$getUpdateTreeNodeCallback:function(){var e=this,t=this.getAxisConfigPivotState().getIn(["axis",this.props.axis]),i={},r=l.getLowestLevelFieldsOnAxis(this.getAxisConfigPivotState(),this.props.axis);r.forEach(function(e){i[e.id]=true});return function(n,o){var a=l.indexInFields(t,o)>-1,u,c=n.get("id"),d=!a&&!e.canAddFieldToPanel(c);n=n.set("isSelected",a).set("isDisabled",d);if(a&&c!=="-:Measures"&&r.size>0&&!i[c]){u=l.getField(e.getAxisConfigPivotState(),c,e.props.axis);n=n.set("hasOutline",u.displayMode===s.LevelDisplayMode.OUTLINE);if(!l.isAllField(u)){n=n.set("hasRollup",!!(u.rollupConfigs&&u.rollupConfigs.size))}}return n}},createConfigurationPopover:function(){var e=y.createDimensionTreeData(this.props.modelerState,this.$getUpdateTreeNodeCallback()),t=this.getMeasureTree(),i=190,r=10;return n.createElement(T,{openPoint:{x:this.state.configurationPopoverX,y:this.state.configurationPopoverY},getTarget:this.getPopoverTarget,onClose:this.closeConfigurationPopover,height:.5*window.innerHeight,width:function(e,t){if(e==="top"||e==="bottom"){return Math.min(2*i+r,t.width)}else{return Math.min(2*i+r,.8*window.innerWidth)}}},n.createElement(k,{dimensionTree:e,measureTree:t,onCancel:this.cancelAxisConfigChanges,onApply:this.applyAxisConfigChanges,measureSelectionChanged:this.measureSelectionChanged,dimensionSelectionChanged:this.dimensionSelectionChanged,canAddField:this.canAddFieldToPanel,canAddMeasure:this.canAddMeasureToPanel,pivotState:this.props.pivotState,hasMeasures:this.hasMeasuresFieldOnAxis(),isSlice:false,
outlineClickHandler:this.outlineClickHandler,rollupClickHandler:this.rollupClickHandler,rotateIcon:this.props.axis==="X"}))},createRefForField:function(e){return"field-"+e},isMeasureFilterable:function(e){var t=this.props.modelerApp.getMeasureModelStore().getModel().getMeasureInfo(e),i=l.findAxisForField(this.props.pivotState,l.getVisibleMeasures(this.props.pivotState).id);return!!((!i||this.props.axis===i)&&H.indexOf(t.type.kind)!==-1)},createField:function(e,t,i){var o=e.id,a=l.getFieldAttributeSort(e),u=!!a,c=u&&a.sortType===h.ASCENDING,d=e instanceof s.MeasureGroupField,p=e instanceof s.MeasureField,f=!p&&this.handleSortClick.bind(this,e)||undefined;return n.createElement(P,{ref:this.createRefForField(e.id),key:o,type:e.type,label:e.fieldLabel,title:o,isSorted:u,ascending:c,onSortClick:!l.isAllField(e)&&!d?f:undefined,onFilterClick:this.openFilter,isFiltered:l.hasFilter(this.props.pivotState,o),isFilterable:!(d||p&&!this.isMeasureFilterable(e.id)||l.isAllField(e)),onDragStart:this.handleFieldDragStart.bind(this,e),onDragStop:this.handleFieldDragEnd.bind(this,e),insertBefore:!t?this.shouldInsertBefore(e):false,onDragOver:!t?this.handleFieldDragOver.bind(this,e):r.identity,onDragLeave:!t?this.handleFieldDragLeave:r.identity},this.createMenu(e,i))},createFieldGroup:function(e){return n.createElement(L,{key:e.id,title:e.fieldLabel,onDragStart:this.handleFieldDragStart.bind(this,e),onDragStop:this.handleFieldDragEnd.bind(this,e),insertBefore:this.shouldInsertBefore(e),onDragOver:this.handleFieldDragOver.bind(this,e),onDragLeave:this.handleFieldDragLeave},e.fields.map(function(t,i){var r=i===e.fields.size-1;return this.createField(t,true,r)},this))},render:function(){var e=null,t=null,i=this.getAllFields().map(function(e){if(e instanceof s.DimensionField){return this.createFieldGroup(e)}else{return this.createField(e)}},this).toJS();if(this.state.isFilterPopoverOpen&&this.state.trees){e=this.createFilterPopover()}if(this.state.isConfigurationPopoverOpen){t=this.createConfigurationPopover()}return n.createElement(R,{ref:"fieldpanel",panelClass:this.props.panelClass,isVertical:this.props.isVertical,axis:this.props.axis,pivotId:this.props.sheetId,title:this.props.title,icon:this.props.icon,iconCls:this.props.iconCls,onPanelTitleClick:this.openConfiguration,onDrop:this.handleDrop,isDroppable:this.props.isActive,isDraggingField:this.props.isDraggingField},i,this.props.children,e,t)}});t.exports=U},{"../constant":256,"../helpers/fieldhelpers":296,"../menu_sections/filter_sort":307,"../multiaxisconfig":328,"../util/viewlayoututils":367,"./associativefilter":371,"./axisconfig/axisconfiguration":374,"./dimensiontreeprovider":398,"./draggable":400,"./editablefield":402,"./field":405,"./fielddropzone":406,"./fieldgroup":407,"./fieldorderwrapper":408,"./fieldpanel":409,"./measurebrowsercontroller":430,"./pivot/config_helper":455,"./popover":480,immutable:"immutable",lodash:70,popupmenu:146,react:"react","react-dom":"react-dom"}],381:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("immutable");var a=e("../multiaxisconfig");var s=e("../constant").DND;var l=e("../util/eventlistenermixin");var u=e("../store/multiaxisdatastore").MultiAxisDataEvents;var c=e("../constant").ModalWindows.Types;var d=e("./draganddropwrapper");var p=e("./axisfilters");var f=e("./axispanel");var h=n.createClass({displayName:"AxisPanelController",propTypes:{modelerApp:n.PropTypes.object.isRequired,sheetId:n.PropTypes.string.isRequired,modelerState:n.PropTypes.object.isRequired,pivotState:n.PropTypes.object.isRequired,headingData:n.PropTypes.object.isRequired,updatePivotState:n.PropTypes.func.isRequired,canMoveInto:n.PropTypes.func.isRequired,axis:n.PropTypes.string.isRequired,title:n.PropTypes.string.isRequired,icon:n.PropTypes.string.isRequired,panelClass:n.PropTypes.string,isVertical:n.PropTypes.bool},mixins:[l],setEventListeners:function(){var e=this.props.modelerApp,t=e.getMultiAxisDataStore();return[{emitter:t,event:u.DATA_CHANGED,callback:this.onDataChange}]},onDataChange:function(){this.updateHeadingData()},isDraggingField:function(){return this.props.dragType===s.TYPES.FIELD},isActive:function(){var e=this.props.dragData;if(this.isDraggingField()){return this.props.canMoveInto(this.props.pivotState,this.props.axis,e.field,e.isMove)}},updateHeadingData:function(){var e=this.props.modelerApp.getMultiAxisDataStore().getHeadingData(this.props.sheetId,"filterPanel");if(e){this.setState({headingData:e})}},setViewTask:function(e){var t=this.props.modelerApp.getMultiAxisConfigStore().getViewTaskConfig(this.props.sheetId,"main").maConfig,i=p.createMAConfig(this.props.modelerState,t,this.props.axis,this.getSlice(),e);this.props.modelerApp.getModelerActionHandler().setViewTaskConfig(this.props.sheetId,"filterPanel",{maConfig:i,isUnmasked:true}).then(this.updateHeadingData)},getSlice:function(){var e=this.props.pivotState.getIn(["axis","Z"]).reduce(function(e,t){if(t instanceof a.MeasureGroupField||t instanceof a.LevelField)return e.push(t);if(t instanceof a.DimensionField)return e.concat(t.fields);return e},o.List());return p.getSlice(this.props.headingData,"Z",e)},setViewTaskInactive:function(){this.props.modelerApp.getMultiAxisConfigActionHandler().setViewTaskInactive(this.props.sheetId,"filterPanel")},openSortWindow:function(e){var t={sheetId:this.props.sheetId,qualifiedName:e,axisName:this.props.axis,updatePivotState:this.props.updatePivotState};this.props.modelerApp.getModalWindowsActionHandler().openWindow(c.SORT_DIALOG,t)},render:function(){var e=r.defaults({openSortWindow:this.openSortWindow,isDraggingField:this.isDraggingField(),isActive:this.isActive(),setViewTask:this.setViewTask,setViewTaskInactive:this.setViewTaskInactive},this.state,this.props);return n.createElement(f,e)}});t.exports=d(h)},{"../constant":256,"../multiaxisconfig":328,"../store/multiaxisdatastore":348,"../util/eventlistenermixin":360,"./axisfilters":379,"./axispanel":380,"./draganddropwrapper":399,immutable:"immutable",lodash:70,react:"react"}],382:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("./axispanelcontroller");var a=e("./slicepanelcontroller");var s=e("./visiblemeasures");var l=n.createClass({displayName:"RowsController",propTypes:{modelerApp:n.PropTypes.object.isRequired,sheetId:n.PropTypes.string.isRequired},render:function(){return n.createElement(o,r.defaults({axis:"Y",title:"Rows",panelClass:"rows-panel",icon:"plus",isVertical:false},this.props))}});var u=n.createClass({displayName:"SliceController",propTypes:{modelerApp:n.PropTypes.object.isRequired,sheetId:n.PropTypes.string.isRequired},render:function(){return n.createElement(a,r.defaults({icon:"plus"},this.props))}});var c=n.createClass({displayName:"ColumnsController",propTypes:{modelerApp:n.PropTypes.object.isRequired,sheetId:n.PropTypes.string.isRequired},render:function(){return n.createElement(o,r.defaults({ref:"fieldpanel",panelClass:"columns-panel",axis:"X",isVertical:true,title:"Columns",icon:"plus"},this.props))}});var d=n.createClass({displayName:"VisibleMeasuresController",propTypes:{modelerApp:n.PropTypes.object.isRequired,sheetId:n.PropTypes.string.isRequired},render:function(){return n.createElement(s,r.defaults({ref:"fieldpanel"},this.props))}});i.RowsController=l;i.ColumnsController=c;i.VisibleMeasuresController=d;i.SlicesController=u},{"./axispanelcontroller":381,"./slicepanelcontroller":499,"./visiblemeasures":518,lodash:70,react:"react"}],383:[function(e,t,i){"use strict";var r=e("react");var n=r.DOM;var o=r.PropTypes;var a=e("classnames");var s=e("react-addons-pure-render-mixin");var l=r.createClass({displayName:"Button",propTypes:{isActive:o.bool,label:o.string.isRequired,onClick:o.func.isRequired,title:o.string},mixins:[s],render:function(){var e=a("btn",{active:this.props.isActive});return n.button({className:e,onClick:this.props.onClick,title:this.props.title},this.props.label)}});t.exports=l},{classnames:6,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],384:[function(e,t,i){"use strict";var r=e("classnames");var n=e("react");var o=n.DOM;var a=n.createClass({displayName:"ButtonGroup",render:function(){return o.div({className:r(this.props.className,"btn-group"),role:"group"},this.props.children)}});t.exports=a},{classnames:6,react:"react"}],385:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("./panelbutton").PanelButton;var a=e("../constant").ButtonTypes;var s=e("../constant").ButtonPanelTypes;var l=n.createClass({displayName:"ButtonsPanel",propTypes:{type:n.PropTypes.string.isRequired,onClick:n.PropTypes.func.isRequired,isSpinning:n.PropTypes.bool,spinningButtonType:n.PropTypes.string,disabledButtonsTypes:n.PropTypes.array},getDefaultProps:function(){return{type:s.OK}},getDefaultState:function(e){var t=null;var i=null;switch(e.type){case s.OK_CANCEL:t=[a.OK,a.CANCEL];break;case s.YES_NO_CANCEL:t=[a.YES,a.NO,a.CANCEL];break;case s.CONTINUE_CANCEL:t=[a.CONTINUE,a.CANCEL];break;case s.CALCULATE_CONTINUE_CANCEL:t=[a.CALCULATE,a.CONTINUE,a.CANCEL];break;case s.CONFIRM_CONTINUE_CANCEL:t=[a.CONFIRM,a.CONTINUE,a.CANCEL];break;case s.CONFIRM_DISCARD_CANCEL:t=[a.CONFIRM,a.DISCARD,a.CANCEL];break;case s.OK:default:t=[a.OK];break}if(t&&t.length>0){var r=this;i=t.map(function(t,i){var a=t===e.spinningButtonType&&e.isSpinning;var s=e.disabledButtonsTypes&&e.disabledButtonsTypes.indexOf(t)!==-1;return n.createElement(o,{type:t,isDisabled:s,isSpinning:a,onClick:function(e){r.handleClick(e,t)},key:"panel-button-"+i})})}return{buttons:i}},getInitialState:function(){return this.getDefaultState(this.props)},componentWillReceiveProps:function(e){var t=this.getDefaultState(e);this.setState(t)},handleClick:function(e,t){if(typeof this.props.onClick==="function"){this.props.onClick(e,t)}},render:function(){return n.DOM.div({className:"buttons-panel"},this.state.buttons)}});i.ButtonsPanel=l},{"../constant":256,"./panelbutton":454,lodash:70,react:"react"}],386:[function(e,t,i){"use strict";var r=e("classnames");var n=e("react");t.exports=n.createClass({displayName:"Circle Button",propTypes:{onClick:n.PropTypes.func.isRequired,buttonClassName:n.PropTypes.string,iconClassName:n.PropTypes.string.isRequired,titleAttr:n.PropTypes.string},render:function(){return n.DOM.a({className:r(this.props.buttonClassName,"circle-button"),onClick:this.props.onClick,title:this.props.titleAttr},n.DOM.i({className:this.props.iconClassName}))}})},{classnames:6,react:"react"}],387:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=r.DOM;var a=e("classnames");var s=e("react-color").CompactPicker;var l=e("./popover");var u=r.createClass({displayName:"ColorPicker",mixins:[n],propTypes:{onColorChange:r.PropTypes.func.isRequired,onColorReset:r.PropTypes.func.isRequired,pickerIcon:r.PropTypes.string.isRequired,color:r.PropTypes.string},getInitialState:function(){return{displayColorPicker:false}},handleClick:function(e){this.setState({displayColorPicker:!this.state.displayColorPicker})},handlePopupClose:function(){this.setState({displayColorPicker:false})},handlePopupReset:function(e){this.handlePopupClose();this.props.onColorReset()},handlePopupSelect:function(e){this.handlePopupClose();this.props.onColorChange(e.hex)},getPopoverTarget:function(){return this.refs.colorButton},render:function(){var e=null,t,i,n={onClose:this.handlePopupClose,getTarget:this.getPopoverTarget,direction:"left",openPoint:{x:0,y:0}};if(this.state.displayColorPicker){t=r.createElement(s,{id:this.props.pickerIcon,color:this.props.color,onChange:this.handlePopupSelect});i=o.div({className:a("reset-color",{hidden:false})},o.a({onClick:this.handlePopupReset},o.i({className:"fa fa-refresh"}),"Reset color"));e=r.createElement(l,n,t,i)}return o.div(null,o.div({ref:"colorButton",className:"color-button",onClick:this.handleClick},o.div({className:a(this.props.pickerIcon,"color-icon pull-left")}),o.i({className:"fa fa-sort-desc pull-right"})),e)}});t.exports=u},{"./popover":480,classnames:6,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-color":"react-color"}],388:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("immutable");var a=n.DOM;var s=e("../util/eventlistenermixin");var l=e("./conditionalformattingviewer");var u=e("./pane").Pane;var c=e("../constant/gridoptions");var d=r.valuesIn(c.CONDITIONALS);var p=e("../multiaxisconfig").FieldTypes;var f=e("../store/multiaxisdatastore").MultiAxisDataEvents;var h=e("./okcancelbuttons");var g=e("./pivot/config_helper");var m=e("../formatter");var v=e("../multiaxisconfig").findDataConfigPathInMeasureField;var y=e("../multiaxisconfig").regenerateHeaderConfig;var b=e("../multiaxisconfig").MAConfig;var w="get measure options";var C=n.createClass({displayName:"ConditionalFormattingController",propTypes:{modelerApp:n.PropTypes.object.isRequired,pivotState:n.PropTypes.object.isRequired,modelerState:n.PropTypes.object.isRequired,updatePivotState:n.PropTypes.func.isRequired,sheetId:n.PropTypes.string.isRequired,closeComponentFn:n.PropTypes.func.isRequired},mixins:[s],setEventListeners:function(){return[{emitter:this.props.modelerApp.getMultiAxisDataStore(),event:f.DATA_CHANGED,callback:this.setMeasureOptions}]},componentWillReceiveProps:function(e){},onViewConfigChange:function(){this.setMAConfig()},setMAConfig:function(){var e=this.props.sheetId,t=this.getSelectedMeasure(),i=this.props.modelerApp,n=this.props.modelerState,a,s,l;if(!r.isUndefined(t)){a=n.measureModel.getMeasureInfo(t.get("id"));if(a.type.kind.toLowerCase()==="named"){s=n.fields.get(o.Map({id:a.type.named,type:p.LEVEL}));l=new b({axis:new o.Map({X:new o.List([s])})});l=y(l);i.getModelerActionHandler().setViewTaskConfig(e,w,{maConfig:l})}}},componentDidMount:function(){this.setMAConfig()},componentWillUnmount:function(){this.props.modelerApp.getMultiAxisConfigActionHandler().setViewTaskInactive(this.props.sheetId,w)},setMeasureOptions:function(){var e=this.getMeasureOptions();if(!r.isEmpty(e)){this.setState({measureOptions:e})}},getMeasureOptions:function(){var e=this.props.modelerApp,t=e.getMultiAxisDataStore(),i=t.getHeadingData(this.props.sheetId,w),n=!!i,o,a,s=[];if(n){o=i.getHeadingAxisInfo("X");a=o.getHeadingRange(0,o.getLength());if(!a[0].headers[0].config.loading){r.forEach(a,function(e){s.push({id:e.headers[0].id,label:e.headers[0].label})})}}return s},getInitialState:function(){var e=this.props.config.get("selectedMeasure");return{selectedMeasure:e&&this.getMeasures().find(function(t){return t.get("id")===e}),measureOptions:[]}},getValidConditionals:function(e){return r.filter(d,function(t){return!r.includes(t.unsupportedTypes,e.get("type"))})},getSelectedMeasure:function(){var e=this.getMeasures(),t=this.state.selectedMeasure;return t&&e.findIndex(function(e){return e.get("id")===t.get("id")})>=0?t:e.first()},getFormattingConfig:function(e){return this.props.pivotState.getIn(["conditionalFormatting",e.get("id")])},getMeasures:function(){var e=g.getVisibleMeasures(this.props.pivotState).fields,t=this.props.modelerApp.getMeasureModelStore().getModel();return e.map(function(e){return o.Map({id:e.id,label:e.fieldLabel,type:t.getMeasureInfo(e.id).type.kind,format:e.getIn(v(e,"value")).format})})},buildMeasuresOptions:function(){return this.getMeasures().map(function(e){return a.option({key:e.get("id"),value:e.get("id")},e.get("label"))})},onMeasureSelectionChange:function(e){var t=e.target,i=this.getMeasures().find(function(e){return e.get("id")===t.value});this.setState({selectedMeasure:i},this.setMAConfig)},getNumeralFormatter:function(){var e=this.props.modelerApp.getMeasureModelStore().getModel(),t=this.getSelectedMeasure(),i=t.get("format"),r=t.get("id"),n=e&&e.getMeasureInfo(r),o=n&&n.type&&n.type.kind;return i&&o&&m.getFormatter(i,r,o)},format:function(e){var t=this.getNumeralFormatter();if(t&&!r.isUndefined(e)&&e!==""){return t.format&&t.format(e)}return e},unformat:function(e){var t=this.getNumeralFormatter();if(t){return t.unformat&&t.unformat(e)}return parseFloat(e)},removeFormattingRule:function(e){var t=this.getSelectedMeasure(),i=g.removeConditionalFormattingRule(this.props.pivotState,t.get("id"),e);this.props.updatePivotState(i)},addFormattingRule:function(e){var t=this.getSelectedMeasure(),i=g.addConditionalFormattingRule(this.props.pivotState,t.get("id"),e.toJS());this.props.updatePivotState(i)},saveFormattingRule:function(e,t){var i=this.getSelectedMeasure(),r=g.updateConditionalFormattingRule(this.props.pivotState,i.get("id"),e.toJS(),t.toJS());this.props.updatePivotState(r)},handleClose:function(){this.props.closeComponentFn(this.props.id)},render:function(){var e=this.getSelectedMeasure(),t;if(e){t=this.getFormattingConfig(e)}return n.createElement(u,{className:"conditional-view-container",title:"Conditional Formatting",content:a.div(null,e?a.div(null,a.div({className:"conditional-measure-select row"},a.select({className:"input-sm form-control",value:e.get("id"),onChange:this.onMeasureSelectionChange},this.buildMeasuresOptions())),n.createElement(l,{selectedMeasure:e,conditionals:this.getValidConditionals(e),formattingConfig:t,measureOptions:this.state.measureOptions,formatFn:this.format,unformatFn:this.unformat,onRemoveFormattingRule:this.removeFormattingRule,onSaveFormattingRule:this.saveFormattingRule,onAddFormattingRule:this.addFormattingRule})):a.span({className:"no-measure-label"},"To see conditional formatting settings put some measure on the grid.")),footer:n.createElement(h,{ref:"btnGroup",onCancel:this.handleClose})})}});t.exports=C},{"../constant/gridoptions":255,"../formatter":293,"../multiaxisconfig":328,"../store/multiaxisdatastore":348,"../util/eventlistenermixin":360,"./conditionalformattingviewer":391,"./okcancelbuttons":448,"./pane":453,"./pivot/config_helper":455,immutable:"immutable",lodash:70,react:"react"}],389:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-dom");var a=e("immutable");var s=n.DOM;var l=e("../../logicblox.pivot/util");var u=e("classnames");var c=e("joi");var d=e("react-addons-pure-render-mixin");var p=e("../constant/gridoptions");var f=e("./styleeditingpanel");var h=n.createClass({displayName:"ConditionalFormattingEditor",propTypes:{ruleConfig:n.PropTypes.object.isRequired,selectedMeasureLabel:n.PropTypes.string,selectedMeasureType:n.PropTypes.string,formatFn:n.PropTypes.func.isRequired,unformatFn:n.PropTypes.func.isRequired,measureOptions:n.PropTypes.array,conditionals:n.PropTypes.array,onSaveFormattingRule:n.PropTypes.func.isRequired,onCancelEditingRule:n.PropTypes.func.isRequired,errors:n.PropTypes.object,validate:n.PropTypes.func.isRequired,isValid:n.PropTypes.func,handleValidation:n.PropTypes.func,getValidationMessages:n.PropTypes.func,clearValidations:n.PropTypes.func},getInitialState:function(){return{ruleConfig:this.props.ruleConfig}},typeIsNumeric:function(){var e=this.props.selectedMeasureType;return e!=="STRING"&&e!=="NAMED"&&e!=="BOOLEAN"},validatorTypes:function(){var e=this.refs.valueEditing.refs,t=e.rangeEditing&&this.props.unformatFn(o.findDOMNode(e.rangeEditing.refs.from.refs.fromValue).value),i=e.rangeEditing&&this.props.unformatFn(o.findDOMNode(e.rangeEditing.refs.to.refs.toValue).value),n=e.singleEditing&&e.singleEditing.refs.value,a;if(n){if(this.typeIsNumeric()){a=c.number().required().label("Value")}else{a=c.string().required().label("Value")}}else{a=c.any()}return c.object().keys({fromValue:!r.isUndefined(t)?c.number().required().max(i&&!isNaN(i)?Number(i):Number.MAX_SAFE_INTEGER).label("From"):c.any(),toValue:!r.isUndefined(i)?c.number().required().min(t&&!isNaN(t)?Number(t):Number.MIN_SAFE_INTEGER).label("To"):c.any(),value:a})},renderHelpText:function(e){return s.span({className:"validation-message help-block"},e)},getValidatorData:function(){var e=this.refs.valueEditing.refs,t=e.rangeEditing&&e.rangeEditing.refs.from.refs.fromValue,i=e.rangeEditing&&e.rangeEditing.refs.to.refs.toValue,r=e.singleEditing&&e.singleEditing.refs.value;return{fromValue:this.getValue(t),toValue:this.getValue(i),value:this.getValue(r)}},getValue:function(e){var t=e&&o.findDOMNode(e).value;if(t){if(!this.typeIsNumeric()||this.props.selectedMeasureType==="PERCENTAGE"&&t.indexOf("%")===-1){return t}return this.props.unformatFn(t)}return""},getValidationClass:function(e){return!this.props.isValid(e)?"invalid-field":""},conditionChanged:function(e){this.setState({ruleConfig:this.state.ruleConfig.set("condition",e.target.value)});this.props.clearValidations()},onSaveFormattingRule:function(){var e=this.state.ruleConfig,t=this.refs.valueEditing.refs,i=this,r=function(r){if(r){}else{if(e.get("condition")===p.CONDITIONALS.RANGE.name){e=e.set("value",a.List([i.getValue(t.rangeEditing.refs.from.refs.fromValue),i.getValue(t.rangeEditing.refs.to.refs.toValue)]))}else{switch(i.props.selectedMeasureType){case"BOOLEAN":e=e.set("value",i.getValue(t.singleEditing.refs.value)==="true");break;default:e=e.set("value",t.singleEditing?i.getValue(t.singleEditing.refs.value):"");break}}i.props.onSaveFormattingRule(e)}};this.props.validate(r)},onCancel:function(){this.props.onCancelEditingRule()},resetStyle:function(e){this.setState({ruleConfig:this.state.ruleConfig.removeIn(["style",e])})},updateStyle:function(e,t){this.setState({ruleConfig:this.state.ruleConfig.setIn(["style",e],t)})},render:function(){var e=this.state.ruleConfig,t=this;return s.li({className:"preview-container row"},s.form({className:"editing-container col-xs-12",role:"form"},n.createElement(g,{condition:e.get("condition"),intersections:e.get("intersections"),conditionChanged:this.conditionChanged,selectedMeasureLabel:this.props.selectedMeasureLabel,conditionals:this.props.conditionals}),n.createElement(m,{ref:"valueEditing",formatFn:this.typeIsNumeric()?this.props.formatFn:null,unformatFn:this.typeIsNumeric()?this.props.unformatFn:null,condition:e.get("condition"),intersections:e.get("intersections"),value:e.get("value"),getValidationClass:this.getValidationClass,handleValidation:this.props.handleValidation,getValidationMessages:this.props.getValidationMessages,selectedMeasureType:this.props.selectedMeasureType,measureOptions:this.props.measureOptions}),n.createElement(f,r.extend({ref:"editingPanel",onStyleChange:this.updateStyle,onStyleReset:this.resetStyle},e.get("style").toJS())),s.div({className:"form-group format-preview-container"},s.label({className:"control-label",htmlFor:"previewExample"},"Format preview"),s.div({className:"input-sm preview-example col-xs-8",id:"previewExample",style:l.convertCSSStyleToReact(e.get("style").toJS())},"123")),s.div({className:"control-buttons"},s.button({onClick:t.onSaveFormattingRule,type:"button",className:"btn-ok btn-primary btn panel-button pull-left col-xs-4"},"Save"),s.button({onClick:t.onCancel,type:"button",className:"btn-discard btn-default btn panel-button pull-right col-xs-4"},"Cancel"))))}});var g=n.createClass({displayName:"CondtionSelectPanel",propTypes:{condition:n.PropTypes.string.isRequired,intersections:n.PropTypes.array,selectedMeasureLabel:n.PropTypes.string,conditionals:n.PropTypes.array,conditionChanged:n.PropTypes.func.isRequired},mixins:[d],render:function(){var e=this,t=r.map(this.props.conditionals,function(e){return s.option({key:e.name,value:e.name,label:e.label},e.label)}),i=r.find(this.props.conditionals,function(t){return t.name===e.props.condition||t.label===e.props.condition});return s.div({className:"form-group"},s.label({className:"control-label",htmlFor:"conditionSelect"},l.buildLevelLabel(this.props.selectedMeasureLabel,this.props.intersections)),s.select({id:"conditionSelect",className:"form-control input-sm",value:i.name,onChange:this.props.conditionChanged},t))}});var m=n.createClass({displayName:"ValueEditingPanel",propTypes:{condition:n.PropTypes.string.isRequired,value:n.PropTypes.node,measureOptions:n.PropTypes.array,values:n.PropTypes.array,formatFn:n.PropTypes.func,unformatFn:n.PropTypes.func,getValidationClass:n.PropTypes.func.isRequired,handleValidation:n.PropTypes.func.isRequired,getValidationMessages:n.PropTypes.func.isRequired,selectedMeasureType:n.PropTypes.string.isRequired},renderHelpText:function(e){return s.span({className:"validation-message help-block"},e)},render:function(){var e=this.props;switch(e.selectedMeasureType){case"BOOLEAN":return n.createElement(v,{ref:"singleEditing",defaultValue:Boolean(e.value)});case"NAMED":return n.createElement(b,{ref:"singleEditing",defaultValue:a.List.isList(e.value)?null:e.value,condition:e.condition,values:e.measureOptions});default:switch(e.condition){case p.CONDITIONALS.RANGE.name:return n.createElement(y,{ref:"rangeEditing",formatFn:e.formatFn,unformatFn:e.unformatFn,getValidationClass:e.getValidationClass,getValidationMessages:e.getValidationMessages,value:e.value,handleValidation:e.handleValidation,renderHelpText:this.renderHelpText});case p.CONDITIONALS.EMPTY.name:case p.CONDITIONALS.NOT_EMPTY.name:return false;default:return n.createElement(w,{ref:"singleEditing",refName:"value",formatFn:e.formatFn,unformatFn:e.unformatFn,getValidationClass:e.getValidationClass,getValidationMessages:e.getValidationMessages,defaultValue:a.List.isList(e.value)?null:e.value,handleValidation:e.handleValidation,renderHelpText:this.renderHelpText,labelValue:"Value"})}}}});var v=n.createClass({displayName:"BoolEditing",propTypes:{defaultValue:n.PropTypes.bool},render:function(){return s.div({className:"form-group"},s.label({className:"control-label",htmlFor:"value"},"Value"),s.select({id:"value",ref:"value",className:"form-control input-sm",defaultValue:this.props.defaultValue},s.option({key:true,value:true,label:"true"},"true"),s.option({key:false,value:false,label:"false"},"false")))}});var y=n.createClass({displayName:"RangeEditing",propTypes:{getValidationClass:n.PropTypes.func.isRequired,getValidationMessages:n.PropTypes.func.isRequired,formatFn:n.PropTypes.func.isRequired,unformatFn:n.PropTypes.func.isRequired,value:n.PropTypes.node,handleValidation:n.PropTypes.func.isRequired,renderHelpText:n.PropTypes.func.isRequired},render:function(){return s.div({className:"form-group"},s.div({className:"form-group"},n.createElement(w,{ref:"from",refName:"fromValue",formatFn:this.props.formatFn,unformatFn:this.props.unformatFn,getValidationClass:this.props.getValidationClass,getValidationMessages:this.props.getValidationMessages,defaultValue:a.List.isList(this.props.value)?this.props.value.get(0):null,handleValidation:this.props.handleValidation,renderHelpText:this.props.renderHelpText,labelValue:"From"})),s.div({className:"form-group"},n.createElement(w,{ref:"to",refName:"toValue",formatFn:this.props.formatFn,unformatFn:this.props.unformatFn,getValidationClass:this.props.getValidationClass,getValidationMessages:this.props.getValidationMessages,defaultValue:a.List.isList(this.props.value)?this.props.value.get(1):null,handleValidation:this.props.handleValidation,renderHelpText:this.props.renderHelpText,labelValue:"To"})))}});var b=n.createClass({displayName:"EntityEditing",propTypes:{defaultValue:n.PropTypes.node,condition:n.PropTypes.string,values:n.PropTypes.array},render:function(){if(this.props.condition!==p.CONDITIONALS.EMPTY.name&&this.props.condition!==p.CONDITIONALS.NOT_EMPTY.name){return s.div({className:"form-group"},s.label({className:"control-label",htmlFor:"entityValue"},"Value"),s.select({id:"entityValue",ref:"value",className:"form-control entities-select input-sm",defaultValue:this.props.defaultValue},r.map(this.props.values,function(e){return s.option({key:e.id,value:e.id},e.label)})))}return false}});var w=n.createClass({displayName:"SingleValueEditing",propTypes:{formatFn:n.PropTypes.func,unformatFn:n.PropTypes.func,getValidationClass:n.PropTypes.func.isRequired,getValidationMessages:n.PropTypes.func.isRequired,defaultValue:n.PropTypes.node,handleValidation:n.PropTypes.func.isRequired,renderHelpText:n.PropTypes.func.isRequired,refName:n.PropTypes.string.isRequired,labelValue:n.PropTypes.string.isRequired},unformatValue:function(e){if(!r.isEmpty(e)&&this.props.unformatFn){return this.props.unformatFn(e)}return r.isUndefined(e)?"":e},formatValue:function(e){if(!r.isEmpty(e)&&this.props.formatFn){return this.props.formatFn(e)}return r.isUndefined(e)?"":e},handleBlur:function(e){var t=e.target.value;o.findDOMNode(this.refs[this.props.refName]).value=this.formatValue(t)},handleFocus:function(e){var t=e.target.value;o.findDOMNode(this.refs[this.props.refName]).value=this.unformatValue(t)},render:function(){var e=this.props.defaultValue;return s.div({className:"form-group"},s.label({className:"control-label",htmlFor:this.props.refName},this.props.labelValue),s.input({id:this.props.refName,ref:this.props.refName,className:u("form-control single-value-input input-sm",this.props.getValidationClass(this.props.refName)),onChange:this.props.handleValidation(this.props.refName),defaultValue:this.formatValue(e&&e.toString()),onFocus:this.handleFocus,onBlur:this.handleBlur}),this.props.renderHelpText(this.props.getValidationMessages(this.props.refName)))}});i.ConditionalFormattingEditor=h;i.ValueEditingPanel=m;i.BoolEditing=v;i.RangeEditing=y;i.SingleValueEditing=w;i.ConditionSelectPanel=g},{"../../logicblox.pivot/util":357,"../constant/gridoptions":255,"./styleeditingpanel":503,classnames:6,immutable:"immutable",joi:"joi",lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],390:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.DOM;var a=e("../../logicblox.pivot/util");var s=e("react-validation-mixin");var l=e("joi-validation-strategy");var u=e("../constant/gridoptions");var c=u.FORMATTING_CONTROLLER;var d=c.VIEW_MODES;var p=e("./conditionalformattingeditor").ConditionalFormattingEditor;var f=n.createClass({displayName:"ConditionalFormattingPreview",propTypes:{selectedMeasureLabel:n.PropTypes.string.isRequired,selectedMeasureName:n.PropTypes.string.isRequired,measureOptions:n.PropTypes.array,selectedMeasureType:n.PropTypes.string,formatFn:n.PropTypes.func.isRequired,unformatFn:n.PropTypes.func.isRequired,conditionals:n.PropTypes.array,onSaveFormattingRule:n.PropTypes.func.isRequired,onRemoveFormattingRule:n.PropTypes.func.isRequired,ruleConfig:n.PropTypes.object},getInitialState:function(){return{viewMode:d.VIEW}},goToEditMode:function(){this.setState({viewMode:d.EDIT})},goToRemoveMode:function(){this.setState({viewMode:d.REMOVE})},onCancelEditingRule:function(){this.setState({viewMode:d.VIEW})},onRemoveRule:function(){this.props.onRemoveFormattingRule(this.props.ruleConfig);this.setState({viewMode:d.VIEW})},saveFormattingRule:function(e){this.props.onSaveFormattingRule(this.props.ruleConfig,e);this.setState({viewMode:d.VIEW})},render:function(){var e=this.props.ruleConfig;switch(this.state.viewMode){case d.VIEW:return n.createElement(h,{ruleConfig:e,goToEditMode:this.goToEditMode,goToRemoveMode:this.goToRemoveMode,selectedMeasureLabel:this.props.selectedMeasureLabel,formatFn:this.props.formatFn,selectedMeasureType:this.props.selectedMeasureType});case d.EDIT:return n.createElement(s(l)(p),{ruleConfig:e,formatFn:this.props.formatFn,unformatFn:this.props.unformatFn,onSaveFormattingRule:this.saveFormattingRule,onCancelEditingRule:this.onCancelEditingRule,conditionals:this.props.conditionals,selectedMeasureLabel:this.props.selectedMeasureLabel,selectedMeasureType:this.props.selectedMeasureType,measureOptions:this.props.measureOptions});case d.REMOVE:return n.createElement(g,{onRemoveRule:this.onRemoveRule,onCancelEditingRule:this.onCancelEditingRule})}}});var h=n.createClass({displayName:"ViewMode",propTypes:{selectedMeasureLabel:n.PropTypes.string.isRequired,selectedMeasureType:n.PropTypes.string,formatFn:n.PropTypes.func.isRequired,goToEditMode:n.PropTypes.func.isRequired,goToRemoveMode:n.PropTypes.func.isRequired,ruleConfig:n.PropTypes.object},buildPreviewLabel:function(){var e=this.props.ruleConfig,t=r.find(u.CONDITIONALS,function(t){return t.name===e.get("condition")}).label,i=e.get("intersections"),n=i&&i.toJS(),s=a.buildLevelLabel(this.props.selectedMeasureLabel,n);
if(e.get("condition")===u.CONDITIONALS.RANGE.name){return o.span(null,[s," ",t," from ",this.props.formatFn(e.getIn(["value",0]))," to ",this.props.formatFn(e.getIn(["value",1]))].join(""))}else{return o.span(null,[s," ",t," ",String(this.props.formatFn(e.get("value")))].join(""))}},render:function(){var e=this.props.ruleConfig.get("style"),t=e&&e.toJS();return o.li({className:"preview-container row"},o.div({className:"preview-description col-xs-8"},this.buildPreviewLabel()),o.div({className:"preview-example col-xs-2",style:a.convertCSSStyleToReact(t)},"123"),o.div({className:"preview-edit-buttons col-xs-2"},o.i({className:"edit-rule fa fa-pencil-square-o",title:"edit",onClick:this.props.goToEditMode}),o.i({className:"remove-rule fa fa-times-circle",title:"remove",onClick:this.props.goToRemoveMode})))}});var g=n.createClass({displayName:"RemoveMode",propTypes:{onRemoveRule:n.PropTypes.func.isRequired,onCancelEditingRule:n.PropTypes.func.isRequired},render:function(){return o.li({className:"row preview-container"},o.div({className:"col-xs-12 remove-container"},o.label({className:"remove-label"},"Remove formatting?"),o.div({className:"control-buttons"},o.a({onClick:this.props.onRemoveRule,className:"btn-primary btn panel-button pull-left col-xs-4"},"Remove"),o.a({onClick:this.props.onCancelEditingRule,className:"btn-discard btn-default btn panel-button pull-right col-xs-4"},"Cancel"))))}});i.ConditionalFormattingPreview=f;i.ViewMode=h;i.RemoveMode=g},{"../../logicblox.pivot/util":357,"../constant/gridoptions":255,"./conditionalformattingeditor":389,"joi-validation-strategy":"joi-validation-strategy",lodash:70,react:"react","react-validation-mixin":"react-validation-mixin"}],391:[function(e,t,i){"use strict";var r=e("react");var n=e("immutable");var o=r.DOM;var a=e("classnames");var s=e("react-validation-mixin");var l=e("joi-validation-strategy");var u=e("../util");var c=e("../constant/gridoptions");var d=c.FORMATTING_CONTROLLER;var p=e("./conditionalformattingeditor").ConditionalFormattingEditor;var f=e("./conditionalformattingpreview").ConditionalFormattingPreview;var h=r.createClass({displayName:"ConditionalFormattingViewer",propTypes:{selectedMeasure:r.PropTypes.object.isRequired,measureOptions:r.PropTypes.array,conditionals:r.PropTypes.array,formattingConfig:r.PropTypes.object,formatFn:r.PropTypes.func.isRequired,unformatFn:r.PropTypes.func.isRequired,onRemoveFormattingRule:r.PropTypes.func.isRequired,onSaveFormattingRule:r.PropTypes.func.isRequired,onAddFormattingRule:r.PropTypes.func.isRequired},getInitialState:function(){return{newRule:false}},componentWillReceiveProps:function(e){if(!n.is(this.props.formattingConfig,e.formattingConfig)||!n.is(this.props.selectedMeasure,e.selectedMeasure)){this.setState({newRule:false})}},loadFormattingPreviews:function(e,t){var i=e&&e.filter(function(e){return!e.has("intersections")}),r=e&&e.filter(function(e){return e.has("intersections")}),n={commonMeasure:this.buildPreviews(i,t),intersections:this.buildPreviews(r,t)};return n},buildPreviews:function(e,t){var i=this;return e&&e.map(function(e){return r.createElement(f,{key:u.hashCode(e),selectedMeasureLabel:t.get("label"),selectedMeasureName:t.get("id"),selectedMeasureType:t.get("type"),formatFn:i.props.formatFn,unformatFn:i.props.unformatFn,measureOptions:i.props.measureOptions,conditionals:i.props.conditionals,onSaveFormattingRule:i.props.onSaveFormattingRule,onRemoveFormattingRule:i.props.onRemoveFormattingRule,ruleConfig:e})})},addFormattingRule:function(){this.setState({newRule:true})},onSaveFormattingRule:function(e){this.setState({newRule:false},this.props.onAddFormattingRule.bind(null,e))},cancelEditingRule:function(){this.setState({newRule:false})},buildNewRule:function(){var e=n.fromJS({condition:"=",value:"",style:{"background-color":"rgb(104, 204, 202)",color:"black"}});return r.createElement(s(l)(p),{ruleConfig:e,formatFn:this.props.formatFn,unformatFn:this.props.unformatFn,onSaveFormattingRule:this.onSaveFormattingRule,onCancelEditingRule:this.cancelEditingRule,selectedMeasureLabel:this.props.selectedMeasure.get("label"),selectedMeasureType:this.props.selectedMeasure.get("type"),conditionals:this.props.conditionals,measureOptions:this.props.measureOptions})},render:function(){var e=this.loadFormattingPreviews(this.props.formattingConfig,this.props.selectedMeasure),t=this.state.newRule;return o.div({className:"previews"},e.commonMeasure&&!e.commonMeasure.isEmpty()?o.label({className:"col-xs-12 previews-header"},d.ALL):false,o.ul({className:"row conditional-view-previews"},e.commonMeasure,t?this.buildNewRule():false,o.li({className:a("row preview-container add-rule",{hidden:t||!this.props.selectedMeasure}),onClick:this.addFormattingRule},o.i({className:"fa fa-plus float-right"}),o.label({className:"add-rule-label col-xs-11"},"New rule"))),e.intersections&&!e.intersections.isEmpty()?o.label({className:"col-xs-12 previews-header"},d.INTERSECTIONS):false,o.ul({className:"row conditional-view-previews"},e.intersections))}});t.exports=h},{"../constant/gridoptions":255,"../util":357,"./conditionalformattingeditor":389,"./conditionalformattingpreview":390,classnames:6,immutable:"immutable","joi-validation-strategy":"joi-validation-strategy",react:"react","react-validation-mixin":"react-validation-mixin"}],392:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.PropTypes;var a=e("./buttonspanel").ButtonsPanel;var s=e("./modalwindow").ModalWindow;var l=e("../constant");var u=l.ButtonPanelTypes;var c=l.ButtonTypes;var d=n.createClass({displayName:"ConfirmationDialogController",propTypes:{modelerApp:o.object.isRequired,resolve:o.func.isRequired,reject:o.func.isRequired,closeWindow:o.func.isRequired,title:o.string,text:o.string.isRequired,width:o.string},getDefaultProps:function(){return{width:"300px"}},onContinue:function(){this.props.modelerApp.getMultiAxisDataActionHandler().clearEdits();this.closeWindow();this.props.resolve()},onCancel:function(){this.closeWindow();this.props.reject()},closeWindow:function(){this.props.closeWindow()},handleClick:function(e,t){e.stopPropagation();switch(t){case c.CONTINUE:this.onContinue();break;default:this.onCancel()}},render:function(){return n.createElement(s,{onHide:this.handleClick,title:this.props.title,visible:true,width:this.props.width,body:n.DOM.div({style:{whiteSpace:"pre-line"}},this.props.text),footer:n.createElement(a,{type:u.CONTINUE_CANCEL,onClick:this.handleClick})})}});t.exports=d},{"../constant":256,"./buttonspanel":385,"./modalwindow":437,lodash:70,react:"react"}],393:[function(e,t,i){"use strict";var r=e("react");var n=e("classnames");var o=r.createClass({displayName:"ControlButtons",propTypes:{undo:r.PropTypes.bool,pin:r.PropTypes.bool,disableApply:r.PropTypes.bool,isPinned:r.PropTypes.bool,onApply:r.PropTypes.func,onDiscard:r.PropTypes.func,onPushpin:r.PropTypes.func,onUndo:r.PropTypes.func},render:function(){var e=n({"pushpin-button":true,control:true,pinned:this.props.isPinned}),t=n({"apply-button":true,control:true,disabled:this.props.disableApply});return r.DOM.div({className:"lb-control-buttons"},r.DOM.a({className:t,title:"Apply changes",onClick:this.props.onApply,href:"javascript:"},r.DOM.i({className:"fa fa-check"})),this.props.undo?r.DOM.a({className:"undo-button control",title:"Undo changes",onClick:this.props.onUndo,href:"javascript:"},r.DOM.i({className:"fa fa-undo"})):null,this.props.pin?r.DOM.a({className:e,title:"Pin the popover",onClick:this.props.onPushpin,href:"javascript:"},r.DOM.i({className:"fa fa-thumb-tack"})):null,r.DOM.a({className:"cancel-button control",title:"Discard changes and close",onClick:this.props.onDiscard,href:"javascript:"},r.DOM.i({className:"fa fa-times"})))}});t.exports=o},{classnames:6,react:"react"}],394:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=r.createClass({displayName:"CountdownTimer",mixins:[n],propTypes:{secondsRemaining:r.PropTypes.number.isRequired,timeOverCallback:r.PropTypes.func.isRequired},getInitialState:function(){return{secondsRemaining:this.props.secondsRemaining}},tick:function(){this.setState({secondsRemaining:this.state.secondsRemaining-1});if(this.state.secondsRemaining<=0){clearInterval(this.interval);this.props.timeOverCallback()}},componentDidMount:function(){this.interval=setInterval(this.tick,1e3)},componentWillUnmount:function(){clearInterval(this.interval)},render:function(){return r.DOM.span(null,this.state.secondsRemaining)}});t.exports=o},{react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],395:[function(e,t,i){"use strict";var r=e("react");var n=r.createClass({displayName:"CSSLoader",propTypes:{caption:r.PropTypes.string},getDefaultProps:function(){return{caption:"Loading..."}},render:function(){return r.DOM.div({className:"cssloader-container"},r.DOM.div(null,r.DOM.div({className:"cssloader-box"},r.DOM.div({className:"cssloader-loader"},r.DOM.div({className:"cssloader-flipper"},r.DOM.div({className:"cssloader-front"}),r.DOM.div({className:"cssloader-back"}))),r.DOM.span(null,this.props.caption))))}});t.exports=n},{react:"react"}],396:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react").PropTypes;function o(e,t){return n.shape(r.omit(t.propTypes,e))}t.exports={shapeFromWithOmit:o}},{lodash:70,react:"react"}],397:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-dom");var a=e("classnames");var s=e("treebrowser");var l=s.view.TreeBrowser;var u=s.view.TreeBrowserNode;var c=e("./dimensiontreeprovider");var d=e("./draggableutil");var p=e("../multiaxisconfig").FieldTypes;var f=e("../store/measuremodelstore").MeasureModelEvents;var h=e("../util/eventlistenermixin");var g=n.createClass({displayName:"DimensionBrowserTreeNode",propTypes:{modelerApp:n.PropTypes.object.isRequired},componentDidMount:function(){if(this.props.treeNode.hasOwnProperty("children"))return;this.$draggableUtil=new d;o.findDOMNode(this).addEventListener("mousedown",this.startDrag)},startDrag:function(e){var t=e.target.getBoundingClientRect(),i=this.props.modelerApp,r=i.getDragAndDropActionHandler(),n=this.props.treeNode.nodeObj.isSpecial?p.MEASURE_GROUP:p.LEVEL,o=i.getFieldStore().getField(this.props.treeNode.nodeObj.id,n),a=this.$draggableUtil.newDraggingField(o,r);a.getBoundingClientRect=function(){return t};if(a){this.$draggableUtil.startDrag(a,e.clientX,e.clientY)}},render:function(){var e=a({"lb-dimension-leaf":!this.props.treeNode.hasOwnProperty("children"),special:this.props.treeNode.nodeObj.isSpecial});return n.DOM.div({className:e,draggable:!this.props.treeNode.hasOwnProperty("children")},n.createElement(u,this.props))}});var m=n.createClass({displayName:"DimensionBrowserController",mixins:[h],propTypes:{modelerApp:n.PropTypes.object.isRequired},setEventListeners:function(){return[{emitter:this.props.modelerApp.getMeasureModelStore(),event:f.CHANGED,callback:this.measureModelUpdated}]},getInitialState:function(){var e=c.createDimensionTreeData(this.props.modelerApp.getModelerState());return{tree:e}},measureModelUpdated:function(){this.setState(this.getInitialState())},render:function(){var e=this;return n.createElement(l,{tree:this.state.tree,filterable:true,nodeElement:function(t){var i=r.merge({},t,{modelerApp:e.props.modelerApp});return n.createElement(g,i)}})}});t.exports=m},{"../multiaxisconfig":328,"../store/measuremodelstore":344,"../util/eventlistenermixin":360,"./dimensiontreeprovider":398,"./draggableutil":401,classnames:6,lodash:70,react:"react","react-dom":"react-dom",treebrowser:202}],398:[function(e,t,i){var r=e("../multiaxisconfig");var n=e("../helpers/fieldhelpers");var o=e("immutable");var a=e("./pivot/config_helper");var s=i;s.createDimensionTreeData=function(e,t){var i=e.measureModel,a=e.fields,s=r.compareLevelFields.bind(null,i),u=i.getNonPrimitiveDimensions().map(function(e){return e.name}),c=u.reduce(function(e,t){var i=n.getField(a,t,r.FieldTypes.DIMENSION);return e.set(i,n.getLevelFieldsForDimension(a,t))},o.Map()),d=c.map(function(e){return e.sort(s)}),p=o.Map({$depth:-1}),f=d.map(function(e,i){return l(i,e,-1,t)}),h,g=o.Map({id:"-:Measures",label:"Measures",isSpecial:true});g=t?t(g,n.getFieldFromQualifiedName(a,"-:Measures")):g;h=f.toList().unshift(g);return p.set("children",h).toJS()};function l(e,t,i,r){var n=i?i+1:-1,a=o.Map({id:e.id,label:e.fieldLabel,isOpen:false,$depth:n,children:[]});a=a.set("children",t.map(function(e){var t=e.level.levelName,i=e.fieldLabel,a=o.Map({id:e.id,label:i||t,isOpen:true,$depth:n+1});return r?r(a,e):a}));return a}},{"../helpers/fieldhelpers":296,"../multiaxisconfig":328,"./pivot/config_helper":455,immutable:"immutable"}],399:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("../util/eventlistenermixin");var a=e("../constant").DND;function s(e){return n.createClass({displayName:"DragAndDropWrapper",propTypes:{modelerApp:n.PropTypes.object.isRequired},mixins:[o],getInitialState:function(){return{dragData:undefined,dragType:undefined,dragOverData:undefined,dropData:undefined}},setEventListeners:function(){var e=this.props.modelerApp.getDragAndDropStore();return[{emitter:e,event:a.EVENTS.CHANGED,callback:this.onDndChange}]},onDndChange:function(){var e=this.props.modelerApp.getDragAndDropStore(),t={dragData:e.getDragData(),dragType:e.getDragType(),dragOverData:e.getDragOver(),dropData:e.getDropData()};this.setState(t)},render:function(){var t=this.props.modelerApp.getDragAndDropActionHandler(),i=r.defaults({dragOver:t.dragOver,drop:t.drop,startDrag:t.startDrag,stopDrag:t.stopDrag},this.state,this.props);return n.createElement(e,i)}})}t.exports=s},{"../constant":256,"../util/eventlistenermixin":360,lodash:70,react:"react"}],400:[function(e,t,i){var r=e("react");var n=e("lodash");var o=e("../util");function a(e,t){return r.createClass({displayName:t||"Draggable",propTypes:{onDragStart:r.PropTypes.func.isRequired,onDragStop:r.PropTypes.func.isRequired},getInitialState:function(){return{isDragging:false}},handleDragStart:function(e){var t=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;try{if(t){if(e&&e.dataTransfer&&e.dataTransfer.setData){e.dataTransfer.setData("Text","")}}this.setState({isDragging:true});this.props.onDragStart()}catch(e){o.logError(e)}e.stopPropagation()},handleDragEnd:function(e){try{this.setState({isDragging:false});this.props.onDragStop&&this.props.onDragStop();e.stopPropagation()}catch(e){o.logError(e)}},render:function(){var t=n.defaults({isDragging:this.state.isDragging,isDraggable:true,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd},this.props);return r.createElement(e,t)}})}t.exports=a},{"../util":357,lodash:70,react:"react"}],401:[function(e,t,i){"use strict";var r=function(){var e=document.createElement("div");e.style.cssText="pointer-events:auto";return e.style.pointerEvents==="auto"}();var n=e("../multiaxisconfig").FieldTypes;var o=e("pivottable/src/lib/dom");var a=e("pivottable/src/lib/event");var s=e("../constant").DND.TYPES;function l(){}l.prototype.getFieldName=function(e){if(!e||!e.hasAttribute("data-qname"))return"";return e.getAttribute("data-qname")};l.prototype.findDroppable=function(e){return o.findParentWithClass(e,"droppable")};l.prototype.findField=function(e){return o.findParentWithClass(e,"field")};l.prototype.findFieldGroup=function(e){return o.findParentWithClass(e,"fieldgroup")};l.prototype.findFieldContainer=function(e){return o.findParentWithClass(e,"field-container")};l.prototype.startDrag=function(e,t,i){var n=this,s=this.getFieldName(e);if(!s){return}var l=e.getBoundingClientRect(),u={x:t,y:i},c,d,p=null,f;function h(){e.onDragStart&&e.onDragStart(e);d=e.cloneNode(true);o.addCssClass(d,"draggable");o.removeCssClass(d,"hover");document.body.appendChild(d);document.body.className=document.body.className+" dragging";g(u,d);c=d.style;c.left=l.left+"px";c.top=l.top+"px";c.height=l.height+"px";c.width=l.width+"px";c.position="absolute";e.style.display="none"}function g(e,t){var i=t.offsetWidth;var r=e.x-l.left;var n=l.right-e.x;var o=Math.min(r,n,i/2);if(o===n){r=e.x-i+o}else{r=e.x-o}l={left:r,top:l.top}}function m(e,t,i){return{type:e,data:s,sender:n,event:t,target:i,clientX:t&&t.clientX,clientY:t&&t.clientY}}function v(e){var t=e.target;if(!r){c.zIndex=-1;t=document.elementFromPoint(e.clientX,e.clientY);c.zIndex=""}return t}this.dragging=true;this.cancelDrag=y;a.capture(e,function(e){var t=e.clientX;var i=e.clientY;if(!c){if(Math.abs(t-u.x)+Math.abs(i-u.y)>2){h()}else{return}}c.left=l.left+(t-u.x)+"px";c.top=l.top+(i-u.y)+"px";var r=v(e);var o=n.findDroppable(r);var s=n.findFieldContainer(n.findFieldGroup(r)||n.findField(r))||n.findFieldContainer(r);d(o,p);d(s,f);function d(t,i){if(i&&t!=i&&i.onDragLeave){i.onDragLeave(m("dropleave",e,t))}if(t&&t!=i&&t.onDragEnter){t.onDragEnter(m("dropenter",e,t))}if(t&&t.onDragOver){t.onDragOver(m("dragover",e,t))}}p=o;f=s;a.stopEvent(e)},y);function y(t){if(!d)return;var i=t&&v(t);function r(e){if(e&&e.onDrop){e.onDrop(m("drop",t,i).event)}}r(f);r(p);e.style.display="";document.body.className=document.body.className.replace("dragging","");document.body.removeChild(d);n.dragging=false;n.cancelDrag=function(){};d=null;e.onDragEnd&&e.onDragEnd()}};l.prototype.newDraggingField=function(e,t){var i=document.createElement("div");i.className="field";i.setAttribute("data-qname",e.id);var r=document.createElement("span");o.setInnerText(r,e.fieldLabel);r.className="field-content";if(e.type===n.LEVEL){i.className+=" level";r.className+=" key"}if(e.type===n.MEASURE_GROUP){i.className+=" measure-group"}if(e.type===n.MEASURE){i.className+=" measure"}i.appendChild(r);i.onDragStart=function(i){t.startDrag(s.FIELD,{field:e})};i.onDragEnd=function(e){t.stopDrag()};return i};t.exports=l},{"../constant":256,"../multiaxisconfig":328,"pivottable/src/lib/dom":117,"pivottable/src/lib/event":119}],402:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("react-addons-pure-render-mixin");var a=e("classnames");var s=e("lodash");var l=r.createClass({displayName:"EditableField",mixins:[o],propTypes:{initialName:r.PropTypes.string.isRequired,onAdd:r.PropTypes.func.isRequired,onCancel:r.PropTypes.func.isRequired,onBlur:r.PropTypes.func},getInitialState:function(){return{}},componentDidMount:function(){var e=n.findDOMNode(this.refs.editableField);e.focus();e.select()},onChange:function(e){this.setState({value:e.target.value})},onKeyDown:function(e){if(e.keyCode===27){this.props.onCancel()}else if(e.keyCode===13){this.props.onAdd(this.state.value)}},render:function(){var e=!s.isUndefined(this.state.value)?this.state.value:this.props.initialName,t={field:true,editable:true,disabled:this.props.isDisabled};return r.DOM.div({className:a(t)},r.DOM.input({type:"text",ref:"editableField",className:"editable-field",onBlur:this.props.onBlur,onKeyDown:this.onKeyDown,onChange:this.onChange,value:e}))}});t.exports=l},{classnames:6,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],403:[function(e,t,i){var r=e("react");var n=e("./login").LoginForm;var o=e("../dao/userdao");var a=e("../../logicblox.core/network").HttpHelper;var s=r.createClass({propTypes:{realm:r.PropTypes.string.isRequired,loginUrl:r.PropTypes.string.isRequired,onSuccess:r.PropTypes.func,onFailure:r.PropTypes.func},componentWillReceiveProps:function(e){if(this.props.realm!==e.realm||this.props.loginUrl!==e.loginUrl){this.updateUserDao(e)}},componentWillMount:function(){this.updateUserDao()},updateUserDao:function(e){e=e||this.props;var t=new a;this.$userDao=new o(t,null,e.loginUrl,null,e.realm)},render:function(){return r.createElement(n,{loginFn:this.$userDao.authenticate.bind(this.$userDao),onSuccess:this.props.onSuccess,onFailure:this.props.onFailure})}});t.exports=s},{"../../logicblox.core/network":220,"../dao/userdao":284,"./login":426,react:"react"}],404:[function(e,t,i){var r=e("react");var n=e("lodash");var o=e("./logout");var a=e("../dao/userdao");var s=e("../../logicblox.core/network").HttpHelper;var l=r.createClass({propTypes:{realm:r.PropTypes.string.isRequired,logoutUrl:r.PropTypes.string.isRequired,welcomeMessageFn:r.PropTypes.func,onSuccess:r.PropTypes.func,onFailure:r.PropTypes.func,displayName:r.PropTypes.string,loggedIn:r.PropTypes.bool,hideWhenLoggedOut:r.PropTypes.bool,loggedOutDisplayMessage:r.PropTypes.string,welcomeMessageFn:r.PropTypes.func,notifyUserAboutLogout:r.PropTypes.func,idleNotificationTime:r.PropTypes.number,idleLogoutTime:r.PropTypes.number,notificationTime:r.PropTypes.number},componentWillReceiveProps:function(e){if(this.props.realm!==e.realm||this.props.logoutUrl!==e.logoutUrl){this.updateUserDao(e)}},componentWillMount:function(){this.updateUserDao()},updateUserDao:function(e){e=e||this.props;var t=new s;this.$userDao=new a(t,null,null,e.logoutUrl,e.realm)},render:function(){return r.createElement(o,n.merge({},this.props,{logoutFn:this.$userDao.unauthenticate.bind(this.$userDao)}))}});t.exports=l},{"../../logicblox.core/network":220,"../dao/userdao":284,"./logout":427,lodash:70,react:"react"}],405:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("react-addons-pure-render-mixin");var a=e("classnames");var s=e("popupmenu").PopupMenu;var l=e("popupmenu").Menu;var u=e("../constant").FieldTypeClasses;var c=r.createClass({displayName:"SortButton",mixins:[o],propTypes:{isSorted:r.PropTypes.bool,ascending:r.PropTypes.bool,onClick:r.PropTypes.func},getDefaultProps:function(){return{isSorted:false,ascending:true}},render:function(){return r.DOM.div({className:a({"field-icon":true,"fa fa-sort-amount-asc":this.props.ascending,"fa fa-sort-amount-desc":!this.props.ascending,"sort-icon":true,sorted:this.props.isSorted}),onClick:this.props.onClick})}});var d=r.createClass({displayName:"Field",mixins:[o],propTypes:{children:r.PropTypes.array,title:r.PropTypes.string.isRequired,label:r.PropTypes.string.isRequired,insertBefore:r.PropTypes.bool,isFiltered:r.PropTypes.bool,isFilterable:r.PropTypes.bool,isSorted:r.PropTypes.bool,type:r.PropTypes.number,ascending:r.PropTypes.bool,isDragging:r.PropTypes.bool,isDraggable:r.PropTypes.bool,onDragStart:r.PropTypes.func,onDragEnd:r.PropTypes.func,onDragEnter:r.PropTypes.func,onDragLeave:r.PropTypes.func,onDragOver:r.PropTypes.func,onDrop:r.PropTypes.func,onSortClick:r.PropTypes.func},getInitialState:function(){return{}},onContextMenu:function(e){e.preventDefault();this.setState({isMenuOpen:true,openPositionX:e.clientX,openPositionY:e.clientY})},onMenuClose:function(){this.setState({isMenuOpen:false})},handleFilterClick:function(){if(this.props.onFilterClick){this.props.onFilterClick(n.findDOMNode(this),this.props.title)}},renderMenu:function(){var e=null;if(this.props.children&&this.state.isMenuOpen){e=r.createElement(s,{onClose:this.onMenuClose,openPositionX:this.state.openPositionX,openPositionY:this.state.openPositionY},r.createElement(l,{onClose:this.onMenuClose},this.props.children))}return e},render:function(){var e={"field-container":true,insertbefore:this.props.insertBefore},t={field:true,fade:this.props.isDragging};t[u[this.props.type]]=true;return r.DOM.div({className:a(e),onDragEnter:this.props.onDragEnter,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop,onDragOver:this.props.onDragOver,onContextMenu:this.onContextMenu},r.DOM.div({ref:"inner",className:a(t),title:this.props.title,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,draggable:this.props.isDraggable},this.props.onSortClick?r.createElement(c,{ref:"sortBtn",onClick:this.props.onSortClick,isSorted:this.props.isSorted,ascending:this.props.ascending}):null,this.props.isFilterable?r.DOM.div({className:a({"field-icon":true,"fa fa-filter":true,filtered:this.props.isFiltered}),onClick:this.handleFilterClick}):null,r.DOM.span({className:"field-title"},this.props.label),this.renderMenu()))}});i.Field=d;i.FieldSortButton=c},{"../constant":256,classnames:6,popupmenu:146,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],406:[function(e,t,i){var r=e("react");var n=e("react-dom");var o=e("react-addons-pure-render-mixin");var a=e("lodash");function s(e,t){return r.createClass({displayName:t||"FieldDropZone",mixins:[o],propTypes:{onDrop:r.PropTypes.func.isRequired,isDroppable:r.PropTypes.bool},getInitialState:function(){return{counter:0}},componentDidMount:function(){n.findDOMNode(this).onDrop=this.handleDrop;n.findDOMNode(this).onDragEnter=this.handleDragEnter;n.findDOMNode(this).onDragLeave=this.handleDragLeave},componentWillUnmount:function(){var e=n.findDOMNode(this);e.onDrop=null;e.onDragEnter=null;e.onDragLeave=null},handleDrop:function(){this.props.onDrop();this.setState({counter:0})},handleDragEnter:function(){this.setState({counter:this.state.counter+1})},handleDragLeave:function(){this.setState({counter:this.state.counter-1})},handleDragOver:function(e){if(e)e.preventDefault()},render:function(){var t={isDragOver:this.state.counter>0,onDrop:this.handleDrop,onDragOver:this.handleDragOver,onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave};return r.createElement(e,a.extend(t,this.props))}})}t.exports=s},{lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],407:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=e("classnames");var a=r.createClass({displayName:"FieldGroup",mixins:[n],propTypes:{title:r.PropTypes.string.isRequired,insertBefore:r.PropTypes.bool,isDragging:r.PropTypes.bool,isDraggable:r.PropTypes.bool,onDrop:r.PropTypes.func,onDragStart:r.PropTypes.func,onDragEnd:r.PropTypes.func,onDragEnter:r.PropTypes.func,onDragLeave:r.PropTypes.func,onDragOver:r.PropTypes.func},render:function(){var e={"field-container":true,insertbefore:this.props.insertBefore},t={fieldgroup:true,fade:this.props.isDragging};return r.DOM.div({onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,onDragLeave:this.props.onDragLeave,onDragOver:this.props.onDragOver,className:o(e)},r.DOM.div({ref:"inner",className:o(t),title:this.props.title,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,draggable:this.props.isDraggable},r.DOM.i({className:"fieldgroup-dragger fa fa-arrows-alt"}),this.props.children))}});t.exports=a},{classnames:6,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],408:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("lodash");function a(e,t){return r.createClass({displayName:t||"FieldOrderWrapper",propTypes:{insertBefore:r.PropTypes.bool.isRequired,onDragOver:r.PropTypes.func.isRequired,onDragLeave:r.PropTypes.func.isRequired},componentDidMount:function(){n.findDOMNode(this).onDrop=this.handleDrop;n.findDOMNode(this).onDragEnter=this.handleDragEnter;n.findDOMNode(this).onDragLeave=this.handleDragLeave},getInitialState:function(){return{counter:0}},handleDragEnter:function(e){this.setState({counter:this.state.counter+1});this.props.onDragOver();if(e.preventDefault)e.preventDefault();if(e.event&&e.event.preventDefault)e.event.preventDefault()},handleDragLeave:function(){if(this.state.counter===1){this.props.onDragLeave()}this.setState({counter:this.state.counter-1})},handleDrop:function(){this.setState({counter:0})},handleDragOver:function(e){e.preventDefault()},render:function(){var t={insertBefore:this.props.insertBefore,onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDragOver:this.handleDragOver,onDrop:this.handleDrop};return r.createElement(e,o.defaults(t,this.props))}})}t.exports=a},{lodash:70,react:"react","react-dom":"react-dom"}],409:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=e("classnames");var a=r.createClass({displayName:"FieldPanelTitle",mixins:[n],propTypes:{onClick:r.PropTypes.func},render:function(){return r.DOM.div({className:"panel-title",onClick:this.props.onClick},this.props.children)}});var s=r.createClass({propTypes:{icon:r.PropTypes.string.isRequired,iconCls:r.PropTypes.string},mixins:[n],render:function(){var e="fa fa-"+this.props.icon;if(this.props.iconCls)e+=" "+this.props.iconCls;return r.DOM.span({className:"title-icon"},r.DOM.i({className:e}))}});var l=r.createClass({displayName:"TitleText",mixins:[n],propTypes:{title:r.PropTypes.string.isRequired},render:function(){return r.DOM.span({className:"title-text"},this.props.title)}});var u=r.createClass({displayName:"AddFieldButton",mixins:[n],propTypes:{isVisible:r.PropTypes.bool.isRequired,onClick:r.PropTypes.func},render:function(){if(!this.props.isVisible)return null;return r.DOM.div({className:"addlevel-button",style:{fontSize:"24px"}},r.DOM.i({className:"fa fa-plus-square",onClick:this.props.onClick}))}});var c=r.createClass({displayName:"FieldPanel",mixins:[n],propTypes:{panelClass:r.PropTypes.string.isRequired,title:r.PropTypes.string.isRequired,icon:r.PropTypes.string,iconCls:r.PropTypes.string,isVertical:r.PropTypes.bool,isDraggingField:r.PropTypes.bool,isDroppable:r.PropTypes.bool,isDragOver:r.PropTypes.bool,onDrop:r.PropTypes.func,onDragOver:r.PropTypes.func,onDragEnter:r.PropTypes.func,onDragLeave:r.PropTypes.func,onAddButtonClick:r.PropTypes.func,onPanelTitleClick:r.PropTypes.func},render:function(){var e={"field-panel":true,active:this.props.isDraggingField&&this.props.isDroppable,inactive:this.props.isDraggingField&&!this.props.isDroppable,horizontal:!this.props.isVertical,vertical:this.props.isVertical,droppable:true,dragover:this.props.isDragOver};e[this.props.panelClass]=true;return r.DOM.div({className:o(e),onDrop:this.props.onDrop,onDragOver:this.props.onDragOver,onDragEnter:this.props.onDragEnter,onDragLeave:this.props.onDragLeave},r.createElement(a,{onClick:this.props.onPanelTitleClick},r.createElement(l,{title:this.props.title}),this.props.icon?r.createElement(s,{icon:this.props.icon,iconCls:this.props.iconCls}):null),r.DOM.div({className:"fields-container"},this.props.children))}});t.exports=c},{classnames:6,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],410:[function(e,t,i){"use strict";var r=e("react");var n=e("controls");var o=e("classnames");var a=e("../function_prop_binder");var s={onChange:"field"};var l={update:"field",validate:"field"};var u=a(n.Checkbox,s);var c=a(n.Dropdown,s);var d=a(n.BooleanDropdown,s);var p=a(n.Link,s);var f=a(n.Mouseover,s);var h=a(n.Image,s);var g=a(n.TextInput,l);var m=a(n.TextArea,l);var v=r.createClass({displayName:"Form",propTypes:{updateField:r.PropTypes.func.isRequired,validateField:r.PropTypes.func.isRequired,fields:r.PropTypes.array.isRequired},deleteField:function(e,t){t.preventDefault();this.props.updateField(e)},renderControl:function(e,t){var i;switch(e.type){case"checkbox":i=r.DOM.div(null,r.createElement(u,{field:e,checked:e.value,onChange:this.props.updateField}));break;case"text":i=r.DOM.div(null,r.createElement(g,{field:e,value:e.value,formattedValue:e.formattedValue,readOnly:e.readOnly,disabled:e.disabled,focused:e.focused,updateOn:e.updateOn||"blur",update:this.props.updateField,validate:this.props.validateField,allowInvalid:e.allowInvalid}));break;case"percentage":i=r.DOM.div(null,r.createElement(g,{field:e,value:e.formattedValue,formattedValue:e.formattedValue,readOnly:e.readOnly,disabled:e.disabled,focused:e.focused,updateOn:"blur",update:this.props.updateField,validate:this.props.validateField,allowInvalid:e.allowInvalid}));break;case"wrapped-text":i=r.DOM.div(null,r.createElement(m,{field:e,value:e.value,formattedValue:e.formattedValue,readOnly:e.readOnly,disabled:e.disabled,focused:e.focused,updateOn:"blur",update:this.props.updateField,validate:this.props.validateField,allowInvalid:e.allowInvalid}));break;case"dropdown":i=r.DOM.div(null,r.createElement(c,{field:e,selectedValue:e.value,options:e.options,onChange:this.props.updateField,readOnly:e.readOnly}));break;case"booleandropdown":i=r.DOM.div(null,r.createElement(d,{field:e,selectedValue:e.value,onChange:this.props.updateField,
readOnly:e.readOnly}));break;case"link":i=r.DOM.div(null,r.createElement(p,{field:e,value:e.value,readOnly:e.readOnly,allowInvalid:e.allowInvalid,onChange:this.props.updateField}));break;case"mouseover":i=r.DOM.div(null,r.createElement(f,{field:e,value:e.value,readOnly:e.readOnly,allowInvalid:e.allowInvalid,onChange:this.props.updateField}));break;case"image":i=r.DOM.div(null,r.createElement(h,{field:e,value:e.value,readOnly:e.readOnly,allowInvalid:e.allowInvalid,onChange:this.props.updateField}));break;default:console.error(e.type+" control is not implemented");return null}return r.DOM.div({key:t,className:o({saving:e.isEditing},"form-group")},r.DOM.label({className:"control-label"},e.label,e.protected?r.DOM.i({className:"fa fa-shield",title:"The field is protected"}):null),e.readOnly||e.disabled?null:r.DOM.a({className:"control-label delete-field",href:"#",tabIndex:-1,onClick:this.deleteField.bind(this,e)},"clear"),i)},render:function(){return r.DOM.form(null,this.props.fields.map(this.renderControl),this.props.children)}});t.exports=v},{"../function_prop_binder":418,classnames:6,controls:8,react:"react"}],411:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("../cssloader");var a=e("../pivot/pivot_hoc");var s=e("../../multiaxisconfig");var l=e("../pivot/config_helper");var u=e("../../pivotconfig_helper");var c=e("../../cubiql");var d=e("../../inputparser");var p=e("../../validationtool");var f=e("./form.js");var h=e("../loadingplaceholder");var g=n.property("value.rawValue.0.0");var m=n.property("value.formattedValue.0.0");var v=n.property("value.rawValue");var y=n.property("constructor.name");var b=function(e){return v(e).reduce(function(e,t){e[t[0]]=t[1];return e},{})};var w=r.createClass({displayName:"FormController",propTypes:{modelerApp:r.PropTypes.object.isRequired,id:r.PropTypes.string.isRequired,uniqueId:r.PropTypes.string.isRequired,config:r.PropTypes.object.isRequired,sheetUniqueId:r.PropTypes.string.isRequired,sheetId:r.PropTypes.string.isRequired,sheetConfig:r.PropTypes.object.isRequired,pivotState:r.PropTypes.object.isRequired,modelerState:r.PropTypes.object.isRequired,updatePivotState:r.PropTypes.func.isRequired,headingData:r.PropTypes.object.isRequired,range:r.PropTypes.object.isRequired,isLoading:r.PropTypes.bool.isRequired,viewTaskId:r.PropTypes.string.isRequired},getData:function(){var e=this.props.modelerApp.getMultiAxisDataStore();return e.getDataRange(this.props.viewTaskId,"main",this.props.range,w.cellBuilder(this.props.modelerState,this.props.pivotState)).dataArray},getAxis:function(){return this.props.config.getIn(["form","axis"])},getDataSlice:function(e,t){var i=this.getAxis();return i==="Y"?e[t][0][0]:e[0][t][0]},createFormField:function(e,t){var i=e.headers[e.headers.length-1],r=t.data.value,o={cellInfo:t.cellInfo,label:i.label,type:t.displayType,readOnly:t.readonly||t.protected,protected:t.protected,value:g(t.data.value),formattedValue:m(r),allowInvalid:false},a=r.edit||r.outstandingSave;if(a){o.isEditing=true;o.formattedValue=a.edit.isDelete?"":a.edit.formattedValue;o.value=a.edit.isDelete?"":a.edit.data}switch(t.displayType){case"dropdown":o.options=n.sortBy(w.parseOptions(t.data),"order");break;case"link":case"mouseover":o.value=this.deserializeValue(o.value);break;case"checkbox":o.value=!!o.value;break}return o},getFormFields:function(){var e=this,t=this.getAxis(),i=t==="Y"?"X":"Y",r=this.props.headingData.getHeadingAxisInfo(i),n=this.getData();return r.getHeadingRange(0,r.getLength()).reduce(function(t,i,r){var o=e.getDataSlice(n,r);if(!o.invalid){t.push(e.createFormField(i,o))}return t},[])},deserializeValue:function(e){try{return JSON.parse(e)}catch(t){return e}},serializeValue:function(e,t){switch(e){case"link":case"mouseover":return JSON.stringify(t);default:return t}},updateField:function(e,t){var i=this,r=this.props.modelerApp.getMultiAxisDataActionHandler(),o=e.cellInfo.queries.value,a={cellInfo:e.cellInfo,editConfigName:"value"};if(n.isUndefined(t)){a.edit={data:e.value,isDelete:true}}else{a.edit=d.createParser(o.formatter).parseEditInput(this.serializeValue(e.type,t),o.type,e.value)}return r.storePendingEdits([a]).then(function(){return r.commitPendingEdits()}).then(function(){i.forceUpdate()}).catch(function(e){throw e})},validateField:function(e,t){var i=e.cellInfo.queries.value,r=p.validate(t,i.type,i.formatter.formatPattern),n={};if(r.valid){n.value=t}else{n.error={message:r.info}}return n},render:function(){if(this.props.isLoading){return r.createElement(o,{caption:"Data is loading..."})}var e=this.getFormFields(),t=e.find(function(e){return e.isEditing});return r.DOM.div({className:"lb-form-view"},r.DOM.div({className:"lb-form-wrapper"},t?r.createElement(h):null,r.createElement(f,{sheetId:this.props.sheetId,updateField:this.updateField,validateField:this.validateField,fields:e})))},statics:{parseOptions:function(e){var t=v(e.optionIds),i=b(e.optionLabels),r=b(e.optionSort);return t.map(function(e){var t=e[0];return{value:t,label:i[t],order:r[t]}})},cellBuilder:function(e,t){return function(i,r){if(r&&r.queryResults&&r.queryResults.value&&r.queryResults.value.value){var n=r?r.queryResults:{},o=w.getMeasureName(i);return{invalid:r.invalid||r.someInvalid||!Object.keys(i.queries).length,data:n,cellInfo:i,validityMessages:r.validityMessages,protected:n.value&&n.value.protected,locked:n.value&&n.value.locked,readonly:!(i.editConfigs.value&&i.editConfigs.value.editable),isRollup:w.isRollupCell(i),displayType:w.getDisplayType(e,i,o),formattingConfig:w.getFormattingConfig(t,i,o)||[]}}return r}},isRollupCell:function(e){return n.isArray(e.rollups)&&e.rollups.some(function(e){return y(e)==="Record"})},getMeasureName:function(e){var t=e.fields.find(function(e){return e instanceof s.MeasureField});return t&&t.id},getDisplayType:function(e,t,i){var r=e.pivotConfig.metricsConfig,n=i&&r&&r[i],o=n&&n.format,a=n&&n.cellType,s=e.measureModel,l=i&&s.getMeasureInfo(i),c=u.getDefaultDisplayTypeForMeasureType(l.type,o);return a||c},getFormattingConfig:function(e,t,i){var r=t.queries.value&&t.queries.value.query.mappedInter.qualified_level.map(function(e){return{qualifiedName:c.qualifiedLevelToQualifiedName(e)}});return l.getCellFormattingConfig(e,i,r)}}});var C=a(w,"FormController");C.parseOptions=w.parseOptions;t.exports=C},{"../../cubiql":276,"../../inputparser":299,"../../multiaxisconfig":328,"../../pivotconfig_helper":330,"../../validationtool":368,"../cssloader":395,"../loadingplaceholder":425,"../pivot/config_helper":455,"../pivot/pivot_hoc":477,"./form.js":410,lodash:70,react:"react"}],412:[function(e,t,i){"use strict";var r=e("../pivot/config_helper");var n=e("../../multiaxisconfig");function o(e,t){var i=r.getAxisFields(t,function(e){return e instanceof n.LevelField}),o=i.groupBy(function(e){return e.getIn(["level","dimensionName"])});return!o.find(function(t,i){return e.findHierarchiesWithLevels(i,t.map(function(e){return e.getIn(["level","levelName"])})).length===0})}function a(e,t,i){var a=r.getAxis(t,i),s=i==="Y"?"X":"Y",l=r.getAxis(t,s),u=a.size&&a.every(function(e){return e instanceof n.DimensionField||e instanceof n.LevelField}),c=l.size&&l.every(function(e){return e instanceof n.MeasureField||e instanceof n.MeasureGroupField});return u&&c&&o(e,t)}t.exports.canDisplayAsForm=a},{"../../multiaxisconfig":328,"../pivot/config_helper":455}],413:[function(e,t,i){"use strict";var r=e("react");var n=e("slugify");var o=e("../../constant").ButtonTypes;var a=e("./form");var s=e("../loadingplaceholder");var l=e("../panelbutton").PanelButton;var u=r.createClass({displayName:"LevelCreationFormController",propTypes:{modelerApp:r.PropTypes.object.isRequired,field:r.PropTypes.object.isRequired,buttonsClassName:r.PropTypes.string,onSubmit:r.PropTypes.func,onCancel:r.PropTypes.func},getInitialState:function(){return{processing:false,joinedInput:true,labelField:"",idField:""}},create:function(e){e.preventDefault();var t=this,i=t.props.field,r=t.props.modelerApp.getMultiAxisDataActionHandler();if(!t.validateForm()){return}t.setState({processing:true});return r.createLevel(i.level,t.state.idField,t.state.labelField).then(function(){t.setState({processing:false});t.props.onSubmit(t.state.idField)})},createFormFields:function(){return[{id:"labelField",label:"Label",type:"text",focused:true,value:this.state.labelField,allowInvalid:true,updateOn:"change"},{id:"idField",label:"ID",type:"text",value:this.state.idField,allowInvalid:true}]},updateField:function(e,t){t=t||"";var i={};i[e.id]=t;if(e.id==="labelField"&&this.state.joinedInput){i.idField=n(t)}if(e.id==="idField"){i.joinedInput=t===""}this.setState(i)},validateField:function(e,t){if(!t){return{error:{message:"This field is required."}}}},validateForm:function(){return!(this.validateField(undefined,this.state.idField)||this.validateField(undefined,this.state.labelField))},renderFormButtons:function(){return r.DOM.div({className:this.props.buttonsClassName},r.DOM.button({className:"btn btn-primary",type:"submit",onClick:this.create,disabled:!this.validateForm()},"Create"),this.props.onCancel?r.createElement(l,{type:o.CANCEL,text:"Cancel",onClick:this.props.onCancel}):null)},render:function(){return r.DOM.div(null,this.state.processing?r.createElement(s):null,r.DOM.div({className:"lb-form-view lb-level-creation-form"},r.DOM.div({className:"lb-form-wrapper"},r.createElement(a,{fields:this.createFormFields(),updateField:this.updateField,validateField:this.validateField},this.renderFormButtons()))))}});t.exports=u},{"../../constant":256,"../loadingplaceholder":425,"../panelbutton":454,"./form":410,react:"react",slugify:197}],414:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("classnames");var a=r.createClass({displayName:"FormatInput",propTypes:{className:r.PropTypes.string,disabled:r.PropTypes.bool,formatFn:r.PropTypes.func,onChange:r.PropTypes.func,value:r.PropTypes.string.isRequired,onBlur:r.PropTypes.func,onFocus:r.PropTypes.func},getInitialState:function(){return{value:undefined}},format:function(e){if(!n.isUndefined(this.props.formatFn))return this.props.formatFn(e);return e},render:function(){var e=o({"form-control":true,"input-sm":true},this.props.className),t=!n.isUndefined(this.state.value)?this.state.value:this.format(this.props.value);return r.DOM.input({ref:"numInput",className:e,disabled:this.props.disabled,type:"text",value:t,onBlur:this.handleBlur,onChange:this.handleChange,onFocus:this.handleFocus})},handleBlur:function(e){this.setState({value:undefined});if(!n.isUndefined(this.props.onBlur))this.props.onBlur(e)},handleChange:function(e){this.setState({value:e.target.value});if(!n.isUndefined(this.props.onChange))this.props.onChange(e)},handleFocus:function(e){this.setState({value:this.props.value});if(!n.isUndefined(this.props.onFocus))this.props.onFocus(e)}});i.FormatInput=a},{classnames:6,lodash:70,react:"react"}],415:[function(e,t,i){"use strict";var r=e("react");var n=r.DOM;var o=e("./aceeditor");var a=e("./formulainspector");var s=r.createClass({displayName:"FormulaEditor",propTypes:{editorId:r.PropTypes.string.isRequired,formulaStr:r.PropTypes.string,formulaAST:r.PropTypes.object,getMetric:r.PropTypes.func,metricCompletions:r.PropTypes.array,onMetricClick:r.PropTypes.func,onSubmit:r.PropTypes.func,isEditing:r.PropTypes.bool,onDoubleClick:r.PropTypes.func,onEsc:r.PropTypes.func,onFormulaChange:r.PropTypes.func},getDefaultProps:function(){return{formulaStr:"",isEditing:false}},onSubmitFormula:function(e){var t;if(this.props.onSubmit){t=e.getValue();this.props.onSubmit(t)}},onDoubleClick:function(){if(this.props.onDoubleClick){this.props.onDoubleClick(this.props.editorId)}},onFormulaChange:function(e){if(this.props.onFormulaChange){this.props.onFormulaChange(this.props.editorId,e)}},onEsc:function(){if(this.props.onEsc){this.props.onEsc(this.props.editorId)}},getFormulaValue:function(){var e=this.refs.editor;return e?e.getValue():this.props.formulaAST.toString()},render:function(){var e=this.props.formulaStr,t=this.props.formulaAST;return n.div({className:"formulaeditor"},this.props.isEditing||!t?r.createElement(o,{ref:"editor",code:e,mode:"ace/mode/logiql",completionTokens:this.props.metricCompletions,onChange:this.onFormulaChange,commands:[{name:"submitFormula",bindKey:"Ctrl-Enter",descr:"some description",exec:this.onSubmitFormula},{name:"cancelFormula",bindKey:"Esc",descr:"some description",exec:this.onEsc}]}):r.createElement(a,{ref:"inspector",formula:t,getMetric:this.props.getMetric,onMetricClick:this.props.onMetricClick,onDoubleClick:this.onDoubleClick}))}});t.exports=s},{"./aceeditor":369,"./formulainspector":416,react:"react"}],416:[function(e,t,i){"use strict";var r=e("react");var n=r.DOM;var o=e("lodash");var a=e("./formulainspector");var s=e("./metriclink");var l=e("../util");var a=r.createClass({displayName:"FormulaInspector",propTypes:{formula:r.PropTypes.object.isRequired,getMetric:r.PropTypes.func,onDoubleClick:r.PropTypes.func,onMetricClick:r.PropTypes.func},onDoubleClick:function(){if(this.props.onDoubleClick){this.props.onDoubleClick()}},render:function(){return n.div({className:"ace_editor",onDoubleClick:this.props.onDoubleClick},this.props.formula.accept(new u(this.props.getMetric,this.props.onMetricClick)))}});function u(e,t){return{visitFormula:function(e){return o.flatten(l.insertBetween(e,n.br()))},visitEquation:function(e,t){return o.flatten([e," = ",t])},visitExpr:function(e){return e},visitFunction:function(e){return e},visitUnaryOpFunction:function(e,t){return o.flatten([e,t])},visitOpFunction:function(e,t,i){return o.flatten([e,t,i])},visitFunctionalPredicate:function(i,n){var a=e&&e(i),l=i,u=[];if(a){l=r.createElement(s,{onClick:t,metricName:i,metricCaption:a&&a.caption||a.name||i,showName:true})}if(n.length){u=["[",n,"]"]}return o.flatten([l,u])},visitAggFunction:function(e,t){return o.flatten([c(e,"green"),c("[< ","green"),t,c(" >]","green")])},visitArgs:function(e){return l.insertBetween(o.flatten(e),", ")},visitGroup:function(e){return e},visitGuarded:function(e,t){return o.flatten([e,c(" where ","green"),t])},visitP2P:function(e,t){return"<<"+e+" = "+t+">>"},visitTuple:function(e){return l.insertBetween(o.flatten(e),", ")},visitVariable:function(e){return e},visitConstant:function(e){if(!o.isUndefined(e.boolean_constant))return c(String(e.boolean_constant),"blue");else if(!o.isUndefined(e.string_constant))return c(e.string_constant,"green");else if(!o.isUndefined(e.int_constant))return c(e.int_constant,"blue");else if(!o.isUndefined(e.float_constant))return c(e.float_constant+"f","blue");else if(!o.isUndefined(e.decimal_constant))return c(e.decimal_constant+"d","blue")},visitGuard:function(e){return e},visitComparison:function(e,t,i){return o.flatten([e,t,i])},visitOp:function(e){if(e==="EQUALS")return" = ";else if(e==="NOT_EQUALS")return" != ";else if(e==="GREATER_THAN")return" > ";else if(e==="LESS_THAN")return" < ";else if(e==="GREATER_OR_EQUALS")return" >= ";else if(e==="LESS_OR_EQUALS")return" <= "},visitConjunction:function(e){return l.insertBetween(e,", ")},visitDisjunction:function(e){return l.insertBetween(e,"; ")},visitExists:function(e){return e},visitNegation:function(e){return["!",e]},visitRelation:function(e){return e}}}function c(e,t){return r.DOM.span({style:{color:t}},e)}t.exports=a},{"../util":357,"./formulainspector":416,"./metriclink":435,lodash:70,react:"react"}],417:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("../full_story");var a=e("classnames");var s=e("../constant/fullstory");var l=r.createClass({displayName:"FullStoryButton",propTypes:{isActive:r.PropTypes.bool,organizationKey:r.PropTypes.string},getDefaultProps:function(){return{label:"FullStory"}},toggleFullStory:function(){if(this.state.isActive){o.clearFullStoryRecording()}else{o.startFullStoryRecording(this.props.organizationKey,this.props.userName)}this.setState({isActive:!this.state.isActive})},getInitialState:function(){return{isActive:this.props.isActive}},componentDidMount:function(){if(this.state.isActive){o.startFullStoryRecording(this.props.organizationKey,this.props.userName)}},componentWillUnmount:function(){o.clearFullStoryRecording()},render:function(){return r.DOM.button({className:a({enabled:this.state.isActive},"full-story-btn","action-button","btn","btn-default"),onClick:this.toggleFullStory,title:this.state.isActive?s.BUTTON_ACTIVE_TITLE:s.BUTTON_INACTIVE_TITLE},r.DOM.i({className:"fa fa-circle"}))}});t.exports=l},{"../constant/fullstory":254,"../full_story":294,classnames:6,lodash:70,react:"react"}],418:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("../util").cleanArgs;t.exports=function e(t,i){var a={displayName:"FunctionPropBinder"+t.displayName,render:function(){var e=this,o=r.omit(this.props,r.values(i));return n.createElement(t,r.extend(o,r.mapValues(i,function(t,i){return e[i]})))}};r.forEach(i,function(e,t){a[t]=function(){var i=[this.props[e]].concat(o(arguments));return this.props[t].apply(null,i)}});return n.createClass(a)}},{"../util":357,lodash:70,react:"react"}],419:[function(e,t,i){"use strict";var r=e("./view");var n=e("react");var o=e("lodash");var a=e("react-grid-layout");var s=e("react-addons-pure-render-mixin");var l=1;var u=1;var c=1;var d=1;var p={autoSize:false,useCSSTransforms:false,verticalCompact:false,rowHeight:0,cols:0,isDraggable:false,isResizable:false,margin:[2,0]};var f=n.createClass({displayName:"GridLayoutView",propTypes:{uniqueId:n.PropTypes.string.isRequired,modelerApp:n.PropTypes.object.isRequired,layoutState:n.PropTypes.object.isRequired},mixins:[s],getInitialState:function(){return{layout:[],options:p,uniqueId:o.uniqueId("grid-layout")}},getEntriesSpans:function(e,t,i){var r=[],n,a=0,s=Math.floor(t/i);o.chain(e).forEach(function(e,t){if(e.pixels){r[t]=Math.round(e.pixels/i)}}).forEach(function(e,t){if(e.percentage){if(t===0){n=o.countBy(r,o.isUndefined).false;if(n){s-=o.reduce(r,function(e,t){return(e||0)+(t||0)})}}r[t]=Math.round(s*e.percentage)}}).map(function(e,t){if(e.flex){a+=e.flex;return{index:t,flex:e.flex}}return null}).filter("flex").forEach(function(e,t){if(t===0){n=o.countBy(r,o.isUndefined).false;if(n){s-=o.reduce(r,function(e,t){return(e||0)+(t||0)})}}r[e.index]=Math.floor(s/a*e.flex)}).value();return r},getEntriesCount:function(e,t,i){var r=0;o.forEach(o.range(t,i),function(t){r+=e[t]});return Math.max(r,0)},transformStateToLayout:function(e){var t=e.layoutState;if(!t||!Object.keys(t.viewPositions).length){return{layout:[]}}var i=this,r=e.height,n=e.width,a,s=l,f=u,h=o.merge({},p,{cols:Math.round((n||1)/s),rowHeight:f,width:n}),g=t.model,m=t.viewPositions,v=this.getEntriesSpans(g.columns,n,s),y=this.getEntriesSpans(g.rows,r,f);a=o.map(m,function(e,t){return{i:t,x:i.getEntriesCount(v,0,e.col),y:i.getEntriesCount(y,0,e.row),w:i.getEntriesCount(v,e.col,e.col+e.colspan)||1,h:i.getEntriesCount(y,e.row,e.row+e.rowspan)||1,minH:Math.round(d/u),minW:Math.round(c/l)}});return{options:h,layout:a}},updateLayout:function(e){e=e||this.props;this.setState(this.transformStateToLayout(e))},componentWillReceiveProps:function(e){this.updateLayout(e)},componentDidMount:function(){this.updateLayout()},filterChildren:function(){var e,t=this.state.layout;if(this.props.children){e=o.map(t,"i");return this.props.children.reduce(function(i,r){var o=r.props&&r.props.id,a=e.indexOf(o),s;if(o&&a!==-1){s=t[a];i.push(n.DOM.div({key:o,className:"grid-layout-item"},n.cloneElement(r,{height:s.h,width:s.w})))}return i},[])}return this.buildItemsDOM()},buildItemsDOM:function(){var e=this;return o.map(this.state.layout,function(t){return n.DOM.div({key:t.i,className:"grid-layout-item"},n.createElement(r,{id:t.i,parentUniqueId:e.props.uniqueId,modelerApp:e.props.modelerApp,width:t.w,height:t.h}))})},render:function(){var e=o.merge({layout:this.state.layout},this.state.options);return n.DOM.div({key:this.state.uniqueId,className:"grid-layout"},n.createElement(a,e,this.filterChildren()))}});t.exports=f},{"./view":517,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-grid-layout":"react-grid-layout"}],420:[function(e,t,i){"use strict";var r=e("../util");var n=e("lodash");var o=e("react");var a=e("./logout");var s=e("../constant").UserActivity;var l=s.USER_ACTIVITY_STATUS;var u=s.LOCAL_STORAGE_PROPERTY;var c=s.LAST_ACTIVITY_TIMESTAMP;var d=o.createClass({displayName:"IdleLogoutControl",propTypes:{notifyUserAboutLogout:o.PropTypes.func.isRequired,markDataDirty:o.PropTypes.func.isRequired,idleNotificationTime:o.PropTypes.number.isRequired,idleLogoutTime:o.PropTypes.number.isRequired,ignoreBroadcastingTime:o.PropTypes.number.isRequired,hideWhenLoggedOut:o.PropTypes.bool,loggedOutDisplayMessage:o.PropTypes.string,welcomeMessageFn:o.PropTypes.func,onSuccess:o.PropTypes.func,onFailure:o.PropTypes.func,loggedIn:o.PropTypes.bool,displayName:o.PropTypes.string},componentWillMount:function(){if(this.props.notifyUserAboutLogout){window.addEventListener("storage",this.handleUserActivityChanged,false);if(this.props.loggedIn&&!this.state.watchingUserActivity){this.watchUserActivity()}}},componentWillReceiveProps:function(e){var t=e.loggedIn;if(t!==undefined){if(t&&this.props.notifyUserAboutLogout&&!this.state.watchingUserActivity){this.watchUserActivity()}}},getInitialState:function(){return{inactivityTimer:null,ignoreBroadcastingTimer:null,watchingUserActivity:false}},handleUserActivityChanged:function(e){if(e.key===u){if(e.newValue===l.IDLE){this.notifyUserAboutLogout()}else if(e.oldValue===l.IGNORE_BROADCASTING&&e.newValue===l.ACTIVE){this.props.markDataDirty()}}},watchUserActivity:function(){this.setState({inactivityTimer:setTimeout(this.notifyUserAboutLogout,this.props.idleNotificationTime*1e3),ignoreBroadcastingTimer:setTimeout(this.ignoreBroadcasting,this.props.ignoreBroadcastingTime*1e3),watchingUserActivity:true});document.addEventListener("mousemove",this.resetInactivityTimers);document.addEventListener("keypress",this.resetInactivityTimers);document.addEventListener("scroll",this.resetInactivityTimers,true)},stopWatchingUserActivity:function(){document.removeEventListener("mousemove",this.resetInactivityTimers);document.removeEventListener("keypress",this.resetInactivityTimers);document.removeEventListener("scroll",this.resetInactivityTimers,true);this.setState({watchingUserActivity:false})},logoutAfterBeingIdle:function(){clearTimeout(this.state.inactivityTimer);clearTimeout(this.state.ignoreBroadcastingTimer);this.refs.logoutCtrl&&this.refs.logoutCtrl.handleLogout()},resetInactivityTimers:function(){if(localStorage.getItem(u)===l.IGNORE_BROADCASTING){this.props.markDataDirty()}localStorage.setItem(u,l.ACTIVE);localStorage.setItem(c,new Date);clearTimeout(this.state.inactivityTimer);clearTimeout(this.state.ignoreBroadcastingTimer);this.setState({inactivityTimer:setTimeout(this.notifyUserAboutLogout,this.props.idleNotificationTime*1e3),ignoreBroadcastingTimer:setTimeout(this.ignoreBroadcasting,this.props.ignoreBroadcastingTime*1e3)})},ignoreBroadcasting:function(){var e=new Date,t=Date.parse(localStorage.getItem(c));if((e-t)/1e3>=this.props.ignoreBroadcastingTime){if(localStorage.getItem(u)!==l.IGNORE_BROADCASTING){localStorage.setItem(u,l.IGNORE_BROADCASTING)}}},notifyUserAboutLogout:function(){var e=new Date,t=Date.parse(localStorage.getItem(c));if((e-t)/1e3>=this.props.idleNotificationTime){if(localStorage.getItem(u)!==l.IDLE){localStorage.setItem(u,l.IDLE)}this.stopWatchingUserActivity();this.props.notifyUserAboutLogout({logout:this.logoutAfterBeingIdle,markDataDirty:this.props.markDataDirty,watchUserActivity:this.watchUserActivity,idleLogoutTime:this.props.idleLogoutTime})}},componentWillUnmount:function(){window.removeEventListener("storage",this.closeDialog,false);this.stopWatchingUserActivity()},render:function(){var e=n.extend({},this.props,{ref:"logoutCtrl"});return o.createElement(a,e)}});t.exports=d},{"../constant":256,"../util":357,"./logout":427,lodash:70,react:"react"}],421:[function(e,t,i){var r=e("react");var n=r.createClass({displayName:"Image",propTypes:{src:r.PropTypes.string.isRequired,style:r.PropTypes.object},render:function(){return r.DOM.div({},r.DOM.img({src:this.props.src,style:this.props.src}))}});t.exports=n},{react:"react"}],422:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=e("immutable");var a=e("./cssloader");var s=e("../view/gridlayoutview");var l=e("../viewlayout");var u=r.createClass({displayName:"LayoutView",propTypes:{id:r.PropTypes.string.isRequired,uniqueId:r.PropTypes.string.isRequired,modelerApp:r.PropTypes.object.isRequired,config:r.PropTypes.object.isRequired},mixins:[n],componentWillMount:function(){this.$viewLayout=new l(this.props.config);this.onViewStateChanged(this.props.config)},componentWillReceiveProps:function(e){if(!o.is(this.props.config,e.config)){this.onViewStateChanged(e.config)}},onViewStateChanged:function(e){this.$viewLayout.updateLayout(e,false);this.setState({layoutState:this.$viewLayout.getLayoutState()})},render:function(){if(!this.state.layoutState){return r.createElement(a)}return r.createElement(s,{key:"layout-view-"+this.props.uniqueId,layoutState:this.state.layoutState,modelerApp:this.props.modelerApp,uniqueId:this.props.uniqueId,height:this.props.height,width:this.props.width},this.props.children)}});t.exports=u},{"../view/gridlayoutview":419,"../viewlayout":520,"./cssloader":395,immutable:"immutable",react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],423:[function(e,t,i){"use strict";var r=e("react");var n=e("./form/level_creation_form_controller");var o=e("./modalwindow").ModalWindow;var a=r.createClass({displayName:"LevelCreationFormModal",propTypes:{modelerApp:r.PropTypes.object.isRequired,modalTitle:r.PropTypes.string.isRequired,field:r.PropTypes.object.isRequired,onFormSubmit:r.PropTypes.func.isRequired,closeWindow:r.PropTypes.func.isRequired},onFormSubmit:function(e){this.props.closeWindow();this.props.onFormSubmit(e)},render:function(){return r.createElement(o,{visible:true,title:this.props.modalTitle,body:r.createElement(n,{modelerApp:this.props.modelerApp,field:this.props.field,onSubmit:this.onFormSubmit,onCancel:this.props.closeWindow,buttonsClassName:"modal-footer"}),windowClass:"lb-form-modal"})}});t.exports=a},{"./form/level_creation_form_controller":413,"./modalwindow":437,react:"react"}],424:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("./circle_button");var a=n.createClass({displayName:"List",propTypes:{onRemove:n.PropTypes.func.isRequired,items:n.PropTypes.array.isRequired},render:function(){var e=this;var t=this.props.items.map(function(t,i){return n.DOM.div({key:i,className:"lb-list-item"},r.values(t).map(function(e,t){return n.DOM.span({key:t,className:"lb-list-item-field",title:e},e)}),n.createElement(o,{onClick:e.props.onRemove.bind(null,t),buttonClassName:"btn-danger",iconClassName:"fa fa-times",titleAttr:"Remove"}))});return n.DOM.div({className:"lb-list"},t)}});t.exports=a},{"./circle_button":386,lodash:70,react:"react"}],425:[function(e,t,i){"use strict";var r=e("react");var n=r.createClass({displayName:"LoadingPlaceholder",render:function(){return r.DOM.div({className:"loading-placeholder"},r.DOM.div({className:"line"}),r.DOM.div({className:"break"}))}});t.exports=n},{react:"react"}],426:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("lodash");var a=e("classnames");var s=e("../../logicblox.core/network").HttpHelper;var l=new s;var u=e("../util");var c=r.createClass({displayName:"LoginForm",propTypes:{onSuccess:r.PropTypes.func,onFailure:r.PropTypes.func,loginFn:r.PropTypes.func.isRequired},getInitialState:function(){return{loginSuccess:false,loginFailure:false}},handleLogin:function(e){var t=n.findDOMNode(this.refs.userName).value,i=n.findDOMNode(this.refs.password).value,r=this;this.props.loginFn(t,i).then(function(){r.setState({loginSuccess:true,loginFailure:false});o.isFunction(r.props.onSuccess)&&r.props.onSuccess({},t)},function(e){r.setState({loginFailure:true});o.isFunction(r.props.onFailure)&&r.props.onFailure(e)})},handleKeyPress:function(e){if(e.key==="Enter"){this.handleLogin(e)}},render:function(){var e=a({"login-message":true,"alert-danger":true,hidden:!this.state.loginFailure}),t=a({"login-message":true,"alert-success":true,hidden:!this.state.loginSuccess});return r.DOM.div({className:"panel panel-default login-form"},r.DOM.div({className:"panel-body"},r.DOM.form({role:"form",onKeyPress:this.handleKeyPress},r.DOM.div({className:"form-group"},r.DOM.label({htmlFor:"login-username"},"Username"),r.DOM.input({id:"login-username",ref:"userName",placeholder:"username",className:"form-control",type:"text"})),r.DOM.div({className:"form-group"},r.DOM.label({htmlFor:"login-password"},"Password"),r.DOM.input({id:"login-password",ref:"password",placeholder:"password",className:"form-control",type:"password"})),r.DOM.p({className:e},"Invalid login. Try again."),r.DOM.p({className:t},"Succesful login. Redirecting..."),r.DOM.button({ref:"loginBtn",type:"button",className:"btn btn-primary",onClick:this.handleLogin},"Login"))))}});i.LoginForm=c},{"../../logicblox.core/network":220,"../util":357,classnames:6,lodash:70,react:"react","react-dom":"react-dom"}],427:[function(e,t,i){"use strict";var r=e("../util");var n=e("react");var o=e("lodash");var a=e("classnames");var s=e("../../logicblox.core/network").HttpHelper;var l=new s;var u=n.createClass({displayName:"LogoutControl",propTypes:{logoutFn:n.PropTypes.func.isRequired,hideWhenLoggedOut:n.PropTypes.bool,loggedOutDisplayMessage:n.PropTypes.string,welcomeMessageFn:n.PropTypes.func,onSuccess:n.PropTypes.func,onFailure:n.PropTypes.func,loggedIn:n.PropTypes.bool,displayName:n.PropTypes.string},getWelcomeMessage:function(){return this.props.welcomeMessageFn(this.props.displayName)},componentWillReceiveProps:function(e){if(e.loggedIn!==undefined){this.setState({loggedIn:e.loggedIn})}},getDefaultProps:function(){return{hideWhenLoggedOut:false,loggedIn:false,loggedOutDisplayMessage:"Not currently logged in",welcomeMessageFn:function(e){return"Welcome, "+e+"!"},onFailure:r.logError,onSuccess:function(){}}},handleLogout:function(){var e=this;if(this.props.loggedIn){this.props.logoutFn().then(function(){o.isFunction(e.props.onSuccess)&&e.props.onSuccess()},function(){o.isFunction(e.props.onFailure)&&e.props.onFailure()})}},render:function(){var e=a({"logged-out-message":true,hidden:this.props.loggedIn||this.props.hideWhenLoggedOut}),t=a({"logged-in-message":true,hidden:!this.props.loggedIn}),i=a({"logout-link":true,hidden:!this.props.loggedIn});return n.DOM.span({className:"logout"},n.DOM.span({ref:"loggedOutMessage",className:e},this.props.loggedOutDisplayMessage),n.DOM.span({ref:"welcomeMessage",className:t},this.getWelcomeMessage()),n.DOM.span({ref:"logoutLink",className:i,onClick:this.handleLogout},n.DOM.a({ref:"logoutTxt",className:"fa fa-sign-out"})))}});t.exports=u},{"../../logicblox.core/network":220,"../util":357,classnames:6,lodash:70,react:"react"}],428:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-addons-pure-render-mixin");var a=e("../util/eventlistenermixin");var s=e("../constant").ButtonTypes;var l=e("./modalwindow").ModalWindow;var u=e("./panelbutton").PanelButton;var c=e("./countdowntimer");var d=e("../constant").UserActivity.USER_ACTIVITY_STATUS;var p=e("../constant").UserActivity.LOCAL_STORAGE_PROPERTY;var f=n.createClass({displayName:"LogoutNotificationDialog",mixins:[o,a],propTypes:{logout:n.PropTypes.func.isRequired,markDataDirty:n.PropTypes.func.isRequired,watchUserActivity:n.PropTypes.func.isRequired,idleLogoutTime:n.PropTypes.number.isRequired,closeWindow:n.PropTypes.func.isRequired,documentTitle:n.PropTypes.string},setEventListeners:function(){return[{emitter:window,event:"storage",callback:this.closeDialog}]},getDefaultProps:function(){return{documentTitle:document.title}},getInitialState:function(){var e=this.props.documentTitle;return{documentTitleBlinkInterval:setInterval(function(){
if(e===document.title){document.title="Closing session..."}else{document.title=e}},1e3)}},componentWillUnmount:function(){clearInterval(this.state.documentTitleBlinkInterval);document.title=this.props.documentTitle},render:function(){var e=[],t=n.DOM.div(null,n.DOM.span({className:"countdown-timer"}),"Your session is about to expire. Seconds remaining: ",n.createElement(c,{secondsRemaining:this.props.idleLogoutTime,timeOverCallback:this.closeSession}));e.push(n.createElement(u,{key:r.uniqueId("ContinueSession"),type:s.CONTINUE,text:"Reconnect",onClick:this.continueSession}));e.push(n.createElement(u,{key:r.uniqueId("CloseSession"),type:s.CANCEL,text:"Close session",onClick:this.closeSession}));return n.createElement(l,{visible:true,title:"Session expiring",body:t,footer:n.DOM.div(null,e),windowClass:"lb-logout-notification-dialog",preventFromHidingOnBackgroundClick:true})},continueSession:function(){localStorage.setItem(p,d.ACTIVE);this.props.markDataDirty();this.closeDialog()},closeSession:function(){localStorage.setItem(p,d.LOGGED_OUT);this.closeDialog()},closeDialog:function(e){if(r.isUndefined(e)||e.key===p){if(localStorage.getItem(p)===d.ACTIVE){this.props.watchUserActivity()}else{this.props.logout()}this.props.closeWindow()}}});t.exports=f},{"../constant":256,"../util/eventlistenermixin":360,"./countdowntimer":394,"./modalwindow":437,"./panelbutton":454,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],429:[function(e,t,i){"use strict";var r=e("react");var n=e("../store/logstore").LogEvents;var o=e("../util/eventlistenermixin");var a=r.createClass({propTypes:{modelerApp:r.PropTypes.object.isRequired},mixins:[o],onError:function(e){alert(e.message)},setEventListeners:function(){return[{emitter:this.props.modelerApp.getLogStore(),event:n.ERROR,callback:this.onError}]},render:function(){return r.DOM.div()}});t.exports=a},{"../store/logstore":342,"../util/eventlistenermixin":360,react:"react"}],430:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-dom");var a=e("treebrowser");var s=a.view.TreeBrowser;var l=a.view.TreeBrowserNode;var u=e("../multiaxisconfig").FieldTypes;var c=e("./draggableutil");var d=e("../store/measuremodelstore").MeasureModelEvents;var p=e("../util/eventlistenermixin");var f=e("../util");var h=n.createClass({displayName:"MeasureBrowserTreeNode",propTypes:{modelerApp:n.PropTypes.object.isRequired},componentDidMount:function(){this.$draggableUtil=new c;o.findDOMNode(this).addEventListener("mousedown",this.startDrag)},startDrag:function(e){var t=e.target.getBoundingClientRect(),i=this.props.modelerApp,r=i.getDragAndDropActionHandler(),n=i.getFieldStore().getField(this.props.treeNode.nodeObj.id,u.MEASURE),o=this.$draggableUtil.newDraggingField(n,r);o.getBoundingClientRect=function(){return t};if(o){this.$draggableUtil.startDrag(o,e.clientX,e.clientY)}},render:function(){return n.DOM.div({className:"lb-measure-leaf",draggable:true},n.createElement(l,this.props))}});var g=n.createClass({displayName:"MeasureBrowserController",mixins:[p],propTypes:{modelerApp:n.PropTypes.object.isRequired,displayableMeasures:n.PropTypes.array},setEventListeners:function(){return[{emitter:this.props.modelerApp.getMeasureModelStore(),event:d.CHANGED,callback:this.measureModelUpdated}]},getInitialState:function(){var e=this.props.modelerApp.getFieldStore().getFields(u.MEASURE),t=g.getMeasures(e,this.props.displayableMeasures);return{tree:{children:t}}},measureModelUpdated:function(){this.setState(this.getInitialState())},render:function(){var e=this;return n.createElement(s,{tree:this.state.tree,filterable:true,nodeElement:function(t){var i=r.merge({},t,{modelerApp:e.props.modelerApp});return n.createElement(h,i)}})},statics:{getMeasures:function(e,t){var i=g.getSortedMeasures(e),r=g.filterMeasures(t,i);return g.buildMeasureList(r)},getSortedMeasures:function(e){var t=f.getComparator(false);return e.sort(function(e,i){var r=e.fieldLabel||e.id,n=i.fieldLabel||i.id;return t(r,n)})},filterMeasures:function(e,t){if(!e||e.length===0)return t;var i=e.map(function(e){return e.qualifiedName});return t.filter(function(e){return i.indexOf(e.id)>=0})},buildMeasureList:function(e){return e.map(function(e){var t=e.toJS();t.id=t.id;t.label=t.fieldLabel;return t}).toJS()}}});t.exports=g},{"../multiaxisconfig":328,"../store/measuremodelstore":344,"../util":357,"../util/eventlistenermixin":360,"./draggableutil":401,lodash:70,react:"react","react-dom":"react-dom",treebrowser:202}],431:[function(e,t,i){"use strict";var r=e("./navlist");var n=e("./navitem");var o=e("./slider").InputSlider;var a=e("./loadingplaceholder");var s=e("./okcancelbuttons");var l=e("./pane").Pane;var u=e("lodash");var c=e("../constant");var d=c.Labels.MeasureFilterWindow;var p=e("react");var f="range";var h="min";var g="max";var m=p.createClass({displayName:"MeasureFilterWindow",propTypes:{measureName:p.PropTypes.string.isRequired,displayName:p.PropTypes.string,onClose:p.PropTypes.func.isRequired,onApply:p.PropTypes.func.isRequired,headerFilters:p.PropTypes.object,isLoading:p.PropTypes.bool.isRequired,isDisabled:p.PropTypes.bool.isRequired,formatFn:p.PropTypes.func,unformatFn:p.PropTypes.func,max:p.PropTypes.oneOfType([p.PropTypes.string,p.PropTypes.number]),min:p.PropTypes.oneOfType([p.PropTypes.string,p.PropTypes.number])},navs:[{title:d.NAV_RANGE_TITLE,type:f},{title:d.NAV_AT_MOST_TITLE,type:g},{title:d.NAV_AT_LEAST_TITLE,type:h}],getInitialState:function(){return this.getChangedStates(this.props)},componentWillReceiveProps:function(e){this.setState(this.getChangedStates(e))},getChangedStates:function(e){var t="range",i=e.min,r=e.max;if(e.headerFilters){if(e.headerFilters.max!==undefined&&e.headerFilters.min===undefined){t="max";r=e.headerFilters.max}else if(e.headerFilters.min!==undefined&&e.headerFilters.max===undefined){t="min";i=e.headerFilters.min}else if(e.headerFilters.min!==undefined&&e.headerFilters.max!==undefined){t="range";i=e.headerFilters.min;r=e.headerFilters.max}}return{type:t,disabled:false,selectedMin:i,selectedMax:r}},getInitialInclusive:function(){return u.isUndefined(this.props.headerFilters)?true:this.props.headerFilters.inclusive},getSelectedMax:function(){var e,t=this.state.selectedMax,i=this.props.max,r=this.props.min,n=this.props.headerFilters||{};if(u.isNumber(t)){e=t<i&&t>r?t:i}else{e=u.isNumber(n.max)?n.max:i}return e},getSelectedMin:function(){var e,t=this.state.selectedMin,i=this.props.max,r=this.props.min,n=this.props.headerFilters||{};if(u.isNumber(t)){e=t>r&&t<i?t:r}else{e=u.isNumber(n.min)?n.min:r}return e},getSelectedInclusive:function(){if(!u.isUndefined(this.state.inclusive)){return this.state.inclusive}else{return this.getInitialInclusive()}},handleNavSelection:function(e){var t;switch(e){case f:t={type:f};break;case h:t={type:h,selectedMax:this.props.max};break;case g:t={type:g,selectedMin:this.props.min};break}this.setState(t)},handleInclusiveChange:function(e){this.setState({inclusive:e.target.checked})},handleApply:function(){if(!this.refs.inputSlider||this.props.isDisabled)return;var e={name:this.props.measureName,displayName:this.props.displayName,inclusive:this.getSelectedInclusive(),isMeasure:true};switch(this.state.type){case"range":if(this.getSelectedMax()!==this.props.max){e.max=this.getSelectedMax()}if(this.getSelectedMin()!==this.props.min){e.min=this.getSelectedMin()}break;case"min":e.min=this.getSelectedMin();break;case"max":e.max=this.getSelectedMax();break}this.props.onApply(e)},handleClose:function(){this.props.onClose()},onValidityChange:function(e){this.setState({disabled:!e.isValid})},onValidMinChange:function(e){this.setState({selectedMin:e})},onValidMaxChange:function(e){this.setState({selectedMax:e})},render:function(){var e=this.props.max,t=this.props.min,i=this.props.displayName||this.props.measureName,u,c={disabled:this.props.isDisabled||this.state.disabled};if(!this.props.isLoading){u=p.DOM.div({className:"filter-content",ref:"measureFilterWindowContent"},p.createElement(r,{ref:"navList",onSelect:this.handleNavSelection,activeItemKey:this.state.type,isVertical:true},this.navs.map(function(e){return p.createElement(n,{key:e.type,itemKey:e.type,title:e.title})})),p.createElement(o,{ref:"inputSlider",type:this.state.type,formatFn:this.props.formatFn,isDisabled:this.props.isDisabled,min:t,max:e,selectedMax:this.getSelectedMax(),selectedMin:this.getSelectedMin(),onValidMinChange:this.onValidMinChange,onValidMaxChange:this.onValidMaxChange,onValidityChange:this.onValidityChange}),p.DOM.div({className:"checkbox"},p.DOM.label({value:"inclusive"},p.DOM.input({type:"checkbox",ref:"inclusiveCheckbox",checked:this.getSelectedInclusive(),onChange:this.handleInclusiveChange}),"inclusive")))}else{u=p.createElement(a)}return p.createElement(l,{title:"Filter: "+i,content:p.DOM.div({className:"filter-window"},u),footer:p.createElement(s,{ref:"btnGroup",onOk:this.handleApply,onCancel:this.handleClose,okClassSet:c})})}});t.exports=m},{"../constant":256,"./loadingplaceholder":425,"./navitem":446,"./navlist":447,"./okcancelbuttons":448,"./pane":453,"./slider":500,lodash:70,react:"react"}],432:[function(e,t,i){"use strict";var r=e("./measurefilterwindow");var n=e("../store/multiaxisdatastore").MultiAxisDataEvents;var o=e("../util/eventlistenermixin");var a=e("lodash");var s=e("../querygen/serialize-mqg");var l=e("../util").shouldReflectDataChange;var u=e("immutable");var c=e("../pivotconfig_helper");var d=e("./pivot/config_helper");var p=e("../multiaxisconfig");var f=e("../multiaxis/querygen").QueryGenerator;var h=e("../querygen/query");var g=e("../multiaxis/queryutil");var m=e("../multiaxis/validity");var v=e("../multiaxis/modelutility");var y=e("react");var b="main";var w={X:{start:0,length:2}};var C=y.createClass({displayName:"MeasureFilterWindowController",propTypes:{modelerApp:y.PropTypes.object.isRequired,config:y.PropTypes.object.isRequired,sheetId:y.PropTypes.string.isRequired,sheetConfig:y.PropTypes.object.isRequired,modelerState:y.PropTypes.object.isRequired,pivotState:y.PropTypes.object.isRequired,updatePivotState:y.PropTypes.func.isRequired},mixins:[o],setEventListeners:function(){return[{emitter:this.props.modelerApp.getMultiAxisDataStore(),event:n.DATA_CHANGED,callback:this.onDataChanged}]},shouldReflectDataChange:function(e){return e&&l(e,[{viewId:this.getViewId(),tasks:[b]}])},onDataChanged:function(e){if(!this.shouldReflectDataChange(e.viewTasks)){return}this.loadMaxMin()},getInitialState:function(){return{min:undefined,max:undefined,maConfig:undefined,pivotMAConfig:undefined}},componentWillMount:function(){this.setMAConfigState(this.props.sheetConfig)},componentWillUnmount:function(){this.props.modelerApp.getMultiAxisConfigActionHandler().setViewTaskInactive(this.getViewId(),"main")},componentWillReceiveProps:function(e){var t=this.getMetricName(),i=e.pivotState,r=d.findAxisForField(i,d.getVisibleMeasures(i).id);if(u.is(e.sheetConfig,this.props.sheetConfig)){return}if(!d.findField(i,t)||r&&d.findAxisForField(i,t)!==r){this.props.closeComponentFn(this.props.id)}else{this.setMAConfigState(e.sheetConfig)}},setMAConfigState:function(e){var t=this.createPivotMAConfig(e),i=this.getMAConfig(t),r=this.getViewId(),n=this.props.modelerApp.getMultiAxisConfigActionHandler(),o=this.props.modelerApp.getMultiAxisDataActionHandler();this.setState({pivotMAConfig:t,maConfig:i});if(i){return n.setViewTaskConfig(r,b,{maConfig:i}).then(function(){return o.setViewTaskRange(r,b,w)})}else{this.setState({isLoading:false})}},createPivotMAConfig:function(e){return c.pivotConfigToMultiAxisConfig(this.props.modelerState,this.props.sheetId,e.toJS().pivotConfig)},getViewId:function(){return this.props.sheetId+"-metric-filter-for-"+this.getMetricName()},getMetricName:function(){return this.props.config.get("measureName")},getMAConfig:function(e){var t=this.props.modelerState.measureModel,i=this.getMetricName(),r=E(e,i),n=S(e,r),o=m.checkIntersectionQueryValidity(n,p.getBaseLevelFields(e).toJS(),[],new v(t)),a=o.length===0;if(!a){return}var l=x(n,t),c=T(n,t),d="min S @ inter",f="max S @ inter",h=new p.MeasureField({id:"Min",fieldLabel:"Min "+r.fieldLabel,data:new u.List([n.setIn(["measure"],p.mkMeasure({application:{signature:{intersection:new u.List,type:l},interArgs:[{name:"inter",intersection:new u.List}],exprArgs:[{name:"S",exprStr:s(c)}],abstraction:{interArgs:[{name:"inter"}],exprArgs:[{name:"S"}],bodyStr:d}}}))])}),g=new p.MeasureField({id:"Max",fieldLabel:"Max "+r.fieldLabel,data:h.data.setIn(["0","measure","application","abstraction","bodyStr"],f)}),y=p.generateDefaultHeaderConfig(new p.MAConfig({id:"MeasureFilterWindow: "+this.getViewId(),axis:new u.Map({X:new u.List([h,g])}),sliceConfigs:this.props.pivotState.getIn(["axis","Z"])}));return y},getFormatFn:function(){if(!this.state.maConfig)return;var e=this.props.modelerState.measureModel,t=this.state.pivotMAConfig,i=E(t,this.getMetricName()),r=S(t,i),n=new f(e).calcFormatterForDataCfg(r);return n&&n.format},loadMaxMin:function(){if(!this.state.maConfig){this.setState({min:undefined,max:undefined});return}var e=this.props.modelerApp,t=e.getMultiAxisDataStore().getDataRange(this.getViewId(),b,w),i=t&&t.dataArray,r,n,o,s,l={};if(!i)return;r=i[0].queryResults.value.value;n=i[1].queryResults.value.value;o=a.isUndefined(r)||r.rawValue.length===0?undefined:r.rawValue[0][0];s=a.isUndefined(n)||n.rawValue.length===0?undefined:n.rawValue[0][0];if(!a.isUndefined(o)){l.min=parseFloat(o)}if(!a.isUndefined(s)){l.max=parseFloat(s)}this.setState(l)},onApply:function(e){var t=this.getMetricName(),i=d.setMeasureFilter(this.props.pivotState,t,e||null);this.props.updatePivotState(i)},onClose:function(){this.props.closeComponentFn(this.props.id)},isLoading:function(){var e=this.props.modelerApp.getMultiAxisDataStore();if(this.state.maConfig){var t=e.getHeadingData(this.getViewId(),b);if(!t||t.hasLoadingHeadings()){return true}return e.hasOutstandingRequestsForViewTask(this.getViewId(),b)||!e.hasCleanData(this.getViewId(),b,w)}return false},render:function(){var e=this.state.maConfig,t=this.state.pivotMAConfig,i=this.getMetricName(),n=E(t,i),o=d.findMetricFilter(this.props.pivotState,i),s=this.getFormatFn(),l=n.fieldLabel,u=this.state.min,c=this.state.max,p=this.isLoading(),f=!e||!p&&a.isUndefined(u)&&a.isUndefined(c);return y.createElement(r,{measureName:i,displayName:l,isDisabled:f,isLoading:p,min:u,max:c,headerFilters:o&&o.toJS(),onApply:this.onApply,onClose:this.onClose,formatFn:s})}});function E(e,t){var i=d.getAxisFields(e,function(e){return e instanceof p.MeasureField&&e.id===t}).first();if(!i){i=c.getVisibleMeasureFields(e).find(function(e){return e.id===t})}return i}function S(e,t){var i=d.findAxisForMeasureField(e,t.id),r=i?p.removeLevelsFromAxis(e,i):e,n=p.getBaseLevelFields(r).toSet();return t.dataPerFieldSet.get(n).find(function(e){return e.name==="value"})}function T(e,t){var i=g.generateAggMethodLookupForMeasure(e.measure,{},t),r=p.intersectionToMQGIntersection(e.measure.metric.intersection),n=h.createMetricExpr(e.measure.metric,r,e.measure.labelMap.toJS(),i,t);return n}function x(e,t){var i=p.getMeasureValueType(e.measure,t);return{kind:"SINGLETON",type:{kind:i}}}t.exports=C},{"../multiaxis/modelutility":321,"../multiaxis/querygen":323,"../multiaxis/queryutil":324,"../multiaxis/validity":326,"../multiaxisconfig":328,"../pivotconfig_helper":330,"../querygen/query":333,"../querygen/serialize-mqg":335,"../store/multiaxisdatastore":348,"../util":357,"../util/eventlistenermixin":360,"./measurefilterwindow":431,"./pivot/config_helper":455,immutable:"immutable",lodash:70,react:"react"}],433:[function(e,t,i){"use strict";var r=e("lodash");var n=e("immutable");var o=e("react");var a=o.DOM;var s=e("../util/eventlistenermixin");var l=e("../store/measurelanguagestore").Events;var u=e("../constant").ViewConfig.EVENTS;var c=e("./ruleeditor");var d=e("../../logicblox.pivot/util");var p=e("./pivot/config_helper");var f=o.createClass({displayName:"MeasureLanguageEditor",propTypes:{onAddRuleEditor:o.PropTypes.func},getDefaultProps:function(){return{ruleEditors:[]}},render:function(){return a.div({className:"pane panel formulaeditor-container"},a.div({className:"formula-editor-title"},a.span({className:"formula-icon"}),a.i({className:"fa fa-plus-circle",onClick:this.props.onAddRuleEditor}),a.div({className:"rules"},this.props.children)))}});var h={addRuleEditor:function(e,t){var i=t.ruleEditors||[];i.splice(0,0,{editorId:e(),ruleId:null});return{ruleEditors:i}},removeRuleEditor:function(e,t){var i=t.ruleEditors;i.splice(i.findIndex(function(t){return t.editorId===e}),1);return{ruleEditors:i}},getRuleEditors:function(e,t,i,n){return function(o){var a=o.ruleEditors||[],s=[];a.forEach(function(e){var i=t(e.editorId),r=i&&i.get("formula");if(!r){s.push(e)}});e.forEach(function(e){var t=i(e),r=t?t.get("editorId"):n();s.push({editorId:r,ruleId:e})});s=r.sortBy(s,function(t){return e.indexOf(t.ruleId)});return{ruleEditors:s}}}};var g=o.createClass({displayName:"MeasureLanguageEditorController",propTypes:{modelerApp:o.PropTypes.object.isRequired,sheetId:o.PropTypes.string.isRequired,uuid:o.PropTypes.func},mixins:[s],setEventListeners:function(){var e=this.props.sheetId,t=this.props.modelerApp;return[{emitter:t.getMeasureLanguageStore(),event:l.CHANGE,callback:this.onMeasureLanguageChange},{emitter:t.getViewConfigStore(),emitterId:e,event:u.STATE_CHANGED,callback:this.onPivotChange}]},getInitialState:function(){return{ruleEditors:[]}},componentWillMount:function(){this.setState(this.getRuleEditors())},onMeasureLanguageChange:function(){this.setState(this.getRuleEditors())},onPivotChange:function(){this.setState(this.getRuleEditors())},onAddRuleEditor:function(){this.setState(h.addRuleEditor.bind(this,d.uuid))},onRemoveRuleEditor:function(e){this.setState(h.removeRuleEditor.bind(this,e))},getRuleEditors:function(){var e=this.props.sheetId,t=this.props.modelerApp,i=t.getMeasureLanguageStore(),r=m.getVisibleRules(t,e),n=i.getEditorForMetric.bind(i),o=i.getRuleEditor.bind(i);return h.getRuleEditors(r,o,n,d.uuid)},buildRuleEditor:function(e,t){var i=this.props.modelerApp,r=this.props.sheetId,n=t.ruleId,a=i.getMeasureLanguageStore(),s=t.editorId,l=a.getRuleEditor(s),u=l&&l.toJS()||{},d={editorId:u.editorId,formula:u.formula,value:u.value,isEditing:u.isEditing,allowEditing:u.allowEditing},p=u.inverseEditors||[];return o.createElement(c,{key:t.editorId,primaryEditor:d,inverseEditors:p,error:u.error,metricCompletions:e,addMetricToPivot:m.addMetricToPivot.bind(this,i,r),getMetric:m.getMetric.bind(this,i),enterEditMode:m.enterEditMode.bind(this,i),submitRule:m.submitRule.bind(this,i,s,r),addInverseFormulaEditor:m.addInverseFormulaEditor.bind(this,i,s),editFormula:m.editFormula.bind(this,i,s),onEditorEsc:m.onEditorEsc.bind(this,i,n,s),addRuleEditor:m.addRuleEditor.bind(this,i,s,n)})},render:function(){var e=this.props.modelerApp,t=m.getMetricCompletions(e),i=this.state.ruleEditors.map(this.buildRuleEditor.bind(this,t));return o.createElement(f,{onAddRuleEditor:this.onAddRuleEditor},i)},statics:{StateHelper:h}});var m={hasRule:function(e,t){var i=e.getMeasureLanguageStore();return i.hasRule(t)},updateNewPivotConfig:function(e,t,i){e.getModelerActionHandler().saveSheetIfChanged(t,p.getConfig(i),Promise.resolve())},getVisibleRules:function(e,t){var i=e.getViewConfigStore().getViewState(t),o=i.get("pivotConfig",n.Map()),a=o.getIn(["axis","z"],n.List());return a.map(function(e){if(r.isString(e))return e;else return e.qualifiedName}).filter(function(t){return m.hasRule(e,t)})},addMetricToPivot:function(e,t,i){var r=this.getVisibleRules(e,t),n=r.indexOf(i)>-1;if(!n){var o=modstate.createModelerState(e),a=e.getViewConfigStore().getViewState(t),s=p.pivotStateFromPivotConfig(o,t,a.pivotConfig,a.gridOptions),l=modstate.fields.getFieldFromQualifiedName(o.fields,i),u=p.addMeasureToGroup(s,s.measureGroups.get("-:Measures"),l);return this.updateNewPivotConfig(e,t,u)}},getMetric:function(e,t){var i=e.getMeasureModelStore(),r=i.getModel(),n=r.getMeasureInfo(t);return n},enterEditMode:function(e,t,i){var r=e.getMeasureLanguageActionHandler();r.enterEditMode(t,i)},submitRule:function(e,t,i){var r=e.getModelerActionHandler(),n=e.getMeasureLanguageStore(),o=n.getLatestPrimaryFormula(t),a=n.getLatestInverseFormulas(t);r.installMeasureRule(i,t,o,a)},addInverseFormulaEditor:function(e,t){var i=e.getMeasureLanguageActionHandler();i.addInverseEditor(t)},editFormula:function(e,t,i,r){var n=e.getMeasureLanguageActionHandler();if(t===i){n.editPrimaryFormula(t,r)}else{n.editInverseFormula(t,i,r)}},onEditorEsc:function(e,t,i,r){var n=e.getMeasureLanguageActionHandler(),o=e.getMeasureLanguageStore();if(!t){this.onRemoveRuleEditor(i)}else{if(o.hasFormula(i,r)){n.clearInverseFormulaEdits(i,r)}else{n.removeInverseEditor(i,r)}}},addRuleEditor:function(e,t,i){var r=e.getMeasureLanguageActionHandler();r.addRuleEditor(t,i)},getMetricCompletions:function(e){var t=e.getMeasureModelStore(),i=t.getModel(),r=i&&i.getMetrics().map(function(e){return{name:e.get("name"),value:e.get("name")}});return r.toJS()}};i.MeasureLanguageEditorController=g;i.MeasureLanguageEditor=f},{"../../logicblox.pivot/util":357,"../constant":256,"../store/measurelanguagestore":343,"../util/eventlistenermixin":360,"./pivot/config_helper":455,"./ruleeditor":485,immutable:"immutable",lodash:70,react:"react"}],434:[function(e,t,i){"use strict";var r=e("react");var n=r.DOM;var o=e("../cubiql");var a=e("../util");var s=e("../util/eventlistenermixin");var l=e("./okcancelbuttons");var u=e("./pane").Pane;var c=e("./field").Field;var d=e("../multiaxisconfig").FieldTypes;var p=e("../store/measuremodelstore").MeasureModelEvents;var f=o.noneAgg,h=o.noneUpd;var g=r.createClass({propTypes:{measureInfo:r.PropTypes.object.isRequired,onApply:r.PropTypes.func.isRequired,onClose:r.PropTypes.func.isRequired},getInitialState:function(){return{changed:false,aggMethod:y(this.props.measureInfo),newAggMethod:y(this.props.measureInfo)}},render:function(){var e=this.props.measureInfo.caption||this.props.measureInfo.name;return r.createElement(u,{title:"Properties: "+e,content:r.createElement(v,{ref:"measureForm",aggMethod:this.state.newAggMethod,measureInfo:this.props.measureInfo,onAggChange:this.handleAggChange}),footer:r.createElement(l,{ref:"btnGroup",onCancel:this.onClose,okClassSet:{disabled:this.state.aggMethod===this.state.newAggMethod}})})},handleAggChange:function(e){var t=e.target.value;this.setState({newAggMethod:t})},onApply:function(){var e=this._pendingState?this._pendingState.newAggMethod:this.state.newAggMethod;this.props.onApply(this.state.aggMethod,e)},onClose:function(){this.props.onClose()}});var m=r.createClass({propTypes:{content:r.PropTypes.element.isRequired,label:r.PropTypes.string.isRequired},render:function(){return n.div({className:"form-group measurewindow-group"},n.label({className:"control-label"},this.props.label+":"),n.div(null,this.props.content))}});var v=r.createClass({propTypes:{aggMethod:r.PropTypes.string.isRequired,measureInfo:r.PropTypes.object.isRequired,onAggChange:r.PropTypes.func.isRequired},valueMenuModel:[{id:"BOOLEAN",text:"BOOLEAN"},{id:"DECIMAL",text:"DECIMAL"},{id:"FLOAT",text:"FLOAT"},{id:"INT",text:"INT"},{id:"STRING",text:"STRING"}],aggMenuModel:[{id:f,text:f},{id:"AMBIG",text:"AMBIG"},{id:"AVERAGE",text:"AVERAGE"},{id:"COLLECT",text:"COLLECT"},{id:"COMPOSITE",text:"COMPOSITE COMPONENT"},{id:"COUNT",text:"COUNT"},{id:"COUNT_DISTINCT",text:"COUNT DISTINCT"},{id:"HEADER_SORT_LEVEL",text:"QUALIFIED LEVEL"},{id:"HISTOGRAM",text:"HISTOGRAM"},{id:"KEY_SORT",text:"KEY SORT"},{id:"MAX",text:"MAX"},{id:"MIN",text:"MIN"},{id:"MODE",text:"MODE"},{id:"NAMED",text:"NAMED"},{id:"RECALC",text:"RECALC"},{id:"SORT",text:"SORT"},{id:"TOTAL",text:"TOTAL"}],spreadMenuModel:[{id:h,text:h},{id:"BY_METRIC",text:"BY METRIC"},{id:"DELTA",text:"DELTA"},{id:"EVEN",text:"EVEN"},{id:"EVEN_FLOAT",text:"EVEN FLOAT"},{id:"COMPOSITE",text:"COMPOSITE COMPONENT"},{id:"NAMED",text:"NAMED"},{id:"QUERY",text:"QUERY"},{id:"RATIO",text:"RATIO"},{id:"RATIO_FLOAT",text:"RATIO FLOAT"},{id:"RECALC",text:"RECALC"},{id:"REPLICATE",text:"REPLICATE"}],renderOptions:function(e){a.type.assertArgs(arguments,[Array,a.type.or("string","undefined")]);return e.map(function(e){return n.option({key:e.id,value:e.text},e.text)})},render:function(){var e=this,t=e.props.measureInfo,i=t.inter.qualified_level||[],a=t.type&&t.type.kind;return n.form({className:"measurewindow-form",role:"form"},r.createElement(m,{label:"Label",content:n.input({value:t.caption||t.name,className:"input-sm form-control",disabled:true})}),r.createElement(m,{label:"Keys",content:n.div({className:"form-control headings measurewindow-keys"},i.map(function(e){return r.createElement(c,{key:"key-"+e.label+":"+e.dimension+":"+e.level,title:o.qualifiedName(e.dimension,e.level),isDraggable:false,label:e.level,type:d.LEVEL})}))}),r.createElement(m,{label:"Value",content:n.select({className:"input-sm form-control foobar",disabled:true,value:a},e.renderOptions(e.valueMenuModel))}),r.createElement(m,{label:"Default Aggregation",content:n.select({ref:"aggSelect",className:"input-sm form-control",value:e.props.aggMethod,onChange:e.props.onAggChange,disabled:true},e.renderOptions(e.aggMenuModel))}),r.createElement(m,{label:"Default Spreading",content:n.select({className:"input-sm form-control",disabled:true,value:b(e.props.measureInfo)},e.renderOptions(e.spreadMenuModel))}))}});function y(e){if(e.recalc&&!e.agg_method){return"RECALC"}else if(e.agg_method){if(e.agg_method.composite){return"COMPOSITE"}else if(e.agg_method.header_sort_level){return"HEADER_SORT_LEVEL"}else if(e.agg_method.named){return"NAMED"}else{return e.agg_method.primitive||f}}throw new Error("Unsupported aggregation type.")}function b(e){if(e.recalc){return"RECALC"}else if(e.update_method){if(e.update_method.by_metric){return"BY_METRIC"}else if(e.update_method.composite){return"COMPOSITE"}else if(e.update_method.named){return"NAMED"}else if(e.update_method.query){return"QUERY"}else{return e.update_method.primitive||h}}throw new Error("Unsupported spread type.")}var w=r.createClass({propTypes:{sheetId:r.PropTypes.string.isRequired,closeComponentFn:r.PropTypes.func.isRequired,id:r.PropTypes.string.isRequired,modelerApp:r.PropTypes.object.isRequired,config:r.PropTypes.object.isRequired},mixins:[s],getInitialState:function(){var e=this.props.modelerApp.getMeasureModelStore().getModel(),t=this.props.config.get("measureName"),i;if(e){i=e.getMeasureInfo(t)}return{measureInfo:i}},setEventListeners:function(){var e=this.props.modelerApp;return[{emitter:e.getMeasureModelStore(),event:p.CHANGED,callback:this.$setMeasureInfo}]},$setMeasureInfo:function(){this.setState(this.getInitialState())},onApply:function(e,t){var i=this.props.modelerApp,r=i.getMeasureModelActionHandler(),n=this.state.measureInfo;if(n){r.setMeasureProperties(n.name,e,t)}},onClose:function(){this.props.closeComponentFn(this.props.id)},render:function(){if(this.state.measureInfo){return r.createElement(g,{ref:"view",measureInfo:this.state.measureInfo,onApply:this.onApply,onClose:this.onClose})}return null}});i.MeasureWindowView=g;i.MeasureWindowForm=v;i.MeasureWindowController=w;i.$renderAggMethod=y;i.$renderSpreadMethod=b},{"../cubiql":276,"../multiaxisconfig":328,"../store/measuremodelstore":344,"../util":357,"../util/eventlistenermixin":360,"./field":405,"./okcancelbuttons":448,"./pane":453,react:"react"}],435:[function(e,t,i){"use strict";var r=e("react");var n=r.createClass({displayName:"MetricLink",propTypes:{metricName:r.PropTypes.string.isRequired,metricCaption:r.PropTypes.string,showName:r.PropTypes.bool,onClick:r.PropTypes.func},onClick:function(e){var t=this.props.metricName;if(this.props.onClick){this.props.onClick(t);e.stopPropagation()}else{console.warn("onClick property for MetricLink not defined")}},render:function(){var e=this.props.metricName,t=this.props.metricCaption,i=this.props.showName;return r.DOM.a({onClick:this.onClick,style:{cursor:"pointer"},title:i&&t},!i&&t?t:e)}});t.exports=n},{react:"react"}],436:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("classnames");var a=r.createClass({displayName:"ModalDialog",propTypes:{onHide:r.PropTypes.func,visible:r.PropTypes.bool.isRequired,width:r.PropTypes.string,extraClasses:r.PropTypes.string,dialogWindow:r.PropTypes.element.isRequired,preventFromHidingOnBackgroundClick:r.PropTypes.bool},componentWillReceiveProps:function(e){if(e.visible!==undefined){this.setState(e)}},getInitialState:function(){return{visible:this.props.visible||false}},onBackgroundClick:function(e){if(!this.props.preventFromHidingOnBackgroundClick&&e.target===n.findDOMNode(this.refs.background)){this.setState({visible:false});if(this.props.onHide){this.props.onHide(e)}}},render:function(){var e=o({modal:true,show:this.state.visible}),t="modal-dialog ";if(this.props.extraClasses!==undefined)t+=this.props.extraClasses;return r.DOM.div({className:e,ref:"background",onClick:this.onBackgroundClick},r.DOM.div({className:t,style:{width:this.props.width}},this.props.dialogWindow))}});i.ModalDialog=a},{classnames:6,react:"react","react-dom":"react-dom"}],437:[function(e,t,i){"use strict";var r=e("react");var n=e("./modaldialog").ModalDialog;var o=e("classnames");var a=r.createClass({displayName:"ModalWindow",propTypes:{body:r.PropTypes.element.isRequired,footer:r.PropTypes.element,onHide:r.PropTypes.func,title:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.element]),visible:r.PropTypes.bool.isRequired,width:r.PropTypes.string,windowClass:r.PropTypes.string,preventFromHidingOnBackgroundClick:r.PropTypes.bool},render:function(){var e=o({"modal-header":true}),t,i,a;if(this.props.title!==undefined){i=r.DOM.div({className:e,key:"title"},r.DOM.h4({className:"modal-title"},this.props.title))}if(this.props.footer!==undefined){a=r.DOM.div({className:"modal-footer",key:"footer"},this.props.footer)}t=r.DOM.div({className:"modal-content"},i,r.DOM.div({className:"modal-body",key:"body"},this.props.body),a);return r.createElement(n,{onHide:this.props.onHide,visible:this.props.visible,dialogWindow:t,extraClasses:this.props.windowClass,width:this.props.width,preventFromHidingOnBackgroundClick:this.props.preventFromHidingOnBackgroundClick})}});i.ModalWindow=a},{"./modaldialog":436,classnames:6,react:"react"}],438:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.PropTypes;var a=e("../constant").CHANGE_EVENT;var s=e("../modalwindowviews");var l=e("../util/eventlistenermixin");var u=n.createClass({displayName:"ModalWindowWrapper",propTypes:{modelerApp:o.object.isRequired,index:o.number.isRequired,id:o.string.isRequired,type:o.string.isRequired,options:o.object},getDefaultProps:function(){return{options:{}}},render:function(){var e=this.props.index*10;return n.DOM.div({className:"lb-modal-window-wrapper",style:{zIndex:e}},this.renderModalWindow())},closeWindow:function(){if(r.isFunction(this.props.options.onClose)){this.props.options.onClose(arguments)}return this.props.modelerApp.getModalWindowsActionHandler().closeWindow(this.props.type,this.props.id)},renderModalWindow:function(){var e={modelerApp:this.props.modelerApp,closeWindow:this.closeWindow};return n.createElement(s[this.props.type],r.extend(e,this.props.options))}});var c=n.createClass({displayName:"ModalWindowsController",mixins:[l],setEventListeners:function(){return[{emitter:this.props.modelerApp.getModalWindowsStore(),event:a,callback:this.onChange}]},getInitialState:function(){return this.props.modelerApp.getModalWindowsStore().getModalWindows()},render:function(){var e=this,t=e.state.views,i=[],o,a;for(a in t){if(t.hasOwnProperty(a))i.push(t[a])}i=r.flatten(i);i=r.sortBy(i,"index");o=r.map(i,function(t){t.key=t.id;t.modelerApp=e.props.modelerApp;return n.createElement(u,t)});return n.DOM.div({className:"lb-modal-windows"},o)},onChange:function(){this.setState(this.getInitialState())}});t.exports=c},{"../constant":256,"../modalwindowviews":310,"../util/eventlistenermixin":360,lodash:70,react:"react"}],
439:[function(e,t,i){"use strict";var r=e("react");var n=e("immutable");var o=e("./navlist");var a=e("./navitem");var s=e("./measurebrowsercontroller");var l=e("./dimensionbrowsercontroller");var u=r.createClass({displayName:"ModelBrowser",propTypes:{modelerApp:r.PropTypes.object.isRequired,config:r.PropTypes.object.isRequired,id:r.PropTypes.string.isRequired,uniqueId:r.PropTypes.string.isRequired,sheetId:r.PropTypes.string.isRequired,sheetUniqueId:r.PropTypes.string.isRequired,sheetConfig:r.PropTypes.object.isRequired},getDisplayableMeasures:function(){return this.props.config&&this.props.config.getIn(["config","displayableMeasures"],n.List()).toJS()},render:function(){return r.createElement(o,{initialIndex:1,isJustified:true},r.createElement(a,{title:"Measures"},r.createElement(s,{modelerApp:this.props.modelerApp,displayableMeasures:this.getDisplayableMeasures()})),r.createElement(a,{title:"Dimensions"},r.createElement(l,{modelerApp:this.props.modelerApp})))}});t.exports=u},{"./dimensionbrowsercontroller":397,"./measurebrowsercontroller":430,"./navitem":446,"./navlist":447,immutable:"immutable",react:"react"}],440:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("./navbar");var a=e("./navigationoption");var s=e("./reviewlocksoption");var l=e("./userlistcontroller");var u=e("./actionbutton").ActionButtonController;var c=e("./idlelogout");var d=e("./fullstorybutton");var p=r.createClass({displayName:"ModelerNavBar",propTypes:{userDisplayName:r.PropTypes.string,modelerApp:r.PropTypes.object.isRequired,brandImg:r.PropTypes.object.isRequired,brandHref:r.PropTypes.string,actionButtons:r.PropTypes.array,fullStory:r.PropTypes.shape({startByDefault:r.PropTypes.bool,organizationKey:r.PropTypes.string})},renderNavBar:function(e){return r.createElement(o,{brandImg:this.props.brandImg,brandHref:this.props.brandHref},e)},render:function(){if(!this.props.userDisplayName){return this.renderNavBar()}var e=this,t,i=[],o,p=!!this.props.userDisplayName,f=this.props.modelerApp,h=f.getMultiAxisDataActionHandler(),g=this.props.fullStory,m=this.props.userDisplayName,v=f.getModelerOptionStore(),y=f.getModelerActionHandler(),b=f.getUserActionHandler();t=r.createElement(c,{logoutFn:b.unauthenticate.bind(b),notifyUserAboutLogout:y.notifyUserAboutLogout.bind(y),markDataDirty:h.markAllDataDirty.bind(h),idleNotificationTime:v.getIdleNotificationTime(),idleLogoutTime:v.getIdleLogoutTime(),ignoreBroadcastingTime:v.getIgnoreBroadcastingTime(),hideWhenLoggedOut:false,loggedOutDisplayMessage:"Not signed in",welcomeMessageFn:function(e){return"Hi, "+e+"!"},onSuccess:function(){e.props.modelerApp.getModelerWebSocket().close();n.isFunction(e.props.sendToLogin)&&e.props.sendToLogin()},loggedIn:!!this.props.userDisplayName,displayName:this.props.userDisplayName});if(this.props.actionButtons){i=this.props.actionButtons.map(function(e){e.modelerApp=f;e.key=e.actionId;return r.createElement(u,e)})}o=[].concat(i).concat([g&&g.enabled&&r.createElement(d,{key:"full-story",isActive:g.startByDefault,organizationKey:g.organizationKey,userName:m}),r.DOM.span({key:"nav-locks",className:"navbar-text"},r.createElement(s,{modelerApp:f})),r.DOM.span({key:"nav-option",className:"navbar-text"},r.createElement(a,{modelerPageId:"page-with-sidebar",navigationTreeId:"navigationTree",modelerApp:f,shouldDisplay:p})),r.DOM.span({key:"userlist",className:"userlist"},r.createElement(l,{modelerApp:this.props.modelerApp})),t&&r.DOM.div({key:"logout",className:"navbar-text"},t)]);return this.renderNavBar(o)}});t.exports=p},{"./actionbutton":370,"./fullstorybutton":417,"./idlelogout":420,"./navbar":444,"./navigationoption":445,"./reviewlocksoption":483,"./userlistcontroller":509,lodash:70,react:"react"}],441:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("treebrowser").Constants.SelectionModes;var a=e("treebrowser");var s=a.view.TreeBrowser;var l=a.view.TreeBrowserNode;var u=e("../util");var c=e("./loadingplaceholder");var d=e("../store/navigationtreestore").NavigationTreeEvents;var p=e("./pane").Pane;var f=e("../util/eventlistenermixin");var h=e("../constant").ViewConfig.EVENTS;var g=r.createClass({displayName:"LinkTreeNode",onLinkClick:function(e){e.preventDefault();return false},render:function(){var e=this.props.treeNode,t;if(e.children){t=r.createElement(l,this.props)}else{t=r.DOM.a({href:m.buildViewUrl(e.nodeObj.id),onClick:this.onLinkClick},r.createElement(l,this.props))}return t}});var m=r.createClass({displayName:"ModelerNavigationTreeController",mixins:[f],propTypes:{id:r.PropTypes.string.isRequired,uniqueId:r.PropTypes.string.isRequired,modelerApp:r.PropTypes.object.isRequired,config:r.PropTypes.object},setEventListeners:function(){return[{emitterId:this.props.id,emitter:this.props.modelerApp.getViewConfigStore(),event:h.STATE_CHANGED,callback:this.$navigationConfigChanged},{emitter:this.props.modelerApp.getNavigationTreeStore(),event:d.CHANGE_CONFIG,callback:this.$navigationConfigChanged},{emitter:window,event:"hashchange",callback:this.$openViewFromHash}]},getInitialState:function(){var e=this.props.config.get("navigationTreeId")||"main_tree",t={navigationTreeId:e},i=this.props.modelerApp.getNavigationTreeStore().getConfigById(e);if(i){var r=u.parseHash(window.location.hash);t.tree=m.buildTree(i.nodes,r)}return t},shouldComponentUpdate:function(e,t){return e.id!==this.props.id||this.props.config!==e.config||this.state.tree!==t.tree},componentDidMount:function(){this.props.modelerApp.getNavigationTreeActionHandler().loadConfig(this.state.navigationTreeId)},render:function(){var e,t=this.state.tree;if(t){e=r.createElement(s,{tree:t,selectionMode:o.SINGLE,validators:{selectNode:this.$onTreeBrowserSelect},nodeConfig:{paddingLeft:5,marginLeft:5},nodeElement:g})}else{e=r.createElement(c)}return r.createElement(p,{title:"Navigation",paneClassSet:{"navigation-window":true},content:e})},$navigationConfigChanged:function(){this.setState(this.getInitialState())},$onTreeBrowserSelect:function(e){var t=m.buildViewUrl(e.nodeObj.id);if(t!==window.location.hash)this.props.modelerApp.getModelerActionHandler().navigateIfAllowed(t);return false},$openView:function(e){return this.props.modelerApp.getViewActionHandler().openPage(e)},$openViewFromHash:function(){var e=location.hash,t=u.parseHash(e);if(t){this.setState(this.getInitialState());return this.$openView(t)}},statics:{buildViewUrl:function(e){return"#/canvas/"+e},buildTree:function(e,t){function i(e,t){var n;e.forEach(function(e){n=r(e,t);if(e.children){i(e.children,n)}})}function r(e,i){e.propertyLookup=n(e);i.children=i.children||[];var r={id:e.id,label:e.propertyLookup.caption||e.propertyLookup.label||e.id,$depth:i.$depth+1,isOpen:!e.collapsed,isSelected:e.id===t};for(var o in e.propertyLookup){r[o]=e.propertyLookup[o]}i.children.push(r);return r}function n(e){var t={};if(e.properties){e.properties.forEach(function(e){t[e.key]=e.value})}return t}var o={$depth:-1,children:[]};e.forEach(function(e){var t=n(e);var r={$depth:0,id:e.id,label:t.caption||t.label||e.id,isOpen:!t.collapsed||true,children:[]};o.children.push(r);i(e.children,r)});return o}}});t.exports=m},{"../constant":256,"../store/navigationtreestore":349,"../util":357,"../util/eventlistenermixin":360,"./loadingplaceholder":425,"./pane":453,lodash:70,react:"react",treebrowser:202}],442:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-dom");var a=e("../util/eventlistenermixin");var s=e("../store/multiaxisdatastore");var l=s.MultiAxisDataEvents;var u=e("./modalwindowscontroller");var c=e("./overlaynotifications");var d=e("../util");var p=e("../constant").MESSAGES.UNCALCULATED_CHANGES;var f=e("../constant");var h=f.ViewConfig.MODELER_VIEW_ID;var g=e("./view");var m=2;var v=n.createClass({displayName:"ModelerView",propTypes:{modelerApp:n.PropTypes.object.isRequired,config:n.PropTypes.object.isRequired,onClose:n.PropTypes.func},mixins:[a],setEventListeners:function(){this.$lazyHandlerResize=r.throttle(this.updateSize,100);return[{emitter:this.props.modelerApp,event:"AUTH_FAILURE",callback:this.props.onClose},{emitter:this.props.modelerApp.getMultiAxisDataStore(),event:l.DATA_REQUEST_TIMER_FIRED,callback:this.fetchOutstandingData},{emitter:window,event:"beforeunload",callback:this.$beforeUnload},{emitter:window,event:"resize",callback:this.$lazyHandlerResize}]},getInitialState:function(){return{height:null,width:null,isReady:false}},componentWillMount:function(){var e=this.props.modelerApp.getViewConfigActionHandler(),t=this.props.modelerApp.getViewActionHandler(),i;e.initializeView(h,this.props.config).then(function(){i=d.parseHash(location.hash);i&&t.openPage(i)})},componentDidMount:function(){this.updateSize()},updateSize:function(){var e=o.findDOMNode(this),t=e&&e.clientWidth-m,i=e&&e.clientHeight;this.setState({width:t,height:i,isReady:true})},render:function(){var e=n.createElement(u,{modelerApp:this.props.modelerApp}),t=n.createElement(c,{modelerApp:this.props.modelerApp}),i;if(this.state.isReady){i=n.createElement(g,{id:h,modelerApp:this.props.modelerApp,height:this.state.height,width:this.state.width})}return n.DOM.div({className:"modeler-view"},i,e,t)},fetchOutstandingData:function(){var e=this.props.modelerApp,t=e.getMultiAxisDataStore(),i=e.getMultiAxisDataActionHandler(),r=t.getNextQueuedEdits(),n=t.hasInflightEdits(),o=t.hasInflightEditability(),a=e.getModelerActionHandler(),s,l,u=[];if(r&&r.length&&!n){u.push(a.sendEdits(r))}else if(!r&&!n){l=t.getOutstandingDataRequests();if(l.length>0){u.push(i.sendOutstandingDataRequests(l))}}if(!o){s=t.getOutstandingEditabilityRequest();if(s){u.push(i.sendEditabilityRequest(s))}}return Promise.all(u)},$beforeUnload:function(e){var t=this.props.modelerApp.getMultiAxisDataStore();if(t.getAllPendingEdits().length||t.getNextQueuedEdits()){e.returnValue=p}}});t.exports=v},{"../constant":256,"../store/multiaxisdatastore":348,"../util":357,"../util/eventlistenermixin":360,"./modalwindowscontroller":438,"./overlaynotifications":449,"./view":517,lodash:70,react:"react","react-dom":"react-dom"}],443:[function(e,t,i){"use strict";var r=e("../event_emitter").EventEmitter;var n=e("../store/multiaxisdatastore").MultiAxisDataEvents;var o=e("./pivot/config_helper");var a=e("../validationtool");var s=e("../inputparser");var l=e("../cubiql");var u=e("../constant/gridoptions").CONDITIONALS;var c=e("pivottable/src/constants").CommitMode;var d=e("lodash");var p=e("assert");var f=e("../util");var h=e("../constant").SORT;var g=e("../multiaxisconfig");var m=e("immutable");var v=e("../helpers/pivotconfighelpers");var y=e("../pivotconfig_helper");d.mixin(b.prototype,r.prototype);function b(e,t,i,r,o,a,s,l,u,c){this.$viewId=e;this.$sliceAxes=["Z"];this.$madStore=t;this.$macStore=i;this.$multiAxisDataActionHandler=o;this.$multiAxisConfigActionHandler=r;this.$modelerState=a;this.$pivotState=s;this.$defaultCellWidth=l;this.$defaultCellHeight=u;this.$updatePivotState=c;this.$madStore.on(n.DATA_CHANGED,this.$onDataChanged.bind(this));this.$updatePivotState=c}t.exports=b;function w(e){return e&&e.data.value&&e.data.value&&!d.isUndefined(e.data.value.value)}function C(e,t){var i=t?"formattedValue":"rawValue";return w(e)&&e.data.value.value[i]}b.prototype.setPivotState=function(e){this.$pivotState=e;this._emit("updateModel")};b.prototype.getConfig=function(){return this.$macStore.getViewTaskConfig(this.$viewId,"main").maConfig};b.prototype.containsQueuedEdits=function(){return this.$madStore.getNextQueuedEdits()};b.prototype.$onDataChanged=function(e){var t=this.$viewId,i=e.viewTasks&&e.viewTasks.find(function(e){return e.viewId===t}),r=i&&i.tasks||[];if(!e.viewTasks||r.indexOf("main")>-1){this._emit("updateModel")}if((!e.viewTasks||r.indexOf("copy")>-1)&&this.$macStore.viewTaskIsActive(t,"copy")&&!this.$madStore.hasOutstandingRequestsForViewTask(t,"copy")){this._emit("copyReady")}};b.prototype.markViewAsActive=function(){return this.$multiAxisConfigActionHandler.setViewTaskActive(this.$viewId,"main")};b.prototype.markViewAsInactive=function(){return this.$multiAxisConfigActionHandler.setViewTaskInactive(this.$viewId,"main")};b.prototype.commit=function(){var e=this;return e.$multiAxisDataActionHandler.commitPendingEdits().then(function(){e._emit("updateModel")})};b.prototype.getCopiedCellsRange=function(){var e=this.selection.copySelectionRange;if(!e){return}return{start:{row:e.Y.start,column:e.X.start},end:{row:e.Y.start+e.Y.length-1,column:e.X.start+e.X.length-1}}};b.prototype.addSliceToCoord=function(e){return d.merge({},this.getSliceCoord(),e)};b.prototype.validateValue=function(e,t){e=this.addSliceToCoord(e);var i=this.$madStore.getCellInfoAt(this.$viewId,"main",e),r=i.queries.value;return!!r&&a.validate(t,r.type,r.formatter.formatPattern)};b.prototype.$updateCells=function(e){p(Array.isArray(e));var t=this,i=t.getCommitMode()===c.SINGLE;return t.$multiAxisDataActionHandler.storePendingEdits(e).then(function(){if(i){t.commit()}}).catch(function(e){f.logError(e);throw e})};b.prototype.deleteCells=function(e){p(Array.isArray(e));var t=this,i=e.map(function(e){var i=t.addSliceToCoord(e),r=t.$madStore.getCellInfoAt(t.$viewId,"main",i),n=t.getCellData(e),o=(w(n)&&C(n)[0]||[])[0];return{cellInfo:r,editConfigName:"value",edit:{data:o,isDelete:true}}});return t.$updateCells(i)};b.prototype.editCells=function(e){var t=this,i=e.map(function(e){var i=t.addSliceToCoord(e.coord),r=t.$madStore.getCellInfoAt(t.$viewId,"main",i),n,o,a,l;if(!r||!Object.keys(r.queries).length){throw new Error("Error editing at coord: "+JSON.stringify(i)+". Coord not found.")}n=r.queries.value;o=t.getCellData(e.coord);a=(w(o)&&C(o)[0]||[])[0];l=s.createParser(n.formatter).parseEditInput(e.value,n.type,a);return{cellInfo:r,editConfigName:"value",edit:l}});return t.$updateCells(i)};b.prototype.checkCoord=function(e){p(this.hasHeadingData(),"Heading data is not ready.");var t=this.$madStore.getCellInfoAt(this.$viewId,"main",e),i={};if(!t){throw new Error("Invalid coordinate: "+JSON.stringify(e)+" for viewId: "+this.$viewId+". Valid range is: "+JSON.stringify(i))}};b.prototype.getCellData=function(e,t){if(!this.hasHeadingData())return;e=this.addSliceToCoord(e);return this.$madStore.getDataAt(this.$viewId,"main",e,this.$makeCellBuilder(t))};b.prototype.getSliceRange=function(){var e=this.getSliceCoord(),t={};if(!e)return;Object.keys(e).forEach(function(i){t[i]={start:e[i],length:1}});return t};b.prototype.getSliceCoord=function(){if(!this.hasHeadingData())return;var e={},t=this.getHeadingData(),i=false,r=this;this.$sliceAxes.forEach(function(n){var o=r.getSliceFieldPos(n);if(o)e[n]=t.getHeadingAxisInfo(n).findRowNumForFieldPos(o);else i=true});if(!i)return e};b.prototype.getSliceFieldPos=function(e){if(!this.hasHeadingData())return;var t=this.getConfig().axis.get(e);return this.getHeadingData().getSelectedSliceFieldPos(t)};b.prototype.$calculatePageGrid=function(e){var t=this.getHeadingInfo("X").getLength(),i=this.getHeadingInfo("Y").getLength(),r=e.X.length||1,n=e.Y.length||1;r=Math.min(r,t);n=Math.min(n,i);return new D(r,t,n,i)};b.prototype.calculateBufferedViewRange=function(e){var t=this.$calculatePageGrid(e),i=t.calculatePageForCoord({X:e.X.start,Y:e.Y.start}),r=i&&[i,t.pageRightFrom(i),t.pageDownFrom(i),t.pageDownFrom(t.pageRightFrom(i))],n=i&&t.calculatePrimaryPage(r,e),o=i&&t.pageUpFrom(t.pageLeftFrom(n)),a=i&&t.pageDownFrom(t.pageRightFrom(n)),s=i&&{X:{start:o.X.start,length:a.X.start+a.X.length-o.X.start},Y:{start:o.Y.start,length:a.Y.start+a.Y.length-o.Y.start}};return s};b.prototype.getDataRange=function(e){if(this.getHeadingData().hasLoadingHeadings()||this.getHeadingData().isLoadingSlice())return;var t=this.getSliceRange()||{},i=d.merge(t,e),r=this.calculateBufferedViewRange(i);r=d.merge(this.getSliceRange()||{},r);if(r&&t){this.$multiAxisDataActionHandler.setViewTaskRange(this.$viewId,"main",r);var n=this.$madStore.getDataRange(this.$viewId,"main",i,this.$makeCellBuilder()).dataArray;return n}};b.prototype.$findAxisCoordForPosition=function(e,t){var i=this,r=this.getHeadingInfo(e),n=false,o=0;r.columns&&r.columns.forEach(function(a,s){var l=t[a.name],u,c;p(l,"Position must be defined for "+a.name);while(u!==l&&o<r.getLength()&&!n){if(c){c=i.getNextNeighbor(e,{x:s,y:o})}else{c={x:s,y:o}}if(!c){n=true;continue}o=c.y;u=i.getHeadingRange({start:o,length:1},e)[s][0].id}if(u!==l)n=true});if(!n)return o};b.prototype.positionOnCurrentSlice=function(e,t){var i=this,r=d.cloneDeep(e),n=true;if(t)r[t]={id:t};Object.keys(e).forEach(function(t){r[t]={id:e[t]}});this.$sliceAxes.forEach(function(e){var t=i.getSliceFieldPos(e);for(var o in t){if(t[o].id!==r[o].id)n=false}});return n};b.prototype.findCoordForPosition=function(e,t){var i=this,r=d.cloneDeep(t),n=this.getHeadingData(),o=n.getSlicePosition(),a=Object.keys(o),s=true,l;if(e&&a.indexOf(e)===-1)r[e]={id:e};Object.keys(t).forEach(function(e){r[e]={id:t[e]}});this.$sliceAxes.forEach(function(e){var t=i.getSliceFieldPos(e);for(var n in t){if(t[n].id!==r[n].id)s=false}});if(s){l=n.findCoordForFieldPos(r);if(l){this.$sliceAxes.forEach(function(e){delete l[e]})}}return l};b.prototype.$makeCellBuilder=function(){var e=this,t=new Map,i=function(e){var t=0,i=e.length,r="";for(;t<i;t++){r+=e[t].id+"_"}return r},r=function(r){var n=i(r.fields),a=t.get(n);if(!t.get(n)){var s=r.fields.find(function(e){return e instanceof g.MeasureField}),u=s&&s.id,c=r.queries.value&&r.queries.value.query.mappedInter.qualified_level.map(function(e){return{qualifiedName:l.qualifiedLevelToQualifiedName(e)}});if(u){var d=e.$modelerState.pivotConfig.metricsConfig,p=o.getCellFormattingConfig(e.$pivotState,u,c),f=u&&d&&d[u],h=f&&f.format,m=f&&f.halign,v=f&&f.readonly||false,b=f&&f.cellType,w=e.$modelerState.measureModel,C=u&&w.getMeasureInfo(u),E=C.type,S=y.getDefaultDisplayTypeForMeasureType(E,h),T=b||S;a={displayType:T,halign:m,readonly:v,format:h,formattingConfig:p}}t.set(n,a)}return a},n=function(e){return e.rollups&&d.isArray(e.rollups)&&e.rollups.some(function(e){return!d.isUndefined(e)&&e.constructor&&e.constructor.name==="Record"})};return function(e,t){if(!e||!t)return{data:{},invalid:true,validityMessages:[],cellInfo:e,readonly:true};else if(t.invalid)return{data:{},invalid:true,validityMessages:t.validityMessages,cellInfo:e,readonly:true};var i=r(e),o=!(e.editConfigs.value&&e.editConfigs.value.editable),a=t.invalid||t.someInvalid||!Object.keys(e.queries).length,s=t?t.queryResults:{},l=n(e),u=d.isUndefined(s["_passed_filter_"])||s["_passed_filter_"].value&&s["_passed_filter_"].value.rawValue[0]&&s["_passed_filter_"].value.rawValue[0][0]===1;return{invalid:a,data:s,displayType:i&&i.displayType,formattingConfig:i&&i.formattingConfig||[],validityMessages:t.validityMessages,cellInfo:e,protected:s.value&&s.value.protected,locked:s.value&&s.value.locked,readonly:o,filtered:!u,halign:i&&i.halign,isRollup:l}}};b.prototype.cloneCellData=function(e){return{invalid:e.invalid,data:e.data,displayType:e.displayType,validityMessages:e.validityMessages,cellInfo:e.cellInfo,protected:e.protected,locked:e.locked,readonly:e.readonly,halign:e.halign}};b.prototype.getPositionOfHeading=function(e,t){var i=this.$multiAxisDataStore.getHeadingRows(this.$viewId,t.x,1,e),r=i[0],n=Object.keys(r.memberIds).filter(l.qNameIsRealLevel),o={};n.forEach(function(e){o[e]=r.memberIds[e]});return o};function E(e){return e.config.field instanceof g.MeasureField}function S(e){return e.config.field instanceof g.LevelField}b.prototype.setSort=function(e,t,i){var r={start:t.y,length:1},n=this.getHeadingRange(r,e),a=n[0].headers,s=a.filter(S),l=a.filter(E),u=o.getSortByMeasureValueConfig(this.$pivotState),c,d,f=e==="X"?"Y":"X",g;d=s.map(function(e){var t=e.config.field.level;return{qualifiedLevel:{level:t.get("levelName"),dimension:t.get("dimensionName"),label:t.get("labelName")},memberId:e.config.id||e.id}});p(l.length===1,"Should only have one measure header when sorting by measure value");c=l[0].id;if(!i){if(u&&u.metricName===c){i=u.sortOrder===h.ASCENDING?h.DESCENDING:h.ASCENDING}else{i=h.DEFAULT_TYPE}}g=o.setSortByMeasureValue(this.$modelerState,this.$pivotState,c,f,d,i);this.$updatePivotState(g)};b.prototype.$headingCoordIsSortedByMeasure=function(e,t,i){var r,n,o,a,s,l=0;if(!i)return false;r=this.getPositionOfHeading(e,t);n=this.getMetricNameAtHeading(e,t);a=n&&n===i.sortMeasureName;if(!a)return false;s=Object.keys(i.sortPositions);if(s.length){for(;l<s.length;l++){o=s[l];a=a&&r[o]===i.sortPositions[o]}}return a};b.prototype.headerCanSort=function(e,t,i){if(e==="Z")return false;var r=e==="X"?"Y":"X",n=this.getHeadingData().getHeadingAxisInfo(e),a=n.getColumnSetAt(t),s=this.getHeadingData().getHeadingAxisInfo(r),l=s.getColumnSets(),u=false,c=o.getVisibleMeasures(this.$pivotState),p=c&&o.findAxisForField(this.$pivotState,c.id);if(a.columns.length-1!==i){return false}if(!a.columns.some(function(e){return e.field instanceof g.MeasureField})){return false}if(p&&p!==e){return false}l.forEach(function(e){var t=e.columns.length,i=0,r,n,o=[];for(;i<t;i++){r=e.columns[i];n=r.field;if(n instanceof g.LevelField)o.push(n.level.labelName)}o=d.uniq(o);if(o.length>1)u=true});return!u};b.prototype.headerSortOrder=function(e,t){var i={start:t,length:1},r=e==="X"?"Y":"X",n=o.getSortByMeasureValueConfig(this.$pivotState),a,s,l,u,c;if(!n){return}if(n.floatingAxis!==r.toLowerCase()){return}s=this.getHeadingRange(i,e);l=s[0].headers;c=l.filter(E);if(c.length===0||n.metricName!==c[0].id){return}if(n.sortPositions){u=l.filter(S);a=u.every(function(e){var t=e.config.field.level;return n.sortPositions.find(function(i){return i.memberId===e.id&&t.get("levelName")===i.qualifiedLevel.level&&t.get("dimensionName")===i.qualifiedLevel.dimension&&t.get("labelName")===i.qualifiedLevel.label})});if(!a){return}}return n.sortOrder};b.prototype.getHeadingRange=function(e,t){var i=this.getHeadingData().getHeadingAxisInfo(t).getHeadingRange(e.start,e.start+e.length);return i};b.prototype.getHeadingData=function(){return this.$madStore.getHeadingData(this.$viewId,"main")};b.prototype.hasHeadingData=function(){var e=this.getHeadingData(),t;if(!e)return false;t=e.getAxes();var i=t.every(function(t){var i=e.getHeadingAxisInfo(t);return!!i});return i};b.prototype.getHeadingInfo=function(e){if(!this.hasHeadingData())return;var t=this.getHeadingData().getHeadingAxisInfo(e);return t};b.prototype.getHeadingColumnSizesAtRow=function(e,t){var i=this.getHeadingInfo(e),r=i.getColumnSetAt(t),n=e==="X"?"height":"width";return this.getColumnSizesForColumnSet(r,n)};b.prototype.getColumnSizesForColumnSet=function(e,t){var i=e.columns,r=this.getDefaultSize()[t],n=this.$pivotState.get("displayOptions"),o,a=[],s=0,l=i.length,u;for(;s<l;s++){u=i[s];o=this.$findSizeByPath(n,u.path);a.push(o&&o.get(t)||r)}return a};b.prototype.findHeadingIdCoords=function(e,t,i,r){return this.$multiAxisDataStore.findMemberIdCoords(this.$viewId,e,t,i,r)};b.prototype.setHeadingHeight=function(e,t,i,r){this.$applySizeToHeading(e,t,undefined,i,r)};b.prototype.setHeadingWidth=function(e,t,i,r){this.$applySizeToHeading(e,t,i,undefined,r)};b.prototype.$applySizeToHeading=function(e,t,i,r,n){var o=this.getHeadingInfo(e),a=o.getColumnSetAt(t.row).columns[t.col],s=o.getHeadingMembers(t.row)[t.col],l=a.field&&(a.field instanceof g.MeasureField?a.path[0]:a.field.get("id")),u=!n&&s.id,c=this.$pivotState.get("displayOptions"),p=c.get(l)||new m.Map,f=s.config.rollup&&s.config.id,h=!n&&(e==="Y"&&d.isUndefined(i)||e==="X"&&d.isUndefined(r));if(h&&f){c=c.set(l,x(p,f,i,r))}else if(h&&u){c=c.set(l,_(p,u,i,r))}else{c=c.set(l,A(p,i,r,n))}this.$updatePivotState(this.$pivotState.set("displayOptions",c))};function T(e,t,i){if(!d.isUndefined(t)){e=e.set("width",t)}if(!d.isUndefined(i)){e=e.set("height",i)}return e}function x(e,t,i,r){var n=e.get("rollups")||new m.Map,o=n.get(t)||new m.Map;o=T(o,i,r);return e.set("rollups",n.set(t,o))}function _(e,t,i,r){var n=e.get("members")||new m.Map,o=n.get(t)||new m.Map;o=T(o,i,r);return e.set("members",n.set(t,o))}function M(e,t,i){if(!d.isUndefined(t)){e=e.delete("width")}if(!d.isUndefined(i)){e=e.delete("height")}return e}function A(e,t,i,r){var n=T(e,t,i);if(r){n=n.delete("members").delete("rollups")}return n}b.prototype.getSizingInfo=function(e){var t=[],i=[],r,n=-1,o=-1,a=this.getHeadingData(),s=a.getHeadingAxisInfo(e),l=a.getColumnSets(e),u=0,c,d,p,f,h,g,v=l.length,y=this.$pivotState.displayOptions,b=e==="X"?"width":"height",w=this.getDefaultSize(e),C,E,S=this;for(;u<v;u++){c=l[u];h=c.offset;d=c.columns[0];p=c.columns[c.columns.length-1];f=d.length*d.step;g=c.offset+f-1;E=this.$findSizeByPath(y,p.path)||m.Map();C=E.get(b)||w[b];n=h;o=g;r={range:[n,o],rowCount:p.length,repeatDistance:p.repeatDistance,size:C};i.push(r)}y.forEach(function(e,i){var r=e.get("members"),n=e.get("rollups");t.push(S.$findCustomNodes(s,i,r,b,"id"));t.push(S.$findCustomNodes(s,i,n,b,"rollupFieldId"))});t=Array.prototype.concat.apply([],t);t.sort(function(e,t){return e.index-t.index});return{defaultRanges:i,customSizeNodes:t}};b.prototype.$findSizeByPath=function(e,t){var i,r=0;for(;r<t.length;r++){i=e.get(t[r]);if(i){return i}}};b.prototype.$findCustomNodes=function(e,t,i,r,n){var o=[],a={},s={};a[t]=s;if(i){i.forEach(function(i,l){var u=0,c,p=i.get(r),f,h;if(!d.isUndefined(p)){s[n]=l;h=e.findMatchingRowNums(a,function(e){var i=e.columns[e.columns.length-1];return i.field.get("id")===t||i.path[0]===t&&i.path[1]===l});c=h.length;for(;u<c;u++){f=h[u];if(!d.isUndefined(f))o.push({index:f,size:p})}}})}return o};function I(e,t){}b.prototype.getColumnHeaderSizes=function(){var e=this.getHeadingInfo("X");if(e){return d.map(e.columns,"cellSize")}else return[]};b.prototype.getRowHeaderSizes=function(){var e=this.getHeadingInfo("Y");if(e){return d.map(e.columns,"cellSize")}else return[]};b.prototype.$getSizes=function(e){var t=this.$getSizing(),i=this.getDefaultSize(),r,n;if(this.headingData&&t){r=this.headingData[e].axis;n=r.map(function(e){if(e in t){return{width:t[e].width||i.width,height:t[e].height||i.height}}return i})}return n};b.prototype.getDefaultSize=function(){return{width:this.$defaultCellWidth,height:this.$defaultCellHeight}};b.prototype.getRelativeHeaderPosition=function(e,t,i){return{x:t.x,y:t.y-i}};b.prototype.getAbsoluteHeaderPosition=function(e,t,i){return{x:t.x,y:t.y+i}};b.prototype.getPreviousNeighbor=function(e,t,i){var r=this.getHeadingData().getRowNumByMemberOffset(e,t,i,-1);if(d.isUndefined(r))return;else return{x:t,y:r}};b.prototype.getNextNeighbor=function(e,t,i){var r=this.getHeadingData().getRowNumByMemberOffset(e,t,i,1);if(d.isUndefined(r))return;else return{x:t,y:r}};b.prototype.setCommitMode=function(e){this.$mode=e};b.prototype.getCommitMode=function(){return this.$mode||c.SINGLE};b.prototype.hasEdits=function(){return this.$madStore.getAllPendingEdits().length>0};b.prototype.clearEdits=function(){return this.$multiAxisDataActionHandler.clearEdits(this.$madStore.getAllPendingEdits())};b.prototype.hasLocks=function(){return this.$madStore.hasLocks()};b.prototype.addSliceRange=function(e){var t=this.getSliceRange()||{},i=d.merge(t,e);return i};b.prototype.setLock=function(e){var t=this.$getLocksInRange(e,true);return this.$multiAxisDataActionHandler.setLocks(t)};function O(e,t){return{data:t,info:e}}b.prototype.unsetLock=function(e){var t=this.$getLocksInRange(e);return this.$multiAxisDataActionHandler.unsetLocks(t)};b.prototype.canLockCells=function(e){var t=this.$getLocksInRange(e,true);return!!t.length};b.prototype.hasLocksInRange=function(e){var t=this.$madStore.getLocks(),i,r;if(t.length===0){return false}i=t[0].positions.map(function(e){return e.key});r=this.$getLocksInRange(e).map(function(e){return e.positions[0].key});return i.some(function(e){return r.indexOf(e)!=-1})};b.prototype.$getLocksInRange=function(e,t){var i=this.$madStore.getDataRange(this.$viewId,"main",this.addSliceRange(e),O,true),r=i.dataArray.map(function(e){if(t&&e.data.queryResults.value&&e.data.queryResults.value.protected)return;return{editConfig:e.info.editConfigs.value,positions:[e.info.positionInfo]}});if(t)r=r.filter(d.identity);return r};b.prototype.clearAllLocks=function(){return this.$multiAxisDataActionHandler.clearAllLocks()};b.prototype.getSelectedDataRange=function(e){return this.$madStore.getDataRange(this.$viewId,"main",this.addSliceRange(e),O,true)};b.prototype.getCellStyle=function(e,t,i){var r={},n,o=this;n=e.value&&e.value.value&&(e.value.value.rawValue[0]||[])[0];if(t){t.forEach(function(e){if(o.$checkCondition(n,e.condition,e.value,e.conditionOptions,i)){for(var t in e.style){r[t]=e.style[t]}}})}return r};b.prototype.$checkCondition=function(e,t,i,r,n){var o=n==="percentage"?4:2;if([u.GREATER_EQUAL.name,u.GREATER_THAN.name,u.LESS_EQUAL.name,u.LESS_THAN.name,u.RANGE.name].indexOf(t)!==-1){if(d.isUndefined(e)||isNaN(e)){return false}}if(!d.isBoolean(e)&&!isNaN(e)){e=d.round(parseFloat(e),o);i=t!==u.RANGE.name?d.round(parseFloat(i),o):d.map(i,function(e){return d.round(parseFloat(e),o)})}switch(t){case u.EMPTY.name:return d.isUndefined(e);case u.NOT_EMPTY.name:return!d.isUndefined(e);case u.EQUAL.name:return e===i||!!e===i;case u.NOT_EQUAL.name:return e!==i&&!!e!==i;case u.GREATER_EQUAL.name:return f.numberCompare(e,i)>=0;case u.GREATER_THAN.name:return f.numberCompare(e,i)>0;case u.LESS_EQUAL.name:return f.numberCompare(e,i)<=0;case u.LESS_THAN.name:return f.numberCompare(e,i)<0;case u.RANGE.name:var a=true;if(!d.isUndefined(r)){d.forEach(r,function(t){switch(t){case u.RANGE.INCLUDE_MIN:a=a&&f.numberCompare(e,i[0])>=0;break;case u.RANGE.INCLUDE_MAX:a=a&&f.numberCompare(e,i[1])<=0;break}if(!a){return false}})}else{a=f.numberCompare(e,i[0])>=0&&f.numberCompare(e,i[1])<=0}return a}};b.prototype.getCopyData=function(e,t){var i=this,r=i.getSliceRange()||{},n=d.merge(r,e),o=i.$macStore.viewTaskIsActive(i.$viewId,"copy")?"copy":"main",a=i.$madStore.hasCleanData(i.$viewId,o,n),s={isolatedData:true};if(t){i.$cutRange=r}else{delete i.$cutRange}if(a){if(i.$macStore.viewTaskIsActive(i.$viewId,"copy")){i.$multiAxisConfigActionHandler.setViewTaskInactive(i.$viewId,"copy")}return i.$madStore.getDataRange(i.$viewId,o,n,i.$makeCellBuilder()).dataArray}else{s.maConfig=i.getConfig();i.$multiAxisConfigActionHandler.setViewTaskConfig(i.$viewId,"copy",s).then(function(){return i.$multiAxisDataActionHandler.setViewTaskRange(i.$viewId,"copy",n)})}};b.prototype.pasteCells=function(e,t){var i=this,r=this.getSliceRange()||{},n=d.merge(r,t);i.$multiAxisConfigActionHandler.setViewTaskConfig(i.$viewId,"paste",{maConfig:this.getConfig(),isolatedData:true}).then(function(){return i.$multiAxisDataActionHandler.setViewTaskRange(i.$viewId,"paste",n)}).then(function(){var t={},r=d.compact(e.map(function(e){var r=i.addSliceToCoord(e.coord),n=i.$madStore.getCellInfoAt(i.$viewId,"main",r),o=n.editConfigs.value.coreEditMeasure.metric.name,a,l,u,c,d,p,f,h="value",g=e.value;if(!n){throw new Error("Error editing at coord: "+JSON.stringify(r)+". Coord not found.")}if(n.queries.value.query.validityMessages&&n.queries.value.query.validityMessages.length)return;if(!t[o]){a=v.getMetricConfig(i.$modelerState.pivotConfig,o);u=a&&a.cellType;l=i.$modelerState.measureModel.getMeasureInfo(o);t[o]=u||y.getDefaultDisplayTypeForMeasureType(l.type,a.format)}c=n.queries.value;d=i.getCellData(e.coord);f=(w(d)&&C(d)[0]||[])[0];if(t[o]==="dropdown"){h="selectedDataLabel"}p=s.createParser(c.formatter).parseEditInput(g,c.type,f);return{cellInfo:n,editConfigName:h,edit:p}})),n;if(i.$cutRange){n=i.$madStore.getCellInfoInRange(i.$viewId,"main",i.$cutRange);n.dataArray.forEach(function(e){r.push({cellInfo:e,editConfigName:"value",edit:{data:"",isDelete:true}})});i.$isCutOperation=false}delete i.$cutRange;return r}).then(function(e){return i.$updateCells(e)})};function D(e,t,i,r){this.$xPageSize=e;this.$yPageSize=i;this.$xLength=t;this.$yLength=r;this.$fullSizeXPageCt=Math.floor(t/e);this.$fullSizeYPageCt=Math.floor(r/i)}D.prototype.calculatePrimaryPage=function(e,t){var i,r={X:{start:t.X.start||0,length:t.X.length||1},Y:{start:t.Y.start||0,length:t.Y.length||1}},n=r.X.start+r.X.length/2,o=r.Y.start+r.Y.length/2,a;e.forEach(function(e){
var t=e.X.start+e.X.length/2,s=e.Y.start+e.Y.length/2,l;if(t>=r.X.start&&t<=r.X.start+r.X.length&&s>=r.Y.start&&s<=r.Y.start+r.Y.length){l=Math.pow(Math.pow(n-t,2)+Math.pow(o-s,2),2);if(d.isUndefined(a)||l<a)i=e}});return i};D.prototype.calculatePageForCoord=function(e){if(e.X<0||e.Y<0||e.X>=this.$xLength||e.Y>=this.$yLength)return;var t=Math.floor(e.X/this.$xPageSize),i=Math.floor(e.Y/this.$yPageSize);return this.$makePage(t,i)};D.prototype.$makePage=function(e,t){return{X:{pageIdx:e,start:this.$calcXPageStart(e),length:this.$calcXPageEnd(e)-this.$calcXPageStart(e)},Y:{pageIdx:t,start:this.$calcYPageStart(t),length:this.$calcYPageEnd(t)-this.$calcYPageStart(t)}}};D.prototype.$lastXPageIdx=function(e){return this.$fullSizeXPageCt===e};D.prototype.$lastYPageIdx=function(e){return this.$fullSizeYPageCt===e};D.prototype.$calcXPageStart=function(e){return e===0?0:e*this.$xPageSize};D.prototype.$calcXPageEnd=function(e){return this.$lastXPageIdx(e)?this.$xLength:(e+1)*this.$xPageSize};D.prototype.$calcYPageStart=function(e){return e===0?0:e*this.$yPageSize-1};D.prototype.$calcYPageEnd=function(e){return this.$lastYPageIdx(e)?this.$yLength:(e+1)*this.$yPageSize};D.prototype.pageRightFrom=function(e){if(this.$lastXPageIdx(e.X.pageIdx))return e;else return this.$makePage(e.X.pageIdx+1,e.Y.pageIdx)};D.prototype.pageLeftFrom=function(e){if(e.X.pageIdx===0)return e;else return this.$makePage(e.X.pageIdx-1,e.Y.pageIdx)};D.prototype.pageUpFrom=function(e){if(e.Y.pageIdx===0)return e;else return this.$makePage(e.X.pageIdx,e.Y.pageIdx-1)};D.prototype.pageDownFrom=function(e){if(this.$lastYPageIdx(e.Y.pageIdx))return e;else return this.$makePage(e.X.pageIdx,e.Y.pageIdx+1)}},{"../constant":256,"../constant/gridoptions":255,"../cubiql":276,"../event_emitter":289,"../helpers/pivotconfighelpers":298,"../inputparser":299,"../multiaxisconfig":328,"../pivotconfig_helper":330,"../store/multiaxisdatastore":348,"../util":357,"../validationtool":368,"./pivot/config_helper":455,assert:2,immutable:"immutable",lodash:70,"pivottable/src/constants":102}],444:[function(e,t,i){"use strict";var r=e("react");var n=r.createClass({displayName:"NavBar",propTypes:{brandImg:r.PropTypes.object.isRequired,brandHref:r.PropTypes.string},render:function(){var e=this.props.children&&this.props.children.map&&this.props.children.map(function(e,t){return r.DOM.li({key:"navbar-item-"+t},e)})||[];return r.DOM.nav({className:"navbar navbar-default",role:"navigation"},r.DOM.div({className:"container-fluid"},r.DOM.div({className:"navbar-header"},r.DOM.a({className:"navbar-brand",href:this.props.brandHref||"#"},this.props.brandImg)),r.DOM.div({className:"nav navbar-nav navbar-right"},e)))}});t.exports=n},{react:"react"}],445:[function(e,t,i){"use strict";var r=e("immutable");var n=e("react");var o=e("lodash");var a=e("./toggleoption");var s=e("../util/viewlayoututils");var l=e("../constant");var u=l.Layout;var c=l.View;var d=l.ViewConfig.EVENTS;var p=l.ViewConfig.MODELER_VIEW_ID;var f=e("../util/eventlistenermixin");var h={options:{size:"200px",openIn:u.POSITION.LEFT}};var g={config:{navigationTreeId:"main_tree"},module:c.Modules.ModelerNavigationTree};var m=n.createClass({displayName:"NavigationOption",propTypes:{modelerApp:n.PropTypes.object.isRequired,navigationTreeId:n.PropTypes.string.isRequired,shouldDisplay:n.PropTypes.bool.isRequired},mixins:[f],getDefaultProps:function(){return{shouldDisplay:true}},setEventListeners:function(){return[{emitterId:p,emitter:this.props.modelerApp.getViewConfigStore(),event:d.STATE_CHANGED,callback:this.onStateChange}]},onStateChange:function(){this.forceUpdate()},getModelerViewId:function(){return this.props.modelerApp.getViewStore().getViewUniqueId(null,p)},isNavigationShown:function(){var e=this.props.modelerApp.getViewConfigStore(),t=e.getViewState(p);return!!(t&&s.isViewOpenedInLayout(t,this.props.navigationTreeId))},toggleActive:function(){var e=this.props.modelerApp,t=e.getViewActionHandler(),i=this.getModelerViewId(),r;if(this.isNavigationShown()){t.closeViewIn(i,this.props.navigationTreeId)}else{r=this.getDefaultNavigationTreeConfig()||g;t.openViewIn(i,this.props.navigationTreeId,r,h)}},getDefaultNavigationTreeConfig:function(){return this.props.modelerApp.getViewConfigStore().getViewConfig(p).get("views",r.List()).find(function(e){return e.get("module")===c.Modules.ModelerNavigationTree})},render:function(){var e=null;if(this.props.shouldDisplay){e=n.createElement(a,{isActive:this.isNavigationShown(),toggleActive:this.toggleActive},n.DOM.i({className:"fa fa-sitemap"}),"Navigation")}return e}});t.exports=m},{"../constant":256,"../util/eventlistenermixin":360,"../util/viewlayoututils":367,"./toggleoption":505,immutable:"immutable",lodash:70,react:"react"}],446:[function(e,t,i){"use strict";var r=e("react");var n=e("classnames");var o=r.createClass({displayName:"NavItem",propTypes:{title:r.PropTypes.string.isRequired,children:r.PropTypes.node,isActive:r.PropTypes.bool,onClick:r.PropTypes.func,itemKey:r.PropTypes.string,tabIndex:r.PropTypes.number,className:r.PropTypes.string},handleClick:function(e){e.preventDefault();this.props.onClick(this.props.itemKey||this.props.tabIndex,e,this)},handleMouseDown:function(e){e.preventDefault()},render:function(){var e=n({active:this.props.isActive},"nav-item",this.props.className);return r.DOM.li({className:e},r.DOM.a({ref:"link",href:"#",tabIndex:this.props.tabIndex||0,onClick:this.handleClick,onMouseDown:this.handleMouseDown},this.props.title))}});t.exports=o},{classnames:6,react:"react"}],447:[function(e,t,i){"use strict";var r=e("classnames");var n=e("assert");var o=e("react");var a=o.createClass({displayName:"NavList",propTypes:{children:o.PropTypes.node.isRequired,type:o.PropTypes.oneOf(["pills","tabs"]),isVertical:o.PropTypes.bool,isJustified:o.PropTypes.bool,onSelect:o.PropTypes.func,activeItemKey:o.PropTypes.string,initialIndex:o.PropTypes.number},getInitialState:function(){return{selectedIndex:typeof this.props.initialIndex!=="undefined"?this.props.initialIndex:0}},handleClick:function(e,t,i){if(this.props.onSelect)this.props.onSelect(e,t,i);this.setState({selectedIndex:i.props.tabIndex})},$isActive:function(e,t){if(this.props.activeItemKey){return this.props.activeItemKey===e.props.itemKey}else{return this.state.selectedIndex===t}},renderItems:function(){return o.Children.map(this.props.children,function(e,t){n(!this.props.activeItemKey||typeof e.props.itemKey!=="undefined","Specified an activeItemKey for the NavList component but one of the Nav Items does not have a itemKey prop.");return o.cloneElement(e,{key:t,isActive:this.$isActive(e,t),tabIndex:t,onClick:this.handleClick})},this)},renderContent:function(){var e;o.Children.forEach(this.props.children,function(t,i){if(this.$isActive(t,i)&&t.props.children){e=o.DOM.div({className:"tab-content"},o.DOM.div({role:"tab-panel",className:"tab-pane active"},t.props.children))}},this);return e},render:function(){var e="nav-"+(this.props.type||this.props.isVertical&&"pills"||"tabs"),t=r("nav",e,{"nav-stacked":this.props.isVertical,"nav-justified":this.props.isJustified});return o.DOM.div({className:"nav-list"},o.DOM.ul({className:t},this.renderItems()),this.renderContent())}});t.exports=a},{assert:2,classnames:6,react:"react"}],448:[function(e,t,i){"use strict";var r=e("lodash");var n=e("classnames");var o=e("react");var a=e("react-addons-pure-render-mixin");var s=o.createClass({displayName:"OkCancelButtons",mixins:[a],propTypes:{okText:o.PropTypes.string,cancelText:o.PropTypes.string,onOk:o.PropTypes.func,onCancel:o.PropTypes.func.isRequired,okClassSet:o.PropTypes.object,cancelClassSet:o.PropTypes.object},getDefaultProps:function(){return{okText:"Apply",cancelText:"Close"}},handleOk:function(e){this.props.onOk(e)},handleCancel:function(e){this.props.onCancel(e)},render:function(){var e=n(r.merge(this.props.okClassSet||{},{"btn-ok":true,btn:true,"btn-primary":true})),t=n(r.merge(this.props.cancelClassSet||{},{"btn-cancel":true,btn:true,"btn-default":true}));return o.DOM.div({className:"button-group"},this.props.onOk?o.DOM.button({ref:"okBtn",type:"button",className:e,onClick:this.handleOk},this.props.okText):null,o.DOM.button({ref:"cancelBtn",type:"button",className:t,onClick:this.handleCancel},this.props.cancelText))}});t.exports=s},{classnames:6,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],449:[function(e,t,i){"use strict";var r=e("../util/eventlistenermixin");var n=e("../store/notificationsstore").NotificationsEvents;var o=e("../constant").NotificationLevels;var a=e("react");var s=e("lodash");var l=e("react-notification-system");var u=a.createClass({displayName:"OverlayNotifications",propTypes:{modelerApp:a.PropTypes.object.isRequired,onNotificationAdd:a.PropTypes.func},mixins:[r],setEventListeners:function(){return[{emitter:this.props.modelerApp.getNotificationsStore(),event:n.SHOW,callback:this.addNotification}]},handleActionClick:function(e){if(e){this.props.modelerApp.getNotificationsActionHandler().executeCallback(e)}},addNotification:function(e){var t=e&&e.options||{level:o.INFO};if(t.action){t.action.callback=this.handleActionClick.bind(this,t.uid)}this.refs.notificationSystem&&this.refs.notificationSystem.addNotification(t);if(s.isFunction(this.props.onNotificationAdd)){this.props.onNotificationAdd(t)}},render:function(){return a.createElement(l,{ref:"notificationSystem"})}});t.exports=u},{"../constant":256,"../store/notificationsstore":350,"../util/eventlistenermixin":360,lodash:70,react:"react","react-notification-system":"react-notification-system"}],450:[function(e,t,i){"use strict";var r=e("lodash");var n=e("immutable");var o=e("react");var a=e("../util/comparator");var s=e("../util").concatStrings;var l=e("popupmenu").MenuItem;var u=e("popupmenu").MenuItemsTypes;var c=e("./sheet_view_signals").Events;var d=e("./sheet_view_signals").Handlers;var p=e("./sheet_view_signals").getSliceComponentId;var f=e("../constant").ViewConfig.PATH.SIGNAL_LISTENERS;var h=e("../constant").ModalWindows.Types;var g=e("../constant").ViewConfig.MODELER_VIEW_ID;var m=e("../constant").PagesSyncStates;var v=e("../constant").ViewConfig.PATH.SIGNALS;var y=e("../util/viewlayoututils");var b=e("../constant").View.Modules;var w=e("../constant");var C=w.ContextMenu.MenuItemInfo;var E=w.ContextMenu.IconInfo;t.exports=function(e){var t="Quick Pages Synchronization for "+e.displayName;var i=o.createClass({displayName:t,createSyncMenuItems:function(e){var t=this.checkSyncItemsVisibility(e.get("id")),i=[o.createElement(l,{key:"divider-sync",itemType:u.Divider})];if(t.syncAll){i.push(o.createElement(l,{key:C.SyncAll.key,label:C.SyncAll.label,data:e,onClick:this.handleSyncAll,itemType:u.MenuItem,iconName:E.Sync}))}if(t.syncPage){i.push(o.createElement(l,{key:C.SyncAllOnPage.key,label:C.SyncAllOnPage.label,data:e,onClick:this.handleSyncAllOnPage,itemType:u.MenuItem,iconName:E.Sync}))}if(t.unsyncAll){i.push(o.createElement(l,{key:C.UnsyncAll.key,label:C.UnsyncAll.label,data:e.get("id"),onClick:this.handleUnsyncAll,itemType:u.MenuItem,iconName:E.Unsync}))}if(t.unsyncPage){i.push(o.createElement(l,{key:C.UnsyncAllOnPage.key,label:C.UnsyncAllOnPage.label,data:e.get("id"),onClick:this.handleUnsyncAllOnPage,itemType:u.MenuItem,iconName:E.Unsync}))}if(t.unsyncThis){i.push(o.createElement(l,{key:C.UnsyncThis.key,label:C.UnsyncThis.label,data:e.get("id"),onClick:this.handleUnsyncThis,itemType:u.MenuItem,iconName:E.Unsync}))}i.push(o.createElement(l,{key:C.SyncWith.key,label:C.SyncWith.label,data:e,onClick:this.openSyncWithDialog,itemType:u.MenuItem,iconName:E.Sync}));return i},checkSyncItemsVisibility:function(e){var t=p(e),r=this.getViewStatesForPage(),o=i.getSyncSignalName(e),a=this.findViewStatesWithSlice(e),s,l={syncAll:true,syncPage:r.viewStates.size>1,unsyncAll:false,unsyncPage:false,unsyncThis:false};s=a.filter(function(e){var i=e.getIn(v,n.List()).find(function(e){return e.get("name")===o&&e.get("emitterId")===t}),r=e.getIn(f,n.List()).find(function(e){return e.get("signalName")===o&&e.get("listenerId")===t});return i&&r});l.unsyncAll=s.size===a.size;l.unsyncThis=this.checkUnsyncThisMenuItemVisibility(e);l.unsyncPage=this.checkUnsyncPageMenuItemVisibility(e)&&r.viewStates.size>1;l.syncPage=l.unsyncPage?false:l.syncPage;l.syncAll=!l.unsyncAll;return l},checkUnsyncThisMenuItemVisibility:function(e){return!!i.findSyncSignalInState(this.getViewConfigStore().getViewState(this.props.sheetId),p(e))},checkUnsyncPageMenuItemVisibility:function(e){return i.areViewsSynced(e,this.getViewStatesForPage().viewStates)},getViewConfigStore:function(){return this.props.modelerApp.getViewConfigStore()},setViewState:function(e){return this.props.modelerApp.getViewConfigActionHandler().setViewState(e.get("id"),e)},saveViewStates:function(e){return this.props.modelerApp.getViewConfigActionHandler().saveViewStates(e)},findViewStatesWithSlice:function(e){return this.getViewConfigStore().findViewStatesWith(["pivotConfig","axis","slice"],function(t){return t.find(function(t){return t.get("qualifiedName")===e})})},findViewStatesWithSignals:function(e){return this.getViewConfigStore().findViewStatesWith(["signals"],function(t){var i=t.get("output",n.List()).find(function(t){return e.contains(t.get("name"))});var r=t.get("input",n.List()).find(function(t){return e.contains(t.get("signalName"))});return i||r})},findViewStatesHierarchyWithSlice:function(e){var t=this.getViewConfigStore(),i=this.getCanvasNamesMap();return t.reduceViewStatesIn([],function(r,o){var a;if(!o.has("module")){a=o.get("views",n.Map()).reduce(function(i,r,o){if(r.get("module")===b.Sheet){r=t.getViewState(o);if(r.getIn(["pivotConfig","axis","slice"],n.List()).find(function(t){return t.get("qualifiedName")===e})){return i.push(r)}}return i},n.List());if(a.size&&i[o.get("id")]){r=r.push(n.Map({id:o.get("id"),title:i[o.get("id")]}).set("children",a))}}return r},n.List())},getCanvasNamesMap:function(){var e=this.getViewConfigStore().getViewState(g),t=y.getInlineViewState(e,b.ModelerNavigationTree),i=t.getIn(["config","navigationTreeId"],"main_tree"),n=this.props.modelerApp.getNavigationTreeStore().getConfigById(i);function o(e){var t={};e.forEach(function(e){if(e.hasOwnProperty("children")){t=r.extend(t,o(e.children))}else{t[e.id]=e.propertyLookup.caption}});return t}return o(n.nodes)},handleSyncAll:function(e){var t=this,r=e.get("id"),n=p(r),o=i.createSignalComparator(n),a=i.getSyncSignalName(r),s=i.buildSyncSignal(a,r),l=i.buildSyncListenerFromSignal(s),u=this.findViewStatesWithSlice(r),c=this.getViewConfigStore().getViewState(this.props.sheetId),d=i.getSignalNamesViewStatesSend(u,o),f=this.props.currentSlice,h;h=u.map(function(r){r=i.addSignalAndListenerToViewStates(r,c,s,l,o,d,e,f);t.setViewState(r);return r});h=h.concat(this.findViewStatesWithSignals(d).map(function(e){e=i.updateViewStateWithSignal(e,a,d);t.setViewState(e);return e}));this.saveViewStates(h)},handleUnsyncAll:function(e){var t=i.getSyncSignalName(e),r=this.findViewStatesWithSlice(e),n=p(e);this.removeSyncSignalFromViewState(r,t,n)},handleSyncAllOnPage:function(e){var t=this,r=e.get("id"),n=p(r),o=i.createSignalComparator(n),a=i.getSyncSignalName(r,this.getCurrentPageViewId()),s=i.buildSyncSignal(a,r),l=i.buildSyncListenerFromSignal(s),u=this.getViewStatesForPage().viewStates,c=this.getViewConfigStore().getViewState(this.props.sheetId),d=i.getSignalNamesViewStatesSend(u,o),f=this.props.currentSlice,h;h=u.map(function(r){r=i.addSignalAndListenerToViewStates(r,c,s,l,o,d,e,f);t.setViewState(r);return r});h=h.concat(this.findViewStatesWithSignals(d).map(function(e){e=i.updateViewStateWithSignal(e,a,d);t.setViewState(e);return e}));this.saveViewStates(h)},handleUnsyncAllOnPage:function(e){var t=this.getViewStatesForPage().viewStates,r=i.findSyncSignalInState(t.first(),p(e)),n=p(e);this.removeSyncSignalFromViewState(t,r.get("name"),n)},handleUnsyncThis:function(e){var t=p(e),r=this.getViewConfigStore().getViewState(this.props.sheetId),o=i.findSyncSignalInState(r,t),a=o.get("name"),s=n.List([a]),l,u,c,r=i.removeSyncSignalFromViewState(r,a,t);this.setViewState(r);c=n.List([r]);l=this.findViewStatesWithSignals(s);if(l.size>1){u=i.getSyncSignalName(e,+new Date);l=l.map(function(e){e=i.updateViewStateWithSignal(e,u,s);this.setViewState(e);return e},this)}if(l.size===1){l=i.removeSyncSignalFromViewState(l.first(),a,t);this.setViewState(l);l=n.List([l])}c=c.concat(l);this.saveViewStates(c)},handleSyncWith:function(e,t){var o=this,a=e.get("id"),s=p(a),l=n.List(),u=n.Map(),c=o.getViewConfigStore(),d=i.createSignalComparator(s),f=c.getViewState(o.props.sheetId),h=f.getIn(v,n.List()).find(d),g=i.getSyncSignalName(a,+new Date),y=i.buildSyncSignal(g,a),b=i.buildSyncListenerFromSignal(y),w=this.props.currentSlice,C,E=n.List();r.forEach(t,function(e,t){if(e.sheet){u=u.set(t,c.getViewState(t))}else if(e.signal){l=l.push(t)}});if(h){if(t[m.SYNCED_WITH_CURRENT_SHEET]){l=l.push(h.get("name"))}else{C=o.findViewStatesWithSignals(n.List([h.get("name")]));E=E.concat(C.reduce(function(e,t){if(t.get("id")!==f.get("id")){t=i.removeSyncSignalFromViewState(t,h.get("name"),s);o.setViewState(t);e=e.push(t)}return e},n.List()));u=u.set(f.get("id"),f)}}else{u=u.set(f.get("id"),f)}l=l.concat(i.getSignalNamesViewStatesSend(u,d));E=E.concat(u.map(function(t){t=i.addSignalAndListenerToViewStates(t,f,y,b,d,l,e,w);o.setViewState(t);return t}));E=E.concat(o.findViewStatesWithSignals(l).map(function(e){e=i.updateViewStateWithSignal(e,g,l);o.setViewState(e);return e}));this.saveViewStates(E)},openSyncWithDialog:function(e){var t=e.get("id"),r=m.SYNCED_WITH_CURRENT_SHEET,o=m.SYNCED,a=m.UNSYNCED,s=this.getViewConfigStore().getViewState(this.props.sheetId),l=p(t),u=i.findSyncSignalInState(s,l),c=u&&u.get("name"),d=this.findViewStatesHierarchyWithSlice(t),f,g=n.List();f=i.groupHierarchyBySyncedSignal(d,c,l,s.get("id"));if(f.has(r)){g=g.push(i.createTreeGroup(f.get(r),r,r))}if(f.has(a)){f.get(a).forEach(function(e,t){var r=e.get("children");if(r&&r.size>1){r.forEach(function(t){var r=e.set("children",n.List([t]));g=g.push(i.createTreeGroup(n.List([r]),t.get("id"),a))})}else{g=g.push(i.createTreeGroup(n.List([e]),t,a))}})}f.forEach(function(e,t){if(t!==r&&t!==a){g=g.push(i.createTreeGroup(e,t,o))}});this.props.modelerApp.getModalWindowsActionHandler().openWindow(h.PAGES_SYNC_DIALOG,{qualifiedName:t,syncHandler:this.handleSyncWith.bind(this,e),tree:{children:g.toJS()}})},removeSyncSignalFromViewState:function(e,t,r){e=e.map(function(e){e=i.removeSyncSignalFromViewState(e,t,r);this.setViewState(e);return e},this);this.saveViewStates(e)},getViewStatesForPage:function(){var e=this.props.modelerApp.getViewConfigStore(),t=this.getCurrentPageViewId(),i=e.getViewState(t),r=i.get("views").filter(function(e){return e.get("module")===b.Sheet}).map(function(t,i){return e.getViewState(i)}).toList();return{pageId:t,viewStates:r}},getCurrentPageViewId:function(){return this.getViewConfigStore().getViewState(g).get("views",n.List()).findKey(function(e){return e.get("module")===b.Page})},render:function(){var t=r.extend({ref:"component",createSyncMenuItems:this.createSyncMenuItems},this.props);return o.createElement(e,t)},statics:{getSyncSignalName:r.partial(s,"Sync"),removeSyncSignalFromViewState:function(e,t,i){return e.updateIn(v,n.List(),function(e){return e.filterNot(function(e){return e.get("name")===t&&e.get("emitterId")===i&&e.get("eventName")===c.SLICE_CHANGE.name})}).updateIn(f,n.List(),function(e){return e.filterNot(function(e){return e.get("signalName")===t&&e.get("listenerId")===i})})},buildSyncSignal:function(e,t){return n.fromJS({dataType:c.SLICE_CHANGE.dataType,emitterId:p(t),eventName:c.SLICE_CHANGE.name,name:e})},addInitValueToSyncSignal:function(e,t,i){var r=t.getIn([i.get("id"),"id"]);if(r){e=e.set("init",n.fromJS({value:[{qualifiedName:i.get("id"),positions:[r]}],dateUpdate:+new Date+""}))}return e},buildSyncListenerFromSignal:function(e){return n.fromJS({signalName:e.get("name"),listenerId:e.get("emitterId"),handler:d.CHANGE_SLICE.handler})},findSyncSignalInState:function(e,t){var i,r=e.getIn(v,n.List()).find(function(e){return e.get("eventName")===c.SLICE_CHANGE.name&&e.get("emitterId")===t});if(r){i=e.getIn(f,n.List()).find(function(e){return e.get("signalName")===r.get("name")&&e.get("listenerId")===t})}return i&&r},areViewsSynced:function(e,t){var r=p(e),o=t;if(t.size===1){return!!i.findSyncSignalInState(t.first(),r)}t=t.filter(function(e){return e.hasIn(v)&&e.hasIn(f)});if(t.size===o.size){t=t.filter(function(e){var i=e.getIn(v,n.List());var o=t.filter(function(t){if(e.get("id")!==t.get("id")){var o=t.getIn(f,n.List());return i.find(function(e){return o.find(function(t){return e.get("name")===t.get("signalName")&&e.get("eventName")===c.SLICE_CHANGE.name&&e.get("emitterId")===r&&t.get("listenerId")===r})})}return false});return o.size===t.size-1});return t&&t.size===o.size}return false},createViewSyncHierarchyTree:function(e,t){return e.reduce(function(e,r){var o=n.Map({id:r.get("id"),label:r.get("title")||r.get("id")}),a;if(r.has("children")){a=i.createViewSyncHierarchyTree(r.get("children"),t);if(!a.size){return e}o=o.set("isOpen",true);o=o.set("children",a)}return e.push(o)},n.List())},groupHierarchyBySyncedSignal:function(e,t,r,o){return e.reduce(function(e,a){if(a.get("id")===o){return e}var s,l;if(a.has("children")){s=i.groupHierarchyBySyncedSignal(a.get("children"),t,r,o);s.forEach(function(t,i){e=e.update(i,n.Map(),function(e){a=a.set("children",t);return e.set(a.get("id"),a)})})}else{l=i.findSyncSignalInState(a,r);if(l){e=e.update(l.get("name")===t?m.SYNCED_WITH_CURRENT_SHEET:l.get("name"),n.List(),function(e){return e.push(a)})}else{e=e.update(m.UNSYNCED,n.List(),function(e){return e.push(a)})}}return e},n.Map())},createTreeGroup:function(e,t,r){if(r===m.UNSYNCED){t=i.findSheetId(e.first())}return n.Map({id:t,syncState:r,group:true,children:i.createViewSyncHierarchyTree(e,t)})},findSheetId:function(e){if(e.has("children")){return i.findSheetId(e.getIn(["children",0]))}else{return e.get("id")}},numberOfSyncedViews:function(e,t){t=t||0;e.forEach(function(e){if(e.has("children")){t+=i.numberOfSyncedViews(e.get("children"))}else{t+=1}});return t},updateViewStateWithSignal:function(e,t,i){i=i||n.List();return e.updateIn(v,n.List(),function(e){return e.map(function(e){if(i.contains(e.get("name"))){e=e.set("name",t)}return e})}).updateIn(f,n.List(),function(e){return e.map(function(e){if(i.contains(e.get("signalName"))){e=e.set("signalName",t)}return e})})},createSignalComparator:function(e){var t=a.create({eventName:c.SLICE_CHANGE.name,emitterId:e});return t()},getSignalNamesViewStatesSend:function(e,t){return e.reduce(function(e,i){var r=i.getIn(v,n.List()).find(t);return r?e.push(r.get("name")):e},n.List())},addSignalAndListenerToViewStates:function(e,t,r,o,a,s,l,u){return e.updateIn(v,n.List(),function(n){n=n.filterNot(a);if(e.get("id")===t.get("id")){return n.push(i.addInitValueToSyncSignal(r,u,l))}return n.push(r)}).updateIn(f,n.List(),function(e){e=e.filterNot(function(e){return s.contains(e.get("signalName"))&&e.get("listenerId")===o.get("listenerId")});return e.push(o)})}}});return i}},{"../constant":256,"../util":357,"../util/comparator":359,"../util/viewlayoututils":367,"./sheet_view_signals":486,immutable:"immutable",lodash:70,popupmenu:146,react:"react"}],451:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.PropTypes;var a=e("treebrowser").view.TreeBrowser;var s=e("../constant").ButtonTypes;var l=e("./modalwindow").ModalWindow;var u=e("./panelbutton").PanelButton;var c=e("../constant").PagesSyncStates;var d=n.createClass({displayName:"Pages Sync Dialog",propTypes:{qualifiedName:o.string.isRequired,syncHandler:o.func.isRequired,tree:o.object.isRequired},getInitialState:function(){return d.mapPropsToState(this.props)},componentWillReceiveProps:function(e){this.setState(d.mapPropsToState(e))},isSynced:function(e){return this.state.synced[e]},groupElement:function(e,t){var i=e.treeNode.nodeObj,r=this.isSynced(i.id),o={className:"lb-synced-views-group "+(r?" in-sync":"")},a={className:r?"fa fa-link":"fa fa-chain-broken"},s=n.DOM.span({className:"lb-help-text"},d.getHelpText(i,r)),l=n.DOM.div({className:"lb-synced-views-tree"},t);return n.DOM.div(o,l,n.DOM.div({className:"controls-container",onClick:this.changeSync.bind(this,i)},n.DOM.i(a),s))},changeSync:function(e){var t=this.state.synced;if(t[e.id]){delete t[e.id]}else{t[e.id]=d.buildGroupDescriptor(e)}this.setState({synced:t})},syncHandler:function(){this.props.syncHandler(this.state.synced);this.props.closeWindow()},nothingToSync:function(){return this.props.tree.children.length===0},renderTreeBrowser:function(){var e;if(this.nothingToSync()){e=n.DOM.div({className:"no-pages"},'No sheets with the "'+this.props.qualifiedName+'" page.')}else{e=n.createElement(a,{tree:this.props.tree,filterable:true,groupElement:this.groupElement})}return e},renderSyncButton:function(){return n.createElement(u,{key:"sync-button",type:s.OK,text:"Sync",onClick:this.syncHandler})},renderCancelButton:function(){return n.createElement(u,{key:"cancel-button",type:s.CANCEL,text:"Cancel",onClick:this.props.closeWindow})},render:function(){var e=n.DOM.div(null,n.DOM.label(null,"Select sheets to sync with..."),this.renderTreeBrowser()),t=n.DOM.div(null,[this.nothingToSync()?null:this.renderSyncButton(),this.renderCancelButton()]);return n.createElement(l,{visible:true,title:"Slice Sync: "+this.props.qualifiedName,body:e,footer:t,windowClass:"lb-pages-sync-dialog"})},statics:{buildGroupDescriptor:function(e){if(e.syncState===c.SYNCED){return{signal:true}}if(e.syncState===c.UNSYNCED){return{sheet:true}}return{currentSheet:true}},mapPropsToState:function(e){var t={};e.tree.children.forEach(function(e){if(e.syncState===c.SYNCED_WITH_CURRENT_SHEET){t[e.id]=true}});return{synced:t}},getHelpText:function(e,t){if(e.syncState===c.SYNCED_WITH_CURRENT_SHEET){if(t){return"These sheets are already in sync with the current sheet."}else{return"Current sheet will be unsynchronized from these sheets."}}if(e.syncState===c.UNSYNCED){if(t){return"This sheet will be synchronized with the current sheet."}else{return"This sheet is not in sync w/ any sheet."}}if(t){return"These sheets will be synchronized with the current sheet."}else{return"These sheets are synchronized. Click the button to synchronize this group of sheets with the current sheet."}}}});t.exports=d},{"../constant":256,"./modalwindow":437,"./panelbutton":454,lodash:70,react:"react",treebrowser:202}],452:[function(e,t,i){"use strict";var r=e("immutable");var n=e("react");var o=e("lodash");var a=e("./layoutview");var s=e("./sheetview");var l=e("./view");var u=e("../util/viewlayoututils");var c=e("../constant");var d=c.Layout;var p=c.View;var f={shape:{rows:"1",columns:"1"},viewPositions:{}};f.viewPositions[p.Modules.ContentPresenter]={col:0,row:0};var h=[p.Modules.ModelBrowser,p.Modules.Measures];var g=n.createClass({displayName:"PageView",propTypes:{id:n.PropTypes.string.isRequired,uniqueId:n.PropTypes.string.isRequired,modelerApp:n.PropTypes.object.isRequired,mode:n.PropTypes.string,config:n.PropTypes.object.isRequired,setViewState:n.PropTypes.func.isRequired},setViewState:function(e,t){var i=this.props.modelerApp.getViewConfigActionHandler();if(t&&u.isViewInline(this.props.config,t)){e=u.setInlineViewStateById(this.props.config,t,e);t=this.props.id}return this.props.setViewState(e,t)},getInlineViewState:function(e){var t=u.getInlineViewStateById(this.props.config,e);return t&&(t.get("config")||t)},buildViews:function(e){var t=this,i=this.props.uniqueId,r=this.props.modelerApp,e=this.props.config,o;return e.get("views").map(function(a,s){o=u.isViewInline(e,s)&&t.getInlineViewState(s);return n.createElement(l,{key:s,id:s,parentUniqueId:i,modelerApp:r,mode:u.getCurrentViewModeInParentLayout(s,e),config:o||undefined,setViewState:t.setViewState})}).toList()},render:function(){var e=g.processConfig(this.props.config),t=o.extend({},this.props,{config:e});return n.createElement(a,t,this.buildViews(e))},statics:{processConfig:function(e,t){var i=e,n,o;t=t||u.getCurrentViewMode(e);if(t===d.VIEW_MODE.CONFIGURATION){o=u.findViewsInViewMode(i,t)[0];i=i.set("layout",r.fromJS(f));i=i.setIn(["layout","viewPositions",o],i.getIn(["layout","viewPositions",p.Modules.ContentPresenter]));i=i.deleteIn(["layout","viewPositions",p.Modules.ContentPresenter]);i=i.updateIn(["views"],function(e){return r.Map().set(o,e.get(o))})}return s.processConfig(i)},isViewModuleAllowed:function(e,t){return h.indexOf(e)===-1}}});t.exports=g},{"../constant":256,"../util/viewlayoututils":367,"./layoutview":422,"./sheetview":488,"./view":517,immutable:"immutable",lodash:70,react:"react"}],453:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-dom");var a=e("classnames");var s=e("./okcancelbuttons");var l=n.createClass({displayName:"Pane",propTypes:{title:n.PropTypes.string,content:n.PropTypes.element.isRequired,buttons:n.PropTypes.instanceOf(s),paneClassSet:n.PropTypes.object},render:function(){var e=a(r.merge(this.props.paneClassSet||{},{pane:true,panel:true,"panel-default":true}));return n.DOM.div({className:e},this.props.title?n.DOM.div({className:"panel-heading",ref:"title"},n.DOM.div({className:"panel-title"},this.props.title)):undefined,n.DOM.div({className:a("panel-body",{"panel-without-footer":!this.props.footer}),ref:"content"},this.props.content),this.props.footer?n.DOM.div({className:"panel-footer"},this.props.footer):undefined)},componentDidMount:u,componentDidUpdate:u});function u(){var e=o.findDOMNode(this.refs.title).offsetHeight,t=o.findDOMNode(this.refs.content);t.style.top=e.toString()+"px"}i.Pane=l},{"./okcancelbuttons":448,classnames:6,lodash:70,react:"react","react-dom":"react-dom"}],454:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("./spinner").FontAwesomeSpinner;var a=e("../constant").ButtonTypes;var s=e("classnames");var l={};l[a.OK]={"btn-ok":true,"btn-primary":true};l[a.CANCEL]={"btn-cancel":true,"btn-default":true};l[a.YES]={"btn-yes":true,"btn-primary":true};l[a.NO]={"btn-no":true,"btn-default":true};l[a.CALCULATE]={"btn-confirm":true,"btn-primary":true};l[a.CONFIRM]={"btn-confirm":true,"btn-primary":true};l[a.CONTINUE]={"btn-continue":true,"btn-warning":true};l[a.DISCARD]={"btn-discard":true,"btn-warning":true};var u=n.createClass({displayName:"PanelButton",propTypes:{type:n.PropTypes.string.isRequired,text:n.PropTypes.string,onClick:n.PropTypes.func,classSet:n.PropTypes.object,isSpinning:n.PropTypes.bool,isDisabled:n.PropTypes.bool},getDefaultProps:function(){return{type:a.OK,classSet:l}},handleClick:function(e){if(typeof this.props.onClick==="function"){this.props.onClick(e,this.props.type)}},render:function(){var e=this.props.classSet&&this.props.classSet[this.props.type]||{};var t=this.props.text||this.props.type;var i=s(r.merge(e,l[this.props.type],{btn:true,"panel-button":true}));var a=this.props.isSpinning!==true?null:n.createClass(o,{visible:true,inline:true});return n.DOM.button({type:"button",className:i,onClick:this.handleClick,disabled:this.props.isDisabled},t,a)}});i.PanelButton=u},{"../constant":256,"./spinner":502,classnames:6,lodash:70,react:"react"}],455:[function(e,t,i){"use strict";var r=e("lodash");var n=e("assert");var o=e("immutable");var a=e("../../modelerstate");var s=e("../../util");var l=e("../../cubiql");var u=e("../../multiaxisconfig");var c=u.FieldTypes;var d=e("../../constant/gridoptions");var p=r.map(r.values(d.CONDITIONALS),"name");var f=t.exports;f.convertOldPivotConfigToNew=function(e,t){if(!e.aggregate)return e;var i=r.cloneDeep(e);r.forEach(i.aggregate,function(e,n){var o=e.qualifiedName||n,a=l.isMeasure(o),s=!a,c=s&&l.parseDimLvl(o).dimension,d,p,f;r.some(i.axis,function(e,t){var i;d=r.find(e,function(e){return e.qualifiedName===o});i=s&&!d&&r.findIndex(e,function(e){return!l.isMeasure(e.qualifiedName)&&l.parseDimLvl(e.qualifiedName).dimension===c});if(d){return true}else if(s&&i>-1){p=t;f=i}});if(d){if(d.rollup)console.warn("discarding aggregate definition for '"+o+"' in sheet '"+t+"' because the associated field already has a rollup defined.");else d.rollup={
methodName:e.method||"DEFAULT"}}else if(s&&f>-1){i.axis[p].splice(f,0,P(o,undefined,u.LevelDisplayMode.NONE,{methodName:e.method||"DEFAULT"}))}else{throw Error("Could not convert agg aggDef "+JSON.stringify(e)+". Could not find axis with dimension ''"+c+"' in sheet '"+t+"'")}});delete i.aggregate;return i};var h=f.PivotState=o.Record({id:undefined,axis:o.Map({X:o.List(),Y:o.List(),Z:o.List()}),sliceValues:o.Map(),measureGroups:o.Map(),dropdownMeasureFilter:o.List(),filter:o.Map(),maskFilter:o.List(),sliceValueMeasure:o.Map(),isNonEmpty:false,scrollPositions:undefined,moveSelectionDirection:undefined,displayOptions:o.Map(),conditionalFormatting:o.Map()});f.pivotStateFromPivotConfig=function(e,t,i,r){var s=f.convertOldPivotConfigToNew(i,t),l,u;l=o.fromJS(s);u=new h({id:t});u=ie(e,u,"-:Measures");if(r&&r.display){u=u.set("displayOptions",o.fromJS(r.display))}if(r&&r.conditionalFormatting){u=this.setConditionalFormatting(u,r.conditionalFormatting)}if(l.hasIn(["axis","x"])){u=u.setIn(["axis","X"],A(e,l.getIn(["axis","x"])))}if(l.hasIn(["axis","y"])){u=u.setIn(["axis","Y"],A(e,l.getIn(["axis","y"])))}if(l.hasIn(["axis","slice"])){u=u.setIn(["axis","Z"],A(e,l.getIn(["axis","slice"])));l.getIn(["axis","slice"]).forEach(function(e){if(e.has("value")){u=u.setIn(["sliceValues",e.get("qualifiedName")],e.get("value"))}})}u=U(u,l.get("sort"));if(l.hasIn(["axis","z"])){u=re(e,u,"-:Measures",l.getIn(["axis","z"]).map(function(e){return e.get("qualifiedName")}))}if(l.has("filter")){u=u.set("filter",l.get("filter"))}if(l.has("maskFilter")){u=H(e,u,l.get("maskFilter"))}if(l.has("isNonEmpty")){u=u.set("isNonEmpty",l.get("isNonEmpty"))}if(l.has("scrollPositions")){u=u.set("scrollPositions",l.get("scrollPositions"))}if(l.has("moveSelectionDirection")){u=u.set("moveSelectionDirection",l.get("moveSelectionDirection"))}if(l.has("dropdownMeasureFilter")){u=u.set("dropdownMeasureFilter",l.get("dropdownMeasureFilter"))}if(l.has("sliceValueMeasure")){u=u.set("sliceValueMeasure",l.get("sliceValueMeasure").reduce(function(t,i){var r=a.fields.getField(e.fields,i.get("qualifiedName"),c.LEVEL);n(!!r,"Could not find field for slice by measure with qualified name: "+i.get("qualifiedName"));return t.set(r,i.get("measure"))},o.Map()))}if(l.has("sort-by-measure-value")){u=f.setSortByMeasureValue(e,u,l.getIn(["sort-by-measure-value","metricName"]),l.getIn(["sort-by-measure-value","floatingAxis"]).toUpperCase(),l.getIn(["sort-by-measure-value","sortPositions"]).toJS(),l.getIn(["sort-by-measure-value","sortOrder"]))}return u};f.moveField=function(e,t,i,r,n){t=f.moveToAxis(e,t,i,r,n);if(r==="Z"){t=W(t,i)}t=G(e,t);return t};f.removeField=function(e,t,i){t=ee(e,t,i);if(i instanceof u.MeasureField){t=f.setMeasureFilter(t,i.id)}else if(i instanceof u.LevelField){t=f.setFilter(t,i.id,null)}else if(i instanceof u.DimensionField){t=i.fields.reduce(function(e,t){return f.setFilter(e,t.id,null)},t)}t=t.deleteIn(["sliceValues",i.id]);t=G(e,t);return t};f.hasField=function(e,t,i){return!r.isUndefined(f.getField(e,t.get("id"),i))};f.getField=function(e,t,i){return x(e,function(e){return e&&e.get("id")===t},i).first()};f.findField=function(e,t){var i=x(e,function(e){return e.get("id")===t});if(i.size>1){throw new Error("Found more than one field with id: "+t+". "+JSON.stringify(i))}return i.first()};f.computeBaseLevelFields=function(e,t){var i=[];t.axis.forEach(function(t){t.forEach(function(t){var r;if(t instanceof u.LevelField){r=u.getHierarchyForLevelFields(new o.List([t]),e.measureModel);i.push(u.updateHierarchyInLevelField(t,r.name))}else if(t instanceof u.DimensionField){r=u.getHierarchyForLevelFields(t.fields,e.measureModel);i.push(u.updateHierarchyInLevelField(t.fields.last(),r.name))}})});return new o.List(i)};f.computeBaseIntersection=function(e,t){return new o.List(f.computeBaseLevelFields(e,t).map(function(e){return e.level}))};f.getVisibleMeasures=function(e){return e.getIn(["measureGroups","-:Measures"])};f.getAxis=function(e,t){return e.getIn(["axis",t])};f.getSliceMeasure=function(e,t){return e.getIn(["sliceValueMeasure",t])};f.getRollupFields=function(e){return x(e,function(e){return e.has("rollupConfigs")&&e.rollupConfigs.size>0})};f.getFilters=function(e){return e.getIn(["filter"])};f.getSortByMeasureValue=function(e){var t,i;t=x(e,D).first();if(t){i=C(e,t.id);if(i==="Z")return;return o.fromJS({field:t,floatingAxis:i,sortAxis:y(i)})}};f.getScrollPositions=function(e){return e.getIn(["scrollPositions"])};f.getMoveDirection=function(e){return e.getIn(["moveSelectionDirection"])};f.isNonEmpty=function(e){return!!e.get("isNonEmpty")};f.getMaskFilter=function(e){return e.getIn(["maskFilter"])};f.indexInAxis=function(e,t,i){var r=_(e,t.get("id"),i);if(r.length>0)return r[r.length-1];return-1};f.indexInFields=function(e,t){return e.findIndex(function(e){return f.fieldsMatch(e,t)||(e.fields||[]).some(function(e){return f.fieldsMatch(e,t)})})};f.fieldsMatch=function(e,t,i){return o.is(e,t)||!i&&e.id===t.id};f.axisContainsOtherFieldsWithDimension=function(e,t,i,r){if(!(r instanceof u.LevelField||r instanceof u.DimensionField))return false;var n=g(r);return R(ee(e,t,r),i,n)};function g(e){if(!(e instanceof u.LevelField||e instanceof u.DimensionField))return;return e instanceof u.LevelField?e.level.dimensionName:e.dimension}f.isAllField=function(e){return e instanceof u.LevelField&&e.level.levelName==="ALL"};f.containsAllField=function(e){if(e instanceof u.DimensionField){return e.fields.some(f.isAllField)}return f.isAllField(e)};f.canMoveInto=function(e,t,i,r,n){ne(i);if(this.hasField(t,r)&&!n){return false}if(r instanceof u.MeasureGroupField){return true}if(r instanceof u.MeasureField){return i!=="Z"}if(f.containsAllField(r)&&i==="Z"){return false}if(i==="Z"&&r instanceof u.LevelField&&this.hasHigherLevelOnXOrY(e,t,r)){return false}if((i==="X"||i==="Y")&&r instanceof u.LevelField&&this.hasLowerLevelOnZ(e,t,r)){return false}var a=ee(e,t,r),s=g(r),l=e.measureModel,c=function(e){return g(e)===s},d=r instanceof u.DimensionField?r.get("fields"):o.List([r]),p=T(a,i).filter(c).concat(d).map(function(e){return e.level.levelName}).filter(function(e){return e!=="ALL"}),h=l.findHierarchiesWithLevels(s,p).length>0;if(f.isAllField(r)){return p.size>0}else{return h}};f.hasHigherLevelOnXOrY=function(e,t,i){var r=this,n=g(i),o=e.measureModel.getParents(n,i.level.levelName);return["X","Y"].reduce(function(e,a){return e||T(t,a).reduce(function(e,t){return e||!r.fieldsMatch(i,t)&&g(t)===n&&o.has(t.id)},false)},false)};f.hasLowerLevelOnZ=function(e,t,i){var r=this,n=g(i);return T(t,"Z").reduce(function(t,o){return t||!r.fieldsMatch(i,o)&&g(o)===n&&e.measureModel.getParents(n,o.level.levelName).has(i.id)},false)};function m(e){return e.has("rollupConfigs")&&e.rollupConfigs.size>0}f.hasRollup=m;function v(e){var t=x(e,m),i={};t.forEach(function(e){if(e instanceof u.LevelField)i[e.id]={qualifiedName:e.id,method:e.rollupConfigs.getIn([0,"methodName"])}});return i}f.getConfig=function(e){var t=f.getVisibleMeasures(e),i=t&&t.get("fields").map(function(e){return{qualifiedName:e.get("id")}}).toJS(),n=q(e),a=e.get("filter"),s=e.get("sliceValueMeasure"),l=e.get("dropdownMeasureFilter"),c=e.get("maskFilter").map(function(e){return e.get("id")}),d=e.get("scrollPositions"),p=e.get("moveSelectionDirection"),h=e.get("isNonEmpty"),g={id:e.get("id"),axis:{x:F(e,"X"),y:F(e,"Y"),slice:F(e,"Z"),z:i||[]},scrollPositions:d&&d.toJS()||{}};function m(e){var t=f.getFieldAttributeSort(e);if(t){g.sort[e.id]=t}}if(!r.isEmpty(n)){delete n.floatingLevel;g["sort-by-measure-value"]=n}if(p)g.moveSelectionDirection=p;if(!r.isUndefined(h))g.isNonEmpty=h;if(a.size>0)g.filter=a.toJS();if(l.size>0)g.dropdownMeasureFilter=l.toJS();if(c.size>0)g.maskFilter=c.toJS();if(s.size>0)g.sliceValueMeasure=s.reduce(function(e,t,i){return e.push({qualifiedName:i.get("id"),measure:t})},o.List()).toJS();g.sort={};e.axis.forEach(function(e){e.forEach(function(e){if(e instanceof u.LevelField){m(e)}else if(e instanceof u.DimensionField){e.fields.forEach(function(e){m(e)})}})});return{id:e.get("id"),pivotConfig:g,gridOptions:{display:e.displayOptions.toJS(),conditionalFormatting:e.conditionalFormatting.toJS()}}};f.hasFilter=function(e,t){return!!e.getIn(["filter",t])};function y(e){n(e==="X"||e==="Y");return e==="X"?"Y":"X"}function b(e,t){var i=_(e,t.get("id"));return i[i.length-2]==="fields"}function w(e,t){var i=_(e,t.get("id"));if(i.length===0)return e;return e.setIn(i,t)}function C(e,t){var i=_(e,t);if(i.length>=2)return i[1]}f.findAxisForField=C;function E(e,t){var i=e.axis,r=i.keySeq().toArray().find(function(e){return i.get(e).find(function(e){return e.id===t})});return r}f.findAxisForMeasureField=E;function S(e){return e.has("fields")}function T(e,t){return x(e,s.not(S),t)}f.getFieldsForAxis=T;function x(e,t,i){return e.get("axis").reduce(function(e,r,n){if(i&&i!==n)return e;r.forEach(function(i){if(i.has("fields")){e=e.concat(i.get("fields").filter(t))}if(t(i)){e=e.push(i)}});return e},o.List())}f.getAxisFields=x;function _(e,t,i){var r=[];e.get("axis").some(function(e,n){if(i&&n!==i)return false;return e.some(function(e,i){var o=e.get("id")===t;if(e.has("fields")&&!o){o=e.get("fields").some(function(e,o){if(e.get("id")===t){r=["axis"].concat(n,i,"fields",o);return true}})}else{if(o){r=["axis"].concat(n,i)}}return o})});return r}f.findPathToField=_;function M(e,t){return f.getVisibleMeasures(e).get("fields").some(function(e){return e.get("id")===t})}function A(e,t){return O(e,I(e,t))}function I(e,t){return t.map(function(t){var i=a.fields.getFieldFromQualifiedName(e.fields,t.get("qualifiedName"));n(!!i,"Could not find field with qualifiedName: "+t.get("qualifiedName"));if(i instanceof u.LevelField){i=i.set("displayMode",u.LevelDisplayMode[t.get("displayMode")]||u.LevelDisplayMode.OUTLINE);if(t.get("rollup")){i=i.set("rollupConfigs",new o.List([u.mkRollupConfig({methodName:t.getIn(["rollup","methodName"])})]))}}return i})}function O(e,t){var i=t.groupBy(function(e){if(e instanceof u.LevelField){return o.Map({type:c.DIMENSION,name:g(e)})}else if(e instanceof u.MeasureField){return o.Map({type:c.MEASURE,name:e.get("id")})}else if(e instanceof u.MeasureGroupField){return o.Map({type:c.MEASURE_GROUP,name:e.get("id")})}else{throw new Error("Unknown field type "+JSON.stringify(e))}}),r=u.compareLevelFields.bind(null,e.measureModel);return i.entrySeq().map(function(t){var i=t[0],n=t[1];if(i.get("type")===c.DIMENSION){if(n.size===1){return n.get(0)}else{return a.fields.getField(e.fields,i.get("name"),c.DIMENSION).set("fields",n.sort(r).reverse())}}else{return n.get(0)}}).toList()}function D(e){return!!N(e)}f.hasSortMeasure=D;function N(e){return e instanceof u.LevelField&&e.sortConfigs.find(function(e){return!!e.measure.metric})}function R(e,t,i){return!!te(e,t,i)}function P(e,t,i,r){var n={qualifiedName:e,displayMode:i||u.LevelDisplayMode.OUTLINE};if(r){n.rollup=r}if(t){n.value=t}return n}function L(e,t){var i={qualifiedName:e};if(t){i.value=t}return i}function k(e){var t={qualifiedName:e};return t}f.getSliceValueForField=function(e,t){return e.sliceValues.get(t)};function $(e){if(e&&e.size)return{methodName:e.get(0).methodName}}function F(e,t){return e.getIn(["axis",t]).map(function(t){if(t instanceof u.LevelField){return P(t.get("id"),f.getSliceValueForField(e,t.get("id")),t.get("displayMode"),$(t.get("rollupConfigs")))}else if(t instanceof u.MeasureField){return k(t.get("id"))}else if(t instanceof u.MeasureGroupField){return L(t.get("id"),f.getSliceValueForField(e,t.get("id")))}else if(t instanceof u.DimensionField){return t.get("fields").map(function(t){return P(t.get("id"),f.getSliceValueForField(e,t.get("id")),t.get("displayMode"),$(t.get("rollupConfigs")))})}}).flatten(true).toJS()}function V(e){var t=N(e),i=u.levelToQualifiedLevel(e.level),n=t.measure.metric.name,o=t.sortType,a=t.measure.metric.filters.map(function(e){var t=e.measure.attribute,i=t&&u.levelToQualifiedLevel(t.level),n=e.comparisons.get(0),o=n&&n.comparator,a=o&&o.literal;if(!r.isUndefined(a)){return{qualifiedLevel:i,memberId:a}}});return{floatingLevel:i,metricName:n,sortOrder:o,sortPositions:a}}f.getSortByMeasureValueInfoFromField=V;f.getSortByMeasureValueConfig=function(e){var t=f.getSortByMeasureValue(e);if(t){return q(e)}};function q(e){var t=f.getSortByMeasureValue(e),i,r={};if(t){i=f.getSortByMeasureValueInfoFromField(t.get("field"));r={floatingAxis:t.get("floatingAxis").toLowerCase(),metricName:i.metricName,sortOrder:i.sortOrder,sortPositions:i.sortPositions.toJS()}}return r}f.storeSliceValues=function(e,t,i){var o,a,s,c,d,p,h,g,m=u.compareLevelFields.bind(null,e.measureModel);p=r.reduce(i,function(e,i,r){h=l.parseDimLvl(r).dimension;g=f.getField(t,r,"Z");n(g,"Could not find field '"+r+"' on the Z axis!");e[h]=e[h]||[];e[h].push({field:g,value:i});return e},{});r.forEach(p,function(e){e=e.sort(function(e,t){return m(e.field,t.field)}).reverse();c=e[e.length-1].field;d=e[e.length-1].value;o=_(t,c.id,"Z");a=b(t,c);o=a?o.slice(0,-1):o;s=t.getIn(["sliceValues",c.get("id")]);if(s!==d){if(a){t.getIn(o).forEach(function(e){t=t.deleteIn(["sliceValues",e.get("id")])})}e.forEach(function(e){t=t.update("sliceValues",function(t){return t.set(e.field.id,e.value)})});t=W(t,c)}});return t};f.setFilter=function(e,t,i){var r,n,a,s=o.fromJS(i);if(s&&s.size>0){e=e.setIn(["filter",t],s)}else{e=e.deleteIn(["filter",t])}r=_(e,t,"Z");n=e.getIn(r);a=f.getSliceValueForField(e,t);if(a&&s&&!s.has(a)){e=e.set("sliceValues",e.sliceValues.set(t,s.keySeq().first()))}return e};function H(e,t,i){var r=o.List(i).map(function(t){return a.fields.getField(e.fields,t,c.MEASURE)});return t.set("maskFilter",r)}f.setMaskFilter=H;f.setMeasureFilter=function(e,t,i){return e.update("filter",function(e){if(!i||!Object.keys(i).length){return e.delete(t)}else{return e.set(t,o.fromJS(i))}})};f.setRollupForField=function(e,t,i,r){var o=_(e,t.get("id"),r);n(o.length,"Couldn't find field '"+t.id+"' in PivotState");return e.updateIn(o,function(e){return u.setRollupForField(e,i)})};f.removeRollupForField=function(e,t,i){var r=_(e,t.get("id"),i);n(r.length,"Couldn't find field '"+t.id+"' in PivotState");return e.updateIn(r,u.removeRollupForField)};f.enableOutlineForField=function(e,t,i){var r=_(e,t.get("id"),i);n(r.length,"Couldn't find field '"+t.id+"' in PivotState");return e.updateIn(r,function(e){return u.enableOutlineForField(e)})};f.disableOutlineForField=function(e,t,i){var r=_(e,t.get("id"),i);n(r.length,"Couldn't find field '"+t.id+"' in PivotState");return e.updateIn(r,function(e){return u.disableOutlineForField(e)})};f.setSort=function(e,t,i,r){var n=_(e,t);return e.updateIn(n,function(e){if(e instanceof u.LevelField){return e.set("sortConfigs",new o.List([u.mkSortConfig({sortType:i,measure:{attribute:{name:r||"label",level:e.level}}})]))}else{return e}})};function U(e,t){if(!t)return e;t.forEach(function(t,i){e=f.setSort(e,i,t.get("sortType"),t.get("sortAttr"))});return e}f.getFieldAttributeSort=function(e){var t=e.sortConfigs&&e.sortConfigs.find(function(e){return!!e.measure.attribute});if(t){return{qualifiedName:e.id,sortAttr:t.measure.attribute.name,sortType:t.sortType}}};function B(e){return e.update("axis",function(e){return e.map(function(e,t){return e.map(function(e){if(e instanceof u.DimensionField){return e.update("fields",function(e){return e.map(function(e){return e.set("sortConfigs",e.sortConfigs.filter(function(e){return!e.measure.metric}))})})}else if(e instanceof u.LevelField){return e.set("sortConfigs",e.sortConfigs.filter(function(e){return!e.measure.metric}))}else{return e}})})})}f.hasVisibleMeasure=M;f.clearSortByMeasureValue=B;f.setSortByMeasureValue=function(e,t,i,r,o,a){n(r==="X"||r==="Y","Invalid floating axis: "+r);var s=t,l=t.getIn(["axis",r]),c=y(r),d,p=K(t,o,c);if(l.size>1){console.warn("Invalid sort by measure value configuration. Floating axis cannot have more than one dimension.");return t}if(l.size===0){console.warn("Invalid sort by measure value configuration. Floating axis must have at least one level.");return t}t=B(t);d=l.first()instanceof u.DimensionField?l.first().get("fields").last():l.first();t=w(t,z(e,t,d,{metricName:i,sortOrder:a,sortPositions:p}));return Q(t)?t:s};function z(e,t,i,r){var n=f.computeBaseIntersection(e,t),o=r.sortPositions||[];return i.update("sortConfigs",function(t){t=t.filter(function(e){return!e.measure.metric});return t.splice(0,0,new u.SortConfig({measure:new u.Measure({metric:new u.Metric({name:r.metricName,intersection:n,filters:j(e,o)})}),sortType:r.sortOrder}))})}function j(e,t){return new o.List(t.map(function(t){return new u.Filter({measure:new u.Measure({attribute:new u.Attribute({name:"id",level:u.qualifiedLevelToLevel(t.qualifiedLevel,e.measureModel)})}),comparisons:new o.List([new u.Comparison({operator:"=",comparator:new u.Comparator({literal:t.memberId})})])})}))}function G(e,t){var i=f.getSortByMeasureValue(t),r,n,o;if(!i)return t;r=i.get("field");n=V(r);o=K(t,n.sortPositions,i.get("sortAxis"));r=r.update("sortConfigs",function(t){return t.map(function(t){if(t.measure.metric)return t.setIn(["measure","metric","filters"],j(e,o));else return t})});if(!Q(t,r)){return B(t)}else{return w(t,r)}}function W(e,t){var i=f.getSortByMeasureValue(e),r,n,o=g(t);if(!i)return e;r=e.getIn(["axis",i.get("sortAxis")]);n=r.some(function(e){var t=g(e);return t&&o&&t===o});if(n){e=B(e)}if(t instanceof u.MeasureGroupField&&t.id==="-:Measures"){e=B(e)}return e}function Q(e){var t=f.getSortByMeasureValue(e),i=t.get("field"),r=V(i),n=e.getIn(["axis",t.get("floatingAxis")]),o=x(e,function(e){return e.id===r.metricName},r.sortAxis).size>0,a=M(e,r.metricName);if(n.size>1){console.warn("Invalid sort by measure configuration, must have exactly one dimension on the floating axis.");return false}if(n.size===0){console.warn("Invalid sort by measure configuration, must have exactly one dimension on the floating axis.");return false}if(!o){console.warn("Invalid sort by measure configuration, the sort measure does not appear on the axis opposite the floating axis.");return false}if(a&&!J(e,r.sortPositions)){console.warn("Invalid sort by measure configuration, the sort positions are invalid.");return false}return true}function K(e,t,i){if(!t)return t;var r=T(e,i).filter(function(e){return e.type===c.LEVEL});return t.filter(function(e){var t=e.qualifiedLevel;return r.some(function(e){var i=e.get("level");return i.get("dimensionName")===t.dimension&&i.get("levelName")===t.level})})}f.getValidSortPositions=K;function Y(e,t){return e.getIn(["axis",t]).map(function(e){return e instanceof u.DimensionField?e.get("fields").last():e}).filter(function(e){return e instanceof u.LevelField})}f.getLowestLevelFieldsOnAxis=Y;function X(e,t){var i=Y(e,t),r=f.getRollupFields(e).map(function(e){return e.get("id")}).filter(function(e){return i.map(g).includes(l.parseDimLvl(e).dimension)});return i.map(function(e){return e.get("id")}).concat(r).groupBy(function(e){return l.parseDimLvl(e).dimension})}function J(e,t){var i,r=f.getSortByMeasureValue(e).get("sortAxis");if(!t)return true;i=X(e,r);if(i.size===0)return t.size===0;return i.every(function(e){return t.some(function(t){return e.includes(l.qualifiedLevelToQualifiedName(t.qualifiedLevel))})})}f.hideEmptyValues=function(e,t){return e.set("isNonEmpty",t)};function Z(e,t,i,r){var n=i,o;if(D(r)){o=V(r);n=n.updateIn(["fields",i.get("fields").size-2],function(i){return z(e,t,i,{metricName:o.metricName,sortOrder:o.sortOrder,sortPositions:o.sortPositions})})}if(n.get("fields").size===2){return n.get("fields").find(function(e){return e.get("id")!==r.get("id")})}else{return n.update("fields",function(e){return e.filter(function(e){return e.get("id")!==r.get("id")})})}}function ee(e,t,i){var r=_(t,i.get("id")),n,o,a;if(r.length===0)return t;n=r.slice(0,-2);a=b(t,i);if(a&&i instanceof u.LevelField){o=Z(e,t,t.getIn(n),i);if(f.isAllField(o)){return t.deleteIn(n)}else{return t.setIn(n,o)}}else if(a&&i instanceof u.MeasureField){return f.removeMeasureFromGroup(t,t.getIn(n),i)}else{return t.deleteIn(r)}}function te(e,t,i){return e.getIn(["axis",t]).find(function(e){return(e instanceof u.LevelField||e instanceof u.DimensionField)&&g(e)===i})}f.addLevelToField=function(e,t,i,r){n(g(i)===g(r),"Cannot combine two levels from different dimensions.");var s=g(i),l=u.compareLevelFields.bind(null,e.measureModel),d;if(i instanceof u.LevelField){d=a.fields.getField(e.fields,s,c.DIMENSION).set("fields",o.List([i,r]).sort(l).reverse())}else if(i instanceof u.DimensionField){d=i.update("fields",function(e){return e.push(r).sort(l).reverse()})}return d.update("fields",function(i){var r=i.size,n;return i.map(function(i,o){if(o===r-1){if(n){return z(e,t,i,{metricName:n.metricName,sortOrder:n.sortOrder,sortPositions:n.sortPositions})}else{return i}}else if(D(i)){n=V(i);return i.set("sortConfigs",i.sortConfigs.filter(function(e){return!e.measure.metric}))}else{return i}})})};function ie(e,t,i){var r=t.get("measureGroups"),n=r.get(i);if(!n){n=a.fields.getField(e.fields,i,c.MEASURE_GROUP);if(!n){n=new u.MeasureGroupField({id:i,fieldLabel:i})}}return t.set("measureGroups",r.set(i,n))}function re(e,t,i,r){var s=t.get("measureGroups").find(function(e){return e.id===i}),l=o.List(r).map(function(t){var i=a.fields.getField(e.fields,t,c.MEASURE);n(!!i,"Could not find measure in the model with name: "+t);return i});if(!s)return t;return l.reduce(function(e,t){return f.addMeasureToGroup(e,s,t)},t)}f.removeMeasureFromGroup=function(e,t,i){var r=e.getIn(["measureGroups",t.id]),n=r.get("fields"),o=n.indexOf(i),a;if(o===-1)return e;r=r.deleteIn(["fields",o]);e=e.setIn(["measureGroups",r.id],r);a=f.getField(e,r.id);if(a){a=a.set("fields",r.fields);e=w(e,a);if(C(e,a.id)==="Z"&&f.getSliceValueForField(e,r.id)===i.id){if(r.fields.size>0){e=e.setIn(["sliceValues",r.id],r.fields.first().id)}else{e=e.deleteIn(["sliceValues",r.id])}}}e=f.setMeasureFilter(e,i.id);return e};f.addMeasureToGroup=function(e,t,i,r){n(!!i,"measureField cannot be empty");n(i.type===c.MEASURE,"Field "+i.get("id")+" is not a measure field.");var o=e.getIn(["measureGroups",t.id]),a=o.get("fields"),s=a.indexOf(i),l,u;if(s>=0)a=a.delete(s);u=a.indexOf(r);if(u>=0){o=o.set("fields",a.splice(u,0,i))}else{o=o.set("fields",a.push(i))}e=e.setIn(["measureGroups",o.id],o);l=f.getField(e,o.id);if(l){l=l.set("fields",o.fields);if(C(e,l.id)==="Z"&&!f.getSliceValueForField(e,o.id)){e=e.setIn(["sliceValues",o.id],o.fields.first().id)}e=w(e,l)}return e};function ne(e){if(["X","Y","Z"].indexOf(e)===-1)throw new Error("Axis "+e+" does not exist")}f.moveToAxis=function(e,t,i,r,o){var a=i instanceof u.LevelField,s=f.canMoveInto(e,t,r,i,true),l,c;n(s,"Cannot move field "+i.get("id")+" to axis "+r);t=ee(e,t,i);if(a){l=te(t,r,g(i));c=l&&f.addLevelToField(e,t,l,i)}if(c){return t.updateIn(["axis",r],function(e){return e.set(e.indexOf(l),c)})}else{return t.updateIn(["axis",r],function(e){var t=o?e.findIndex(function(e){return e.get("id")===o.get("id")}):-1;if(i instanceof u.MeasureField&&t===-1){t=0}if(t!==-1){return e.splice(t,0,i)}else{return e.push(i)}})}};f.findInsertPosition=function(e,t,i){var n=i.filter(d).map(l.parseDimLvl),o=l.parseDimLvl(t),a=o.dimension,s=e.measureModel,u,c;function d(e){return e!=="-:Measures"}u=n.find(function(e){return e.dimension===a&&s.qLevelBelow(e,o.level)});if(u){return l.qualifiedLevelToQualifiedName(u)}else if(s.hasDimension(a)){c=s.findLowestLevel(a,r.reject(n,o));return c&&i[i.indexOf(l.qualifiedLevelToQualifiedName(c))+1]}};f.setScrollPositions=function(e,t){return e.set("scrollPositions",o.fromJS(t))};f.setMoveDirection=function(e,t){return e.set("moveSelectionDirection",t)};f.validateDisplayConfig=function(e){var t={},i;if(!e)return t;for(var r in e){i=e[r];t[r]={};for(var n in i){if(n!=="width"&&n!=="height"&&n!=="members"&&n!=="rollups")console.warn("wrong key "+n+" in display configuration: "+r)}if(i.width)if(typeof i.width==="number")t[r].width=i.width;else console.warn("wrong width type "+typeof i.width+" in display configuration: "+r);if(i.height)if(typeof i.height==="number")t[r].height=i.height;else console.warn("wrong height type "+typeof i.height+" in display configuration: "+r);if(i.members)if(typeof i.members==="object")t[r].members=i.members;else console.warn("wrong members type "+typeof i.members+" in display configuration: "+r);if(i.rollups)if(typeof i.rollups==="object")t[r].rollups=i.rollups;else console.warn("wrong rollups type "+typeof i.rollups+" in display configuration: "+r)}return t};f.getValidFormattingConfig=function(e){if(!e){return{}}return r.mapValues(e,function(e){return e.map(f.$validateFormattingRule).filter(r.negate(r.isUndefined))})};f.hasConditionalFormatting=function(e,t){return e.getIn(["gridOptions","conditionalFormatting",t])};f.$validateFormattingRule=function(e){if(r.includes(p,e.condition)){return e}else{console.warn("The conditional '"+e.condition+"' is not allowed")}};f.getCellFormattingConfig=function(e,t,i){var n=this.getConditionalFormatting(e,t,i);return!r.isUndefined(n)?n&&n.get("measureConfigs").concat(n.get("intersectionConfigs")).toJS():o.List()};f.getConditionalFormatting=function(e,t,i){var r=e.getIn(["conditionalFormatting",t]),n=o.fromJS(i);if(!r)return;return o.Map({measureConfigs:r.filter(function(e){return!e.has("intersections")}),intersectionConfigs:r.filter(function(e){var t=e.get("intersections");return n&&t&&n.isSubset(t)})})};f.setConditionalFormatting=function(e,t){var i=this.getValidFormattingConfig(t)||{};return e.set("conditionalFormatting",o.fromJS(i))};f.addConditionalFormattingRule=function(e,t,i){var r=o.fromJS(this.$validateFormattingRule(i)),n=e.updateIn(["conditionalFormatting",t],function(e){if(!e){return o.List([r])}else{return e.push(r)}});return n};f.removeConditionalFormattingRule=function(e,t,i){var r=o.fromJS(i),n=e.updateIn(["conditionalFormatting",t],function(e){return e.remove(e.indexOf(r))});return n};f.removeConditionalFormattingForMeasure=function(e,t){var i=e.updateIn(["conditionalFormatting"],function(e){return e.delete(t)});return i};f.updateConditionalFormattingRule=function(e,t,i,r){var n=o.fromJS(i),a=o.fromJS(this.$validateFormattingRule(r)),s=e.updateIn(["conditionalFormatting",t],function(e){return e.set(e.indexOf(n),a)});return s};f.findMetricFilter=function(e,t){return f.getFilters(e).get(t)}},{"../../constant/gridoptions":255,"../../cubiql":276,"../../modelerstate":313,"../../multiaxisconfig":328,"../../util":357,assert:2,immutable:"immutable",lodash:70}],456:[function(e,t,i){"use strict";var r=e("immutable");var n=e("../../cubiql");var o=e("../../multiaxisconfig");var a=e("../../pivotconfig_helper");var s=e("./config_helper");var l=t.exports;l.convertToCSVFriendlyState=function(e,t,i){var a=[],l=[],c=t.getSlicePosition(),d=Object.keys(c),p;p=d.filter(function(e){var t=n.parseDimLvl(e);if(!n.qNameIsRealLevel(e)){return false}return d.every(function(e){var r=n.parseDimLvl(e);return!i.qLevelBelow(r,t)})});p.forEach(function(t){var i={};i[c[t]]=true;e=s.setFilter(e,t,i)});["X","Y","Z"].forEach(function(t){if(e.axis.get(t)){e.axis.get(t).forEach(function(e){if(e instanceof o.DimensionField){e.fields.forEach(function(e){if(!s.isAllField(e)){a.push(u(e))}})}if(e instanceof o.LevelField){a.push(u(e))}else if(e instanceof o.MeasureGroupField){if(t==="Z"&&c.hasOwnProperty(e.id)){l.push(e.fields.find(function(t){return t.id===c[e.id]}))}else{l=l.concat(e.fields.toArray())}}else if(e instanceof o.MeasureField){l.push(e)}})}});e=e.set("axis",new r.Map({X:r.List(l),Y:r.List(a),Z:r.List()}));e=e.delete("dropdownMeasureFilter");e=s.clearSortByMeasureValue(e);return e};function u(e){return e.delete("rollupConfigs")}l.createCSVMAConfig=function(e,t,i,r){var n=l.convertToCSVFriendlyState(t,i,r.measureModel),u=a.pivotConfigToMultiAxisConfig(r,e,s.getConfig(n).pivotConfig);u=u.delete("sliceConfigs");u=u.delete("measureGroups");u=p(u,r);u=o.regenerateHeaderConfig(u);return u};l.convertToExcelFriendlyState=function(e,t,i){var r=t.getSlicePosition(),o=Object.keys(r),a=r["-:Measures"],l;l=o.filter(function(e){var t=n.parseDimLvl(e);if(!n.qNameIsRealLevel(e)){return false}return o.every(function(e){var r=n.parseDimLvl(e);return!i.qLevelBelow(r,t)})});l.forEach(function(t){var i={};i[r[t]]=true;e=s.setFilter(e,t,i)});if(a){e.get("measureGroups").forEach(function(t){t.fields.forEach(function(i){if(i.id!==a){e=s.removeMeasureFromGroup(e,t,i)}})})}e=e.delete("dropdownMeasureFilter");return e};l.createExcelMAConfig=function(e,t,i,r){var n=l.convertToExcelFriendlyState(t,i,r.measureModel),o=a.pivotConfigToMultiAxisConfig(r,e,s.getConfig(n).pivotConfig);o=o.delete("sliceConfigs");o=p(o,r);return o};function c(e){return e.filter(function(e){return e.get("name")==="value"||e.get("name")==="selectedDataLabel"})}function d(e,t,i){if(0!==c(e.getIn(t.concat("data"))).size){e=e.updateIn(t.concat("data"),c);e=e.updateIn(t.concat("dataPerFieldSet"),function(e){return e.map(c)})}return e}function p(e,t){var i,r,n=e.getIn(["measureGroups","-:Measures","fields"]),a=["measureGroups","-:Measures","fields"];if(n){n.forEach(function(t,i){e=d(e,a.concat(i),t)});e=o.refreshAllMeasureGroupFieldsOnAxes(e)}e.get("axis").forEach(function(t,i){t.forEach(function(t){if(t instanceof o.MeasureField){e=d(e,s.findPathToField(e,t.get("id")),t)}});return true});return e}},{"../../cubiql":276,"../../multiaxisconfig":328,"../../pivotconfig_helper":330,"./config_helper":455,immutable:"immutable"}],457:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("react");var a=e("react-dom");var s=e("../../util/eventlistenermixin");var l=e("pivottable").Pivot;var u=e("./config_helper");var c=e("../../store/logstore").LogEvents;var d=e("../multiaxisprovider");var p=e("../../constant").DefaultCellSize;var f=e("../../constant/direction");var h=e("./grid_menu");var g=o.createClass({displayName:"Grid",propTypes:{id:o.PropTypes.string.isRequired,uniqueId:o.PropTypes.string.isRequired,config:o.PropTypes.object.isRequired,sheetUniqueId:o.PropTypes.string.isRequired,sheetId:o.PropTypes.string.isRequired,sheetConfig:o.PropTypes.object.isRequired,pivotState:o.PropTypes.object.isRequired,modelerState:o.PropTypes.object.isRequired,headingData:o.PropTypes.object.isRequired,updatePivotState:o.PropTypes.func.isRequired,openComponentFn:o.PropTypes.func.isRequired,closeComponentFn:o.PropTypes.func.isRequired,modelerApp:o.PropTypes.object.isRequired},mixins:[s],setEventListeners:function(){var e=this.props.modelerApp;return[{emitter:e.getLogStore(),event:c.DATA_PROCESSING_ERROR,callback:this.onResProcessorWarning},{emitter:window,event:"resize",callback:this.handleResize}]},componentWillMount:function(){this.initializeMultiAxisProvider()},componentWillReceiveProps:function(e){var t=e.pivotState,i;if(!r.is(e.sheetConfig,this.props.sheetConfig)){i=u.getMoveDirection(t);this.$dataProvider.setPivotState(t);if(this.pivot&&this.pivot.getOption("moveSelectionDirection")!==i){this.pivot.setOption("moveSelectionDirection",i)}}},componentDidUpdate:function(){var e=this.refs.pivot,t=e.offsetHeight,i=e.offsetWidth;if(t!==this.pivotHeight||i!==this.pivotWidth){this.pivot.resize(true);this.pivotHeight=t;this.pivotWidth=i}},getInitialState:function(){return{contextMenu:undefined,moveCaretAfterUpdate:undefined}},initializeMultiAxisProvider:function(){var e=this.props.modelerApp,t=new d(this.props.sheetId,e.getMultiAxisDataStore(),e.getMultiAxisConfigStore(),e.getMultiAxisConfigActionHandler(),e.getMultiAxisDataActionHandler(),this.props.modelerState,this.props.pivotState,p.WIDTH,p.HEIGHT,this.props.updatePivotState);t.markViewAsActive();this.$dataProvider=t},handleResize:function(){this.pivot&&n.delay(this.pivot.resize.bind(this.pivot),0)},onResProcessorWarning:function(e){this.props.modelerApp.getNotificationsActionHandler().warning(e.message)},initScrollPositions:function(){var e=this.props.pivotState.get("scrollPositions");if(e){this.pivot.renderer.scrollTop=e.get("scrollTop");this.pivot.renderer.scrollLeft=e.get("scrollLeft")}},saveScrollPositions:function(){var e={scrollTop:this.pivot.renderer.getScrollTop(),scrollLeft:this.pivot.renderer.getScrollLeft()
},t=this.props.pivotState,i=t.get("scrollPositions"),o=t.set("scrollPositions",r.fromJS(e));if(i&&!n.isEqual(i.toJS(),e)){this.props.updatePivotState(o)}else if(!i&&(e.scrollTop!==0||e.scrollLeft!==0)){this.props.updatePivotState(o)}},onColumnHeaderResize:function(e){var t=this.$getMAConfig().axis.get("X");if(t.size>0){if(e.height>=this.pivot.cellMinHeight&&e.index>=0){this.setHeaderSize(t[e.index].qualifiedName,e)}else if(e.width>=this.pivot.cellMinWidth){this.setHeaderSize(t[t.size-1].qualifiedName,e)}}},onRowHeaderResize:function(e){var t=this.$getMAConfig().axis.get("Y");if(t.size>0){if(e.width>=this.pivot.cellMinWidth&&e.index>=0){this.setHeaderSize(t[e.index].qualifiedName,e)}else if(e.height>=this.pivot.cellMinHeight){this.setHeaderSize(t[t.size-1].qualifiedName,e)}}},setHeaderSize:function(e,t){var i=this.props.modelerApp,r=i.getGridOptionStore().getOptions(this.props.sheetId),n=this.modelerApp.getModelerActionHandler();r.display=r.display||{};if(!(e in r.display)){r.display[e]={}}if(t.width>=this.pivot.cellMinWidth){r.display[e].width=t.width}if(t.height>=this.pivot.cellMinHeight){r.display[e].height=t.height}n.setPivotOptions(this.props.sheetId,r)},configurePivot:function(){var e,t;if(!this.isMounted()){return}e=new l(this.props.sheetId,a.findDOMNode(this.refs.pivot));t=this.props.modelerApp.getModelerOptionStore();e.setOption("moveSelectionDirection",f.BOTTOM);e.setOption("totals",false);e.setOption("addHeaders",t.canEditSchema());e.setOption("editHeaders",t.canEditSchema());e.setDefaultAlignment("left","middle");e.setDataProvider(this.$dataProvider);e.setNotificationsHandler(this.props.modelerApp.getNotificationsActionHandler());e.renderer.on("reviewedits",this.reviewPendingEdits);this.$saveScrollPositions=n.debounce(this.saveScrollPositions,2e3);e.renderer.on("scroll",this.$saveScrollPositions);e.on("columnHeadersResized",this.onColumnHeaderResize);e.on("rowHeadersResized",this.onRowHeaderResize);e.on("contextMenu",this.showContextMenu);this.pivot=e},reviewPendingEdits:function(){this.props.modelerApp.getModelerActionHandler().reviewPendingEdits()},moveCaretTo:function(e,t,i){var r=this,n={};n[t]={id:i};r.pivot.renderer.once("afterRender",function(){var t=r.props.headingData.getHeadingAxisInfo(e).findMatchingRowNums(n);r.pivot.focus(true);if(e==="X"){r.pivot.moveCaretTo(0,t[0]);r.pivot.clearSelection()}else{r.pivot.moveCaretTo(t[0],0);r.pivot.clearSelection()}})},componentDidMount:function(){this.configurePivot();this.initScrollPositions()},getMeasuresByRange:function(e){var t=this.$dataProvider.getSelectedDataRange(e),i=t&&t.dataArray,r=[],o;n.forEach(i,function(e){var t=e.info.editConfigs.value;if(t){o=t.dataConfig.measure.metric.name;if(r.indexOf(o)===-1){r.push(o)}}});return r},getSelectedMeasure:function(e){var t=this.getMeasuresByRange(e);return t.length===1?t[0]:undefined},onContextMenuClose:function(){this.setState({contextMenu:undefined})},showContextMenu:function(e){if(e.isHeadingCell){e.headingRow=this.$dataProvider.getHeadingInfo(e.axis).getHeadingRow(e.coords.row);if(e.headingRow.fields.length===0){return}}else{e.measure=this.getSelectedMeasure(e.selectionRange)}this.setState({contextMenu:e})},render:function(){var e=null;if(this.state.contextMenu){e=o.createElement(h,{modelerApp:this.props.modelerApp,uniqueId:this.props.uniqueId,sheetId:this.props.sheetId,sheetUniqueId:this.props.sheetUniqueId,sheetConfig:this.props.sheetConfig,modelerState:this.props.modelerState,pivotState:this.props.pivotState,updatePivotState:this.props.updatePivotState,context:this.state.contextMenu,onClose:this.onContextMenuClose,moveCaretTo:this.moveCaretTo,getCommitMode:this.$dataProvider.getCommitMode.bind(this.$dataProvider),commit:this.$dataProvider.commit.bind(this.$dataProvider),clearEdits:this.$dataProvider.clearEdits.bind(this.$dataProvider),setCommitMode:this.$dataProvider.setCommitMode.bind(this.$dataProvider),setSort:this.$dataProvider.setSort.bind(this.$dataProvider),getSelectedDataRange:this.$dataProvider.getSelectedDataRange.bind(this.$dataProvider),copyData:this.pivot.getCopyText.bind(this.pivot),setLock:this.$dataProvider.setLock.bind(this.$dataProvider),unsetLock:this.$dataProvider.unsetLock.bind(this.$dataProvider),clearAllLocks:this.$dataProvider.clearAllLocks.bind(this.$dataProvider),hasLocks:this.$dataProvider.hasLocks.bind(this.$dataProvider),hasLocksInRange:this.$dataProvider.hasLocksInRange.bind(this.$dataProvider),headerCanSort:this.$dataProvider.headerCanSort.bind(this.$dataProvider),closeComponent:this.props.closeComponentFn,openComponent:this.props.openComponentFn})}return o.DOM.div({ref:"pivot",className:"pivot-grid"},e)}});t.exports=g},{"../../constant":256,"../../constant/direction":249,"../../store/logstore":342,"../../util/eventlistenermixin":360,"../multiaxisprovider":443,"./config_helper":455,"./grid_menu":458,immutable:"immutable",lodash:70,pivottable:88,react:"react","react-dom":"react-dom"}],458:[function(e,t,i){"use strict";var r=e("clipboard-js");var n=e("lodash");var o=e("immutable");var a=e("react");var s=a.PropTypes;var l=e("./menu/level_header");var u=e("./menu/measure_header");var c=e("./menu/data_cell");var d=e("../../util/viewlayoututils");var p=e("../form/form_helper");var f=e("../../constant");var h=f.View;var g=f.Layout;var m=g.VIEW_MODE;var v=f.PivotEditMode;var y=f.SORT;var b=f.FilterableMeasureTypes;var w=f.MESSAGES;var C=f.ModalWindows.Types;var E=e("./config_helper");var S=e("../../multiaxisconfig");var T={options:{size:"200px",openIn:g.POSITION.RIGHT}};var x=a.createClass({displayName:"GridMenu",propTypes:{modelerApp:s.object.isRequired,uniqueId:s.string.isRequired,sheetId:s.string.isRequired,sheetUniqueId:s.string.isRequired,sheetConfig:s.object.isRequired,pivotState:s.object.isRequired,modelerState:s.object.isRequired,updatePivotState:s.func.isRequired,context:s.object.isRequired,onClose:s.func.isRequired,getCommitMode:s.func.isRequired,commit:s.func.isRequired,clearEdits:s.func.isRequired,setCommitMode:s.func.isRequired,setSort:s.func.isRequired,getSelectedDataRange:s.func.isRequired,setLock:s.func.isRequired,unsetLock:s.func.isRequired,clearAllLocks:s.func.isRequired,hasLocks:s.func.isRequired,hasLocksInRange:s.func.isRequired,copyData:s.func.isRequired,headerCanSort:s.func.isRequired,closeComponent:s.func.isRequired,openComponent:s.func.isRequired},headerCanSort:function(){var e=this.props.context.coords,t=this.props.context.axis;return this.props.headerCanSort(t,e.row,e.col)},toggleViewMode:function(e,t){e=e||this.props.sheetUniqueId;return this.props.modelerApp.getViewActionHandler().setViewMode(e,t)},setCommitMode:function(){var e=this.props.getCommitMode();this.props.setCommitMode(e===v.MULTI?v.SINGLE:v.MULTI)},reviewPendingEdits:function(){this.props.modelerApp.getModelerActionHandler().reviewPendingEdits()},getDeferredCalcProps:function(){var e=this.props.getCommitMode();return{calcMode:e,calculate:this.props.commit,reviewEdits:this.reviewPendingEdits,discardEdits:this.props.clearEdits,changeCalcMode:this.setCommitMode}},resetState:function(){var e=this,t=this.props.modelerApp,i=this.props.sheetId,r=this.props.sheetUniqueId,n=t.getViewStore(),o=n.getParentId(r),a;t.getViewConfigActionHandler().resetViewState(i).then(function(){a=t.getViewConfigStore().getViewConfig(o);e.toggleViewMode(r,d.getCurrentViewModeInParentLayout(i,a))})},isResetDisabled:function(){var e=this.props.modelerApp.getViewConfigStore(),t=e.getViewState(this.props.sheetId),i=e.getViewConfig(this.props.sheetId);return o.is(t,i)},getResetStateProps:function(){return{resetState:this.isResetDisabled()?undefined:this.resetState}},getSheetViewMode:function(){var e=this.props.modelerApp.getViewStore(),t=e.getParentId(this.props.sheetUniqueId),i=this.props.modelerApp.getViewConfigStore(),r=i.getViewState(t);return d.getCurrentViewModeInParentLayout(this.props.sheetId,r)},toggleSheetViewMode:function(){var e=this.getSheetViewMode()===m.DEFAULT?m.CONFIGURATION:m.DEFAULT;this.toggleViewMode(this.props.sheetUniqueId,e)},getConfigurationModeProps:function(){return{viewMode:this.getSheetViewMode(),toggleViewMode:this.toggleSheetViewMode}},toggleChartMode:function(){var e=d.getInlineViewId(this.props.sheetConfig,h.Modules.PivotGrid),t=this.props.modelerApp.getViewStore(),i,r,n;if(e){i=t.getViewUniqueId(this.props.sheetUniqueId,e);r=d.getCurrentViewModeInParentLayout(e,this.props.sheetConfig);n=r===m.DEFAULT?m.CHART:m.DEFAULT;this.toggleViewMode(i,n)}},isChartModeEnabled:function(){var e=d.getInlineViewId(this.props.sheetConfig,h.Modules.PivotGrid);return!!e&&d.getCurrentViewModeInParentLayout(e,this.props.sheetConfig)!==m.DEFAULT},getChartModeProps:function(){return{enabled:this.isChartModeEnabled(),toggleChartMode:this.toggleChartMode}},toggleDetailsMode:function(){var e=this.props.context.headingRow,t=e.fields.reduce(function(t,i,r){t[i.id]=e.headers[r].id;return t},{}),i=o.fromJS({form:{axis:this.props.context.axis,selector:t}});this.props.modelerApp.getViewActionHandler().setViewMode(this.props.uniqueId,g.VIEW_MODE.FORM,i)},isDetailsVisible:function(){var e=this.props.modelerState.measureModel,t=this.props.pivotState,i=this.props.context.axis,r=this.props.context.headingRow.fields,n=r.length-1;return p.canDisplayAsForm(e,t,i)&&n===this.props.context.coords.col&&!E.hasRollup(r[n])},getDetailsProps:function(){return{toggleDetailsMode:this.toggleDetailsMode}},sortLevelAsc:function(){this.setLevelSort(y.ASCENDING)},sortLevelDesc:function(){this.setLevelSort(y.DESCENDING)},setLevelSort:function(e){var t=this.getHeadingField(),i=E.getFieldAttributeSort(t),r=E.setSort(this.props.pivotState,t.id,e,i.sortAttr);this.props.updatePivotState(r)},getLevelSortProps:function(){return{sortAsc:this.sortLevelAsc,sortDesc:this.sortLevelDesc,clearSortHidden:true}},createLevel:function(){var e=this,t=this.props.context.axis,i=this.getHeadingField();return this.props.modelerApp.getModalWindowsActionHandler().openWindow(C.LEVEL_CREATION_FORM,{modalTitle:"Create new "+i.fieldLabel,field:i,onFormSubmit:function(r){e.props.moveCaretTo(t,i.id,r)}})},getLevelCreateProps:function(){return{label:this.getHeadingField().fieldLabel,create:this.createLevel}},getPropsForLevelHeader:function(){var e=this.props.modelerApp.config.modelingFeatures,t={deferredCalc:this.getDeferredCalcProps(),reset:this.getResetStateProps(),configurationMode:this.getConfigurationModeProps(),chartMode:this.getChartModeProps(),sort:this.getLevelSortProps()};if(e.editSchema){t.createLevel=this.getLevelCreateProps()}if(this.isDetailsVisible()){t.details=this.getDetailsProps()}return t},getConditionalFormattingProps:function(){var e=this.getHeadingField().id,t=E.hasConditionalFormatting(this.props.sheetConfig,e);return{toggleView:this.toggleConditionalFormattingView,isViewOpen:this.isConditionalFormattingViewOpen(),clearFormatting:t?this.clearConditionalFormatting:undefined}},toggleConditionalFormattingView:function(){var e={config:{module:h.Modules.ConditionalFormatting,selectedMeasure:this.getHeadingField().id},position:{options:{size:"300px",openIn:g.POSITION.RIGHT}}},t=e.config,i=d.getInlineViewId(this.props.sheetConfig,t.module);if(!this.isConditionalFormattingViewOpen()){this.props.openComponent(i,e.position,t)}else{this.props.closeComponent(i)}},isConditionalFormattingViewOpen:function(){var e=d.getInlineViewId(this.props.sheetConfig,h.Modules.ConditionalFormatting);return d.isViewOpenedInLayout(this.props.sheetConfig,e)},clearConditionalFormatting:function(){var e=this,t=e.getHeadingField(),i=t.label||t.id,r=this.props.modelerApp.getModalWindowsActionHandler();r.confirm("Remove conditional formatting for "+i+"?",w.PLEASE_CONFIRM).then(function(){var i=E.removeConditionalFormattingForMeasure(e.props.pivotState,t.id);e.props.updatePivotState(i)})},getMeasureFilterProps:function(){var e=this.getHeadingField().id,t=this.props.modelerApp.getMeasureModelStore().getModel().getMeasureInfo(e),i=t&&b.indexOf(t.type.kind)!==-1;return{toggleFilter:i?this.toggleMeasureFilter:undefined,clearFilter:i?this.clearMeasureFilter:undefined}},getDisabledMeasureFilterProps:function(){return{toggleView:n.noop,clearFilter:n.noop}},toggleMeasureFilter:function(){var e=this.getHeadingField().id,t="value-filter-window-"+e,i=this.props.modelerApp.getViewConfigStore().getViewState(this.props.sheetId),r;if(d.isViewOpenedInLayout(i,t)){this.props.closeComponent(t)}else{r={module:h.Modules.MeasureFilterWindow,config:{id:t,measureName:e,pivotId:this.$sheetId}};this.props.openComponent(t,T,r)}},clearMeasureFilter:function(){var e=this.getHeadingField().id,t=E.setMeasureFilter(this.props.pivotState,e);this.props.updatePivotState(t)},getMeasureSortProps:function(){var e={};if(this.headerCanSort()){e={sortAsc:this.sortMeasureAsc,sortDesc:this.sortMeasureDesc,clearSort:this.clearMeasureSort}}return e},sortMeasureAsc:function(){this.setSortForMeasure(y.ASCENDING)},sortMeasureDesc:function(){this.setSortForMeasure(y.DESCENDING)},clearMeasureSort:function(){this.props.updatePivotState(E.clearSortByMeasureValue(this.props.pivotState))},setSortForMeasure:function(e){var t=this.props.context;this.props.setSort(t.axis,{x:t.coords.col,y:t.coords.row},e)},getPropsForMeasureHeader:function(){return{reset:this.getResetStateProps(),configurationMode:this.getConfigurationModeProps(),chartMode:this.getChartModeProps(),sort:this.getMeasureSortProps(),filter:this.getMeasureFilterProps(),conditionalFormatting:this.getConditionalFormattingProps()}},setLock:function(){this.props.setLock(this.props.context.selectionRange)},unsetLock:function(){this.props.unsetLock(this.props.context.selectionRange)},getLockProps:function(){return{setLock:this.setLock,unsetLock:this.props.hasLocksInRange(this.props.context.selectionRange)?this.unsetLock:undefined,clearAllLocks:this.props.clearAllLocks,hasLocks:this.props.hasLocks()}},sortDataCellAsc:function(){this.setSortForDataCell(y.ASCENDING)},sortDataCellDesc:function(){this.setSortForDataCell(y.DESCENDING)},getFloatingAxisName:function(e,t){if(e==="Z"){return t.Y.length>=t.X.length?"Y":"X"}else{return e==="X"?"Y":"X"}},getSortPositions:function(e,t){var i=this.props.getSelectedDataRange(t),r=i.dataArray[0].info.headings,o=[],a;function s(e){return S.isLevelField(e.config.field)}n.forEach(r,function(e){o=o.concat(e.filter(s))});a=o.map(function(e){var t=e.config.field.level;return{qualifiedLevel:{level:t.get("levelName"),dimension:t.get("dimensionName"),label:t.get("labelName")},memberId:e.id}});return a},setSortForDataCell:function(e){var t=this.getHeadingField().id,i=this.props.context.selectionRange,r=this.props.pivotState,n=E.findAxisForField(r,E.getVisibleMeasures(r).id),o=this.getSortPositions(t,i),a=this.getFloatingAxisName(n,i),s=E.setSortByMeasureValue(this.props.modelerState,r,t,a,o,e);this.props.updatePivotState(s)},getDataCellSortProps:function(){var e={};if(this.props.context.measure){e={sortAsc:this.sortDataCellAsc,sortDesc:this.sortDataCellDesc,clearSort:this.clearMeasureSort}}return e},togglePropertiesView:function(){var e=this.getHeadingField().id,t="measure-properties-"+e,i=o.fromJS({module:h.Modules.MeasureWindow,config:{id:t,measureName:e}});this.props.openComponent(t,T,i)},getMeasurePropertiesProps:function(){return{toggleView:this.props.context.measure&&this.togglePropertiesView}},copyToClipboard:function(e){var t=this.props.copyData(e);if(t){r.copy(t)}},copy:function(){this.copyToClipboard(false)},cut:function(){this.copyToClipboard(true)},getCopyCutPasteProps:function(){return{copy:this.copy,cut:this.cut}},getPropsForDataCell:function(){return{deferredCalc:this.getDeferredCalcProps(),lock:this.getLockProps(),copyCutPaste:this.getCopyCutPasteProps(),filter:this.getMeasureFilterProps(),sort:this.getDataCellSortProps(),conditionalFormatting:this.getConditionalFormattingProps(),configurationMode:this.getConfigurationModeProps(),chartMode:this.getChartModeProps(),reset:this.getResetStateProps(),measureProperties:this.getMeasurePropertiesProps()}},getHeadingField:function(){return this.props.context.headingRow?this.props.context.headingRow.fields[this.props.context.coords.col]:{id:this.props.context.measure}},getContextMenuProps:function(){var e={openPositionX:this.props.context.x,openPositionY:this.props.context.y,onClose:this.props.onClose},t;if(this.props.context.headingRow){if(this.getHeadingField()instanceof S.LevelField){t=this.getPropsForLevelHeader()}else{t=this.getPropsForMeasureHeader()}}else{t=this.getPropsForDataCell()}return n.extend(e,t)},getMenuConstructor:function(){if(this.props.context.headingRow){if(this.getHeadingField()instanceof S.LevelField){return l}else{return u}}else{return c}},render:function(){return a.createElement(this.getMenuConstructor(),this.getContextMenuProps())}});t.exports=x},{"../../constant":256,"../../multiaxisconfig":328,"../../util/viewlayoututils":367,"../form/form_helper":412,"./config_helper":455,"./menu/data_cell":460,"./menu/level_header":473,"./menu/measure_header":474,"clipboard-js":"clipboard-js",immutable:"immutable",lodash:70,react:"react"}],459:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("classnames");var a=e("lodash");var s=e("popupmenu").PopupMenu;var l=e("popupmenu").Menu;var u=e("popupmenu").MenuItem;var c=e("popupmenu").MenuItemsTypes;var d=e("../../menu_sections/global");var p=e("../../menu_sections/configuration");var f=e("../../menu_sections/format");var h=e("../../menu_sections/export");var g=e("../../file");var m=e("./export");var v=e("../../csvexport");var y=e("../../excelexport");var b=e("../../multiaxisconfig");var w=e("../../util/eventlistenermixin");var C=e("../../constant").ModalWindows.Types;var E=e("../../constant");var S=E.CSV_EXPORT;var T=E.EXCEL_EXPORT;var x=1e6;var _=e("./config_helper");var M=e("../../modelerstate");var A=e("../../store/multiaxisdatastore").MultiAxisDataEvents;var I=r.createClass({displayName:"ConfigMenu",propTypes:{id:r.PropTypes.string.isRequired,uniqueId:r.PropTypes.string.isRequired,config:r.PropTypes.object.isRequired,sheetUniqueId:r.PropTypes.string.isRequired,sheetId:r.PropTypes.string.isRequired,sheetConfig:r.PropTypes.object.isRequired,sheetViewMode:r.PropTypes.string.isRequired,modelerApp:r.PropTypes.object.isRequired,openComponentFn:r.PropTypes.func.isRequired,closeComponentFn:r.PropTypes.func.isRequired},mixins:[w],setEventListeners:function(){return[{emitter:this.props.modelerApp.getMultiAxisDataStore(),event:A.DATA_CHANGED,callback:this.onDataChanged}]},getInitialState:function(){return{uniqueId:a.uniqueId("config-menu-"),isLoading:false,menuVisible:false}},getSheetConfig:function(){return this.props.modelerApp.getViewConfigStore().getViewState(this.props.sheetId)},getModelerState:function(){return M.createModelerState(this.props.modelerApp)},getPivotState:function(){var e=this.getSheetConfig();return _.pivotStateFromPivotConfig(this.getModelerState(),this.props.sheetId,e.get("pivotConfig"),e.get("gridOptions"))},startExcelExport:function(){var e=this.props.modelerApp.getNotificationsActionHandler(),t=this.props.modelerApp.getMultiAxisDataStore().getHeadingData(this.props.sheetId,"main"),i=m.createExcelMAConfig(this.props.sheetId,this.getPivotState(),t,this.getModelerState());if(i.axis.get("X").size===0&&i.axis.get("Y").size===0){e.warning(T.messages.empty,"",null,S.options)}else{e.info(T.messages.info,"",null,T.options);this.props.modelerApp.getMultiAxisConfigActionHandler().setViewTaskConfig(this.props.sheetId,"exportExcel",{maConfig:i,isolatedData:true,isUnmasked:true,doNotUseViewCache:true});this.setState({isLoading:true,isMenuOpen:false})}},startCSVExport:function(){var e=this.props.modelerApp.getNotificationsActionHandler(),t=this.props.modelerApp.getMultiAxisDataStore().getHeadingData(this.props.sheetId,"main"),i;try{i=m.createCSVMAConfig(this.props.sheetId,this.getPivotState(),t,this.getModelerState())}catch(t){if(t instanceof b.ValidationError){e.error(t.message,"Unable to export",null,{autoDismiss:8});return}throw t}if(i.axis.get("X").size===0&&i.axis.get("Y").size===0){e.warning(S.messages.empty,"",null,S.options)}else{e.info(S.messages.info,"",null,S.options);this.props.modelerApp.getMultiAxisConfigActionHandler().setViewTaskConfig(this.props.sheetId,"exportCsv",{maConfig:i,isolatedData:true,isUnmasked:true,doNotUseViewCache:true});this.setState({isLoading:true,isMenuOpen:false})}},onDataChanged:function(e){var t=this.props.sheetId,i=this.props.modelerApp.getMultiAxisDataStore(),r=this.props.modelerApp.getMultiAxisConfigStore(),n=!a.isUndefined(e.viewTasks),o=!n||e.viewTasks.find(function(e){return e.viewId===t&&(e.tasks.indexOf("exportCsv")>-1||e.tasks.indexOf("exportExcel")>-1)}),s=r.viewTaskIsActive(t,"exportExcel"),l=r.viewTaskIsActive(t,"exportCsv"),u=o&&l&&!i.hasOutstandingRequestsForViewTask(t,"exportCsv"),c=o&&s&&!i.hasOutstandingRequestsForViewTask(t,"exportExcel");if(u){this.exportToCsv()}if(c){this.exportToExcel()}},checkExportSizeAndExport:function(e,t,i){var r=this.props.sheetId,n=this.props.modelerApp.getMultiAxisDataStore(),o=this.props.modelerApp.getMultiAxisConfigStore().getViewTaskConfig(r,e).maConfig,a=n.getHeadingData(r,e),s=a.getHeadingAxisInfo("X").getLength()+Math.max(o.axis.get("Y").size,1),l=a.getHeadingAxisInfo("Y").getLength()+Math.max(o.axis.get("X").size,1),u={title:t,text:"You are attempting to export a large amount of data (> 1 million cells). Depending on your machine configuration, this export may fail to complete due to constraints on memory. You can reduce the amount of exported data by modifying the filters, or axis configurations of the pivot.",width:"500px",handleContinue:i};if(s*l>x){this.props.modelerApp.getModalWindowsActionHandler().openWindow(C.WARNING_DIALOG,u)}else{i()}},exportToCsv:function(){var e=this,t=this.props.sheetId,i=this.props.modelerApp.getMultiAxisDataStore(),r=this.props.modelerApp.getNotificationsActionHandler();v.getExportData(t,i,function(i){g.downloadFileContent("export-"+t+".csv",i,"text/csv");e.postExportActions("exportCsv");r.success(S.messages.success,"",null,S.options)})},exportToExcel:function(){var e=this,t=this.props.sheetId,i=this.props.modelerApp.getMultiAxisDataStore(),r=this.props.modelerApp.getNotificationsActionHandler();y.getExportData(t,i,false,function(i){g.downloadFileBlob("export-"+t+".xlsx",i);e.postExportActions("exportExcel");r.success(T.messages.success,"",null,T.options)})},postExportActions:function(e){this.setState({isLoading:false});this.props.modelerApp.getMultiAxisConfigActionHandler().setViewTaskInactive(this.props.sheetId,e)},closeMenu:function(){this.setState({isMenuOpen:false})},onClick:function(){var e=n.findDOMNode(this).getBoundingClientRect();this.setState({isMenuOpen:true,openPositionX:e.left,openPositionY:e.top+e.height})},$exportToExcel:function(){this.checkExportSizeAndExport("main","Export to Excel",this.startExcelExport)},$exportToCsv:function(){this.checkExportSizeAndExport("main","Export to CSV",this.startCSVExport)},render:function(){var e=o({fa:true,"fa-cog":true,loading:this.state.isLoading}),t=this.props;return r.DOM.div({className:"pivot-config-menu menu-icon menu-trigger"},r.DOM.div({className:e,onClick:this.onClick},this.state.isMenuOpen?r.createElement(s,{onClose:this.closeMenu,openPositionX:this.state.openPositionX,openPositionY:this.state.openPositionY},r.createElement(l,{onClose:this.closeMenu},r.createElement(p,{sheetId:t.sheetId,sheetUniqueId:t.sheetUniqueId,sheetConfig:t.sheetConfig,sheetViewMode:t.sheetViewMode,modelerApp:t.modelerApp,openComponentFn:t.openComponentFn}),r.createElement(u,{itemType:c.Divider}),r.createElement(f,{modelerApp:t.modelerApp,sheetId:t.sheetId,openComponentFn:t.openComponentFn,closeComponentFn:t.closeComponentFn}),r.createElement(u,{itemType:c.Divider}),r.createElement(h,{exportToCsv:this.$exportToCsv,exportToExcel:this.$exportToExcel}),r.createElement(u,{itemType:c.Divider}),r.createElement(d,{sheetId:t.sheetId,sheetUniqueId:t.sheetUniqueId,modelerApp:t.modelerApp,pivotState:t.pivotState,updatePivotState:t.updatePivotState}))):null))}});t.exports=I},{"../../constant":256,"../../csvexport":275,"../../excelexport":290,"../../file":291,"../../menu_sections/configuration":305,"../../menu_sections/export":306,"../../menu_sections/format":308,"../../menu_sections/global":309,"../../modelerstate":313,"../../multiaxisconfig":328,"../../store/multiaxisdatastore":348,"../../util/eventlistenermixin":360,"./config_helper":455,"./export":456,classnames:6,lodash:70,popupmenu:146,react:"react","react-dom":"react-dom"}],460:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.PropTypes;var a=e("popupmenu");var s=a.Menu;var l=a.PopupMenu;var u=a.Divider;var c=e("./items/deferred_calc");var d=e("./items/lock");var p=e("./items/reset");var f=e("./items/configuration_mode");var h=e("./items/chart_mode");var g=e("./items/sort");var m=e("./items/filter");var v=e("./items/conditional_formatting");var y=e("./items/measure_properties");var b=e("./items/copy_cut_paste");var w=e("../../custom_react_prop_types").shapeFromWithOmit;var C=r.partial(w,"onClose");var E=n.createClass({displayName:"DataCellMenu",propTypes:{deferredCalc:C(c),lock:C(d),filter:C(m),sort:C(g),conditionalFormatting:C(v),configurationMode:C(f),chartMode:C(h),reset:C(p),measureProperties:C(y),onClose:o.func.isRequired},mergeProps:function(e){return this.props[e]&&r.extend({},this.props[e],{onClose:this.props.onClose})},render:function(){return n.createElement(l,this.props,n.createElement(s,{onClose:this.props.onClose},n.createElement(c,this.mergeProps("deferredCalc")),n.createElement(d,this.mergeProps("lock")),n.createElement(u),n.createElement(b,this.mergeProps("copyCutPaste")),n.createElement(u),n.createElement(m,this.mergeProps("filter")),n.createElement(g,this.mergeProps("sort")),n.createElement(u),n.createElement(v,this.mergeProps("conditionalFormatting")),n.createElement(u),n.createElement(f,this.mergeProps("configurationMode")),n.createElement(h,this.mergeProps("chartMode")),n.createElement(u),n.createElement(p,this.mergeProps("reset")),n.createElement(u),n.createElement(y,this.mergeProps("measureProperties"))))}});t.exports=E},{"../../custom_react_prop_types":396,"./items/chart_mode":461,"./items/conditional_formatting":462,"./items/configuration_mode":463,"./items/copy_cut_paste":464,"./items/deferred_calc":466,"./items/filter":468,"./items/lock":469,"./items/measure_properties":470,"./items/reset":471,"./items/sort":472,lodash:70,popupmenu:146,react:"react"}],461:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant");var s=a.ContextMenu.MenuItemInfo;var l=a.ContextMenu.IconInfo;u.propTypes={enabled:n.bool,toggleChartMode:n.func,onClose:n.func.isRequired};function u(e){return r.createElement(o,{key:s.ChartMode.key,label:s.ChartMode.label,iconName:e.enabled?l.Checked:"",disabled:!e.toggleChartMode,onClick:e.toggleChartMode,onClose:e.onClose})}t.exports=u},{"../../../../constant":256,popupmenu:146,react:"react"}],462:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant");var s=a.ContextMenu.MenuItemInfo;var l=a.ContextMenu.IconInfo;u.propTypes={onClose:n.func.isRequired,isViewOpen:n.bool,toggleView:n.func,clearFormatting:n.func};function u(e){return r.DOM.div(null,r.createElement(o,{key:s.ConditionalFormatting.key,label:s.ConditionalFormatting.label,iconName:e.isViewOpen?l.Checked:"",disabled:!e.toggleView,onClick:e.toggleView,onClose:e.onClose}),r.createElement(o,{key:s.ClearFormatting.key,label:s.ClearFormatting.label,disabled:!e.clearFormatting,onClick:e.clearFormatting,onClose:e.onClose}))}t.exports=u},{"../../../../constant":256,popupmenu:146,react:"react"}],463:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant");var s=a.Layout.VIEW_MODE;var l=a.ContextMenu.MenuItemInfo;var u=a.ContextMenu.IconInfo;c.propTypes={viewMode:n.oneOf([s.CONFIGURATION,s.DEFAULT]),toggleViewMode:n.func,onClose:n.func.isRequired};function c(e){return r.createElement(o,{key:l.ConfigurationMode.key,label:l.ConfigurationMode.label,iconName:e.viewMode===s.CONFIGURATION?u.Checked:"",disabled:!e.toggleViewMode,onClick:e.toggleViewMode,onClose:e.onClose})}t.exports=c},{"../../../../constant":256,popupmenu:146,react:"react"}],464:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.PropTypes;var a=e("popupmenu").MenuItem;var s=e("../../../../constant");var l=s.ContextMenu.MenuItemInfo;var u=s.ContextMenu.IconInfo;c.propTypes={onClose:o.func.isRequired,copy:o.func,cut:o.func};function c(e){return n.DOM.div(null,n.createElement(a,{key:l.Copy.key,label:l.Copy.label,iconName:u.Copy,disabled:!e.copy,onClick:e.copy,onClose:e.onClose}),n.createElement(a,{key:l.Cut.key,label:l.Cut.label,iconName:u.Cut,disabled:!e.cut,onClick:e.cut,onClose:e.onClose}),n.createElement(a,{key:l.Paste.key,label:l.Paste.label,iconName:u.Paste,disabled:true,onClick:r.noop,onClose:e.onClose}))}t.exports=c},{"../../../../constant":256,lodash:70,popupmenu:146,react:"react"}],465:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant");var s=a.ContextMenu.MenuItemInfo;var l=a.ContextMenu.IconInfo;u.propTypes={onClose:n.func.isRequired,key:n.string,label:n.string,create:n.func};function u(e){return r.createElement(o,{key:e.key||s.Create.key,label:s.Create.label+e.label,iconName:l.Plus,disabled:!e.create,onClick:e.create,onClose:e.onClose})}t.exports=u},{"../../../../constant":256,popupmenu:146,react:"react"}],466:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant");var s=a.ContextMenu.MenuItemInfo;var l=a.ContextMenu.IconInfo;var u=a.PivotEditMode;c.propTypes={onClose:n.func.isRequired,calcMode:n.oneOf([u.MULTI,u.SINGLE]),changeCalcMode:n.func,calculate:n.func,discardEdits:n.func,reviewEdits:n.func};function c(e){var t=[r.createElement(o,{key:s.Deferred.key,label:s.Deferred.label,disabled:!e.changeCalcMode,onClick:e.changeCalcMode,iconName:e.calcMode===u.MULTI?l.Checked:undefined,onClose:e.onClose})];if(e.calcMode===u.MULTI){t=t.concat([r.createElement(o,{key:s.Calculate.key,label:s.Calculate.label,disabled:!e.calculate,onClick:e.calculate,onClose:e.onClose}),r.createElement(o,{key:s.Discard.key,label:s.Discard.label,disabled:!e.discardEdits,onClick:e.discardEdits,onClose:e.onClose}),r.createElement(o,{key:s.Review.key,label:s.Review.label,disabled:!e.reviewEdits,onClick:e.reviewEdits,onClose:e.onClose})])}return r.DOM.div(null,t)}t.exports=c},{"../../../../constant":256,popupmenu:146,react:"react"}],467:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant");var s=a.ContextMenu.MenuItemInfo;var l=a.ContextMenu.IconInfo;u.propTypes={onClose:n.func.isRequired,toggleDetailsMode:n.func};function u(e){return r.createElement(o,{key:s.Details.key,label:s.Details.label,iconName:l.Details,disabled:!e.toggleDetailsMode,onClick:e.toggleDetailsMode,onClose:e.onClose})}t.exports=u},{"../../../../constant":256,popupmenu:146,react:"react"}],468:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant");var s=a.ContextMenu.MenuItemInfo;var l=a.ContextMenu.IconInfo;u.propTypes={onClose:n.func.isRequired,toggleFilter:n.func,clearFilter:n.func};function u(e){return r.DOM.div(null,r.createElement(o,{key:s.Filter.key,label:s.Filter.label,iconName:l.Filter,disabled:!e.toggleFilter,onClick:e.toggleFilter,onClose:e.onClose}),r.createElement(o,{key:s.ClearFilter.key,label:s.ClearFilter.label,disabled:!e.clearFilter,onClick:e.clearFilter,onClose:e.onClose}))}t.exports=u},{"../../../../constant":256,popupmenu:146,react:"react"}],469:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant");var s=a.ContextMenu.MenuItemInfo;var l=a.ContextMenu.IconInfo;u.propTypes={
onClose:n.func.isRequired,setLock:n.func,unsetLock:n.func,clearAllLocks:n.func};function u(e){var t=[r.createElement(o,{key:s.Lock.key,label:s.Lock.label,iconName:l.Lock,disabled:!e.setLock,onClick:e.setLock,onClose:e.onClose})];if(e.hasLocks){t=t.concat([r.createElement(o,{key:s.Unlock.key,label:s.Unlock.label,iconName:l.Unlock,disabled:!e.unsetLock,onClick:e.unsetLock,onClose:e.onClose}),r.createElement(o,{key:s.UnlockAll.key,label:s.UnlockAll.label,iconName:l.Unlock,disabled:!e.clearAllLocks,onClick:e.clearAllLocks,onClose:e.onClose})])}return r.DOM.div(null,t)}t.exports=u},{"../../../../constant":256,popupmenu:146,react:"react"}],470:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant").ContextMenu.MenuItemInfo;s.propTypes={onClose:n.func.isRequired,toggleView:n.func};function s(e){return r.createElement(o,{key:a.MeasureProperties.key,label:a.MeasureProperties.label,disabled:!e.toggleView,onClick:e.toggleView,onClose:e.onClose})}t.exports=s},{"../../../../constant":256,popupmenu:146,react:"react"}],471:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant").ContextMenu.MenuItemInfo;s.propTypes={onClose:n.func.isRequired,resetState:n.func};function s(e){return r.createElement(o,{key:a.ResetState.key,label:a.ResetState.label,disabled:!e.resetState,onClick:e.resetState,onClose:e.onClose})}t.exports=s},{"../../../../constant":256,popupmenu:146,react:"react"}],472:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("popupmenu").MenuItem;var a=e("../../../../constant");var s=a.ContextMenu.MenuItemInfo;var l=a.ContextMenu.IconInfo;u.propTypes={onClose:n.func.isRequired,sortAsc:n.func,sortDesc:n.func,clearSortHidden:n.bool,clearSort:n.func};function u(e){return r.DOM.div(null,r.createElement(o,{key:s.SortAsc.key,label:s.SortAsc.label,iconName:l.SortAsc,disabled:!e.sortAsc,onClick:e.sortAsc,onClose:e.onClose}),r.createElement(o,{key:s.SortDesc.key,label:s.SortDesc.label,iconName:l.SortDesc,disabled:!e.sortDesc,onClick:e.sortDesc,onClose:e.onClose}),e.clearSortHidden?null:r.createElement(o,{key:s.ClearSort.key,label:s.ClearSort.label,disabled:!e.clearSort,onClick:e.clearSort,onClose:e.onClose}))}t.exports=u},{"../../../../constant":256,popupmenu:146,react:"react"}],473:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.PropTypes;var a=e("popupmenu");var s=a.Menu;var l=a.PopupMenu;var u=a.Divider;var c=e("./items/reset");var d=e("./items/configuration_mode");var p=e("./items/chart_mode");var f=e("./items/details");var h=e("./items/create_item");var g=e("./items/sort");var m=e("../../custom_react_prop_types").shapeFromWithOmit;var v=r.partial(m,"onClose");var y=n.createClass({displayName:"LevelHeaderMenu",propTypes:{createLevel:v(h),details:v(f),configurationMode:v(d),chartMode:v(p),sort:v(g),reset:v(c),onClose:o.func.isRequired},mergeProps:function(e){return r.extend({},this.props[e],{onClose:this.props.onClose})},render:function(){return n.createElement(l,this.props,n.createElement(s,{onClose:this.props.onClose},this.props.createLevel?n.createElement(h,this.mergeProps("createLevel")):null,this.props.details?n.createElement(f,this.mergeProps("details")):null,this.props.details?n.createElement(u):null,n.createElement(g,this.mergeProps("sort")),n.createElement(u),n.createElement(d,this.mergeProps("configurationMode")),n.createElement(p,this.mergeProps("chartMode")),n.createElement(u),n.createElement(c,this.mergeProps("reset"))))}});t.exports=y},{"../../custom_react_prop_types":396,"./items/chart_mode":461,"./items/configuration_mode":463,"./items/create_item":465,"./items/details":467,"./items/reset":471,"./items/sort":472,lodash:70,popupmenu:146,react:"react"}],474:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.PropTypes;var a=e("popupmenu");var s=a.Menu;var l=a.PopupMenu;var u=a.Divider;var c=e("./items/reset");var d=e("./items/configuration_mode");var p=e("./items/chart_mode");var f=e("./items/sort");var h=e("./items/filter");var g=e("./items/conditional_formatting");var m=e("../../custom_react_prop_types").shapeFromWithOmit;var v=r.partial(m,"onClose");var y=n.createClass({displayName:"MeasureHeaderMenu",propTypes:{filter:v(h),sort:v(f),configurationMode:v(d),chartMode:v(p),reset:v(c),onClose:o.func.isRequired},mergeProps:function(e){return this.props[e]&&r.extend({},this.props[e],{onClose:this.props.onClose})},render:function(){return n.createElement(l,this.props,n.createElement(s,{onClose:this.props.onClose},n.createElement(h,this.mergeProps("filter")),n.createElement(u),n.createElement(f,this.mergeProps("sort")),n.createElement(u),n.createElement(g,this.mergeProps("conditionalFormatting")),n.createElement(u),n.createElement(d,this.mergeProps("configurationMode")),n.createElement(p,this.mergeProps("chartMode")),n.createElement(u),n.createElement(c,this.mergeProps("reset"))))}});t.exports=y},{"../../custom_react_prop_types":396,"./items/chart_mode":461,"./items/conditional_formatting":462,"./items/configuration_mode":463,"./items/filter":468,"./items/reset":471,"./items/sort":472,lodash:70,popupmenu:146,react:"react"}],475:[function(e,t,i){"use strict";var r=e("react");var n=e("classnames");var o=e("immutable");var a=e("../form/form_helper");var s=e("../../constant");var l=s.Layout;var u=r.createClass({displayName:"MenuBar",propTypes:{modelerApp:r.PropTypes.object.isRequired,modelerState:r.PropTypes.object.isRequired,id:r.PropTypes.string.isRequired,uniqueId:r.PropTypes.string.isRequired,config:r.PropTypes.object.isRequired,sheetConfig:r.PropTypes.object.isRequired,sheetUniqueId:r.PropTypes.string.isRequired,sheetId:r.PropTypes.string.isRequired,pivotState:r.PropTypes.object.isRequired,setViewState:r.PropTypes.func.isRequired,sheetViewMode:r.PropTypes.string.isRequired,mode:r.PropTypes.string.isRequired},setViewMode:function(e,t){if(this.props.mode!==e){this.props.modelerApp.getViewActionHandler().setViewMode(this.props.uniqueId,e,t)}},setDefaultMode:function(){this.setViewMode(l.VIEW_MODE.DEFAULT)},setChartMode:function(){this.setViewMode(l.VIEW_MODE.CHART)},canDisplayAsForm:function(e){var t=this.props.modelerState.measureModel,i=this.props.pivotState;return a.canDisplayAsForm(t,i,e)},setFormMode:function(){var e=this.canDisplayAsForm("X")?"X":this.canDisplayAsForm("Y")?"Y":undefined;if(e){this.setViewMode(l.VIEW_MODE.FORM,o.fromJS({form:{axis:e}}))}},toggleConfigurationMode:function(){var e=this.props.sheetViewMode===l.VIEW_MODE.DEFAULT?l.VIEW_MODE.CONFIGURATION:l.VIEW_MODE.DEFAULT;this.props.modelerApp.getViewActionHandler().setViewMode(this.props.sheetUniqueId,e)},openMenuBar:function(){var e=this.props.sheetConfig.set("menuBarOpen",true);this.props.setViewState(e)},closeMenuBar:function(){var e=this.props.sheetConfig.set("menuBarOpen",false);this.props.setViewState(e)},render:function(){var e=this.props.mode===l.VIEW_MODE.FORM||this.canDisplayAsForm("X")||this.canDisplayAsForm("Y"),t=this.props.sheetConfig.get("title"),i=this.props.sheetConfig,o=i.has("menuBarOpen")?i.get("menuBarOpen"):true;if(!o){return r.createElement("div",{className:"lb-open-menubar",title:"Open menu bar",onClick:this.openMenuBar},r.createElement("i",{className:"fa fa-angle-right"}))}return r.createElement("div",{className:"lb-menubar"},t?r.createElement("span",{key:"sheet-title",title:t,className:"lb-sheet-title"},r.createElement("span",{className:"inner"},t)):null,r.createElement("i",{key:"close",className:"fa fa-angle-left lb-menubar-item",title:"Close menu bar",onClick:this.closeMenuBar}),r.createElement("span",{key:"divider",className:"lb-menubar-item divider"}),r.createElement("i",{key:"table",className:n({active:this.props.mode===l.VIEW_MODE.DEFAULT},"fa fa-table lb-menubar-item"),title:"Table",onClick:this.setDefaultMode}),r.createElement("i",{key:"chart",className:n({active:this.props.mode===l.VIEW_MODE.CHART},"fa fa-area-chart lb-menubar-item"),title:"Chart",onClick:this.setChartMode}),r.createElement("i",{key:"form",className:n({disabled:!e,active:this.props.mode===l.VIEW_MODE.FORM},"fa fa-list-alt lb-menubar-item"),title:e?"Form":"Form mode doesn't support the current sheet configuration",onClick:this.setFormMode}),r.createElement("span",{key:"divider2",className:"lb-menubar-item divider"}),r.createElement("i",{key:"configuration",className:n({active:this.props.sheetViewMode===l.VIEW_MODE.CONFIGURATION},"fa fa-wrench lb-menubar-item"),title:"Configuration",onClick:this.toggleConfigurationMode}))}});t.exports=u},{"../../constant":256,"../form/form_helper":412,classnames:6,immutable:"immutable",react:"react"}],476:[function(e,t,i){"use strict";var r=e("react");var n=e("../../constant");var o=n.Layout;var a=n.View.Modules;var s=e("./menu_bar");var l=r.createClass({displayName:"PivotGrid",propTypes:{modelerApp:r.PropTypes.object.isRequired,id:r.PropTypes.string.isRequired,uniqueId:r.PropTypes.string.isRequired,config:r.PropTypes.object.isRequired,sheetUniqueId:r.PropTypes.string.isRequired,sheetId:r.PropTypes.string.isRequired,sheetConfig:r.PropTypes.object.isRequired,pivotState:r.PropTypes.object.isRequired,modelerState:r.PropTypes.object.isRequired,updatePivotState:r.PropTypes.func.isRequired,sheetViewMode:r.PropTypes.string.isRequired,mode:r.PropTypes.string.isRequired},getModuleId:function(e){switch(e){case o.VIEW_MODE.CHART:return a.VegaLite;case o.VIEW_MODE.FORM:return a.Form;default:return a.Grid}},render:function(){var e=this.props.modelerApp.getViewStore(),t=this.getModuleId(this.props.mode),i=e.getViewComponentByModuleId(t);return r.createElement("div",{className:"lb-pivot-grid"},r.createElement(s,this.props),r.createElement(i,this.props))}});t.exports=l},{"../../constant":256,"./menu_bar":475,react:"react"}],477:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("react");var a=e("../pivot/config_helper");var s=e("../../pivotconfig_helper");var l=e("../../store/multiaxisdatastore").MultiAxisDataEvents;var u=e("../../util/eventlistenermixin");var c=e("../../util").shouldReflectDataChange;var d=e("../../util").concatStrings;var p=function(e,t){var i=n.partial(d,t);return o.createClass({displayName:"PivotHOC",propTypes:{modelerApp:o.PropTypes.object.isRequired,id:o.PropTypes.string.isRequired,uniqueId:o.PropTypes.string.isRequired,config:o.PropTypes.object.isRequired,sheetUniqueId:o.PropTypes.string.isRequired,sheetId:o.PropTypes.string.isRequired,sheetConfig:o.PropTypes.object.isRequired,pivotState:o.PropTypes.object.isRequired,modelerState:o.PropTypes.object.isRequired,updatePivotState:o.PropTypes.func.isRequired,spec:o.PropTypes.object},mixins:[u],setEventListeners:function(){return[{emitter:this.props.modelerApp.getMultiAxisDataStore(),event:l.DATA_CHANGED,callback:this.onDataChanged}]},getInitialState:function(){return{headingData:{},isLoading:true}},componentWillMount:function(){this.setViewTaskConfig(this.props.pivotState)},componentWillReceiveProps:function(e){if(!r.is(this.props.sheetConfig,e.sheetConfig)){this.setViewTaskConfig(e.pivotState);this.setState({isLoading:true})}},componentWillUnmount:function(){this.props.modelerApp.getMultiAxisConfigActionHandler().setViewTaskInactive(this.generateTaskId(),"main")},setViewTaskConfig:function(e){var t=a.getConfig(e),i=s.pivotConfigToMultiAxisConfig(this.props.modelerState,this.generateTaskId(),t.pivotConfig);return this.props.modelerApp.getModelerActionHandler().setViewTaskConfig(this.generateTaskId(),"main",{maConfig:i,isUnmasked:false})},updateViewRange:function(e){this.props.modelerApp.getMultiAxisDataActionHandler().setViewTaskRange(this.generateTaskId(),"main",e)},shouldReflectDataChange:function(e){return e&&c(e,[{viewId:this.generateTaskId(),tasks:["main"]}])},onDataChanged:function(e){if(!this.shouldReflectDataChange(e.viewTasks)){return}var t=this.props.modelerApp.getMultiAxisDataStore().getHeadingData(this.generateTaskId(),"main"),i=this.isLoadingHeadingData(t),r;if(i){this.setState({isLoading:true});return}r=this.getRange(t);this.updateViewRange(r);if(!this.hasOutstandingRequestsForViewTask(r)){this.setState({headingData:t,isLoading:false})}},getRange:function(e){var t=e.getHeadingAxisInfo("X"),i=e.getHeadingAxisInfo("Y"),r=this.getSliceRange(e),n={X:{start:0,length:t?t.getLength():0},Y:{start:0,length:i?i.getLength():0}};if(r){n.Z=r}return n},getSliceRange:function(e){var t=this.props.modelerApp.getMultiAxisConfigStore().getViewTaskConfig(this.generateTaskId(),"main").maConfig.axis.get("Z"),i=e.getSelectedSliceFieldPos(t),r=e.getHeadingAxisInfo("Z").findRowNumForFieldPos(i);if(!n.isUndefined(r)){return{start:r,length:1}}},generateTaskId:function(){return i(this.props.sheetId)},hasOutstandingRequestsForViewTask:function(e){return this.props.modelerApp.getMultiAxisDataStore().hasOutstandingRequestsForViewTask(this.generateTaskId(),"main",e)},isLoadingHeadingData:function(e){return e.hasLoadingHeadings()||e.isLoadingSlice()},render:function(){var t=n.extend({},this.props,{headingData:this.state.headingData,isLoading:this.state.isLoading,range:!this.state.isLoading?this.getRange(this.state.headingData):{},viewTaskId:this.generateTaskId()});return o.createElement(e,t)}})};t.exports=p},{"../../pivotconfig_helper":330,"../../store/multiaxisdatastore":348,"../../util":357,"../../util/eventlistenermixin":360,"../pivot/config_helper":455,immutable:"immutable",lodash:70,react:"react"}],478:[function(e,t,i){"use strict";var r=e("react");var n=e("immutable");var o=e("lodash");var a=e("./config_helper");var s=e("../../multiaxisconfig");var l=e("../../constant");var u=l.View;var c=l.Layout;var d=l.MESSAGES;var p=l.Axes;var f=e("../../util/viewlayoututils");var h=e("../form/form_helper");var g=["config","form","selector"];var m=function(e){return r.createClass({displayName:"PivotStateTransformer",propTypes:{modelerApp:r.PropTypes.object.isRequired,id:r.PropTypes.string.isRequired,uniqueId:r.PropTypes.string.isRequired,mode:r.PropTypes.string,config:r.PropTypes.object.isRequired,modelerState:r.PropTypes.object.isRequired,pivotState:r.PropTypes.object.isRequired,updatePivotState:r.PropTypes.func.isRequired},getViewId:function(e){return e.get("views").findKey(function(e){return e.get("module")===u.Modules.PivotGrid})},isFormViewMode:function(){var e=this.getViewId(this.props.config);return this.props.config.getIn(["views",e,"viewMode"])===c.VIEW_MODE.FORM},untransformPivotState:function(e,t,i,r){var n=this.getFormAxis(e),o=a.getAxis(r,n).first(),l=a.getFilters(i);a.getFieldsForAxis(i,n).reverse().forEach(function(e){var i=a.getField(r,e.id,p.SLICE),u,c;if(e instanceof s.LevelField&&i){u=a.getFieldAttributeSort(i);c=l.get(e.id);r=a.removeField(t,r,i);r=a.moveField(t,r,e,n,o);r=a.setSort(r,i.id,u.sortType,u.sortAttr);if(c){r=a.setFilter(r,i.id,c)}o=a.getAxis(r,n).first()}});return r},updatePivotState:function(e){var t=this.props.modelerApp.getModalWindowsActionHandler(),i=this.props.pivotState,r=this.props.config,n=e.get("sliceValues"),o=this;if(this.isFormViewMode()){e=this.untransformPivotState(r,this.props.modelerState,i,e);if(!this.canDisplayAsForm(r,e)){return t.confirm(d.SWITCH_DEFAULT_MODE,d.PLEASE_CONFIRM).then(function(){return o.props.updatePivotState(e,function(e){e=o.setViewMode(e,c.VIEW_MODE.DEFAULT);return o.setSelector(e,n)})})}else{return this.props.updatePivotState(e,function(e){return o.setSelector(e,n)})}}else{return this.props.updatePivotState(e)}},canDisplayAsForm:function(e,t){var i=this.props.modelerState.measureModel,r=this.getFormAxis(e);return h.canDisplayAsForm(i,t,r)},canMoveInto:function(e,t,i,r){var n=a.canMoveInto(this.props.modelerState,e,t,i,r),o;if(n&&this.isFormViewMode()){o=this.untransformPivotState(this.props.config,this.props.modelerState,this.props.pivotState,e);n=n&&a.canMoveInto(this.props.modelerState,o,t,i,r)}return n},getFormAxis:function(e){var t=this.getViewId(e);return e.getIn(["views",t,"config","form","axis"])||"Y"},setViewMode:function(e,t){var i=this.props.config.get("views").findKey(function(e){return e.get("module")===u.Modules.PivotGrid});return f.setViewModeInLayout(e,i,t)},setSelector:function(e,t){var i=e.get("views").findKey(function(e){return e.get("module")===u.Modules.PivotGrid});return e.setIn(["views",i].concat(g),t)},transformPivotState:function(e,t,i){var r=this.getViewId(e),o=e.getIn(["views",r].concat(g),n.Map()),l=this.getFormAxis(e);a.getAxis(i,l).forEach(function(e){if(e instanceof s.DimensionField||e instanceof s.LevelField){i=a.moveField(t,i,e,p.SLICE);if(e instanceof s.DimensionField){e.fields.forEach(function(e){i=a.setFilter(i,e.id)})}else{i=a.setFilter(i,e.id)}}});i=a.storeSliceValues(t,i,o.toJS());return i},render:function(){var t=o.extend({},this.props,{updatePivotState:this.updatePivotState,canMoveInto:this.canMoveInto});if(this.isFormViewMode()){if(!this.canDisplayAsForm(this.props.config,this.props.pivotState)){throw new Error("Invalid pivot configuration for the form mode")}t.pivotState=this.transformPivotState(this.props.config,this.props.modelerState,this.props.pivotState)}return r.createElement(e,t)}})};t.exports=m},{"../../constant":256,"../../multiaxisconfig":328,"../../util/viewlayoututils":367,"../form/form_helper":412,"./config_helper":455,immutable:"immutable",lodash:70,react:"react"}],479:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("lodash");var a=e("./modalwindow").ModalWindow;var s=e("./okcancelbuttons");var l=e("controls").Checkbox;var u=e("./pivot/config_helper");var c=e("../constant").Direction;var d="350px";var p=r.createClass({displayName:"PivotSettingsWindow",propTypes:{visible:r.PropTypes.bool.isRequired,handleSave:r.PropTypes.func.isRequired,handleClose:r.PropTypes.func.isRequired,pivotSettings:r.PropTypes.array.isRequired},handleSave:function(){var e=this.refs.pivotOptions,t=e&&o.cloneDeep(e.state);this.props.handleSave(t)},render:function(){return r.createElement(a,{onHide:this.props.handleClose,title:"Pivot Settings",visible:this.props.visible,width:d,body:r.createElement(f,{ref:"pivotOptions",pivotSettings:this.props.pivotSettings}),footer:r.createElement(s,{okText:"Save",cancelText:"Discard",onOk:this.handleSave,onCancel:this.props.handleClose})})}});var f=r.createClass({displayName:"PivotStateOptions",propTypes:{pivotSettings:r.PropTypes.array.isRequired},getInitialState:function(){var e={};o.forEach(this.props.pivotSettings,function(t){e[t.id]=t.value});return e},componentWillMount:function(){this.uniqueId=o.uniqueId("pivot-options")},buildFormGroup:function(e,t,i){return r.DOM.div({className:"form-group pivot-settings-group",key:this.uniqueId+i},r.DOM.label({className:"control-label"},e+":"),r.DOM.div(null,t))},buildOptions:function(e){return o.map(e,function(e,t){return r.DOM.option({key:t,value:e},e)})},onInputChange:function(e,t){var i={};i[e]=t.target?t.target.value:t;this.setState(i)},buildSettingsItems:function(){var e=this,t,i;return o.map(this.props.pivotSettings,function(n){t=e.state[n.id];switch(n.type){case"dropdown":i=r.DOM.select({className:"input-sm form-control",value:t,ref:n.id,onChange:e.onInputChange.bind(e,n.id)},e.buildOptions(n.options));break;case"checkbox":i=r.createElement(l,{checked:t,ref:n.id,onChange:e.onInputChange.bind(e,n.id)});break;default:i=null}return e.buildFormGroup(n.title,i,n.id)})},render:function(){return r.DOM.form({className:"pivot-settings-form",role:"form"},this.buildSettingsItems())}});var h=r.createClass({displayName:"PivotSettingsWindowController",propTypes:{modelerApp:r.PropTypes.object.isRequired,pivotId:r.PropTypes.string.isRequired,pivotState:r.PropTypes.object},handleSave:function(e){var t=this.props.pivotState,i={moveDirection:u.getMoveDirection(t),isNonEmpty:u.isNonEmpty(t)},r;o.forEach(i,function(i,n){r=e[n];if(e.hasOwnProperty(n)&&r!==i){switch(n){case"moveDirection":t=u.setMoveDirection(t,r);break;case"isNonEmpty":t=u.hideEmptyValues(t,r);break}}});this.props.updatePivotState(t);this.handleClose()},handleClose:function(){this.setState({visible:false})},getInitialState:function(){return{visible:true}},componentDidUpdate:function(){if(!this.state.visible){n.unmountComponentAtNode(n.findDOMNode(this).parentNode)}},render:function(){var e=this.props.pivotState,t=[{id:"moveDirection",title:"After pressing Tab, move selection",value:u.getMoveDirection(e),type:"dropdown",options:[c.RIGHT,c.DOWN,c.LEFT,c.UP]},{id:"isNonEmpty",title:"Hide Empty Values",value:u.isNonEmpty(e),type:"checkbox"}];return r.createElement(p,{visible:this.state.visible,handleSave:this.handleSave,handleClose:this.handleClose,pivotSettings:t})}});t.exports=h},{"../constant":256,"./modalwindow":437,"./okcancelbuttons":448,"./pivot/config_helper":455,controls:8,lodash:70,react:"react","react-dom":"react-dom"}],480:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("lodash");var a=7;var s=r.createClass({displayName:"Popover",propTypes:{getTarget:r.PropTypes.func.isRequired,direction:r.PropTypes.oneOf(["top","right","bottom","left"]),onClose:r.PropTypes.func.isRequired,openPoint:r.PropTypes.shape({x:r.PropTypes.number,y:r.PropTypes.number}),width:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.func,r.PropTypes.number]),height:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.func,r.PropTypes.number])},getInitialState:function(){return{}},componentDidMount:function(){this.popover=document.createElement("div");this.popover.className="lb-popover-wrapper";document.body.appendChild(this.popover);document.addEventListener("click",this.onClick,true);document.addEventListener("contextmenu",this.onClick,true);window.addEventListener("resize",this.props.onClose,false);this.renderPopover()},componentDidUpdate:function(){this.renderPopover()},componentWillUnmount:function(){n.unmountComponentAtNode(this.popover);document.body.removeChild(this.popover);document.removeEventListener("click",this.onClick,true);document.removeEventListener("contextmenu",this.onClick,true);window.removeEventListener("resize",this.props.onClose,false)},onClick:function(e){if(document.compareDocumentPosition(e.target)&Node.DOCUMENT_POSITION_CONTAINED_BY&&!(this.popover.compareDocumentPosition(e.target)&Node.DOCUMENT_POSITION_CONTAINED_BY)){this.props.onClose()}},getOffset:function(e){var t=e.getBoundingClientRect(),i=window.getComputedStyle(document.body),r=parseInt(i.marginTop),n=parseInt(i.marginLeft);return{top:t.top+window.pageYOffset-document.documentElement.clientTop-r,left:t.left+window.pageXOffset-document.documentElement.clientLeft-n}},getPopoverDisplayParams:function(){var e=n.findDOMNode(this.props.getTarget()),t=this.getOffset(e),i=e.getBoundingClientRect(),r=this.props.direction||this.getDirection(i),s=this.props.openPoint,l={},u={};if(!s){u[r==="top"||r==="bottom"?"left":"top"]="50%"}if(r==="top"){l.bottom=document.body.offsetHeight-t.top}else if(r==="right"){l.left=t.left+i.width}else if(r==="bottom"){l.top=t.top+i.height}else if(r==="left"){l.right=document.body.offsetWidth-t.left}if(r==="top"||r==="bottom"){l.left=t.left;u.left=s?Math.max(s.x-l.left-a,a):u.left}if(r==="right"||r==="left"){l.top=t.top;u.top=s?Math.max(s.y-l.top-a,a):u.top}l.width=o.isFunction(this.props.width)?this.props.width(r,i):this.props.width;l.height=o.isFunction(this.props.height)?this.props.height(r,i):this.props.height;return{styles:l,direction:r,arrowStyles:u}},getDirection:function(e){var t=window.innerWidth,i=window.innerHeight;if(e.height>=e.width){return e.left>=t-e.right?"left":"right"}return e.top>=i-e.bottom?"top":"bottom"},fixPopoverSize:function(){var e=this.popover.firstChild,t=e.firstChild,i=e.getBoundingClientRect(),r=document.body.offsetHeight,n=document.body.offsetWidth,s=i.height,l=i.width,u=this.params.arrowStyles.left,c=this.params.arrowStyles.top,d=a*2,p=i.width-a*2,f=a*2,h=i.height-a*2;if(i.top<0){s+=i.top;e.style.height=s+"px"}if(r-i.bottom<0){s+=r-i.bottom;e.style.height=s+"px"}if(i.left<0){l+=i.left;e.style.width=l+"px"}if(n-i.right<0){l+=n-i.right;e.style.width=l+"px"}if(o.isNumber(u)){if(u<d){u=d}if(u>p){u=p}t.style.left=u+"px"}if(o.isNumber(c)){if(c<f){c=f}if(c>h){c=h}t.style.top=c+"px"}},renderPopover:function(){var e=this.getPopoverDisplayParams(),t=r.DOM.div({style:e.styles,className:"lb-popover "+e.direction},r.DOM.div({className:"lb-arrow",style:e.arrowStyles}),this.props.children);this.params=e;n.render(t,this.popover,this.fixPopoverSize)},render:function(){return null}});t.exports=s},{lodash:70,react:"react","react-dom":"react-dom"}],481:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("../constant").ButtonTypes;var a=e("./modalwindow").ModalWindow;var s=e("./panelbutton").PanelButton;var l=e("../store/multiaxisdatastore").MultiAxisDataEvents;var u=e("../util/eventlistenermixin");var c=e("./table");var d=n.createClass({displayName:"ReviewEditsDialogController",mixins:[u],propTypes:{modelerApp:n.PropTypes.object.isRequired,closeWindow:n.PropTypes.func.isRequired},setEventListeners:function(){return[{emitter:this.props.modelerApp.getMultiAxisDataStore(),event:l.DATA_CHANGED,callback:this.$cellDataChanged}]},getInitialState:function(){return{edits:this.props.modelerApp.getMultiAxisDataStore().getAllPendingEdits()}},render:function(){var e=this.state.edits,t=[],i;if(e.length){var l=["Measure","Position","Value",""];e=this.$buildTable(e);i=n.createElement(c,{headings:l,table:e});t=[n.createElement(s,{key:r.uniqueId("ReviewButton"),type:o.OK,text:"Calculate All",onClick:this.calculateAll}),n.createElement(s,{key:r.uniqueId("ReviewButton"),type:o.DISCARD,text:"Discard All",onClick:this.discardAll})]}else{i=n.DOM.span(null,"There are no pending edits.")}t.push(n.createElement(s,{key:r.uniqueId("ReviewButton"),type:o.CANCEL,text:"Close",onClick:this.close}));return n.createElement(a,{visible:true,title:"Review Edits",body:i,footer:n.DOM.div(null,t),windowClass:"lb-review-edits-dialog"})},calculateAll:function(){this.props.modelerApp.getMultiAxisDataActionHandler().commitPendingEdits();this.close()},discardAll:function(){this.props.modelerApp.getMultiAxisDataActionHandler().clearEdits();this.close()},close:function(){this.props.closeWindow()},discard:function(e){this.props.modelerApp.getMultiAxisDataActionHandler().clearEdits([e])},$cellDataChanged:function(){this.setState(this.getInitialState())},$buildTable:function(e){var t=this,i=[];r.forEach(e,function(e){i.push([e.editConfig.dataConfigQuery.measure.name,e.positionInfo.members.join(", "),e.edit.formattedValue,n.DOM.a({href:"javascript:",onClick:t.discard.bind(t,e)},"Delete")])});return i}});t.exports=d},{"../constant":256,"../store/multiaxisdatastore":348,"../util/eventlistenermixin":360,"./modalwindow":437,"./panelbutton":454,"./table":504,lodash:70,react:"react"}],482:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("../constant").ButtonTypes;var a=e("./reviewtabledialog");var s=e("./panelbutton").PanelButton;var l=e("../store/multiaxisdatastore").MultiAxisDataEvents;var u=e("../util/eventlistenermixin");var c="There are no locks.";var d="Clear All";var p="Clear";var f="Close";var h=["Measure","Position",""];var g=n.createClass({displayName:"ReviewLocksDialogController",mixins:[u],propTypes:{modelerApp:n.PropTypes.object.isRequired,closeWindow:n.PropTypes.func.isRequired},setEventListeners:function(){return[{emitter:this.props.modelerApp.getMultiAxisDataStore(),event:l.DATA_CHANGED,callback:this.$cellDataChanged}]},getInitialState:function(){return{locks:this.props.modelerApp.getMultiAxisDataStore().getLocks(),uniqueId:r.uniqueId("review-locks")}},getColumns:function(){var e=this,t=this.state.locks,i=this.state.uniqueId;return r.chain(t).map(function(t){var o=t.editConfig.coreEditMeasure.metric.name;return r.map(t.positions,function(a){return[o,r.values(a.position).join(", "),n.DOM.a({key:i+o+a.key,href:"javascript:",onClick:e.clearLock.bind(e,t)},p)]})}).flatten().value()},render:function(){var e=this.getColumns();return n.createElement(a,{title:"Review Locks",className:"lb-review-edits-dialog",headings:h,columns:e,emptyTableMessage:c,buttons:[n.createElement(s,{key:this.state.uniqueId+"-btn-clear",text:d,type:o.DISCARD,onClick:this.clearAll}),n.createElement(s,{key:this.state.uniqueId+"-btn-cancel",type:o.CANCEL,text:f,onClick:this.close})]})},clearLock:function(e){this.props.modelerApp.getMultiAxisDataActionHandler().unsetLocks([e])},clearAll:function(){this.props.modelerApp.getMultiAxisDataActionHandler().clearAllLocks();this.close()},close:function(){r.isFunction(this.props.closeWindow)&&this.props.closeWindow()},$cellDataChanged:function(){this.setState(this.getInitialState())}});t.exports=g},{"../constant":256,"../store/multiaxisdatastore":348,"../util/eventlistenermixin":360,"./panelbutton":454,"./reviewtabledialog":484,lodash:70,react:"react"}],483:[function(e,t,i){"use strict";var r=e("react");var n=e("./toggleoption");var o=e("../store/multiaxisdatastore").MultiAxisDataEvents;var a=e("../util/eventlistenermixin");var s=r.createClass({displayName:"ReviewLocksOption",mixins:[a],propTypes:{modelerApp:r.PropTypes.object.isRequired},getInitialState:function(){return{isActive:this.isActiveFn()}},getDefaultProps:function(){return{shouldDisplay:true}},setEventListeners:function(){return[{emitter:this.props.modelerApp.getMultiAxisDataStore(),event:o.DATA_CHANGED,callback:this.onCellDataChanged}]},componentDidUpdate:function(e){if(e.modelerApp!==this.props.modelerApp){this.attachEventListeners()}},isActiveFn:function(){return!!this.props.modelerApp.getMultiAxisDataStore().hasLocks()},onCellDataChanged:function(){this.setState({isActive:this.isActiveFn()})},showDialog:function(){this.state.isActive&&this.props.modelerApp.getModelerActionHandler().reviewLocks()},render:function(){if(this.props.shouldDisplay){return r.createElement(n,{isActive:this.state.isActive,toggleActive:this.showDialog},r.DOM.i({className:"fa fa-lock"}),"Locks")}else{return r.DOM.div()}}});t.exports=s},{"../store/multiaxisdatastore":348,"../util/eventlistenermixin":360,"./toggleoption":505,react:"react"}],484:[function(e,t,i){"use strict";var r=e("react");var n=e("./modalwindow").ModalWindow;var o=e("./table");var a="There are no items.";var s=r.createClass({displayName:"ReviewTableDialogController",propTypes:{title:r.PropTypes.string.isRequired,className:r.PropTypes.string.isRequired,headings:r.PropTypes.array.isRequired,columns:r.PropTypes.array.isRequired,buttons:r.PropTypes.array.isRequired,emptyTableMessage:r.PropTypes.string},render:function(){var e;if(this.props.columns&&this.props.columns.length){e=r.createElement(o,{headings:this.props.headings,table:this.props.columns})}else{e=r.DOM.span(null,this.props.emptyTableMessage||a)}return r.createElement(n,{visible:true,title:this.props.title,body:e,footer:r.DOM.div(null,this.props.buttons),windowClass:this.props.className})}});t.exports=s},{"./modalwindow":437,"./table":504,react:"react"}],485:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=r.DOM;var a=e("classnames");var s=e("lodash");var l=e("./formulaeditor");function u(e){var t="formula-icon fa fa-ellipsis-v embossed";return o.div({className:"formula"},o.div({className:t}),e)}var c=r.createClass({displayName:"PrimaryFormulaEditor",render:function(){return o.div({className:"primary-formula"},r.Children.map(this.props.children,u))}});var d=r.createClass({displayName:"InverseFormulaEditors",render:function(){return o.div({className:a({"inverse-formulas":true,collapse:true,in:!this.props.inverseCollapsed})},r.Children.map(this.props.children,u))}});var p=r.createClass({displayName:"RuleStatus",mixins:[n],render:function(){var e=!!this.props.errorMessage,t="",i={};if(e){t="formula-error";i={className:"fa fa-times",title:this.props.errorMessage}}return o.span({className:"formula-validation "+t},o.i(i))}});var f=r.createClass({displayName:"CollapseButton",mixins:[n],render:function(){return o.span({ref:"btn",className:"collapse-btn",onClick:this.props.onClick,hidden:this.props.hidden},o.i({className:this.props.inverseCollapsed?"fa fa-caret-square-o-right":"fa fa-caret-square-o-down"
}))}});var h=r.createClass({displayName:"AddInverseButton",mixins:[n],render:function(){return o.span({className:"add-inverse-btn",ref:"btn",onClick:this.props.onClick},o.i({className:"fa fa-random"}))}});var g=r.createClass({displayName:"RuleEditor",propTypes:{primaryEditor:r.PropTypes.object.isRequired,inverseEditors:r.PropTypes.array.isRequired,error:r.PropTypes.string,metricCompletions:r.PropTypes.array,addMetricToPivot:r.PropTypes.func,getMetric:r.PropTypes.func,enterEditMode:r.PropTypes.func,submitRule:r.PropTypes.func,addInverseFormulaEditor:r.PropTypes.func,editFormula:r.PropTypes.func,onEditorEsc:r.PropTypes.func,addRuleEditor:r.PropTypes.func.isRequired},getDefaultProps:function(){return{primaryEditor:{},inverseEditors:[]}},isEditing:function(){var e=this.props.primaryEditor,t=this.props.inverseEditors;return e.isEditing||s.some(t,{isEditing:true})},getInitialState:function(){return{inverseCollapsed:false}},componentWillMount:function(){this.props.addRuleEditor()},onMetricClick:function(e){if(this.props.addMetricToPivot){this.props.addMetricToPivot(e)}},onFormulaChange:function(e,t){if(this.props.editFormula){this.props.editFormula(e,t)}},onFormulaDoubleClick:function(e){var t=this.props.primaryEditor.editorId,i=t===e;if(!i){this.props.enterEditMode(t,e)}},onSetInverseCollapsed:function(){this.setState({inverseCollapsed:!this.state.inverseCollapsed})},buildFormulaEditor:function(e){var t=e.formula,i=t&&t.accept&&t,n=e.value;return r.createElement(l,{key:e.editorId,editorId:e.editorId,metricCompletions:this.props.metricCompletions,onMetricClick:this.onMetricClick,getMetric:this.props.getMetric,formulaStr:n,formulaAST:i,isEditing:e.isEditing,onSubmit:this.props.submitRule,onEsc:this.props.onEditorEsc,onDoubleClick:this.onFormulaDoubleClick,onFormulaChange:this.onFormulaChange})},render:function(){var e=this.buildFormulaEditor(this.props.primaryEditor),t=this.props.inverseEditors.map(this.buildFormulaEditor);return o.div({className:"rule-editor"},o.div({className:"formulas"},r.createElement(c,{},e),r.createElement(d,{ref:"inverse-editors",inverseCollapsed:this.state.inverseCollapsed},t)),r.createElement(p,{errorMessage:this.props.error}),this.isEditing()?o.span({className:"formula-save-btn fa fa-floppy-o",onClick:this.props.submitRule}):null,r.createElement(f,{ref:"collapse-btn",inverseCollapsed:this.state.inverseCollapsed,onClick:this.onSetInverseCollapsed,hidden:!this.props.inverseEditors||this.props.inverseEditors.length===0}),r.createElement(h,{ref:"add-inverse-btn",onClick:this.props.addInverseFormulaEditor}))}});t.exports=g},{"./formulaeditor":415,classnames:6,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],486:[function(e,t,i){"use strict";var r=e("react");var n=e("immutable");var o=e("lodash");var a=e("../multiaxisconfig");var s=a.FieldTypes;var l=e("../constant").SignalDataTypes;var u=e("../util").concatStrings;var c=e("./pivot/config_helper");var a=e("../multiaxisconfig");var d=Object.freeze({SLICE_CHANGE:{name:"Slice Change",dataType:l.POSITIONS,description:"The event is fired when slice value is changed."}});var p=Object.freeze({CHANGE_SLICE:{name:"Change Slice",dataType:l.POSITIONS,handler:"changeSliceSignalHandler",description:"Sets the given slice values."}});var f=o.partial(u,"Slice");var h=function(e){return r.createClass({displayName:"SheetViewSignalsHOC",getSignalListeners:function(){return this.getFlattenFields("Z").map(function(e){return f(e.get("id"))})},getViewState:function(){return this.props.modelerApp.getViewConfigStore().getViewState(this.props.id)},createPivotState:function(){var e=this.getViewState().toJS();return c.pivotStateFromPivotConfig(this.props.modelerState,this.props.id,e.pivotConfig,e.gridOptions)},getFlattenFields:function(e){return this.getAxis(e).reduce(function(e,t){if(t.type===s.DIMENSION){e=e.concat(t.get("fields"))}else if(t.type===s.LEVEL||t.type===s.MEASURE_GROUP){e=e.push(t)}return e},n.List())},getAxis:function(e){var t=this.createPivotState();return c.getAxis(t,e)},changeSliceSignalHandler:function(e){var t=e[0].qualifiedName,i=e[0].positions[0],r=this.createPivotState(),n=c.getField(r,t,"Z"),o={};if(n instanceof a.MeasureGroupField){i=n.get("fields").find(function(e){return e.get("id")===i})&&i}if(i&&c.getSliceValueForField(r,t)!==i){o[t]=i;r=c.storeSliceValues(this.props.modelerState,r,o);this.props.updatePivotState(r)}},render:function(){return r.createElement(e,this.props)},statics:{signals:{events:o.values(d),handlers:o.values(p)}}})};t.exports.Events=d;t.exports.Handlers=p;t.exports.getSliceComponentId=f;t.exports.SheetViewSignalsHOC=h},{"../constant":256,"../multiaxisconfig":328,"../util":357,"./pivot/config_helper":455,immutable:"immutable",lodash:70,react:"react"}],487:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("react");var a=e("../util/viewlayoututils");var s=e("./sheetview");var l=e("./layoutview");var u=e("../constant/view");var c="fill";var d={shape:{rows:"1,1",columns:"1"},viewPositions:{}};d.viewPositions[u.Modules.ModelBrowser]={rowspan:c};d.viewPositions[u.Modules.Measures]={row:1,rowspan:c};d=r.fromJS(d);var p=o.createClass({displayName:"SheetConfigurationPanel",propTypes:{sheetUniqueId:o.PropTypes.string.isRequired,modelerApp:o.PropTypes.object.isRequired,config:o.PropTypes.object.isRequired,sheetConfig:o.PropTypes.object.isRequired,closeComponentFn:o.PropTypes.func.isRequired},getInitialState:function(){return{components:[]}},componentWillMount:function(){this.updateComponentsStates()},componentWillReceiveProps:function(e){var t=e.config,i=t.get("components");if(!r.is(this.props.config,t)&&(!i||!i.size)){this.props.closeComponentFn(this.props.id)}else{this.updateComponentsStates(e)}},updateComponentsStates:function(e){e=e||this.props;var t=e.modelerApp.getViewConfigStore(),i=e.config,n=i.get("components")&&i.get("components").toJS(),o=n&&n.indexOf(u.Modules.Measures)!==-1,s=n&&n.indexOf(u.Modules.ModelBrowser)!==-1,l,c,d,p,f,h=r.Map();if(s){d=a.getInlineViewState(e.sheetConfig,u.Modules.ModelBrowser);if(!d){f=this.props.modelerApp.getViewStore().getParentId(e.sheetUniqueId);p=f&&t.getViewState(f);if(p){d=a.getInlineViewState(p,u.Modules.ModelBrowser)}d=d||r.fromJS({module:u.Modules.ModelBrowser})}d=d.delete("closed");h=h.set(u.Modules.ModelBrowser,d)}if(o){h=h.set(u.Modules.Measures,a.getInlineViewState(e.sheetConfig,u.Modules.Measures)||r.fromJS({module:u.Modules.Measures}))}this.setState({components:h})},buildLayoutState:function(){var e=this,t=this.props.sheetConfig,i=this.props.config,n=this.props.config.get("components"),o=false,s=false,l=d,c,p=r.Map(),f=this.props.modelerApp.getViewConfigStore();if(n){o=n.find(function(e){return e===u.Modules.Measures});s=n.find(function(e){return e===u.Modules.ModelBrowser})}[{module:u.Modules.ModelBrowser,visible:s},{module:u.Modules.Measures,visible:o}].forEach(function(i){if(i.visible){c=a.getInlineViewId(t,i.module);l=l.setIn(["viewPositions",c],l.getIn(["viewPositions",i.module]));p=p.set(c,e.state.components.get(i.module))}if(!i.visible||c&&c!==i.module){l=l.deleteIn(["viewPositions",i.module])}});return r.fromJS({layout:l,views:p})},buildComponent:function(e,t){var i=this.props.modelerApp.getViewComponentForModule(t),r,a;if(i){a=this.state.components.get(t);r=n.extend({},this.props,{id:e,key:e,config:a.config||a});return o.createElement(i,r)}return null},buildPanelComponents:function(e){var t=this,i=r.List();e.get("views").forEach(function(e,r){if(t.state.components.get(e.get("module"))){i=i.push(t.buildComponent(r,e.get("module")))}});return i},render:function(){var e=n.extend({},this.props,{config:this.buildLayoutState()});return o.createElement(l,e,this.buildPanelComponents(e.config))},statics:{toogleComponentVisibility:function(e,t){var i=e||r.fromJS({module:u.Modules.SheetConfigurationPanel}),n;i=i.set("components",i.get("components")||r.List());n=i.get("components").findIndex(function(e){return e===t});if(n!==-1){i=i.updateIn(["components"],function(e){return e.splice(n,1)})}else{i=i.updateIn(["components"],function(e){return e.push(t)})}return i},isComponentOpened:function(e,t){return e&&t&&e.get("components").find(function(e){return e===t})}}});t.exports=p},{"../constant/view":273,"../util/viewlayoututils":367,"./layoutview":422,"./sheetview":488,immutable:"immutable",lodash:70,react:"react"}],488:[function(e,t,i){"use strict";var r=e("immutable");var n=e("react");var o=e("./layoutview");var a=e("../store/multiaxisdatastore").MultiAxisDataEvents;var s=e("./pivot/config_helper");var l=e("../pivotconfig_helper");var u=e("../util/eventlistenermixin");var c=e("./sheetviewwrapper");var d=e("./cssloader");var p=e("../util/viewlayoututils");var f=e("../util").shouldReflectDataChange;var h=e("./pivot/pivot_state_transformer");var g=e("./signallable");var m=e("./sheet_view_signals").SheetViewSignalsHOC;var v=e("../constant");var y=v.View;var b=v.Layout;var w=[y.Modules.SheetConfigurationPanel,y.Modules.ModelBrowser,y.Modules.Measures];var C=[y.Modules.ModelBrowser,y.Modules.Measures];var E=[y.Modules.SheetConfigurationPanel];var S={options:{size:"200px",openIn:b.POSITION.LEFT}};var T={module:y.Modules.SheetConfigurationPanel,components:[y.Modules.ModelBrowser,y.Modules.Measures]};var x={processConfig:function(e,t){var i=e.get("views").merge(e.getIn(["layout","viewPositions"])).keySeq().toArray();i.forEach(function(i){var r=e.getIn(["views",i]);if(!r||!_.isViewModuleAllowed(r.get("module"),t)){e=e.deleteIn(["layout","viewPositions",i]);if(r&&E.indexOf(r.module)!==-1){e=e.setIn(["views",i,"closed"],true)}else if(r){e=e.deleteIn(["views",i])}}});return e},openDefaultViews:function(e,t){var i=p.getInlineViewId(e,y.Modules.SheetConfigurationPanel);if(t===b.VIEW_MODE.CONFIGURATION&&!e.getIn(["views",i])){return p.openViewInLayout(e,i,T,S)}return e},isViewModuleAllowed:function(e,t){if(t===b.VIEW_MODE.CONFIGURATION){return C.indexOf(e)===-1}return w.indexOf(e)===-1}};var _=n.createClass({displayName:"Sheet View",propTypes:{id:n.PropTypes.string.isRequired,uniqueId:n.PropTypes.string.isRequired,mode:n.PropTypes.string,config:n.PropTypes.object.isRequired,modelerState:n.PropTypes.object.isRequired,pivotState:n.PropTypes.object.isRequired,updatePivotState:n.PropTypes.func.isRequired,canMoveInto:n.PropTypes.func.isRequired},mixins:[u],setEventListeners:function(){var e=this.props.modelerApp.getMultiAxisDataStore();return[{emitter:e,event:a.DATA_CHANGED,callback:this.onDataChange}]},getInitialState:function(){return{headingData:undefined}},componentWillMount:function(){this.validateViewConfig();var e=s.getConfig(this.props.pivotState);this.initializeSheet(e.pivotConfig)},componentWillReceiveProps:function(e){var t=s.getConfig(e.pivotState);this.initializeSheet(t.pivotConfig)},componentWillUnmount:function(){this.props.modelerApp.getMultiAxisConfigActionHandler().setViewTaskInactive(this.props.id,"main")},initializeSheet:function(e){var t=l.pivotConfigToMultiAxisConfig(this.props.modelerState,this.props.id,e);t=t.set("queryLevelFilterFlag",true);return this.props.modelerApp.getModelerActionHandler().setViewTaskConfig(this.props.id,"main",{maConfig:t,isUnmasked:false})},shouldReflectDataChange:function(e){return e&&f(e,[{viewId:this.props.id,tasks:["main"]}])},onDataChange:function(e){if(!this.shouldReflectDataChange(e.viewTasks)){return}var t=this.props.modelerApp.getMultiAxisDataStore().getHeadingData(this.props.id,"main");if(t&&t!==this.state.headingData){this.setState({headingData:t})}},getConfigWithOpenDefaultViews:function(){return _.openDefaultViews(this.props.config,this.props.mode)},openComponent:function(e,t,i){var r=p.openViewInLayout(this.getConfigWithOpenDefaultViews(),e,i,t);this.props.setViewState(r)},closeComponent:function(e){var t=this.getConfigWithOpenDefaultViews(),i=t.getIn(["views",e]),r=i&&i.get("module")===y.Modules.SheetConfigurationPanel,n=p.closeViewInLayout(t,e,r);this.props.setViewState(n)},validateViewConfig:function(){var e=this.props.config;if(e.hasIn(["views","grid","config","broadcastToPivotStore"])){console.warn("Broadcasting slice values is no longer supported. To achieve this, configure Signals for each view you wish to synchronize. "+"Take a look at '"+this.props.id+"' sheet configuration.")}if(e.hasIn(["pivotConfig","sliceValueMeasure"])){console.warn("'sliceValueMeasure' is no longer supported. To achieve this, configure Signals for each view you wish to synchronize. "+"Take a look at '"+this.props.id+"' sheet configuration.")}},buildSheetModules:function(e){var t=this.props.modelerApp,i=t.getViewStore();return e.get("views").map(function(r,o){var a=t.getViewComponentForModule(r.get("module"));return a&&n.createElement(a,{id:o,key:o,uniqueId:i.getViewUniqueId(this.props.uniqueId,o),config:r.get("config")||r,modelerApp:t,mode:p.getCurrentViewModeInParentLayout(o,e),sheetUniqueId:this.props.uniqueId,sheetId:this.props.id,sheetConfig:e,sheetViewMode:this.props.mode,headingData:this.state.headingData,openComponentFn:this.openComponent,closeComponentFn:this.closeComponent,signals:this.props.signals,setViewState:this.props.setViewState,modelerState:this.props.modelerState,pivotState:this.props.pivotState,updatePivotState:this.props.updatePivotState,canMoveInto:this.props.canMoveInto})},this).toList()},render:function(){if(!this.state.headingData){return n.createElement(d,{caption:"Data is loading..."})}var e=_.openDefaultViews(_.processConfig(this.props.config,this.props.mode),this.props.mode);return n.createElement(o,{id:this.props.id,uniqueId:this.props.uniqueId,modelerApp:this.props.modelerApp,config:e,mode:this.props.mode,height:this.props.height,width:this.props.width},this.buildSheetModules(e))},statics:x});var M=c(h(g(m(_))));Object.assign(M,x);t.exports=M},{"../constant":256,"../pivotconfig_helper":330,"../store/multiaxisdatastore":348,"../util":357,"../util/eventlistenermixin":360,"../util/viewlayoututils":367,"./cssloader":395,"./layoutview":422,"./pivot/config_helper":455,"./pivot/pivot_state_transformer":478,"./sheet_view_signals":486,"./sheetviewwrapper":489,"./signallable":495,immutable:"immutable",react:"react"}],489:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("immutable");var a=e("./pivot/config_helper");var s=e("../modelerstate");function l(e){return n.createClass({displayName:"SheetViewWrapper",propTypes:{modelerApp:n.PropTypes.object.isRequired,id:n.PropTypes.string.isRequired,config:n.PropTypes.object.isRequired},getPivotConfig:function(){return this.props.config.get("pivotConfig").toJS()},createModelerState:function(){return s.createModelerState(this.props.modelerApp)},createPivotState:function(e){var t=this.props.config.toJS();return a.pivotStateFromPivotConfig(e,this.props.id,t.pivotConfig,t.gridOptions)},updatePivotState:function(e,t){var i=a.getConfig(e),n=this.props.config;n=n.set("pivotConfig",o.fromJS(i.pivotConfig)).set("gridOptions",o.fromJS(i.gridOptions)).withMutations(t||r.identity);return this.props.setViewState(n)},render:function(){var t=this.createModelerState(),i=this.createPivotState(t);var o=r.defaults({modelerState:t,pivotState:i,updatePivotState:this.updatePivotState,ref:"wrapped"},this.props);return n.createElement(e,o)},statics:{processConfig:e.processConfig,isViewModuleAllowed:e.isViewModuleAllowed}})}t.exports=l},{"../modelerstate":313,"./pivot/config_helper":455,immutable:"immutable",lodash:70,react:"react"}],490:[function(e,t,i){"use strict";var r=e("react");var n=r.PropTypes;var o=e("./button");var a=e("./buttongroup");var s=r.createClass({displayName:"ShortcutButtons",propTypes:{buttonConfigs:n.object.isRequired,viewConfigs:n.object.isRequired,onButtonClick:n.func.isRequired,viewConfigChangeDetector:n.func.isRequired},isBtnActive:function(e){return this.props.viewConfigs.every(function(t){var i=this.props.viewConfigChangeDetector(t,e);return!i.shouldUpdate},this)},render:function(){var e=this.props.buttonConfigs.map(function(e,t){return r.createElement(o,{key:t,label:e.get("label"),title:e.get("label"),onClick:this.props.onButtonClick.bind(null,e),isActive:this.isBtnActive(e)})},this);return r.createElement(a,{className:"shortcut-buttons-panel"},e)}});t.exports=s},{"./button":383,"./buttongroup":384,react:"react"}],491:[function(e,t,i){"use strict";var r=e("immutable");var n=e("react");var o=n.PropTypes;var a=e("assert");var s=e("../util/immutable");var l=e("./shortcutbuttons");var u=e("../util/eventlistenermixin");var c=e("../constant").ViewConfig.EVENTS;var d=n.createClass({displayName:"ShortcutButtonsController",propTypes:{modelerApp:o.object.isRequired,config:o.object.isRequired,id:o.string.isRequired},mixins:[u],setEventListeners:function(){var e=this.props.modelerApp.getViewConfigStore();return this.props.config.get("applyToViews").map(function(t){return{emitter:e,emitterId:t,event:c.STATE_CHANGED,callback:this.$onViewStateChanged.bind(this,t)}},this)},getInitialState:function(){return{viewConfigs:this.props.config.get("applyToViews").reduce(this.$mapToViewConfigs,r.Map(),this)}},componentWillMount:function(){a(this.props.config.get("applyToViews"),"ShortcutButtons config must have an applyToViews attribute.")},$mapToViewConfigs:function(e,t){return e.set(t,this.$getViewState(t))},$onViewStateChanged:function(e){this.setState({viewConfigs:this.state.viewConfigs.set(e,this.$getViewState(e))})},$getViewState:function(e){return this.props.modelerApp.getViewConfigStore().getViewState(e)},$shouldViewConfigUpdate:function(e,t){var i=t.get("type","merge"),r=t.get("config"),n,o;if(i==="merge"){n=e.mergeWith(s.listAndEmptyMapMerger,r)}else if(i==="override"){n=e.mergeWith(s.listMapMergerOverrider,r)}else{throw new Error("Unknown shortcut button action type: "+i)}o=s.clearEmptyMapsAndLists(n);e=s.clearEmptyMapsAndLists(e);return{shouldUpdate:!o.equals(e),updatedViewConfig:n}},$handleButtonClick:function(e){var t=this.props.config.get("applyToViews"),i=this.props.modelerApp.getViewConfigActionHandler();t.forEach(function(t){var r=this.state.viewConfigs.get(t),n=this.$shouldViewConfigUpdate(r,e);if(n.shouldUpdate){i.setViewState(t,n.updatedViewConfig)}},this)},render:function(){var e=this.state.viewConfigs.find(function(e){return e.get("isLoading")});if(e)return null;return n.createElement(l,{viewConfigs:this.state.viewConfigs,buttonConfigs:this.props.config.get("buttons"),onButtonClick:this.$handleButtonClick,viewConfigChangeDetector:this.$shouldViewConfigUpdate})}});t.exports=d},{"../constant":256,"../util/eventlistenermixin":360,"../util/immutable":363,"./shortcutbuttons":490,assert:2,immutable:"immutable",react:"react"}],492:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-dom");var a=n.PropTypes;var s=e("immutable");var l=e("../constant").ButtonTypes;var u=e("./circle_button");var c=e("./modalwindow").ModalWindow;var d=e("../constant").ModalWindows.Types;var p=e("./panelbutton").PanelButton;var f=e("../util/eventlistenermixin");var h=e("../constant/viewconfig");var g=e("../util/immutable");var m=e("./list");var v=n.createClass({displayName:"Signal Creation Form",propTypes:{events:a.array.isRequired,onSignalCreate:a.func.isRequired},handleSignalCreate:function(e){e.preventDefault();this.props.onSignalCreate(o.findDOMNode(this.refs.signalName).value,r.find(this.props.events,{name:o.findDOMNode(this.refs.event).value},this));o.findDOMNode(this.refs.signalName).value=""},render:function(){var e=this.props.events.map(function(e){return n.DOM.option({key:e.name,value:e.name},e.name)});return n.DOM.div({className:"lb-signal-creation-form"},n.DOM.label(null,"Signals"),n.DOM.form({onSubmit:this.handleSignalCreate},n.DOM.input({ref:"signalName",className:"lb-filter-input",placeholder:"Signal Name",required:true}),n.DOM.select({ref:"event"},e),n.createElement(u,{onClick:this.handleSignalCreate,buttonClassName:"create-signal-cbutton",iconClassName:"fa fa-check",titleAttr:"Add Signal"})))}});var y=n.createClass({displayName:"Signal Listening Form",propTypes:{signals:a.array.isRequired,handlers:a.array.isRequired,onAddSignalListener:a.func.isRequired},getInitialState:function(){return{selectedSignalDataType:this.props.signals.length&&this.props.signals[0].dataType}},handleAddListener:function(){var e=r.find(this.props.handlers,{name:o.findDOMNode(this.refs.handler).value},this).handler;this.props.onAddSignalListener(o.findDOMNode(this.refs.signal).value,e)},handleSignalChange:function(e){var t=r.find(this.props.signals,{name:e.target.value});this.setState({selectedSignalDataType:t.dataType})},render:function(){var e=this.props.signals.map(function(e){return n.DOM.option({key:e.name,value:e.name},e.name)}),t=this.props.handlers.filter(function(e){return this.state.selectedSignalDataType?e.dataType===this.state.selectedSignalDataType:true},this).map(function(e){return n.DOM.option({key:e.name,value:e.name},e.name)});if(!e.length){e.push(n.DOM.option({key:""},"No signals available"))}if(!t.length){t.push(n.DOM.option({key:""},"No handlers available"))}return n.DOM.div({className:"lb-signal-listening-form"},n.DOM.label(null,"Listeners"),n.DOM.form(null,n.DOM.select({ref:"signal",className:"lb-custom-select",onChange:this.handleSignalChange},e),n.DOM.select({ref:"handler",className:"lb-custom-select"},t),n.createElement(u,{onClick:this.handleAddListener,buttonClassName:"create-signal-cbutton",iconClassName:"fa fa-check",titleAttr:"Add Listener"})))}});var b=n.createClass({displayName:"Signal Management Dialog",propTypes:{viewId:n.PropTypes.string.isRequired,title:n.PropTypes.string.isRequired,componentId:n.PropTypes.string.isRequired,events:n.PropTypes.array.isRequired,handlers:n.PropTypes.array.isRequired,setViewState:n.PropTypes.func.isRequired,closeWindow:n.PropTypes.func},mixins:[f],setEventListeners:function(){return[{emitterId:this.props.viewId,emitter:this.props.modelerApp.getViewConfigStore(),event:h.EVENTS.STATE_CHANGED,callback:this.onChange}]},getInitialState:function(){var e=this.props.modelerApp.getViewConfigStore(),t=s.fromJS(e.getViewState(this.props.viewId)),i=t.getIn(h.PATH.SIGNALS)||s.List(),r=t.getIn(h.PATH.SIGNAL_LISTENERS)||s.List(),n=g.uniq(e.getAllAvailableSignals(this.props.viewId),"name");r=b.filterByComponentId(r,"listenerId",this.props.componentId);r=b.mapHandlerNames(r,this.props.handlers);i=b.filterByComponentId(i,"emitterId",this.props.componentId);return{viewState:t,allSignals:n,viewSignals:i,viewListeners:r}},onChange:function(){this.setState(this.getInitialState())},showErrorNotification:function(e,t){this.props.modelerApp.getNotificationsActionHandler().error(e,t,undefined,{autoDismiss:10})},addSignal:function(e,t){var i=this.state.viewState,r=i.getIn(h.PATH.SIGNALS,s.List()).find(function(e){return e.get("eventName")===t.name&&e.get("emitterId")===this.props.componentId},this),n=s.Map({name:e,eventName:t.name,dataType:t.dataType,emitterId:this.props.componentId});if(e&&!r){i=i.updateIn(h.PATH.SIGNALS,s.List(),function(e){return e.push(n)});this.props.setViewState(i)}else{if(!e){this.showErrorNotification("Please, make sure you've specified a signal name.","Signal Creation (Signal name is required)")}if(r){this.showErrorNotification("You've already created a signal for event '"+t.name+"'. It's only allowed to create one signal per event.","Signal Creation")}}},removeSignal:function(e){var t=this.state.viewState.updateIn(h.PATH.SIGNALS,s.List(),function(t){return t.filter(function(t){return t.get("name")!==e.name})});this.props.setViewState(t)},addListener:function(e,t){var i=this.state.viewState,r=s.Map({signalName:e,handler:t,listenerId:this.props.componentId}),n=i.getIn(h.PATH.SIGNAL_LISTENERS,s.List()).find(function(e){return e.get("signalName")===r.get("signalName")&&e.get("handler")==r.get("handler")&&e.get("listenerId")===r.get("listenerId")});if(!n){i=i.updateIn(h.PATH.SIGNAL_LISTENERS,s.List(),function(e){return e.push(r)});this.props.setViewState(i)}else{this.showErrorNotification("The listener w/ the same signal name and handler exists.","Listener Creation")}},removeListener:function(e){var t=this.state.viewState.updateIn(h.PATH.SIGNAL_LISTENERS,s.List(),function(t){return t.filter(function(t){return t.get("signalName")!==e.signalName})});this.props.setViewState(t)},renderSignalCreationForm:function(){return n.createElement(v,{events:this.props.events,onSignalCreate:this.addSignal})},renderViewSignalsList:function(){return n.createElement(m,{items:this.state.viewSignals.map(function(e){return{name:e.get("name"),eventName:e.get("eventName")}}).toJS(),onRemove:this.removeSignal})},renderSignalListeningForm:function(){return n.createElement(y,{handlers:this.props.handlers,signals:this.state.allSignals.toJS(),onAddSignalListener:this.addListener})},renderListenersList:function(){return n.createElement(m,{items:this.state.viewListeners.map(function(e){return{signalName:e.get("signalName"),handlerName:e.get("handlerName")}}).toJS(),onRemove:this.removeListener})},renderTitle:function(){return n.DOM.div({className:"custom-modal-title"},n.DOM.span(null,"Signal Management for "+this.props.title),n.createElement(u,{onClick:this.openInfoDialog,buttonClassName:"c-btn-info",iconClassName:"fa fa-question"}))},openInfoDialog:function(){this.props.modelerApp.getModalWindowsActionHandler().openWindow(d.SIGNALS_INFO_DIALOG,{title:this.props.componentId,events:this.props.events,handlers:this.props.handlers})},render:function(){var e=[],t=null;t=n.DOM.div(null,this.props.events.length?this.renderSignalCreationForm():null,this.state.viewSignals.size?this.renderViewSignalsList():null,this.props.events.length?n.DOM.hr(null):null,this.renderSignalListeningForm(),this.state.viewListeners.size?this.renderListenersList():null);e.push(n.createElement(p,{key:"close-button",type:l.CANCEL,text:"Close",onClick:this.props.closeWindow}));return n.createElement(c,{visible:true,title:this.renderTitle(),body:t,footer:n.DOM.div(null,e),windowClass:"lb-signal-management-dialog"})},statics:{filterByComponentId:function(e,t,i){if(!i){return e}return e.filter(function(e){return e.get(t)===i})},mapHandlerNames:function(e,t){var i=r.keyBy(t,"handler");return e.map(function(e){return s.fromJS({signalName:e.get("signalName"),handlerName:i[e.get("handler")].name})})}}});t.exports={SignalManagementDialog:b,SignalListeningForm:y,SignalCreationForm:v}},{"../constant":256,"../constant/viewconfig":274,"../util/eventlistenermixin":360,"../util/immutable":363,"./circle_button":386,"./list":424,"./modalwindow":437,"./panelbutton":454,immutable:"immutable",lodash:70,react:"react","react-dom":"react-dom"}],493:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("react");var a=e("../util").concatStrings;var s=e("../util").convertStringToDate;var l=e("../cubiql");var u=e("../event_emitter").EventEmitter;var c=e("../constant").SignalDataTypes.getTransformationFn;var d=e("../constant").ModalWindows.Types;var p=e("../modelerstate");var f=e("../store/multiaxisdatastore").MultiAxisDataEvents;var h=e("../util/eventlistenermixin");var g=e("./signal_manager_util");var m=e("./cssloader");var v=e("../constant/viewconfig");var y="SIGNAL";var b=g.DEFAULT_DATA_RANGE;t.exports=function e(t){var i="SignalManager for "+t.displayName;return o.createClass({displayName:i,mixins:[h],getInitialState:function(){return{isReady:false}},setEventListeners:function(){var e=this.props.modelerApp.getMultiAxisDataStore();return[{emitter:e,event:f.DATA_CHANGED,callback:this.onDataChange}]},componentWillMount:function(){this.loadMeasures();this.setState({isReady:this.isInitMeasuresLoaded()});this.$viewSignalEmitter=new u;this.$handlers=[];this.attachSignalListeners(this.getListeners(this.props.config))},componentWillUnmount:function(){this.detachSignalListeners()},componentWillUpdate:function(e){this.detachSignalListeners();this.attachSignalListeners(this.getListeners(e.config))},attachSignalListeners:function(e){var t=this.props.modelerApp.getGlobalSignalEmitter();e.forEach(function(e){var i=e.toJS(),r=this.signalReceived.bind(this,i);this.$handlers.push({handler:r,signalName:i.signalName});t.on(i.signalName,r)},this)},detachSignalListeners:function(){var e=this.props.modelerApp.getGlobalSignalEmitter();this.$handlers.forEach(function(t){e.off(t.signalName,t.handler)},this);this.$handlers=[]},onDataChange:function(){if(!this.state.isReady&&this.isInitMeasuresLoaded()){this.setState({isReady:true})}},loadMeasures:function(){var e=this.props.modelerApp.getMultiAxisConfigActionHandler(),t=this.props.modelerApp.getMultiAxisDataActionHandler(),i=this.findMeasuresInSignalsToLoad(),r=p.createModelerState(this.props.modelerApp),n=g.createMeasureValueMAConfig.bind(null,r);i.forEach(function(i){var r=g.getTaskId(i),o=n(i);e.setViewTaskConfig(r,"main",{maConfig:o}).then(function(){return t.setViewTaskRange(r,"main",b)})})},findMeasuresInSignalsToLoad:function(){var e=this.props.modelerApp.getViewConfigStore().getAllAvailableSignals(),t={};e.forEach(function(e){var i=e.getIn(["init","value"],r.List());i.forEach(function(e){if(e.has("measure")){t[e.get("measure")]=true}})});return Object.keys(t)},isInitMeasuresLoaded:function(){var e=this.findMeasuresInSignalsToLoad();return!e.find(function(e){return!this.isMeasureLoaded(e)},this)},getMeasureValue:function(e){return g.getMeasureValue(this.getDataRange(e))},isMeasureLoaded:function(e){return g.isMeasureLoaded(this.getDataRange(e))},getDataRange:function(e){return this.props.modelerApp.getMultiAxisDataStore().getDataRange(g.getTaskId(e),"main",b)},getListeners:function(e){return e.getIn(v.PATH.SIGNAL_LISTENERS,r.List())},getViewState:function(){return this.props.modelerApp.getViewConfigStore().getViewState(this.props.id)},getInitialSignals:function(){var e=this,t=this.props.config.getIn(v.PATH.SIGNAL_LISTENERS,r.List()),o=this.props.modelerApp.getViewConfigStore().getAllAvailableSignals(),l={};t=t.reduce(function(e,t){e[t.get("signalName")]=t.toJS();return e},{});o.forEach(function(n){var o=t[n.get("name")];if(o&&n.get("init")){n=n.updateIn(["init","value"],r.List(),function(t){return t.reduce(function(t,o){var a;if(o.has("measure")){a=e.getMeasureValue(o.get("measure"));if(a){t=t.push(c(n.get("dataType"))(o,r.fromJS(a)))}else{console.warn(i+': the value of "'+o.get("measure")+'" is undefined. Thus, this initial value for the signal "'+n.get("name")+'" associated with the measure will be ignored.')}}else{t=t.push(o)}return t},r.List())});if(n.getIn(["init","value"],r.List()).size){var u=a(o.listenerId,o.handler),d=l[u],p=n.hasIn(["init","dateUpdated"])&&s(n.getIn(["init","dateUpdated"])),f=d&&d.dateUpdated&&s(d.dateUpdated);if(!d||!f||p>f){l[u]={listener:o,data:n.getIn(["init","value"]).toJS(),dateUpdated:n.getIn(["init","dateUpdated"])}}}}});return n.values(l)},signalReceived:function(e,t){var i=n.extend({},t,{listener:e});this.$viewSignalEmitter._emit(y,i)},saveSignalInitialValue:function(e,t){var i=this.getViewState().updateIn(v.PATH.SIGNALS,r.List(),function(i){return i.map(function(i){if(e.get("name")===i.get("name")){i=i.set("init",r.fromJS({value:t,dateUpdated:""+ +new Date}))}return i})});this.props.setViewState(i)},sendSignal:function(e,t){this.saveSignalInitialValue(e,t);this.props.modelerApp.getGlobalSignalEmitter()._emit(e.get("name"),{data:t})},publishEvent:function(e,t,i){var n=this.getViewState(),o=n.getIn(v.PATH.SIGNALS,r.List()),a;if(o.size){a=o.filter(function(t){return t.get("eventName")===e&&(i?t.get("emitterId")===i:true)});a.forEach(function(e){this.sendSignal(e,t)},this)}},openDialog:function(e){this.props.modelerApp.getModalWindowsActionHandler().openWindow(d.SIGNAL_MANAGEMENT_DIALOG,{viewId:this.props.id,title:e.componentId,componentId:e.componentId,events:e.events,handlers:e.handlers,setViewState:this.props.setViewState})},render:function(){if(!this.state.isReady){return o.createElement(m)}return o.createElement(t,n.extend({},this.props,{signals:{publishEvent:this.publishEvent,openDialog:this.openDialog,subscribe:this.$viewSignalEmitter.on.bind(this.$viewSignalEmitter,y),unsubscribe:this.$viewSignalEmitter.off.bind(this.$viewSignalEmitter,y),
getInitialSignals:this.getInitialSignals}}))}})}},{"../constant":256,"../constant/viewconfig":274,"../cubiql":276,"../event_emitter":289,"../modelerstate":313,"../store/multiaxisdatastore":348,"../util":357,"../util/eventlistenermixin":360,"./cssloader":395,"./signal_manager_util":494,immutable:"immutable",lodash:70,react:"react"}],494:[function(e,t,i){"use strict";var r=e("lodash");var n=e("../multiaxisconfig");var o=e("../pivotconfig_helper");var a=e("../util").concatStrings;var s={X:{start:0,length:1},Y:{start:0,length:1}};function l(e){return{axis:{x:[{qualifiedName:e}]}}}function u(e,t){var i=l(t),r=o.pivotConfigToMultiAxisConfig(e,"MeasureValue:"+t,i);r=n.regenerateHeaderConfig(r);r=o.updateConfig(e,r);return r}function c(e,t){var i=e.getIn(["init","value"],Immutable.List());i=i.filter(function(e){return!e.has("measure")}).map(function(t){var i,r;if(!t.has("measure")){return t}i=MetricQueryCreator.createMetricQueryForLevel(cubiql.parseDimLvl(t.get("qualifiedName")),t.get("measure"),measureModel);r=pivotDataStore.getUnmaskedQueryData(i);r=r.resultTable.dataTable.map(function(e){return e[0]});return getTransformationFn(e.get("dataType"))(t,Immutable.fromJS(r))});if(e.has("init")){e=e.setIn(["init","value"],i)}return e}function d(e){return"signal-manager-"+e}t.exports={createMeasureValuePivotConfig:l,createMeasureValueMAConfig:u,getTaskId:d,getMeasureValue:r.property("dataArray.0.0.0.queryResults.value.value.rawValue.0.0"),isMeasureLoaded:r.property("dataArray.0.0.0.queryResults.value.value"),DEFAULT_DATA_RANGE:s}},{"../multiaxisconfig":328,"../pivotconfig_helper":330,"../util":357,lodash:70}],495:[function(e,t,i){"use strict";var r=e("assert");var n=e("react");var o=e("joi");var a=e("lodash");var s=e("../constant").SignalDataTypes;t.exports=function(e){r(e.signals,e.displayName+" must have signals definition object");var t="Signallable "+e.displayName;return n.createClass({displayName:t,componentWillMount:function(){this.validateProps(this.props);this.props.signals.subscribe(this.onSignalReceived)},componentDidMount:function(){r(a.isFunction(this.refs.component.getSignalListeners),e.displayName+" must implement 'getSignalListeners' method");e.signals.handlers.forEach(function(t){r(a.isFunction(this.refs.component[t.handler]),e.displayName+" must implement '"+t.handler+"' signal handler")},this);this.initializeSignals()},initializeSignals:function(){a.forEach(this.props.signals.getInitialSignals(),this.onSignalReceived)},componentWillReceiveProps:function(e){this.validateProps(e)},componentWillUnmount:function(){this.props.signals.unsubscribe(this.onSignalReceived)},onSignalReceived:function(t){var i=t.listener.listenerId,r=t.listener.handler,n=this.findDataTypeSchemaByHandlerName(r),a=o.validate(t.data,n),s;if(a.error){throw new Error(e.displayName+" received invalid data for '"+r+"' handler. "+a.error.message)}else{if(i){s=this.refs.component.getSignalListeners();if(s.indexOf(i)!==-1){this.refs.component[t.listener.handler](t.data,t.listener.listenerId)}}else{this.refs.component[t.listener.handler](t.data)}}},findDataTypeSchemaByHandlerName:function(t){var i=a.find(e.signals.handlers,{handler:t});return s.schemas[i.dataType]},findDataTypeSchemaByEventName:function(t){var i=a.find(e.signals.events,{name:t});return s.schemas[i.dataType]},publishEvent:function(t,i,r){var n=this.findDataTypeSchemaByEventName(t),a=o.validate(i,n);if(a.error){throw new Error(e.displayName+" publishes invalid data for '"+t+"' event. "+a.error.message)}else{this.props.signals.publishEvent(t,i,r)}},openDialog:function(t){this.props.signals.openDialog({componentId:t,events:e.signals.events,handlers:e.signals.handlers})},validateProps:function(t){r(t.signals,e.displayName+" must have signals prop");r(t.signals.openDialog,e.displayName+" must have signals.openDialog prop");r(t.signals.publishEvent,e.displayName+" must have signals.publishEvent prop");r(t.signals.subscribe,e.displayName+" must have signals.subscribe prop");r(t.signals.unsubscribe,e.displayName+" must have signals.unsubscribe prop")},render:function(){var t=a.extend({ref:"component"},this.props,{signals:{openDialog:this.openDialog,publishEvent:this.publishEvent}});return n.createElement(e,t)}})}},{"../constant":256,assert:2,joi:"joi",lodash:70,react:"react"}],496:[function(e,t,i){"use strict";var r=e("react");var n=e("../constant").ButtonTypes;var o=e("./modalwindow").ModalWindow;var a=e("./panelbutton").PanelButton;var s=e("./table");t.exports=r.createClass({displayName:"Signals Info Dialog",propTypes:{title:r.PropTypes.string.isRequired,events:r.PropTypes.array.isRequired,handlers:r.PropTypes.array.isRequired},render:function(){var e=null,t=null,i=null;if(this.props.events.length){e=r.createElement(s,{headings:["Event","Description","Data Type"],table:this.props.events.map(function(e){return[e.name,e.description,e.dataType]})})}if(this.props.handlers.length){t=r.createElement(s,{headings:["Handler","Handler ID","Description","Data Type"],table:this.props.handlers.map(function(e){return[e.name,e.handler,e.description,e.dataType]})})}if(e||t){i=r.DOM.div(null,e?r.DOM.div(null,r.DOM.label(null,"Events"),e):null,e&&t?r.DOM.hr():null,t?r.DOM.div(null,r.DOM.label(null,"Handlers"),t):null)}return r.createElement(o,{visible:true,title:"Signals and Listeners Information for "+this.props.title,windowClass:"lb-signals-info-dialog",footer:r.createElement(a,{key:"close-button",type:n.CANCEL,text:"Close",onClick:this.props.closeWindow}),body:i||r.DOM.span(null,"The"+this.props.title+"component has neither events nor handlers.")})}})},{"../constant":256,"./modalwindow":437,"./panelbutton":454,"./table":504,react:"react"}],497:[function(e,t,i){"use strict";var r=e("popupmenu").PopupMenu;var n=e("popupmenu").Menu;var o=e("react");var a=e("react-dom");var s=e("react-addons-pure-render-mixin");var l=e("classnames");var u=e("lodash");var c=e("./field").FieldSortButton;var d=e("../constant");var p=d.FieldTypeClasses;var f=d.Keys;var h=o.createClass({displayName:"SliceField",mixins:[s],propTypes:{title:o.PropTypes.string.isRequired,label:o.PropTypes.string,onPrevious:o.PropTypes.func,onNext:o.PropTypes.func,filterOpened:o.PropTypes.bool.isRequired,type:o.PropTypes.number,isSorted:o.PropTypes.bool,ascending:o.PropTypes.bool,isDragging:o.PropTypes.bool,isDraggable:o.PropTypes.bool,onDragStart:o.PropTypes.func,onDragEnd:o.PropTypes.func,onDragEnter:o.PropTypes.func,onDragLeave:o.PropTypes.func,onDragOver:o.PropTypes.func,onSortClick:o.PropTypes.func,onFieldClick:o.PropTypes.func},getInitialState:function(){return{searchBuffer:[]}},focus:function(){var e=this.refs.fieldContainer;e.focus()},openFilter:function(e){if(this.props.label){this.props.onFieldClick(a.findDOMNode(this),e&&e.trim())}},componentWillReceiveProps:function(e){if(!e.filterOpened&&this.props.filterOpened){this.focus()}},onBodyClick:function(){this.openFilter()},onKeyUp:function(e){switch(e.keyCode){case f.ENTER:this.openFilter();break;case f.LEFT:if(e.target.previousSibling){e.target.previousSibling.focus()}break;case f.UP:this.props.onPrevious();break;case f.RIGHT:if(e.target.nextSibling){e.target.nextSibling.focus()}break;case f.DOWN:this.props.onNext();break}},onContextMenu:function(e){e.preventDefault();this.setState({isMenuOpen:true,openPositionX:e.clientX,openPositionY:e.clientY})},onMenuClose:function(){this.setState({isMenuOpen:false})},onKeyPress:function(e){this.state.searchBuffer.push(String.fromCharCode(e.charCode));this.setState({searchBuffer:this.state.searchBuffer});this.openFilterWithQuery()},openFilterWithQuery:u.debounce(function(){this.openFilter(this.state.searchBuffer.join(""));this.setState({searchBuffer:[]})},200),render:function(){var e=!this.props.label?"Loading...":o.DOM.span(null,this.props.label,o.DOM.span({className:"fa fa-sort-desc"})),t=this.props.isFiltered&&"fa fa-filter"||null,i={slice:true,field:true};i[p[this.props.type]]=true;return o.DOM.div({ref:"fieldContainer",className:l({"field-container":true,fade:this.props.isDragging}),onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragLeave:this.props.onDragLeave,onDragOver:this.props.onDragOver,draggable:this.props.isDraggable,tabIndex:0,onKeyPress:this.onKeyPress,onKeyUp:this.onKeyUp,onContextMenu:this.onContextMenu},o.DOM.div({ref:"sliceField",className:l(i),title:this.props.title,onClick:this.focus},o.DOM.div({className:"slice-title"},o.DOM.span({className:"field-title"},this.props.title),this.props.children&&this.state.isMenuOpen?o.createElement(r,{onClose:this.onMenuClose,openPositionX:this.state.openPositionX,openPositionY:this.state.openPositionY},o.createElement(n,{onClose:this.onMenuClose},this.props.children)):null),this.props.onSortClick?o.createElement(c,{ref:"sortBtn",onClick:this.props.onSortClick,isSorted:this.props.isSorted,ascending:this.props.ascending}):null,o.DOM.div({className:"slice-body",ref:"sliceBody",onClick:this.onBodyClick},e)))}});t.exports=h},{"../constant":256,"./field":405,classnames:6,lodash:70,popupmenu:146,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],498:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("react");var a=e("react-dom");var s=e("../multiaxisconfig");var l=e("./associativefilter");var u=e("../constant").AssociativeFiltering.SelectionTypes;var c=e("../constant").SORT;var d=e("../constant").DND;var p=e("../multiaxisconfig").FieldTypes;var f=e("./dimensiontreeprovider");var h=e("./measurebrowsercontroller");var g=e("./fieldpanel");var m=e("./popover");var v=e("./pivot/config_helper");var y=e("../helpers/fieldhelpers");var b=e("./slicefield");var w=e("popupmenu").MenuItem;var C=e("popupmenu").MenuItemsTypes;var E=e("../menu_sections/filter_sort");var S=e("../constant");var T=S.ContextMenu.MenuItemInfo;var x=S.ContextMenu.IconInfo;var _=e("./draggable");var M=e("./fielddropzone");var A=e("./sheet_view_signals").Events;var I=e("./sheet_view_signals").getSliceComponentId;var O=M(g,"SliceDropZone");var D=_(b,"DraggableSliceField");var N=e("./axisconfig/axisconfiguration");var R=300;var P=Object.freeze({EMPTY:"(empty)",LOADING:"Loading...",NOT_FOUND:"(not found)"});var L=o.createClass({displayName:"SlicePanel",propTypes:{sheetId:o.PropTypes.string.isRequired,axis:o.PropTypes.string.isRequired,modelerState:o.PropTypes.object.isRequired,pivotState:o.PropTypes.object.isRequired,updatePivotState:o.PropTypes.func.isRequired,canMoveInto:o.PropTypes.func.isRequired,adjustCurrentSlice:o.PropTypes.func.isRequired,updateSliceSelection:o.PropTypes.func.isRequired,openSortWindow:o.PropTypes.func.isRequired,createSyncMenuItems:o.PropTypes.func.isRequired,icon:o.PropTypes.string,iconCls:o.PropTypes.string,setViewTask:o.PropTypes.func.isRequired,setViewTaskInactive:o.PropTypes.func.isRequired,isLoading:o.PropTypes.func.isRequired,currentSlice:o.PropTypes.object,isActive:o.PropTypes.bool,isDraggingField:o.PropTypes.bool,dragData:o.PropTypes.object,dragOverData:o.PropTypes.object,dropData:o.PropTypes.object,dragOver:o.PropTypes.func,drop:o.PropTypes.func,startDrag:o.PropTypes.func,stopDrag:o.PropTypes.func},getInitialState:function(){return{isConfigurationPopoverOpen:false,isFilterPopoverOpen:false,isFilterPopoverPinned:false,undo:r.List(),userSelectedSlice:r.Map(),configPivotState:undefined}},getAllFields:function(){return this.props.pivotState.getIn(["axis",this.props.axis])},handleSelect:function(e,t,i){if(t.isSelected){if(i){this.setSlice()}return}var r=this.props.currentSlice,n=this.state.userSelectedSlice.size>0?this.state.userSelectedSlice:r,o=this.props.updateSliceSelection(n,e,t.id,t.label);if(i){this.setSlice(o)}else if(this.state.isFilterPopoverOpen){this.props.setViewTask(o);this.setState({undo:this.state.undo.push(n),userSelectedSlice:o})}},headingRowToSliceConfig:function(e,t){t=t||r.Map();return e.fields.reduce(function(t,i,n){var o=e.headers[n];return t.set(i.id,r.Map({id:o.id,label:o.label,field:i}))},t)},setSlice:function(e){var t=e||this.state.userSelectedSlice,i=this.props.pivotState,r=[],n={};t.forEach(function(e,t){var i=e.get("id");if(i){n[t]=i;r.push(this.publishSliceChangeEvent.bind(this,t,i))}},this);i=v.storeSliceValues(this.props.modelerState,i,n);this.props.updatePivotState(i).then(function(){r.forEach(function(e){e()})});this.closeFilterPopover()},publishSliceChangeEvent:function(e,t){this.props.signals.publishEvent(A.SLICE_CHANGE.name,[{qualifiedName:e,positions:[t]}],I(e))},handleDragStart:function(e){this.props.startDrag(d.TYPES.FIELD,{sourcePivotId:this.props.sheetId,axis:this.props.axis,field:e,isMove:true})},handleDragEnd:function(e){var t=this.props.dropData&&this.props.dropData.axis===this.props.axis,i;if(this.props.dragData&&this.props.dragData.axis===this.props.axis&&!t&&(!this.props.dropData||!this.props.dropData.axis)){i=v.removeField(this.props.modelerState,this.props.pivotState,e);this.props.updatePivotState(i)}this.props.stopDrag()},handleDrop:function(){var e;if(this.props.isActive){e=v.moveField(this.props.modelerState,this.props.pivotState,this.props.dragData.field,this.props.axis);this.props.updatePivotState(e);this.props.drop(d.TYPES.FIELD,{sourcePivotId:this.props.sheetId,axis:this.props.axis});if(this.props.dragData.axis!==this.props.axis){this.props.stopDrag()}}},handleSliceChange:function(e,t){var i=this.props.adjustCurrentSlice(e,t);if(i){this.setSlice(i)}},handleRemoveClick:function(e){var t=v.removeField(this.props.modelerState,this.props.pivotState,e);this.props.updatePivotState(t)},handleSortClick:function(e){var t=v.getFieldAttributeSort(e),i=t&&t.sortType===c.ASCENDING?c.DESCENDING:c.ASCENDING,r;if(i){r=v.setSort(this.props.pivotState,e.id,i,t.sortAttr);this.props.updatePivotState(r)}},handleFieldClick:function(e,t,i){var n=t.getBoundingClientRect();this.props.setViewTask(this.props.currentSlice);this.setState({undo:r.List(),isFilterPopoverOpen:true,filterPopoverX:n.left+n.width/2,filterPopoverY:n.top+n.height/2,fieldId:e.id,searchText:i})},handlePushpin:function(){this.setState({isFilterPopoverOpen:true,isFilterPopoverPinned:!this.state.isFilterPopoverPinned})},handleUndo:function(){if(!this.state.undo.size){return}this.setState({undo:this.state.undo.skipLast(1),userSelectedSlice:this.state.undo.takeLast(1).get(0)})},createMenu:function(e){var t=o.createElement(w,{key:T.Remove.key,label:T.Remove.label,itemType:C.MenuItem,data:e,onClick:this.handleRemoveClick,iconName:x.Remove});return[t].concat(o.createElement(E,{key:T.FilterSection.key,field:e,isSlice:true,pivotState:this.props.pivotState,sort:this.props.openSortWindow}),this.props.createSyncMenuItems(e))},getPopoverTarget:function(){return a.findDOMNode(this)},openConfiguration:function(e){var t=e.target.getBoundingClientRect();this.setState({isConfigurationPopoverOpen:true,configurationPopoverX:t.left+t.width/2,configurationPopoverY:t.top+t.height/2})},closeFilterPopover:function(e){if(this.state.isFilterPopoverPinned&&!e){return}this.props.setViewTaskInactive();this.setState({isFilterPopoverOpen:false,fieldId:undefined,userSelectedSlice:r.Map()})},closeConfigurationPopover:function(){this.setState({isConfigurationPopoverOpen:false,configPivotState:undefined})},buildMeasureGroupTree:function(){var e=this.props.pivotState,t=this.props.axis,i=this.state.userSelectedSlice.size>0?this.state.userSelectedSlice:this.props.currentSlice,n=i.reduce(function(i,r,n){var o=v.getField(e,n,t);if(o instanceof s.MeasureGroupField){return i.set("field",o).set("id",r.get("id"))}return i},r.Map()),o=n.get("field");if(o){return{qName:o.id,field:o,label:o.fieldLabel,children:o.fields.map(function(e){return{id:e.id,label:e.fieldLabel,isSelected:n.get("id")===e.id}}).toArray()}}},buildTrees:function(){var e=this.props.sliceHeadingData,t=this.state.userSelectedSlice.size>0?this.state.userSelectedSlice:this.props.currentSlice,i=this.buildMeasureGroupTree(),r=false,o;if(!this.state.isFilterPopoverOpen){return}if(e){o=e.getAxes().reduce(function(i,o){var a=e.getHeadingAxisInfo(o),s,l;if(a.getLength()===0){return i}l=a.getHeadingRow(0).fields;s=l.map(function(e){var i=a.getHeadingForField(e.id),o=i.getLength(),s,l,c=[];for(var d=0;d<o;d++){l=i.getHeadingMembers(d)[0];if(t.getIn([e.id,"id"])===l.id){s=u.EXPLICITLY_INCLUDED}else if(!n.isUndefined(l.config.AvailableLevels)){s=u.CAN_BE_INCLUDED}else{s=u.EXCLUDED}if(!l.config.invalidHeadings){c.push({id:l.id,label:l.label,isSelected:t.getIn([e.id,"id"])===l.id,type:s})}}if(l.config.loading){r=true}return{qName:e.id,label:e.fieldLabel,field:e,children:c}});return i.concat(s)},[]);if(i){o.push(i)}if(!r){return o}}else if(i){return[i]}},createField:function(e,t){var i=v.getFieldAttributeSort(e),r=t.getIn([e.id,"label"]);if(!r){r=this.props.isLoading()?P.LOADING:P.EMPTY}return o.createElement(D,{ref:"slicefield",key:e.get("id"),title:e.get("fieldLabel"),label:r,type:e.type,isSorted:!!i,ascending:i&&i.sortType===c.ASCENDING,filterOpened:this.state.fieldId===e.get("id"),onPrevious:this.handleSliceChange.bind(this,e,-1),onNext:this.handleSliceChange.bind(this,e,1),onDragStart:this.handleDragStart.bind(this,e),onDragStop:this.handleDragEnd.bind(this,e),onFieldClick:this.handleFieldClick.bind(this,e),onSortClick:!(e instanceof s.MeasureGroupField)?this.handleSortClick.bind(this,e):undefined},this.createMenu(e))},getAxisConfigPivotState:function(){return this.state.configPivotState||this.props.pivotState},$updatePivotStateWithMeasureSelections:function(e,t,i){var r=this;t.forEach(function(t){var n=y.getFieldFromQualifiedName(r.props.modelerState.fields,t.id);if(!t.selected){e=v.removeField(r.props.modelerState,e,n)}else if(i){e=v.moveField(r.props.modelerState,e,n,r.props.axis)}else{e=v.addMeasureToGroup(e,e.measureGroups.get("-:Measures"),n)}});return e},measureSelectionChanged:function(e,t){this.setState({configPivotState:this.$updatePivotStateWithMeasureSelections(this.getAxisConfigPivotState(),e,t)})},$updatePivotStateWithDimensionSelections:function(e,t){var i=this;t.forEach(function(t){var r=y.getFieldFromQualifiedName(i.props.modelerState.fields,t.id),n=i.props.modelerApp.getMeasureModelStore().getModel(),o;if(!t.selected){e=v.removeField(i.props.modelerState,e,r)}else if(i.props.canMoveInto(e,i.props.axis,r,false)){if(t.id!=="-:Measures"){o=n.getLowestLevelsInDimension(r.level.get("dimensionName"));if(o.indexOf(t.id)===-1){if(t.inline){r=s.disableOutlineForField(r)}if(t.rollup){r=s.setRollupForField(r,"DEFAULT")}}}e=v.moveField(i.props.modelerState,e,r,i.props.axis)}});return e},dimensionSelectionChanged:function(e){this.setState({configPivotState:this.$updatePivotStateWithDimensionSelections(this.getAxisConfigPivotState(),e)})},applyAxisConfigChanges:function(e){var t=this.getAxisConfigPivotState();if(e){if(e.levelIds){t=this.$updatePivotStateWithDimensionSelections(t,e.levelIds,true,true)}if(e.measureIds){t=this.$updatePivotStateWithMeasureSelections(t,e.measureIds,false)}if(e.attributeIds){t=this.$updatePivotStateWithMeasureSelections(t,e.attributeIds,true)}}this.props.updatePivotState(t);this.props.stopDrag();this.closeConfigurationPopover()},cancelAxisConfigChanges:function(){this.closeConfigurationPopover()},canAddFieldToPanel:function(e){var t=y.getFieldFromQualifiedName(this.props.modelerState.fields,e),i=this.getAxisConfigPivotState();return this.props.canMoveInto(i,this.props.axis,t,false)},canAddMeasureToPanel:function(e){var t=this.getAxisConfigPivotState();return this.hasMeasuresFieldOnAxis()&&!v.hasVisibleMeasure(t,e)},hasMeasuresFieldOnAxis:function(){return!!v.getField(this.props.pivotState,"-:Measures",this.props.axis)},getMeasureTree:function(){var e=this.getAxisConfigPivotState(),t=this.props.modelerApp.getFieldStore().getFields(p.MEASURE),i=e.measureGroups.get("-:Measures"),r={},n={},o;if(i){i.fields.forEach(function(e){r[e.id]=true})}v.getAxisFields(e,function(e){return e instanceof s.MeasureField&&!r[e.get("id")]}).forEach(function(e){n[e.id]=true});o=h.getMeasures(t).map(function(e){return{id:e.id,label:e.label,isMeasure:true,isAttribute:n[e.id],isSelected:r[e.id]||n[e.id]}});return{children:o}},$getUpdateTreeNodeCallback:function(){var e=this,t=this.getAxisConfigPivotState().getIn(["axis",this.props.axis]);return function(i,r){var n=v.indexInFields(t,r)>-1,o=!n&&!e.canAddFieldToPanel(i.get("id"));return i.set("isSelected",n).set("isDisabled",o)}},createConfigurationPopover:function(){var e=f.createDimensionTreeData(this.props.modelerState,this.$getUpdateTreeNodeCallback()),t=this.getMeasureTree(),i=190,r=10,n=this.hasMeasuresFieldOnAxis();return o.createElement(m,{openPoint:{x:this.state.configurationPopoverX,y:this.state.configurationPopoverY},getTarget:this.getPopoverTarget,onClose:this.closeConfigurationPopover,height:.5*window.innerHeight,width:function(e,t){if(e==="top"||e==="bottom"){return Math.min((n?2:1)*i+r,t.width)}else{return Math.min((n?2:1)*i+r,.8*window.innerWidth)}}},o.createElement(N,{dimensionTree:e,measureTree:t,onCancel:this.cancelAxisConfigChanges,onApply:this.applyAxisConfigChanges,measureSelectionChanged:this.measureSelectionChanged,dimensionSelectionChanged:this.dimensionSelectionChanged,canAddField:this.canAddFieldToPanel,canAddMeasure:this.canAddMeasureToPanel,pivotState:this.props.pivotState,isSlice:true,hasMeasures:n}))},getCurrentSlice:function(){return this.state.slice},render:function(){var e=this.state.userSelectedSlice.size>0?this.state.userSelectedSlice:this.props.currentSlice,t=this.props.pivotState.getIn(["axis",this.props.axis]).reduce(function(e,t){if(t instanceof s.MeasureGroupField||t instanceof s.LevelField){return e.push(t)}if(t instanceof s.DimensionField){return e.concat(t.fields)}return e},r.List()).map(function(t){return this.createField(t,e)},this),i=null,a=null,u=190,c=10,d,p=this.buildTrees();if(this.state.isFilterPopoverOpen){d=p&&p.length||t.size;i=o.createElement(m,{openPoint:{x:this.state.filterPopoverX,y:this.state.filterPopoverY},getTarget:this.getPopoverTarget,onClose:this.closeFilterPopover,height:function(e,t){if(e==="left"||e==="right"){return Math.min(t.height,.4*window.innerHeight)}else{if(window.innerHeight<R){return.9*window.innerHeight}return Math.max(R,.4*window.innerHeight)}},width:function(e,t){if(e==="top"||e==="bottom"){return Math.min(d*u+c,t.width)}else{return Math.min(d*u+c,.8*window.innerWidth)}}},o.createElement(l,{onCancel:!this.state.isFilterPopoverPinned?this.closeFilterPopover:n.noop,levels:p,onSelect:this.handleSelect,onApply:this.setSlice,onDiscard:this.closeFilterPopover.bind(this,true),onPushpin:this.handlePushpin,onUndo:this.handleUndo,isSlice:true,focusField:this.state.fieldId,searchText:this.state.searchText,isPinned:this.state.isFilterPopoverPinned}))}if(this.state.isConfigurationPopoverOpen){a=this.createConfigurationPopover()}return o.createElement(O,{ref:"fieldpanel",panelClass:"slices-panel",axis:this.props.axis,pivotId:this.props.sheetId,title:"Slices",icon:this.props.icon,iconCls:this.props.iconCls,onDrop:this.handleDrop,onPanelTitleClick:this.openConfiguration,isDroppable:this.props.isActive,isDraggingField:this.props.isDraggingField},this.props.children,t,i,a)}});t.exports=L},{"../constant":256,"../helpers/fieldhelpers":296,"../menu_sections/filter_sort":307,"../multiaxisconfig":328,"./associativefilter":371,"./axisconfig/axisconfiguration":374,"./dimensiontreeprovider":398,"./draggable":400,"./fielddropzone":406,"./fieldpanel":409,"./measurebrowsercontroller":430,"./pivot/config_helper":455,"./popover":480,"./sheet_view_signals":486,"./slicefield":497,immutable:"immutable",lodash:70,popupmenu:146,react:"react","react-dom":"react-dom"}],499:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("react");var a=e("../multiaxisconfig");var s=e("../util/eventlistenermixin");var l=e("../store/multiaxisdatastore").MultiAxisDataEvents;var u=e("../constant").DND;var c=e("./slicepanel");var d=e("./pages_sync");var p=e("./draganddropwrapper");var f=e("../constant").ModalWindows.Types;var h=e("./axisfilters");c=d(c);var g=o.createClass({displayName:"SlicePanelController",propTypes:{modelerApp:o.PropTypes.object.isRequired,sheetId:o.PropTypes.string.isRequired,modelerState:o.PropTypes.object.isRequired,pivotState:o.PropTypes.object.isRequired,headingData:o.PropTypes.object.isRequired,updatePivotState:o.PropTypes.func.isRequired,canMoveInto:o.PropTypes.func.isRequired,dragData:o.PropTypes.object,dragType:o.PropTypes.string,dragOverData:o.PropTypes.object,dropData:o.PropTypes.object},mixins:[s],getDefaultProps:function(){return{axis:"Z"}},getInitialState:function(){return{currentSlice:this.getSlice(this.props.headingData),sliceHeadingData:undefined}},setEventListeners:function(){var e=this.props.modelerApp.getMultiAxisDataStore();return[{emitter:e,event:l.DATA_CHANGED,callback:this.onDataChange}]},componentWillReceiveProps:function(e){if(e.headingData!==this.props.headingData){this.setState({currentSlice:this.getSlice(e.headingData)})}},isLoading:function(){var e=this.props.headingData,t=e.getHeadingAxisInfo(this.props.axis),i=t.getHeadingMembers(0);return e.isLoadingSlice()||i.length>0&&!!i[0].config.loading},onDataChange:function(){var e=this.props.modelerApp.getMultiAxisDataStore().getHeadingData(this.props.sheetId,"sliceSelection");if(e){this.setState({sliceHeadingData:e})}},isDraggingField:function(){return this.props.dragType===u.TYPES.FIELD},isActive:function(){var e=this.props.dragData;if(this.isDraggingField()){return this.props.canMoveInto(this.props.pivotState,this.props.axis,e.field,e.isMove)}},setViewTask:function(e){var t=this.props.modelerApp.getMultiAxisConfigStore().getViewTaskConfig(this.props.sheetId,"main").maConfig,i=h.createMAConfig(this.props.modelerState,t,this.props.axis,e);i=i.set("id",this.props.sheetId+":"+"sliceSelection");if(i.axis.size>0){this.props.modelerApp.getModelerActionHandler().setViewTaskConfig(this.props.sheetId,"sliceSelection",{maConfig:i})}},setViewTaskInactive:function(){this.props.modelerApp.getMultiAxisConfigActionHandler().setViewTaskInactive(this.props.sheetId,"sliceSelection")},getSlice:function(e){var t=this.props.pivotState.getIn(["axis",this.props.axis]).reduce(function(e,t){if(t instanceof a.MeasureGroupField||t instanceof a.LevelField)return e.push(t);if(t instanceof a.DimensionField)return e.concat(t.fields);return e},r.List());return h.getSlice(e,this.props.axis,t)},adjustSlice:function(e,t){var i=this.props.headingData,r=i.getSelectedSliceFieldPos([e]),n=i.getHeadingAxisInfo("Z"),o=n.getHeadingForField(e.id),a=o.findMatchingRowNums(r),s=a[0]+t,l=o.getHeadingRow(s),u,c,d,p,f;if(l.headers.length>0){u=l.headers[0];d={};d[e.id]={id:u.id};p=n.findMatchingRowNums(d);f=n.getHeadingRow(p[0]);c=h.headingRowToSliceConfig(f,this.state.currentSlice);return c}},updateSliceSelection:function(e,t,i,n){var o=e,s=this.state.sliceHeadingData,l;if(t instanceof a.LevelField){l=h.getHeadingRow(s,t.level.dimensionName,t,i);o=h.headingRowToSliceConfig(l,o)}else if(t instanceof a.MeasureGroupField){o=o.set(t.id,r.Map({id:i,label:n,field:t}))}return o},openSortWindow:function(e){this.props.modelerApp.getModalWindowsActionHandler().openWindow(f.SORT_DIALOG,{sheetId:this.props.sheetId,qualifiedName:e,axisName:this.props.axis,updatePivotState:this.props.updatePivotState})},render:function(){var e=n.defaults({openSortWindow:this.openSortWindow,isDraggingField:this.isDraggingField(),isActive:this.isActive(),adjustCurrentSlice:this.adjustSlice,updateSliceSelection:this.updateSliceSelection,setViewTask:this.setViewTask,setViewTaskInactive:this.setViewTaskInactive,isLoading:this.isLoading},this.state,this.props);return o.createElement(c,e)}});t.exports=p(g)},{"../constant":256,"../multiaxisconfig":328,"../store/multiaxisdatastore":348,"../util/eventlistenermixin":360,"./axisfilters":379,"./draganddropwrapper":399,"./pages_sync":450,"./slicepanel":498,immutable:"immutable",lodash:70,react:"react"}],500:[function(e,t,i){"use strict";var r=e("react");var n=e("classnames");var o=e("lodash");var a=e("./formatinput").FormatInput;var s=e("react-slider");function l(e){if(o.isEmpty(e)||isNaN(e))return;return parseFloat(e)}function u(e,t,i){return Math.abs(e-t)<i}var c=r.createClass({displayName:"Slider",propTypes:{type:r.PropTypes.oneOf(["range","max","min"]).isRequired,min:r.PropTypes.number.isRequired,max:r.PropTypes.number.isRequired,sliderMax:r.PropTypes.number.isRequired,sliderMin:r.PropTypes.number.isRequired,step:r.PropTypes.number,onChange:r.PropTypes.func.isRequired},getDefaultProps:function(){return{step:1}},render:function(){var e=n({"filter-slider":true}),t,i;switch(this.props.type){case"min":i=this.props.sliderMin;t=[r.DOM.div({className:"min",key:"min-handle"})];break;case"max":i=this.props.sliderMax;t=[r.DOM.div({className:"max",key:"max-handle"})];break;case"range":i=[this.props.sliderMin,this.props.sliderMax];t=[r.DOM.div({className:"min",key:"min-handle"}),r.DOM.div({className:"min",key:"max-handle"})];break}return r.DOM.div({className:e},r.createElement(s,{className:"horizontal-slider",min:this.props.min,max:this.props.max,step:this.props.step,withBars:true,value:i,onChange:this.handleChange}))},handleChange:function(e){var t,i,r=this.props.step;switch(this.props.type){case"min":t=parseFloat(e);this.props.onChange({min:u(t,this.props.min,r)?this.props.min:t});break;case"max":i=parseFloat(e);this.props.onChange({max:u(i,this.props.max,r)?this.props.max:i});break;case"range":t=parseFloat(e[0]);i=parseFloat(e[1]);this.props.onChange({min:u(t,this.props.min,r)?this.props.min:t,max:u(i,this.props.max,r)?this.props.max:i});break}},hasValidMax:function(){return this.props.sliderMin<=this.props.max&&this.props.sliderMax>this.props.min&&this.props.sliderMin<=this.props.sliderMax},hasValidMin:function(){return this.props.sliderMin>=this.props.min&&this.props.sliderMin<this.props.max&&this.props.sliderMin<=this.props.sliderMax}});var d=r.createClass({displayName:"InputSlider",propTypes:{formatFn:r.PropTypes.func,isDisabled:r.PropTypes.bool.isRequired,min:r.PropTypes.number,max:r.PropTypes.number,selectedMax:r.PropTypes.number,selectedMin:r.PropTypes.number,onValidityChange:r.PropTypes.func,onValidMaxChange:r.PropTypes.func,onValidMinChange:r.PropTypes.func,step:r.PropTypes.number,type:r.PropTypes.oneOf(["range","max","min"]).isRequired},getDefaultProps:function(){return{step:.01}},getInitialState:function(){return{isValid:this.isValidMinMax(this.props.selectedMin,this.props.selectedMax)}},getMinValue:function(){if(this.props.isDisabled)return"N/A";return!o.isUndefined(this.state.minInput)?this.state.minInput:this.props.selectedMin.toString()},getMaxValue:function(){if(this.props.isDisabled)return"N/A";return!o.isUndefined(this.state.maxInput)?this.state.maxInput:this.props.selectedMax.toString()},render:function(){var e={"input-slider":true},t=this.props.isDisabled,i=this.getMinValue(),o=this.getMaxValue(),s=n("input-group","input-group-sm",{"has-warning":this.minWarningFn(i)}),l=n("input-group","input-group-sm",{"has-warning":this.maxWarningFn(o)});return r.DOM.div({className:n(e)},r.DOM.div({className:s},r.DOM.span({className:"input-group-addon"},"Min"),r.createElement(a,{ref:"minInput",className:"form-control",disabled:t||this.props.type==="max",formatFn:this.props.formatFn,value:i,onChange:this.handleMinChange,onBlur:this.handleMinBlur,onFocus:this.handleMinMaxFocus})),r.DOM.div({className:l},r.DOM.span({className:"input-group-addon"},"Max"),r.createElement(a,{ref:"maxInput",className:"form-control",disabled:t||this.props.type==="min",formatFn:this.props.formatFn,value:o,warningFn:this.maxWarningFn,onChange:this.handleMaxChange,onBlur:this.handleMaxBlur,onFocus:this.handleMinMaxFocus})),!t?r.createElement(c,{ref:"slider",type:this.props.type,max:this.props.max,min:this.props.min,sliderMin:this.props.selectedMin,sliderMax:this.props.selectedMax,step:this.props.step,onChange:this.onSlide}):null,r.DOM.span({className:"min label label-default"},this.format(this.props.min)),r.DOM.span({className:"max label label-default"},this.format(this.props.max)),r.DOM.div({className:"input-slider-bottom"
}))},format:function(e){if(!o.isUndefined(this.props.formatFn))return this.props.formatFn(e);return e},isValidMinMax:function(e,t){return!this.isOutsideRange(e)&&!this.isOutsideRange(t)&&t>=e},maxWarningFn:function(e){var t=parseFloat(e),i=parseFloat(this.props.selectedMin);return isNaN(t)||!this.isValidMinMax(i,t)},minWarningFn:function(e){var t=parseFloat(e),i=parseFloat(this.props.selectedMax);return isNaN(t)||!this.isValidMinMax(t,i)},isOutsideRange:function(e){return e>this.props.max||e<this.props.min},handleMaxChange:function(e){var t=e.target.value,i=l(t);this.setState({maxInput:t});if(o.isNumber(i)&&this.isValidMinMax(this.props.selectedMin,i)){if(this.props.onValidMaxChange)this.props.onValidMaxChange(i);this.setValidity(true)}else{this.setValidity(false)}},handleMaxBlur:function(){this.setState({maxInput:undefined});this.setValidity(this.isValidMinMax(this.props.selectedMin,this.props.selectedMax))},handleMinChange:function(e){var t=e.target.value,i=l(t);this.setState({minInput:t});if(o.isNumber(i)&&this.isValidMinMax(i,this.props.selectedMax)){if(this.props.onValidMinChange)this.props.onValidMinChange(i);this.setValidity(true)}else{this.setValidity(false)}},handleMinBlur:function(){this.setState({minInput:undefined});this.setValidity(this.isValidMinMax(this.props.selectedMin,this.props.selectedMax))},onSlide:function(e){if(o.isNumber(e.min)&&(!o.isUndefined(this.props.sliderMin)||e.min!==this.props.sliderMin))this.setSelectedMin(e.min);if(o.isNumber(e.max)&&(!o.isUndefined(this.props.sliderMax)||e.max!==this.props.sliderMax))this.setSelectedMax(e.max)},setSelectedMax:function(e){if(!this.isOutsideRange(e)){if(this.props.onValidMaxChange)this.props.onValidMaxChange(e);this.setValidity(true)}},setSelectedMin:function(e){if(!this.isOutsideRange(e)){if(this.props.onValidMinChange)this.props.onValidMinChange(e);this.setValidity(true)}},setValidity:function(e){this.setState({isValid:e});if(this.state.isValid!==e&&!o.isUndefined(this.props.onValidityChange)){this.props.onValidityChange({isValid:e})}},handleMinMaxFocus:function(e){var t=e.target;setTimeout(function(){t.select()},0)}});i.Slider=c;i.InputSlider=d},{"./formatinput":414,classnames:6,lodash:70,react:"react","react-slider":"react-slider"}],501:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=e("classnames");var a=e("./modalwindow").ModalWindow;var s=e("./okcancelbuttons");var l=e("../util/eventlistenermixin");var u=e("../constant").SORT;var c="label";var d=e("../constant").ViewConfig.EVENTS;var p=e("../modelerstate");var f=e("./pivot/config_helper");var h=r.createClass({displayName:"SortWindow",propTypes:{onApply:r.PropTypes.func.isRequired,onClose:r.PropTypes.func.isRequired,sortBy:r.PropTypes.string,sortOrder:r.PropTypes.string,isSorted:r.PropTypes.bool,title:r.PropTypes.string,visible:r.PropTypes.bool,width:r.PropTypes.string},getDefaultProps:function(){return{visible:true,width:"300px"}},handleApply:function(e){var t=this.refs.sortOptions;e.stopPropagation();this.props.onApply({sortBy:t.state.sortBy,sortOrder:t.state.sortOrder})},handleClose:function(e){e.stopPropagation();this.props.onClose()},render:function(){return r.createElement(a,{onHide:this.handleClose,title:"Sort: "+this.props.title,visible:this.props.visible,width:this.props.width,body:r.createElement(g,{ref:"sortOptions",sortBy:this.props.sortBy,sortOrder:this.props.sortOrder,isSorted:this.props.isSorted}),footer:r.createElement(s,{ref:"buttonGroup",onOk:this.handleApply,onCancel:this.handleClose})})}});var g=r.createClass({displayName:"SortOptions",propTypes:{sortBy:r.PropTypes.string,sortOrder:r.PropTypes.string,isSorted:r.PropTypes.bool},componentWillReceiveProps:function(e){if(e.sortOrder||e.sortBy){this.setState(e)}},getInitialState:function(){return{sortBy:this.props.sortBy,sortOrder:this.props.sortOrder,isSorted:this.props.isSorted}},handleChange:function(e){var t={};t.isSorted=true;t[e.target.name]=e.target.value;this.setState(t)},isAscending:function(){return this.state.isSorted&&this.state.sortOrder===u.ASCENDING},isDescending:function(){return this.state.isSorted&&this.state.sortOrder===u.DESCENDING},isByLabel:function(){return this.state.sortBy===c},render:function(){var e=this.isByLabel();return r.DOM.form({className:"form-horizontal"},r.DOM.div({className:"radio"},r.DOM.label(null,r.DOM.input({type:"radio",ref:"ascending",name:"sortOrder",onChange:this.handleChange,value:u.ASCENDING,checked:this.isAscending()}),"Ascending ",r.DOM.i({className:"fa fa-sort-amount-asc"}))),r.DOM.div({className:"radio"},r.DOM.label(null,r.DOM.input({type:"radio",ref:"descending",name:"sortOrder",onChange:this.handleChange,value:u.DESCENDING,checked:this.isDescending()}),"Descending ",r.DOM.i({className:"fa fa-sort-amount-desc"}))),r.DOM.hr(null),e?null:r.DOM.div({className:"radio"},r.DOM.label(null,r.DOM.input({type:"radio",name:"sortBy",ref:"sortByOrder",onChange:this.handleChange,value:this.state.sortBy,checked:true}),"By "+this.state.sortBy+" (default)")),r.DOM.div({className:o({radio:true,disabled:!e})},r.DOM.label(null,r.DOM.input({type:"radio",name:"sortBy",ref:"sortByLabel",onChange:this.handleChange,value:c,checked:e,disabled:!e}),"By label (lexicographical)")))}});var m=r.createClass({displayName:"SortController",propTypes:{modelerApp:r.PropTypes.object.isRequired,axisName:r.PropTypes.string.isRequired,sheetId:r.PropTypes.string.isRequired,qualifiedName:r.PropTypes.string.isRequired,updatePivotState:r.PropTypes.func.isRequired,closeWindow:r.PropTypes.func.isRequired},mixins:[l],setEventListeners:function(){return[{emitter:this.props.modelerApp.getViewConfigStore(),emitterId:this.props.sheetId,event:d.STATE_CHANGED,callback:this.updateSortConfig}]},getInitialState:function(){return{sortConfig:this.getSortConfig()}},getModelerState:function(){return p.createModelerState(this.props.modelerApp)},getSheetConfig:function(){return this.props.modelerApp.getViewConfigStore().getViewState(this.props.sheetId)},getSortConfig:function(){var e=this.getSheetConfig(),t=f.pivotStateFromPivotConfig(this.getModelerState(),this.props.sheetId,e.get("pivotConfig"),e.get("gridOptions")),i=f.getField(t,this.props.qualifiedName),r=f.getFieldAttributeSort(i);var n={sortOrder:r.sortType||u.DESCENDING,sortBy:r.sortAttr,isSorted:true};return n},updateSortConfig:function(){var e=this.getSortConfig();if(!n.eq(e,this.state.sortConfig)){this.setState({sortConfig:e})}},onApply:function(e){var t=this.getSheetConfig(),i=f.pivotStateFromPivotConfig(this.getModelerState(),this.props.sheetId,t.get("pivotConfig"),t.get("gridOptions")),r=f.setSort(i,this.props.qualifiedName,e.sortOrder,e.sortBy,this.props.axisName);this.props.updatePivotState(r);this.handleClose()},handleClose:function(){this.props.closeWindow()},render:function(){return r.createElement(h,n.merge({ref:"sortWindow",title:this.props.qualifiedName,onApply:this.onApply,onClose:this.handleClose},this.state.sortConfig))}});i.SortOptions=g;i.SortWindow=h;i.SortController=m},{"../constant":256,"../modelerstate":313,"../util/eventlistenermixin":360,"./modalwindow":437,"./okcancelbuttons":448,"./pivot/config_helper":455,classnames:6,lodash:70,react:"react"}],502:[function(e,t,i){"use strict";var r=e("react");var n=e("lodash");var o=r.createClass({displayName:"Spinner",propTypes:{visible:r.PropTypes.bool},getDefaultProps:function(){return{visible:true}},render:function(){var e={display:this.props.visible?"block":"none"};return r.DOM.div({className:"loader",style:e},r.DOM.div())}});var a=r.createClass({displayName:"FontAwesomeSpinner",propTypes:{visible:r.PropTypes.bool},getDefaultProps:function(){return{visible:true}},render:function(){var e={display:this.props.visible?"block":"none"};return r.DOM.div({className:"fa-loader",style:e},r.DOM.i({className:"fa fa-spinner fa-spin"}))}});var s=r.createClass({displayName:"CircleSpinner",propTypes:{visible:r.PropTypes.bool},getDefaultProps:function(){return{visible:true}},componentWillMount:function(){this.uniqueId=n.uniqueId("circle-spinner")},render:function(){var e="circle-spinner"+(this.props.visible?" show":""),t=this.props.visible?[r.DOM.div({className:"circle",key:this.uniqueId+"-circle1"}),r.DOM.div({className:"circle",key:this.uniqueId+"-circle2"}),r.DOM.div({className:"circle",key:this.uniqueId+"-circle3"}),r.DOM.div({className:"circle",key:this.uniqueId+"-circle4"})]:null;return r.DOM.div({className:e},r.DOM.div({className:"spinner-container"},t))}});i.Spinner=o;i.FontAwesomeSpinner=a;i.CircleSpinner=s},{lodash:70,react:"react"}],503:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.DOM;var a=e("../../logicblox.pivot/util");var s=e("classnames");var l=e("react-addons-pure-render-mixin");var u=e("./colorpicker");var c=n.createClass({displayName:"StyleEditingPanel",propTypes:{"font-weight":n.PropTypes.string,"font-style":n.PropTypes.string,color:n.PropTypes.string,"background-color":n.PropTypes.string,"text-decoration":n.PropTypes.string,onStyleChange:n.PropTypes.func,onStyleReset:n.PropTypes.func},mixins:[l],switchFontStyle:function(e,t){if(this.props[e]){this.props.onStyleReset(e)}else{this.props.onStyleChange(e,t)}},setColorValue:function(e,t){this.props.onStyleChange(e,t)},resetColorValue:function(e){this.props.onStyleReset(e)},render:function(){return o.div({className:"form-group style-panel-container"},o.div({className:"style-panel col-xs-10"},o.div({title:"Bold",className:s("fa","fa-bold","style-button",{active:this.props["font-weight"]}),onClick:this.switchFontStyle.bind(this,"font-weight","bold")}),o.div({title:"Italic",className:s("fa","fa-italic","style-button",{active:this.props["font-style"]}),onClick:this.switchFontStyle.bind(this,"font-style","italic")}),o.div({title:"Strikethrough",className:s("fa","fa-strikethrough","style-button",{active:this.props["text-decoration"]}),onClick:this.switchFontStyle.bind(this,"text-decoration","line-through")}),o.div({title:"Font color",className:s("style-button","style-popup"),style:{color:this.props["color"]}},n.createElement(u,{key:"color",color:this.props.color,onColorChange:this.setColorValue.bind(this,"color"),onColorReset:this.resetColorValue.bind(this,"color"),pickerIcon:"fa fa-font"})),o.div({className:"vertical-separator"}),o.div({title:"Background color",className:s("style-button","style-popup")},n.createElement(u,{key:"background-color",color:this.props["background-color"],onColorChange:this.setColorValue.bind(this,"background-color"),onColorReset:this.resetColorValue.bind(this,"background-color"),pickerIcon:"paint-bucket"}),o.div({className:"paint-bucket-border",style:{borderColor:this.props["background-color"]||"#fff"}}))))}});t.exports=c},{"../../logicblox.pivot/util":357,"./colorpicker":387,classnames:6,lodash:70,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],504:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=n.PropTypes;var a=n.createClass({displayName:"Table",propTypes:{headings:o.array.isRequired,table:o.array.isRequired,className:o.string},getDefaultProps:function(){return{className:"table-striped table-bordered table-hover"}},render:function(){var e="table "+this.props.className,t,i;t=n.DOM.thead({key:r.uniqueId(a.displayName+"head")},n.DOM.tr(null,r.map(this.props.headings,function(e){return n.DOM.td({key:r.uniqueId(a.displayName)},r.isObject(e)?e.label:e)})));i=n.DOM.tbody({key:r.uniqueId(a.displayName+"body")},r.map(this.props.table,function(e){return n.DOM.tr({key:r.uniqueId(a.displayName)},r.map(e,function(e){return n.DOM.td({key:r.uniqueId(a.displayName)},r.isObject(e)?n.isValidElement(e)?e:e.value:e)}))}));return n.DOM.table({className:e},[t,i])}});t.exports=a},{lodash:70,react:"react"}],505:[function(e,t,i){"use strict";var r=e("react");var n=e("classnames");var o=r.createClass({displayName:"ToggleOption",propTypes:{isActive:r.PropTypes.bool.isRequired,toggleActive:r.PropTypes.func.isRequired},getClassName:function(){if(this.props.isActive){return"text-primary"}else{return"text-default"}},render:function(){var e=this,t={"toggle-option":true};t[this.getClassName()]=true;return r.DOM.span({className:n(t),onClick:function(){e.props.toggleActive()},style:{cursor:"pointer"}},this.props.children)}});t.exports=o},{classnames:6,react:"react"}],506:[function(e,t,i){"use strict";var r=e("react");var n=e("./modalwindow").ModalWindow;var o=e("./okcancelbuttons");var a=r.createClass({displayName:"UnauthorizedWindow",propTypes:{onApply:r.PropTypes.func.isRequired,onClose:r.PropTypes.func.isRequired,title:r.PropTypes.string,visible:r.PropTypes.bool,width:r.PropTypes.string,objectId:r.PropTypes.string.isRequired},getDefaultProps:function(){return{visible:true,width:"300px"}},getInitialState:function(){return{visible:this.props.visible||false}},handleApply:function(e){e.stopPropagation();this.props.onApply({Id:this.props.objectId});this.setState({visible:false})},handleClose:function(e){e.stopPropagation();this.setState({visible:false});this.props.onClose()},render:function(){return r.createElement(n,{onHide:this.handleClose,title:this.props.title,visible:this.state.visible,width:this.props.width,body:r.DOM.div({className:"form-group"},"You do not have permission to view this content."),footer:r.createElement(o,{okText:"Request Access",cancelText:"Cancel",onOk:this.handleApply,onCancel:this.handleClose})})}});i.UnauthorizedWindow=a},{"./modalwindow":437,"./okcancelbuttons":448,react:"react"}],507:[function(e,t,i){"use strict";var r=e("react");var n=r.createClass({displayName:"UserElement",propTypes:{name:r.PropTypes.string.isRequired},render:function(){return r.DOM.li({key:this.props.name,className:"user-element",title:this.props.name,ref:this.props.name},r.DOM.i({className:"fa fa-user"}),r.DOM.span({className:"user-name"},this.props.name))}});t.exports=n},{react:"react"}],508:[function(e,t,i){"use strict";var r=e("react");var n=e("./userelement");var o=e("classnames");var a=r.createClass({displayName:"UserList",getInitialState:function(){return{isOpen:false}},handleClick:function(){this.setState({isOpen:!this.state.isOpen})},handleBlur:function(e){if(e.relatedTarget&&e.relatedTarget.className==="user-list-container dropdown")return;this.setState({isOpen:false})},render:function(){var e=o("user-list-container dropdown",{open:this.state.isOpen});return r.DOM.div({className:e,tabIndex:-1,onBlur:this.handleBlur,ref:"usersListContainer"},r.DOM.button({className:"btn btn-default dropdown-toggle",type:"button","data-toggle":"dropdown",onClick:this.handleClick,ref:"userListToggle"},r.DOM.span(null,r.DOM.span(null,r.DOM.i({className:"fa fa-user"})),r.DOM.span({className:"user-number"},"("+this.props.users.length+")")),r.DOM.span({className:"caret"})),r.DOM.ul({className:"user-list dropdown-menu",role:"menu",ref:"usersListContent"},this.renderUserElements()))},renderUserElements:function(){if(!(this.props.users&&this.props.users.length))return r.DOM.li({className:"no-users",ref:"noUsers"},"No users connected");return this.props.users.map(function(e){return r.createElement(n,{key:e,name:e})})}});t.exports=a},{"./userelement":507,classnames:6,react:"react"}],509:[function(e,t,i){"use strict";var r=e("react");var n=e("./toggleoption");var o=e("../constant");var a=o.Collaboration.EVENTS;var s=o.User.EVENTS;var l=e("../util/eventlistenermixin");var u=e("./userlist");var c=r.createClass({displayName:"UserListController",getInitialState:function(){var e=this.props.modelerApp;return{isActive:e.getUserStore().isAuthenticated(),users:e.getCollaborationStore().getUsers()}},mixins:[l],componentDidUpdate:function(e){if(e.modelerApp!==this.props.modelerApp){this.attachEventListeners();this.setState({users:this.props.modelerApp.getCollaborationStore().getUsers(),isActive:true})}},setEventListeners:function(){var e=this.props.modelerApp;return[{emitter:e.getCollaborationStore(),event:a.USER_LIST_UPDATED,callback:this.onUserListUpdate},{emitter:e.getCollaborationStore(),event:a.USER_CONNECTED,callback:this.onUserListUpdate},{emitter:e.getCollaborationStore(),event:a.USER_DISCONNECTED,callback:this.onUserListUpdate},{emitter:e.getCollaborationStore(),event:a.CONNECT,callback:this.onCurrentUserConnected},{emitter:e.getCollaborationStore(),event:a.DISCONNECT,callback:this.onCurrentUserDisconnected},{emitter:e.getUserStore(),event:s.CHANGED,callback:this.onUserAuthenticationChanged}]},render:function(){if(this.state.isActive)return r.createElement(u,{modelerApp:this.props.modelerApp,users:this.state.users});else return r.DOM.div(null)},onUserAuthenticationChanged:function(){this.setState({isActive:this.props.modelerApp.getUserStore().isAuthenticated()})},onCurrentUserDisconnected:function(){this.setState({isActive:false})},onCurrentUserConnected:function(){this.setState({isActive:true})},onUserListUpdate:function(){this.setState({users:this.props.modelerApp.getCollaborationStore().getUsers()})}});t.exports=c},{"../constant":256,"../util/eventlistenermixin":360,"./toggleoption":505,"./userlist":508,react:"react"}],510:[function(e,t,i){"use strict";var r=e("react");var n=e("react-dom");var o=e("immutable");var a=e("./vegamessages");var s=r.createClass({displayName:"VegaChart",propTypes:{data:r.PropTypes.array,spec:r.PropTypes.object.isRequired,height:r.PropTypes.number.isRequired,width:r.PropTypes.number.isRequired},getInitialState:function(){return{error:null,vegaView:null,vegaChart:null}},componentWillReceiveProps:function(){if(this.state.error){this.setState({error:null})}},componentWillMount:function(){this.createChart()},createChart:function(){var e=this,t={axis:{axisColor:"#474747",gridColor:"#474747",tickLabelFont:"Helvetica",tickLabelColor:"#474747"},legend:{labelColor:"#474747",labelFont:"Helvetica",titleColor:"#474747",titleFont:"Helvetica"}};vg.parse.spec(this.props.spec,t,function(t,i){if(t){console.error(t)}else{e.setState({vegaChart:i})}})},componentDidUpdate:function(){var e=n.findDOMNode(this),t=this.state.vegaView,i=this.props.spec.padding,r=this.props.height,o=this.props.width;if(this.state.error){return}if(!t&&!this.state.vegaChart){this.createChart()}else if(!t&&this.state.vegaChart){this.setState({vegaView:this.state.vegaChart({el:e})})}else if(t&&this.props.data){if(typeof i==="object"){r=r-i.top-i.bottom;o=o-i.left-i.right}t.height(r).width(o);this.props.data.forEach(function(e){t.data(e.name).remove(function(){return true}).insert(e.values)});try{t.update()}catch(e){this.setState({error:e,vegaView:null,vegaChart:null})}}},render:function(){if(this.state.error){return r.createElement(a,{messages:o.List(["Invalid configuration."])})}else{return r.DOM.div({className:"vega-chart-inner"})}}});t.exports=s},{"./vegamessages":515,immutable:"immutable",react:"react","react-dom":"react-dom"}],511:[function(e,t,i){"use strict";var r=e("react");var n=e("immutable");var o=e("./vegaconfig");var a=e("./vegaview");var s=e("./vegamessages");var l=e("../modelerstate");var u=e("../pivotconfig_helper");var c=e("./pivot/config_helper");var d=e("../util/eventlistenermixin");var p=e("../store/multiaxisdatastore").MultiAxisDataEvents;var f=e("../constant").ViewConfig.EVENTS;var h=e("../util").shouldReflectDataChange;var g="query";var m=r.createClass({displayName:"VegaChartController",propTypes:{id:r.PropTypes.string.isRequired,config:r.PropTypes.object.isRequired,modelerApp:r.PropTypes.object.isRequired,height:r.PropTypes.number.isRequired,width:r.PropTypes.number.isRequired},mixins:[d],setEventListeners:function(){var e=this.props.modelerApp,t=e.getMultiAxisDataStore(),i=e.getViewConfigStore();return[{emitter:i,emitterId:this.$getViewId(),event:f.STATE_CHANGED,callback:this.$onViewConfigChanged},{emitter:i,emitterId:this.$getSourcePivotId(),event:f.STATE_CHANGED,callback:this.$onSourceFieldsChanged},{emitter:t,event:p.DATA_CHANGED,callback:this.$onDataChanged}]},getInitialState:function(){return{cellData:undefined,headerData:undefined,pivotState:undefined,validationMessages:[]}},componentWillMount:function(){this.$setLocalPivotState();this.$updateFromSourceView();this.$setData()},componentWillUnmount:function(){var e=this.$getViewId(),t=this.props.modelerApp;t.getMultiAxisConfigActionHandler().setViewInactive(e)},$onViewConfigChanged:function(){this.$setLocalPivotState()},$onSourceFieldsChanged:function(){this.$updateFromSourceView()},$getPivotConfig:function(){return this.props.config.get("pivotConfig")},$getSourcePivotId:function(){return this.props.config.get("sourceView")},$getViewId:function(){return this.props.id},$markViewActive:function(){var e=this.$getViewId(),t=this.props.modelerApp,i=t.getPivotStore(),r=t.getMultiAxisDataStore();if(i.isDefined(e)){if(!r.isPivotActive(e)){t.getPivotDataActionHandler().markPivotActive(e)}}},$requestDataForView:function(){var e=this.$getViewId(),t=this.props.modelerApp,i=t.getPivotStore();if(i.isDefined(e)){t.getModelerActionHandler().requestDataForPivot(e)}},$getModelerState:function(){return l.createModelerState(this.props.modelerApp)},$setLocalPivotState:function(){this.$setPivotState(this.$getPivotConfig())},$setPivotState:function(e){var t=this.$getViewId(),i=this.$getModelerState(),r,n;if(e){r=c.pivotStateFromPivotConfig(i,t,e);n=o.applyConstraints(this.props.config,r,this.props.modelerApp.getFieldStore());if(n.errorMessages.length===0){this.setState({pivotState:n.pivotState});this.$setMAConfig(n.pivotState)}this.setState({validationMessages:n.errorMessages})}},$updateFromSourceView:function(){var e=this.$getSourcePivotId(),t;if(!e)return;t=this.props.modelerApp.getViewConfigStore().getViewState(e).get("pivotConfig");if(t){this.$setPivotState(t)}},$setMAConfig:function(e){var t=this.$getViewId(),i=u.pivotConfigToMultiAxisConfig(this.$getModelerState(),t,c.getConfig(e).pivotConfig),r=this.props.modelerApp.getMultiAxisDataActionHandler(),o=this.props.modelerApp.getMultiAxisConfigStore().getViewTaskConfig(t,g);if(o&&n.is(i,o.maConfig)){return}return this.props.modelerApp.getModelerActionHandler().setViewTaskConfig(t,g,{maConfig:i}).then(function(){return r.setViewTaskRange(t,g,{})})},$isAxisHeaderDataLoading:function(e){var t=e.getLength(),i=e.getHeadingRange(0,t);return i.some(function(e){return e.headers.some(function(e){return e.config.loading})})},$isHeaderDataReady:function(){var e=this.props.modelerApp,t=e.getMultiAxisDataStore(),i=this.$getViewId(),r=t.getHeadingData(i,g);if(!r)return false;return!(this.$isAxisHeaderDataLoading(r.getHeadingAxisInfo("X"))||this.$isAxisHeaderDataLoading(r.getHeadingAxisInfo("Y")))},$hasMAConfig:function(){var e=this.props.modelerApp,t=this.$getViewId(),i=e.getMultiAxisConfigStore().getViewTaskConfig(t,g);return!!i},$isCellDataReady:function(){return!this.props.modelerApp.getMultiAxisDataStore().hasOutstandingRequestsForViewTask(this.$getViewId(),g)},$shouldReflectDataChange:function(e){return e&&h(e,[{viewId:this.$getViewId(),tasks:[g]}])},$onDataChanged:function(e){if(!this.$shouldReflectDataChange(e.viewTasks)){return}this.$setData()},$setData:function(){if(!(this.$hasMAConfig()&&this.$isHeaderDataReady()&&this.$isCellDataReady())){return}var e=this.props.modelerApp,t=e.getMultiAxisDataStore(),i=this.$getViewId(),r=e.getMultiAxisConfigStore().getViewTaskConfig(i,g).maConfig,n=t.getHeadingData(i,g),o=n.getHeadingAxisInfo("X"),a=o.getLength(),s=o.getHeadingRange(0,a),l=n.getHeadingAxisInfo("Y"),u=l.getLength(),c=l.getHeadingRange(0,u),d=n.getHeadingAxisInfo("Z"),p=r.getIn(["axis","X"]),f=r.getIn(["axis","Y"]),h=r.getIn(["axis","Z"]),m=n.getSelectedSliceFieldPos(h),v={start:d.findRowNumForFieldPos(m),length:1},b={X:{start:0,length:a},Y:{start:0,length:u},Z:v},w=t.getDataRange(i,g,b,y(p,f),true);e.getMultiAxisDataActionHandler().setViewTaskRange(i,g,{});this.setState({headerData:{X:s,Y:c},cellData:w.dataArray,orderedAxes:w.orderedAxesNames})},render:function(){var e=this.props.config,t=n.List(this.state.validationMessages),i;if(!e||!e.get("spec")){t=t.push("The VegaChart view must have a spec attribute that contains the Vega specification.")}if(!e.get("sourceView")&&!e.get("pivotConfig")){t=t.push("The VegaChart view must have either a sourceView or pivotConfig configured.")}if(e.get("sourceView")&&e.get("pivotConfig")){t=t.push("The VegaChart view cannot have both a sourceView or pivotConfig configured.")}if(this.state.cellData&&this.state.cellData.length===0){t=t.push("No data to display.")}if(t.size>0){i=r.createElement(s,{messages:t})}else{i=r.createElement(a,{pivotState:this.state.pivotState,spec:e.get("spec"),extraDataFields:e.get("extraDataFields"),headerData:this.state.headerData,cellData:this.state.cellData,height:this.props.height-3,width:this.props.width-4})}return i}});function v(e,t){if(t.has("fields")){return e.concat(t.fields)}return e.push(t)}function y(e,t){e=e.reduce(v,n.List());t=t.reduce(v,n.List());return function(i,r){function o(e,t){var r=i.fields.findIndex(function(e){return n.is(e,t)}),o;if(r>=0){o=i.headings[r][0];e.push({field:t.id,id:o.id,label:o.label})}return e}if(r&&i){r.xKeys=e.reduce(o,[]);r.yKeys=t.reduce(o,[])}r.cellInfo=i;return r}}t.exports=m},{"../constant":256,"../modelerstate":313,"../pivotconfig_helper":330,"../store/multiaxisdatastore":348,"../util":357,"../util/eventlistenermixin":360,"./pivot/config_helper":455,"./vegaconfig":512,"./vegamessages":515,"./vegaview":516,immutable:"immutable",react:"react"}],512:[function(e,t,i){"use strict";var r=e("../multiaxisconfig").FieldTypes;var n={hasConstraints:function(e){return e&&!!e.constraints&&!!e.constraints.axis},filterDimensions:function(e,t,i){var r=i&&i.axis&&i.axis[t].dimensions,o=t==="X"?"Y":"X";if(!r)return e;function a(e){return r.some(function(t){return n.fieldIsInDimension(e,t.name)})}return e.updateIn(["axis",t],function(e){return e.filter(a)}).updateIn(["axis",o],function(e){return e.filterNot(a)})},filterHigherLevels:function(e,t){return e.updateIn(["axis",t],function(e){return e.map(function(e){return e.type===r.DIMENSION?e.fields.last():e})})},fieldIsInDimension:function(e,t){if(e.type===r.LEVEL){return e.level&&e.level.dimensionName===t}if(e.type===r.DIMENSION){return e.dimension===t}return false},addDefaultFields:function(e,t,i,r){if(!i.dimensions){return e}i.dimensions.forEach(function(i){var o=e.getIn(["axis",t]).some(function(e){return n.fieldIsInDimension(e,i.name)});if(!o&&i.defaultField){e=e.updateIn(["axis",t],function(e){return e.push(r.getFieldFromQualifiedName(i.defaultField.qualifiedName))})}});return e},hasMinFields:function(e,t,i){return e.get("axis").get(t).size>=i},removeRollups:function(e){function t(e){return e.map(function(e){if(e.has("fields")){return e.set("fields",t(e.fields))}else{return e.delete("rollupConfigs")}})}return e.update("axis",function(e){return e.map(t)})},applyConstraints:function(e,t,i){var r=this.removeRollups(t),o=e.constraints,a;if(!n.hasConstraints(e)){return{pivotState:r,errorMessages:[]}}a=Object.keys(o.axis).reduce(function(e,t){var r=o.axis[t],a=e.pivotState,s=e.errorMessages,l={X:"Columns (X)",Y:"Rows (Y)",Z:"Slice (Z)"};if(r.dimensions){a=n.filterDimensions(a,t,o)}a=n.addDefaultFields(a,t,r,i);if(r.lowestLevelsOnly){a=n.filterHigherLevels(a,t,r)}if(r.minFields>0&&!n.hasMinFields(a,t,r.minFields)){s.push("Axis "+l[t]+" does not have the minimum number of fields.")}return{pivotState:a,errorMessages:s}},{pivotState:r,errorMessages:[]});if(a.errorMessages.length>0){a.pivotState=undefined}return a}};t.exports=n},{"../multiaxisconfig":328}],513:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("react-dom");var a=e("../vegamessages");var s=e("../../util/vegalite_utils");var l=e("../cssloader");var u={export:true,source:true,editor:false};var c="svg";var d=n.createClass({displayName:"VegaLite",propTypes:{spec:n.PropTypes.object.isRequired,data:n.PropTypes.array.isRequired,actions:n.PropTypes.object.isRequired},getInitialState:function(){return{height:0,width:0}},componentWillMount:function(){this.renderChart=r.debounce(this.renderChart,500);this.debouncedApplySize=r.debounce(this.applySize,100)},componentWillReceiveProps:function(e){this.renderChart(e)},componentDidMount:function(){this.applySize();this.renderChart(this.props);window.addEventListener("resize",this.debouncedApplySize)},componentWillUnmount:function(){window.removeEventListener("resize",this.debouncedApplySize)},componentDidUpdate:function(e,t){if(this.state.height!==t.height||this.state.width!==t.width){this.renderChart(e)}},getViewportSize:function(){var e=o.findDOMNode(this);return{width:e.offsetWidth,height:e.offsetHeight}},applySize:function(){if(!this.isMounted())return;this.setState(this.getViewportSize())},renderChart:function(e){if(!this.isMounted())return;e=e||this.props;var t={mode:"vega-lite",renderer:c,actions:r.merge({},u,{source:!!e.actions.viewSource,editor:!!e.actions.openInVegaEditor,export:!!e.actions.exportAsPng})},i=this.getViewportSize(),n=s.applyViewportSize(e.spec,i.width,i.height),o=this.refs.chart;n.data={values:e.data};t.spec=n;vg.embed(o,t,function(e,t){if(e){console.error("Failed to initialize the chart",e,n)}})},render:function(){var e=!this.props.data.length?n.createElement(a,{messages:["No data to display."]}):null;return n.DOM.div({className:"vega-lite"},e?e:n.DOM.div({ref:"chart"}))}});t.exports=d},{"../../util/vegalite_utils":366,"../cssloader":395,"../vegamessages":515,lodash:70,react:"react","react-dom":"react-dom"}],514:[function(e,t,i){"use strict";var r=e("immutable");var n=e("lodash");var o=e("react");var a=e("../pivot/config_helper");var s=e("../cssloader");var l=e("../../multiaxisconfig");var u=e("./vegalite");var c=e("../../util/vegalite_utils");var d=e("../../util/viewlayoututils");var p=e("../pivot/pivot_hoc");var f=e("../../constant");var h=f.VegaLite;var g=f.View;var m=o.createClass({displayName:"VegaLiteController",propTypes:{id:o.PropTypes.string.isRequired,uniqueId:o.PropTypes.string.isRequired,config:o.PropTypes.object.isRequired,sheetUniqueId:o.PropTypes.string.isRequired,sheetId:o.PropTypes.string.isRequired,sheetConfig:o.PropTypes.object.isRequired,pivotState:o.PropTypes.object.isRequired,modelerState:o.PropTypes.object.isRequired,updatePivotState:o.PropTypes.func.isRequired,spec:o.PropTypes.object.isRequired,headingData:o.PropTypes.object.isRequired,isLoading:o.PropTypes.bool.isRequired,range:o.PropTypes.object.isRequired,viewTaskId:o.PropTypes.string.isRequired},getData:function(e){return c.convertCellDataToVegaData(this.buildCellData(e))},buildCellData:function(e){var t=this.props.modelerApp,i=t.getMultiAxisDataStore(),r=this.props.pivotState,o=a.getAxis(r,"X"),s=a.getAxis(r,"Y"),l=e.getAxes(),u=l.indexOf("X"),c=l.indexOf("Y"),d=i.getDataRange(this.props.viewTaskId,"main",this.props.range,m.cellBuilder(o,u,s,c));return d&&n.compact(d.dataArray)},render:function(){var e=this.props.modelerApp.getModelerOptionStore().getChartActions(),t=this.props.isLoading?o.createElement(s,{caption:"Data is loading..."}):null,i=t||[o.DOM.div({className:"vl-actions-panel vl-select-mark",key:this.props.uniqueId+"_mark"},o.DOM.select({className:"vl-marks input-sm form-control",value:this.props.spec.mark,onChange:this.props.onMarkValueChange,disabled:this.props.spec.config.heatmap},n.map(h.MARK,function(e){return o.DOM.option({key:e,value:e},e)}))),o.DOM.div({className:"vl-chart-container",key:this.props.uniqueId+"_chart-container"},o.createElement(u,{key:this.props.uniqueId,spec:this.props.spec,data:this.getData(this.props.headingData),actions:e}))];return o.DOM.div({className:"panel panel-default vl-view-container"},i)},statics:{cellBuilder:function(e,t,i,n){var o=m.reduceToLevelFields,a,s,l,u,c,d,p={};e=e.reduce(o,r.List());i=i.reduce(o,r.List());return function(r,o){d={};if(o&&r){a=m.reduceCellInfoToKeys.bind(null,r,p,t);s=m.reduceCellInfoToKeys.bind(null,r,p,n);d.xKeys=e.reduce(a,[]);d.yKeys=i.reduce(s,[])}if(o&&o.queryResults&&o.queryResults.value&&o.queryResults.value.value){l=o.queryResults.value.value;c=l&&l.rawValue&&l.rawValue[l.rawValue.length-1];u=l&&l.formattedValue&&l.formattedValue[l.formattedValue.length-1];d.rawValue=c&&c[c.length-1];d.formattedValue=u&&u[u.length-1]}return d}},reduceCellInfoToKeys:function(e,t,i,r,n,o){
var a,s;s={field:n.id,id:e.headings[i][o].id,label:e.headings[i][o].label};a=n.getIn(["sortConfigs",0,"measure","attribute","name"]);if(a){if(a==="order"){t[n.id]=t[n.id]||0;s.index=t[n.id]++}else if(a!=="label"){s.sortValue=n.get(a)}}r.push(s);return r},reduceToLevelFields:function(e,t){if(t instanceof l.DimensionField){return e.concat(t.fields)}return e.push(t)}}});function v(e){return o.createClass({displayName:"VegaLiteSpecCreator",createPivotState:function(e){var t=e.toJS(),i=a.pivotStateFromPivotConfig(this.props.modelerState,this.props.sheetId,t.pivotConfig,t.gridOptions),r=this.removeRollupsFromState(i),n=this.removeMeasureFieldsFromState(r);return this.removeNoneFieldsFromState(n)},removeMeasureFieldsFromState:function(e){var t=e.get("axis").reduce(function(e,t,i){if(i==="X"||i==="Y"){return e.concat(t)}return e},r.List()),i=t.filter(function(e){return e instanceof l.MeasureField});return i.reduce(function(e,t){return a.removeField(this.props.modelerState,e,t)},e,this)},removeNoneFieldsFromState:function(e){var t=a.getAxisFields(e,function(e){return e.displayMode===l.LevelDisplayMode.NONE});return t.reduce(function(e,t){return a.removeField(this.props.modelerState,e,t)},e,this)},removeRollupsFromState:function(e){var t=a.getRollupFields(e);return t.reduce(function(e,t){return a.removeRollupForField(e,t)},e)},onMarkValueChange:function(e){var t=this.generateSpec(this.props.pivotState,this.props.config),i=d.getInlineViewState(this.props.sheetConfig,g.Modules.PivotGrid),n;t=c.setMarkType(t,e.target.value);n=c.extractChartConfigFromVegaSpec(t);i=i.setIn(["config","chart"],r.fromJS(n));i=d.setInlineViewState(this.props.sheetConfig,g.Modules.PivotGrid,i);this.props.setViewState(i)},generateSpec:function(e,t){var i=this.getChartConfig(t),r=this.props.modelerState.measureModel;return c.buildVegaSpec(i,e,r)},getChartConfig:function(e){e=e||this.props.config;var t=e.get("chart");return t&&t.toJS()||{}},render:function(){var t=this.createPivotState(this.props.sheetConfig);return o.createElement(e,n.extend({},this.props,{spec:this.generateSpec(t,this.props.config),pivotState:t,onMarkValueChange:this.onMarkValueChange}))}})}t.exports=v(p(m,"VegaLiteChart"))},{"../../constant":256,"../../multiaxisconfig":328,"../../util/vegalite_utils":366,"../../util/viewlayoututils":367,"../cssloader":395,"../pivot/config_helper":455,"../pivot/pivot_hoc":477,"./vegalite":513,immutable:"immutable",lodash:70,react:"react"}],515:[function(e,t,i){"use strict";var r=e("react");var n=e("react-addons-pure-render-mixin");var o=r.createClass({displayName:"VegaView",propTypes:{messages:r.PropTypes.object.isRequired},mixins:[n],render:function(){return r.createElement("div",{className:"vega-messages"},this.props.messages.map(function(e){return r.createElement("p",{className:"vega-message",key:e},e)}))}});t.exports=o},{react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],516:[function(e,t,i){"use strict";var r=e("react");var n=e("immutable");var o=e("lodash");var a=e("../multiaxisconfig").FieldTypes;var s=e("./cssloader");var l=e("./vegachart");var u=r.createClass({displayName:"VegaView",propTypes:{pivotState:r.PropTypes.object,spec:r.PropTypes.object.isRequired,extraDataFields:r.PropTypes.object,headerData:r.PropTypes.object,cellData:r.PropTypes.array,orderedAxes:r.PropTypes.array,height:r.PropTypes.number.isRequired,width:r.PropTypes.number.isRequired},$createAxisData:function(e,t){if(t.length===0)return[];var i=t.length;return e.reduce(function(e,r,n){var o=0,a;for(;o<i;o++){a=t[o].headers[n];e.push({field:r.id,id:a.id,label:a.label,order:o})}return e},[])},$createHeaderData:function(){if(!this.props.pivotState||!this.props.headerData)return;var e=this.props.pivotState,t=e.getIn(["axis","X"]),i=e.getIn(["axis","Y"]),r=this.props.headerData.X,n=this.props.headerData.Y;return this.$createAxisData(t,r).concat(this.$createAxisData(i,n))},$getRunningTotalField:function(e){var t=this.props.extraDataFields;if(t){return t.findKey(function(t){return t.get("type")==="runningTotal"&&t.get("axis")===e})}},$getRunningTotalPctField:function(e){var t=this.props.extraDataFields;if(t){return t.findKey(function(t){return t.get("type")==="runningTotalPct"&&t.get("axis")===e})}},$getAxisKeys:function(e){if(!this.props.pivotState)return[];return this.props.pivotState.getIn(["axis",e]).reduce(function(t,i){if(i.type===a.DIMENSION){return t.concat(i.fields.map(function(i,r){return e+(t.size+r+1)}))}return t.push(e+(t.size+1))},n.List())},$addRunningTotalFields:function(e,t){var i=this.$getAxisKeys(t),r=this.$getAxisKeys(t==="X"?"Y":"X"),n=this.$getRunningTotalField(t),a=this.$getRunningTotalPctField(t),s;if(!(n||a)){return}s=o.groupBy(e,function(e){var t=i.pop().concat(r);return t.reduce(function(t,i){return t+"("+e[i].id+")"},"")});o.forEach(s,function(e){var t=0,i;if(a){i=o.sumBy(e,"val")}e.forEach(function(e){if(!isNaN(e.val)){t+=e.val}if(n){e[n]=t}if(a){e[a]=t/i}})})},$createData:function(){if(!this.props.pivotState||!this.props.cellData)return;var e=this.props.cellData,t=e.length,i=[],r;function n(e){if(!e.queryResults.value||!e.queryResults.value.value)return;var t={};if(typeof e.queryResults.value.value.rawValue!=="undefined"){t.val=Number(e.queryResults.value.value.rawValue)}e.xKeys.forEach(function(e,i){t["X"+(i+1)]=e});e.yKeys.forEach(function(e,i){t["Y"+(i+1)]=e});return t}for(var o=0;o<t;o++){r=n(e[o]);i.push(r)}this.$addRunningTotalFields(i,"X");this.$addRunningTotalFields(i,"Y");return i.filter(function(e){return!!e})},render:function(){var e=this.$createHeaderData(),t=this.$createData(),i,n;if(e&&e.length>0&&t&&t.length>0){i=[{name:"headers",values:e},{name:"values",values:t}];n=r.createElement(l,{ref:"chart",spec:this.props.spec,data:i,height:this.props.height,width:this.props.width})}return r.DOM.div({className:"vega-chart"},i?n:r.createElement(s,{ref:"CSSLoader"}))}});t.exports=u},{"../multiaxisconfig":328,"./cssloader":395,"./vegachart":510,immutable:"immutable",lodash:70,react:"react"}],517:[function(e,t,i){"use strict";var r=e("assert");var n=e("immutable");var o=e("react");var a=e("react-addons-pure-render-mixin");var s=e("./cssloader");var l=e("../constant/viewconfig");var u=e("../constant/layout");var c=e("../util/eventlistenermixin");var d=e("./signal_manager");var p={};var f=o.createClass({displayName:"View",propTypes:{id:o.PropTypes.string.isRequired,parentUniqueId:o.PropTypes.string,modelerApp:o.PropTypes.object.isRequired,mode:o.PropTypes.string.isRequired,config:o.PropTypes.object,setViewState:o.PropTypes.func},mixins:[c,a],getDefaultProps:function(){return{mode:u.VIEW_MODE.DEFAULT}},setEventListeners:function(){return[{emitterId:this.props.id,emitter:this.props.modelerApp.getViewConfigStore(),event:l.EVENTS.STATE_CHANGED,callback:this.onViewStateChanged}]},getInitialState:function(){return{viewState:this.getViewState()||n.Map()}},getViewState:function(){return this.props.config||this.props.modelerApp.getViewConfigStore().getViewState(this.props.id)},setViewState:function(e,t){if(this.props.config){r(t,"childViewId should be passed as you're trying to save a subview of \""+this.props.id+'"');return this.props.setViewState(e,t)}else{var i=this.props.modelerApp.getViewConfigActionHandler(),n=this.props.id;return i.setViewState(n,e).then(function(){return i.saveViewState(n,e)})}},onViewStateChanged:function(){this.setState(this.getInitialState())},getComponent:function(e){var t=this.props.modelerApp.getViewStore().getViewModuleId(e),i=this.props.modelerApp.getViewStore();if(!p[t]){p[t]=d(i.getViewComponent(e))}return p[t]},render:function(){if(!this.state.viewState.size){return o.DOM.div(null,o.createElement(s))}var e=this.props.modelerApp.getViewStore().getViewUniqueId(this.props.parentUniqueId,this.props.id),t=o.createElement(this.getComponent(e),{id:this.props.id,uniqueId:e,modelerApp:this.props.modelerApp,config:this.state.viewState,mode:this.props.mode,height:this.props.height,width:this.props.width,setViewState:this.setViewState});return t}});t.exports=f},{"../constant/layout":259,"../constant/viewconfig":274,"../util/eventlistenermixin":360,"./cssloader":395,"./signal_manager":493,assert:2,immutable:"immutable",react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],518:[function(e,t,i){"use strict";var r=e("react");var n=e("immutable");var o=e("../util/eventlistenermixin");var a=e("../multiaxisconfig");var s=e("./pivot/config_helper");var l=e("./fieldpanel");var u=e("../constant").DND;var c=e("../constant");var d=c.ContextMenu.MenuItemInfo;var p=c.ContextMenu.IconInfo;var f=c.View;var h=c.Layout;var g=e("../pivotconfig_helper");var m=e("popupmenu").MenuItem;var v=e("popupmenu").MenuItemsTypes;var y=e("../menu_sections/filter_sort");var b=e("./field").Field;var w=e("./fielddropzone");var C=e("./draggable");var E=e("./fieldorderwrapper");var S=e("../util/viewlayoututils");var T=w(l,"VisibleMeasuresDropZone");var x=E(C(b,"DraggableMeasureField"),"OrderedMeasureField");var _=c.FilterableMeasureTypes;var M="measure-window-";var A="value-filter-window-";var I={options:{size:"200px",openIn:h.POSITION.RIGHT}};var O=r.createClass({displayName:"VisibleMeasures",propTypes:{sheetId:r.PropTypes.string.isRequired,sheetConfig:r.PropTypes.object.isRequired,modelerApp:r.PropTypes.object.isRequired,openComponentFn:r.PropTypes.func.isRequired,closeComponentFn:r.PropTypes.func.isRequired,updatePivotState:r.PropTypes.func.isRequired,pivotState:r.PropTypes.object.isRequired,modelerState:r.PropTypes.object.isRequired},mixins:[o],getInitialState:function(){return{dragData:undefined,dragOverData:undefined}},getModelerState:function(){return this.props.modelerState},setEventListeners:function(){return[{emitter:this.props.modelerApp.getDragAndDropStore(),event:u.EVENTS.CHANGED,callback:this.handleDndChange}]},isFilterable:function(e){var t=this.props.modelerApp.getMeasureModelStore().getModel().getMeasureInfo(e);return!!(s.findAxisForField(this.props.pivotState,s.getVisibleMeasures(this.props.pivotState).id)&&_.indexOf(t.type.kind)!==-1)},shouldInsertBefore:function(e){var t=this.state.dragData,i=t&&t.field,r=this.state.dragOverData,o=r&&r.field,a=g.getVisibleMeasureFields(this.props.pivotState);if(!this.state.isDraggingField){return false}if(!n.is(o,e)){return false}if(n.is(o,i)){return false}if(!this.state.isActive){return false}if(a&&a.indexOf(i)>-1&&a.indexOf(i)===a.indexOf(o)-1){return false}return!n.is(i,o)},handleDndChange:function(){var e=this.props.modelerApp,t=e.getDragAndDropStore(),i={isDraggingField:false,dragData:undefined,dragOverData:undefined,dropData:undefined,isActive:undefined};if(t.getDragType()===u.TYPES.FIELD){i.isDraggingField=true;i.dragData=t.getDragData();i.dragOverData=t.getDragOver();i.dropData=t.getDropData();i.isActive=t.getDragData().field instanceof a.MeasureField}this.setState(i)},handleDrop:function(){var e,t,i,r;if(this.state.isActive){r=this.props.modelerApp.getDragAndDropActionHandler();e=this.state.dragData.field;t=this.state.dragOverData&&this.state.dragOverData.field;if(n.is(e,t)){t=undefined}i=s.removeField(this.getModelerState(),this.props.pivotState,e);i=s.addMeasureToGroup(i,g.getVisibleMeasureGroup(this.props.pivotState),e,t);this.props.updatePivotState(i);r.drop(u.TYPES.FIELD,{sourcesheetId:this.props.sheetId,visibleMeasures:true});if(this.state.dragData.axis!==this.props.axis){r.stopDrag()}}},handleFieldDragLeave:function(){this.props.modelerApp.getDragAndDropActionHandler().dragOver(null,null)},handleFieldDragOver:function(e){this.props.modelerApp.getDragAndDropActionHandler().dragOver(u.TYPES.FIELD,{sourcesheetId:this.props.sheetId,field:e})},handleFieldDragStart:function(e){this.props.modelerApp.getDragAndDropActionHandler().startDrag(u.TYPES.FIELD,{sourcesheetId:this.props.sheetId,visibleMeasures:true,field:e,isMove:true})},handleFieldDragEnd:function(e){var t=this.state.dropData&&this.state.dropData.visibleMeasures,i;if(this.state.dragData.visibleMeasures&&!t){i=s.removeMeasureFromGroup(this.props.pivotState,g.getVisibleMeasureGroup(this.props.pivotState),e);this.props.updatePivotState(i)}this.props.modelerApp.getDragAndDropActionHandler().stopDrag()},handleRemoveClick:function(e){var t=s.removeMeasureFromGroup(this.props.pivotState,g.getVisibleMeasureGroup(this.props.pivotState),e);this.props.updatePivotState(t)},handleFilterClick:function(e){var t=A+e,i;if(S.isViewOpenedInLayout(this.props.sheetConfig,t)){this.props.closeComponentFn(t)}else{i={module:f.Modules.MeasureFilterWindow,config:{id:t,measureName:e,pivotId:this.props.sheetId}};this.props.openComponentFn(t,I,i)}},handleClearFilterClick:function(e){var t=s.setMeasureFilter(this.props.pivotState,e);this.props.updatePivotState(t)},handlePropertiesClick:function(e){var t=M+e,i=n.fromJS({module:f.Modules.MeasureWindow,config:{id:t,measureName:e}});this.props.openComponentFn(t,I,i)},createMenu:function(e){var t=r.createElement(m,{key:d.Remove.key,label:d.Remove.label,itemType:v.MenuItem,data:e,onClick:this.handleRemoveClick,iconName:p.Remove}),i=r.createElement(m,{key:d.MeasureProperties.key,label:d.MeasureProperties.label,itemType:v.MenuItem,data:e.id,onClick:this.handlePropertiesClick});return[t].concat(r.createElement(y,{key:d.FilterSection.key,modelerApp:this.props.modelerApp,field:e,selectedMeasure:e.id,isFilterable:this.isFilterable(e.id),openFilter:this.handleFilterClick,clearFilter:this.handleClearFilterClick}),[i])},createField:function(e){var t=e.id,i=!!s.findMetricFilter(this.props.pivotState,t);return r.createElement(x,{key:t,type:e.type,label:e.fieldLabel,title:t,isFiltered:i,isFilterable:this.isFilterable(t),onFilterClick:this.handleFilterClick.bind(this,t),onDragStart:this.handleFieldDragStart.bind(this,e),onDragStop:this.handleFieldDragEnd.bind(this,e),insertBefore:this.shouldInsertBefore(e),onDragOver:this.handleFieldDragOver.bind(this,e),onDragLeave:this.handleFieldDragLeave},this.createMenu(e))},render:function(){var e=this,t=g.getVisibleMeasureFields(this.props.pivotState).map(function(t){return e.createField(t)});return r.createElement(T,{ref:"fieldpanel",panelClass:"visiblemeasures-panel",isVertical:true,modelerApp:this.props.modelerApp,axis:this.props.axis,sheetId:this.props.sheetId,title:"Visible Measures",icon:"th",onDrop:this.handleDrop,isDroppable:this.state.isActive,isDraggingField:this.state.isDraggingField},this.props.children,t)}});t.exports=O},{"../constant":256,"../menu_sections/filter_sort":307,"../multiaxisconfig":328,"../pivotconfig_helper":330,"../util/eventlistenermixin":360,"../util/viewlayoututils":367,"./draggable":400,"./field":405,"./fielddropzone":406,"./fieldorderwrapper":408,"./fieldpanel":409,"./pivot/config_helper":455,immutable:"immutable",popupmenu:146,react:"react"}],519:[function(e,t,i){"use strict";var r=e("lodash");var n=e("react");var o=e("./modalwindow").ModalWindow;var a=e("./okcancelbuttons");var s="350px";var l=n.createClass({displayName:"WarningModalWindow",propTypes:{title:n.PropTypes.string.isRequired,text:n.PropTypes.string.isRequired,okText:n.PropTypes.string,cancelText:n.PropTypes.string,width:n.PropTypes.string,handleContinue:n.PropTypes.func,handleCancel:n.PropTypes.func},handleContinue:function(){if(r.isFunction(this.props.handleContinue)){this.props.handleContinue()}if(r.isFunction(this.props.closeWindow)){this.props.closeWindow()}},handleCancel:function(){if(r.isFunction(this.props.handleCancel)){this.props.handleCancel()}if(r.isFunction(this.props.closeWindow)){this.props.closeWindow()}},render:function(){return n.createElement(o,{onHide:this.handleCancel,title:this.props.title,visible:true,width:this.props.width||s,body:n.DOM.div({style:{whiteSpace:"pre-line"}},this.props.text),footer:n.createElement(a,{okText:this.props.okText||"Continue",cancelText:this.props.cancelText||"Cancel",onOk:this.handleContinue,onCancel:this.handleCancel})})}});t.exports=l},{"./modalwindow":437,"./okcancelbuttons":448,lodash:70,react:"react"}],520:[function(e,t,i){"use strict";var r=e("assert");var n=e("immutable");var o=e("./store/dockablelayout");var a=e("./constant").Layout;var s=e("./util/viewlayoututils");var l=e("./util");var u=e("lodash");var c={views:{},layout:{shape:{rows:"1",columns:"1"},viewPositions:{}}};c=n.fromJS(c);function d(e){this.$dockableLayout=new o;this.$config=c.merge(e);this.$layoutState=null;this.$layoutConfig=null;this.$originalLayoutConfig=null}d.prototype.getLayoutState=function(){if(!this.$layoutState){this.$applyConfig(this.$config,true);this.$dockableLayout.rearrangeLayout(true);this.$layoutState=this.$dockableLayout.buildLayoutConfig(true);this.$layoutState.model=this.$dockableLayout.getState()}return u.cloneDeep(this.$layoutState)};d.prototype.getLayoutConfig=function(){if(s.isDefaultViewMode(this.$config)){if(!this.$layoutConfig){this.$layoutConfig=this.$dockableLayout.buildLayoutConfig()}return u.cloneDeep(this.$layoutConfig)}return u.cloneDeep(this.$originalLayoutConfig)};d.prototype.updateLayout=function(e,t){if(!e||e===this.$config){return}if(!this.$originalLayoutConfig||!s.isDefaultViewMode(e)){this.$originalLayoutConfig=this.getLayoutConfig()}this.$config=e;this.$applyConfig(e,true);this.$dockableLayout.rearrangeLayout(true);this.$layoutConfig=null;this.$layoutState=this.$dockableLayout.buildLayoutConfig(true);this.$layoutState.model=this.$dockableLayout.getState()};d.prototype.getViewPosition=function(e){return this.$dockableLayout.getWidgetPosition(e)};d.prototype.$applyConfig=function(e,t){e=this.$preprocessConfig(e||this.$config);var i=this,r=this.$layoutState,n=e.get("layout").toJS(),o=[];if(e.equals(r)){return}if(!r||r.shape.rows!==n.shape.rows){this.$dockableLayout.setRows(n.shape.rows,true);t=true}if(!r||r.shape.columns!==n.shape.columns){this.$dockableLayout.setColumns(n.shape.columns,true);t=true}if(r){o=t?Object.keys(r.viewPositions):u.difference(Object.keys(r.viewPositions),Object.keys(n.viewPositions))}o.length&&i.$dockableLayout.removeWidgets(o,true);u.forEach(n.viewPositions,function(e,n){if(t||o.indexOf(n)===-1&&(!r||!u.eq(e,r.viewPositions[n]))){i.$dockableLayout.addWidget(n,e,true)}})};d.prototype.$preprocessConfig=function(e){e=c.merge(e);e.get("views").forEach(function(t,i){if(t.get("closed")){if(e.getIn(["layout","viewPositions",i])){e=e.deleteIn(["layout","viewPositions",i])}}else if(!e.getIn(["layout","viewPositions",i])){e=e.setIn(["layout","viewPositions",i],n.Map())}});return e};t.exports=d},{"./constant":256,"./store/dockablelayout":339,"./util":357,"./util/viewlayoututils":367,assert:2,immutable:"immutable",lodash:70}],521:[function(e,t,i){"use strict";var r=e("./event_emitter").EventEmitter;var n=e("lodash");n.mixin(o.prototype,r.prototype);function o(e,t,i,r){this.$websocketSuffix=e;this.$logActionHandler=i;this.$userStore=r;this.$driver=t;this.WEBSOCKET_URL=(window.location.protocol==="https:"?"wss":"ws")+"://"+window.location.host+e;this.MAX_RECONNECTION_ATTEMPTS=1e3;this.support="MozWebSocket"in window?"MozWebSocket":"WebSocket"in window?"WebSocket":null;this.$messageHandler;this.$reconnectionAttemps=0;this.MAX_RECONNECTION_ATTEMPTS=10}o.prototype.getWebSocket=function(){return this.$websocket};o.prototype.restart=function(){var e=this,t;if(!e.$websocketSuffix){return}if(e.support==null){this.$logActionHandler.error("Your browser doesn't support Websockets.");return}if(this.shouldAbortConnection())return;t=new window[e.support](e.WEBSOCKET_URL);if(t&&t.readyState===1)e.$reconnectionAttemps=0;e.$websocket=t;e.setHandlers(e.$messageHandler)};o.prototype.close=function(){if(!this.$websocket||this.$websocket.readyState===3)return;this.$websocket.close();this.$websocket=null};o.prototype.setRawMessageHandler=function(e){this.$messageHandler=e};o.prototype.isConnected=function(){return this.$websocket&&this.$websocket.readyState===1};o.prototype.setHandlers=function(e){var t=this;if(!this.$websocket)return;this.$websocket.onopen=e;this.$websocket.onmessage=e;this.$websocket.onclose=function(i){t.reconnect();e(i)}};o.prototype.shouldAbortConnection=function(){return this.$websocket&&(this.$websocket.readyState===0||this.$reconnectionAttemps>this.MAX_RECONNECTION_ATTEMPTS)};o.prototype.reconnect=function(){var e=this;return new Promise(function(t,i){if(e.$userStore.isAuthenticated()){console.info("Websocket connection lost, trying to reconnect...");if(e.$reconnectionAttemps<e.MAX_RECONNECTION_ATTEMPTS){setTimeout(function(){e.$reconnectionAttemps++;console.info("Reconnecting websocket.");e.restart();t()},1e3)}else{console.warn("Could not reconnect websocket.");i()}}else{console.warn("User is not logged in, could not reconnect websocket.");i()}})};i.ModelerWebSocket=o},{"./event_emitter":289,lodash:70}],522:[function(e,t,i){"use strict";var r=e("lodash");var n=e("./constant").Collaboration.ACTIONS;var o=e("./constant").Collaboration.EVENTS;var a=e("./constant").Collaboration.MESSAGE_PROPERTIES;function s(){}s.prototype.parseMessage=function(e){if(e.data&&r.isString(e.data)){e=this.deserializeMessage(e.data);if(e.msg&&e.msg.messageType){if(e.msg.messageType===n.BROADCAST_EDITS_WERE_MADE){e.type=o.DATA_UPDATED}else if(e.msg.messageType===n.BROADCAST_ACTION_CHANGED_STATE){e.type=o.ACTION_STATE_CHANGED}}else if(e.hasOwnProperty(a.PEERS)){e.type=o.USER_LIST_UPDATED}else if(e.hasOwnProperty(a.LEAVE_CODE)){e.type=o.USER_DISCONNECTED}else if(e.hasOwnProperty(a.JOIN)&&e.join){e.type=o.USER_CONNECTED}}return e};s.prototype.deserializeMessage=function(e){return JSON.parse(e)};t.exports=new s},{"./constant":256,lodash:70}],523:[function(e,t,i){(function(i){i.React=e("react");i.ReactDOM=e("react-dom");e("es6-shim/es6-shim.min");t.exports={util:e("./lib/logicblox.pivot/util"),Modeler:e("./lib/logicblox.pivot/modeler"),ModelerNavBar:e("./lib/logicblox.pivot/view/modelernavbar"),HttpHelper:e("./lib/logicblox.core/network").HttpHelper,LoginForm:e("./lib/logicblox.pivot/view/externalloginform"),LogoutControl:e("./lib/logicblox.pivot/view/externallogoutform"),UnauthorizedWindow:e("./lib/logicblox.pivot/view/unauthorizedwindow").UnauthorizedWindow,AuthenticatedModelerController:e("./lib/logicblox.pivot/view/authenticatedmodeler")}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./lib/logicblox.core/network":220,"./lib/logicblox.pivot/modeler":311,"./lib/logicblox.pivot/util":357,"./lib/logicblox.pivot/view/authenticatedmodeler":373,"./lib/logicblox.pivot/view/externalloginform":403,"./lib/logicblox.pivot/view/externallogoutform":404,"./lib/logicblox.pivot/view/modelernavbar":440,"./lib/logicblox.pivot/view/unauthorizedwindow":506,"es6-shim/es6-shim.min":20,react:"react","react-dom":"react-dom"}]},{},[523])(523)});
